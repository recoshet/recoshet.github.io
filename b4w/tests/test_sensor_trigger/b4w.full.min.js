var b4w="object"===typeof b4w?b4w:function(a){var q={};a.module=q;var d={};a.register=function(a,b){q[a]||(q[a]=b)};a.require=function(a,b){if(!q[a])throw Error('Module "'+a+'" not found');b=b||"__b4w_default";d[b]||(d[b]=function(a){return function(b){var c=q[b];if(!c)throw Error('Module "'+b+'" not found');c.Ui||(c.Ui={});c.Ui[a]||(c.Ui[a]={},c(c.Ui[a],d[a]));return c.Ui[a]}}(b));return d[b](a)};a.module_check=function(a){return q[a]?!0:!1};a.get_namespace=function(a){for(var b in d)if(d[b]==a)return b;
return""};a.worker_listeners=[];a.worker_namespaces=[];return a}({});"object"==typeof module&&module.Ln&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a){function q(){var a=d,c=a.getDate(),c=10>c?"0"+String(c):String(c),f=a.getMonth()+1,f=10>f?"0"+String(f):String(f),k=String(a.getFullYear()),n=a.getHours(),n=10>n?"0"+String(n):String(n),r=a.getMinutes(),r=10>r?"0"+String(r):String(r),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return c+"."+f+"."+k+" "+n+":"+r+":"+a}var d=new Date(2015,7,31,12,36,44),c=[15,8];a.version=function(){return c};a.version_str=function(){for(var a="",d=0;d<c.length;d++)a=1==d?a+(10>c[d]?
"0"+c[d]:c[d]):a+c[d],d!=c.length-1&&(a+=".");return a};a.type=function(){return"RELEASE"};a.date=function(){return d};a.date_str=q;a.timestamp=function(){var a=q(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.Ln&&b4w.module.__version(exports);b4w.module.__config=function(a,q){function d(){return b4w.module_check(a.fc.Uk)}function c(){for(var c=a.fc,d=null,n=document.getElementsByTagName("script"),l=0;l<n.length;l++){for(var e=n[l].src,g=0;g<c.Ps.length;g++)if(0<=e.indexOf(c.Ps[g])){d=e;break}if(null!==d)break}d||(b.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),d=document.location.href);c=d.indexOf("?");0<=c&&(d=d.substring(0,c));return d.substring(0,d.lastIndexOf("/")+1)}var b=q("__print"),
l=q("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.ly=l.ma(a.context);a.q={alpha_sort:!0,alpha_sort_threshold:.1,Om:!1,Ug:[5,5],yd:1E4,console_verbose:!1,do_not_load_resources:!1,zm:!1,Rr:1.5,Bz:10,background_color:[0,0,0,0],Qg:.01,render_resolution_factor:1,canvas_resolution_factor:1,vm:3,allow_cors:!1,Qn:!1,Hk:!0,show_hud_debug_info:!1,$F:!0,gk:!0,anaglyph_use:!1,jm:!0,tc:!0,Re:!0,Hh:!0,Rh:!0,Qk:!0,Vg:!0,Dh:!0,antialiasing:!0,smaa:!1,
wireframe_debug:!1,iv:!1,Mh:!0,Xj:!0,Eb:!0,em:!0,water_dynamic:!0,shore_smoothing:!0,qi:!0,Ub:1024,Tg:512,Su:!0,precision:"highp",quality:a.P_HIGH,Nm:!0,NB:!1,cu:!1,Cr:!1,cv:!1,Ig:!1,En:!1,mr:!1,Cs:!1,mn:!1,oH:!1,nd:!1,allow_hidpi:!1,gyro_use:!1,Or:!1,Ko:!1,po:!1,enable_selectable:!0,enable_outlining:!0,rf:!0,$s:128,lo:!1,Es:!1,wB:!1,Do:[0,0],uj:!1};a.bz=l.ma(a.q);a.me={Pa:-1,Sr:!1,Bg:1};a.controls={LB:1/120};a.Kd={dir:"ASSETS=../../assets/",FB:15,Yo:!0,Io:!1,Bn:!1};a.rx=l.ma(a.Kd);a.fc={shaders_dir:"",
fD:"include/",lH:"postprocessing/",Uk:"built_in_data",Ps:["b4w.min.js","b4w.full.min.js","src/b4w.js","USER_DEFINED_MODULE"],Rt:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.m={enabled:!0,yd:60,ok:"",gn:!1,ping:!1,Bm:!0};a.UB=l.ma(a.m);a.ni={vl:1024,gl:384,ur:32,Vy:128,Uy:256,yt:.25,bC:.5,aC:1};a.HC=l.ma(a.ni);a.w={$p:!0,Nl:!1,Fq:!1,cr:!1,Dr:!1};a.eD=l.ma(a.w);a.Mb={outlining_overview_mode:!1,Ef:[1,.4,.05],Ad:1,Wl:.2,Xl:3.8,Yl:1};a.Cn={enabled:!1,HD:"MAIN_OPAQUE",GD:0,iD:"DEPTH"};
a.Yy=l.ma(a.Cn);a.mx=function(){var b=a.q,c=a.m,d=a.ni;switch(b.quality){case a.P_ULTRA:b.gk=!0;b.shore_smoothing=!0;b.Re=!0;b.Hh=!0;b.Rh=!0;b.Qk=!0;b.jm=!0;b.tc=!0;b.Mh=!0;b.Xj=!0;b.Eb=!0;b.em=!0;b.render_resolution_factor=1.75;d.vl=2048;b.vm=3;b.Hk=!0;b.zm=!1;b.precision="highp";b.water_dynamic=!0;b.qi=!0;b.antialiasing=!0;b.smaa=!0;b.Dh=!0;b.Vg=!0;b.allow_hidpi=!0;b.enable_outlining=!0;b.rf=!0;c.yd=120;break;case a.P_HIGH:b.gk=!0;b.shore_smoothing=!0;b.Re=!0;b.Hh=!0;b.Rh=!0;b.Qk=!0;b.jm=!0;b.tc=
!0;b.Mh=!0;b.Xj=!0;b.Eb=!0;b.em=!0;b.render_resolution_factor=1;d.vl=1024;b.vm=3;b.Hk=!0;b.zm=!1;b.precision="highp";b.water_dynamic=!0;b.qi=!0;b.antialiasing=!0;b.smaa=!1;b.Dh=!0;b.Vg=!0;b.allow_hidpi=!1;b.enable_outlining=!0;b.rf=!0;c.yd=60;break;case a.P_LOW:b.gk=!1,b.shore_smoothing=!1,b.Re=!1,b.Hh=!1,b.Rh=!1,b.Qk=!1,b.jm=!1,b.tc=!1,b.Mh=!1,b.Xj=!1,b.Eb=!1,b.em=!1,b.render_resolution_factor=1,d.vl=512,b.vm=2,b.Hk=!1,b.zm=!0,b.precision="mediump",b.water_dynamic=!1,b.qi=!1,b.antialiasing=!1,b.smaa=
!1,b.Dh=!1,b.Vg=!1,b.allow_hidpi=!1,b.enable_outlining=!1,b.rf=!1,c.yd=60}};a.set=function(c,d){switch(c){case "allow_cors":a.q.allow_cors=d;break;case "allow_hidpi":a.q.allow_hidpi=d;break;case "alpha":a.context.alpha=d;break;case "alpha_sort":a.q.alpha_sort=d;break;case "alpha_sort_threshold":a.q.alpha_sort_threshold=d;break;case "anaglyph_use":a.q.anaglyph_use=d;break;case "animation_framerate":a.me.Pa=d;break;case "antialiasing":a.q.antialiasing=d;break;case "assets_dds_available":a.Kd.Bn=d;break;
case "assets_min50_available":a.Kd.Io=d;break;case "audio":a.w.$p=d;break;case "background_color":a.q.background_color=d;break;case "built_in_module_name":a.fc.Uk=d;break;case "canvas_resolution_factor":a.q.canvas_resolution_factor=d;break;case "console_verbose":a.q.console_verbose=d;break;case "do_not_load_resources":a.q.do_not_load_resources=d;break;case "gyro_use":a.q.gyro_use=d;break;case "physics_enabled":a.m.enabled=d;break;case "physics_uranium_path":a.m.ok=d;break;case "physics_calc_fps":a.m.gn=
d;break;case "physics_use_workers":a.m.Bm=d;break;case "precision":a.q.precision=d;break;case "quality":a.q.quality=d;break;case "render_resolution_factor":a.q.render_resolution_factor=d;break;case "sfx_mix_mode":a.w.Nl=d;break;case "shaders_dir":a.fc.shaders_dir=d;break;case "show_hud_debug_info":a.q.show_hud_debug_info=d;break;case "smaa":a.q.smaa=d;break;case "smaa_search_texture_path":a.fc.smaa_search_texture_path=d;break;case "smaa_area_texture_path":a.fc.smaa_area_texture_path=d;break;case "wireframe_debug":a.q.wireframe_debug=
d;break;case "enable_selectable":a.q.enable_selectable=d;break;case "enable_outlining":a.q.enable_outlining=d;break;case "outlining_overview_mode":a.Mb.outlining_overview_mode=d;break;case "glow_materials":a.q.rf=d;break;default:b.error("Unknown config property: "+c)}};a.get=function(c){switch(c){case "allow_cors":return a.q.allow_cors;case "allow_hidpi":return a.q.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.q.alpha_sort;case "alpha_sort_threshold":return a.q.alpha_sort_threshold;
case "anaglyph_use":return a.q.anaglyph_use;case "animation_framerate":return a.me.Pa;case "antialiasing":return a.q.antialiasing;case "assets_dds_available":return a.Kd.Bn;case "assets_min50_available":return a.Kd.Io;case "audio":return a.w.$p;case "background_color":return a.q.background_color;case "built_in_module_name":return a.fc.Uk;case "canvas_resolution_factor":return a.q.canvas_resolution_factor;case "console_verbose":return a.q.console_verbose;case "do_not_load_resources":return a.q.do_not_load_resources;
case "gyro_use":return a.q.gyro_use;case "physics_enabled":return a.m.enabled;case "physics_uranium_path":return a.m.ok;case "physics_calc_fps":return a.m.gn;case "physics_use_workers":return a.m.Bm;case "precision":return a.q.precision;case "quality":return a.q.quality;case "render_resolution_factor":return a.q.render_resolution_factor;case "sfx_mix_mode":return a.w.Nl;case "shaders_dir":return a.fc.shaders_dir;case "show_hud_debug_info":return a.q.show_hud_debug_info;case "smaa":return a.q.smaa;
case "smaa_search_texture_path":return a.fc.smaa_search_texture_path;case "smaa_area_texture_path":return a.fc.smaa_area_texture_path;case "wireframe_debug":return a.q.wireframe_debug;case "enable_selectable":return a.q.enable_selectable;case "enable_outlining":return a.q.enable_outlining;case "outlining_overview_mode":return a.Mb.outlining_overview_mode;case "glow_materials":return a.q.rf;default:b.error("Unknown config property: "+c)}};a.reset=function(){a.context=l.ma(a.ly);a.q=l.ma(a.bz);a.Kd=
l.ma(a.rx);a.m=l.ma(a.UB);a.ni=l.ma(a.HC);a.w=l.ma(a.eD);a.Cn=l.ma(a.Yy)};a.NA=d;a.WC=function(){var b=a.fc,k=a.m;d()||""!=b.shaders_dir||(b.shaders_dir=c()+"../shaders/");if(d())b.smaa_search_texture_path="smaa_search_texture.png",b.smaa_area_texture_path="smaa_area_texture.png";else if(""==b.smaa_search_texture_path||""==b.smaa_area_texture_path){var n=c()+b.Rt;b.smaa_search_texture_path=b.smaa_search_texture_path||n+"smaa_search_texture.png";b.smaa_area_texture_path=b.smaa_area_texture_path||n+
"smaa_area_texture.png"}k.enabled&&""==k.ok&&(n=c()+b.Rt,k.ok=n+"uranium.js")};a.get_std_assets_path=function(){return a.Kd.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,q){function d(a,d){var h=document.createElement("div"),p=h.style;p.position="absolute";p.backgroundColor="black";p.borderRadius="20px 20px 20px 0px";p.boxShadow="0px 0px 10px rgb(180, 180, 200)";p.opacity=1;p.padding="8px 12px";p.lineHeight="15px";p.visibility="hidden";p.fontSize="12px";var f=r.get_container();f.appendChild(h);var g=e.get_meta_tags(a),n=document.createElement("span"),N=n.style;n.innerHTML=g.title||a.name;N.fontWeight="bold";N.fontSize="12px";N.lineHeight=
"15px";N.color="#fff";N.fontFamily="Arial";l(n);h.appendChild(n);var M=g.description;if(M){var g=document.createElement("div"),y=g.style;y.position="absolute";y.bottom="0px";y.left="0px";y.backgroundColor="#000";y.borderRadius="20px 20px 20px 0px";y.boxShadow="0px 0px 10px rgb(180, 180, 200)";y.visibility="hidden";y.padding="8px 12px";y.overflow="hidden";y.lineHeight="15px";y.fontSize="12px";y.zIndex="2";h.appendChild(g);var K=document.createElement("span"),x=K.style;K.innerHTML=M;x.fontSize="12px";
x.fontFamily="Arial";x.fontWeight="bold";x.lineHeight="15px";x.color="#fff";x.visibility="hidden";g.appendChild(K);var S=!1,k=!1;f.addEventListener("click",function(a){if(!(S||k||C))if(a.target!=n&&a.target!=h||"hidden"!=y.visibility||1!=p.opacity)"visible"==y.visibility&&(p.visibility="visible",N.visibility="visible",y.visibility="hidden",x.visibility="hidden");else{p.visibility="hidden";N.visibility="hidden";y.visibility="visible";S=k=!0;a=h.offsetWidth-24;var e=h.offsetHeight-16,K=Math.min(d,c(M)),
f=b(M,K);f==e&&(y.height=f+"px");K!=a?w.animate(a,K,200,function(a){a==K&&("visible"==y.visibility&&(x.visibility="visible"),S=!1);y.width=a+"px"}):S=!1;f!=e?w.animate(e,f,200,function(a){a==f&&("visible"==y.visibility&&(x.visibility="visible"),k=!1);y.height=a+"px"}):k=!1;k||S||(x.visibility="visible")}},!1)}return h}function c(a){var b=document.createElement("div"),c=document.createElement("span"),h=b.style;c.innerHTML=a;c.style.fontSize="12px";c.style.fontFamily="Arial";c.style.fontWeight="bold";
c.style.color="#fff";c.style.visibility="hidden";h.lineHeight="15px";b.appendChild(c);h.position="absolute";h.visibility="hidden";h.fontSize="12px";h.display="inline-block";h.lineHeight="15px";document.body.appendChild(b);a=b.offsetWidth+1;document.body.removeChild(b);return a}function b(a,b){var c=document.createElement("div"),h=document.createElement("span"),e=c.style;h.innerHTML=a;h.style.fontSize="12px";h.style.fontFamily="Arial";h.style.fontWeight="bold";h.style.color="#fff";h.style.visibility=
"hidden";e.lineHeight="15px";c.appendChild(h);e.position="absolute";e.visibility="hidden";e.fontSize="12px";e.display="inline-block";e.width=b+"px";e.lineHeight="15px";document.body.appendChild(c);h=c.offsetHeight;document.body.removeChild(c);return h}function l(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]="none";a.style.cursor="default"}
function f(){for(var a=0,b=0;b<B.length;b++)B[b].Fh&&a++;H=new Float32Array(3*a)}var k=q("__batch"),n=q("__camera"),r=q("__container"),e=q("__objects"),g=q("__print"),h=q("__renderer"),p=q("__scenes"),w=q("__time");q("__util");q("__config");var C=!1,B=[],H=new Float32Array(0),u=new Uint8Array(16),D=new Float32Array(2),G=new Float32Array(3);a.append=function(a){var b;a:{for(b=0;b<B.length;b++)if(B[b].obj==a){b=!0;break a}b=!1}if(!b){b=a.anchor.Fh&&Boolean(p.ea(p.Dg(),"ANCHOR_VISIBILITY"));b={type:a.anchor.type,
obj:a,x:0,y:0,depth:0,xh:"out",Fh:b,element:null,ei:null,Sw:a.anchor.GB,yq:0,nl:a.anchor.nl};switch(b.type){case "ANNOTATION":b.element=d(a,b.Sw);b.yq=b.element.offsetHeight;break;case "ELEMENT":b.element=document.getElementById(a.anchor.nl),b.element||(g.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}B.push(b);f()}};a.remove=function(a){for(var b=0;b<B.length;b++){var c=B[b];if(c.obj==a){"ANNOTATION"==c.type&&(a=c,r.get_container().removeChild(a.element));B.splice(b,
1);f();break}}};a.update=function(){for(var a=0,b=B.length;b--;){var c=B[b];c.Fh&&(H.set(c.obj.f.i,3*a),a++);var h,e=c,d=G;h=p.Fj(p.Dg());h=d=n.project_point(h,e.obj.f.i,d);e=h[0];d=h[1];h=h[2];if(e!=c.x||d!=c.y||h!=c.depth){switch(c.type){case "ANNOTATION":var f=c.element;f.style.left=Math.floor(e)+"px";f.style.top=Math.floor(d-c.yq)+"px";break;case "ELEMENT":var f=c.element,w=f.getBoundingClientRect();f.style.cssText+="left:"+Math.floor(e-w.width/2)+"px;top:"+Math.floor(d-w.height/2)+"px;"}c.x=
e;c.y=d;c.depth=h;c.ei&&c.ei(e,d,c.xh,c.obj,f)}}0<a&&(a=p.ea(p.Dg(),"ANCHOR_VISIBILITY").o[0].D,k.TD(a,H))};a.rE=function(){for(var a=r.get_container(),b=B.length;b--;){var c=B[b],e=c.obj,d=c.x,f=c.y,w=c.depth,w=0>d||0>f||0>w||1<w||p.is_hidden(e)||d>=a.clientWidth||f>=a.clientHeight?"out":"visible";if(c.Fh&&"out"!=w){var w=c,g=p.ea(p.Dg(),"ANCHOR_VISIBILITY").j,M=r.kn(w.x,w.y,D,g);h.Lt(g.Ae,M[0],g.height-M[1],2,2,u);w=1020==u[0]+u[4]+u[8]+u[12]?"visible":"out"==w.xh||0==u[0]+u[4]+u[8]+u[12]?"covered":
w.xh}if(w!=c.xh){switch(c.type){case "ANNOTATION":case "ELEMENT":var y=c.element;if(!y)break;"out"==w?(y.style.visibility="hidden",y.children.length&&(y.children[0].style.visibility="hidden"),"ANNOTATION"==c.type&&1<y.children.length&&(g=y.children[1],g.style.visibility="hidden",g.children.length&&(g.children[0].style.visibility="hidden"))):"visible"==w?(y.style.visibility="visible",y.children.length&&(y.children[0].style.visibility="visible"),y.style.opacity=1):(y.style.visibility="visible",y.style.opacity=
.1,y.children.length&&(y.children[0].style.visibility="visible"),"ANNOTATION"==c.type&&1<y.children.length&&(g=y.children[1],g.style.visibility="hidden",g.children.length&&(g.children[0].style.visibility="hidden")))}c.xh=w;c.ei&&c.ei(d,f,c.xh,e,y)}}};a.attach_move_cb=function(a,b){for(var c=0;c<B.length;c++)B[c].obj==a&&(B[c].ei=b)};a.detach_move_cb=function(a){for(var b=0;b<B.length;b++)B[b].obj==a&&(B[b].ei=null)};a.cleanup=function(){for(var a=0;a<B.length;a++){var b=B[a];"ANNOTATION"==b.type&&
r.get_container().removeChild(b.element)}B.length=0};a.is_anchor=function(a){for(var b=0;b<B.length;b++)if(B[b].obj==a)return!0;return!1};a.get_element_id=function(a){for(var b=0;b<B.length;b++)if(B[b].obj==a)return B[b].nl;return!1};a.pause=function(){C=!0};a.resume=function(){C=!1}};b4w.module.__boundings=function(a,q){function d(a,b){for(var c=a[0],e=a[1],d=a[2],f=a[0],g=a[1],n=a[2],k=3;k<a.length;k+=3)var v=a[k],m=a[k+1],t=a[k+2],c=Math.max(c,v),e=Math.max(e,m),d=Math.max(d,t),f=Math.min(f,v),g=Math.min(g,m),n=Math.min(n,t);b.max_x=c;b.max_y=e;b.max_z=d;b.min_x=f;b.min_y=g;b.min_z=n;return b}function c(a,b){b||(b=new Float32Array(24));var c=a.max_x,e=a.max_y,d=a.max_z,f=a.min_x,g=a.min_y,n=a.min_z;b[0]=f;b[1]=g;b[2]=n;b[3]=c;b[4]=g;b[5]=n;b[6]=c;b[7]=e;b[8]=n;b[9]=f;b[10]=
e;b[11]=n;b[12]=f;b[13]=g;b[14]=d;b[15]=c;b[16]=g;b[17]=d;b[18]=c;b[19]=e;b[20]=d;b[21]=f;b[22]=e;b[23]=d;return b}function b(a,b,c){k.add(b,c,a.F);k.scale(a.F,.5,a.F);a.La=k.distance(a.F,b);return a}var l=q("__tsr"),f=q("__util"),k=q("__vec3"),n=new Float32Array(24),r=new Float32Array(3),e=new Float32Array(3),g=new Float32Array(3);a.cl=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.GF=function(){return{max_x:1E12,min_x:-1E12,max_y:1E12,
min_y:-1E12,max_z:1E12,min_z:-1E12}};a.pd=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.Hr=function(a,b){var c=a.max_y,e=a.max_z,d=a.min_x,f=a.min_y,g=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,e);a.min_x=Math.min(b.min_x,d);a.min_y=Math.min(b.min_y,f);a.min_z=Math.min(b.min_z,g)};a.zx=d;a.cn=function(b,e,w){w||(w=a.pd());b=c(b,n);f.Hf(b,e,b);return d(b,w)};a.tz=c;a.nH=function(b,c,e){e||(e=a.pd());
var d=c.min_x,f=c.max_x,g=c.min_y,n=c.max_y,k=c.min_z;c=c.max_z;if(d>=b.max_x||f<=b.min_x||g>=b.max_y||n<=b.min_y||k>=b.max_z||c<=b.min_z)return e.min_x=-.1,e.max_x=.1,e.min_y=-.1,e.max_y=.1,e.min_z=-.2,e.max_z=-.1,e;e.min_x=Math.max(b.min_x,d);e.max_x=Math.min(b.max_x,f);e.min_y=Math.max(b.min_y,g);e.max_y=Math.min(b.max_y,n);e.min_z=Math.max(b.min_z,k);e.max_z=Math.min(b.max_z,c);return e};a.rH=function(b,c,e){e||(e=a.pd());var d=b.max_x-b.min_x,f=b.max_y-b.min_y,g=b.max_z-b.min_z;e.min_x=b.min_x-
.5*(c-1)*d;e.max_x=b.max_x+.5*(c-1)*d;e.min_y=b.min_y-.5*(c-1)*f;e.max_y=b.max_y+.5*(c-1)*f;e.min_z=b.min_z-.5*(c-1)*g;e.max_z=b.max_z+.5*(c-1)*g;return e};a.en=function(b,c,e){e||(e=a.vk());k.transformMat4(b.F,c,e.F);e.La=b.La*f.Go(c);return e};a.dn=function(a,b,c){c||(c={Ld:new Float32Array(3),Md:new Float32Array(3),Nd:new Float32Array(3),F:new Float32Array([0,0,0])});l.transform_vec3(a.F,b,c.F);k.copy(a.Ld,c.Ld);k.copy(a.Md,c.Md);k.copy(a.Nd,c.Nd);l.transform_dir_vec3(c.Ld,b,c.Ld);l.transform_dir_vec3(c.Md,
b,c.Md);l.transform_dir_vec3(c.Nd,b,c.Nd);return c};a.el=function(a,b){return{La:a,F:new Float32Array(b)}};a.vk=function(){return{F:new Float32Array([0,0,0]),La:0}};a.dl=function(a,b,c,e){return{Ld:new Float32Array(a),Md:new Float32Array(b),Nd:new Float32Array(c),F:new Float32Array([e[0],e[1],e[2]])}};a.Bx=function(){return{F:new Float32Array([0,0,0]),La:1E12}};a.pz=function(a,b){var c=k.subtract(b.F,a.F,k.create());0==k.length(c)&&k.set(1,0,0,c);var e=k.normalize(c,k.create()),c=k.scale(e,a.La,k.create());
k.add(c,a.F,c);var d=k.scale(e,-a.La,k.create());k.add(d,a.F,d);var f=k.scale(e,b.La,k.create());k.add(f,b.F,f);var g=k.scale(e,-b.La,k.create());k.add(g,b.F,g);c=[c,d,f,g];e=k.normalize(e,k.create());d=c[0];f=c[0];for(g=1;g<c.length;g++){var n=k.dot(c[g],e);n<k.dot(d,e)&&(d=c[g]);n>k.dot(f,e)&&(f=c[g])}e=[d,f];c=e[0];e=e[1];a.F=k.scale(k.add(c,e,k.create()),.5,k.create());a.La=k.length(k.subtract(e,c,k.create()))/2};a.nr=function(a,b){var c=b.max_y,e=b.min_y,d=Math.max(0,c-e-2*a);return{La:a,height:d,
F:new Float32Array([0,(c+e)/2,0])}};a.pr=function(a,b){var c=b.max_y,e=b.min_y,d=Math.max(0,c-e);return{La:a,height:d,F:new Float32Array([0,(c+e)/2,0])}};a.or=function(a,b){var c=b.max_y,e=b.min_y,d=Math.max(0,c-e);return{La:a,height:d,F:new Float32Array([0,(c+e)/2,0])}};a.KF=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.nC=function(a){for(var b=0,c=0,e=0,d=0,f=0,g=0,n=0,k=0,v=0;v<a.submeshes.length;v++){var m=
a.submeshes[v];if(m.position.length){b=d=m.position[0];c=f=m.position[1];e=g=m.position[2];break}}for(v=0;v<a.submeshes.length;v++)for(var m=a.submeshes[v],m=m.position,t=0;t<m.length/3;t++)var z=m[3*t],l=m[3*t+1],A=m[3*t+2],b=Math.max(z,b),c=Math.max(l,c),e=Math.max(A,e),d=Math.min(z,d),f=Math.min(l,f),g=Math.min(A,g),n=Math.max(Math.sqrt(z*z+l*l+A*A),n),k=Math.max(Math.sqrt(z*z+A*A),k);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=d;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=f;a.b4w_bounding_box.max_z=
e;a.b4w_bounding_box.min_z=g;a.b4w_bounding_box_source.max_x=b;a.b4w_bounding_box_source.min_x=d;a.b4w_bounding_box_source.max_y=c;a.b4w_bounding_box_source.min_y=f;a.b4w_bounding_box_source.max_z=e;a.b4w_bounding_box_source.min_z=g;a.b4w_bounding_sphere_radius=n;a.b4w_bounding_cylinder_radius=k};a.jA=function(c){var d=c.subarray(0,3),n=c.subarray(6,9),l=c.subarray(12,15),B=c.subarray(18,21);c=k.subtract(n,d,r);k.normalize(c,c);var H=f.mA(d,n,l,e),H=k.cross(H,c,H);k.normalize(H,H);var u=k.create(),
D=k.create();k.subtract(n,d,g);D[0]=k.dot(g,c);D[1]=k.dot(g,H);n=k.create();k.subtract(l,d,g);n[0]=k.dot(g,c);n[1]=k.dot(g,H);l=k.create();k.subtract(B,d,g);l[0]=k.dot(g,c);l[1]=k.dot(g,H);B=a.vk();l=[u,D,n,l];u=b(B,l[0],l[1]);for(B=2;B<l.length;B++)if(k.distance(u.F,l[B])>u.La){for(var G=u,u=l,D=l[B],n=B-1,G=b(G,D,u[0]),v=1;v<=n;v++)if(k.distance(G.F,u[v])>G.La){for(var m=G,G=u,t=D,z=u[v],L=v-1,m=b(m,t,z),A=0;A<=L;A++)if(k.distance(m.F,G[A])>m.La){var J=t,N=z,M=G[A],y=k.subtract(N,M,g),y=k.squaredLength(y),
K=k.subtract(J,M,g),x=k.squaredLength(K),K=k.subtract(J,N,g),S=k.squaredLength(K),K=y*(x+S-y),T=x*(S+y-x),y=S*(y+x-S),x=K+T+y;k.copy(J,m.F);k.scale(m.F,K/x,m.F);k.scaleAndAdd(m.F,N,T/x,m.F);k.scaleAndAdd(m.F,M,y/x,m.F);m.La=k.distance(m.F,J)}G=m}u=G}B=u;c=k.scale(c,B.F[0],g);k.scaleAndAdd(c,H,B.F[1],c);k.add(c,d,B.F);return B}};b4w.module.__compat=function(a,q){function d(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function c(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function b(){return!window.ActiveXObject&&"ActiveXObject"in window}var l=q("__config"),f=q("__extensions"),k=q("__print");
q("__util");a.fz=function(a){a.getError()==a.INVALID_ENUM&&k.warn("Possible Tegra invalid enum issue detected, ignoring")};a.OC=function(a){var r=l.me,e=l.q,g=l.context,h=l.ni,p=l.w;e.$s=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);e.Ub=a.getParameter(a.MAX_TEXTURE_SIZE);e.Tg=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var w=Boolean(f.eA());d("Firefox/28.0")&&(d("Linux")||d("Macintosh"))&&(k.warn("Firefox 28 detected, applying depth hack"),w=!1);d("iPad")||d("iPhone")?(k.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack, applying ios depth hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
g.alpha||(e.background_color[3]=1),e.cv=!0,e.smaa=!1,e.Re=!1,e.precision="highp",e.Cs=!0,e.Es=!0):d("Mac OS X")&&d("Safari")&&!d("Chrome")&&(k.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),p.Fq=!0,p.cr=!0);d("Windows")&&(d("Chrome/40")||d("Firefox/33")||d("Firefox/34")||d("Firefox/35")||d("Firefox/36"))&&(k.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),e.mn=!0);c()&&(k.warn("Mobile detected, applying various hacks for video textures."),
e.Ig=!0,d("iPad")||d("iPhone")||(k.warn("Mobile (not iOS) detected, disable playback rate for video textures."),p.Dr=!0));(d("Firefox/35.0")||d("Firefox/36.0"))&&d("Windows")&&(k.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),e.Or=!0);if(d("iPhone")||b()||d("Edge"))k.warn("iPhone, IE11 or Edge detected. Enable sequential video fallback for video textures."),e.nd=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(k.warn("Not enough varyings, disable shadows on blend objects"),e.Cr=
!0);if(g=f.js())d("Macintosh")&&-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(k.warn("OS X / Intel HD 3000 detected, applying depth hack"),w=!1),d("Windows")&&d("Chrome")&&!d("Edge")&&-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("Intel")&&(k.warn("Chrome / Windows / Intel GPU detected, applying cubemap mipmap/rgb hack"),e.po=!0),-1<a.getParameter(g.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(k.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),
w=!1,r.Sr=!0),-1<a.getParameter(g.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(k.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),e.precision="highp",e.gk=!1),-1<a.getParameter(g.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T760")&&(k.warn('ARM Mali-T760 detected, set "highp" precision and disable SSAO.'),e.precision="highp",e.Re=!1),-1<a.getParameter(g.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&
-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(k.warn("Qualcomm Adreno detected, applying shader constants hack."),e.cu=!0,-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(k.warn('Qualcomm Adreno305 detected, set "highp" precision.'),e.precision="highp"),-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(k.warn('Qualcomm Adreno330 detected, set "highp" precision.'),e.precision="highp")),-1<a.getParameter(g.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&
(k.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),e.Qn=!0),d("Windows")&&d("Chrome")&&!d("Edge")&&a.getParameter(g.UNMASKED_RENDERER_WEBGL).match(/NVIDIA GeForce 8..0/)&&(k.warn("Chrome / Windows / NVIDIA GeForce 8000 series detected, setting max cubemap size to 256."),e.Tg=256);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(k.warn("Vertex textures are not allowed. Disabling vertex textures"),e.Nm=!1);e.allow_hidpi&&1<window.devicePixelRatio&&(k.log("%cENABLE HIDPI MODE",
"color: #00a"),e.render_resolution_factor=1,e.smaa=!1);w||(e.Mh=!1,e.Xj=!1,e.Eb=!1,e.water_dynamic=!1,e.shore_smoothing=!1,e.qi=!1,e.smaa=!1);e.Su=Boolean(f.ks());e.pj=w;0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(e.precision="mediump");b()&&(k.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),h.gl=512);if(b()&&d("Touch")||d("Edge"))k.warn("IE11 and touchscreen or Edge detected. Behaviour of the mouse move sensor will be changed."),e.lo=!0;128>=
a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(k.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),e.Qn=!0);d("Chrome")&&!d("Edge")&&(k.log("Chrome detected. Some of deprecated functions related to the Doppler effect won't be called."),e.mr=!0);if(d("Chrome")&&!d("Edge")||d("Firefox"))e.En=!0;if(b()||d("iPad"))k.warn("iPad or Internet Explorer detected. Applying alpha clip hack."),e.Om=!0;c()&&d("Firefox")&&(k.log("Mobile firefox detected. Applying autoplay media hack."),
e.Ko=!0);d("Edge")&&(k.warn("Microsoft Edge detected, set up new minimal texture size."),e.uj=!0)};a.detect_mobile=c;a.kx=function(){d("Firefox/35.0")&&d("Windows")&&(k.warn("Windows/Firefox 35 detected, forcing context's alpha"),l.context.alpha=!0)};a.to=b};b4w.module.__constraints=function(a,q){function d(a){var b={};b.type=a;return b}function c(a,c){a.qb&&a.qb.U&&b(a.qb.U,a);if(c.U){var y=c.U;if(-1==y.td.indexOf(a))y.td.push(a);else throw"Descendant object override is forbidden";}a.qb=c}function b(a,b){var y=a.td.indexOf(b);if(-1!=y)a.td.splice(y,1);else throw"No descendant object";}function l(a,b,y){switch(b.type){case 1:var c=a.f.quat,x=b.U.f.Z;y=b.U.f.quat;b.uc?(g.copy(b.uc,c),g.multiply(y,c,c)):g.copy(y,c);w.transformMat4(b.offset,x,a.f.i);a.f.scale=
b.lm*b.U.f.scale;break;case 9:var d=a.f.i,c=a.f.quat,x=b.U.f.Z;y=b.U.f.quat;g.multiply(g.invert(b.bh,b.bh),c,c);g.multiply(y,c,c);w.transformMat4(b.offset,x,d);g.copy(y,b.bh);break;case 10:d=a.f.i;c=a.f.quat;x=b.U.f.Z;y=b.U.f.quat;g.multiply(g.invert(b.bh,b.bh),c,c);g.multiply(y,c,c);w.transformMat4(b.offset,x,d);g.copy(y,b.bh);d=a.f.quat;c=g.multiply(b.U.f.quat,b.uc,v);c=r.as(c,C);d=r.as(d,B);r.rotate_eye_camera(a,p.ff(d[0],c[0]+b.fy,c[0]+b.ey),p.ff(d[1],c[1]+b.dy,c[1]+b.gy));break;case 13:var d=
a.f.i,c=a.f.quat,x=b.U.f.Z,m=b.U.f.i,l=b.kD,z=H,u=v;w.transformMat4(b.offset,x,z);p.smooth_v(z,d,y,l,d);x=H;w.sub(m,d,x);w.normalize(x,x);var D=c,d=L,m=d.subarray(0,3),z=d.subarray(3,6),q=d.subarray(6,9);w.copy(x,z);w.negate(z,z);w.normalize(z,z);Boolean(.999999<Math.abs(w.dot(x,p.AXIS_Y)))?(x=e.fromQuat(g.normalize(D,u),A),w.copy(x.subarray(0,3),m)):w.cross(p.AXIS_Y,z,m);w.normalize(m,m);w.cross(m,z,q);w.normalize(q,q);g.fromMat3(d,u);g.normalize(u,u);p.nu(u,c,y,.16*l,c);break;case 2:c=a.f.quat;
d=G;y=v;n(b.U,b.Sk,!0,d,y);b.uc?(g.copy(b.uc,c),g.multiply(y,c,c)):g.copy(y,c);a.f.scale=b.lm*d[3];p.transform_vec3(b.offset,d[3],y,d,a.f.i);break;case 3:d=a.f.i;c=a.f.quat;y=b.U.f.i;f(d,c,y);break;case 4:d=a.f.i;c=a.f.quat;y=b.target;f(d,c,y);break;case 5:d=a.f.i;c=a.f.quat;y=b.U.f.i;f(d,c,y);c=w.dist(d,y);if(c=c>b.dist_max?c-b.dist_max:c<b.rj?c-b.rj:0)w.sub(y,d,H),w.normalize(H,H),w.scale(H,c,H),w.add(d,H,d);break;case 6:d=a.f.i;c=a.f.quat;y=b.target;f(d,c,y);c=w.dist(d,y);if(c=c>b.dist_max?c-b.dist_max:
c<b.rj?c-b.rj:0)w.sub(y,d,H),w.normalize(H,H),w.scale(H,c,H),w.add(d,H,d);break;case 7:x=b.U.f.Z;w.transformMat4(b.offset,x,a.f.i);break;case 8:m=b.U.f.i;d=a.f.i;w.add(m,b.offset,d);break;case 14:c=a.f.quat;x=b.U.f.Z;y=b.U.f.quat;b.uc?(g.copy(b.uc,c),g.multiply(y,c,c)):g.copy(y,c);w.transformMat4(b.offset,x,a.f.i);break;case 11:d=b.U.f;y=h.create_sep(d.i,d.scale,d.quat,t);d=b.wm;h.multiply(y,d,y);d=a.f.i;d[0]=y[0];d[1]=y[1];d[2]=y[2];a.f.scale=y[3];c=a.f.quat;c[0]=y[4];c[1]=y[5];c[2]=y[6];c[3]=y[7];
break;case 12:d=b.wm;c=G;y=v;n(b.U,b.Sk,!0,c,y);l=t;h.set_transcale(c,l);h.set_quat(y,l);h.multiply(l,d,l);d=a.f.i;d[0]=l[0];d[1]=l[1];d[2]=l[2];a.f.scale=l[3];c=a.f.quat;c[0]=l[4];c[1]=l[5];c[2]=l[6];c[3]=l[7];break;case 15:y=b.U,c=r.hA(y),d=a.f.i,l=r.ul(c,"TOP"),u=r.ul(c,"BOTTOM"),x=l-u,b.Ts?(m=r.ul(c,"LEFT"),d[0]=m+x*b.zo):(m=r.ul(c,"RIGHT"),d[0]=m-x*b.zo),d[2]=b.Ju?-(l-x*b.Ip):-(u+x*b.Ip),r.VA(c)?d[1]=-b.distance:(d[1]=-1,w.normalize(d,d),w.scale(d,b.distance/Math.abs(d[1]),d)),h.transform_dir_vec3(d,
y.f.Ma,d),w.add(y.f.i,d,d),c=a.f.quat,b.uc?(g.copy(b.uc,c),g.multiply(y.f.quat,c,c)):g.copy(y.f.quat,c)}"CAMERA"==a.f.type&&(d=p.AXIS_Y,10==b.type&&(y=b.U.f.quat,d=w.transformQuat(d,y,J)),r.Op(a),k(a,d))}function f(a,b,c){var d=H;p.quat_to_dir(b,p.AXIS_MY,d);w.normalize(d,d);var x=u;w.subtract(c,a,x);w.normalize(x,x);a=p.DC(d,x,G);g.multiply(a,b,b);g.normalize(b,b)}function k(a,b){var c=a.f,d=c.quat,x=p.quat_to_dir(c.quat,p.AXIS_Y,H);w.normalize(x,x);if(.999999<Math.abs(w.dot(b,x)))x=g.identity(v);
else{var e=w.cross(b,x,u);w.normalize(e,e);if(c.Ca==r.MS_TARGET_CONTROLS)c.Ep&&w.negate(e,e);else{var f=p.quat_to_dir(c.quat,p.AXIS_Z,D);0<w.dot(f,b)&&w.negate(e,e)}c=p.quat_to_dir(c.quat,p.AXIS_X,D);w.normalize(c,c);var f=p.clamp(w.dot(c,e),-1,1),m=Math.acos(f),x=-.999999>=f?g.setAxisAngle(x,m,v):g.rotationTo(c,e,v);g.normalize(x,x)}g.multiply(x,d,d);r.Op(a)}function n(a,b,c,d,x){var e=a.f,f=e.Ag,p=e.ad[b];b=p.nj;a=a.J.pose.bones[p.Wo];var p=a.rq,n=G,w=e.Xc,k=e.Wc,l=e.Qc,u=e.Pc,A=w[4*b+1],r=w[4*
b+2],D=w[4*b+3],J=k[4*b+1],H=k[4*b+2],C=k[4*b+3];n[0]=(1-f)*w[4*b]+f*k[4*b];n[1]=(1-f)*A+f*J;n[2]=(1-f)*r+f*H;n[3]=(1-f)*D+f*C;w=v;k=m;w[0]=l[4*b];w[1]=l[4*b+1];w[2]=l[4*b+2];w[3]=l[4*b+3];k[0]=u[4*b];k[1]=u[4*b+1];k[2]=u[4*b+2];k[3]=u[4*b+3];g.slerp(w,k,f,w);f=t;h.set_transcale(n,f);h.set_quat(w,f);c?(c=z,h.translate(p,a.Ow,c),h.multiply(f,c,f)):h.multiply(f,p,f);h.multiply(e.Ma,f,f);d[0]=f[0];d[1]=f[1];d[2]=f[2];d[3]=f[3];x&&(x[0]=f[4],x[1]=f[5],x[2]=f[6],x[3]=f[7])}var r=q("__camera"),e=q("__mat3"),
g=q("__quat"),h=q("__tsr"),p=q("__util"),w=q("__vec3");a.gF=1;a.fF=2;a.kF=3;a.lF=4;a.aF=5;a.bF=6;a.hF=7;a.$E=8;a.eF=9;a.dF=10;a.YE=11;a.ZE=12;a.cF=13;a.iF=14;a.jF=15;var C=new Float32Array(2),B=new Float32Array(2),H=new Float32Array(3),u=new Float32Array(3),D=new Float32Array(3),G=new Float32Array(4),v=new Float32Array(4),m=new Float32Array(4),t=new Float32Array(16),z=new Float32Array(16),L=new Float32Array(9),A=new Float32Array(9),t=new Float32Array(8),J=new Float32Array(3);a.zq=function(a,b,y,e,
x){var f=d(1);f.U=b;f.offset=new Float32Array(y);f.uc=e?new Float32Array(e):null;f.lm=x;c(a,f);l(a,f,0)};a.dx=function(a,b,y,e,x,f){var m=d(2);m.U=b;m.Sk=y;m.offset=new Float32Array(e);m.uc=x?new Float32Array(x):null;m.lm=f;c(a,m);l(a,m,0)};a.cx=function(a,b,y,e){var x=d(9),f=a.f.quat,m=b.f.quat;x.U=b;x.offset=new Float32Array(y);x.bh=new Float32Array(m);e&&(g.copy(e,f),g.multiply(m,f,f));c(a,x);l(a,x,0)};a.bx=function(a,b,y,e,x,f,m,h){var v=d(10),w=a.f.quat,n=b.f.quat;v.U=b;v.offset=new Float32Array(y);
v.bh=new Float32Array(n);v.ey=p.angle_wrap_0_2pi(x);v.fy=p.angle_wrap_0_2pi(f);v.gy=p.angle_wrap_periodic(m,-Math.PI,Math.PI);v.dy=p.angle_wrap_periodic(h,-Math.PI,Math.PI);e?(v.uc=new Float32Array(e),g.copy(e,w),g.multiply(n,w,w)):v.uc=g.create();c(a,v);l(a,v,0)};a.ax=function(a,b,y,e){var x=d(13);x.U=b;x.offset=new Float32Array(y);x.kD=e;c(a,x);l(a,x,0)};a.fx=function(a,b,y,e){var x=d(14);x.U=b;x.offset=new Float32Array(y);x.lm=1;x.uc=e?new Float32Array(e):null;c(a,x);l(a,x,0)};a.gH=b;a.gx=function(a,
b){var y=d(3);y.U=b;c(a,y);l(a,y,0)};a.hx=function(a,b){var y=d(4);y.target=new Float32Array(b);c(a,y);l(a,y,0)};a.Xw=function(a,b,y,e){var x=d(5);x.U=b;x.rj=y;x.dist_max=e;c(a,x);l(a,x,0)};a.Yw=function(a,b,y,e){var x=d(6);x.target=new Float32Array(b);x.rj=y;x.dist_max=e;c(a,x);l(a,x,0)};a.ex=function(a,b,y){var e=d(7);e.U=b;e.offset=new Float32Array(y);c(a,e);l(a,e,0)};a.Ww=function(a,b,y){var e=d(8);e.U=b;e.offset=new Float32Array(y);c(a,e);l(a,e,0)};a.Uw=function(a,b,y){var e=d(11);e.U=b;e.wm=
new Float32Array(y);c(a,e);l(a,e,0)};a.Vw=function(a,b,y,e){var x=d(12);x.U=b;x.Sk=y;x.wm=new Float32Array(e);c(a,x);l(a,x,0)};a.append_stiff_viewport=function(a,b,y){var e=d(15);e.U=b;if("left"in y)e.Ts=!0,e.zo=y.left;else if("right"in y)e.Ts=!1,e.zo=y.right;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}if("top"in y)e.Ju=!0,e.Ip=y.top;else if("bottom"in y)e.Ju=!1,e.Ip=y.bottom;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}"distance"in
y?(e.distance=y.distance,e.uc="rotation"in y?new Float32Array(y.rotation):null,c(a,e),l(a,e,0)):m_print.error("append_stiff_viewport: Wrong positioning params")};a.dE=function(a,b){a.qb&&l(a,a.qb,b)};a.CC=f;a.correct_up=k;a.Wx=function(a){return a.qb?!0:!1};a.remove=function(a){a.qb.U&&b(a.qb.U,a);a.qb=null};a.zG=function(a){return a.qb?a.qb.type:null};a.jd=function(a){a=a.qb;return!a||11!=a.type&&12!=a.type?!1:!0};a.tl=function(a){var b=a.qb;if(b&&11==b.type)return b.U.f.Ma;if(b&&12==b.type){a=G;
var c=v;n(b.U,b.Sk,!0,a,c);b=t;h.set_transcale(a,b);h.set_quat(c,b);return b}return null};a.hd=function(a){a=a.qb;return!a||11!=a.type&&12!=a.type?null:a.wm};a.$z=n};b4w.module.__container=function(a,q){var d,c,b,l,f;function k(a,b){d=a;c=b}function n(){var a=g.getBoundingClientRect();k(a.left,a.top)}var r=q("__print"),e=q("__util"),g=null,h=null,p=!1;l=b=0;f=1;d=c=0;a.get_canvas=function(){return g};a.get_container=function(){return h};a.init=function(a){a&&a.parentNode?(g=a,h=a.parentNode):e.ka("canvas container is not available")};a.insert_to_container=function(a,b){b=b||"LAST";switch(b){case "FIRST":h.insertBefore(a,h.firstElementChild);break;case "JUST_BEFORE_CANVAS":h.insertBefore(a,
g);break;case "JUST_AFTER_CANVAS":g.nextElementSibling?h.insertBefore(a,g.nextElementSibling):h.appendChild(a,g);break;case "LAST":h.appendChild(a,g);break;default:r.error(b+" invalid stack order")}};a.xA=function(){return b};a.wA=function(){return l};a.set_canvas_offsets=k;a.update_canvas_offsets=n;a.dD=function(a,c,e){b=a;l=c;f=e;n()};a.force_offsets_updating=function(){p=!0};a.client_to_canvas_coords=function(a,b,e){e||(e=new Float32Array(2));var f=e;p&&(n(),p=!1);f[0]=a-d;a=e;p&&(n(),p=!1);a[1]=
b-c;return e};a.kn=function(a,c,e,d){e||(e=new Float32Array(2));e[0]=a*f;e[1]=c*f;d&&(a=d.width/b,e[0]*=a,e[1]*=a);return e};a.OE=function(a,c,e,d){e||(e=new Float32Array(2));e[0]=a/f;e[1]=c/f;d&&(a=d.width/b,e[0]/=a,e[1]/=a)};a.Gs=function(b){return b&&b.parentNode?b.parentNode==h?!0:a.Gs(b.parentNode):!1};a.Nr=function(a){var b=document.getElementsByTagName("script");a=e.Rj(a);for(var c=0;c<b.length;c++)if(b[c].src==a)return b[c];return null}};b4w.module.__controls=function(a,q){function d(a){return{type:a,value:0,ha:null,vd:!1,key:0,bb:"",Pd:!1,pn:null,on:function(){},nn:null,er:function(){},Oe:null,X:new Float32Array(3),ya:new Float32Array(3),Fs:!1,zl:!1,Kt:0,Jt:function(){},axis:"",Vc:0,Hi:new Float32Array(3),fm:new Float32Array(4),threshold:0,Gt:new Float32Array(4),Mk:0,Lk:0,Tt:0,Nk:0,ld:0,repeat:!1,Gq:!1,yl:0,xl:0,wl:0,ho:0,fo:0,eo:0}}function c(a,E){a.value=Number(E)}function b(a){for(var E=a.Dd,b=a.KC,c=0;c<E.length;c++)b[c]=E[c].value;
return a.vB(b)}function l(a){a=y.indexOf(a);-1<a?y.splice(a,1):m.error("Wrong object")}function f(a,E){for(var b=0,c=0;c<E.length;c++)for(var y=E[c].af,x=0;x<y.length;x++)for(var e=y[x].Dd,d=0;d<e.length;d++)e[d]===a&&b++;return b}function k(a,E){switch(a.type){case 80:t.remove_collision_test(a.pn,a.bb,a.on);a.vd=!0;break;case 90:t.clear_collision_impulse_test(a.nn);a.vd=!0;break;case 100:t.remove_ray_test(a.Kt);a.vd=!0;break;case 130:a.vd=!0}var b=E.indexOf(a);-1<b&&E.splice(b,1)}function n(a){for(var E=
0;E<K.length;E++){var b=K[E];20==b.type&&a.keyCode==b.key&&c(b,1)}I&&a.preventDefault();ha&&ha(a)}function r(a){for(var b=0;b<K.length;b++){var y=K[b];20==y.type&&0==a.keyCode&&16==y.key&&c(y,0);20==y.type&&a.keyCode==y.key&&c(y,0)}I&&a.preventDefault();ha&&ha(a)}function e(a){var b=!1,y=null;W=!0;fa=a.clientX;R=a.clientY;T=a.clientX;U=a.clientY;for(var x=0;x<K.length;x++){var e=K[x];50==e.type&&(c(e,1),e.ha=a.which);160==e.type&&(b||(b=G.client_to_canvas_coords(a.clientX,a.clientY,ca),y=v.pick_object(b[0],
b[1]),b=!0),e.value=y==e.Oe?1:0)}da&&a.preventDefault();ga&&ga(a)}function g(a){for(var b=0;b<K.length;b++){var y=K[b];50==y.type&&c(y,0);160==y.type&&y.Gq&&(y.value=0)}W=!1;da&&!ma&&a.preventDefault();ga&&ga(a)}function h(a){var b=a.clientX,y=a.clientY;T=b;U=y;if(!M.lo||W)for(var x=b-fa,e=y-R,d=Math.sqrt(x*x+e*e),f=0;f<K.length;f++){var m=K[f];if(40===m.type)switch(m.axis){case "X":c(m,x);m.ha=b;break;case "Y":c(m,e);m.ha=y;break;case "XY":c(m,d),m.ha[0]=b,m.ha[1]=y}}da&&!ma&&a.preventDefault();
ga&&ga(a)}function p(a){G.Gs(a.relatedTarget)||g(a)}function w(a){var b=a.wheelDelta||-40*a.detail,b=b*N.LB;S+=b;for(b=0;b<K.length;b++){var y=K[b];30===y.type&&c(y,S)}P&&a.preventDefault();Y&&Y(a)}function C(a){var b=a.targetTouches;if(1==b.length){for(var c=b[0],b=c.clientX,c=c.clientY,y=!1,x=null,e=0;e<K.length;e++){var d=K[e];160==d.type&&(y||(y=G.client_to_canvas_coords(b,c,ca),x=v.pick_object(y[0],y[1]),y=!0),d.value=x==d.Oe)}V[0]=b;V[1]=-1;oa[0]=c;oa[1]=-1}else 1<b.length&&(la=ba=u(b),V[0]=
b[0].clientX,V[1]=b[1].clientX,oa[0]=b[0].clientY,oa[1]=b[1].clientY);aa.set(V);Q.set(oa);qa&&qa(a)}function B(b){var E=b.targetTouches;if(0!==E.length){if(1===E.length){aa[0]=E[0].clientX;aa[1]=-1;Q[0]=E[0].clientY;Q[1]=-1;var E=aa[0]-V[0],y=Q[0]-oa[0],x=Math.sqrt(E*E+y*y);if(-1!=V[1]&&-1!=oa[1]){var e=aa[0]-V[1],d=Q[0]-oa[1],f=Math.sqrt(e*e+d*d);f<x&&(E=e,y=d,x=f)}for(f=0;f<K.length;f++){var m=K[f];if(60===m.type)switch(m.ha=a.PL_SINGLE_TOUCH_MOVE,m.axis){case "X":c(m,E);break;case "Y":c(m,y);break;
case "XY":c(m,x)}}}else if(1<E.length){aa[0]=E[0].clientX;aa[1]=E[1].clientX;Q[0]=E[0].clientY;Q[1]=E[1].clientY;la=u(E);x=la-ba;e=ca;e[0]=(aa[0]+aa[1])/2;e[1]=(Q[0]+Q[1])/2;d=ka;d[0]=(V[0]+V[1])/2;d[1]=(oa[0]+oa[1])/2;var h,E=e[0],y=e[1],f=d[0],m=d[1];h=Math.sqrt((E-f)*(E-f)+(y-m)*(y-m));for(f=0;f<K.length;f++)if(m=K[f],70===m.type&&Math.abs(h)<Math.abs(x)&&(m.ha=a.PL_MULTITOUCH_MOVE_ZOOM,c(m,x)),60===m.type&&Math.abs(h)>Math.abs(x))switch(m.ha=a.PL_MULTITOUCH_MOVE_PAN,m.axis){case "X":E=e[0]-d[0];
c(m,E);break;case "Y":y=e[1]-d[1];c(m,y);break;case "XY":c(m,h)}}ua&&b.preventDefault();qa&&qa(b)}}function H(a){for(var b=0;b<K.length;b++){var y=K[b];if(170==y.type||180==y.type)y.xl=a.beta,y.yl=a.gamma,y.wl=a.alpha,y.value||(y.ho=a.gamma,y.fo=a.beta,y.eo=a.alpha,c(y,1))}}function u(a){var b=a[0],c=a[1];a=b.clientX;var b=b.clientY,y=c.clientX,c=c.clientY;return Math.sqrt((a-y)*(a-y)+(b-c)*(b-c))}var D=q("__config"),G=q("__container"),v=q("__objects"),m=q("__print"),t=q("__physics"),z=q("__quat"),
L=q("__time"),A=q("__util"),J=q("__vec3"),N=D.controls,M=D.q,y=[],K=[],x={},S=0,T=0,U=0,fa=0,R=0,W=!1,aa=new Float32Array(2),Q=new Float32Array(2),V=new Float32Array(2),oa=new Float32Array(2),ca=new Float32Array(2),ka=new Float32Array(2),la=0,ba=0,ea=!1,F=0,I=!1,da=!1,P=!1,ua=!1,ma=!1,ha=null,ga=null,Y=null,qa=null;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.CT_CHANGE=50;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.update=function(O,E){for(var e=
0;e<K.length;e++){var d=K[e],f=O,m=E;if(m)switch(d.type){case 110:var h=d.Oe,g=h.f.i,h=h.f.quat,p=J.dist(d.Hi,g),v=d.Gt;z.invert(d.fm,v);z.multiply(h,v,v);z.normalize(v,v);v=Math.abs(2*Math.acos(v[3]));p/=m;d.Mk=A.smooth(p,d.Mk,m,.3);d.ha[0]=p;p=v/m;d.Lk=A.smooth(p,d.Lk,m,.3);d.ha[1]=p;d.Mk>=d.threshold||d.Lk>=d.Tt?c(d,1):c(d,0);J.copy(g,d.Hi);z.copy(h,d.fm);d.Vc=f;break;case 120:h=d.Oe;g=h.f.i;h=Math.abs(g[1]-d.Hi[1])/m;d.Nk=A.smooth(h,d.Nk,m,.3);d.ha=h;d.Nk>=d.threshold?c(d,1):c(d,0);J.copy(g,d.Hi);
d.Vc=f;break;case 130:!d.vd&&0<=d.ld&&f-d.Vc>=d.ld&&(c(d,1),d.repeat?d.Vc=f:d.ld=-d.ld);break;case 140:d.Vc||(d.Vc=f);c(d,f-d.Vc);d.Vc=f;break;case 150:c(d,f);break;case 170:d.ha[0]=Math.PI*(d.yl-d.ho)/180;d.ha[1]=Math.PI*(d.xl-d.fo)/180;d.ha[2]=Math.PI*(d.wl-d.eo)/180;d.ho=d.yl;d.fo=d.xl;d.eo=d.wl;break;case 180:d.ha[0]=Math.PI*d.yl/180,d.ha[1]=Math.PI*d.xl/180,d.ha[2]=Math.PI*d.wl/180}}for(e=0;e<y.length;e++)for(m=y[e],d=m.af,f=0;f<d.length;f++)if(g=d[f],g.Mu!=F){g.Mu=F;v=g;h=0;switch(v.type){case a.CT_CONTINUOUS:h=
v.Fe;(p=b(v))?(h=1,v.Fe=1):1==h?(h=-1,v.Fe=-1):h=0;break;case a.CT_TRIGGER:h=v.Fe;(p=b(v))&&-1==h?(h=1,v.Fe=1):p||1!=h?h=0:(h=-1,v.Fe=-1);break;case a.CT_SHOT:h=v.Fe;(p=b(v))&&-1==h?(h=1,v.Fe=1):p||1!=h?h=0:(h=0,v.Fe=-1);break;case a.CT_LEVEL:p=b(v);v.Qs!=p?(h=1,v.Qs=p):h=0;break;case a.CT_CHANGE:for(var p=v.Dd,v=v.aB,n=0;n<p.length;n++){var t=p[n].value;h||t==v[n]||(h=1);v[n]=t}break;default:A.ka("Wrong sensor manifold type: "+v.type)}if(h&&(p=m==x?null:m,ea=!1,g.callback(p,g.id,h,g.Lx),ea)){e=-1;
break}}for(e=0;e<y.length;e++)for(m=y[e],d=m.af,f=0;f<d.length;f++)for(g=d[f],m=g.Dd,g=0;g<m.length;g++)switch(h=m[g],h.type){case 30:c(h,0);break;case 40:c(h,0);break;case 60:c(h,0);break;case 70:c(h,0);break;case 130:c(h,0)}S=0;fa=T;R=U;V.set(aa);oa.set(Q);ba=la;F++};a.create_custom_sensor=function(a){var b=d(10);c(b,a);return b};a.create_keyboard_sensor=function(a){var b=d(20);b.key=a;return b};a.create_collision_sensor=function(a,b,y){if(!a||!t.K(a))return m.error("Wrong collision object"),null;
var x=d(80);x.pn=a;x.bb=b;x.Pd=y;x.ha={coll_obj:null,coll_pos:y?new Float32Array(3):null,coll_norm:y?new Float32Array(3):null,coll_dist:0};x.on=function(a,b,E,y,O){c(x,a);a=x.ha;a.coll_obj=b;x.Pd&&(a.coll_pos.set(E),a.coll_norm.set(y),a.coll_dist=O)};x.vd=!0;return x};a.create_collision_impulse_sensor=function(a){if(!a||!a.m)return m.error("Wrong collision impulse object"),null;var b=d(90);b.nn=a;b.er=function(a){c(b,a)};b.vd=!0;return b};a.create_ray_sensor=function(a,b,y,x,e,f,m){var h=d(100);h.Oe=
a;h.X=b;h.ya=y;h.bb=x;h.Fs=e;h.Pd=f;h.zl=m;h.ha={hit_fract:0,obj_hit:null,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3)};h.Jt=function(a,b,E,y,x,O){h.Fs?c(h,-1==b?0:1):c(h,b);h.ha.hit_fract=b;h.ha.obj_hit=E;h.ha.hit_time=y;h.Pd&&(h.ha.hit_pos.set(x),h.ha.hit_norm.set(O))};h.vd=!0;return h};a.create_mouse_click_sensor=function(){return d(50)};a.create_mouse_wheel_sensor=function(){return d(30)};a.create_mouse_move_sensor=function(a){var b=d(40);b.axis=a||"XY";b.ha="XY"==b.axis?
new Float32Array(2):0;return b};a.create_touch_move_sensor=function(a){var b=d(60);b.axis=a||"XY";b.ha=0;return b};a.create_touch_zoom_sensor=function(){var a=d(70);a.ha=0;return a};a.create_motion_sensor=function(a,b,c){if(!a)return m.error("Wrong collision object"),null;var y=d(110);y.Oe=a;var x=a.f.i;a=a.f.quat;y.Gt=new Float32Array(4);y.Hi=new Float32Array(x);y.fm=new Float32Array(a);y.Mk=0;y.Lk=0;y.threshold=b||.1;y.Tt=c||.1;y.Vc=0;y.ha=new Float32Array([0,0]);return y};a.create_vertical_velocity_sensor=
function(a,b){if(!a)return m.error("Wrong collision object"),null;var c=d(120);c.Oe=a;var y=a.f.quat;c.Hi=new Float32Array(a.f.i);c.fm=new Float32Array(y);c.Nk=0;c.threshold=b||1;c.Vc=0;c.ha=0;return c};a.create_timer_sensor=function(a,b){var c=d(130);c.ld=a;c.repeat=b;c.vd=!0;return c};a.reset_timer_sensor=function(a,b,c,y){a=a||x;a=a.rd;if(!a||!a[b])return m.error("reset_timer_sensor(): wrong object"),null;b=a[b].Dd[c];if(!b)return m.error("reset_timer_sensor(): sensor not found"),null;b.Vc=L.get_timeline();
b.ld=y};a.create_elapsed_sensor=function(){var a=d(140);a.Vc=0;return a};a.create_gyro_delta_sensor=function(){var a=d(170);a.ha=new Float32Array(3);return a};a.create_gyro_angles_sensor=function(){var a=d(180);a.ha=new Float32Array(3);return a};a.create_timeline_sensor=function(){return d(150)};a.create_selection_sensor=function(a,b){var c=d(160);c.Oe=a;c.Gq=b;return c};a.JC=c;a.get_sensor_value=function(a,b,c){a=a||x;a=a.rd;if(!a||!a[b])return m.error("get_sensor_value(): wrong object"),null;b=
a[b].Dd[c];return b?b.value:(m.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=function(a,b,c){a=a||x;a=a.rd;if(!a||!a[b])return m.error("get_sensor_payload(): wrong object"),null;b=a[b].Dd[c];return b?b.ha:(m.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){y=[];K=[];x={}};a.check_sensor_manifold=function(a,b){a=a||x;if(!a.rd)return!1;if(b&&a.rd[b])return!0;if(!b)for(var c in a.rd)return!0;return!1};a.remove_sensor_manifold=function(a,b){a=a||
x;var c=a.rd;if(c){var d=a.af;if(b){var e=c[b];if(e){for(var m=e.Dd,h=0;h<m.length;h++)1===f(m[h],y)&&k(m[h],K);delete c[b];e=d.indexOf(e);-1<e?d.splice(e,1):A.ka("Incorrect manifolds array");Object.getOwnPropertyNames(c).length||l(a)}}else{for(b in c){e=c[b];m=e.Dd;for(h=0;h<m.length;h++)1===f(m[h],y)&&k(m[h],K);delete c[b];e=d.indexOf(e);-1<e?d.splice(e,1):A.ka("Incorrect manifolds array")}l(a);ea=!0}}};a.create_sensor_manifold=function(a,b,c,e,d,m,h){a=a||x;a.rd=a.rd||{};a.af=a.af||[];var g=a.rd,
v=a.af,p=g[b];if(p){e=p.Dd;for(var F=0;F<e.length;F++)1===f(e[F],y)&&k(e[F],K);p=v.indexOf(p);-1<p?v.splice(p,1):A.ka("Incorrect manifolds array")}c={id:b,type:c,Dd:e.slice(0),vB:d,KC:Array(e.length),callback:m,Lx:h,Fe:-1,Qs:0,aB:Array(e.length),Mu:-1};g[b]=c;v.push(c);-1==y.indexOf(a)&&y.push(a);a=c.Dd;for(b=0;b<a.length;b++){g=a[b];if(g.vd){switch(g.type){case 80:t.append_collision_test(g.pn,g.bb,g.on,g.Pd);break;case 90:t.apply_collision_impulse_test(g.nn,g.er);break;case 100:g.Kt=t.append_ray_test(g.Oe,
g.X,g.ya,g.bb,g.Jt,!1,!1,g.Pd,g.zl);break;case 130:g.Vc=L.get_timeline(),0>g.ld&&(g.ld=-g.ld)}g.vd=!1}-1==K.indexOf(g)&&K.push(g)}ea=!0};a.zr=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.az=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<y.length;a++){var b=y[a],c=b.rd,b=b.af,x;for(x in c)delete c[x];b.splice(0,b.length)}for(a=0;a<K.length;a++)k(K[a],K),a--;y.splice(0,y.length)};a.debug=function(){m.log(String(y.length)+
" objects with manifolds",y);m.log(String(K.length)+" sensors",K);for(var a=[],b=[],c=0;c<K.length;c++){var x=K[c];80==x.type&&a.push(x);100==x.type&&b.push(x)}m.log(String(a.length)+" collision sensors",a);m.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",n,!1);a.addEventListener("keyup",r,!1);I=b};a.register_mouse_events=function(a,b,c){if(c)var y=window;else y=a,y.addEventListener("mouseout",p,!1);a.addEventListener("mousedown",e,!1);
y.addEventListener("mousemove",h,!1);y.addEventListener("mouseup",g,!1);da=b;ma=c};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",w,!1);a.addEventListener("DOMMouseScroll",w,!1);P=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",C,!1);a.addEventListener("touchmove",B,!1);document.addEventListener("touchstart",function(){});ua=b};a.register_device_orientation=function(){window.DeviceOrientationEvent&&M.gyro_use&&window.addEventListener("deviceorientation",
H,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",n,!1);a.removeEventListener("keyup",r,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",e,!1);a.removeEventListener("mousemove",h,!1);a.removeEventListener("mouseout",p,!1);a.removeEventListener("mouseup",g,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",w,!1);a.removeEventListener("DOMMouseScroll",w,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",
C,!1);a.removeEventListener("touchmove",B,!1);document.removeEventListener("touchstart",function(){})};a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&M.gyro_use&&window.removeEventListener("deviceorientation",H,!1)};a.zF=function(a){ha=a};a.AF=function(a){ga=a};a.CF=function(a){Y=a};a.BF=function(a){qa=a}};b4w.module.__curve=function(a,q){function d(a,b,c,d,e){var g=d.length;e||(e=new Float32Array(g));for(var h=g+a,p=new Float32Array(h),w=1;w<=h-1;w++)p[w-1]=b>=c[w-1]&&b<c[w+1-1]?1:0;for(var l=2;l<=a;l++)for(w=1;w<=h-l;w++)p[w-1]=(0!=p[w-1]?(b-c[w-1])*p[w-1]/(c[w+l-1-1]-c[w-1]):0)+(0!=p[w+1-1]?(c[w+l-1]-b)*p[w+1-1]/(c[w+l-1]-c[w+1-1]):0);b==c[h-1]&&(p[g-1]=1);a=0;for(w=1;w<=g;w++)a+=p[w-1]*d[w-1];for(w=1;w<=g;w++)e[w-1]=0!=a?p[w-1]*d[w-1]/a:0;return e}function c(a){a=a.Jl;return a[a.length-1]}function b(a){a=
a.vr;return a[a.length-1]}q("__print");var l=q("__util");a.Ly=function(a){var b={},c=a.data;a=c.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var l=a.order_u;b.Cf=l;a=a.points;var e=a.length/5,g=[],h=e+l,e=e+2;g[0]=0;for(var p=2;p<=h;p++)g[p-1]=p>l&&p<e?g[p-2]+1:g[p-2];b.Jl=g;if("2D"==c.dimensions)b.vf=!1;else if("3D"==c.dimensions)b.vf=!0;else throw"Wrong curve dimensions";l=[];g=[];for(c=0;c<a.length;c+=5)l.push(a[c]),l.push(a[c+1]),l.push(a[c+2]),b.vf&&l.push(a[c+3]),g.push(a[c+
4]);b.sn=l;b.aq=g;a=[];for(var c=b.sn,l=b.vf?4:3,g=b.aq,h=b.Jl,e=b.Cf,p=c.length/l,w=p+e,C=0,B=h[w-1]/999,H=0;1E3>H;H++){5E-6>h[w-1]-C&&(C=h[w-1]);for(var u=d(e,C,h,g),D=0;D<l;D++)for(var G=a[l*H+D]=0;G<p;G++)a[l*H+D]+=u[G]*c[l*G+D];C+=B}l=b.vf?4:3;g=new Float32Array(1E3);g[0]=0;for(c=1;1E3>c;c+=1)h=a[(c-1)*l],e=a[(c-1)*l+1],p=a[(c-1)*l+2],w=a[c*l],C=a[c*l+1],B=a[c*l+2],g[c]=g[c-1]+Math.sqrt((w-h)*(w-h)+(C-e)*(C-e)+(B-p)*(B-p));b.vr=g;return b};a.wD=function(a,b,l){l||(l=[]);var r=b,e=Math.max(r,
0);b=e=Math.min(r,c(a));var r=a.sn,e=a.vf?4:3,g=a.aq,h=a.Jl,p=a.Cf;a=r.length/e;var w=a+p;5E-6>h[w-1]-b&&(b=h[w-1]);w=new Float32Array(a);d(p,b,h,g,w);for(b=0;b<e;b++)for(g=l[b]=0;g<a;g++)l[b]+=w[g]*r[e*g+b]};a.tD=function(a,b,c){c||(c=[]);var d=a.sn,e=a.vf?4:3,g=a.aq,h=a.Jl,p=a.Cf;a=d.length/e;var l=a+p;5E-6>h[l-1]-b&&(b=h[l-1]);var l=new Float32Array(a),C=b;b=l;var B=g.length;b||(b=new Float32Array(B));var H=new Float32Array(B),u=new Float32Array(B),D=H,G=u;D||(D=new Float32Array(B));G||(G=new Float32Array(B));
for(var v=B+p,m=new Float32Array(v),t=new Float32Array(v),z=1;z<=v-1;z++)m[z-1]=C>=h[z-1]&&C<h[z+1-1]?1:0;C==h[v-1]&&(m[B-1]=1);for(var L=2;L<=p;L++)for(z=1;z<=v-L;z++){var A=0!=m[z-1]?m[z-1]/(h[z+L-1-1]-h[z-1]):0,J=0!=m[z+1-1]?-m[z+1-1]/(h[z+L-1]-h[z+1-1]):0,N=0!=t[z-1]?(C-h[z-1])*t[z-1]/(h[z+L-1-1]-h[z-1]):0,M=0!=t[z+1-1]?(h[z+L-1]-C)*t[z+1-1]/(h[z+L-1]-h[z+1-1]):0;m[z-1]=(0!=m[z-1]?(C-h[z-1])*m[z-1]/(h[z+L-1-1]-h[z-1]):0)+(0!=m[z+1-1]?(h[z+L-1]-C)*m[z+1-1]/(h[z+L-1]-h[z+1-1]):0);t[z-1]=A+J+N+M}for(z=
1;z<=B;z++)D[z-1]=m[z-1],G[z-1]=t[z-1];h=0;for(p=1;p<=B;p++)h+=H[p-1]*g[p-1];C=0;for(p=1;p<=B;p++)C+=u[p-1]*g[p-1];for(p=1;p<=B;p++)b[p-1]=0!=h?u[p-1]*g[p-1]/h+H[p-1]*g[p-1]*C/(h*h):0;for(g=0;g<e;g++)for(h=c[g]=0;h<a;h++)c[g]+=l[h]*d[e*h+g]};a.pH=c;a.vD=b;a.uD=function(a,d){if(0>=d)return 0;var n=c(a);if(d>=b(a))return n;var r=a.vr,e=l.Pk(r,d,0,r.length-1);return n*(e+(d-r[e])/(r[e+1]-r[e]))/1E3}};b4w.module.__dds=function(a,q){function d(a,b,c,d){var e=new Uint16Array(4),f=new Uint16Array(c*d),l=0,n=0,k=0,G=n=l=0,v=0,m=0,t=0,z=c/4;d/=4;for(var r=0;r<d;r++)for(var A=0;A<z;A++)k=b+4*(r*z+A),e[0]=a[k],e[1]=a[k+1],l=e[0]&31,n=e[0]&2016,G=e[0]&63488,v=e[1]&31,m=e[1]&2016,t=e[1]&63488,e[2]=5*l+3*v>>3|5*n+3*m>>3&2016|5*G+3*t>>3&63488,e[3]=5*v+3*l>>3|5*m+3*n>>3&2016|5*t+3*G>>3&63488,l=a[k+2],n=4*r*c+4*A,f[n]=e[l&3],f[n+1]=e[l>>2&3],f[n+2]=e[l>>4&3],f[n+3]=e[l>>6&3],n+=c,f[n]=e[l>>8&3],f[n+1]=e[l>>
10&3],f[n+2]=e[l>>12&3],f[n+3]=e[l>>14],l=a[k+3],n+=c,f[n]=e[l&3],f[n+1]=e[l>>2&3],f[n+2]=e[l>>4&3],f[n+3]=e[l>>6&3],n+=c,f[n]=e[l>>8&3],f[n+1]=e[l>>10&3],f[n+2]=e[l>>12&3],f[n+3]=e[l>>14];return f}function c(a,b,c,l){var C=new Int32Array(c,0,31),B,H,u,D,G,v;if(542327876!=C[0])return k.error("Invalid magic number in DDS header"),0;if(!C[20]&4)return k.error("Unsupported format, must contain a FourCC code"),0;B=C[21];switch(B){case n:H=8;u=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case r:H=16;u=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case e:H=16;u=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return k.error("Unsupported FourCC code:",f(B)),null}v=1;C[2]&131072&&!1!==l&&(v=Math.max(1,C[7]));D=C[4];G=C[3];C=C[1]+4;if(b)for(B=0;B<v;++B)l=Math.max(4,D)/4*Math.max(4,G)/4*H,b=new Uint8Array(c,C,l),a.compressedTexImage2D(a.TEXTURE_2D,B,u,D,G,0,b),C+=l,D=Math.max(.5*D,1),G=Math.max(.5*G,1);else if(B==n)Math.max(4,D),Math.max(4,G),b=new Uint16Array(c),c=d(b,C/2,D,G),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,D,G,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,c),l&&a.generateMipmap(a.TEXTURE_2D);else return k.error("No manual decoder for",f(B),"and no native support"),0;return v}function b(a,b,e,d,f,l){var n=new XMLHttpRequest;n.open("GET",e,!0);n.responseType="arraybuffer";n.onload=function(){if(200==n.status){a.bindTexture(a.TEXTURE_2D,d);var e=c(a,b,n.response,f);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<e?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}l&&
l(d)};n.send(null);return d}function l(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function f(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var k=q("__print"),n=l("DXT1"),r=l("DXT3"),e=l("DXT5");a.cG=d;a.sE=c;a.ns=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.cA=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case n:b=6;break;case r:case e:b=4;break;default:k.error("Unsupported FourCC code:",f(a))}return b};
a.XG=b;a.WG=function(a,c,e,d){var f=a.createTexture();b(a,c,e,f,!0,d);return f}};b4w.module.__debug=function(a,q){function d(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function c(a,b){typeof a!=typeof b&&k.ka("Structure assertion failed: incompatible types");if(null!==a&&null!==b&&"object"==typeof a){for(var c in a)c in b||k.ka("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||k.ka("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&k.ka("Structure assertion failed: incompatible types for key "+
c)}}var b=q("__extensions"),l=q("__print"),f=q("__textures"),k=q("__util"),n=null,r={},e=!1,g={},h=[],p=-1,w=null,C=!1;a.nq={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.Ed=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var e=b[c];e in a&&(r[a[e]]=e)}n=a};a.Yx=function(a){if(e){var b=n.getError();b!=n.NO_ERROR&&(b in r?k.ka("GL Error: "+b+", gl."+
r[b]+" ("+a+")"):k.ka("Unknown GL error: "+b+" ("+a+")"))}};a.Tx=function(){if(e)switch(n.checkFramebufferStatus(n.FRAMEBUFFER)){case n.FRAMEBUFFER_COMPLETE:break;case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:l.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:l.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:l.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case n.FRAMEBUFFER_UNSUPPORTED:l.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:l.error("FRAMEBUFFER CHECK FAILED")}};a.Zq=function(){if(-1!=p)return p;n.bindFramebuffer(n.FRAMEBUFFER,n.createFramebuffer());var a=f.fl("DEBUG",f.Ti);f.resize(a,1,1);n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,a.ac,a.kb,0);n.checkFramebufferStatus(n.FRAMEBUFFER)!=n.FRAMEBUFFER_COMPLETE?(p=!0,l.warn("depth-only issue was found")):p=!1;n.bindFramebuffer(n.FRAMEBUFFER,null);return p};
a.Zx=function(a,b,c){if(e&&!n.getShaderParameter(a,n.COMPILE_STATUS))throw c=d(c),l.error("shader compilation failed:\n"+c+"\n"+n.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.$x=function(a,c,f,h,g,m){if(e&&!n.getProgramParameter(a,n.LINK_STATUS)){var p=b.cs();p&&(g=p.getTranslatedShaderSource(f),m=p.getTranslatedShaderSource(h));g=d(g);m=d(m);l.error("shader linking failed:\n"+g+"\n\n\n"+m+"\n"+n.getProgramInfoLog(a)+" ("+c+")");throw"Engine failed: see above for error messages";
}};a.set_check_gl_errors=function(a){e=a};a.dG=function(a){g[a]=a in g?g[a]+1:1};a.update=function(){for(var a in g)l.log(a,g[a]),g[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(k.is_vector(c))for(var e=0;e<c.length;e++)a.push(c[e]);else a.push(arguments[b])}h.push(a)};a.msg=function(){for(var a=1,b=0;b<h.length;b++){var c=h[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],k.is_vector(a))for(var e=0;e<a.length;e++)c.push(a[e]);
else c.push(arguments[b]);h.push(c)};var B=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},e=Math.max(0,performance.now()-1E3*a),d=0;d<h.length;d++){var m=h[d];a=m[0];if(!(a<e)){var f=String(m[1]);c[f]||(c[f]=B[b++%B.length]);a=["%c"+(a/1E3).toFixed(6),c[f],f];for(f=2;f<m.length;f++)a.push(m[f]);l.log.apply(this,a)}}h.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-
1E3*a),e=0;e<h.length;e++){var d=h[e];a=d[0];if(!(a<c))for(var m=2;m<d.length;m++){var f=String(d[1]);3<d.length&&(f+="_"+String(m-2));b[f]||(b[f]=f+"\n");b[f]+=String(a)+" "+d[m]+"\n"}}a="";for(f in b)a+=b[f]+"\n\n";l.log(a);h.splice(0)};a.LF=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&b("firefox");case "msie":return b("mozilla")&&
b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(k.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.wF=function(a,b){a.constructor!=b&&k.ka("Type assertion failed: value <"+a+"> has type <"+a.constructor+">, required <"+b+">")};a.xF=c;a.yF=function(a){C?c(a,w):C=!0;w=a}};b4w.module.__extensions=function(a,q){function d(a){if(a in l)return l[a];var d=b.getExtension(a)||null;l[a]=d;c.log("%cGET EXTENSION","color: #"+(d?"0a0":"a00"),a);return d}var c=q("__print"),b=null,l={};a.Ed=function(a){b=a};a.ks=function(){return d("WEBGL_compressed_texture_s3tc")||d("WEBKIT_WEBGL_compressed_texture_s3tc")||d("MOZ_WEBGL_compressed_texture_s3tc")};a.eA=function(){return d("WEBGL_depth_texture")||d("WEBKIT_WEBGL_depth_texture")||d("MOZ_WEBGL_depth_texture")};a.Xz=function(){return d("EXT_texture_filter_anisotropic")||
d("WEBKIT_EXT_texture_filter_anisotropic")||d("MOZ_EXT_texture_filter_anisotropic")};a.cs=function(){return d("WEBGL_debug_shaders")};a.js=function(){return d("WEBGL_debug_renderer_info")};a.ds=function(){return d("OES_element_index_uint")};a.sA=function(){return d("OES_standard_derivatives")};a.cleanup=function(){l={}}};b4w.module.__graph=function(a,q){function d(a,b,e){e||(e=null);if(c(a,b))throw"Graph already has node with given ID";a.V.push(b,e)}function c(a,b){for(var c=a.V,e=0;e<c.length;e+=2)if(c[e]==b)return!0;return!1}function b(a,b,e,d){d||(d=null);if(c(a,b)&&c(a,e))a.Y.push(b,e,d);else throw"Wrong node IDs";}function l(a,b){if(!c(a,b))throw"Node not found";for(var e=a.V,d=0;d<e.length;d+=2)e[d]==b&&(e.splice(d,2),d-=2)}function f(a,b,c,e){if(!z(a,b,c))throw"Edge not found";a=a.Y;for(var d=0,m=0;m<a.length;m+=
3)if(a[m]==b&&a[m+1]==c){if(-1==e)a.splice(m,3);else{if(e==d){a.splice(m,3);break}d++}m-=3}}function k(a){a=a.V;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}function n(a,b){for(var c=a.V,e=0;e<c.length;e+=2)if(c[e+1]==b)return c[e];return-1}function r(a){var b=[],c={};e(a,c);for(var d=a.V,m=0;m<d.length;m+=2)0==v(a,d[m])&&g(a,d[m],c,b);return{V:b,Y:a.Y.slice(0)}}function e(a,b){for(var c=a.V,e=0;e<c.length;e+=2)b[c[e]]=!1}function g(a,b,c,e){if(!c[b]){c[b]=!0;for(var d=0;d<G(a,b);d++)g(a,
m(a,b,d),c,e);e.unshift(b,D(a,b))}}function h(a,b,c,e){if(!c[b]){c[b]=!0;if(10==e||30==e)for(var d=0;d<G(a,b);d++){var f=m(a,b,d);h(a,f,c,e)}if(20==e||30==e)for(d=0;d<v(a,b);d++)f=t(a,b,d),h(a,f,c,e)}}function p(a){for(var b=[],c=a.V,e=0;e<c.length;e+=2){var d=c[e];G(a,d)||b.push(d)}return b}function w(a){var b=a.V;a=a.Y;for(var c=[],e=[],d=[],m=0;m<b.length;m++)d[b[2*m]]=m,c.push(m,b[2*m+1]);for(m=0;m<a.length;m+=3)e.push(d[a[m]],d[a[m+1]],a[m+2]);return{V:c,Y:e}}function C(a,b,c){if(c.Qd==c.zf){for(var e=
0,d=0;e<c.zf;e++)-1!=c.se[e]&&(a[d]=e,b[d]=c.se[e],d++);return!0}if(c.zf>c.fi||c.Qf>c.Rf||c.Ei>c.Gi||c.Di>c.Fi)return!1;for(var d=e=-1,f=!1;!f&&B(c,M,e,d);)if(e=M[0],d=M[1],H(c,e,d)){var h;h=c;f={};f.Cj=h.Cj;f.Dj=h.Dj;f.Po=h.Po;f.ml=h.ml;f.zf=h.zf;f.fi=h.fi;f.Cf=h.Cf;f.Qd=f.Tl=h.Qd;f.Di=h.Di;f.Ei=h.Ei;f.Qf=h.Qf;f.Fi=h.Fi;f.Gi=h.Gi;f.Rf=h.Rf;f.Xi=-1;f.se=h.se;f.qg=h.qg;f.Fg=h.Fg;f.Gg=h.Gg;f.Zg=h.Zg;f.$g=h.$g;f.pm=h.pm;h.pm[0]+=1;var f=h=f,g=e,p=d,l=f.Cj,n=f.Dj,w=f.zf,z=f.fi,k=f.se,A=f.qg,N=f.Fg,r=
f.Gg,J=f.Zg,F=f.$g;u(g<w);u(p<z);u(f.Qd<w);u(f.Qd<z);w=++f.Qd;f.Xi=g;N[g]||(N[g]=w,f.Di++,J[g]&&f.Qf++);J[g]||(J[g]=w,f.Ei++,N[g]&&f.Qf++);r[p]||(r[p]=w,f.Fi++,F[p]&&f.Rf++);F[p]||(F[p]=w,f.Gi++,r[p]&&f.Rf++);k[g]=p;A[p]=g;for(k=0;k<v(l,g);k++)A=t(l,g,k),N[A]||(N[A]=w,f.Di++,J[A]&&f.Qf++);for(k=0;k<G(l,g);k++)A=m(l,g,k),J[A]||(J[A]=w,f.Ei++,N[A]&&f.Qf++);for(k=0;k<v(n,p);k++)A=t(n,p,k),r[A]||(r[A]=w,f.Fi++,F[A]&&f.Rf++);for(k=0;k<G(n,p);k++)A=m(n,p,k),F[A]||(F[A]=w,f.Gi++,r[A]&&f.Rf++);f=C(a,b,h);
u(1>=h.Qd-h.Tl);u(-1!=h.Xi);A=h.Cj;g=h.Dj;p=h.Qd;l=h.Xi;n=h.se;N=h.qg;w=h.Fg;r=h.Gg;z=h.Zg;J=h.$g;if(h.Tl<p){w[l]==p&&(w[l]=0);for(F=0;F<v(A,l);F++)k=t(A,l,F),w[k]==p&&(w[k]=0);z[l]==p&&(z[l]=0);for(F=0;F<G(A,l);F++)k=m(A,l,F),z[k]==p&&(z[k]=0);A=n[l];r[A]==p&&(r[A]=0);for(F=0;F<v(g,A);F++)k=t(g,A,F),r[k]==p&&(r[k]=0);J[A]==p&&(J[A]=0);for(F=0;F<G(g,A);F++)k=m(g,A,F),J[k]==p&&(J[k]=0);n[l]=-1;N[A]=-1;h.Qd=h.Tl;h.Xi=-1}}return f}function B(a,b,c,e){-1==c&&(c=0);-1==e?e=0:e++;var d=a.Qf,f=a.Rf,m=a.Ei,
h=a.Gi,g=a.Di,p=a.Fi,v=a.Qd,l=a.zf,n=a.fi,M=a.se,t=a.qg,w=a.Fg,k=a.Gg,z=a.Zg,F=a.$g;if(d>v&&f>v)for(;c<l&&(-1!=M[c]||0==z[c]||0==w[c]);)c++,e=0;else if(m>v&&h>v)for(;c<l&&(-1!=M[c]||0==z[c]);)c++,e=0;else if(g>v&&p>v)for(;c<l&&(-1!=M[c]||0==w[c]);)c++,e=0;else if(0==c&&0!=a.Cf){for(w=0;w<l&&-1!=M[c=a.Cf[w]];)w++;w==l&&(c=l)}else for(;c<l&&-1!=M[c];)c++,e=0;if(d>v&&f>v)for(;e<n&&(-1!=t[e]||0==F[e]||0==k[e]);)e++;else if(m>v&&h>v)for(;e<n&&(-1!=t[e]||0==F[e]);)e++;else if(g>v&&p>v)for(;e<n&&(-1!=t[e]||
0==k[e]);)e++;else for(;e<n&&-1!=t[e];)e++;return c<l&&e<n?(b[0]=c,b[1]=e,!0):!1}function H(a,b,c){var e=a.Cj,d=a.Dj,f=a.fi,h=a.se,g=a.qg,p=a.Fg,l=a.Gg,n=a.Zg,M=a.$g;u(b<a.zf);u(c<f);u(-1==h[b]);u(-1==g[c]);if(!(0,a.Po)(D(e,b),D(d,c)))return!1;for(var w=f=0,k=0,A=0,N=0,r=0,J=0;J<G(e,b);J++){var F=m(e,b,J);if(-1!=h[F]){var I=h[F];if(!z(d,c,I)||!L(a.ml,e,b,F,d,c,I))return!1}else p[F]&&k++,n[F]&&f++,p[F]||n[F]||N++}for(J=0;J<v(e,b);J++)if(F=t(e,b,J),-1!=h[F]){if(I=h[F],!z(d,I,c)||!L(a.ml,e,F,b,d,I,c))return!1}else p[F]&&
k++,n[F]&&f++,p[F]||n[F]||N++;for(J=0;J<G(d,c);J++)if(I=m(d,c,J),-1!=g[I]){if(F=g[I],!z(e,b,F))return!1}else l[I]&&A++,M[I]&&w++,l[I]||M[I]||r++;for(J=0;J<v(d,c);J++)if(I=t(d,c,J),-1!=g[I]){if(F=g[I],!z(e,F,b))return!1}else l[I]&&A++,M[I]&&w++,l[I]||M[I]||r++;return k<=A&&f<=w&&N<=r}function u(a){if(!a)throw"Assertion failed";}function D(a,b){for(var c=a.V,e=0;e<c.length;e+=2)if(c[e]==b)return c[e+1];return null}function G(a,b){for(var c=a.Y,e=0,d=0;d<c.length;d+=3)c[d]==b&&e++;return e}function v(a,
b){for(var c=a.Y,e=0,d=0;d<c.length;d+=3)c[d+1]==b&&e++;return e}function m(a,b,c){a=a.Y;for(var e=0,d=0;d<a.length;d+=3)if(a[d]==b){if(e==c)return a[d+1];e++}return-1}function t(a,b,c){a=a.Y;for(var e=0,d=0;d<a.length;d+=3)if(a[d+1]==b){if(e==c)return a[d];e++}return-1}function z(a,b,c){a=a.Y;for(var e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==c)return!0;return!1}function L(a,b,c,e,d,f,m){for(var h=A(b,c,e),g=A(d,f,m),p=0;p<h;p++){for(var v=!1,l=0;l<g;l++)if(a(J(b,c,e,p),J(d,f,m,l))){v=!0;break}if(!v)return!1}return!0}
function A(a,b,c){var e=0;a=a.Y;for(var d=0;d<a.length;d+=3)a[d]==b&&a[d+1]==c&&e++;return e}function J(a,b,c,e){a=a.Y;for(var d=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(d==e)return a[f+2];d++}return null}q("__print");var N=q("__util"),M=[-1,-1];a.iq=-1;a.nF=10;a.Fm=20;a.qF=30;a.create=function(){for(var a=arguments,b=[],c=[],e=0;e<a.length;e++){var d=a[e];switch(d.length){case 2:b.push(d[0],d[1]);break;case 3:c.push(d[0],d[1],d[2]);break;default:throw"Wrong graph constructor params";}}return{V:b,
Y:c}};a.clone=function(a,b,c){if(b)for(var e=Array(a.V.length),d=0;d<a.V.length;d+=2)e[d]=a.V[d],e[d+1]=b(a.V[d+1]);else e=N.ma(a.V);if(c)for(b=Array(a.Y.length),d=0;d<a.Y.length;d+=3)b[d]=a.Y[d],b[d+1]=a.Y[d+1],b[d+2]=c(a.Y[d+2]);else b=N.ma(a.Y);return a={V:e,Y:b}};a.TF=function(a,b){for(var c=[],e=[],d=0;d<a.length;d++)c.push(a[d][0],a[d][1]);for(d=0;d<b.length;d++)e.push(b[d][0],b[d][1],b[d][2]);return{V:c,Y:e}};a.yh=d;a.EG=c;a.Sb=b;a.hh=l;a.gh=f;a.km=function(a,b,c,e){if(!z(a,b,c))throw"Edge not found";
a=a.Y;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c&&a[d+2][0]==e[0]&&a[d+2][1]==e[1]){a.splice(d,3);break}};a.u=function(a,b){if(-1==n(a,b)){var c=k(a);d(a,c,b);return c}throw"Non-unique attribute";};a.wC=function(a,b,c,e,d){a=a.Y;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&a[f+2]==e&&(a[f+2]=d)};a.Ej=k;a.Wg=n;a.n=function(a,c,e,d){c=n(a,c);e=n(a,e);if(-1!=c&&-1!=e)b(a,c,e,d);else throw"Attributes not found";};a.W=function(a,b){for(var c=a.V,e=0;e<c.length&&!b(c[e],c[e+1]);e+=2);};a.ee=function(a,
b){for(var c=a.Y,e=0;e<c.length&&!b(c[e],c[e+1],c[e+2]);e+=3);};a.Ue=function(a,b,c){for(var e=a.Y,d=0;d<e.length;d+=3)if(e[d+1]==b){var f=e[d];if(c(f,D(a,f),e[d+2]))break}};a.Tf=function(a,b,c){for(var e=a.Y,d=0;d<e.length;d+=3)if(e[d]==b){var f=e[d+1];if(c(f,D(a,f),e[d+2]))break}};a.Jp=r;a.LD=function(a){a=r(a).V;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.NG=function(){};a.xp=function(a,b,d){if(!c(a,b))throw"No such node";var f={};e(a,f);h(a,b,f,d);b=[];for(var m in f)f[m]&&(m=
Number(m),b.push(m,D(a,m)));a={V:b,Y:a.Y.slice(0)};f=a.Y;for(m=0;m<f.length;m+=3)b=f[m+1],c(a,f[m])&&c(a,b)||(f.splice(m,3),m-=3);return a};a.rA=function(a){for(var b=[],c=a.V,e=0;e<c.length;e+=2){var d=c[e];v(a,d)||b.push(d)}return b};a.ms=p;a.match=function(a,b,c,e){var d={};d.Cj=w(a);d.Dj=w(b);d.Po=c||function(a,b){return a==b};d.ml=e||function(a,b){return a==b};e=a.V.length/2;var f=b.V.length/2;d.zf=e;d.fi=f;d.Cf=0;d.Qd=d.Tl=0;d.Qf=d.Di=d.Ei=0;d.Rf=d.Fi=d.Gi=0;d.Xi=-1;d.se=Array(e);d.qg=Array(f);
d.Fg=Array(e);d.Gg=Array(f);d.Zg=Array(e);d.$g=Array(f);d.pm=[1];for(c=0;c<e;c++)d.se[c]=-1,d.Fg[c]=0,d.Zg[c]=0;for(c=0;c<f;c++)d.qg[c]=-1,d.Gg[c]=0,d.$g[c]=0;f=Array(e);e=Array(e);if(C(f,e,d)){for(c=0;c<f.length;c++)f[c]=a.V[2*f[c]],e[c]=b.V[2*e[c]];return[f,e]}return null};a.Qa=D;a.Df=G;a.mo=v;a.qf=m;a.Gj=t;a.uG=A;a.Be=J;a.replace=function(a,b,c){for(var e=a.Y,f=k(a),m=0;m<b.length;m++){var h=b[m];l(a,h);for(var g=0;g<e.length;g+=3)e[g]==h&&(e[g]=f),e[g+1]==h&&(e[g+1]=f),e[g]==e[g+1]&&(e.splice(g,
3),g-=3)}d(a,f,c)};a.oC=function(a,b,c,e,d){if(!z(a,b,c))throw"Edge not found";a=a.Y;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&(a[f]=e,a[f+1]=d)};a.nz=function(a,b){function c(a,b){if(-1!=g.indexOf(a)){var e=g.slice(g.indexOf(a));if(-1!=d[e[e.length-1]].indexOf(e[0])){l.push([a,e[e.length-1]]);return}}g.push(a);for(e=0;e<b.length;e++)b[e]in d&&c(b[e],d[b[e]])}b||(b=p(a)[0]);var e=a.Y;if(e.length){for(var d={},m=0,h=0;h<e.length;h+=3)e[h+1]in d?d[e[h+1]].push(e[h]):d[e[h+1]]=[e[h]],m++;var g=
[],l=[];c(b,d[b]);for(h=0;h<l.length;h++)for(var v=m=0;v<e.length;v+=3)l[h][1]==e[v+1]&&l[h][0]==e[v]&&f(a,e[v],e[v+1],m),m++}};a.WF=function(a,b,c){var e=a.V;a=a.Y;var d;d="digraph debug {\n    node [shape=box];\n";for(var f=0;f<e.length;f+=2){var m=e[f],h=e[f+1],h=b?b(m,h):String(m);d+="    ";d+=String(m)+' [label="'+h.replace(/\"/g,'\\"')+'"];\n'}for(f=0;f<a.length;f+=3)b=a[f],e=a[f+1],h=a[f+2],d+="    ",d+=String(b)+" -> "+String(e),c&&(d+=' [label="'+c(b,e,h)+'"]'),d+=";\n";return d+="}"}};b4w.module.__ipc=function(a,q){function d(a,b,c){for(var e=0;e<h.length;e+=2)h[e+1]==a&&(g[e+Number(!b)]=c)}function c(a){for(var b=0;b<a.length;b++){var c=a[b],e=0,d;for(d in c){var f=c[d];switch(f.constructor){case Float32Array:e+=f.length;break;case Number:e+=1}}--e;c.len=e}}a.yv=0;var b=a.qv=1,l=a.sv=2;a.rv=3;a.uv=4;a.vv=5;a.wv=6;a.zv=7;var f=a.Bv=8,k=a.hq=9,n=a.Cv=10;a.Dv=11;var r=a.Ev=12;a.Fv=13;a.Av=14;a.xv=15;a.tv=16;a.fw=100;a.Hv=101;a.Iv=102;a.Jv=103;a.Kv=104;a.Mv=105;a.Lv=106;a.Nv=107;
a.Ov=108;a.Pv=109;a.Qv=110;a.Rv=111;a.Sv=112;a.Uv=113;a.Vv=114;a.iw=115;a.Wv=116;a.Xv=117;a.Yv=118;a.$v=119;a.aw=120;a.bw=121;a.dw=122;a.ew=123;a.gw=124;a.Tv=125;a.kw=126;a.Zv=127;a.kq=128;a.jw=129;a.lw=130;a.mw=131;a.nw=132;a.ow=133;a.pw=134;a.qw=135;a.rw=136;a.sw=137;a.tw=138;a.uw=139;a.lq=140;var e=a.Ak=141;a.vw=142;a.jq=143;a.ww=144;a.xw=145;a.hw=146;a.cw=147;a.yw=148;var g=b4w.worker_listeners,h=b4w.worker_namespaces,p={Mc:r,v:0,time:0,i:new Float32Array(3),quat:new Float32Array(4),Ud:new Float32Array(3),
Jd:new Float32Array(3),len:0},w={Mc:f,ln:0,Zo:0,i:new Float32Array(3),quat:new Float32Array(4),len:0},C={Mc:k,id:0,Bh:0,hit_fract:0,hit_time:0,len:0},B={Mc:n,id:0,Bh:0,hit_fract:0,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),len:0},H={Mc:b,jg:0,kg:0,result:0,len:0},u={Mc:l,jg:0,kg:0,result:0,og:new Float32Array(3),coll_norm:new Float32Array(3),coll_dist:0,len:0},D={Mc:e,v:0,i:new Float32Array(3),quat:new Float32Array(4),len:0},G=[p,w,C,B,H,u,D];a.Ry=function(a,b){var c={Il:a?
!0:!1,bg:null,Od:[],ze:""};if(b)if(c.bg={addEventListener:function(a,b){"message"!=a&&panic("Wrong web worker event");d(c.ze,c.Il,b)},removeEventListener:function(a){"message"!=a&&panic("Wrong web worker event");d(c.ze,c.Il,null)},postMessage:function(a){var b;a:{for(b=0;b<h.length;b+=2)if(h[b+1]==c.ze){b=g[b+Number(!!c.Il)];break a}b=null}b({data:a})},terminate:function(){for(var a=0;a<h.length;a+=2)if(h[a+1]==c.ze){g.splice(a,2);h.splice(a,2);break}}},c.Il){var e=q("__util"),f=q("__container"),
p=b4w.get_namespace(q),e=e.Ii(p+"_worker");h.push(p);h.push(e);g.push(null);g.push(null);c.ze=e;f.Nr(a)?(f=f.Nr(a),f.addEventListener("load",function(){b4w.require("__bindings",c.ze)},!1)):(f=document.createElement("script"),f.src=a,f.defer="defer",f.async="async",f.addEventListener("load",function(){b4w.require("__bindings",c.ze)},!1),document.head.appendChild(f))}else c.ze=b4w.get_namespace(q);else c.bg=a?new Worker(a):self;return c};a.wx=function(a,d){function h(c){if(c.constructor==ArrayBuffer)c=
new Float32Array(c);else if(c[0].constructor==ArrayBuffer){for(var g=0;g<c.length;g++)h(c[g]);return}g=c[0]|0;switch(g){case r:var A=p;A.v=c[1]|0;A.time=c[2];A.i[0]=c[3];A.i[1]=c[4];A.i[2]=c[5];A.quat[0]=c[6];A.quat[1]=c[7];A.quat[2]=c[8];A.quat[3]=c[9];A.Ud[0]=c[10];A.Ud[1]=c[11];A.Ud[2]=c[12];A.Jd[0]=c[13];A.Jd[1]=c[14];A.Jd[2]=c[15];break;case f:A=w;A.ln=c[1]|0;A.Zo=c[2]|0;A.i[0]=c[3];A.i[1]=c[4];A.i[2]=c[5];A.quat[0]=c[6];A.quat[1]=c[7];A.quat[2]=c[8];A.quat[3]=c[9];break;case k:A=C;A.id=c[1]|
0;A.Bh=c[2]|0;A.hit_fract=c[3];A.hit_time=c[4];break;case n:A=B;A.id=c[1]|0;A.Bh=c[2]|0;A.hit_fract=c[3];A.hit_time=c[4];A.hit_pos[0]=c[5];A.hit_pos[1]=c[6];A.hit_pos[2]=c[7];A.hit_norm[0]=c[8];A.hit_norm[1]=c[9];A.hit_norm[2]=c[10];break;case b:A=H;A.jg=c[1]|0;A.kg=c[2]|0;A.result=!!c[3];break;case l:A=u;A.jg=c[1]|0;A.kg=c[2]|0;A.result=!!c[3];A.og[0]=c[4];A.og[1]=c[5];A.og[2]=c[6];A.coll_norm[0]=c[7];A.coll_norm[1]=c[8];A.coll_norm[2]=c[9];A.coll_dist=c[10];break;case e:A=D;A.v=c[1]|0;A.i[0]=c[2];
A.i[1]=c[3];A.i[2]=c[4];A.quat[0]=c[5];A.quat[1]=c[6];A.quat[2]=c[7];A.quat[3]=c[8];break;default:A=c}d(a,g,A)}c(G);a.bg.addEventListener("message",function(a){h(a.data)},!1)};a.cleanup=function(){};a.A=function(a,c){if(a)switch(c){case r:var d=p,h=new Float32Array(d.len);h[0]=d.Mc;h[1]=d.v;h[2]=d.time;h[3]=d.i[0];h[4]=d.i[1];h[5]=d.i[2];h[6]=d.quat[0];h[7]=d.quat[1];h[8]=d.quat[2];h[9]=d.quat[3];h[10]=d.Ud[0];h[11]=d.Ud[1];h[12]=d.Ud[2];h[13]=d.Jd[0];h[14]=d.Jd[1];h[15]=d.Jd[2];a.Od.push(h.buffer);
break;case f:d=w;h=new Float32Array(d.len);h[0]=d.Mc;h[1]=d.ln;h[2]=d.Zo;h[3]=d.i[0];h[4]=d.i[1];h[5]=d.i[2];h[6]=d.quat[0];h[7]=d.quat[1];h[8]=d.quat[2];h[9]=d.quat[3];a.Od.push(h.buffer);break;case k:d=C;h=new Float32Array(d.len);h[0]=d.Mc;h[1]=d.id;h[2]=d.Bh;h[3]=d.hit_fract;h[4]=d.hit_time;a.Od.push(h.buffer);break;case n:d=B;h=new Float32Array(d.len);h[0]=d.Mc;h[1]=d.id;h[2]=d.Bh;h[3]=d.hit_fract;h[4]=d.hit_time;h[5]=d.hit_pos[0];h[6]=d.hit_pos[1];h[7]=d.hit_pos[2];h[8]=d.hit_norm[0];h[9]=d.hit_norm[1];
h[10]=d.hit_norm[2];a.Od.push(h.buffer);break;case b:d=H;h=new Float32Array(d.len);h[0]=d.Mc;h[1]=d.jg;h[2]=d.kg;h[3]=d.result;a.Od.push(h.buffer);break;case l:d=u;h=new Float32Array(d.len);h[0]=d.Mc;h[1]=d.jg;h[2]=d.kg;h[3]=d.result;h[4]=d.og[0];h[5]=d.og[1];h[6]=d.og[2];h[7]=d.coll_norm[0];h[8]=d.coll_norm[1];h[9]=d.coll_norm[2];h[10]=d.coll_dist;a.Od.push(h.buffer);break;case e:d=D;h=new Float32Array(d.len);h[0]=d.Mc;h[1]=d.v;h[2]=d.i[0];h[3]=d.i[1];h[4]=d.i[2];h[5]=d.quat[0];h[6]=d.quat[1];h[7]=
d.quat[2];h[8]=d.quat[3];a.Od.push(h.buffer);break;default:h=[];for(d=1;d<arguments.length;d++)h.push(arguments[d]);a.bg.postMessage(h)}};a.eC=function(a){a&&a.Od.length&&(a.bg.postMessage(a.Od),a.Od.length=0)};a.hs=function(a){switch(a){case r:return p;case f:return w;case k:return C;case n:return B;case b:return H;case l:return u;case e:return D;default:return null}};a.terminate=function(a){a.bg.terminate();a.bg=null};a.Dl=function(a){return!!a.bg};a.Hs=function(a){return!!a.ze}};b4w.module.__hud=function(a,q){function d(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function c(a){b(' SCENE "'+a.name+'"');if(a.k){var c=0,d=0;n.W(a.k.nb,function(a,e){if("SINK"==e.type)b(" (F)",e.type);else{var f=e.type,h=Math.round(e.j.width)+"x"+Math.round(e.j.height),g=e.o.length,l=e.mj;"MAIN_CUBE_REFLECT"==e.type&&(g*=6);var v=e.enqueue&&e.cb;v?b(" (A)",f,e.Bf,h,l,"of",g):b(" (P)",f,e.Bf,h,l,"of",g);e.mj=0;v&&(c+=g,d+=l)}});return[c,d]}b("No INFO")}
function b(){for(var a=80+20*g[0],b=arguments[0],c=1;c<arguments.length;c++){for(var d="",f=0;f<r[c]-String(arguments[c]).length;f++)d+=" ";b+=d+arguments[c]}g[0]++;e.fillText(b,30,a)}function l(a,b,c){b*=a.Na;c.x=a.x+b;c.y=a.y;c.Na=a.Na-2*b;c.Fa=a.Fa}function f(a){return a.x+a.Na/2}function k(a){var b=e,c={x:0,y:0,Na:0,Fa:0},d=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.Na=d;c.Fa=b;l(c,.01,c);d=.02*c.Fa;c.x=c.x;c.y+=d;c.Na=c.Na;c.Fa-=2*d;d=c.Na/8;c.x+=d*a;c.y=c.y;c.Na=d;c.Fa=c.Fa;l(c,.02,c);return c}
var n=q("__graph");q("__print");var r=[5,19,3,10,4,3,5],e=null,g=[0,0];a.init=function(a){a=a.getContext("2d");d(a);return e=a};a.Ji=function(){e&&d(e)};a.reset=function(){var a=e;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),g[0]=0,g[1]=0)};a.hD=function(a,d){var f=e;if(f){f.textAlign="left";f.fillStyle="rgba(0,255,0,255)";b(" FPS",(1/d).toFixed(2));g[0]++;for(var l=f=0,n=0;n<a.length;n++){var k=c(a[n]),f=f+k[0],l=
l+k[1];g[0]++}b(" -----------------------------------------------");b("    ","TOTAL ACTIVE","","",l,"of",f)}};a.print=function(){var a=e;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",b.apply(Math,arguments))};a.plot_array=function(a,b,c,d,g,l,n){var r=e;if(r){b=k(b);var G=b.Fa/5;b.x=b.x;b.y+=4*G;b.Na=b.Na;b.Fa=G;r.textAlign="center";r.fillStyle="#00FF00";e.fillText(a,f(b),b.y-10);r.strokeStyle="#00FF00";r.lineWidth=.5;r.beginPath();r.moveTo(b.x,b.y);r.lineTo(b.x+b.Na,b.y);r.lineTo(b.x+b.Na,
b.y+b.Fa);r.lineTo(b.x,b.y+b.Fa);r.closePath();r.stroke();if(!l&&!n)for(l=1E6,n=-1E6,a=0;a<c.length;a++)l=Math.min(l,c[a]),n=Math.max(n,c[a]);r.textAlign="right";e.fillText(String(l),b.x-10,b.y+b.Fa);e.fillText(String(n),b.x-10,b.y);r.textAlign="center";e.fillText(String(d),b.x,b.y+b.Fa+15);e.fillText(String(g),b.x+b.Na,b.y+b.Fa+15);r.strokeStyle="#FF0000";r.lineWidth=1.5;r.beginPath();d=b.Na/(c.length-1);n=b.Fa/(n-l);for(a=0;a<c.length;a++)g=b.x+d*a,G=b.y+b.Fa-(c[a]-l)*n,0==a?r.moveTo(g,G):r.lineTo(g,
G);r.stroke()}};a.draw_mixer_strip=function(a,b,c,d,g,l,n){var r=e;if(r)for(r.textAlign="center",r.fillStyle="#00FF00",r.font="bold 12px Courier",c=k(c),e.fillText(b?"["+a+"]":a,f(c),c.y),0<=l&&e.fillText(l?"[M]":"[ ]",f(c)-15,c.y+30),0<=n&&e.fillText(n?"[S]":"[ ]",f(c)+15,c.y+30),a={x:0,y:0,Na:0,Fa:0},b=0;b<d.length;b++){l=d[b];var G="VOLUME"==l[0];if(G){n=c.y+350;var v=c.Na,m=a;m.x=c.x;m.y=n;m.Na=v;m.Fa=250}else{n=c.y+10+50*b;var v=c.Na,m=c.Fa,t=a;t.x=c.x;t.y=n;t.Na=v;t.Fa=m}n=r;var v=a,t=b==g,
z=l[0],m=l[1],L=l[2],A=l[3],J=(A-L)/l[4],J=1>J?Math.floor(1/J-1E-5).toFixed(0).length:0;l=l[5]?Math.log(m/L)/Math.log(A/L):(m-L)/(A-L);n.textAlign="center";t?n.fillText("["+z+"]",f(v),v.y):n.fillText(z,f(v),v.y);n.strokeStyle="#00FF00";n.lineWidth=G?3:1;G?(n.textAlign="right",n.fillText(A.toFixed(J),f(v)-10,v.y+15),n.textAlign="right",n.fillText(L.toFixed(J),f(v)-10,v.y+v.Fa-15)):(n.textAlign="right",n.fillText(L.toFixed(J),v.x+28,v.y+15),n.textAlign="left",n.fillText(A.toFixed(J),v.x+v.Na-28,v.y+
15));n.beginPath();if(G){var N=v.y+15+(v.Fa-30)*(1-l);n.moveTo(f(v),v.y+15);n.lineTo(f(v),v.y+v.Fa-15);n.moveTo(f(v)-5,v.y+15);n.lineTo(f(v)+5,v.y+15);n.moveTo(f(v)-5,v.y+v.Fa-15);n.lineTo(f(v)+5,v.y+v.Fa-15);n.moveTo(f(v)-5,N);n.lineTo(f(v)+5,N)}else{var M=v.x+30+(v.Na-60)*l;n.moveTo(v.x+30,v.y+15);n.lineTo(v.x+v.Na-30,v.y+15);n.moveTo(v.x+30,v.y+15-5);n.lineTo(v.x+30,v.y+15+5);n.moveTo(v.x+v.Na-30,v.y+15-5);n.lineTo(v.x+v.Na-30,v.y+15+5);n.moveTo(M,v.y+15-5);n.lineTo(M,v.y+15+5)}n.stroke();"EQ_Q"==
z?(l=Math.log(1+1/(2*m*m)+Math.sqrt((2+1/(m*m))*(2+1/(m*m))/4-1))/Math.log(2),G?(n.textAlign="left",n.fillText(m.toFixed(J),f(v)+10,N),n.textAlign="left",n.fillText("("+l.toFixed(J+1)+")",f(v)+10,N+10)):(n.textAlign="right",n.fillText(m.toFixed(J),M,v.y+30),n.textAlign="left",n.fillText("("+l.toFixed(J+1)+")",M,v.y+30))):G?(n.textAlign="left",n.fillText(m.toFixed(J),f(v)+10,N)):(n.textAlign="center",n.fillText(m.toFixed(J),M,v.y+30))}}};b4w.module.__renderer=function(a,q){function d(a){for(var c=a.j,d=a.o,e=0;e<d.length;e++){var f=d[e];if(f.cb){var g=a,n=c,p=f.zd,k=f.D,M=k.ic;u.useProgram(M.ak);for(var f=k.R,y=k.Eq,w=M.Ku,x=w.length;x--;){var r=w[x];r.Un(u,r.Pg,g,p,k,n)}n=k.fr;u.colorMask(n,n,n,n);u.depthMask(k.ca);k.Ua?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE);n=k.S;for(k=0;k<n.length;k++)w=n[k],u.activeTexture(u.TEXTURE0+k),u.bindTexture(w.ac,w.kb);if("SKY"==g.type){n=g;M=M.mk;k=n.j.pb.kb;w=n.lj;for(x=0;6>x;x++)if(r=l(x),h.mn?
(u.bindTexture(u.TEXTURE_CUBE_MAP,k),u.texImage2D(r,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,H)):(u.uniformMatrix4fv(M.u_cube_view_matrix,!1,w[x]),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,r,k,0),b(f,y,p.Up)),n.Ol&&3!=x){var r=n,T=x,C=D;h.mn?C.set(H):(u.readPixels(191,191,1,1,u.RGBA,u.UNSIGNED_BYTE,C),255!=C[0]&&255!=C[1]&&255!=C[2]||u.readPixels(191,220,1,1,u.RGBA,u.UNSIGNED_BYTE,C));var q=C[0],B=C[1],C=C[2],q=q/255,B=B/255,C=C/255;2===T?(r.Ec[3]=q,r.Ec[7]=B,r.Ec[11]=C):2>T?(r.Ec[4*T]=
q,r.Ec[4*T+1]=B,r.Ec[4*T+2]=C):(r.Ec[4*(T-2)]=q,r.Ec[4*(T-2)+1]=B,r.Ec[4*(T-2)+2]=C)}g.mj+=6}else b(f,y,p.Up),g.mj++}}}function c(a){if(a){var b=(a.la?u.COLOR_BUFFER_BIT:0)|(a.ua?u.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "MAIN_GLOW":a=B;break;case "SHADOW_CAST":a=p;break;case "DEPTH":a=w;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=C;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=B;break;default:a=h.background_color}}else b=
u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT,a=h.background_color;u.colorMask(!0,!0,!0,!0);u.depthMask(!0);u.clearColor(a[0],a[1],a[2],a[3]);u.clear(b)}function b(a,b,c){u.bindBuffer(u.ARRAY_BUFFER,a.Vf);for(var d=0;d<b.length;d++){var e=b[d];u.enableVertexAttribArray(e.Pg);u.vertexAttribPointer(e.Pg,e.Wd,u.FLOAT,!1,0,e.xx+e.Cz*c)}a.Ce?(u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a.Ce),u.drawElements(a.mode,a.count,a.ko,0)):u.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)e=b[d],u.disableVertexAttribArray(e.Pg)}
function l(a){switch(a){case 0:return u.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return u.TEXTURE_CUBE_MAP_NEGATIVE_X;case 2:return u.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return u.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return u.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return u.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function f(a){var b=a.mk,c=[],d=[],e={},f;for(f in b){var h=!1;switch(f){case "u_proj_matrix":var g=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.Aa)},h=!0;break;case "u_view_matrix":case "u_view_matrix_frag":g=
function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.za)};h=!0;break;case "u_shadow_cast_billboard_view_matrix":g=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.du)};h=!0;break;case "u_view_proj_prev":g=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.kC)};h=!0;break;case "u_view_proj_inverse":g=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.Oi)};h=!0;break;case "u_sky_vp_inverse":g=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.Zd)};h=!0;break;case "u_camera_eye":case "u_camera_eye_frag":g=function(a,
b,c,d,e,h){a.uniform3fv(b,h.of)};h=!0;break;case "u_camera_eye_last":g=function(a,b,c,d,e,h){a.uniform3fv(b,h.Mr)};h=!0;break;case "u_camera_quat":g=function(a,b,c,d,e,h){a.uniform4fv(b,h.quat)};h=!0;break;case "u_view_max_depth":g=function(a,b,c,d,e,h){a.uniform1f(b,h.eb)};h=!0;break;case "u_camera_range":g=function(a,b,c,d,e,h){a.uniform2f(b,h.gb,h.eb)};break;case "u_csm_center_dists":g=function(a,b,c,d,e,h){a.uniform4fv(b,h.tr)};break;case "u_cam_water_depth":g=function(a,b,c){a.uniform1f(b,c.jn)};
h=!0;break;case "u_waves_height":g=function(a,b,c){a.uniform1f(b,c.ag)};break;case "u_waves_length":g=function(a,b,c){a.uniform1f(b,c.uh)};break;case "u_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.bc)};break;case "u_fog_params":g=function(a,b,c){a.uniform4fv(b,c.sl)};break;case "u_underwater_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.Hd)};break;case "u_bloom_key":g=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":g=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};
break;case "u_time":g=function(a,b,c){a.uniform1f(b,c.time)};h=!0;break;case "u_wind":g=function(a,b,c){a.uniform3fv(b,c.Ve)};break;case "u_sky_tex_dvar":g=function(a,b,c){a.uniform1f(b,c.ku)};break;case "u_sky_tex_fac":g=function(a,b,c){a.uniform4fv(b,c.lu)};break;case "u_sky_tex_color":g=function(a,b,c){a.uniform3fv(b,c.ju)};break;case "u_horizon_color":g=function(a,b,c){a.uniform3fv(b,c.tf)};break;case "u_zenith_color":g=function(a,b,c){a.uniform3fv(b,c.cg)};break;case "u_environment_energy":g=
function(a,b,c){a.uniform1f(b,c.nf)};break;case "u_sky_color":g=function(a,b,c){a.uniform3fv(b,c.si)};break;case "u_rayleigh_brightness":g=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":g=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":g=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":g=function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":g=function(a,b,c){a.uniform1f(b,
c.rayleigh_strength)};break;case "u_mie_strength":g=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":g=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":g=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":g=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;case "u_light_positions":g=function(a,b,c){a.uniform3fv(b,c.wf)};break;case "u_light_directions":g=function(a,b,c){a.uniform3fv(b,
c.Mg)};break;case "u_light_color_intensities":g=function(a,b,c){a.uniform3fv(b,c.Lg)};break;case "u_light_factors":g=function(a,b,c){a.uniform4fv(b,c.Ng)};break;case "u_sun_quaternion":g=function(a,b,c){a.uniform4fv(b,c.Du)};break;case "u_sun_intensity":g=function(a,b,c){a.uniform3fv(b,c.Cu)};break;case "u_sun_direction":g=function(a,b,c){a.uniform3fv(b,c.zp)};break;case "u_height":g=function(a,b,c,d,e,h){a.uniform1f(b,h.height)};h=!0;break;case "u_model_matrix":g=function(a,b,c,d){a.uniformMatrix4fv(b,
!1,d.Z)};h=!0;break;case "u_transb":g=function(a,b,c,d){a.uniform4fv(b,d.Xc)};h=!0;break;case "u_transa":g=function(a,b,c,d){a.uniform4fv(b,d.Wc)};h=!0;break;case "u_arm_rel_trans":g=function(a,b,c,d){a.uniform4fv(b,d.Sm)};h=!0;break;case "u_arm_rel_quat":g=function(a,b,c,d){a.uniform4fv(b,d.Rm)};h=!0;break;case "u_quat":g=function(a,b,c,d){a.uniform4fv(b,d.quat)};h=!0;break;case "u_quatsb":g=function(a,b,c,d){a.uniform4fv(b,d.Qc)};h=!0;break;case "u_quatsa":g=function(a,b,c,d){a.uniform4fv(b,d.Pc)};
h=!0;break;case "u_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.Ag)};h=!0;break;case "au_center_pos":g=function(){};h=!0;break;case "au_wind_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.ge)};h=!0;break;case "au_wind_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.We)};h=!0;break;case "au_detail_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.ue)};h=!0;break;case "au_detail_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.te)};h=!0;break;case "au_branch_bending_amp":g=function(a,b,c,d){a.uniform1f(b,
d.oe)};h=!0;break;case "u_node_values":g=function(a,b,c,d){a.uniform1fv(b,d.He)};h=!0;break;case "u_node_rgbs":g=function(a,b,c,d){a.uniform3fv(b,d.Lc)};h=!0;break;case "u_diffuse_color":g=function(a,b,c,d,e){a.uniform4fv(b,e.ed)};h=!0;break;case "u_diffuse_intensity":g=function(a,b,c,d,e){a.uniform1f(b,e.lf)};h=!0;break;case "u_diffuse_params":g=function(a,b,c,d,e){a.uniform2fv(b,e.Gc)};h=!0;break;case "u_emit":g=function(a,b,c,d,e){a.uniform1f(b,e.ye)};h=!0;break;case "u_ambient":g=function(a,b,
c,d,e){a.uniform1f(b,e.le)};h=!0;break;case "u_specular_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.$d)};h=!0;break;case "u_specular_alpha":g=function(a,b,c,d,e){a.uniform1f(b,e.rp)};h=!0;break;case "u_specular_params":g=function(a,b,c,d,e){a.uniform3fv(b,e.xc)};h=!0;break;case "u_reflect_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.reflect_factor)};h=!0;break;case "u_mirror_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Jo)};h=!0;break;case "u_grass_map_dim":g=function(a,b,c,d,e){a.uniform3fv(b,
e.nc)};h=!0;break;case "u_grass_size":g=function(a,b,c,d,e){a.uniform1f(b,e.co)};h=!0;break;case "u_scale_threshold":g=function(a,b,c,d,e){a.uniform1f(b,e.os)};h=!0;break;case "u_cube_fog":g=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.Ec)};break;case "u_jitter_amp":g=function(a,b,c,d,e){a.uniform1f(b,e.Ns)};h=!0;break;case "u_jitter_freq":g=function(a,b,c,d,e){a.uniform1f(b,e.Os)};h=!0;break;case "u_wireframe_mode":g=function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":g=
function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":g=function(a,b,c){a.uniform2fv(b,c.WA)};h=!0;break;case "u_subsample_indices":g=function(a,b,c){a.uniform4fv(b,c.XA)};h=!0;break;case "u_refr_bump":g=function(a,b,c,d,e){a.uniform1f(b,e.Nt)};h=!0;break;case "u_lamp_light_positions":g=function(a,b,c,d,e){a.uniform3fv(b,e.xo)};break;case "u_lamp_light_directions":g=function(a,b,c,d,e){a.uniform3fv(b,e.vo)};break;case "u_lamp_light_color_intensities":g=function(a,
b,c,d,e){a.uniform3fv(b,e.uo)};break;case "u_lamp_light_factors":g=function(a,b,c,d,e){a.uniform4fv(b,e.wo)};break;case "u_halo_size":g=function(a,b,c,d,e){a.uniform1f(b,e.us)};h=!0;break;case "u_halo_hardness":g=function(a,b,c,d,e){a.uniform1f(b,e.rs)};h=!0;break;case "u_halo_rings_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.ts)};h=!0;break;case "u_halo_lines_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.ss)};h=!0;break;case "u_halo_stars_blend":g=function(a,b,c,d,e){a.uniform1f(b,e.vs)};h=!0;
break;case "u_halo_stars_height":g=function(a,b,c,d,e){a.uniform1f(b,e.ws)};h=!0;break;case "u_fresnel_params":g=function(a,b,c,d,e){a.uniform4fv(b,e.xd)};h=!0;break;case "u_texture_scale":g=function(a,b,c,d,e){a.uniform3fv(b,e.Sf)};h=!0;break;case "u_parallax_scale":g=function(a,b,c,d,e){a.uniform1f(b,e.parallax_scale)};h=!0;break;case "u_color_id":g=function(a,b,c,d){a.uniform3fv(b,d.Zk)};h=!0;break;case "u_line_points":g=function(a,b,c,d,e){a.uniform3fv(b,e.VG)};h=!0;break;case "u_diffuse_color_factor":g=
function(a,b,c,d,e){a.uniform1f(b,e.kf)};h=!0;break;case "u_alpha_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.bf)};h=!0;break;case "u_specular_color_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.qu)};h=!0;break;case "u_normal_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.it)};h=!0;break;case "u_normalmap0_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Xg[0])};h=!0;break;case "u_normalmap1_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Xg[1])};h=!0;break;case "u_normalmap2_scale":g=function(a,b,c,
d,e){a.uniform2fv(b,e.Xg[2])};h=!0;break;case "u_normalmap3_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Xg[3])};h=!0;break;case "u_foam_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.foam_factor)};h=!0;break;case "u_foam_uv_freq":g=function(a,b,c,d,e){a.uniform2fv(b,e.Qr)};h=!0;break;case "u_foam_mag":g=function(a,b,c,d,e){a.uniform2fv(b,e.Pr)};h=!0;break;case "u_foam_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Pn)};h=!0;break;case "u_water_norm_uv_velocity":g=function(a,b,c,d,e){a.uniform1f(b,
e.Pi)};h=!0;break;case "u_shallow_water_col":g=function(a,b,c,d,e){a.uniform3fv(b,e.shallow_water_col)};h=!0;break;case "u_shore_water_col":g=function(a,b,c,d,e){a.uniform3fv(b,e.shore_water_col)};h=!0;break;case "u_water_shallow_col_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.shallow_water_col_fac)};h=!0;break;case "u_water_shore_col_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.shore_water_col_fac)};h=!0;break;case "u_p_length":g=function(a,b,c,d,e){a.uniform1f(b,e.ra.Hu)};h=!0;break;case "u_p_cyclic":g=
function(a,b,c,d,e){a.uniform1i(b,e.ra.cyclic)};h=!0;break;case "u_p_max_lifetime":g=function(a,b,c,d,e){a.uniform1f(b,e.ra.Us)};h=!0;break;case "u_p_fade_in":g=function(a,b,c,d,e){a.uniform1f(b,e.ra.xg)};h=!0;break;case "u_p_fade_out":g=function(a,b,c,d,e){a.uniform1f(b,e.ra.Hc)};h=!0;break;case "u_p_size":g=function(a,b,c,d,e){a.uniform1f(b,e.ra.size)};h=!0;break;case "u_p_alpha_start":g=function(a,b,c,d,e){a.uniform1f(b,e.ra.xq)};h=!0;break;case "u_p_alpha_end":g=function(a,b,c,d,e){a.uniform1f(b,
e.ra.wq)};h=!0;break;case "u_p_nfactor":g=function(a,b,c,d,e){a.uniform1f(b,e.ra.Oo)};h=!0;break;case "u_p_gravity":g=function(a,b,c,d,e){a.uniform1f(b,e.ra.ps)};h=!0;break;case "u_p_mass":g=function(a,b,c,d,e){a.uniform1f(b,e.ra.Vd)};h=!0;break;case "u_p_size_ramp":g=function(a,b,c,d,e){a.uniform2fv(b,e.ra.fu)};h=!0;break;case "u_p_color_ramp":g=function(a,b,c,d,e){a.uniform4fv(b,e.ra.gr)};h=!0;break;case "u_p_wind_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.ra.jv)};h=!0;break;case "u_texel_size":g=
function(a,b,c){a.uniform2fv(b,c.Gp)};h=!0;break;case "u_p_time":g=function(a,b,c,d,e){a.uniform1f(b,e.ra.time)};h=!0;break;case "u_position":g=function(a,b,c,d,e){a.uniform3fv(b,e.ji)};h=!0;break;case "u_va_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.Yu)};h=!0;break;case "u_perspective_cast_far_bound":g=function(a,b,c){a.uniform1f(b,c.TB)};break;case "u_normal_offset":g=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":g=function(a,b,c,d,e,h){a.uniform4fv(b,
h.bm)};break;case "u_v_light_matrix":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Xu)};h=!0;break;case "u_b_light_matrix":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Jq)};break;case "u_p_light_matrix0":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ah[0])};h=!0;break;case "u_p_light_matrix1":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ah[1])};h=!0;break;case "u_p_light_matrix2":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ah[2])};h=!0;break;case "u_p_light_matrix3":g=function(a,b,c){a.uniformMatrix4fv(b,
!1,c.ah[3])};h=!0;break;case "u_motion_blur_exp":g=function(a,b,c){a.uniform1f(b,c.ct)};h=!0;break;case "u_motion_blur_decay_threshold":g=function(a,b,c){a.uniform1f(b,c.mb_decay_threshold)};h=!0;break;case "u_refl_plane":g=function(a,b,c,d){a.uniform4fv(b,d.gc)};h=!0;break;case "u_radial_blur_step":g=function(a,b,c){a.uniform1f(b,c.hm)};break;case "u_god_rays_intensity":g=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":g=function(a,b,c){a.uniform1f(b,c.xi)};
break;case "u_ssao_blur_discard_value":g=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};h=!0;break;case "u_ssao_influence":g=function(a,b,c){a.uniform1f(b,c.wi)};break;case "u_ssao_dist_factor":g=function(a,b,c){a.uniform1f(b,c.vi)};break;case "u_dof_dist":g=function(a,b,c,d,e,h){a.uniform1f(b,h.dof_distance)};h=!0;break;case "u_dof_front":g=function(a,b,c,d,e,h){a.uniform1f(b,h.dof_front)};h=!0;break;case "u_dof_rear":g=function(a,b,c,d,e,h){a.uniform1f(b,h.dof_rear)};h=!0;break;case "u_outline_intensity":g=
function(a,b,c,d){a.uniform1f(b,d.Ad)};h=!0;break;case "u_outline_color":g=function(a,b,c){a.uniform3fv(b,c.Ef)};break;case "u_draw_outline":g=function(a,b,c){a.uniform1f(b,c.Gn)};h=!0;break;case "u_glow_mask_small_coeff":g=function(a,b,c){a.uniform1f(b,c.small_glow_mask_coeff)};h=!0;break;case "u_glow_mask_large_coeff":g=function(a,b,c){a.uniform1f(b,c.large_glow_mask_coeff)};h=!0;break;case "u_brightness":g=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":g=function(a,b,c){a.uniform1f(b,
c.contrast)};break;case "u_exposure":g=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":g=function(a,b,c){a.uniform1f(b,c.saturation)};break;default:g=null}g&&(g={name:f,Un:g,Pg:b[f]},h?c.push(g):(d.push(g),e[f]=g))}a.Ku=c;a.Zj=d;a.Uo=e}var k=q("__camera"),n=q("__config"),r=q("__debug"),e=q("__textures"),g=q("__util"),h=n.q,p=[1,1,1,1],w=[1,1,1,1],C=[0,0,0,1],B=[0,0,0,0],H=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,
1,1,0]);new Float32Array([2,2,2,0]);var u=null,D=new Uint8Array(4);a.Ed=function(a){var b=h.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);u=a};a.sj=function(a){if(a.cb){var b=a.j;u.bindFramebuffer(u.FRAMEBUFFER,b.Ae);if(a.Tm){var e=b.pb;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,e.ac,e.kb,0)}u.viewport(0,
0,b.width,b.height);"MAIN_CUBE_REFLECT"!=a.type&&c(a);a.Ha?u.enable(u.BLEND):u.disable(u.BLEND);a.Lb?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST);if(a.wa){for(var b=a.j,e=a.o,g=0;g<e.length;g++){var n=e[g],p=n.D,w=p.ic;u.useProgram(w.ak);n=n.zd;w.Zj.length||f(w);for(var w=w.Zj,D=w.length;D--;){var C=w[D];C.Un(u,C.Pg,a,n,p,b)}}a.wa=!1}switch(a.type){case "DEPTH":h.Es?(u.enable(u.POLYGON_OFFSET_FILL),u.polygonOffset(5,5)):u.disable(u.POLYGON_OFFSET_FILL);u.cullFace(u.BACK);break;case "SHADOW_CAST":u.enable(u.POLYGON_OFFSET_FILL);
u.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);u.cullFace(u.BACK);break;case "MAIN_PLANE_REFLECT":u.disable(u.POLYGON_OFFSET_FILL);u.cullFace(u.FRONT);break;default:u.disable(u.POLYGON_OFFSET_FILL),u.cullFace(u.BACK)}if("MAIN_CUBE_REFLECT"==a.type)for(b=a.j,e=b.pb.kb,g=0;6>g;g++){p=l(g);b.za=a.lj[g];k.hn(b);u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,p,e,0);c(a);p=a.o;for(n=0;n<p.length;n++)p[n].cb=p[n].Fn[g];d(a)}else d(a);r.Yx("draw subscene: "+a.type);u.bindFramebuffer(u.FRAMEBUFFER,
null)}};a.clear=function(a){u.bindFramebuffer(u.FRAMEBUFFER,a.j.Ae);c(a)};a.Aq=function(a){var b=a.Eq;b.length=0;var c=a.R;a=a.ic;c&&a||g.ka("Incomplete batch");c=c.Nb;a=a.attributes;for(var d in a){var e=c[d];b.push({Pg:a[d],xx:4*e.offset,Cz:1<e.frames?4*e.length:0,Wd:e.Wd})}};a.vx=f;a.Cq=function(a){var b=a.ic,c=a.S;a=a.Ob;u.useProgram(b.ak);for(var d=0;d<c.length;d++)u.uniform1i(b.mk[a[d]],d)};a.Lt=function(a,b,c,d,e,h){d||(d=1);e||(e=1);h||(h=new Uint8Array(4*d*e));h.length!=4*d*e&&g.ka("read_pixels(): Wrong storage");
u.bindFramebuffer(u.FRAMEBUFFER,a);u.readPixels(b,c,d,e,u.RGBA,u.UNSIGNED_BYTE,h);u.bindFramebuffer(u.FRAMEBUFFER,null);return h};a.YD=function(a){var b=a.ic;u.useProgram(b.ak);b.Zj.length||f(b);b=b.Uo.u_cube_fog;b.Un(u,b.Pg,null,null,a,null)};a.vC=function(a,b){var c=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,c);if(a){var d=a,h=d.kb,d=d.ac==u.TEXTURE_CUBE_MAP?u.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.ac;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,d,h,0)}e.Js(b)?u.framebufferRenderbuffer(u.FRAMEBUFFER,
u.DEPTH_ATTACHMENT,u.RENDERBUFFER,b.Yf):e.Nj(b)&&(d=b,h=d.kb,d=d.ac,u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,d,h,0));r.Tx();u.bindFramebuffer(u.FRAMEBUFFER,null);return c};a.uC=function(a,b,c,d,h){null==a?(u.bindFramebuffer(u.FRAMEBUFFER,a),u.viewport(0,0,d,h),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT)):(e.Nj(b)&&u.deleteTexture(b.kb),e.Js(c)?u.deleteRenderbuffer(c.Yf):e.Nj(c)&&u.deleteTexture(c.kb),u.deleteFramebuffer(a))};a.HG=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,q){function d(a,b,d){var e=a.mf;"string"==typeof d&&(a=c(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==b){e[a][1]=d;return}e.push([b,d])}function c(a,b){for(var c=a.mf,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function b(a,b){var c=a+b;if(u[c])return u[c];if(D){var d=D[b];if(!d)return null;d=q("__gpp_parser").dH.parse(d)}else if(d=q("shader_texts")[b],!d)return null;return u[c]=d}function l(a,c,d){function e(c){c=c.a;for(var d=0;d<c.length;d++){var l=
c[d];switch(l.type){case "condition":a:for(var l=l.a,t=0;t<l.length;t++){var A=l[t];switch(A.type){case "if":case "elif":if(h(A.c)){e(A.group);break a}break;case "else":e(A.group);break a;case "ifdef":A.name in x&&e(A.group);break;case "ifndef":A.name in x||e(A.group)}}break;case "include":l=b(B.shaders_dir,B.fD+l.file);e(l);break;case "var":case "export":case "import":break;case "define":t=l.name;x[t]=l.b;l.O&&(p[t]=l.O);break;case "error":throw"Shader error: #error "+l.b.join(" ");case "line":break;
case "pragma":n.push("#pragma "+l.name+" "+l.b.join(" "));break;case "undef":l=l.name;delete x[l];delete p[l];break;case "warning":w.warn("Shader warning: #warning "+l.b.join(" "));break;case "extension":l=f(l.b,x,p,!1);n.push("#extension "+l.join(" "));break;case "#":break;case "node":k[l.name]=l;break;case "nodes_global":l=m;for(t=0;t<l.length;t++){var A=l[t],S=k[A.id];if(S)for(var D=0,F=0;F<S.h.length;F++){var I=S.h[F];"node_param"==I.type&&(I=I.qualifier.join(" ")+" ","vert"==a?I+=A.Xf[D]:"frag"==
a&&(I+=A.O[D],null!==A.Zl[D]&&(I+=" = "+A.Zl[D])),I+=";",n.push(I),D++)}}break;case "nodes_main":l=m;for(t=0;t<l.length;t++)if(A=l[t],S=k[A.id]){D={};F={};for(I=0;I<A.fd.length;I++)F[A.fd[I][0]]=[A.fd[I][1]];G=u=r=0;for(var I=A,da=S.h,P=D,C=F,H=0;H<da.length;H++){var L=da[H];switch(L.type){case "node_in":var q=I.C[r];if(null!==I.oo[r]){if(("MATERIAL_BEGIN"==I.id&&3===r||!C.MATERIAL_EXT&&("MATERIAL_BEGIN"==I.id&&4===r||"MATERIAL_END"==I.id&&3===r||"MATERIAL_END"==I.id&&4===r||"MATERIAL_END"==I.id&&
5===r)||"TEXTURE_COLOR"==I.id||"TEXTURE_NORMAL"==I.id)&&L.e){P[L.name]=I.oo[r];r++;continue}var Y=L.qualifier.join(" ")+" ",Y=Y+q,Y=Y+(" = "+I.oo[r]),Y=Y+";";n.push(Y)}P[L.name]=q;r++;break;case "node_out":q=I.qa[u];if(!L.e||-1<v.indexOf(q))Y=L.qualifier.join(" ")+" ",Y+=q,Y+=";",n.push(Y),P[L.name]=q;-1<v.indexOf(q)&&(C["USE_OUT_"+L.name]=[1]);u++;break;case "node_param":"vert"==a?q=I.Xf[G]:"frag"==a&&(q=I.O[G]),P[L.name]=q,G++}}n.push("{");g(A,S.g,D,F);n.push("}")}break;case "textline":l=f(l.b,
x,p,!1);n.push(l.join(" "));break;default:throw"Unknown element type: "+l.type;}}}function h(a,b){var c;c=f(a,x,p,!0,b);for(var d=[],e=0;e<c.length;e++)if(c[e]instanceof Object)switch(c[e].type){case "conditional_expr":var g=d.pop(),m=d.pop();d.pop()?d.push(m):d.push(g);break;case "logical_or_expr":g=d.pop();for(m=0;m<c[e].d-1;m++)y=d.pop(),g=g||y;d.push(g);break;case "logical_and_expr":g=d.pop();for(m=0;m<c[e].d-1;m++)y=d.pop(),g=g&&y;d.push(g);break;case "logical_bitor_expr":g=d.pop();for(m=0;m<
c[e].d-1;m++)g|=d.pop();d.push(g);break;case "logical_bitxor_expr":g=d.pop();for(m=0;m<c[e].d-1;m++)g^=d.pop();d.push(g);break;case "logical_bitand_expr":g=d.pop();for(m=0;m<c[e].d-1;m++)g&=d.pop();d.push(g);break;case "equal_expr":g=d.pop();m=d.pop();d.push(m==g);break;case "non_equal_expr":g=d.pop();m=d.pop();d.push(m!=g);break;case "le_expr":g=d.pop();m=d.pop();d.push(m<=g);break;case "ge_expr":g=d.pop();m=d.pop();d.push(m>=g);break;case "l_expr":g=d.pop();m=d.pop();d.push(m<g);break;case "g_expr":g=
d.pop();m=d.pop();d.push(m>g);break;case "left_shift_expr":m=d.pop();g=d.pop();d.push(m<<g);break;case "right_shift_expr":m=d.pop();g=d.pop();d.push(m>>g);break;case "add_expr":m=d.pop();g=d.pop();d.push(m+g);break;case "sub_expr":m=d.pop();g=d.pop();d.push(m-g);break;case "mul_expr":m=d.pop();g=d.pop();d.push(m*g);break;case "div_expr":m=d.pop();g=d.pop();d.push(m/g);break;case "mod_expr":m=d.pop();g=d.pop();d.push(m%g);break;case "pre_inc_expr":case "post_inc_expr":y=d.pop();d.push(++y);break;case "pre_dec_expr":case "post_dec_expr":y=
d.pop();d.push(--y);break;case "positive_expr":y=d.pop();d.push(+y);break;case "negative_expr":y=d.pop();d.push(-y);break;case "one_compl_expr":y=d.pop();d.push(~y);break;case "logic_negative_expr":y=d.pop();d.push(!y);break;default:C.ka("Unknown operation type: "+c[e].type)}else{var y=c[e];/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(y)?d.push(0):d.push(parseFloat(c[e]))}1==d.length?c=d[0]:(C.ka("Incorrect expression: "+c.join(" ")),c=void 0);return c}function g(a,b,c,d){for(var e=0;e<b.length;e++){var m=b[e];
switch(m.type){case "node_condition":a:for(var y=a,m=m.a,l=c,k=d,v=0;v<m.length;v++){var w=m[v];switch(w.type){case "node_if":case "node_elif":if(h(w.c,k)){g(y,w.g,l,k);break a}break;case "node_else":g(y,w.g,l,k);break a;case "node_ifdef":(w.name in x||w.name in k)&&g(y,w.g,l,k);break;case "node_ifndef":w.name in x||w.name in k||g(y,w.g,l,k)}}break;case "textline":y=[];for(l=0;l<m.b.length;l++)k=m.b[l],k in c?y.push(c[k]):y.push(k);y=f(y,x,p,!0,d);n.push(y.join(" "))}}}var m=d.Af;d=d.mf||[];for(var n=
[],x={},l=0;l<d.length;l++)x[d[l][0]]=[d[l][1]];for(l=0;l<m.length;l++)x["USE_NODE_"+m[l].id]=[1];var p={},k={},v=[];for(l in m)for(var t in m[l].C)v.push(m[l].C[t]);e(c);var r=0,u=0,G=0;return n.join("\n")}function f(a,b,c,d,e){var h=[];k(a,b,c,d,h,e);return h}function k(a,b,c,d,e,h){for(var f=0;f<a.length;f++){var g=a[f];g in b||h&&g in h?(g=h&&h[g]||b[g],0==g.length&&d?e.push(0):k(g,b,c,d,e,h)):e.push(g)}}function n(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);p.Zx(d,b,c);
return d}function r(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return e(a);case 2:return"vec2("+e(a[0])+","+e(a[1])+")";case 3:return"vec3("+e(a[0])+","+e(a[1])+","+e(a[2])+")";case 4:return"vec4("+e(a[0])+","+e(a[1])+","+e(a[2])+","+e(a[3])+")";case 9:return"mat3("+e(a[0])+","+e(a[1])+","+e(a[2])+","+e(a[3])+","+e(a[4])+","+e(a[5])+","+e(a[6])+","+e(a[7])+","+e(a[8])+")";case 16:return"mat4("+e(a[0])+","+e(a[1])+","+e(a[2])+","+e(a[3])+","+e(a[4])+","+e(a[5])+","+e(a[6])+","+e(a[7])+
","+e(a[8])+","+e(a[9])+","+e(a[10])+","+e(a[11])+","+e(a[12])+","+e(a[13])+","+e(a[14])+","+e(a[15])+")";default:throw"Wrong glsl value dimension";}}function e(a){return a%1?String(a):String(a)+".0"}var g=q("__assets"),h=q("__config"),p=q("__debug"),w=q("__print"),C=q("__util"),B=h.fc,H={},u={},D=null,G="anchors.glslf anchors.glslv color_id.glslf color_id.glslv depth.glslf depth.glslv grass_map.glslf grass_map.glslv halo.glslf halo.glslv main.glslf main.glslv main_stack.glslf main_stack.glslv particles_color.glslf particles_color.glslv particles_texture.glslf particles_texture.glslv procedural_skydome.glslf procedural_skydome.glslv special_lens_flares.glslf special_lens_flares.glslv special_skydome.glslf special_skydome.glslv special_water.glslf special_water.glslv wireframe.glslf wireframe.glslv postprocessing/anaglyph.glslf postprocessing/antialiasing.glslf postprocessing/bloom_combine.glslf postprocessing/compositing.glslf postprocessing/depth_pack.glslf postprocessing/dof.glslf postprocessing/glow.glslf postprocessing/bloom_blur.glslf postprocessing/god_rays.glslf postprocessing/god_rays.glslv postprocessing/god_rays_combine.glslf postprocessing/luminance.glslf postprocessing/luminance_av.glslf postprocessing/luminance_trunced.glslf postprocessing/luminance_trunced.glslv postprocessing/motion_blur.glslf postprocessing/outline.glslf postprocessing/postprocessing.glslf postprocessing/postprocessing.glslv postprocessing/smaa.glslf postprocessing/smaa.glslv postprocessing/ssao.glslf postprocessing/ssao_blur.glslf include/blending.glslf include/caustics.glslf include/depth_fetch.glslf include/dynamic_grass.glslv include/environment.glslf include/fog.glslf include/gamma.glslf include/lighting_nodes.glslf include/math.glslv include/mirror.glslf include/nodes.glslf include/nodes.glslv include/pack.glslf include/particles.glslv include/precision_statement.glslf include/procedural.glslf include/refraction.glslf include/scale_texcoord.glslv include/shadow.glslf include/shadow.glslv include/skin.glslv include/std_enums.glsl include/to_world.glslv include/wind_bending.glslv".split(" "),
v=[],m=null,t=!1;a.Ed=function(a){m=a};a.I=d;a.fA=c;a.OG=function(a,b){for(var c=a.mf,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.MC=function(a){a.mf=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NODES_GLOW NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PERSPECTIVE_SHADOW_CAST PROCEDURAL_FOG PROCEDURAL_SKYDOME REFLECTION REFLECTION_PASS REFLECTION_TYPE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA MTEX_NEGATIVE MTEX_RGBTOINT NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_USAGE POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT USE_FOG WO_SKYBLEND WO_SKYPAPER WO_SKYREAL WO_SKYTEX WOMAP_BLEND WOMAP_HORIZ WOMAP_ZENUP WOMAP_ZENDOWN WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
c=0;c<b.length;c++){var e=b[c],g;switch(e){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "MTEX_NEGATIVE":case "MTEX_RGBTOINT":case "NODES_GLOW":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PERSPECTIVE_SHADOW_CAST":case "PROCEDURAL_FOG":case "PROCEDURAL_SKYDOME":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTION_TYPE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "USE_FOG":case "WO_SKYBLEND":case "WO_SKYPAPER":case "WO_SKYREAL":case "WO_SKYTEX":case "WOMAP_BLEND":case "WOMAP_HORIZ":case "WOMAP_ZENUP":case "WOMAP_ZENDOWN":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":g=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":g=1;break;case "SHADOW_TEX_RES":g=r(2048);break;case "AA_METHOD":g="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":g="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":g="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":g="POST_EFFECT_NONE";break;case "SHADOW_USAGE":g="NO_SHADOWS";break;case "SSAO_QUALITY":g=
"SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":g="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":g="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":g=h.q.precision;break;case "EPSILON":g="highp"==h.q.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":g="u_va_frame_factor";break;default:w.error("Unknown directive ("+a.Ni+", "+a.Nh+"): "+e)}d(a,e,g)}};a.AG=function(a){return a.Ni};a.es=function(a){return a.Nh};a.IG=function(a,b){for(var e=b.mf,h=0;h<e.length;h++){var g=e[h][0],f=
e[h][1];c(a,g)&&d(a,g,f)}};a.bA=function(a){var c=JSON.stringify(a),d=H[c];if(d)return d;var e=a.Nh,d=b(B.shaders_dir,a.Ni),e=b(B.shaders_dir,e);if(!d||!e)return null;var h=l("vert",d,a),g=l("frag",e,a),d=m,f=n(d,c,h,d.VERTEX_SHADER),k=n(d,c,g,d.FRAGMENT_SHADER),e=d.createProgram();d.attachShader(e,f);d.attachShader(e,k);d.linkProgram(e);d.validateProgram(e);d.getProgramParameter(e,d.VALIDATE_STATUS)==d.mF&&w.error("shader program is not valid",c);p.$x(e,c,f,k,h,g);a={Zp:f,Tr:k,ak:e,attributes:{},
mk:{},Zj:[],Uo:{},Ku:[],Xa:a};g=d.getProgramParameter(e,d.ACTIVE_ATTRIBUTES);for(h=0;h<g;h++)f=d.getActiveAttrib(e,h).name,a.attributes[f]=d.getAttribLocation(e,f);g=d.getProgramParameter(e,d.ACTIVE_UNIFORMS);for(h=0;h<g;h++)f=d.getActiveUniform(e,h).name.split("[0]").join(""),a.mk[f]=d.getUniformLocation(e,f);return H[c]=d=a};a.oB=function(){t=!1;if(b4w.module_check("shader_texts"))t=!0;else{for(var a=[],b=g.AT_TEXT,c=0;c<G.length;c++){var d=C.Rj(B.shaders_dir+G[c]);a.push([G[c],b,d])}b=function(a,
b){D||(D={});D[b]=a};a.length?g.enqueue(a,b,function(){t=!0}):w.error("Shaders have not been found.")}};a.ay=function(){return t};a.XF=function(){return v};a.bs=function(){return H};a.cleanup=function(){for(var a in H){var b=H[a];m.deleteProgram(b.ak);m.deleteShader(b.Zp);m.deleteShader(b.Tr);delete H[a]}for(var c in u)delete u[c];for(var d in v)delete v[d]};a.YF=function(a){var b=a.mf;w.log("Shader: "+a.Ni+" "+a.Nh+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)w.log("  "+b[a][0],
b[a][1])};a.r=r;a.br=function(a,b){return b in a.mk?!0:!1};a.vA=function(a){return(m.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,q){function d(a){return 65536<a.P?v.ds()?!1:!0:!1}function c(a){return 0<a.oa.length?!0:!1}function b(a,b,d){if(!c(a))return a;d||m.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.P*(b||1)+", will use drawArrays","color: #aa0");b=a.oa;d=a.P;var e=a.M,h=a.B,g;for(g in e){var f=e[g],n=w(f,d);e[g]=l(b,f,n)}for(e=0;e<h.length;e++){var p=h[e];for(g in p)f=p[g],n=w(f,d),p[g]=l(b,f,n)}for(e=0;e<a.ba.length;e++){g=a.ba[e].cc;for(var k in g)f=g[k],
n=w(f,d),g[k]=l(b,f,n)}a.P=b.length;a.oa=new Uint16Array(0);return a}function l(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var h=a[e],g=0;g<c;g++)d[c*e+g]=b[c*h+g];return d}function f(a,b){var c=a.Yc,d=a.Nb[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function k(b,c){var d,e;switch(c){case a.Ri:case a.zk:d=M.TRIANGLES;e=M.STATIC_DRAW;break;case a.gq:d=M.POINTS;e=M.STATIC_DRAW;
break;case a.yk:d=M.TRIANGLES;e=M.DYNAMIC_DRAW;break;case a.fq:d=M.POINTS;e=M.DYNAMIC_DRAW;break;case a.nv:d=M.LINES;e=M.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.pk=e}function n(a){a.uf?(a.Ce||(a.Ce=M.createBuffer()),M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,a.Ce),M.bufferData(M.ELEMENT_ARRAY_BUFFER,a.uf,a.pk),a.il=a.uf.byteLength):a.il=0;a.Vf||(a.Vf=M.createBuffer());M.bindBuffer(M.ARRAY_BUFFER,a.Vf);M.bufferData(M.ARRAY_BUFFER,a.Yc,a.pk);a.yr=a.Yc.byteLength}function r(a){for(var b=
z.vb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].oa.length;b.oa=new Uint32Array(c);var e=c=0,h=0;if(0<a[0].ba.length)for(var g=0;g<a[0].ba.length;g++){for(d=0;d<a.length;d++)c+=a[d].ba[g].cc.a_position.length,e+=a[d].ba[g].cc.a_normal.length,h+=a[d].ba[g].cc.a_tangent.length;d={a_position:new Float32Array(c),a_normal:new Float32Array(e),a_tangent:new Float32Array(h)};b.ba.push({Cl:a[0].ba[g].Cl,cc:d})}for(d=c=0;d<a.length;d++)c+=a[d].P;b.P=c;var e=a[0],f;for(f in e.M){for(d=c=0;d<
a.length;d++)c+=a[d].M[f].length;b.M[f]=new Float32Array(c)}for(f in e.B[0]){for(d=c=0;d<a.length;d++)c+=a[d].B[0][f].length;for(d=0;d<e.B.length;d++)b.B[d]=b.B[d]||{},b.B[d][f]=new Float32Array(c)}for(f=e=c=0;f<a.length;f++){for(var h=a[f],m=h.oa,g=h.P,l=h.M,d=0;d<m.length;d++)b.oa[c+d]=m[d]+e;var c=c+m.length,n;for(n in l){var m=l[n],p=e*w(m,g);b.M[n].set(m,p)}for(d=0;d<h.B.length;d++){var l=h.B[d],k=b.B[d];for(n in l)m=l[n],p=e*w(m,g),k[n].set(m,p)}e+=g}if(0<b.ba.length)for(f=0;f<b.ba.length;f++)for(n=
b.ba[f].cc,d=h=e=c=0;d<a.length;d++)g=a[d].ba[f].cc,n.a_position.set(g.a_position,c),n.a_normal.set(g.a_normal,e),n.a_tangent.set(g.a_tangent,h),c+=g.a_position.length,e+=g.a_normal.length,h+=g.a_tangent.length;return b}function e(a,c,d,e,f,l){var n=z.vb("SUBMESH_"+a.name+"_"+c),k=a.submeshes[c],v=k.base_length,w=a.materials[c];n.P=v;var t=!1;if(h(d,"a_texcoord")){var r=null,A=a.materials[c];c=a.submeshes[c];if(A.texture_slots.length)switch(A=A.texture_slots[0],A.texture_coords){case "UV":A=a.uv_textures.indexOf(A.uv_layer);
0==A||-1==A?r=new Float32Array(c.texcoord):1==A&&(r=new Float32Array(c.texcoord2));break;case "ORCO":for(var G=a.b4w_bounding_box_source,r=new Float32Array(2*c.base_length),A=(G.max_x+G.min_x)/2,D=(G.max_z+G.min_z)/2,M=G.max_x-G.min_x,G=G.max_z-G.min_z,C=0,H=0;H<c.position.length;H+=3)r[C++]=(c.position[H]-A)/M+.5,r[C++]=(D-c.position[H+2])/G+.5}null===r&&(r=new Float32Array(c.texcoord));c=r}else c=new Float32Array(0);if(h(d,"a_orco_tex_coord")){r=a.b4w_bounding_box_source;A=new Float32Array(3*k.base_length);
D=r.max_x-r.min_x;M=r.max_z-r.min_z;G=r.max_y-r.min_y;for(H=C=0;H<k.position.length;H+=3)0==D?A[C++]=-1:A[C++]=parseFloat(((k.position[H]-r.min_x)/D).toFixed(3)),0==M?A[C++]=-1:A[C++]=parseFloat(((-r.min_z-k.position[H+2])/M).toFixed(3)),0==G?A[C++]=-1:A[C++]=parseFloat(((k.position[H+1]-r.min_y)/G).toFixed(3));r=A}else r=new Float32Array(0);var F,A=k.group;if(h(d,"a_influence")&&e){D=new Float32Array(4*v);M=A.length/v;G=new Float32Array(M);for(C=0;C<M;C++)for(F in G[C]=-1,e)if(H=e[F],H.dv===C){G[C]=
H.nj;break}var I=3<M?M:4;e=new Float32Array(I);F=new Uint32Array(I);for(var C=new Float32Array(4),H=new Float32Array(I),I=new Uint32Array(I),da=new Float32Array(4),P=0;P<v;P++)e.set(H),F.set(I),C.set(da),D.set(p(A,M,P,v,G,e,F,C),4*P)}else D=new Float32Array(0);F=D;e=f?z.ma(f):{};e.a_color={Cg:!0};e.a_color.src=h(d,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,kd:7}]:[];f={a_texcoord:c,a_influence:F,a_orco_tex_coord:r};F=k.vertex_colors;c=k.color;r=a.name;A=[];for(D=0;D<F.length;D++)A.push(F[D].name);
for(var q in e)if(D=e[q].src,D.length){for(G=M=0;G<D.length;G++)M+=z.ih(D[G].kd);f[q]=new Float32Array(M*v);for(G=C=0;G<D.length;G++){var B=D[G].name,H=D[G].kd,I=z.St(H),L=A.indexOf(B);-1==L&&z.ka('vertex color "'+B+'" for mesh "'+r+'" not found.');da=F[L].mask;P=z.ih(da);(H&da)!==H&&m.error("Wrong color extraction from "+B+" to "+q+".");for(var J=B=0;J<L;J++)B+=z.ih(F[J].mask);L=B*v;for(B=0;B<v;B++)for(J=0;3>J;J++)I[J]&&(f[q][B*M+(C+z.ek(H,J))]=c[L+B*P+z.ek(da,J)]);C+=P}}else f[q]=new Float32Array(0);
q=a.uv_textures;e=k.texcoord;F=k.texcoord2;c=a.name;if(l)for(var Y in l){r=q.indexOf(Y);-1==r&&z.ka('uv map "'+Y+'" for mesh "'+c+'" not found');if(0==r)var N=new Float32Array(e);else 1==r&&(N=new Float32Array(F));f[l[Y]]=N}n.M=f;n.oa=new Uint32Array(k.indices);l=k.position.length/v/3;N=(Y=h(d,"a_normal")&&k.normal.length?!0:!1)&&h(d,"a_tangent")&&k.tangent.length?!0:!1;q=w.texture_slots[0];q=Y&&w.texture_slots.length&&h(d,"a_tangent")&&"ORCO"==q.texture_coords&&q.use_map_normal?!0:!1;0<a.b4w_shape_keys.length&&
(t=!0);for(f=0;f<l;f++){w=g(k,d,v,Y,N,q,f,a.name);if(t)if(e={},e.name=a.b4w_shape_keys[f].name,n.ba.push(e),0!=f){e.cc=w;e.Cl=a.b4w_shape_keys[f].value;continue}else e.cc=g(k,d,v,Y,N,q,f,a.name),e.Cl=1;n.B.push(w)}if(1<l&&!t){a=n.B[0];var w={},O;for(O in a)w[O]=new Float32Array(a[O]);n.B.push(w)}h(d,"a_polyindex")&&(b(n,1,!0),n.M.a_polyindex=u(n));return n}function g(a,b,c,d,e,g,f,l){var n={},p=new Float32Array(3*c),k=new Float32Array(d?3*c:0),v=new Float32Array(e||g?4*c:0),w=f*c*3;p.set(a.position.subarray(w,
w+3*c),0);d&&(w=f*c*3,k.set(a.normal.subarray(w,w+3*c),0));if(e)w=f*c*4,v.set(a.tangent.subarray(w,w+4*c),0);else if(g)for(a=v,m.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+l+'". Please add a UV-map.'),l=0;l<c;l++)b=A,d=J,b[0]=k[3*l],b[1]=k[3*l+1],b[2]=k[3*l+2],L.cross(b,z.AXIS_Z,d),0==L.length(d)&&L.cross(b,z.AXIS_X,d),L.normalize(d,d),a[4*l]=d[0],a[4*l+1]=d[1],a[4*l+2]=d[2],a[4*l+3]=1;else if(d&&h(b,"a_tangent"))for(v=new Float32Array(4*c),
c=0;c<v.length;c++)v[c]=1;n.a_position=p;n.a_normal=k;n.a_tangent=v;return n}function h(a,b){return-1<a.indexOf(b)?!0:!1}function p(b,c,d,e,h,g,f,m){for(var l=!0,n=0;n<c;n++){var p=b[n*e+d];if(-1!==p){var k=h[n];-1!==k&&(g[n]=p,f[n]=k,l=!1)}}if(l)return m;C(g,f,a.Im,!1);for(n=b=0;4>n;n++)b+=g[n];if(.01>b)return m;for(n=0;4>n;n++)g[n]/=b;if(.01>Math.abs(g[0]-1))m[0]=f[0]+1;else for(n=0;4>n;n++)m[n]=f[n]+g[n];return m}function w(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+
c+", base length="+b;return d}function C(b,c,d,e){for(var h=b.length,g=h,f=!1,m=e?-1:1;1<g||f;){1<g&&(g=Math.floor(g/1.247330950103979));for(var f=!1,l=0;g+l<h;l++)if(d==a.Im?0>m*(b[l]-b[l+g]):b[l]<b[l+g]&&e)f=b[l],b[l]=b[l+g],b[l+g]=f,f=c[l],c[l]=c[l+g],c[l+g]=f,f=!0}}function B(a,b,c){var d=[],e=[];L.subtract(b,a,d);L.subtract(c,a,e);L.normalize(d,d);L.normalize(e,e);return Math.acos(L.dot(d,e))}function H(a,b,d){b||(b=[]);d=d?a.B[0].a_normal:a.B[0].a_position;if(c(a)){a=a.oa;for(var e=a.length/
3,h=0;h<e;h++){var g=new Float32Array(9),f=a[3*h];g[0]=d[3*f];g[1]=d[3*f+1];g[2]=d[3*f+2];f=a[3*h+1];g[3]=d[3*f];g[4]=d[3*f+1];g[5]=d[3*f+2];f=a[3*h+2];g[6]=d[3*f];g[7]=d[3*f+1];g[8]=d[3*f+2];b[h]=g}}else for(h=0;h<d.length;h++)g=new Float32Array(9),g[0]=d[9*h],g[1]=d[9*h+1],g[2]=d[9*h+2],g[3]=d[9*h+3],g[4]=d[9*h+4],g[5]=d[9*h+5],g[6]=d[9*h+6],g[7]=d[9*h+7],g[8]=d[9*h+8],b[h]=g;return b}function u(a){for(var b=new Float32Array(a.P),c=0;c<a.P;c++)b[c]=c%3;return b}function D(a,b,c){var d=L.dist(a,
b);a=L.dist(a,c);b=L.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}function G(a,b,c,d,e){c-=b;for(var h=0;h<c;h+=d)h%d==e&&vec3.normalize(a.subarray(h+b-e,h+b+1),a.subarray(h+b-e,h+b+1))}var v=q("__extensions"),m=q("__print"),t=q("__tsr"),z=q("__util"),L=q("__vec3"),A=new Float32Array(3),J=new Float32Array(3),N=new Float32Array(3);a.je=10;a.oq=20;a.rF=30;a.zk=10;a.gq=20;a.yk=30;a.fq=40;a.nv=50;a.Im=0;a.Aw=1;a.Ri=a.zk;var M=null;a.Ed=function(a){M=a};a.ZF=function(a){var b=_buffers[a];M.deleteBuffer(b.Ce);
M.deleteBuffer(b.Vf);delete _buffers[a]};a.FD=function(e,h,g,f){d(e)&&b(e);var m=e.oa,l=e.P,p=e.B,v={},t;for(t in e.M)t in f&&!f[t].Cg||(v[t]=e.M[t]);f={uf:null,Yc:null,ko:0,count:0,Nb:{},mode:0,pk:0,il:0,yr:0,Vf:null,Ce:null,Al:null,ba:null};if(0<e.ba.length){t=p[0];for(var r=1;r<e.ba.length;r++){for(var A=e.ba[r].cc,u=A.a_position,G=A.a_normal,D=t.a_position,z=t.a_normal,C=u.length,H=e.ba[r].Cl,q=0;q<C;q++)D[q]+=H*u[q],z[q]+=H*G[q];A=A.a_tangent;u=t.a_tangent;G=A.length;for(q=0;q<G;q++)u[q]+=H*
A[q]}}if(m.length)if(t=m.length,65536>=l)var r=new Uint16Array(m),F=M.UNSIGNED_SHORT;else r=new Uint32Array(m),F=M.UNSIGNED_INT;else t=l,r=null;var H=0,q=p.length,I;for(I in p[0])A=p[0][I],H+=A.length*q;for(I in v)A=v[I],H+=A.length;I=new Float32Array(H);var H=0,q={},da;for(da in v)if(u=v[da],A=u.length)I.set(u,H),q[da]={DF:da,Wd:w(u,l),offset:H,frames:1,length:A},H+=A;v=p.length;for(da in p[0])if(u=p[0][da],A=u.length,u=w(u,l),A)for(q[da]={Wd:u,offset:H,frames:v,length:A},1<v&&(q[da+"_next"]={Wd:u,
offset:H+A,frames:v,length:A}),G=0;G<v;G++)u=p[G][da],I.set(u,H),H+=A;f.count=t;f.uf=r;f.Yc=I;f.ko=F;f.Nb=q;k(f,g);n(f);h!=a.je&&c(e)&&(f.Al={IB:new Float32Array(m.length),JB:new Float32Array(m.length),hz:new Float32Array(m.length/3),type:h});f.ba=e.ba;return f};a.SA=d;a.RA=c;a.um=b;a.$D=function(a,b,c){k(a,b);a.count=c.length;a.uf=c;a.ko=c instanceof Uint16Array?M.UNSIGNED_SHORT:M.UNSIGNED_INT};a.ym=function(a,b,c,d){var e=a.Yc,h=a.Nb,g=h[b];g?(c&&g.Wd!=c&&z.ka('invalid num_comp for "'+b+'"'),e.set(d,
g.offset)):(e=e.length,g=new Float32Array(e+d.length),g.set(a.Yc),g.set(d,e),a.Yc=g,h[b]={Wd:c,offset:e});n(a)};a.sz=f;a.$G=function(a){a.pk=M.STATIC_DRAW};a.zB=function(a){a.pk=M.DYNAMIC_DRAW};a.Pu=n;a.dr=function(a){a.Ce&&M.deleteBuffer(a.Ce);a.Vf&&M.deleteBuffer(a.Vf)};a.xs=function(a,b){return a.submeshes[b].base_length?!1:!0};a.Au=function(a,b){for(var c=0;c<a.B.length;c++){var d=a.B[c].a_position;t.transform_vectors(d,b,d,0);d=a.B[c].a_normal;0<d.length&&t.transform_dir_vectors(d,b,d,0);d=a.B[c].a_tangent;
0<d.length&&t.transform_tangents(d,b,d,0)}(c=a.M.au_center_pos)&&c.length&&t.transform_vectors(c,b,c,0);return a};a.DD=function(a,b){var c=a.M.au_center_pos;if(c&&c.length){var d=new Float32Array(c);t.transform_vectors(d,b,d,0);for(var e=0;e<a.B.length;e++)for(var h=0;h<d.length;h++)a.B[e].a_position[h]+=d[h]-c[h];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.CD=function(a,b){var c=a.P,d;for(d in b){var e=b[d].length;a.M[d]=new Float32Array(e*c);for(var h=0;h<c;h++)for(var g=
0;g<e;g++)a.M[d][h*e+g]=b[d][g]}};a.ED=r;a.yB=function(a,c,d){if(!a.P)return z.vb("EMPTY");var e=d.length;65536<a.P*e&&!v.ds()&&b(a,e);var h=a.oa,g=a.P,f=a.M;a=a.B;for(var m in c){var l=c[m].length,n=l*g;f[m]=new Float32Array(n);for(var p=0;p<g;p++)for(n=0;n<l;n++)f[m][p*l+n]=c[m][n]}c=z.vb("CLONE_"+e+"_SUBMESHES");c.P=g*e;c.oa=new Uint32Array(h.length*e);for(p=0;p<e;p++)for(l=h.length*p,m=g*p,n=0;n<h.length;n++)c.oa[l+n]=h[n]+m;for(var k in f)for(h=f[k],n=h.length*e,l=w(h,g),c.M[k]=new Float32Array(n),
p=0;p<e;p++)m=g*l*p,c.M[k].set(h,m);for(k in a[0])for(p=0;p<a.length;p++)for(h=a[p][k],n=h.length*e,l=w(h,g),c.B[p]=c.B[p]||{},c.B[p][k]=new Float32Array(n),n=0;n<e;n++)switch(f=d[n],m=g*l*n,k){case "a_position":t.transform_vectors(h,f,c.B[p][k],m);break;case "a_normal":t.transform_dir_vectors(h,f,c.B[p][k],m);break;case "a_tangent":t.transform_tangents(h,f,c.B[p][k],m);break;default:throw"Wrong attribute name: "+k;}return c};a.Kr=e;a.vz=function(a){var b=a.P,c=a.B[0].a_position,d=new Float32Array(12*
b),e=new Float32Array(8*b);a=new Uint16Array(4*a.oa.length);for(var h=0;h<b;h++)d[12*h]=c[3*h],d[12*h+1]=c[3*h+1],d[12*h+2]=c[3*h+2],d[12*h+3]=c[3*h],d[12*h+4]=c[3*h+1],d[12*h+5]=c[3*h+2],d[12*h+6]=c[3*h],d[12*h+7]=c[3*h+1],d[12*h+8]=c[3*h+2],d[12*h+9]=c[3*h],d[12*h+10]=c[3*h+1],d[12*h+11]=c[3*h+2],e[8*h]=-.5,e[8*h+1]=-.5,e[8*h+2]=-.5,e[8*h+3]=.5,e[8*h+4]=.5,e[8*h+5]=.5,e[8*h+6]=.5,e[8*h+7]=-.5,a[6*h]=4*h+2,a[6*h+1]=4*h+1,a[6*h+2]=4*h,a[6*h+3]=4*h+2,a[6*h+4]=4*h,a[6*h+5]=4*h+3;c=z.vb("HALO");c.B=
[];c.B[0]={};c.P=4*b;c.B[0].a_position=d;c.M.a_halo_bb_vertex=e;c.oa=a;return c};a.CA=h;a.Lr=function(a,b,c){for(var d=[],h=0;h<a.submeshes.length;h++){var g=e(a,h,b,null,c,null);g.P&&d.push(g)}return 0==d.length?z.vb("EMPTY"):1==d.length?d[0]:r(d)};a.ZD=function(a,b,c){for(var d=a.uf,e=f(a,"a_position"),h=a.Al,g=h.IB,m=h.JB,h=h.hz,l=d,n=l.length/3,p=0;p<n;p++){var k=l[3*p],v=l[3*p+1],w=l[3*p+2],t=e[3*k+1],r=e[3*k+2],A=e[3*v+1],u=e[3*v+2],F=e[3*w+1],I=e[3*w+2];g[3*p]=(e[3*k]+e[3*v]+e[3*w])/3;g[3*
p+1]=(t+A+F)/3;g[3*p+2]=(r+u+I)/3}z.Hf(g,b,m);b=m.length/3;for(e=0;e<b;e++)g=m[3*e]-c[0],l=m[3*e+1]-c[1],n=m[3*e+2]-c[2],h[e]=g*g+l*l+n*n;c=d;d=h.length;if(!(2>d))for(m=d,e=!1;1<m||e;)for(1<m&&(m=Math.floor(m/1.247330950103979)),e=!1,b=0;m+b<d;b++)0>h[b]-h[b+m]&&(e=h[b],h[b]=h[b+m],h[b+m]=e,e=c,g=b,l=b+m,n=e[3*g],p=e[3*g+1],k=e[3*g+2],e[3*g]=e[3*l],e[3*g+1]=e[3*l+1],e[3*g+2]=e[3*l+2],e[3*l]=n,e[3*l+1]=p,e[3*l+2]=k,e=!0);d=c;M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,a.Ce);M.bufferData(M.ELEMENT_ARRAY_BUFFER,
d,M.DYNAMIC_DRAW)};a.ou=C;a.Qq=function(a,b,c){for(var d=b.length/3,e=a.length/3,h=[],g=Array(3),f=Array(3),m=Array(3),l=0;l<e;l++){for(var n=a[3*l],p=a[3*l+1],k=a[3*l+2],v=0;3>v;v++)g[v]=b[3*n+v],f[v]=b[3*p+v],m[v]=b[3*k+v];if(c)var v=B(g,f,m),w=B(f,m,g),t=Math.PI-v-w;else t=w=v=1;var r=h,A;A=g;var F=m,I=[],u=[],G=[];L.subtract(f,A,I);L.subtract(F,A,u);L.cross(I,u,G);L.normalize(G,G);A=G;for(F=0;3>F;F++)I=3*p+F,u=3*k+F,r[3*n+F]=v*A[F],r[I]=w*A[F],r[u]=t*A[F]}if(c)for(var D in c)for(l=c[D],a=0;3>
a;a++){b=3*l[0]+a;for(e=1;e<l.length;e++)g=3*l[e]+a,h[b]+=h[g];for(e=1;e<l.length;e++)g=3*l[e]+a,h[g]=h[b]}for(l=0;l<d;l++){c=l;D=h;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=D[e];L.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,D[e]=a[b]}return h};a.Sq=function(a,b,c){for(var d={},e=b.length/3,h=0;h<e;h++){var g=String(b[3*h])+String(b[3*h+1])+String(b[3*h+2]);d[g]=[]}e=a.length;for(h=0;h<e;h++)b=a[h],g=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),g in d&&d[g].push(b);return d};a.Wn=function(a,
b,c,d){var e=H(a,null,!1);if(c)var h=H(a,null,!0);var g=e.length,f=new Float32Array(g),m=A,l=J;for(a=0;a<g;a++){var n=e[a];m.set(n.subarray(0,3));l.set(n.subarray(3,6));N.set(n.subarray(6));f[a]=Math.sqrt(D(m,l,N))}m=new Float32Array(g);m[0]=f[0];for(a=1;a<g;a++)m[a]=m[a-1]+f[a];g=m[f.length-1];f=[];for(a=0;a<b;a++){var l=g*z.md(d),l=z.Pk(m,l,0,m.length-1),n=c?h[l]:e[l],l=a,p=n,k=d,n=void 0,n=new Float32Array(3),v=p[0],w=p[1],t=p[2],r=p[3],u=p[4],F=p[5],I=p[6],G=p[7],M=p[8],p=z.md(k),k=z.md(k);1<
p+k&&(p=1-p,k=1-k);var C=1-p-k,w=C*w+p*u+k*G,t=C*t+p*F+k*M;n[0]=C*v+p*r+k*I;n[1]=w;n[2]=t;f[l]=n}return f};a.eG=H;a.Nn=u;a.uH=D;a.Ut=function(a,b,c){a=a.B[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]};a.nx=function(a,b,c){var d=a.aa[0].T;a=a.f.Lf;for(var e=1;e<a.length;e++)a[e].name==b&&(a[e].value=c);for(e=0;e<d.length;e++)if(!d[e].zg&&d[e].fe&&!d[e].sg){c=d[e].R.Nb;b=d[e].R.Yc;M.bindBuffer(M.ARRAY_BUFFER,d[e].R.Vf);
var h=c.a_position,g=d[e],f=b,m=a;if(h){for(var l=h.offset,h=h.length+l,n=g.R.ba[0].cc.a_position,p=l;p<h;p++)f[p]=n[p-l];for(p=1;p<g.R.ba.length;p++){var n=g.R.ba[p].cc.a_position,k=m[p].value;if(k)for(var v=l;v<h;v++)f[v]+=k*n[v-l]}M.bufferSubData(M.ARRAY_BUFFER,4*l,f.subarray(l))}h=c.a_normal;g=d[e];f=b;m=a;if(h){l=h.offset;h=h.length+l;n=g.R.ba[0].cc.a_normal;for(p=l;p<h;p++)f[p]=n[p-l];for(p=1;p<g.R.ba.length;p++)if(n=g.R.ba[p].cc.a_normal,k=m[p].value)for(v=l;v<h;v++)f[v]+=k*n[v-l];G(f,l,h,
3,2);M.bufferSubData(M.ARRAY_BUFFER,4*l,f.subarray(l))}m=c.a_tangent;c=d[e];g=a;if(m){f=m.offset;m=m.length+f;h=c.R.ba[0].cc.a_tangent;for(l=f;l<m;l++)b[l]=h[l-f];for(l=1;l<c.R.ba.length;l++)if(h=c.R.ba[l].cc.a_tangent,p=g[l].value)for(n=f;n<m;n++)b[n]+=p*h[n-f];G(b,f,m,4,3);M.bufferSubData(M.ARRAY_BUFFER,4*f,b.subarray(f))}}};a.check_shape_keys=function(a){return a.f.fe};a.get_shape_keys_names=function(a){var b=[];if(a.f)for(var c=1;c<a.f.Lf.length;c++)b.push(a.f.Lf[c].name);return b};a.get_shape_key_value=
function(a,b){if(a.f)for(var c=1;c<a.f.Lf.length;c++)if(b==a.f.Lf[c].name)return a.f.Lf[c].value;return 0};a.zs=function(a,b){var c=a.f.Lf;if(c)for(var d=1;d<c.length;d++)if(c[d].name==b)return!0;return!1};a.Sh=function(a){return a&&a.f&&a.f.Rd?!0:!1}};b4w.module.__objects=function(a,q){function d(a){a.f.Ad=0;a=ka.indexOf(a);-1!=a&&ka.splice(a,1)}function c(a){if(a.Kh)for(var b=a.aa,c=0;c<b.length;c++)x.fE(b[c].Xb,a)}function b(a,b){for(var c=a.aa,d=b.aa,e=0;e<c.length;e++){for(var h=!1,g=0;g<d.length;g++)if(c[e].Xb==d[g].Xb){h=!0;break}h||l(b,c[e].Xb)&&A.Jk(b,c[e].Xb)}}function l(a,b){return!b.Jw&&"SPEAKER"==a.type||!b.Kw&&("LAMP"==a.type||"CAMERA"==a.type)?!1:!0}function f(a,b){if(a.dg_parent&&a.dg_parent.pq||a.parent&&a.parent.pq)return!0;switch(a.type){case "MESH":var c=
B.Pq(a),d=a.b4w_do_not_batch,e=a.b4w_collision,h=a.b4w_vehicle,g=a.b4w_floating,f=a.b4w_character,m=J.EA(a),l=L.ys(b),n=0<a.data.b4w_shape_keys.length,O=a.b4w_dynamic_geometry;if(!(c=c||d||e||h||n||g))a:{c=a.data;for(d=0;d<c.materials.length;d++)if("LENS_FLARES"===c.materials[d].name){c=!0;break a}c=!1}return c||m||f||l||O;case "EMPTY":return f=B.Pq(a),m=L.ys(b),l=a.b4w_do_not_batch,f||m||l;default:return!0}}function k(a,b,c,d,e,h,g,f,m){for(var l=0;l<a.nodes.length;l++){var p=a.nodes[l];if("VALUE"==
p.type){var O=r(b,p.name);d.push(p.outputs[0].default_value);e.push(O,e.length/2)}else"RGB"==p.type?(O=r(b,p.name),p=p.outputs[0].default_value.slice(0,3),g.push(p[0],p[1],p[2]),f.push(O,f.length/2)):"GROUP"==p.type&&(O=p.node_group.node_tree,k(O,r(b,p.name),O.animation_data,d,e,h,g,f,m))}if(c)for((a=c.action)&&n(a,b,h,e,m,f),c=c.nla_tracks,d=0;d<c.length;d++)for(g=c[d].strips,l=0;l<c[d].strips.length;l++)(a=g[l].action)&&n(a,b,h,e,m,f)}function n(a,b,c,d,h,g){var f=a.k.O,m;for(m in f){var l=r(b,
m.match(/"(.*?)"/)[1]),f=e(d,l);null!=f?(l=r(a.name,m),c.push(l,f)):(f=e(g,l),null!=f&&(l=r(a.name,m),h.push(l,f)))}}function r(a,b){return a+"%join%"+b}function e(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function g(a){return a instanceof Array?a.slice():a}function h(a){Q.ALL.push(a);Q[a.type]||(Q[a.type]=[]);Q[a.type].push(a);var b=a.f.Oc;if(null!=b)for(var c=0;c<ca.length;c++){var d=ca[c];d.f.Oc==b&&d.dk.push(a)}}function p(a,b,c){b=Q[b]||[];for(var d=[],e=0;e<b.length;e++){var h=
b[e];if(h.f.lc==c||-1==c)for(var g=h.aa,f=0;f<g.length;f++)g[f].Xb==a&&d.push(h)}return d}function w(a,b,c,d){for(var e=null,h=0;h<b.length;h++){var g=b[h];if((c?g.Ro:g.name)==a&&g.f.lc==d){e=g;break}}return e}function C(a){return a.Nc?a.parent:a.parent?C(a.parent):null}var B=q("__animation"),H=q("__batch"),u=q("__boundings"),D=q("__camera"),G=q("__config"),v=q("__constraints"),m=q("__geometry"),t=q("__lights"),z=q("__mat4"),L=q("__nla"),A=q("__obj_util"),J=q("__particles"),N=q("__physics"),M=q("__print"),
y=q("__primitives"),K=q("__quat"),x=q("__scenes"),S=q("__sfx"),T=q("__transform"),U=q("__tsr"),fa=q("__util"),R=q("__vec3"),W=G.q,aa=G.Mb,Q={ALL:[]},V=0,oa=0,ca=[],ka=[],la=new Float32Array(3),ba=new Float32Array(4);a.Hm=0;a.Gm=1;a.Si=2;a.DATA_ID_ALL=-1;a.update=function(a){for(var b=Q.ALL,c=0;c<b.length;c++)for(var e=b[c],h=e.aa,g=0;g<h.length;g++){var f=h[g].Xb;if(f.k.outline){if(-1!=ka.indexOf(e)){var m=e,l=a,n=0,p=m.Mw;0==p.Hp&&(p.Hp=l);l-=p.Hp;if(p.Pt&&l/p.ld>=p.Pt)d(m);else{l%=p.ld;if(l<p.st)switch(p=
l/(p.st/5),l=Math.floor(p),l){case 0:n=(p-l)/2;break;case 1:n=(p-l)/2+.5;break;case 2:n=1;break;case 3:n=1-(p-l)/2;break;case 4:n=.5-(p-l)/2}m.f.Ad=n}}e.f.Ad&&x.yC(f)}}};a.apply_outline_anim=function(a,b,c,d){a.Mw={Hp:0,st:b,ld:c,Pt:d};-1==ka.indexOf(a)&&ka.push(a)};a.clear_outline_anim=d;a.Pp=function(a,b){Q[b.type]||(Q[b.type]=[]);Q.ALL.push(b);Q[b.type].push(b);a.pq=b.pa=f(a,b);a.sF=!0;b.oc=a.b4w_vehicle;b.is_character=a.b4w_character;b.Hg=a.b4w_floating;b.Li=a.b4w_collision;var c=a.game;b.Bd=
{cm:c.physics_type,rk:c.use_ghost,Wu:c.use_sleep,Vd:c.mass,av:c.velocity_min,$u:c.velocity_max,An:c.damping,hp:c.rotation_damping,pB:c.lock_location_x,qB:c.lock_location_y,rB:c.lock_location_z,sB:c.lock_rotation_x,tB:c.lock_rotation_y,uB:c.lock_rotation_z,gj:c.collision_margin,ej:c.collision_group,hj:c.collision_mask,Rp:c.use_collision_bounds,Yk:c.collision_bounds_type,qk:c.use_collision_compound};if(c=a.b4w_vehicle_settings)b.yc={name:c.name,qc:c.part,ID:c.suspension_rest_length,Ap:c.suspension_compression,
Cp:c.suspension_stiffness,Bp:c.suspension_damping,bq:c.wheel_friction,fp:c.roll_influence,Ho:c.max_suspension_travel_cm,yj:c.force_max,bj:c.brake_max,zi:c.steering_max,ci:c.max_speed_angle,oj:c.delta_tach_angle,hk:c.speed_ratio,kk:c.steering_ratio,Ij:c.inverse_control,yg:c.floating_factor,sh:c.water_lin_damp,th:c.water_rot_damp,Eu:c.synchronize_position};if(c=a.b4w_floating_settings)b.Lh={name:c.name,qc:c.part,yg:c.floating_factor,sh:c.water_lin_damp,th:c.water_rot_damp,Eu:c.synchronize_position};
if(c=a.b4w_character_settings)b.Yq={RE:c.walk_speed,EC:c.run_speed,zD:c.step_height,YA:c.jump_strength,TE:c.waterline};for(c=0;c<a.constraints.length;c++){var d=a.constraints[c];"RIGID_BODY_JOINT"==d.type&&b.Vo.push({target:d.target.Db,XB:d.pivot_type,YB:d.pivot_x,ZB:d.pivot_y,$B:d.pivot_z,Ld:d.axis_x,Md:d.axis_y,Nd:d.axis_z,yE:d.use_limit_x,zE:d.use_limit_y,AE:d.use_limit_z,tE:d.use_angular_limit_x,uE:d.use_angular_limit_y,vE:d.use_angular_limit_z,hB:d.limit_max_x,iB:d.limit_max_y,jB:d.limit_max_z,
kB:d.limit_min_x,lB:d.limit_min_y,mB:d.limit_min_z,bB:d.limit_angle_max_x,cB:d.limit_angle_max_y,dB:d.limit_angle_max_z,eB:d.limit_angle_min_x,fB:d.limit_angle_min_y,gB:d.limit_angle_min_z})}c=b.f=A.Eh("MESH"===b.type?b.pa?"DYNAMIC":"STATIC":b.type);a.parent?(b.parent=a.parent.Db,"BONE"==a.parent_type&&"ARMATURE"==a.parent.type&&(b.Yj=a.parent_bone)):a.dg_parent&&(b.parent=a.dg_parent.Db,b.Nc=!0);var d=a.location,e=a.scale[0];fa.$o(a.rotation_quaternion,ba);T.set_translation(b,d);T.set_rotation(b,
ba);T.set_scale(b,e);b.Tu=a.b4w_use_default_animation;a.b4w_object_tags&&(b.bt={title:a.b4w_object_tags.title,description:a.b4w_object_tags.description,category:a.b4w_object_tags.category});switch(a.type){case "ARMATURE":e=a.pose.bones;for(d=0;d<e.length;d++){var h=e[d],g=h.bone,m=new Float32Array(g.matrix_local),l=new Float32Array(16);z.invert(m,l);var n=new Float32Array(h.matrix_basis),p=new Float32Array(3);R.subtract(g.tail_local,g.head_local,p);fa.LE(p,l,p);h.Ow=p;h.Hw=[h].concat(h.parent_recursive);
h.rq=U.from_mat4(m,U.create());h.qq=U.from_mat4(n,U.create());h.Km=U.create();h.Ek=!1}h=B.Kx(b);c.ad=h;e=B.Rq(b,h);a.b4w_animation_mixing?(c.Qc=new Float32Array(e.Ga),c.Pc=new Float32Array(e.Ga),c.Xc=new Float32Array(e.i),c.Wc=new Float32Array(e.i)):(c.Qc=e.Ga,c.Pc=e.Ga,c.Xc=e.i,c.Wc=e.i);c.zt=e;c.Ag=0;c.df=a.b4w_animation_mixing;break;case "MESH":c.Ah=H.yx(a.data.b4w_bounding_box);c.jh=aa.outlining_overview_mode||a.b4w_selectable;c.Vl=a.b4w_selectable;c.Mb=aa.outlining_overview_mode||a.b4w_outlining;
c.Ul=a.b4w_outlining;c.rt=aa.outlining_overview_mode||a.b4w_outline_on_select;c.sd=a.b4w_billboard;c.$m=a.b4w_pres_glob_orientation;c.$i="BASIC";c.Zi="SPHERICAL"==a.b4w_billboard_geometry;c.Tj={Wl:a.b4w_outline_settings.outline_duration,Xl:a.b4w_outline_settings.outline_period,Yl:a.b4w_outline_settings.outline_relapses};c.jh&&(c.Zk=fa.Ur(V),V++);for(d=0;d<a.data.b4w_vertex_anim.length;d++)e=a.data.b4w_vertex_anim[d],b.Pb.push({name:e.name,G:e.frame_start,N:e.frame_end,EF:e.averaging,FF:e.averaging_interval,
Qw:e.allow_nla});b.f.Pb=b.Pb.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;d=b.f;if(a.data.b4w_shape_keys.length)for(d.fe=!0,e=0;e<a.data.b4w_shape_keys.length;e++)h={},h.value=a.data.b4w_shape_keys[e].value,h.name=a.data.b4w_shape_keys[e].name,d.Lf.push(h);else d.fe=!1;if(d=B.$r(a)){e=d.Db;l=e.J;h=b.f;g=a.data;b.Kk=e;g=g.vertex_groups;if(g.length){for(var m=l.data.bones,n=l.pose.bones,p=0,l={},O=0;O<m.length;O++){var E=m[O].name,v=fa.keysearch("name",E,g);if(v){var x=fa.$n(n,"name",
E);l[E]={Oq:O,nj:p++,Wo:x,dv:v.index}}}g=p;h.ad=l;m=B.gs();h.Ie=g;g>2*m?(h.Yh=!1,M.error('too many bones for "'+a.name+'" / '+h.Ie+" bones (max "+m+" with blending, "+2*m+" without blending). Skinning will be disabled.")):h.Yh=!0}h=c.ad;e=B.Rq(e,h);d.b4w_animation_mixing?(c.Qc=new Float32Array(e.Ga),c.Pc=new Float32Array(e.Ga),c.Xc=new Float32Array(e.i),c.Wc=new Float32Array(e.i)):(c.Qc=e.Ga,c.Pc=e.Ga,c.Xc=e.i,c.Wc=e.i);c.Sm=new Float32Array(4);c.Rm=K.create();c.zt=e;c.Ag=0}d=b.f;e=a.data.materials;
h=[];g=[];m=[];l=[];n=[];p=[];for(O=0;O<e.length;O++)E=e[O],(v=E.node_tree)&&k(v,E.name,v.animation_data,h,g,m,l,n,p);d.He=h;d.Sg=g;d.Ll=m;d.Lc=l;d.Rg=n;d.Ml=p;c.Sc=a.b4w_shadow_cast;c.wc=a.b4w_shadow_receive;c.vc=a.b4w_shadow_cast_only&&c.Sc;c.hc=a.b4w_reflexible;c.Wb=a.b4w_reflexible_only&&c.hc;c.sc=a.b4w_reflective;c.Xd=a.b4w_reflection_type;c.qe=a.b4w_caustics;c.Zc=a.b4w_wind_bending;c.uk=a.b4w_wind_bending_angle;d=H.UE(a.b4w_wind_bending_angle,c.Ah,a.scale[0]);c.ge=d;c.We=a.b4w_wind_bending_freq;
c.ue=a.b4w_detail_bending_freq;c.te=a.b4w_detail_bending_amp;c.oe=a.b4w_branch_bending_amp;c.Uh=!1;c.Ge=a.b4w_main_bend_stiffness_col;d=a.b4w_detail_bend_colors;c.Tb={};c.Tb.Ss=d.leaves_stiffness_col;c.Tb.Rs=d.leaves_phase_col;c.Tb.tt=d.overall_stiffness_col;c.Gh=a.b4w_do_not_cull;c.kl=a.b4w_disable_fogging;c.Rd=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";d=a.data.materials[0];c.Aj=d.physics.friction;c.vj=d.physics.elasticity;c.Qj=0;c.xf=1E4;c.Qg=a.b4w_lod_transition;c.Kl=!0;break;
case "CAMERA":D.Mx(a,b);D.sx(b);break;case "LAMP":t.ZA(a,b);break;case "SPEAKER":b.w=S.Iy();e=!1;for(d=0;d<b.aa.length;d++)if(b.aa[d].Xb.b4w_enable_audio){e=!0;break}e&&S.Pp(a,b);break;case "EMPTY":c.Ib=u.pd(),d=u.vk(),c.bd=d,a.field&&(b.Kh={type:a.field.type,yu:a.field.strength}),a.b4w_anchor&&(b.anchor={type:a.b4w_anchor.type,Fh:a.b4w_anchor.detect_visibility,nl:a.b4w_anchor.element_id,GB:a.b4w_anchor.max_width})}a.field&&(c.jG=a.field.strength)};a.iE=function(a){var c=a.f;if(a.parent){var d=c.i,
e=c.quat,h=c.scale;!a.Nc&&a.Bd.qk&&a.parent.Bd.qk&&(a.Li=!1);var g=a.Bd;a.oc||a.Hg||N.is_character(a)||a.Li&&!g.rk&&0<g.Vd&&("DYNAMIC"==g.cm||"RIGID_BODY"==g.cm)?(d=a.Nc?U.create_sep(d,h,e):c.Ma,U.multiply(a.parent.f.Ma,d,c.Ma),T.set_translation(a,U.get_trans_view(c.Ma)),T.set_scale(a,U.get_scale(c.Ma)),T.set_rotation(a,U.get_quat_view(c.Ma))):a.Nc||!a.Yj?(d=U.create_sep(d,h,e),v.Uw(a,a.parent,d)):(d=U.create_sep(d,h,e),v.Vw(a,a.parent,a.Yj,d))}if("MESH"==a.type&&c.sc)if(c=a.f,"CUBE"==c.Xd)c.cd=oa++;
else if("PLANE"==c.Xd){a:{d=a.J.constraints;for(e=0;e<d.length;e++)if(h=d[e],"LOCKED_TRACK"==h.type&&"REFLECTION PLANE"==h.name){d=h.target.Db;break a}d=null}d||(d=fa.Ii("%reflection%"),d=A.un(d,"EMPTY"),e=A.Eh("EMPTY"),d.f=e,b(a,d),v.zq(d,a,[0,0,0],null,1),Q.EMPTY||(Q.EMPTY=[]),Q.EMPTY.push(d),Q.ALL.push(d));e=null;for(h=0;h<ca.length;h++)if(ca[h]==d){e=h;break}null==e&&(e=ca.length,ca.push(d));d.f.Oc=e;c.Oc=e;d.dk.push(a)}};a.Ou=c;a.QF=b;a.Vx=l;a.jE=function(a){for(var b=0;b<a.length;b++){var c=
a[b];!c.f||"DYNAMIC"!=c.f.type&&"CAMERA"!=c.f.type||T.p(c);c.Tu&&B.pt(c)&&(B.apply_def(c),c.H.length&&B.play(c,null,B.SLOT_ALL))}};a.get_meta_tags=function(a){return fa.ma(a.bt)};a.cleanup=function(){oa=V=0;ca=[];ka.length=0;Q={ALL:[]}};a.copy=function(a,c,d){c=A.un(c,a.type);c.f=A.pg(a.f);c.pa=a.pa;c.parent=a.parent;c.Nc=a.Nc;c.Yj=a.Yj;a.ke&&(c.ke=g(a.ke));c.Bd=A.pg(a.Bd);!a.m||a.oc||a.is_character||a.Hg||(c.m=A.pg(a.m));c.Li=a.Li;c.b4w_collision_id=a.b4w_collision_id;c.b4w_correct_bounding_offset=
a.b4w_correct_bounding_offset;c.data=a.data;b(a,c);for(var e=[],f=0;f<a.aa.length;f++){var l=c.aa[f],n=a.aa[f].T;if(d){for(var l=l.T,p=0;p<n.length;p++)n[p].zg||(l.push(A.pg(n[p])),e.push(n[p].R));for(p=0;p<n.length;p++)if(n[p].zg){var k=A.pg(n[p]);l.push(k);for(var v=0;v<e.length;v++)e[v]==n[p].R&&(k.R=l[v].R)}for(p=0;p<l.length;p++)l[p].R&&m.Pu(l[p].R),l[p].hi=c.uuid,H.VD(l[p],fa.Ch(c.f,0))}else l.T=g(n)}A.jp(c,!1);if(w(a.name,Q.ALL,!1,-1))for(f=1;;){d=a.name+(3>String(f).length?"."+("000"+String(f)).slice(-3):
"."+String(f));if(!w(a.name,Q.ALL,!1,-1)){a.name=d;M.error('object "'+a.name+'" already exists. Name was replaced by "'+d+'".');break}f++}h(c);c.uuid=fa.Vr();c.f.ro=!0;c.f.Zk=fa.Ur(V);V++;return c};a.uA=function(a,b){for(var c=a.f.Sg,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null};a.oA=function(a,b){for(var c=a.f.Rg,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null};a.update_boundings=function(a){for(var b=a.f,c=a.aa[0].T,d,e,h,g,f,l,n=0;n<c.length;n++){var p=c[n];if("MAIN"==p.type){var p=
p.R.Yc,O=c[n].R.Nb,E=O.a_position.offset,O=O.a_position.length+E;d=g=p[E];e=f=p[E+1];h=l=p[E+2];for(var k=E;k<O;k+=3){var E=p[k],v=p[k+1],x=p[k+2];d=Math.max(E,d);e=Math.max(v,e);h=Math.max(x,h);g=Math.min(E,g);f=Math.min(v,f);l=Math.min(x,l)}}}var w={max_x:parseFloat(d.toFixed(3)),max_y:parseFloat(e.toFixed(3)),max_z:parseFloat(h.toFixed(3)),min_x:parseFloat(g.toFixed(3)),min_y:parseFloat(f.toFixed(3)),min_z:parseFloat(l.toFixed(3))},t=d-g,r=e-f,A=h-l;g=.5*(d+g);var G=.5*(e+f),D=.5*(h+l),M=g,z=D;
f=Math.max(t,Math.max(r,A))/2;l=Math.max(t,A)/2;var C=[g/(t?t:1),G/(r?r:1),D/(A?A:1)],q=.5;if(b.sd)E=Math.max(Math.abs(w.max_x),Math.abs(w.min_x)),v=Math.max(Math.abs(w.max_y),Math.abs(w.min_y)),x=Math.max(Math.abs(w.max_z),Math.abs(w.min_z)),f=Math.sqrt(E*E+v*v+x*x),l=Math.sqrt(E*E+v*v),w.max_x=w.max_y=w.max_z=f,w.min_x=w.min_y=w.min_z=-f,g=new Float32Array([0,0,0]),A=new Float32Array([f,f,f]),r=new Float32Array([0,0,0]);else{for(n=0;n<c.length;n++)if(p=c[n],"MAIN"==p.type)for(p=p.R.Yc,O=c[n].R.Nb,
E=O.a_position.offset,O=O.a_position.length+E,k=E;k<O;k+=3){var E=p[k],v=p[k+1],x=p[k+2],B=Math.sqrt((g-E)*(g-E)+(G-v)*(G-v)+(D-x)*(D-x));if(B>f){var L=g-f*(E-g)/B,J=G-f*(v-G)/B,B=D-f*(x-D)/B;g=(L+E)/2;G=(J+v)/2;D=(B+x)/2;f=Math.sqrt((g-E)*(g-E)+(G-v)*(G-v)+(D-x)*(D-x))}J=Math.sqrt((M-E)*(M-E)+(z-x)*(z-x));J>l&&(L=M-l*(E-M)/J,B=z-l*(x-z)/J,M=(L+E)/2,z=(B+x)/2,l=Math.sqrt((M-E)*(M-E)+(z-x)*(z-x)));E/=t?t:1;v/=r?r:1;x/=A?A:1;B=Math.sqrt((C[0]-E)*(C[0]-E)+(C[1]-v)*(C[1]-v)+(C[2]-x)*(C[2]-x));B>q&&(L=
C[0]-q*(E-C[0])/B,J=C[1]-q*(v-C[1])/B,B=C[2]-q*(x-C[2])/B,C[0]=(L+E)/2,C[1]=(J+v)/2,C[2]=(B+x)/2,q=Math.sqrt((C[0]-E)*(C[0]-E)+(C[1]-v)*(C[1]-v)+(C[2]-x)*(C[2]-x)))}n=t?t*C[0]:d;e=r?r*C[1]:e;h=A?A*C[2]:h;t*=q;r*=q;A*=q;g=new Float32Array([g,G,D]);A=new Float32Array([t,r,A]);r=new Float32Array([n,e,h]);l=parseFloat(l.toFixed(3))}b.Ib=w;H.UC(b,l,l,w);w=u.el(f,g);b.bd=w;w=u.dl([A[0],0,0],[0,A[1],0],[0,0,A[2]],r);b.ef=w;T.p(a);if(W.wireframe_debug)for(n=0;n<c.length;n++)if("WIREFRAME"===c[n].type&&c[n].sg){a=
y.Vn(1,w.F);m.Ut(a,[w.Ld[0],w.Md[1],w.Nd[2]],w.F);m.um(a,1,!0);a.M.a_polyindex=m.Nn(a);H.UD(c[n],a);break}};a.Pw=h;a.na=p;a.pA=function(a,b){for(var c=Q.ALL||[],d=[],e=0;e<c.length;e++){var h=c[e];if((h.f.lc==b||-1==b)&&h.J)for(var g=h.aa,f=0;f<g.length;f++)g[f].Xb==a&&d.push(h)}return d};a.get_all_objects=function(a){var b=Q.ALL;if(-1==a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.f.lc==a&&c.push(e)}return c};a.mD=function(a){var b=p(a,"LAMP",-1);if(b.length==a.k.cH){for(var c=[],d=0;d<
b.length;d++){var e=b[d],e=A.Ja(e,a);c[e.Pj]=d}for(d=0;d<c.length-1;d++)for(e=d+1;e<c.length;e++){var h=b[c[d]].Ka,g=b[c[e]].Ka;if(g.Ki&&g.oh&&(!h.Ki||!h.oh)||!h.Ki&&(g.Ki||!h.oh&&g.oh))h=c[d],c[d]=c[e],c[e]=h}for(d=0;d<c.length;d++)e=b[c[d]],A.Ja(e,a).Pj=d,x.Uf(b[c[d]],a)}};a.SD=function(a){for(var b=p(a,"LAMP",-1),c=p(a,"MESH",-1),d=0;d<c.length;d++)for(var e=A.Ja(c[d],a).T,h=0;h<e.length;h++){var g=e[h];"MAIN"==g.type&&(H.WD(g,b,a),H.sb(g))}};a.qA=function(){for(var a=[],b=Q.MESH,c=0;c<b.length;c++){var d=
b[c];d.f.jh&&a.push(d)}return a};a.pf=function(b,c,d,e){var h=null,g=Q.ALL;switch(b){case a.Hm:h=w(c,g,!1,d);break;case a.Gm:b=null;if((c=w(c,g,!1,e))&&c.J.dupli_group){c=c.J.dupli_group.objects;g=[];for(b=0;b<c.length;b++)g.push(c[b].Db);b=w(d,g,!0,e)}h=b;break;case a.Si:b=g;e=null;for(g=0;g<c.length;g++)if((e=w(c[g],b,0!=g,d))&&e.J.dupli_group){b=e.J.dupli_group.objects;for(var h=[],f=0;f<b.length;f++)h.push(b[f].Db);b=h}else break;h=e}return h};a.check_object=function(a){return Q[a.type]&&-1<Q[a.type].indexOf(a)?
!0:!1};a.pick_object=function(b,c){var d=x.Dg();if(!d)return M.error("No active scene"),null;var e=x.VB(d,b,c);if(!e)return null;for(var h=p(d,"MESH",-1),g=0;g<h.length;g++){var f=h[g].f,m=f.Zk;if(m&&3>Math.abs(255*m[0]-e[0])&&3>Math.abs(255*m[1]-e[1])&&3>Math.abs(255*m[2]-e[2]))return f.Mb&&f.rt&&(aa.outlining_overview_mode?(x.set_outline_color(aa.Ef),f.Ad=aa.Ad,a.apply_outline_anim(h[g],aa.Wl,aa.Xl,aa.Yl)):(x.set_outline_color(d.b4w_outline_color),f.Ad=d.b4w_outline_factor,d=f.Tj,a.apply_outline_anim(h[g],
d.Wl,d.Xl,d.Yl))),h[g]}return null};a.set_wind_params=function(a,b){for(var d=p(a,"EMPTY",-1),e=0;e<d.length;e++){var h=d[e];if(h.Kh&&"WIND"===h.Kh.type)var g=h}if(!g)return M.error("There is no wind on the scene"),0;"number"==typeof b.wind_dir&&(R.set(-Math.PI/2,b.wind_dir/180*Math.PI,0,la),fa.euler_to_quat(la,ba),T.set_rotation(g,ba),c(g));"number"==typeof b.wind_strength&&(g.Kh.yu=b.wind_strength,c(g));x.Qp(a)};a.get_parent=function(a){return a.Nc?null:a.parent};a.get_dg_parent=C;a.remove_object=
function(a){v.Wx(a)&&v.remove(a);if(a.Nc&&a.parent&&a.parent.J.dupli_group.objects){var b=a.parent.J.dupli_group.objects.indexOf(a);-1!=b&&a.parent.J.dupli_group.objects.splice(b,1)}var b=Q.ALL,c=Q[a.type],d=b.indexOf(a);a=c.indexOf(a);-1!=d&&b.splice(d,1);-1!=a&&c.splice(a,1)}};b4w.module.__obj_util=function(a,q){function d(a,b,c){c||(c=a);return{data:null,af:[],ke:[],rd:null,name:a,Ro:c,type:b,UA:!1,pa:!1,so:!1,Tu:!1,f:null,qb:null,w:null,Ka:null,Kk:null,anchor:null,Kh:null,bt:null,aa:[],Pb:[],td:[],H:[],dk:[],Ql:[],parent:null,Nc:!1,Yj:"",Li:!1,oc:!1,is_character:!1,Hg:!1,m:null,l:null,gd:null,yc:null,Lh:null,Yq:null,Vo:[],Bd:{cm:"NO_COLLISION",rk:!1,Wu:!1,Vd:0,av:0,$u:0,An:0,hp:0,pB:!1,qB:!1,rB:!1,sB:!1,tB:!1,uB:!1,gj:0,ej:0,hj:0,Rp:!1,Yk:"BOX",qk:!1},J:null}}function c(a){if(!(a instanceof
Object))return a;var b=null,d=null,f=null;a.S&&(b=a.S,a.S=null);a.Ob&&(d=a.Ob,a.Ob=null);a.ba&&(f=a.ba,a.ba=null);var l;l=a.constructor;switch(l){case Float32Array:case Uint32Array:case Uint16Array:l=new l(a);break;case Array:l=new l(a.length);for(var n=0;n<a.length;n++)l[n]=c(a[n]);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:l=a;break;case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:l=null;break;case Function:l=a;break;default:for(n in l=new l,a)l[n]=c(a[n])}b&&(l.S=
b,a.S=b);d&&(l.Ob=d,a.Ob=d);f&&(l.ba=f,a.ba=f);return l}function b(a,b){for(var c=a.aa,d=0;d<c.length;d++){var f=c[d];if(f.Xb==b)return f}return null}var l=q("__camera"),f=q("__mat4");q("__print");var k=q("__quat"),n=q("__tsr"),r=q("__vec4");a.Eh=function(a){a={type:a,lc:0,AA:[0,0],i:new Float32Array(3),quat:new Float32Array(4),Ma:new Float32Array(8),Z:new Float32Array(16),Ds:new Float32Array(16),Vb:new Float32Array(3),ec:new Float32Array(3),Vh:0,Wh:0,ro:!1,Zk:null,Ad:0,Ep:!1,Uu:!1,Ca:l.MS_STATIC,
Wp:1,Vp:1,Xp:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,we:null,Lu:!1,ve:0,ug:0,jb:!1,dc:null,jc:null,Gb:null,Hn:!0,L:null,Tj:null,cd:null,Oc:null,gc:new Float32Array(4),Aj:0,vj:0,Qj:0,Qg:0,Sc:!1,wc:!1,vc:!1,hc:!1,Wb:!1,sc:!1,Xd:"",qe:!1,Zc:!1,kl:!1,Rd:!1,Eb:!1,Gh:!1,Uh:!1,Kl:!1,jh:!1,Vl:!1,Mb:!1,Ul:!1,rt:!1,Gl:!1,is_visible:!1,Sn:!1,uk:0,ge:0,We:0,ue:0,te:0,oe:0,Ge:"",Tb:null,Ok:!1,sd:!1,$m:!1,$i:"",Zi:!1,Ag:0,time:0,Up:0,Yu:0,Ie:0,zj:!1,Pb:!1,fe:!1,Lf:[],Yh:!1,df:!1,cf:1,Qm:0,Pm:1,xm:new Int8Array([-1,
-1]),rm:[],at:[],hu:[],Qc:null,Pc:null,Xc:null,Wc:null,ad:null,zt:null,Sm:null,Rm:null,He:null,Sg:null,Ll:null,Lc:null,Rg:null,Ml:null,Ah:null,Ib:null,Xm:null,Vm:null,Wm:null,lb:null,bd:null,Jb:null,ef:null,ig:null,scale:1,xf:1E4};k.identity(a.quat);n.identity(a.Ma);f.identity(a.Z);f.identity(a.Ds);return a};a.un=d;a.rr=function(a){a=d(a,"MESH");a.UA=!0;a.particle_systems=[];return a};a.pg=c;a.pa=function(a){return a.pa};a.Jj=function(a){return"MESH"==a.type&&a.pa};a.Jk=function(a,b){a.aa.push({Xb:b,
Dl:!1,T:[],Gf:null,jf:null,eu:[],Pj:0})};a.Ik=function(a,c,d){b(a,c).T.push(d)};a.hH=function(a,b){for(var c=a.aa,d=0;d<c.length;d++)if(c[d].Xb==b){c.splice(d,1);break}};a.Ja=b;a.Ru=function(a,b){for(var c=0;c<a.length;c++)r.copy(b,a[c].f.gc)};a.jp=function(a,b,c){for(var d=0;d<a.aa.length;d++){var f=a.aa[d];c&&f.Xb!=c||(f.Dl=b)}};a.Zn=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.Ka.Xr)return c}return null}};b4w.module.__particles=function(a,q){function d(){throw"_rand() undefined";}function c(a,b,c,d,e,f,l){var n=a.jl,v=a.wd,m=a.time;a=a.Dt;for(var t=b?4:1,r=0;r<n.length;r+=t){var q=n[r];if(m>a&&m>=q&&q>a||m<a&&(q>a||m>=q))for(q=0;8>q;q++)v[8*r+q]=e[q];for(q=0;8>q;q++)g[q]=v[8*r+q];q=h;q[0]=c[3*r];q[1]=c[3*r+1];q[2]=c[3*r+2];k.transform_vec3(q,g,q);f[3*r]=q[0];f[3*r+1]=q[1];f[3*r+2]=q[2];var A=h;A[0]=d[3*r];A[1]=d[3*r+1];A[2]=d[3*r+2];k.transform_dir_vec3(A,g,A);l[3*r]=A[0];l[3*r+1]=A[1];l[3*r+2]=A[2];
if(b)for(q=1;4>q;q++)f[3*(r+q)]=f[3*r],f[3*(r+q)+1]=f[3*r+1],f[3*(r+q)+2]=f[3*r+2],l[3*(r+q)]=A[0],l[3*(r+q)+1]=A[1],l[3*(r+q)+2]=A[2]}}function b(a){a?(n.xD(a),d=function(){return n.mC()}):d=function(){return Math.random()}}var l=q("__config"),f=q("__geometry");q("__scenes");var k=q("__tsr"),n=q("__util"),r=q("__vec3"),e=l.me,g=new Float32Array(8),h=new Float32Array(3);a.gi=function(a){a=a.aa;for(var b=0;b<a.length;b++)for(var c=a[b].T,d=0;d<c.length;d++)if(c[d].ra)return!0;return!1};a.Qo=function(a){a=
a.aa;for(var b=0;b<a.length;b++)for(var c=a[b].T,d=0;d<c.length;d++){var e=c[d].ra;if(e&&"EMITTER"==e.So)return!0}return!1};a.Ix=function(a){return 0<a.particle_systems.length};a.Hx=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;return!1};a.EA=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.JA=function(a,b,c){var d=a.ra={name:b.name,
So:b.settings.type,time:0,Dt:-1,Tp:!1,G:0,N:0,Hu:0,Ao:0,Us:0,cyclic:!1,Vd:0,Oo:0,ps:0,xg:0,Hc:0,jv:0,size:0,xq:0,wq:0,gu:0,hr:0,fu:new Float32Array(8),gr:new Float32Array(16),ji:null,At:null,jt:null,kt:null,jl:null,Dn:null,wd:null};d.G=b.settings.frame_start;d.N=b.settings.frame_end;d.Hu=(d.N-d.G)/e.Pa;d.Ao=b.settings.lifetime;d.Us=d.Ao/e.Pa;d.cyclic=b.settings.b4w_cyclic?1:0;d.Vd=b.settings.mass;d.Oo=b.settings.normal_factor;d.ps=9.81*b.settings.effector_weights.gravity;d.xg=b.settings.b4w_fade_in/
e.Pa;d.Hc=b.settings.b4w_fade_out/e.Pa;d.jv=b.settings.effector_weights.wind;d.Tp="WORLD"==b.settings.b4w_coordinate_system?!0:!1;var h,g;a.Eg?(a=c.halo.size,h=c.halo.hardness,30>h?(h=.5,g=.9):40>h?(h=.1,g=1):50>h?(h=0,g=.8):(h=0,g=.5)):(a=b.settings.particle_size,g=h=1);d.size=a;d.xq=h;d.wq=g;a=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(a[0]&&a[0].use_map_size&&a[0].texture&&"BLEND"==a[0].texture.type&&a[0].texture.use_color_ramp){a=a[0].texture.color_ramp.elements;h=Math.min(2*a.length,
b.length);for(g=0;g<h;g+=2){var f=a[g/2];b[g]=f.position;b[g+1]=(f.color[0]+f.color[1]+f.color[2])/3}d.gu=a.length}d.fu.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){a=b[0].texture.color_ramp.elements;h=Math.min(4*a.length,c.length);for(g=0;g<h;g+=4)f=a[g/4],c[g]=f.position,c[g+1]=f.color[0],c[g+2]=f.color[1],c[g+3]=f.color[2];d.hr=a.length}d.gr.set(c)};a.Mz=function(a,
h,g,l){var k=a.ra,u=g.settings.count,D=g.settings.frame_start/e.Pa,G=g.settings.frame_end/e.Pa,v=g.settings.lifetime/e.Pa,m=g.settings.lifetime_random,t=g.settings.emit_from,z=g.settings.factor_random,q=g.settings.angular_velocity_mode,A=g.settings.angular_velocity_factor,J=g.settings.b4w_randomize_emission,N=g.settings.b4w_cyclic,M=!a.Eg;b(g.seed);h=f.Lr(h,["a_position","a_normal"],null);switch(t){case "VERT":g=h.B[0].a_position;h=h.B[0].a_normal;for(var y=g.length/3,t=[],K=0;K<u;K++){var x=Math.round((y-
1)*d());t.push(x);M&&(t.push(x),t.push(x),t.push(x))}y=[];for(K=0;K<t.length;K++)y.push(g[3*t[K]]),y.push(g[3*t[K]+1]),y.push(g[3*t[K]+2]);g=new Float32Array(y);y=[];for(K=0;K<t.length;K++)y.push(h[3*t[K]]),y.push(h[3*t[K]+1]),y.push(h[3*t[K]+2]);t=new Float32Array(y);break;case "FACE":g=[];t=[];K=[];n.Bl(0,K);y=f.Wn(h,u,!1,K);n.Bl(0,K);h=f.Wn(h,u,!0,K);for(K=0;K<y.length;K++)g.push(y[K][0],y[K][1],y[K][2]),M&&(g.push(y[K][0],y[K][1],y[K][2]),g.push(y[K][0],y[K][1],y[K][2]),g.push(y[K][0],y[K][1],
y[K][2])),t.push(h[K][0],h[K][1],h[K][2]),M&&(t.push(h[K][0],h[K][1],h[K][2]),t.push(h[K][0],h[K][1],h[K][2]),t.push(h[K][0],h[K][1],h[K][2]));g=new Float32Array(g);t=new Float32Array(t);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}t=[g,t];h=t[0];t=t[1];k.ji=new Float32Array(h);k.jt=new Float32Array(t);k.At=new Float32Array(h.length);k.kt=new Float32Array(t.length);g=[];G=(G-D)/u;for(y=0;y<u;y++)K=J?G*y+10*G*(.5-d()):G*y,N||(K+=D),
g.push(K),M&&(g.push(K),g.push(K),g.push(K));D=new Float32Array(g);k.jl=new Float32Array(D);k.Dn=new Float32Array(D);k.wd=new Float32Array(8*D.length);for(J=0;J<8*D.length;J++)for(N=0;8>N;N++)k.wd[8*J+N]=l[N];k.Tp&&c(k,M,h,t,l,h,t);l=n.vb("EMITTER_PARTICLES");k=n.ud();k.a_position=h;k.a_normal=t;l.B[0]=k;if(M){a.xe=f.yk;a=[];for(k=0;k<u;k++)a.push(4*k,4*k+2,4*k+1,4*k,4*k+3,4*k+2);a=new Uint16Array(a);l.oa=a;a=l.M;k=[];for(J=0;J<u;J++)k.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);k=new Float32Array(k);a.a_p_bb_vertex=
k}else a.xe=f.fq,l.oa=new Uint16Array(0);l.P=h.length/3;l.M.a_p_delay=D;a=l.M;k=[];m*=v;for(D=0;D<u;D++)J=m*d(),k.push(v-J),M&&(k.push(v-J),k.push(v-J),k.push(v-J));v=new Float32Array(k);a.a_p_lifetime=v;v=l.M;m=[];for(a=0;a<u;a++){k=[d()-.5,d()-.5,d()-.5];r.normalize(k,k);m.push(z*k[0]);m.push(z*k[1]);m.push(z*k[2]);switch(q){case "NONE":m.push(0);break;case "SPIN":case "VELOCITY":m.push(A);break;case "RAND":m.push(2*A*(d()-.5));break;default:throw"Undefined velocity factor";}if(M)for(k=m.slice(-4),
D=0;12>D;D++)m.push(k[D%4])}u=new Float32Array(m);v.a_p_vels=u;return l};a.eE=function(a,b){for(var d=0;d<b.length;d++){var e=b[d],h=b[d].ra;if(h){var g=e.R;if(!h.Tp)break;var l=h.At,n=h.kt;c(h,!e.Eg,h.ji,h.jt,a.f.Ma,l,n);f.zB(g);f.ym(g,"a_position",3,l);f.ym(g,"a_normal",3,n)}}};a.YC=function(a,b,c){a=a.aa;for(var d=0;d<a.length;d++)for(var e=a[d].T,h=0;h<e.length;h++){var g=e[h].ra;g&&g.name==b&&(g.Dt=g.time,g.time=c)}};a.gC=function(a){for(var b=a.P,c=a.B[0].a_position,d=a.M.a_texcoord,e=[],h=
[],g=0;g<b;g++)h.push(c[3*g]),h.push(c[3*g+1]),e.push(c[3*g+2]);e=new Float32Array(e);h=new Float32Array(h);a.M.a_lf_dist=e;a.M.a_lf_bb_vertex=h;a.M.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.aa;for(var d=0;d<a.length;d++)for(var e=a[d].T,h=0;h<e.length;h++){var g=e[h].ra;g&&g.name==b&&(g.size=c)}};a.set_normal_factor=function(a,b,c){a=a.aa;for(var d=0;d<a.length;d++)for(var e=a[d].T,h=0;h<e.length;h++){var g=e[h].ra;g&&g.name==b&&(g.Oo=c)}};a.set_factor=function(a,b,c){a=a.aa;for(var d=
0;d<a.length;d++)for(var e=a[d].T,h=0;h<e.length;h++){var g=e[h],l=g.ra;if(l&&l.name==b){var n=l.jl;if(1==c)l=n;else if(0==c)for(var m=!g.Eg,k=m?4:1,l=l.Dn,r=0;r<l.length;r+=k)l[r]=1E4,m&&(l[r+1]=l[r],l[r+2]=l[r],l[r+3]=l[r]);else for(var q=1/c,l=l.Dn,k=(m=!g.Eg)?4:1,A=0,r=0;r<l.length;r+=k)r>=A?(l[r]=n[r],A+=q):l[r]=1E4,m&&(l[r+1]=l[r],l[r+2]=l[r],l[r+3]=l[r]);f.ym(g.R,"a_p_delay",1,l)}}};a.pE=function(a,b,c){a=a.aa;for(var d=0;d<a.length;d++)for(var e=a[d].T,h=0;h<e.length;h++){var g=e[h].ra;if(g)for(var f=
0;f<8*g.jl.length;f++)g.wd[8*f]=b[0],g.wd[8*f+1]=b[1],g.wd[8*f+2]=b[2],g.wd[8*f+3]=b[3],g.wd[8*f+4]=c[0],g.wd[8*f+5]=c[1],g.wd[8*f+6]=c[2],g.wd[8*f+7]=c[3]}}};b4w.module.__primitives=function(a,q){function d(a,b,c,d){for(var f=[],l=[],k=[],r=[],u=2*c/(a-1),D=2*d/(b-1),G=0;G<a;G++)for(var v=-c+G*u,m=0;m<b;m++)if(l.push(v,0,-d+m*D),k.push(0,1,0),r.push(G/(a-1),m/(b-1)),G&&m){var t=G*b+m,q=t-1,L=(G-1)*b+m,A=L-1;f.push(t,q,L);f.push(q,A,L)}a=n.ud();a.a_position=new Float32Array(l);a.a_normal=new Float32Array(k);k=n.vb("GRID_PLANE");k.B[0]=a;k.M.a_texcoord=new Float32Array(r);k.oa=new Uint32Array(f);k.P=l.length/3;return k}function c(a){var b=a.length;if(b%
4)throw"Wrong array";for(var c=[],d=[],f=0;f<b;f+=4){var k=a[f+1],r=a[f+2],q=a[f+3];l(a[f],d);l(k,d);l(r,d);l(q,d);c.push(f,f+1,f+2);c.push(f,f+2,f+3)}a=n.ud();a.a_position=new Float32Array(d);b=n.vb("FROM_QUADS");b.B[0]=a;b.oa=new Uint32Array(c);b.P=d.length/3;return b}function b(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function l(a,b){b.push(a[0],a[1],a[2])}var f=q("__config"),k=q("__geometry");q("__print");var n=q("__util"),r=f.q;a.rG=function(a){for(var b=n.vb("LINE"),c=[],d=0;d<2*a;d++)c.push(d);
d=n.ud();d.a_point=new Float32Array(c);b.B[0]=d;b.oa=new Uint32Array(c);b.P=2*a;return b};a.sG=function(a,b){var c=d(2,2,a,b);c.name="PLANE";return c};a.qG=d;a.Rz=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==H-1)||1==b%2&&(0==a||a==q-1)?!0:!1}var f=c/=Math.pow(2,a-1),l=c,q=b+1,H=b+1;b=[];c=[];for(var u=0,D=0,G=-1,v=[],m=0;m<a;m++){for(var t=2*f/(q-1),z=2*l/(H-1),L=[],A=[],J=0,N=0;N<q;N++){for(var M=-f+N*t,y=[],K=0;K<H;K++){var x=-l+K*z;if(M>-u&&M<u&&x>-D&&x<D)y.push(-1),J++;else{for(var S=
null,T=0;T<v.length;T+=3)if(M==v[T]&&x==v[T+1]){S=v[T+2];break}T=null!==S?S:G+1;d(N,K)?(y.push(-2),J++):(null==S&&(0==K||K==H-1||0==N||N==q-1?(S=m==a-1?t:2*t,L.push(M,x,T)):S=t,c.push(M,S,x),G++),y.push(T));if(N&&K)if(1==N)if(d(N-1,K)){if(1<K){var x=T-1,S=A[N-1][K+1],U=S-1;b.push(T,x,U)}else S=A[N-1][K+1],U=S-1;b.push(T,U,S)}else d(N,K)||(x=T-1,S=A[N-1][K],b.push(T,x,S));else if(N==q-1){if(!d(N,K))if(K==H-1)x=T-1,S=A[N-1][K-1],U=A[N-2][K],b.push(T,x,S),b.push(T,S,U);else{var x=T-1,S=A[N-1][K],U=S-
1,fa=S+1;b.push(T,x,U);b.push(T,U,S);b.push(T,S,fa);2==K&&(fa=A[N-2][K-2],b.push(x,fa,U))}}else 1==K?d(N,K-1)?(x=A[N-1][K],S=A[N-1][K-1],b.push(T,S,x)):(x=y[K-1],S=A[N-1][K],U=A[N-2][K-1],b.push(T,x,S),b.push(x,U,S)):K==H-1?d(N,K)||(x=y[K-1],S=A[N-1][K-1],U=A[N-2][K],b.push(T,x,S),b.push(T,S,U)):-1!=A[N-1][K]&&-1!=A[N-1][K-1]&&-1!=y[K-1]?(x=y[K-1],S=A[N-1][K],U=A[N-1][K-1],b.push(T,x,S),b.push(x,U,S),K==H-2&&d(N,K+1)&&(fa=A[N-1][K+1],b.push(T,S,fa))):K==H-2&&d(N,K+1)&&(S=A[N-1][K],fa=A[N-1][K+1],
b.push(T,S,fa))}}A.push(y)}v=L;u=f;D=l;f*=2;l*=2}2E4>u&&(a=-(2*u)/(q-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-u,a,-D),c.push(-u,a,D),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(u,a,-D),c.push(u,a,D),T=G+1,b.push(T+3,T+2,T+1,T+2,T+0,T+1,T+6,T+4,T+2,T+4,T+0,T+2,T+5,T+7,T+1,T+7,T+3,T+1,T+5,T+4,T+7,T+7,T+4,T+6));a=n.ud();a.a_position=new Float32Array(c);f=n.vb("multigrid_plane");f.B[0]=a;f.oa=new Uint32Array(b);f.P=c.length/3;r.iv&&(k.um(f,1,!0),a.a_polyindex=k.Nn(f));return f};a.pG=function(a){var b=
a.length;if(b%3)throw"Wrong array";for(var c=[],d=[],f=0;f<b;f+=3){var k=a[f+1],r=a[f+2];l(a[f],d);l(k,d);l(r,d);c.push(f,f+1,f+2)}a=n.ud();a.a_position=new Float32Array(d);b=n.vb("FROM_TRIANGLES");b.B[0]=a;b.oa=new Uint32Array(c);b.P=d.length/3;return b};a.oG=c;a.Nz=function(a){a=n.ME(a);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=c(b);a.name="FRUSTUM";return a};
a.wb=function(){var a=n.vb("FULLSCREEN_TRI"),b=n.ud();b.a_position=new Float32Array([0,0,1,0,0,1]);a.B[0]=b;a.oa=new Uint32Array([0,1,2]);a.P=3;return a};a.Oz=function(){var a=n.vb("FULLSCREEN_QUAD"),b=n.ud();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.B[0]=b;a.oa=new Uint32Array([0,2,1,1,2,3]);a.P=4;return a};a.Jz=function(){var a=n.vb("BILLBOARD"),b=n.ud();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.B[0]=b;a.oa=new Uint32Array([0,2,1,0,3,2]);a.P=4;return a};a.Kz=function(){var a=
n.vb("CUBEMAP_BOARD"),b=n.ud();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.B[0]=b;a.oa=new Uint32Array([0,2,1,0,3,2]);a.P=4;return a};a.Vn=function(a,c){var d=n.vb("UV_SPHERE"),f,r,q=[],B=[],H=[];for(r=0;8>=r;r++)for(f=0;16>=f;f++){var u=f/16,D=r/8;B.push(-a*Math.cos(2*u*Math.PI)*Math.sin(D*Math.PI)+c[0],a*Math.cos(D*Math.PI)+c[1],a*Math.sin(2*u*Math.PI)*Math.sin(D*Math.PI)+c[2])}for(r=u=0;8>r;r++)for(f=0;16>f;f++){var D=b(B,17*r+f+1),G=b(B,17*r+f),v=b(B,17*(r+1)+f),m=b(B,17*(r+1)+f+1);
Math.abs(D[1])==a+c[1]?(l(D,q),l(v,q),l(m,q),H.push(u,u+1,u+2),u+=3):Math.abs(v[1])==a+c[1]?(l(D,q),l(G,q),l(v,q),H.push(u,u+1,u+2),u+=3):(l(D,q),l(G,q),l(v,q),l(m,q),H.push(u,u+1,u+2),H.push(u,u+2,u+3),u+=4)}f={};f.a_position=q;B=k.Sq(H,B,q);f.a_normal=k.Qq(H,q,B);f.a_tangent=[];d.M.a_influence=[];d.M.a_color=[];d.M.a_texcoord=[];d.B[0]=f;d.oa=H;d.P=q.length/3;return d};a.Wr=function(a){var b=n.vb("INDEX"),c=n.ud();c.a_index=new Float32Array(a);for(var d=0;d<a;d++)c.a_index[d]=d;b.B[0]=c;b.oa=new Uint16Array(0);
b.P=a;return b}};b4w.module.__prerender=function(a,q){function d(a,c){var d=a.zd,e=c.j;d.is_visible=!1;var f;if(!(f=!d||d.Uh)){var l=e.of,n=d.Jb.F;f=d.xf;l=Math.sqrt((n[0]-l[0])*(n[0]-l[0])+(n[1]-l[1])*(n[1]-l[1])+(n[2]-l[2])*(n[2]-l[2]));n=d.Qg*d.Jb.La;f=!(l>=d.Qj&&l<f+n)}if(f)return!1;d.is_visible=!0;(f="OUTLINE_MASK"==c.type&&!Boolean(d.Ad))||(e=e.Bj,d.Gh?f=!1:("STATIC"===d.type?(f=d.Jb,d=f.F,d=k.sD(d,e,f.La)):(f=d.ig,d=f.F,d=k.mz(d,e,f.Ld,f.Md,f.Nd)),f=d));return f?!1:"WIREFRAME"==c.type?a.D.wireframe_mode==b.nq.WM_DEBUG_SPHERES?
a.D.sg:!a.D.sg:!0}var c=q("__config"),b=q("__debug"),l=q("__geometry"),f=q("__renderer"),k=q("__util"),n=q("__vec3"),r=c.q,e="MAIN_OPAQUE MAIN_BLEND MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_GLOW SHADOW_CAST DEPTH OUTLINE_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.Xo=function(a){if(-1<e.indexOf(a.type)){for(var b=!1,c=a.o,k=0;k<c.length;k++){var q=c[k];if("MAIN_CUBE_REFLECT"==a.type)for(var B=0;6>B;B++)a.j.Bj=a.xn[B],q.Fn[B]=d(q,a),q.Fn[B]&&(b=!0);else q.cb=d(q,a),q.cb&&
(b=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||b?a.cb=!0:(a.cb&&f.clear(a),a.cb=!1)}}if("MAIN_BLEND"==a.type&&r.alpha_sort&&a.o){b=a.j.of;c=n.dist(b,a.mv)>r.alpha_sort_threshold;for(k=0;k<a.o.length;k++)if(B=a.o[k],q=B.zd,q.Sn||c){var H=B.D;if(H&&H.Ha&&H.Ze!=l.je){H=H.R;if(!H||!B.cb)continue;(B=H.Al)&&B.type==l.oq&&l.ZD(H,q.Z,b)}q.Sn=!1}c&&n.copy(b,a.mv)}}};b4w.module.__print=function(a){function q(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var d=1;d<a.length;d++)c.push(a[d]);return c}var d=!1,c=0,b=0;a.ZC=function(a){d=a};a.Eo=function(){console.log.apply(console,arguments)};a.log=function(){if(d){var a=q(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=function(){c++;var a=q(arguments,"B4W ERROR");console.error.apply(console,a)};a.warn=function(){b++;var a=q(arguments,"B4W WARN");console.warn.apply(console,
a)};a.info=function(){var a=q(arguments,"B4W INFO");console.info.apply(console,a)};a.qz=function(){c++;var a=q(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.rz=function(){b++;var a=q(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){d&&console.time.apply(console,arguments)};a.timeEnd=function(){d&&console.timeEnd.apply(console,arguments)};a.group=function(){d&&console.group.apply(console,arguments)};a.groupCollapsed=function(){d&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){d&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.yA=function(){return b};a.gA=function(){return c};a.clear_errors_warnings=function(){c=b=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,q){function d(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"alpha"in a||(a.alpha=1,b("node material",a,"alpha"));"darkness"in a||(a.darkness=1,b("node material",a,"darkness"));"diffuse_toon_size"in a||(a.diffuse_toon_size=.5,b("node material",a,"diffuse_toon_size"));"diffuse_toon_smooth"in a||(a.diffuse_toon_smooth=.1,b("node material",a,"diffuse_toon_smooth"));"diffuse_intensity"in
a||(a.diffuse_intensity=1,b("node material",a,"diffuse_intensity"));"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_ior"in a||(a.specular_ior=4,b("node material",a,"specular_ior"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=.5,b("node material",a,"specular_toon_size"));
"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in a||(a.diffuse_fresnel_factor=.5,b("node material",
a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name="B4W_"+a.node_tree_name}}}
function c(a){if(a=a.nla_tracks)for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.strips.length;e++){var h=d.strips[e];"action"in h||(h.action=null,b("strip",h,"action"));"action_frame_start"in h||(h.action_frame_start=0,b("strip",h,"action_frame_start"));"action_frame_end"in h||(h.action_frame_end=h.frame_end-h.frame_start,b("strip",h,"action_frame_end"));"repeat"in h||(h.repeat=1,b("strip",h,"repeat"));"use_reverse"in h||(h.use_reverse=!1,b("strip",h,"use_reverse"));"scale"in h||(h.scale=1,b("strip",
h,"scale"))}}function b(a,b,c){c=c+">>"+a;c in B||(B[c]={wp:[],Qt:"undefined",type:a});B[c].wp.push(b.name)}function l(a,b,c){c=c+">>"+a;c in B||(B[c]={wp:[],Qt:"deprecated",type:a});B[c].wp.push(b.name)}function f(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=h.mg(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var f=h.dj(d[c]);e.submeshes.push(f)}return e}var k=q("__boundings"),n=
q("__curve"),r=q("__mat4"),e=q("__print"),g=q("__quat"),h=q("__util"),p=q("__vec3"),w=q("__vec4"),C=[5,4],B={};a.ar=function(a){return-1!=h.bv(a,C)};a.Ux=function(a){B={};var f=a.worlds;if(0==f.length){e.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var g={name:"DEFAULT",horizon_color:new Float32Array([0,0,0]),zenith_color:new Float32Array([0,0,0]),light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},fog_settings:{use_fog:!1,
intensity:0,depth:25,start:5,height:0,falloff:"INVERSE_QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,texture_slots:[]};f.push(g)}for(var f=a.worlds,n=0;n<f.length;n++){g=f[n];"use_sky_blend"in g||(b("world",g,"use_sky_blend"),g.use_sky_blend=!1);"use_sky_paper"in g||(b("world",g,"use_sky_paper"),g.use_sky_paper=!1);"use_sky_real"in g||(b("world",g,"use_sky_real"),g.use_sky_real=!1);"b4w_sky_settings"in g&&"rayleigh_brightness"in g.b4w_sky_settings||
(b("world",g,"rayleigh_brightness"),g.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"fog_settings"in g||(b("world",g,"fog_settings"),g.fog_settings={use_fog:!1,intensity:0,depth:25,start:0,height:0,falloff:"QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},
"b4w_fog_color"in g&&(g.fog_settings.use_custom_color=!0,g.fog_settings.color=g.b4w_fog_color),"b4w_fog_density"in g&&0<g.b4w_fog_density&&(g.fog_settings.depth=1/g.b4w_fog_density));"render_sky"in g.b4w_sky_settings||(b("world",g,"render_sky"),g.b4w_sky_settings.render_sky=!1);for(var k=g.texture_slots,g=0;g<k.length;g++){var m=k[g];"blend_type"in m||(m.blend_type="MIX",b("world_texture_slot",m,"blend_type"));"use_map_blend"in m||(m.use_map_blend=!1,b("world_texture_slot",m,"use_map_blend"));"use_map_horizon"in
m||(m.use_map_horizon=!0,b("world_texture_slot",m,"use_map_horizon"));"use_map_zenith_up"in m||(m.use_map_zenith_up=!1,b("world_texture_slot",m,"use_map_zenith_up"));"use_rgb_to_intensity"in m||(m.use_rgb_to_intensity=!1,b("world_texture_slot",m,"use_rgb_to_intensity"));"invert"in m||(m.invert=!1,b("world_texture_slot",m,"invert"));"color"in m||(m.color=[1,0,1],b("world_texture_slot",m,"color"));"blend_factor"in m||(m.blend_factor=0,b("world_texture_slot",m,"blend_factor"));"horizon_factor"in m||
(m.horizon_factor=1,b("world_texture_slot",m,"horizon_factor"));"zenith_up_factor"in m||(m.zenith_up_factor=0,b("world_texture_slot",m,"zenith_up_factor"));"zenith_down_factor"in m||(m.zenith_down_factor=0,b("world_texture_slot",m,"zenith_down_factor"));"default_value"in m||(m.default_value=1,b("world_texture_slot",m,"default_value"))}}g=a.scenes;for(n=0;n<g.length;n++)k=g[n],m=k.world,"timeline_markers"in k||(k.timeline_markers=null,b("scene",k,"timeline_markers")),"b4w_reflection_quality"in k||
(k.b4w_reflection_quality="MEDIUM",b("scene",k,"b4w_reflection_quality")),"b4w_use_nla"in k||(k.b4w_use_nla=!1,b("scene",k,"b4w_use_nla")),"fps"in k||(k.fps=24,b("scene",k,"fps")),"b4w_nla_cyclic"in k||(k.b4w_nla_cyclic=!1,b("scene",k,"b4w_nla_cyclic")),"b4w_logic_nodes"in k||(k.b4w_logic_nodes=[],b("scene",k,"b4w_logic_nodes")),"b4w_detect_collisions"in k&&(l("scene",k,"b4w_detect_collisions"),delete k.b4w_detect_collisions),"audio_doppler_speed"in k||(k.audio_doppler_speed=343.3),"audio_doppler_factor"in
k||(k.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in k||(k.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",k,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in k||(k.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in k||(k.b4w_enable_bloom=!1,b("scene",k,"b4w_enable_bloom")),"b4w_enable_motion_blur"in k||(k.b4w_enable_motion_blur=!1,b("scene",k,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in k||(k.b4w_enable_color_correction=
!1,b("scene",k,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in k||(k.b4w_enable_antialiasing=!0,b("scene",k,"b4w_enable_antialiasing")),"b4w_tags"in k||(k.b4w_tags={title:"",description:""},b("scene",k,"b4w_tags")),"b4w_enable_object_selection"in k||(k.b4w_enable_object_selection="AUTO",b("scene",k,"b4w_enable_object_selection")),"b4w_enable_outlining"in k||(k.b4w_enable_outlining="AUTO",b("scene",k,"b4w_enable_outlining")),"b4w_enable_glow_materials"in k||(k.b4w_enable_glow_materials=
"AUTO",b("scene",k,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in k||(k.b4w_enable_anchors_visibility="AUTO",b("scene",k,"b4w_enable_anchors_visibility")),"b4w_outline_color"in k||(k.b4w_outline_color=[1,1,1],b("scene",k,"b4w_outline_color")),"b4w_outline_factor"in k||(k.b4w_outline_factor="b4w_glow_factor"in k?k.b4w_glow_factor:1,b("scene",k,"b4w_outline_factor")),"b4w_shadow_settings"in k||(b("scene",k,"b4w_shadow_settings"),f=m.b4w_shadow_settings,k.b4w_shadow_settings=f?f:{csm_resolution:2048,
self_shadow_polygon_offset:1,b4w_enable_csm:!1,csm_num:1,csm_first_cascade_border:10,first_cascade_blur_radius:3,csm_last_cascade_border:100,last_cascade_blur_radius:1.5,fade_last_cascade:!0,blend_between_cascades:!0}),f=k.b4w_shadow_settings,"csm_resolution"in f||(b("scene",k,"b4w_shadow_settings.csm_resolution"),f.csm_resolution=2048),"self_shadow_polygon_offset"in f||(b("scene",k,"b4w_shadow_settings.self_shadow_polygon_offset"),f.self_shadow_polygon_offset=1),"self_shadow_normal_offset"in f||
(b("scene",k,"b4w_shadow_settings.self_shadow_normal_offset"),f.self_shadow_normal_offset=.01),"b4w_enable_csm"in f||(b("scene",k,"b4w_shadow_settings.b4w_enable_csm"),f.b4w_enable_csm=!1),"csm_num"in f||(b("scene",k,"b4w_shadow_settings.csm_num"),f.csm_num=1),"csm_first_cascade_border"in f||(b("scene",k,"b4w_shadow_settings.csm_first_cascade_border"),f.csm_first_cascade_border=10),"first_cascade_blur_radius"in f||(b("scene",k,"b4w_shadow_settings.first_cascade_blur_radius"),f.first_cascade_blur_radius=
3),"csm_last_cascade_border"in f||(b("scene",k,"b4w_shadow_settings.csm_last_cascade_border"),f.csm_last_cascade_border=100),"last_cascade_blur_radius"in f||(b("scene",k,"b4w_shadow_settings.last_cascade_blur_radius"),f.last_cascade_blur_radius=1.5),"fade_last_cascade"in f||(b("scene",k,"b4w_shadow_settings.fade_last_cascade"),f.fade_last_cascade=!0),"blend_between_cascades"in f||(b("scene",k,"b4w_shadow_settings.blend_between_cascades"),f.blend_between_cascades=!0),"b4w_ssao_settings"in k||(b("scene",
k,"b4w_ssao_settings"),f=m.b4w_ssao_settings,k.b4w_ssao_settings=f?f:{dist_factor:0,samples:16,hemisphere:!1,blur_depth:!1,blur_discard_value:1}),f=k.b4w_ssao_settings,"dist_factor"in f||(b("scene",k,"b4w_ssao_settings.dist_factor"),f.dist_factor=0),"samples"in f||(b("scene",k,"b4w_ssao_settings.samples"),f.samples=16),"hemisphere"in f||(b("scene",k,"b4w_ssao_settings.hemisphere"),f.hemisphere=!1),"blur_depth"in f||(b("scene",k,"b4w_ssao_settings.blur_depth"),f.blur_depth=!1),"blur_discard_value"in
f||(b("scene",k,"b4w_ssao_settings.blur_discard_value"),f.blur_discard_value=1),"b4w_bloom_settings"in k||(b("scene",k,"b4w_bloom_settings"),f=m.b4w_bloom_settings,k.b4w_bloom_settings=f?f:{key:.2,blur:4,edge_lum:1}),"key"in k.b4w_bloom_settings||(b("scene",k,"b4w_bloom_settings.key"),k.b4w_bloom_settings.key=.2),"blur"in k.b4w_bloom_settings||(b("scene",k,"b4w_bloom_settings.blur"),k.b4w_bloom_settings.blur=4),"edge_lum"in k.b4w_bloom_settings||(b("scene",k,"b4w_bloom_settings.edge_lum"),k.b4w_bloom_settings.edge_lum=
1),"b4w_motion_blur_settings"in k||(b("scene",k,"b4w_motion_blur_settings"),f=m.b4w_motion_blur_settings,k.b4w_motion_blur_settings=f?f:{motion_blur_factor:.01,motion_blur_decay_threshold:.01}),"motion_blur_factor"in k.b4w_motion_blur_settings||(b("scene",k,"b4w_motion_blur_settings.motion_blur_factor"),k.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in k.b4w_motion_blur_settings||(b("scene",k,"b4w_motion_blur_settings.motion_blur_decay_threshold"),k.b4w_motion_blur_settings.motion_blur_decay_threshold=
.01),"b4w_color_correction_settings"in k||(b("scene",k,"b4w_color_correction_settings"),f=m.b4w_color_correction_settings,k.b4w_color_correction_settings=f?f:{brightness:0,contrast:0,exposure:1,saturation:1}),"b4w_god_rays_settings"in k||(b("scene",k,"b4w_god_rays_settings"),f=m.b4w_god_rays_settings,k.b4w_god_rays_settings=f?f:{intensity:.7,max_ray_length:1,steps_per_pass:10}),"steps_per_pass"in k.b4w_god_rays_settings||(b("scene",k,"b4w_god_rays_settings.steps_per_pass"),k.b4w_god_rays_settings.steps_per_pass=
10),"b4w_glow_settings"in k||(b("scene",k,"b4w_glow_settings"),k.b4w_glow_settings={render_glow_over_blend:!1,small_glow_mask_coeff:2,large_glow_mask_coeff:2,small_glow_mask_width:2,large_glow_mask_width:6},f=k.b4w_glow_settings,"b4w_render_glow_over_blend"in m&&(f.render_glow_over_blend=m.b4w_render_glow_over_blend),"b4w_small_glow_mask_coeff"in m&&(f.small_glow_mask_coeff=m.b4w_small_glow_mask_coeff),"b4w_large_glow_mask_coeff"in m&&(f.large_glow_mask_coeff=m.b4w_large_glow_mask_coeff),"b4w_small_glow_mask_width"in
m&&(f.small_glow_mask_width=m.b4w_small_glow_mask_width),"b4w_large_glow_mask_width"in m&&(f.large_glow_mask_width=m.b4w_large_glow_mask_width)),m=k.b4w_render_shadows,"AUTO"!=m&&"OFF"!=m&&"ON"!=m&&(k.b4w_render_shadows=m?"ON":"OFF"),m=k.b4w_render_reflections,"OFF"!=m&&"ON"!=m&&(k.b4w_render_reflections=m?"ON":"OFF"),m=k.b4w_render_refractions,"AUTO"!=m&&"OFF"!=m&&"ON"!=m&&(k.b4w_render_refractions=m?"ON":"OFF"),k.b4w_nla_script&&l("scene",k,"b4w_nla_script");k=a.meshes;for(n=0;n<k.length;n++){m=
k[n];m.b4w_bounding_box||(b("mesh",m,"b4w_bounding_box"),m.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});m.b4w_bounding_box_source||(b("mesh",m,"b4w_bounding_box_source"),m.b4w_bounding_box_source=m.b4w_bounding_box);m.uv_textures||(b("mesh",m,"uv_textures"),m.uv_textures=[]);m.b4w_bounding_sphere_center||(m.b4w_bounding_sphere_center=[0,0,0]);m.b4w_bounding_cylinder_center||(m.b4w_bounding_cylinder_center=[0,0,0]);m.b4w_bounding_ellipsoid_center||(m.b4w_bounding_ellipsoid_center=
[0,0,0]);m.b4w_bounding_ellipsoid_axes||(g=m.b4w_bounding_box,m.b4w_bounding_ellipsoid_axes=[(g.max_x-g.min_x)/2,(g.max_y-g.min_y)/2,(g.max_z-g.min_z)/2]);"b4w_shape_keys"in m||(m.b4w_shape_keys=[],b("mesh",m,"b4w_shape_keys"));for(var g=m,f=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],p=null,r=0;r<f.length;r++)g[f[r]]&&(p?(g[f[r]]=!1,e.warn('WARNING property "'+f[r]+'" of object "'+g.name+'" has been set to "false". Foreground property "'+
p+'" already exists.')):p=f[r]);for(g=0;g<m.b4w_vertex_anim.length;g++)f=m.b4w_vertex_anim[g],"allow_nla"in f||(b('mesh["b4w_vertex_anim"]',m,"allow_nla"),f.allow_nla=!0)}g=a.cameras;for(n=0;n<g.length;n++)k=g[n],k.type||(k.type="PERSP",b("camera",k,"type")),"b4w_eye_target_dist"in k&&(delete k.b4w_eye_target_dist,l("camera",k,"b4w_eye_target_dist")),"b4w_hover_zero_level"in k||(k.b4w_hover_zero_level=0,b("camera",k,"b4w_hover_zero_level")),"b4w_trans_velocity"in k||(k.b4w_trans_velocity=1,b("camera",
k,"b4w_trans_velocity")),"b4w_rot_velocity"in k||(k.b4w_rot_velocity=1,b("camera",k,"b4w_rot_velocity")),"b4w_zoom_velocity"in k||(k.b4w_zoom_velocity=.1,b("camera",k,"b4w_zoom_velocity")),"b4w_use_distance_limits"in k||(k.b4w_use_distance_limits=!1,b("camera",k,"b4w_use_distance_limits")),"b4w_distance_min"in k||(k.b4w_distance_min=1,b("camera",k,"b4w_distance_min")),"b4w_distance_max"in k||(k.b4w_distance_max=100,b("camera",k,"b4w_distance_max")),"b4w_horizontal_translation_min"in k||(k.b4w_horizontal_translation_min=
-100,b("camera",k,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in k||(k.b4w_horizontal_translation_max=100,b("camera",k,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in k||(k.b4w_vertical_translation_min=-100,b("camera",k,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in k||(k.b4w_vertical_translation_max=100,b("camera",k,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in k||(k.b4w_use_horizontal_clamping=!1,b("camera",k,"b4w_use_horizontal_clamping")),
"b4w_rotation_left_limit"in k||(k.b4w_rotation_left_limit=-Math.PI,b("camera",k,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in k||(k.b4w_rotation_right_limit=Math.PI,b("camera",k,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in k||(k.b4w_horizontal_clamping_type="LOCAL",b("camera",k,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in k||(k.b4w_use_vertical_clamping=!1,b("camera",k,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in k||(k.b4w_rotation_down_limit=
-Math.PI/2,b("camera",k,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in k||(k.b4w_rotation_up_limit=Math.PI/2,b("camera",k,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in k||(k.b4w_vertical_clamping_type="LOCAL",b("camera",k,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in k||(k.b4w_hover_angle_min=Math.PI/6,b("camera",k,"b4w_hover_angle_min")),"b4w_hover_angle_max"in k||(k.b4w_hover_angle_max=Math.PI/6,b("camera",k,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in k||
(k.b4w_enable_hover_hor_rotation=!0,b("camera",k,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in k||(k.b4w_use_panning=!0,b("camera",k,"b4w_use_panning"));g=a.lamps;for(n=0;n<g.length;n++)k=g[n],"b4w_generate_shadows"in k||(k.b4w_generate_shadows=!1,b("lamp",k,"b4w_generate_shadows")),"b4w_dynamic_intensity"in k||(k.b4w_dynamic_intensity=!1,b("lamp",k,"b4w_dynamic_intensity")),"use_diffuse"in k||(k.use_diffuse=!0,b("lamp",k,"use_diffuse")),"use_specular"in k||(k.use_specular=!0,b("lamp",k,"use_specular"));
g=a.speakers;for(n=0;n<g.length;n++)k=g[n],"b4w_behavior"in k||(k.b4w_behavior=k.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in k||(k.b4w_disable_doppler=!1),"b4w_delay"in k||(k.b4w_delay=0),"b4w_delay_random"in k||(k.b4w_delay_random=0),"b4w_volume_random"in k||(k.b4w_volume_random=0),"b4w_pitch_random"in k||(k.b4w_pitch_random=0),"b4w_fade_in"in k||(k.b4w_fade_in=0),"b4w_fade_out"in k||(k.b4w_fade_out=0),"b4w_loop"in k||(k.b4w_loop=!1),"b4w_loop_count"in k||(k.b4w_loop_count=
0),"b4w_loop_count_random"in k||(k.b4w_loop_count_random=0),"b4w_playlist_id"in k||(k.b4w_playlist_id=""),k.animation_data&&c(k.animation_data);g=a.textures;for(n=0;n<g.length;n++)k=g[n],"b4w_anisotropic_filtering"in k||(k.b4w_anisotropic_filtering="OFF",b("texture",k,"b4w_anisotropic_filtering")),"b4w_water_foam"in k||(k.b4w_water_foam=!1,b("texture",k,"b4w_water_foam")),"b4w_foam_uv_freq"in k||(k.b4w_foam_uv_freq=[1,1],b("texture",k,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in k||(k.b4w_foam_uv_magnitude=
[1,1],b("texture",k,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in k||(k.b4w_parallax_steps=5,b("material",k,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in k||(k.b4w_parallax_lod_dist=10,b("material",k,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in k||(k.b4w_shore_dist_map=!1,b("texture",k,"b4w_shore_dist_map")),"b4w_shore_boundings"in k||(k.b4w_shore_boundings=new Float32Array(4),k.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",k,"b4w_shore_boundings")),"b4w_max_shore_dist"in k||(k.b4w_max_shore_dist=
100,b("texture",k,"b4w_max_shore_dist")),"b4w_disable_compression"in k||(k.b4w_disable_compression=!1,b("texture",k,"b4w_disable_compression")),"b4w_source_type"in k||(k.b4w_source_type="",b("texture",k,"b4w_source_type")),"b4w_source_id"in k||(k.b4w_source_id="",b("texture",k,"b4w_source_id")),"b4w_source_size"in k||(k.b4w_source_size=1024,b("texture",k,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in k||(k.b4w_enable_canvas_mipmapping=!0,b("texture",k,"b4w_enable_canvas_mipmapping"));f=a.materials;
for(n=0;n<f.length;n++){p=f[n];"b4w_node_mat_type"in p&&l("material",p,"b4w_node_mat_type");"b4w_skydome"in p&&l("material",p,"b4w_skydome");"b4w_procedural_skydome"in p&&l("material",p,"b4w_procedural_skydome");p.b4w_water&&("b4w_water_shore_smoothing"in p||(p.b4w_water_shore_smoothing=!1,b("material",p,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in p||(p.b4w_water_dynamic=!1,b("material",p,"b4w_water_dynamic")),"b4w_waves_height"in p||(p.b4w_waves_height=1,b("material",p,"b4w_waves_height")),
"b4w_waves_length"in p||(p.b4w_waves_length=1,b("material",p,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in p||(p.b4w_water_dst_noise_scale0=.05,b("material",p,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in p||(p.b4w_water_dst_noise_scale1=.03,b("material",p,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in p||(p.b4w_water_dst_noise_freq0=1.3,b("material",p,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in p||(p.b4w_water_dst_noise_freq1=1,b("material",p,"b4w_water_dst_noise_freq1")),
"b4w_water_dir_min_shore_fac"in p||(p.b4w_water_dir_min_shore_fac=.4,b("material",p,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in p||(p.b4w_water_dir_freq=.5,b("material",p,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in p||(p.b4w_water_dir_noise_scale=.05,b("material",p,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in p||(p.b4w_water_dir_noise_freq=.07,b("material",p,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in p||(p.b4w_water_dir_min_noise_fac=.5,b("material",
p,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in p||(p.b4w_water_dst_min_fac=.2,b("material",p,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in p||(p.b4w_water_waves_hor_fac=5,b("material",p,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in p||(p.b4w_water_absorb_factor=6,b("material",p,"b4w_water_absorb_factor")),"b4w_water_fog_color"in p||(p.b4w_water_fog_color=new Float32Array(3),p.b4w_water_fog_color=[.5,.7,.7],b("material",p,"b4w_water_fog_color")),"b4w_foam_factor"in p||
(p.b4w_foam_factor=5,b("material",p,"b4w_foam_factor")),"b4w_generated_mesh"in p||(p.b4w_generated_mesh=!1,b("material",p,"b4w_generated_mesh")),"b4w_water_num_cascads"in p||(p.b4w_water_num_cascads=5,b("material",p,"b4w_water_num_cascads")),"b4w_water_subdivs"in p||(p.b4w_water_subdivs=64,b("material",p,"b4w_water_subdivs")),"b4w_water_detailed_dist"in p||(p.b4w_water_detailed_dist=1E3,b("material",p,"b4w_water_detailed_dist")),"b4w_water_enable_caust"in p||(p.b4w_water_enable_caust=!1,b("material",
p,"b4w_water_enable_caust")),"b4w_water_caust_scale"in p||(p.b4w_water_caust_scale=.25,b("material",p,"b4w_water_caust_scale")),"b4w_water_caust_brightness"in p||(p.b4w_water_caust_brightness=.5,b("material",p,"b4w_water_caust_brightness")));"b4w_dynamic_grass_size"in p||(p.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in p||(p.b4w_dynamic_grass_color="");"diffuse_intensity"in p||(p.diffuse_intensity=1,b("material",p,"diffuse_intensity"));"b4w_use_ghost"in p||(p.b4w_use_ghost=!1);"b4w_collision_margin"in
p||(p.b4w_collision_margin=.04,b("material",p,"b4w_collision_margin"));"b4w_collision_group"in p||(p.b4w_collision_group=128,b("material",p,"b4w_collision_group"));"b4w_collision_mask"in p||(p.b4w_collision_mask=127,b("material",p,"b4w_collision_mask"));"b4w_do_not_render"in p||(p.b4w_do_not_render=!1,b("material",p,"b4w_do_not_render"));"HALO"!=p.type||"b4w_halo_sky_stars"in p||(p.b4w_halo_sky_stars=!1,b("material",p,"b4w_halo_sky_stars"));"HALO"!=p.type||"b4w_halo_stars_blend_height"in p||(p.b4w_halo_stars_blend_height=
10,b("material",p,"b4w_halo_stars_blend_height"));"HALO"!=p.type||"b4w_halo_stars_min_height"in p||(p.b4w_halo_stars_min_height=0,b("material",p,"b4w_halo_stars_min_height"));"specular_shader"in p||(p.specular_shader="COOKTORR",b("material",p,"specular_shader"));"diffuse_shader"in p||(p.diffuse_shader="LAMBERT",b("material",p,"diffuse_shader"));"roughness"in p||(p.roughness=.5,b("material",p,"roughness"));"diffuse_fresnel"in p||(p.diffuse_fresnel=.1,b("material",p,"diffuse_fresnel"));"diffuse_fresnel_factor"in
p||(p.diffuse_fresnel_factor=.5,b("material",p,"diffuse_fresnel_factor"));"specular_slope"in p||(p.specular_slope=.2,b("material",p,"specular_slope"));"specular_toon_size"in p||(p.specular_toon_size=.5,b("material",p,"specular_toon_size"));"specular_toon_smooth"in p||(p.specular_toon_smooth=.1,b("material",p,"specular_toon_smooth"));"specular_alpha"in p||(p.specular_alpha=1,b("material",p,"specular_alpha"));"b4w_wettable"in p||(p.b4w_wettable=!1,b("material",p,"b4w_wettable"));"b4w_refractive"in p||
(p.b4w_refractive=!1,b("material",p,"b4w_refractive"));"b4w_refr_bump"in p||(p.b4w_refr_bump=0,b("material",p,"b4w_refr_bump"));"b4w_shallow_water_col"in p||(p.b4w_shallow_water_col=[0,.8,.3],b("material",p,"b4w_shallow_water_col"));"b4w_shore_water_col"in p||(p.b4w_shore_water_col=[0,.9,.2],b("material",p,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in p||(p.b4w_shallow_water_col_fac=1,b("material",p,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in p||(p.b4w_shore_water_col_fac=.5,
b("material",p,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in p||(p.b4w_water_sss_strength=5.9,b("material",p,"b4w_water_sss_strength"));"b4w_water_sss_width"in p||(p.b4w_water_sss_width=.45,b("material",p,"b4w_water_sss_width"));"b4w_render_above_all"in p||(p.b4w_render_above_all=!1,b("material",p,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in p||(p.b4w_water_norm_uv_velocity=.05,b("material",p,"b4w_water_norm_uv_velocity"));"specular_ior"in p||(p.specular_ior=1,b("material",p,"specular_ior"));
"darkness"in p||(p.darkness=0,b("material",p,"darkness"));"diffuse_toon_size"in p||(p.diffuse_toon_size=0,b("material",p,"diffuse_toon_size"));"diffuse_toon_smooth"in p||(p.diffuse_toon_smooth=0,b("material",p,"diffuse_toon_smooth"));k=p.texture_slots;for(g=0;g<k.length;g++)m=k[g],"blend_type"in m||(m.blend_type="MIX",b("texture_slot",m,"blend_type"));if(p.node_tree){k=p.node_tree.nodes;for(g=0;g<k.length;g++)d(k[g]);p.node_tree.animation_data&&c(p.node_tree.animation_data)}}m=a.node_groups;for(n=
0;n<m.length;n++)for(k=m[n].node_tree.nodes,g=0;g<k.length;g++)d(k[g]);k=a.objects;for(n=0;n<k.length;n++){m=k[n];switch(m.type){case "MESH":"b4w_dynamic_geometry"in m||(m.b4w_dynamic_geometry=!1);"b4w_reflexible"in m||(m.b4w_reflexible=!1);"b4w_reflexible_only"in m||(m.b4w_reflexible_only=!1);"b4w_reflective"in m||(m.b4w_reflective=!1);"b4w_reflection_type"in m||(m.b4w_reflection_type="PLANE",b("object",m,"b4w_reflection_type"));"b4w_wind_bending"in m||(m.b4w_wind_bending=!1,b("object",m,"b4w_wind_bending"));
"b4w_wind_bending_angle"in m||(m.b4w_wind_bending_angle=10,m.b4w_wind_bending_freq=.25,b("object",m,"wind bending params"));"b4w_detail_bending_amp"in m||(m.b4w_detail_bending_amp=.1,m.b4w_branch_bending_amp=.3,b("object",m,"detail bending params"));"b4w_detail_bending_freq"in m||(m.b4w_detail_bending_freq=1,b("object",m,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in m||(m.b4w_main_bend_stiffness_col="",b("object",m,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in m||(m.b4w_detail_bend_colors=
{leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",m,"b4w_detail_bend_colors"));"b4w_caustics"in m||(m.b4w_caustics=!1);"vertex_groups"in m&&m.vertex_groups.length&&m.data&&0==m.data.vertex_groups.length&&(m.data.vertex_groups=m.vertex_groups,delete m.vertex_groups,b("object",m,"vertex_groups"));"b4w_vertex_anim"in m&&m.b4w_vertex_anim.length&&m.data&&0==m.data.b4w_vertex_anim.length&&(m.data.b4w_vertex_anim=m.b4w_vertex_anim,delete m.b4w_vertex_anim,b("object",m,"b4w_vertex_anim"));
"b4w_do_not_render"in m||(m.b4w_do_not_render=!1);"use_ghost"in m.game||(m.game.use_ghost=!1);"use_sleep"in m.game||(m.game.use_sleep=!1);"velocity_min"in m.game||(m.game.velocity_min=0);"velocity_max"in m.game||(m.game.velocity_max=0);"collision_group"in m.game||(m.game.collision_group=1);"collision_mask"in m.game||(m.game.collision_mask=255);"b4w_vehicle_settings"in m?m.b4w_vehicle_settings&&("steering_ratio"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.steering_ratio=10),"steering_max"in m.b4w_vehicle_settings||
(m.b4w_vehicle_settings.steering_max=1),"inverse_control"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.inverse_control=!1),"force_max"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.force_max=1500),"brake_max"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.brake_max=100),"speed_ratio"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in m.b4w_vehicle_settings||
(m.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.roll_influence=
.1),"max_suspension_travel_cm"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.floating_factor=3),"floating_factor"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.water_rot_damp=.9)):(m.b4w_vehicle_settings=null,b("object",m,"b4w_vehicle_settings"));
"b4w_floating_settings"in m?m.b4w_floating_settings&&("floating_factor"in m.b4w_floating_settings||(m.b4w_floating_settings.floating_factor=3),"water_lin_damp"in m.b4w_floating_settings||(m.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in m.b4w_floating_settings||(m.b4w_floating_settings.water_rot_damp=.8)):(m.b4w_floating_settings=null,b("object",m,"b4w_floating_settings"));"b4w_character_settings"in m?m.b4w_character_settings&&("walk_speed"in m.b4w_character_settings||(m.b4w_character_settings.walk_speed=
4),"run_speed"in m.b4w_character_settings||(m.b4w_character_settings.run_speed=8),"step_height"in m.b4w_character_settings||(m.b4w_character_settings.step_height=.25),"jump_strength"in m.b4w_character_settings||(m.b4w_character_settings.jump_strength=5),"waterline"in m.b4w_character_settings||(m.b4w_character_settings.waterline=0)):(m.b4w_character_settings=null,b("object",m,"b4w_character_settings"));"b4w_selectable"in m||(m.b4w_selectable=!1,b("object",m,"b4w_selectable"));"b4w_outlining"in m||
(m.b4w_outlining=!1,b("object",m,"b4w_outlining"));"b4w_outline_on_select"in m||(m.b4w_outline_on_select=!1,b("object",m,"b4w_outline_on_select"));"b4w_billboard"in m||(m.b4w_billboard=!1,b("object",m,"b4w_billboard"));"b4w_billboard_geometry"in m||(m.b4w_billboard_geometry="SPHERICAL",b("object",m,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in m||(m.b4w_pres_glob_orientation=!1,b("object",m,"b4w_pres_glob_orientation"));"b4w_outline_settings"in m||("b4w_glow_settings"in m?m.b4w_outline_settings=
m.b4w_glow_settings:(m.b4w_outline_settings={},m.b4w_outline_settings.outline_duration=1,m.b4w_outline_settings.outline_period=1,m.b4w_outline_settings.outline_relapses=0),b("object",m,"b4w_outline_settings"));"b4w_lod_transition"in m||(m.b4w_lod_transition=.01,b("object",m,"b4w_lod_transition"));"lod_levels"in m||(m.lod_levels=[],b("object",m,"lod_levels"));"b4w_animation_mixing"in m||(m.b4w_animation_mixing=!1,b("object",m,"b4w_animation_mixing"));break;case "EMPTY":"b4w_anchor"in m||(m.b4w_anchor=
null,b("object",m,"b4w_anchor")),!m.b4w_anchor||"max_width"in m.b4w_anchor||(m.b4w_anchor.max_width=250)}"collision_margin"in m.game||(m.game.collision_margin=.04,b("object",m,"collision_margin"));"b4w_anim_behavior"in m||(m.b4w_anim_behavior=m.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",m,"b4w_anim_behavior"));if(!("rotation_quaternion"in m)){g=[0,0,0,1];h.euler_to_quat(m.rotation_euler,g);var f=g,p=g[0],r=g[1],w=g[2];f[0]=g[3];f[1]=p;f[2]=r;f[3]=w;m.rotation_quaternion=g;b("object",m,
"rotation_quaternion")}"webgl_do_not_batch"in m&&(m.b4w_do_not_batch=m.webgl_do_not_batch)&&l("object",m,"webgl_do_not_batch");"b4w_shadow_cast_only"in m||(m.b4w_shadow_cast_only=!1,b("object",m,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in m||(m.b4w_correct_bounding_offset="AUTO",b("object",m,"b4w_correct_bounding_offset"));f=m.particle_systems;for(g=0;g<f.length;g++)p=f[g],r=p.settings,"use_rotation_dupli"in r||(r.use_rotation_dupli=!1,b("object",r,"use_rotation_dupli")),"use_whole_group"in
r||(r.use_whole_group=!1,b("object",r,"use_whole_group")),p.transforms||(p.transforms=new Float32Array,b("particle_system",p,"transforms")),"b4w_billboard_align"in r||(r.b4w_billboard_align="VIEW",b("particle_settings",r,"b4w_billboard_align")),"b4w_dynamic_grass"in r||(r.b4w_dynamic_grass=!1,b("object",r,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in r||(r.b4w_dynamic_grass_scale_threshold=.01,b("object",r,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in r||(r.b4w_initial_rand_rotation=
!1,b("particle_settings",r,"b4w_initial_rand_rotation")),"b4w_rotation_type"in r||(r.b4w_rotation_type="Z",b("particle_settings",r,"b4w_rotation_type")),"b4w_rand_rotation_strength"in r||(r.b4w_rand_rotation_strength=1,b("particle_settings",r,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in r||(r.b4w_hair_billboard=!1,b("particle_settings",r,"b4w_hair_billboard")),"b4w_hair_billboard_type"in r||(r.b4w_hair_billboard_type="BASIC",b("particle_settings",r,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in
r||(r.b4w_hair_billboard_jitter_amp=0,b("particle_settings",r,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in r||(r.b4w_hair_billboard_jitter_freq=0,b("particle_settings",r,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in r||(r.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",r,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in r||(r.b4w_wind_bend_inheritance="PARENT",b("particle_settings",r,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in
r||(r.b4w_shadow_inheritance="PARENT",b("particle_settings",r,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in r||(r.b4w_reflection_inheritance="PARENT",b("particle_settings",r,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in r||(r.b4w_vcol_from_name="",b("particle_settings",r,"b4w_vcol_from_name")),"b4w_vcol_to_name"in r||(r.b4w_vcol_to_name="",b("particle_settings",r,"b4w_vcol_to_name")),"b4w_coordinate_system"in r||(r.b4w_coordinate_system="LOCAL",b("particle_settings",r,"b4w_coordinate_system")),
"b4w_allow_nla"in r||(r.b4w_allow_nla=!0,b("particle_settings",r,"b4w_allow_nla")),"b4w_enable_soft_particles"in r||(r.b4w_enable_soft_particles=!1,b("particle_settings",r,"b4w_enable_soft_particles")),"b4w_particles_softness"in r||(r.b4w_particles_softness=1,b("particle_settings",r,"b4w_particles_softness"));"constraints"in m||(m.constraints=[],b("object",m,"constraints"));f=m.modifiers;for(g=0;g<f.length;g++){a:{p=f[g];switch(p.type){case "ARRAY":if(!("fit_type"in p)){e.error("WARNING Incomplete modifier "+
String(p.type)+' for "'+m.name+'", reexport "'+a.b4w_filepath_blend+'" scene');p=!1;break a}}p=!0}p||(f.splice(g,1),g--)}"animation_data"in m||(m.animation_data={action:null,nla_tracks:[]},b("object",m,"animation_data"));m.animation_data&&("action"in m.animation_data||(m.animation_data.action=null,e.warn("no action in animation data "+m.name)),"nla_tracks"in m.animation_data||(m.animation_data.nla_tracks=[],e.warn("no NLA in animation data "+m.name)),c(m.animation_data));"b4w_collision_id"in m||(m.b4w_collision_id=
"",b("material",m,"b4w_collision_id"));g=m.scale;0==g[0]&&0==g[1]&&0==g[2]?g=!0:(f=Math.abs((g[1]-g[2])/g[1]),g=.005>Math.abs((g[0]-g[1])/g[0])&&.005>f);g||e.warn("non-uniform scale for object "+m.name);if(0>m.scale[0]||0>m.scale[1]||0>m.scale[2])e.warn("negative scale for object "+m.name+", using positive scale instead"),m.scale[0]=Math.abs(m.scale[0]),m.scale[1]=Math.abs(m.scale[1]),m.scale[2]=Math.abs(m.scale[2])}for(var A in B)n=B[A],g=A.match(/.*?(?=>>|$)/i)[0],e.warn('Property "'+String(g)+
'" is '+n.Qt+' for "'+n.type+'". To fix this, reexport '+a.b4w_filepath_blend)};a.Rx=function(a,b){"num_channels"in a||(a.num_channels=1,e.warn('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport scene'))};a.lx=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var d=b[c].type;if("ARRAY"==d||"CURVE"==d){b=!0;break a}}b=!1}if(!b)return null;b=f(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var e=a[c];switch(e.type){case "ARRAY":for(var d=
b,l=e,t=0,q=0,C=0,A=new Float32Array(16),e=[],J=1;J<l.count;J++){l.use_constant_offset&&(t+=l.constant_offset_displace[0],q+=l.constant_offset_displace[1],C+=l.constant_offset_displace[2]);if(l.use_relative_offset)var N=d.b4w_bounding_box,t=t+(N.max_x-N.min_x)*l.relative_offset_displace[0],q=q+(N.max_y-N.min_y)*l.relative_offset_displace[1],C=C+(N.max_z-N.min_z)*l.relative_offset_displace[2];h.MD(t,q,C,A);for(var M=N=f(d),y=A,K=0;K<M.submeshes.length;K++){var x=M.submeshes[K];h.Hf(x.position,y,x.position,
0);h.NE(x.normal,y,x.normal);h.JD(x.tangent,y,x.tangent)}e.push(N)}for(J=0;J<e.length;J++)for(l=d,t=e[J],q=0;q<l.submeshes.length;q++){C=l.submeshes[q];A=t.submeshes[q];N=C.base_length;M=C.indices.length;C.base_length+=A.base_length;for(var S in C)if("base_length"!=S)if("indices"==S)for(C[S]=h.QD(C[S],A[S]),y=M;y<C.indices.length;y++)C.indices[y]+=N;else"vertex_colors"!=S&&(C[S]=h.Az(C[S],A[S]))}break;case "CURVE":for(var d=b,J=n.Ly(e.object),l=new Float32Array(16),q=J.vf?4:3,t=new Float32Array(q),
q=new Float32Array(q),C=new Float32Array(3),A=new Float32Array(4),N=new Float32Array(4),M=new Float32Array(3),y=new Float32Array(3),K=new Float32Array(3),x=new Float32Array(4),T=new Float32Array(4),B=0;B<d.submeshes.length;B++){var fa=d.submeshes[B],R=fa.position,W=fa.normal,fa=fa.tangent,aa;a:switch(aa=e.deform_axis,aa){case "POS_X":case "NEG_X":aa=0;break a;case "POS_Y":case "NEG_Y":aa=1;break a;case "POS_Z":case "NEG_Z":aa=2;break a;default:throw"Wrong deform axis value "+aa;}M[0]=0;M[1]=0;M[2]=
0;M[aa]=1;for(var Q=n.vD(J),V=0;V<R.length/3;V++){K[0]=R[3*V];K[1]=R[3*V+1];K[2]=R[3*V+2];var oa=K[aa],ca=n.uD(J,oa);n.wD(J,ca,t);C[0]=t[0];C[1]=t[1];C[2]=t[2];n.tD(J,ca,q);y[0]=q[0];y[1]=0;y[2]=q[2];p.normalize(y,y);g.rotationTo(M,y,A);0>oa?(t[0]=y[0],t[1]=y[1],t[2]=y[2],p.scale(t,oa,t),p.add(C,t,C)):oa>Q&&(t[0]=y[0],t[1]=y[1],t[2]=y[2],p.scale(t,oa-Q,t),p.add(C,t,C));r.fromRotationTranslation(A,C,l);J.vf&&(g.setAxisAngle(M,t[3],N),p.transformQuat(K,N,K));K[aa]=0;p.transformMat4(K,l,K);R[3*V]=K[0];
R[3*V+1]=K[1];R[3*V+2]=K[2];W.length&&(x[0]=W[3*V],x[1]=W[3*V+1],x[2]=W[3*V+2],x[3]=0,w.transformMat4(x,l,x),W[3*V]=x[0],W[3*V+1]=x[1],W[3*V+2]=x[2]);fa.length&&(T[0]=fa[3*V],T[1]=fa[3*V+1],T[2]=fa[3*V+2],T[3]=0,w.transformMat4(T,l,T),fa[3*V]=T[0],fa[3*V+1]=T[1],fa[3*V+2]=T[2])}}}k.nC(b)}return b};a.SF=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,
fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,
b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.tx=function(a,b){for(var c=b.b4w_logic_nodes,d=0;d<c.length;d++)for(var e=c[d],f=0;f<
e.length;f++){var h=e[f];switch(h.type){case "SELECT":case "SELECT_PLAY":for(var g=0;g<a.length;g++){var k=a[g];k.name==h.object&&(k.b4w_selectable=!0)}break;case "SHOW":case "HIDE":for(g=0;g<a.length;g++)k=a[g],k.name==h.object&&(k.b4w_do_not_batch=!0)}}}};b4w.module.__scenegraph=function(a,q){function d(a){a=ia.pg(a);a.Ae=null;a.pb=null;a.dd=null;return a}function c(a,c){var d=[];E.ee(a,function(b,c,e){-1<d.indexOf(e)?E.wC(a,b,c,e,l(e)):d.push(e)});E.W(a,function(b,e){for(var f=0;f<e.sa.length;f++){var h=e.sa[f];c||"MAIN_PLANE_REFLECT"!=e.type&&"MAIN_CUBE_REFLECT"!=e.type&&"MAIN_XRAY"!=e.type||(h.nh=!0);-1<d.indexOf(h)?e.sa[f]=l(h):d.push(h)}"ANTIALIASING"==e.type&&E.Ue(a,b,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.sa.length;c++){var d=
b.sa[c];d.ga=Z.t;d.fa=Z.t}});c||E.Ue(a,b,function(a,b,c){"DEPTH"==c.X&&(c.nh=!0)})});E.W(a,function(c){var d={};b(a,c,d);for(var e in d){c=d[e];for(var f=c[0],h=0;h<c.length;h++)if(c[h].ga==Z.t){f=c[h];break}for(var g=c[0],h=0;h<c.length;h++)if(c[h].fa==Z.t){g=c[h];break}for(var E=c[0],h=0;h<c.length;h++)if(!c[h].nh){E=c[h];break}for(h=0;h<c.length;h++)c[h].ga=f.ga,c[h].fa=g.fa,c[h].nh=E.nh}})}function b(a,c,d){E.Ue(a,c,function(c,e,f){f.$a&&f.X==f.ya&&(d[f.X]=d[f.X]||[],-1==d[f.X].indexOf(f)&&d[f.X].push(f),
b(a,c,d))});E.Tf(a,c,function(a,b,c){c.$a&&(d[c.X]=d[c.X]||[],-1==d[c.X].indexOf(c)&&d[c.X].push(c))});c=E.Qa(a,c);if("MOTION_BLUR"==c.type)for(var e=0;e<c.sa.length;e++){var f=c.sa[e];d[f.X].push(f)}}function l(a){if(a.Ba)throw"Failed to clone slink with attached texture";return Gb.mg(a)}function f(a){var b=E.Jp(a),c=[];E.W(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":var f=[];break;default:f=c}for(var h=0;h<d.sa.length;h++){var k=
d.sa[h],l=g(f,k,n(k));k.Ba=l;d.ce[h]=l}for(h=0;h<d.ce.length;h++)l=d.ce[h],e(f,l);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":f=[]}E.Tf(b,a,function(c,d,e){if(!e.Ba){if((c=r(b,a,e.X))&&e.$a&&!e.Ba){d=f;for(var h=c,E=0;E<d.length;E++){var k=d[E];k.Fp===h&&k.ck++}}else c=g(f,e,n(e));e.Ba=c}});E.Ue(b,a,function(a,b,c){e(f,c.Ba)});E.Tf(b,a,function(a,b,c){c.Ba&&"NONE"==c.ya&&e(f,c.Ba)})})}function k(a){p(a,function(b,c,d){b.Ji&&(da(a,
d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||da(a,d,"ANTIALIASING")||"ANCHOR_VISIBILITY"==d.type)&&(b.Pf*=Aa.render_resolution_factor)})}function n(a){a=Gb.mg(a);delete a.ya;delete a.$a;delete a.Ba;return JSON.stringify(a)}function r(a,b,c){var d=null;E.Ue(a,b,function(a,b,e){if(e.$a&&e.X==e.ya&&e.X==c&&e.Ba)return d=e.Ba,!0});E.Tf(a,b,function(a,b,e){if(e.$a&&e.X==c&&e.Ba)return d=e.Ba,!0});return d}function e(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.Fp===b&&d.ck&&
d.ck--}}function g(a,b,c){for(var d=null,e=0;e<a.length;e++){var f=a[e];if(f.id==c&&0===f.ck){d=f;break}}if(d&&!Aa.wB)return d.ck++,d.Fp;b=h(b);a.push({id:c,ck:1,Fp:b});return b}function h(a){var b=a.Pf*a.size;switch(a.X){case "COLOR":var c=Z.fl("COLOR",Z.wh);Z.resize(c,b,b);Z.fk(c,a.ga,a.fa);return c;case "DEPTH":return a.nh?(c=Z.fl("DEPTH_RBUF",Z.vh),Z.resize(c,b,b)):(c=Z.fl("DEPTH_TEX",Z.Ti),Z.resize(c,b,b),Z.fk(c,a.ga,a.fa)),c;case "CUBEMAP":return c=Z.ty(b);case "SCREEN":return null;default:throw"Wrong slink param: "+
a.X;}}function p(a,b){var c=!1;E.ee(a,function(d,e,f){if(f&&(d=E.Qa(a,d),e=E.Qa(a,e),b(f,!1,d,e)))return c=!0});c||E.W(a,function(a,c){for(var d=0;d<c.sa.length;d++)if(b(c.sa[d],!0,c,null))return!0})}function w(a){E.W(a,function(b,c){if("SINK"!=c.type){var d=c.j;E.Tf(a,b,function(a,b,c){c.$a&&c.Ba&&(Y.nm(d,c.X,c.Ba),c.X==c.ya&&b.j&&Y.nm(b.j,c.X,c.Ba))});for(var e=0;e<c.sa.length;e++){var f=c.sa[e];f.$a&&f.X==f.ya&&Y.nm(d,f.X,c.ce[e])}!d.pb&&!d.dd||d.Ae||(d.Ae=ta.vC(d.pb,d.dd))}})}function C(a){var b=
null,c=0;E.W(a,function(a,d){if(d.type==kb.HD){if(c==kb.GD)return b=d,!0;c++}});return b}function B(a,b){var c=E.Wg(a,b),d=m("NONE"),e=E.u(a,d),f=E.ms(a)[0];E.ee(a,function(b,c){c==f&&E.oC(a,b,f,b,e)});E.ee(a,function(e,f,h){if(e==c)return E.n(a,b,d,D(kb.iD,"u_color",h.size,h.Pf,h.Ji)),!0});E.Sb(a,e,f,D("SCREEN","NONE",.5,.5,!0))}function H(a,b){var c=u("SHADOW_CAST");c.vn=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.Jg){case "SPOT":case "POINT":c.j=Y.ub(Y.Qb);Y.om(c.j,180*
b.Qe/Math.PI,.1,2*b.distance);break;default:c.j=Y.ub(Y.dg)}return c}function u(a){a={type:a,Sa:"",Ha:!1,ut:!1,Tm:!1,Ol:!1,mj:0,time:0,j:null,lj:null,xn:[],o:[],sa:[],ce:[],Ve:new Float32Array(3),mv:new Float32Array(3),nc:new Float32Array(3),bc:new Float32Array(4),sl:new Float32Array(4),Ec:new Float32Array(16),ku:0,nf:0,Bf:0,Mg:null,wf:null,Lg:null,Ng:null,tf:new Float32Array(3),cg:new Float32Array(3),lu:new Float32Array(4),Cu:new Float32Array([0,0,0]),zp:new Float32Array(3),Du:new Float32Array(4),
ju:new Float32Array(3),Uj:0,Gn:0,Lj:!1,Ef:new Float32Array(3),Zf:0,ob:null,Am:!1,Mf:new Float32Array(2),Nf:new Float32Array(2),ri:0,bi:0,jn:0,Hd:null,ag:0,uh:0,$f:0,qe:!1,Vq:0,Wq:new Float32Array(2),Uq:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,si:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,
xi:0,wi:0,vi:0,uu:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,ai:0,hm:0,Bi:0,vn:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,Xu:null,Jq:null,ah:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,an:0,Mn:0,mb_decay_threshold:0,mb_factor:0,ct:0,dm:"",WA:new Float32Array(2),small_glow_mask_width:0,large_glow_mask_width:0,small_glow_mask_coeff:0,large_glow_mask_coeff:0,Gp:new Float32Array(2),Ta:new Float32Array(2),cb:!0,enqueue:!0,la:!0,ua:!0,
Lb:!0,wa:!0,Te:1};a.Ta[0]=1;a.Ta[1]=1;return a}function D(a,b,c,d,e){return{X:a,ya:b,size:c,Pf:d,Ji:e,$a:!0,Ba:null,nh:!1,ga:Z.zc,fa:Z.zc}}function G(a,b){for(var c=0,d=ua(a,b),e=0;e<d.length;e++){var f=d[e];"SHADOW_CAST"==f.type&&(f=f.j,b.TB=f.eb/(f.eb-f.gb),b.Xu=f.za,b.Jq=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.ah=b.ah||[],b.ah[c]=f.Aa,c++)}}function v(){var a=u("GRASS_MAP");a.j=Y.ub(Y.$e);return a}function m(a){var b=u("POSTPROCESSING");b.la=!1;b.ua=!1;b.Lb=!1;b.j=Y.ub(Y.Bb);
b.dm=a;switch(a){case "NONE":b.Ta[0]=1;b.Ta[1]=1;break;case "GRAYSCALE":b.Ta[0]=1;b.Ta[1]=1;break;case "X_BLUR":b.Ta[0]=1;b.Ta[1]=0;break;case "Y_BLUR":b.Ta[0]=0;b.Ta[1]=1;break;case "X_GLOW_BLUR":b.Ta[0]=1;b.Ta[1]=0;break;case "Y_GLOW_BLUR":b.Ta[0]=0;b.Ta[1]=1;break;case "X_EXTEND":b.Ta[0]=1;b.Ta[1]=0;break;case "Y_EXTEND":b.Ta[0]=0;b.Ta[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}return b}function t(a){var b=u("BLOOM_BLUR");b.la=!1;b.ua=!1;b.Lb=!1;b.j=Y.ub(Y.Bb);b.dm=a;switch(a){case "X_BLUR":b.Ta[0]=
1;b.Ta[1]=0;break;case "Y_BLUR":b.Ta[0]=0;b.Ta[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}return b}function z(a,b){var c=u("GLOW_COMBINE");c.la=!1;c.ua=!1;c.Lb=!1;c.small_glow_mask_coeff=b.sf.small_glow_mask_coeff;c.large_glow_mask_coeff=b.sf.large_glow_mask_coeff;c.small_glow_mask_width=b.sf.small_glow_mask_width;c.large_glow_mask_width=b.sf.large_glow_mask_width;c.j=a;return c}function L(a,b,c,d,e,f,h,g,E){var k=u("MAIN_"+a);if("OPAQUE"===a)k.la=!0,k.ua=c,k.Ha=!1;
else if("BLEND"===a)k.la=!1,k.ua=!1,k.Ha=!0;else if("XRAY"===a)k.la=!1,k.ua=!0,k.Ha=!0;else if("PLANE_REFLECT"===a||"CUBE_REFLECT"===a)k.la=!0,k.ua=!0,k.Ha=!1;else if("GLOW"===a)k.la=!0,k.ua=!1,k.Ha=!1;else throw"wrong main subscene type";k.Ha&&g&&(k.self_shadow_normal_offset=g.self_shadow_normal_offset);k.j=b;if(a=h.op)k.lu.set([a.Cx,a.GA,a.XE,a.WE]),k.ju.set(a.color),k.ku=a.Ia;k.tf.set(h.tf);k.cg.set(h.cg);k.nf=h.nf;k.bc=f.bc;k.sl=f.sl;d&&(k.ob=d,d.bc&&(k.Hd=new Float32Array(d.bc)),k.ag=d.waves_height,
k.uh=d.waves_length,k.$f=d.$f,d.qe&&E&&(k.qe=!0,k.Vq=d.Ox,k.Wq.set(d.Px),k.Uq=d.Nx),d.qm&&(k.Am=!0,f=d.gD,k.Mf[0]=(f[0]+f[1])/2,k.Mf[1]=(f[2]+f[3])/2,k.Nf[0]=f[0]-f[1],k.Nf[1]=f[2]-f[3],k.ri=d.ri,k.bi=d.bi));k.Bf=e;k.Mg=new Float32Array(3*e);k.wf=new Float32Array(3*e);k.Lg=new Float32Array(3*e);k.Ng=new Float32Array(0==e%2?2*e:2*e+2);return k}function A(a,b){var c=u("COLOR_PICKING");b&&(c.type+="_XRAY",c.la=!1,c.ua=!0);c.enqueue=!1;c.j=a;return c}function J(a){var b=u("WIREFRAME");b.cb=!1;b.la=!1;
b.ua=!1;b.j=a;return b}function N(a){var b=u("ANCHOR_VISIBILITY");b.la=!0;b.ua=!1;b.j=a;return b}function M(a){var b=u("DEPTH");b.j=a;return b}function y(a,b,c){var d=u("SSAO");d.la=!1;d.ua=!1;d.Lb=!1;d.j=a;d.bc=b.bc;d.Hd=new Float32Array(b.bc);d.xi=c.radius_increase;d.ssao_hemisphere=c.FA;d.wi=c.influence;d.vi=c.dist_factor;d.uu=c.FC;return d}function K(a,b){var c=u("SSAO_BLUR");c.la=!1;c.ua=!1;c.Lb=!1;c.j=a;c.ssao_blur_depth=b.Fx;c.ssao_blur_discard_value=b.Nq;return c}function x(){var a=u("ANTIALIASING");
a.la=!1;a.ua=!1;a.Lb=!1;a.Te=1/Aa.render_resolution_factor;a.j=Y.ub(Y.Bb);return a}function S(a){var b=u(a);b.la="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.ua=!1;b.Lb=!1;b.Te=1/Aa.render_resolution_factor;b.j=Y.ub(Y.Bb);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.XA=new Float32Array(4));return b}function T(a,b,c,d){var e=u("COMPOSITING");e.la=!1;e.ua=!1;e.Lb=!1;e.j=Y.ub(Y.Bb);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function U(a,b){var c=u("MOTION_BLUR");
c.la=!1;c.ua=!1;c.Lb=!1;c.j=Y.ub(Y.Bb);c.Tm=!0;c.mb_decay_threshold=a;c.mb_factor=b;return c}function fa(a){var b=u("DOF");b.la=!1;b.ua=!1;b.Lb=!1;b.j=a;b.Te=b.j.dof_power;return b}function R(a){var b=u("OUTLINE_MASK");b.Lb=!1;b.j=a;return b}function W(a){var b=u("OUTLINE");b.Ef.set(a.Ef);b.Uj=a.Uj;b.Mn=5;b.an=3;b.Lb=!1;b.j=Y.ub(Y.Bb);return b}function aa(){var a=u("REFRACT");a.la=!1;a.ua=!1;a.Lb=!1;a.j=Y.ub(Y.Bb);return a}function Q(a,b,c,d,e,f,h){var g=u("GOD_RAYS");g.la=!1;g.ua=!1;g.Lb=!1;g.tf=
new Float32Array([1,1,1]);g.cg=new Float32Array([1,1,1]);g.nf=1;g.ut=d;g.Zf=b;g.hm=e;g.ai=c;g.Bi=h;g.j=a;g.Bf=f;g.Mg=new Float32Array(3*f);g.wf=new Float32Array(3*f);g.Lg=new Float32Array(3*f);g.Ng=new Float32Array(0==f%2?2*f:2*f+2);return g}function V(a,b){var c=u("GOD_RAYS_COMBINE");c.la=!1;c.ua=!1;c.Lb=!1;c.j=Y.ub(Y.Bb);c.god_rays_intensity=a;c.Bf=b;c.Mg=new Float32Array(3*b);c.wf=new Float32Array(3*b);c.Lg=new Float32Array(3*b);c.Ng=new Float32Array(0==b%2?2*b:2*b+2);return c}function oa(a,b){var c=
u("SKY");c.enqueue=!1;c.la=!1;c.ua=!1;c.Lb=!1;var d=Y.ub(Y.Bb);d.width=pa.gl;d.height=pa.gl;c.j=d;c.lj=Gb.Lz();c.Bf=a;c.Mg=new Float32Array(3*a);c.wf=new Float32Array(3*a);c.Lg=new Float32Array(3*a);c.Ng=new Float32Array(0==a%2?2*a:2*a+2);c.tf=new Float32Array([1,1,1]);c.cg=new Float32Array([1,1,1]);c.nf=1;c.si.set(b.si);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;
c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function ca(){var a=u("COPY");a.la=!1;a.ua=!1;a.j=Y.ub(Y.Bb);return a}function ka(){var a=u("ANAGLYPH");a.la=!1;a.ua=!1;a.j=Y.ub(Y.Bb);return a}function la(){var a=u("LUMINANCE");a.la=!1;a.ua=!1;a.j=Y.ub(Y.Bb);
return a}function ba(){var a=u("AVERAGE_LUMINANCE");a.la=!1;a.ua=!1;a.j=Y.ub(Y.Bb);return a}function ea(a,b,c,d){var e=u("LUMINANCE_TRUNCED");e.la=!1;e.ua=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.j=d;e.Bf=c;e.Mg=new Float32Array(3*c);e.wf=new Float32Array(3*c);e.Lg=new Float32Array(3*c);e.Ng=new Float32Array(0==c%2?2*c:2*c+2);return e}function F(a){var b=u("BLOOM");b.la=!1;b.ua=!1;b.j=Y.ub(Y.Bb);b.bloom_blur=a;return b}function I(){var a=u("SINK");a.enqueue=!1;return a}function da(a,b,c){if(b.type===
c)return!0;b=ma(a,b);for(var d=0;d<b.length;d++)if(da(a,b[d],c))return!0;return!1}function P(a,b,c){if(b.type===c)return!0;b=ua(a,b);for(var d=0;d<b.length;d++)if(P(a,b[d],c))return!0;return!1}function ua(a,b){var c=E.Wg(a,b);if(c==E.iq)throw"Subscene not in graph";for(var d=[],e=E.mo(a,c),f=0;f<e;f++){var h=E.Gj(a,c,f);h!=c&&d.push(E.Qa(a,h))}return d}function ma(a,b){var c=E.Wg(a,b);if(c==E.iq)throw"Subscene not in graph";for(var d=[],e=E.Df(a,c),f=0;f<e;f++){var h=E.qf(a,c,f);h!=c&&d.push(E.Qa(a,
h))}return d}function ha(a){var b=[],c=[];p(a,function(a){a.Ba&&-1==b.indexOf(a.Ba)&&(b.push(a.Ba),c.push(a.Ba,b.length-1))});return c}function ga(a,b){var c;c=""+(a.X+"\\n");c+="NONE"!=a.ya?a.ya+"\\n":"";c+="(";if(a.Ji){var d=a.Pf;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.X){c+=" ";if(a.nh)c+="RR";else{var d=a.ga,e=a.fa,f="";d==Z.t?f+="L":d==Z.zc&&(f+="N");e==Z.t?f+="L":e==Z.zc&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.Ba&&(c+=" "+
b[d+1])}return c+")\\n"}var Y=q("__camera"),qa=q("__config"),O=q("__debug"),E=q("__graph"),ia=q("__obj_util"),ta=q("__renderer"),Z=q("__textures"),Gb=q("__util"),kb=qa.Cn,Aa=qa.q,pa=qa.ni;a.by=function(a){switch(a.ya){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "NONE":return!1;default:return!0}};a.PD=p;a.Fy=function(a,b,e){function h(c,e){var f=d(va[e]);b.L.push(f);f=L(c,f,!1,Hb,ga,Xb,Lb,lb,a.lh);n.push(f);E.u(g,f);E.n(g,l[e],f,r[e]);"XRAY"==c?f.sa.push(D("DEPTH",
"DEPTH",1,1,!0)):E.n(g,l[e],f,ia[e]);Ra&&(E.n(g,Ra,f,Mb),E.n(g,Ra,f,zb));if(ib){for(var k=0;k<qa.length;k++)E.n(g,qa[k],f,ua[k]);if(Ic.tc&&Nb||Vb||Nc){var k=mb[e],O=d(k.j);b.L.push(O);var m=u("DEPTH_PACK");m.la=!1;m.ua=!1;m.j=O;E.u(g,m);var O=D("DEPTH","u_depth",1,1,!0),p=D("COLOR","u_scene_depth",1,1,!0);p.ga=Z.zc;p.fa=Z.zc;E.n(g,k,m,O);E.n(g,m,f,p)}}if(q.length)for(m=q.length/va.length,k=0;k<m;k++)O=m*e+k,E.n(g,q[O],f,ta[O]);if(ma.length)for(k=0;k<ma.length;k++)E.n(g,ma[k],f,ha[k]);da.length&&E.n(g,
da[e],f,P[e]);return f}var g=E.create(),l=[],n=[],p=[],r=[],ia=[],q=[],ta=[],da=[],P=[],qa=[],ua=[],ma=[],ha=[],ga=a.$A,Hb=a.ob,Vb=a.shore_smoothing,Nc=a.jD,Jc=a.Re,Rc=a.Rh,Ic=a.DB,Ob=a.ki,pb=a.Ex,Sa=a.Vg,fc=a.Dh,Kc=a.antialiasing,Lb=a.cq,Xb=a.lv,lb=a.Zb,zc=a.HB,fb=a.Qx,Ta=a.zA,Va=a.SB,gb=a.Hh,ib=a.ez,Nb=a.tc,Fa=Boolean(e.length),va=[];if(a.anaglyph_use&&!Fa){var gc=b.L[0],Ab=d(gc);Y.Zs(gc,Y.Cb);Y.Zs(Ab,Y.Hb);va.push(gc,Ab);b.L.push(Ab)}else{var wa=b.L[0];va.push(wa)}if(lb){Y.Np(va[0],lb);for(var Wa=
lb.csm_num,X=0;X<Wa;X++){var Ja=H(X,lb);E.u(g,Ja);qa.push(Ja);var Ba=lb.csm_resolution,wa=Ja.j;wa.width=Ba;wa.height=Ba;Ja.la=!1;ua.push(D("DEPTH","u_shadow_map"+X,Ba,1,!1));(O.Zq()||Aa.Or)&&Ja.sa.push(D("COLOR","COLOR",Ba,1,!1))}}if(Ob&&Ob.mt&&!Fa)for(X=0;X<Ob.mt;X++){wa=Y.ub(Y.Qb);wa.width=a.rg;wa.height=a.rg;Y.om(wa,90,.1,100);Y.Kf(wa,wa.Ea);var Ca=L("CUBE_REFLECT",wa,!1,Hb,ga,Xb,Lb,null,a.lh);Ca.lj=Gb.Pz();for(var za=0;6>za;za++)Ca.xn.push(Y.wy());E.u(g,Ca);var Oa=D("CUBEMAP","u_cube_reflection",
a.rg,1,!1);Oa.ga=Z.t;Oa.fa=Z.t;var hc=D("DEPTH","DEPTH",a.rg,1,!1);ha.push(Oa);Ca.sa.push(hc);ma.push(Ca);Ob.jf.push(Ca)}if(Ob&&0<Ob.Mt.length&&!Fa)for(X=0;X<va.length;X++)for(za=0;za<Ob.Mt.length;za++)wa=d(va[X]),wa.gc=new Float32Array(4),b.L.push(wa),Ca=L("PLANE_REFLECT",wa,!1,Hb,ga,Xb,Lb,null,a.lh),E.u(g,Ca),Oa=D("COLOR","u_plane_reflection",1,a.$j,!0),Oa.ga=Z.t,Oa.fa=Z.t,hc=D("DEPTH","DEPTH",1,a.$j,!0),ta.push(Oa),Ca.sa.push(hc),q.push(Ca),Ob.Gf.push(Ca);l=[];n=[];if(a.Eb){var Ra=v();E.u(g,Ra);
Ba=pa.vl;Ra.j.width=Ba;Ra.j.height=Ba;var Mb=D("DEPTH","u_grass_map_depth",Ba,1,!1);Mb.ga=Z.t;Mb.fa=Z.t;var zb=D("COLOR","u_grass_map_color",Ba,1,!1);zb.ga=Z.t;zb.fa=Z.t}else zb=Mb=Ra=null;for(var nb=[],rc=[],mb=[],ic=[],X=0;X<va.length;X++){var wa=va[X],hb={};ia.push(D("DEPTH","DEPTH",1,1,!0));if(ib){var Ac=d(wa);b.L.push(Ac);hb=M(Ac);mb.push(hb);E.u(g,hb);if(lb){hb.self_shadow_normal_offset=lb.self_shadow_normal_offset;for(za=0;za<qa.length;za++)Ja=qa[za],E.n(g,Ja,hb,ua[za]);var qb=D("COLOR","u_color",
1,1,!0),Bb=D("DEPTH","u_depth",1,1,!0);if(Jc){var Ma=d(wa);b.L.push(Ma);var Ya=a.yD,bb=y(Ma,Xb,Ya);E.u(g,bb);var Yb=D("COLOR","u_ssao_mask",1,1,!0);E.n(g,hb,bb,qb);E.n(g,hb,bb,Bb);var jc=d(wa);b.L.push(jc);var Za=K(jc,Ya);E.u(g,Za);var Fc=D("COLOR","u_shadow_mask",1,1,!0);E.n(g,bb,Za,Yb);E.n(g,hb,Za,Bb)}}else O.Zq()&&hb.sa.push(D("COLOR","COLOR",1,1,!0));Ra&&(E.n(g,Ra,hb,Mb),E.n(g,Ra,hb,zb))}Ca=L("OPAQUE",wa,!ib,Hb,ga,Xb,Lb,null,a.lh);E.u(g,Ca);n.push(Ca);rc.push(Ca);ib&&(E.n(g,hb,Ca,ia[X]),Yb?E.n(g,
Za,Ca,Fc):lb&&E.n(g,hb,Ca,D("COLOR","u_shadow_mask",1,1,!0)));var Bc=D("COLOR","u_color",1,1,!0);r.push(D("COLOR","COLOR",1,1,!0));Ra&&(E.n(g,Ra,Ca,Mb),E.n(g,Ra,Ca,zb));if(q.length)for(var Cb=q.length/va.length,za=0;za<Cb;za++){var sc=Cb*X+za;E.n(g,q[sc],Ca,ta[sc])}if(ma.length)for(za=0;za<ma.length;za++)E.n(g,ma[za],Ca,ha[za])}l=n;n=[];if(!Fa&&a.iy){wa=d(l[0].j);b.L.push(wa);var Ib=A(wa,!1);E.u(g,Ib);if(a.Xe){wa=d(l[0].j);b.L.push(wa);var rb=A(wa,!0);E.u(g,rb);E.n(g,Ib,rb,D("COLOR","COLOR",1,1,!0));
E.n(g,Ib,rb,D("DEPTH","DEPTH",1,1,!0))}}else Ib=null;if(Ic.tc&&!Fa)for(X=0;X<va.length;X++){var sb=aa();E.u(g,sb);E.n(g,l[X],sb,Bc);da.push(sb);P.push(D("COLOR","u_refractmap",1,1,!0))}if(a.bo){for(X=0;X<va.length;X++)Ca=h("BLEND",X),nb.push(Ca);l=n;n=[]}if(a.rf){for(X=0;X<va.length;X++){var Da=d(va[X]);b.L.push(Da);var Ga=L("GLOW",Da,!1,Hb,ga,Xb,Lb);E.u(g,Ga);E.n(g,rc[X],Ga,ia[X]);var sa=m("X_GLOW_BLUR");sa.Sa="GLOW_MASK_SMALL";sa.Te=a.sf.small_glow_mask_width;var cb=D("COLOR","u_color",1,1,!0);
cb.ga=Z.t;cb.fa=Z.t;E.u(g,sa);E.n(g,Ga,sa,cb);var Ha=m("Y_GLOW_BLUR");Ha.Sa="GLOW_MASK_SMALL";Ha.Te=a.sf.small_glow_mask_width;var xb=D("COLOR","u_color",1,.5,!0);xb.ga=Z.t;xb.fa=Z.t;E.u(g,Ha);E.n(g,sa,Ha,xb);var Pa=m("X_GLOW_BLUR");Pa.Sa="GLOW_MASK_LARGE";Pa.Te=a.sf.large_glow_mask_width;var Db=D("COLOR","u_color",1,.5,!0);Db.ga=Z.t;Db.fa=Z.t;E.u(g,Pa);E.n(g,Ha,Pa,Db);var db=m("Y_GLOW_BLUR");db.Sa="GLOW_MASK_LARGE";db.Te=a.sf.large_glow_mask_width;var mc=D("COLOR","u_color",1,.25,!0);mc.ga=Z.t;mc.fa=
Z.t;E.u(g,db);E.n(g,Pa,db,mc);var Zb=d(va[X]);b.L.push(Zb);var Xa=z(Zb,a);E.u(g,Xa);a.bo?E.n(g,nb[X],Xa,D("COLOR","u_src_color",1,1,!0)):E.n(g,rc[X],Xa,D("COLOR","u_src_color",1,1,!0));var nc=D("COLOR","u_glow_mask_small",1,.5,!0);nc.ga=Z.t;nc.fa=Z.t;E.n(g,Ha,Xa,nc);var tc=D("COLOR","u_glow_mask_large",1,.25,!0);tc.ga=Z.t;tc.fa=Z.t;E.n(g,db,Xa,tc);p.push(Xa)}l=p;n=[]}if(!a.bo){for(X=0;X<va.length;X++)Ca=h("BLEND",X),nb.push(Ca);l=n;n=[]}if(a.Xe){for(X=0;X<va.length;X++){var kc=h("XRAY",X);ic.push(kc)}l=
n;n=[]}if(Aa.wireframe_debug){for(X=0;X<va.length;X++){wa=d(va[X]);b.L.push(wa);var Jb=J(wa);n.push(Jb);E.u(g,Jb);E.n(g,l[X],Jb,r[X]);E.n(g,l[X],Jb,ia[X]);Ra&&(E.n(g,Ra,Jb,Mb),E.n(g,Ra,Jb,zb))}l=n;n=[]}if(!Fa&&a.Rw){wa=d(va[0]);b.L.push(wa);var jb=N(wa);E.u(g,jb);E.n(g,l[0],jb,ia[0])}if(Rc&&ib&&!Fa){for(X=0;X<va.length;X++){var eb=Ta.ai,Ia=Ta.qo,Kb=Ta.Bi,Na=l[X],$b=Hb?1:0,yb=D("DEPTH","u_input",1,1,!0);yb.ga=Z.t;yb.fa=Z.t;var Eb=D("COLOR","u_input",1,.25,!0);Eb.ga=Z.t;Eb.fa=Z.t;var Pb=eb/Kb,Qb=d(va[X]);
b.L.push(Qb);var Ua=Q(Qb,$b,eb,!0,Pb,ga,Kb);E.u(g,Ua);E.n(g,Na,Ua,yb);var Pb=eb/Kb*.5,Cc=d(va[X]);b.L.push(Cc);var ac=Q(Cc,$b,eb,!1,Pb,ga,Kb);E.u(g,ac);E.n(g,Ua,ac,Eb);var Pb=eb/Kb*.25,lc=d(va[X]);b.L.push(lc);var tb=Q(lc,$b,eb,!1,Pb,ga,Kb);E.u(g,tb);E.n(g,ac,tb,Eb);var bc=V(Ia,ga);n.push(bc);E.u(g,bc);E.n(g,Na,bc,D("COLOR","u_main",1,1,!0));E.n(g,tb,bc,D("COLOR","u_god_rays",1,1,!0))}l=n;n=[]}if(pb&&!Fa){for(X=0;X<va.length;X++){var Na=l[X],uc=la();E.u(g,uc);E.n(g,Na,uc,D("COLOR","u_input",1,1,!0));
var cc=ba();E.u(g,cc);cc.j.width=Aa.uj?2:1;cc.j.height=Aa.uj?2:1;var Rb=D("COLOR","u_input",1,.25,!0);Rb.ga=Z.t;Rb.fa=Z.t;var vc=D("COLOR","u_luminance",1,.25,!0);vc.ga=Z.t;vc.fa=Z.t;E.n(g,uc,cc,Rb);var oc=pb.key,Oc=pb.jz,wc=d(va[X]);b.L.push(wc);var dc=ea(oc,Oc,ga,wc);E.u(g,dc);E.n(g,Na,dc,D("COLOR","u_main",1,1,!0));E.n(g,uc,dc,vc);E.n(g,cc,dc,D("COLOR","u_average_lum",1,1,!1));var Fb=D("COLOR","u_color",1,.25,!0);Fb.ga=Z.t;Fb.fa=Z.t;sa=t("X_BLUR");E.u(g,sa);E.n(g,dc,sa,Fb);Ha=t("Y_BLUR");E.u(g,
Ha);E.n(g,sa,Ha,Fb);var Gc=F(pb.blur);E.u(g,Gc);var $a=D("COLOR","u_bloom",1,.25,!0);$a.ga=Z.t;$a.fa=Z.t;E.n(g,Ha,Gc,$a);E.n(g,Na,Gc,D("COLOR","u_main",1,1,!0));n.push(Gc)}l=n;n=[]}if(Sa&&!Fa){for(X=0;X<l.length;X++){var Ka=l[X],Pc=U(zc.mb_decay_threshold,zc.mb_factor);n.push(Pc);E.u(g,Pc);E.n(g,Ka,Pc,D("COLOR","u_mb_tex_curr",1,1,!0));Pc.sa.push(D("COLOR","u_mb_tex_accum",1,1,!0))}l=n;n=[]}if(gb&&ib&&!Fa){for(X=0;X<l.length;X++){var Na=l[X],Dc=d(va[X]);b.L.push(Dc);Fb=D("COLOR","u_color",1,1,!0);
Fb.ga=Z.t;Fb.fa=Z.t;var xc=m("X_BLUR");E.u(g,xc);E.n(g,Na,xc,Fb);var Sb=m("Y_BLUR");E.u(g,Sb);E.n(g,xc,Sb,Fb);var hb=nb[X],pc=fa(Dc);Dc.dof_distance=b.dof_distance;Dc.we=b.we;Dc.dof_front=b.dof_front;Dc.dof_rear=b.dof_rear;Dc.dof_power=b.dof_power;Dc.dof_on=1;n.push(pc);E.u(g,pc);E.n(g,Na,pc,D("COLOR","u_sharp",1,1,!0));E.n(g,Sb,pc,D("COLOR","u_blurred",1,1,!0));E.n(g,hb,pc,D("DEPTH","u_depth",1,1,!0))}l=n;n=[]}if(!Fa&&a.outline){for(X=0;X<va.length;X++){var Na=l[X],Qc=d(va[X]);b.L.push(Qc);var Lc=
R(Qc);E.u(g,Lc);var Tb=m("X_EXTEND"),Yc=D("COLOR","u_color",1,1,!0),Sc=D("COLOR","u_outline_mask",1,1,!0);Tb.Lj=!0;E.u(g,Tb);E.n(g,Lc,Tb,Yc);var Zc=D("COLOR","u_color",1,.5,!0);Zc.ga=Z.t;Zc.fa=Z.t;var $c=m("Y_EXTEND");$c.Lj=!0;E.u(g,$c);E.n(g,Tb,$c,Zc);xc=m("X_BLUR");xc.Lj=!0;E.u(g,xc);E.n(g,$c,xc,Zc);var ed=D("COLOR","u_color",1,.25,!0);ed.ga=Z.t;ed.fa=Z.t;var fd=D("COLOR","u_outline_mask_blurred",1,.25,!0);fd.ga=Z.t;fd.fa=Z.t;Sb=m("Y_BLUR");Sb.Lj=!0;E.u(g,Sb);E.n(g,xc,Sb,ed);var Tc=W(Va);E.u(g,
Tc);E.n(g,Na,Tc,D("COLOR","u_outline_src",1,1,!0));E.n(g,Lc,Tc,Sc);E.n(g,Sb,Tc,fd);n.push(Tc)}l=n;n=[]}if(fc&&!Fa){for(X=0;X<l.length;X++){var Na=l[X],gd=T(fb.brightness,fb.contrast,fb.exposure,fb.saturation);E.u(g,gd);E.n(g,Na,gd,D("COLOR","u_color",1,1,!0));n.push(gd)}l=n;n=[]}if(Kc){for(X=0;X<l.length;X++)if(Na=l[X],Aa.smaa){var Uc=D("COLOR","u_color",1,1,!0);Uc.ga=Z.t;Uc.fa=Z.t;var hd=S("SMAA_EDGE_DETECTION");E.u(g,hd);E.n(g,Na,hd,Uc);var Vc=S("SMAA_BLENDING_WEIGHT_CALCULATION");E.u(g,Vc);E.n(g,
hd,Vc,Uc);var jd=D("COLOR","u_search_tex",1,1,!1),kd=D("COLOR","u_area_tex",1,1,!1);jd.ga=Z.t;jd.fa=Z.t;kd.ga=Z.t;kd.fa=Z.t;Vc.sa.push(jd);Vc.sa.push(kd);var ad=S("SMAA_NEIGHBORHOOD_BLENDING");E.u(g,ad);E.n(g,Na,ad,Uc);var ld=D("COLOR","u_blend",1,1,!0);ld.ga=Z.t;ld.fa=Z.t;E.n(g,Vc,ad,ld);n.push(ad)}else{var bd=x();E.u(g,bd);var cd=D("COLOR","u_color",1,1,!0);cd.ga=Z.t;cd.fa=Z.t;E.n(g,Na,bd,cd);if(1<Aa.render_resolution_factor){var md=m("NONE");E.u(g,md);E.n(g,bd,md,cd);n.push(md)}else n.push(bd)}l=
n;n=[]}if(a.anaglyph_use&&!Fa){var dd=ka();E.u(g,dd);E.n(g,l[0],dd,D("COLOR","u_sampler_left",1,1,!0));E.n(g,l[1],dd,D("COLOR","u_sampler_right",1,1,!0));n.push(dd)}else n.push(l[0]);var sd=E.Wg(g,l[0]);if("MOTION_BLUR"==l[0].type)var nd=!0;else nd=!1,E.Ue(g,sd,function(a,b,c){if(c.X==c.ya)return nd=!0});if(nd){var Mc=ca();E.u(g,Mc);E.n(g,l[0],Mc,D("COLOR","u_color",1,1,!0));l=n;n=[];n.push(Mc)}Ib&&(rb?n.push(rb):n.push(Ib));jb&&n.push(jb);if(!Fa&&a.sm.procedural_skydome){var od=oa(ga,a.sm);E.u(g,
od);n.push(od)}var Hc=I();E.u(g,Hc);for(X=0;X<n.length;X++){var Wc=n[X];switch(Wc.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":E.n(g,Wc,Hc,D("COLOR","NONE",1,1,!0));E.n(g,Wc,Hc,D("DEPTH","NONE",1,1,!0));break;case "SKY":E.n(g,Wc,Hc,D("CUBEMAP","u_sky",pa.gl,1,!1));break;case "ANCHOR_VISIBILITY":E.n(g,Wc,Hc,D("COLOR","NONE",1,1,!0));break;default:if(Fa){var pd=e[0].k,Xc=D("COLOR","OFFSCREEN",1,1,!0);Xc.Ba=pd;E.n(g,n[X],Hc,Xc);for(za=1;za<e.length;za++){var qd=e[za].k,Mc=ca();E.u(g,Mc);E.n(g,
n[X],Mc,D("COLOR","u_color",1,1,!0));Xc=D("COLOR","OFFSCREEN",1,qd.kh/pd.kh,!0);Xc.Ba=qd;E.n(g,Mc,Hc,Xc)}}else E.n(g,n[X],Hc,D("SCREEN","NONE",1,1,!0))}}if(kb.enabled){var rd=C(g);rd&&B(g,rd)}c(g,ib);1<Aa.render_resolution_factor&&k(g);f(g);w(g);if(lb){for(X=0;X<mb.length;X++)G(g,mb[X]);for(X=0;X<nb.length;X++)G(g,nb[X]);for(X=0;X<ic.length;X++)G(g,ic[X])}return g};a.KG=u;a.Rc=function(a,b,c){var d=a.Te;a.Gp[0]=b*a.Ta[0]*d;a.Gp[1]=c*a.Ta[1]*d};a.Yb=function(a,b){a.Te=b};a.hG=function(a){var b=null;
E.W(a,function(a,c){return c.j&&null===c.j.Ae?(b=c,!0):!1});return b};a.Oa=function(a,b,c){a=ua(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.DG=da;a.FG=P;a.kA=ua;a.wG=ma;a.Wa=function(a,b){var c=null;E.W(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.Xy=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=ha(a);E.W(a,function(a,d){var e=b+="    ",
g="",g=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(g+=" ("+d.dm.replace(/_/g," ")+")");if(d.j){for(var g=g+"\\n",f=0;f<c.length;f+=2)c[f]==d.j.pb&&(g+="C"+c[f+1]+" ");for(f=0;f<c.length;f+=2)c[f]==d.j.dd&&(g+="D"+c[f+1])}d.sa.length&&(g+="\\n-----\\n");for(f=0;f<d.sa.length;f++)g+=ga(d.sa[f],c);f="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+g+'" color="black" style="'+(f+",bold")+'"];\n')});E.ee(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+
ga(e,c)+'" style="'+(e.$a?"solid":"dotted")+'"];\n'});return b+="}"};a.Gy=function(a){a=E.LD(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,q){function d(){return{name:"",type:0,source:"",qp:"",width:0,height:0,rn:1,Gk:!0,kh:1024,Gr:!1,pe:null,Ya:null,oi:null,Xt:1,Ne:0,pi:!1,Cm:!1,Xh:!1,G:0,ja:0,Oh:0,wE:!1,mh:!1,Lo:0,mc:0,ac:0,kb:null,Yf:null}}function c(c,e,g,f){var h=c.type,k=new Uint8Array([204,204,204,255]),l=d();switch(h){case "DATA_TEX2D":case "IMAGE":var n=t.createTexture(),m=t.TEXTURE_2D;t.bindTexture(m,n);t.texImage2D(m,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,k);c.image&&"MOVIE"==c.image.source&&
(l.Xh=!0,l.G=c.frame_start,l.ja=c.frame_offset,l.Oh=c.frame_duration,l.wE=c.use_auto_refresh,l.mh=c.use_cyclic,l.Lo=c.movie_length,0!=l.ja&&B.warn('Frame offset for texture "'+c.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":n=t.createTexture();m=t.TEXTURE_2D;t.bindTexture(m,n);if("NONE"==c.b4w_source_type)return null;if("SCENE"==c.b4w_source_type)if(c.b4w_source_id&&(g=H.keysearch("name",c.b4w_source_id,g)))l.kh=c.b4w_source_size,g.Id=g.Id||
[],g.Id.push(c),t.texImage2D(m,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,k);else return null;break;case "ENVIRONMENT_MAP":n=t.createTexture();m=t.TEXTURE_CUBE_MAP;t.bindTexture(m,n);g="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var p=0;6>p;p++)u.po?t.texImage2D(t["TEXTURE_CUBE_MAP_"+g[p]],0,t.RGB,1,1,0,t.RGB,t.UNSIGNED_BYTE,k):t.texImage2D(t["TEXTURE_CUBE_MAP_"+g[p]],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,k);break;case "BLEND":return null;default:return B.error('texture "'+
c.name+'" has unsupported type "'+h+'"'),null}"NONE"==h&&(!c.b4w_enable_canvas_mipmapping||"CANVAS"!=c.b4w_source_type)||"DATA_TEX2D"==h||"IMAGE"==h&&"MOVIE"==c.image.source?t.texParameteri(m,t.TEXTURE_MIN_FILTER,t.LINEAR):u.po&&"ENVIRONMENT_MAP"==h?t.texParameteri(m,t.TEXTURE_MIN_FILTER,t.LINEAR):t.texParameteri(m,t.TEXTURE_MIN_FILTER,z[u.vm]);t.texParameteri(m,t.TEXTURE_MAG_FILTER,t.LINEAR);k=m;g=c.b4w_anisotropic_filtering;"DEFAULT"===g&&(g=e);"OFF"!==g&&u.Hk&&(e=C.Xz())&&(g=parseFloat(g.split("x")[0]),
t.texParameterf(k,e.TEXTURE_MAX_ANISOTROPY_EXT,g));"REPEAT"!=c.extension||c.b4w_shore_dist_map?(t.texParameteri(m,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(m,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)):(t.texParameteri(m,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(m,t.TEXTURE_WRAP_T,t.REPEAT));l.type=a.wh;l.width=1;l.height=1;l.kb=n;l.ac=m;"CANVAS"==c.b4w_source_type&&"NONE"==h?(h=c.b4w_source_id,n=c.b4w_source_size,l.Gr=c.b4w_enable_canvas_mipmapping,l.qp=h,l.source="CANVAS",m=document.createElement("canvas"),
m.width=n,m.height=n,l.pe=m.getContext("2d"),f in v||(v[f]={}),v[f][h]=l,b(l)):"SCENE"==c.b4w_source_type&&"NONE"==h?(l.qp=c.b4w_source_id,l.source="SCENE"):(l.source=h,t.generateMipmap(m),t.bindTexture(m,null));l.name=c.name;return c.k=l}function b(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.ac;t.bindTexture(b,a.kb);var c=n(a),d=r(a),e=a.pe.canvas;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);t.texImage2D(b,0,c,c,d,e);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1);a.Gr&&t.generateMipmap(b);t.bindTexture(b,
null);a.width=e.width;a.height=e.height}function l(a){var b=a.ac;t.bindTexture(b,a.kb);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);t.texImage2D(b,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a.oi[a.Ne]);t.bindTexture(b,null)}function f(a){t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.LINEAR)}function k(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];
return-1==c.indexOf(a)||-1==c.indexOf(b)}function n(b){switch(b.type){case a.wh:b=t.RGBA;break;case a.Jm:b=t.RGB;break;case a.Bk:b=t.RGBA;break;case a.Ck:b=t.RGB;break;case a.Ti:b=t.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function r(b){switch(b.type){case a.wh:b=t.UNSIGNED_BYTE;break;case a.Jm:b=t.UNSIGNED_BYTE;break;case a.Bk:b=t.FLOAT;break;case a.Ck:b=t.FLOAT;break;case a.Ti:b=t.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function e(a,b){return b in
m&&a in m[b]?(u.nd?m[b][a].pi=!0:m[b][a].Ya.play(),!0):null}function g(a,b){if(b in m&&a in m[b]){var c=m[b][a];u.nd?(c.Ne=c.ja,l(c),c.Ne++):c.Ya.currentTime=c.ja/c.mc;return!0}return null}function h(a,b){return b in m&&a in m[b]?(u.nd?m[b][a].pi=!1:m[b][a].Ya.pause(),!0):null}var p=q("__config"),w=q("__dds"),C=q("__extensions"),B=q("__print"),H=q("__util"),u=p.q,D=p.me,G=p.w;a.zc=0;a.t=0;a.Ew=0;a.Cw=0;a.Dw=0;a.Bw=0;a.wh=10;a.Jm=20;a.Bk=30;a.Ck=40;a.Ti=50;a.vh=60;var v={},m={},t=null,z;a.Ed=function(b){z=
[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.zc=b.NEAREST;a.t=b.LINEAR;a.Ew=b.NEAREST_MIPMAP_NEAREST;a.Cw=b.LINEAR_MIPMAP_NEAREST;a.Dw=b.NEAREST_MIPMAP_LINEAR;a.Bw=b.LINEAR_MIPMAP_LINEAR;t=b};a.aA=function(a,b){return b in v&&a in v[b]?v[b][a].pe:null};a.cE=function(a,c){return c in v&&a in v[c]?(b(v[c][a]),!0):!1};a.fl=function(b,c){var e=d();e.name=b;e.type=c;e.source="NONE";if(c==a.vh)e.Yf=t.createRenderbuffer();else{var g=t.TEXTURE_2D,f=t.createTexture();
t.bindTexture(g,f);t.texParameteri(g,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(g,t.TEXTURE_MIN_FILTER,t.LINEAR);t.texParameteri(g,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(g,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.bindTexture(g,null);e.ac=g;e.kb=f}return e};a.ty=function(b){var c=t.createTexture(),e=t.TEXTURE_CUBE_MAP;t.bindTexture(e,c);t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.LINEAR);t.texParameteri(e,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(e,
t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);for(var g="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),f=0;6>f;f++)t.texImage2D(t[g[f]],0,t.RGBA,b,b,0,t.RGBA,t.UNSIGNED_BYTE,null);t.bindTexture(e,null);e=d();e.name="CUBEMAP";e.type=a.wh;e.source="NONE";e.width=3*b;e.height=2*b;e.rn=1;e.kb=c;e.ac=t.TEXTURE_CUBE_MAP;return e};a.fk=function(b,c,d){if(b.type!=a.vh){var e=b.ac;t.bindTexture(e,
b.kb);c&&t.texParameteri(e,t.TEXTURE_MIN_FILTER,c);d&&t.texParameteri(e,t.TEXTURE_MAG_FILTER,d);t.bindTexture(e,null)}};a.vG=function(b){if(b.type==a.vh)return{min:a.zc,xB:a.zc};var c=b.ac;t.bindTexture(c,b.kb);b=t.getTexParameter(c,t.TEXTURE_MIN_FILTER);var d=t.getTexParameter(c,t.TEXTURE_MAG_FILTER);t.bindTexture(c,null);return{min:b,xB:d}};a.resize=function(b,c,d){c=Math.max(c,u.uj?2:1);d=Math.max(d,u.uj?2:1);if(b.width!=c||b.height!=d){if(b.type==a.vh)t.bindRenderbuffer(t.RENDERBUFFER,b.Yf),t.renderbufferStorage(t.RENDERBUFFER,
t.DEPTH_COMPONENT16,c,d),t.bindRenderbuffer(t.RENDERBUFFER,null);else{var e=b.ac;t.bindTexture(e,b.kb);var g=n(b),f=r(b);t.texImage2D(e,0,g,c,d,0,g,f,null);t.bindTexture(e,null)}c>u.Ub||d>u.Ub?B.error('Slink texture "'+b.name+'" has unsupported size: '+c+"x"+d+". Max available: "+u.Ub+"x"+u.Ub+"."):(b.width=c,b.height=d)}};a.Oy=c;a.qE=function(a){var b=a.ac;t.bindTexture(b,a.kb);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);4!=a.Ya.length?t.texImage2D(b,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a.Ya):t.texImage2D(b,
0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,a.Ya);t.bindTexture(b,null)};a.nE=l;a.nk=function(a,b,c,d,e){var g=a.source,h=a.ac;t.bindTexture(h,a.kb);if(4==b.length){var l=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==g)if(l)t.texImage2D(h,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){c=w.ns(b);if(c.width>u.Ub||c.height>u.Ub){B.error('Texture "'+d+'" has unsupported size: '+c.width+"x"+c.height+". Max available: "+u.Ub+"x"+u.Ub+".");return}w.sE(t,C.ks(),
b,!0);k(c.width,c.height)&&(a.Iq||B.warn("using NPOT texture",d),f(h));a.width=c.width;a.height=c.height;a.rn=w.cA(b)}else{t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);if(b.width>u.Ub||b.height>u.Ub){B.error('Texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+u.Ub+"x"+u.Ub+".");return}a.Xh?u.nd?b&&(e in m||(m[e]={}),m[e][a.name]=a,a.oi=b,a.mc=a.Lo/b.length,a.Oh=Math.round(a.Oh/a.mc),a.ja=Math.round(a.ja/a.mc),a.G=Math.round(a.G/a.mc),a.Ne=a.ja,t.texImage2D(h,0,t.RGBA,t.RGBA,
t.UNSIGNED_BYTE,a.oi[0])):(a.Ya=b,a.Ya.loop=a.mh,b&&(e in m||(m[e]={}),m[e][a.name]=a),a.mc=D.Pa,b.duration&&(a.mc=a.Lo/b.duration),G.Dr||(b.playbackRate=D.Pa/a.mc,G.cr&&2<b.playbackRate&&(b.playbackRate=2)),t.texImage2D(h,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a.Ya)):t.texImage2D(h,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,b);a.Xh?u.nd?(a.width=b[0].width,a.height=b[0].height):(a.width=b.videoWidth,a.height=b.videoHeight):(a.width=b.width,a.height=b.height);k(a.width,a.height)?(a.Iq||(a.Xh?B.warn("using NPOT video texture",
d):B.warn("using NPOT texture",d)),f(h)):a.Xh||t.generateMipmap(h)}else if("ENVIRONMENT_MAP"==g)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],l){for(l=0;6>l;l++)e=c[l],t.texImage2D(t["TEXTURE_CUBE_MAP_"+e[0]],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1);g=b.width/3;if(g>u.Tg||g>u.Tg){B.warn('Cubemap texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+
3*u.Tg+"x"+2*u.Tg+". Reduced image size will be used.");var n=b.width/3*(u.Tg/g)}else n=g;for(l=0;6>l;l++){e=c[l];var p=document.createElement("canvas");p.width=n;p.height=n;var r=p.getContext("2d");"POSITIVE_Y"==e[0]||"NEGATIVE_Y"==e[0]?(r.translate(0,n),r.scale(1,-1)):(r.translate(n,0),r.scale(-1,1));r.drawImage(b,e[1]*g,e[2]*g,g,g,0,0,n,n);t.texImage2D(t["TEXTURE_CUBE_MAP_"+e[0]],0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,p)}a.width=3*n;a.height=2*n;k(b.width/3,b.height/2)?(B.warn("using NPOT cube map texture",
d),f(h)):t.generateMipmap(h)}else"DATA_TEX2D"==g&&(t.texImage2D(h,0,t.RGBA,b.width,b.height,0,t.RGBA,t.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);t.bindTexture(h,null)};a.dz=function(a){t.deleteTexture(a)};a.Nj=function(a){return a&&a.name&&(a.kb||a.Yf)?!0:!1};a.Js=function(a){return a&&a.name&&a.Yf?!0:!1};a.PG=function(b){return b.type==a.Bk||b.type==a.Ck?!0:!1};a.tA=function(b){var c=0;switch(b.type){case a.wh:case a.Jm:c=4;break;case a.Bk:case a.Ck:c=16;break;case a.Ti:c=3;break;
case a.vh:c=2}return c};a.Tz=function(a){var b=null,b={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};c(b,null,a,0);b.image={filepath:null};return b};a.cleanup=function(){if(!u.nd)for(var a in m)for(var b in m[a])m[a][b].Ya.pause(),m[a][b].Ya.src="",m[a][b].Ya.load();v={};m={}};a.play_video=e;a.reset_video=g;a.pause_video=h;a.pause=function(){for(var a in m)for(var b in m[a])u.nd&&!m[a][b].pi||!u.nd&&m[a][b].Ya.paused||(h(b,a),m[a][b].Cm=!0)};a.reset=
function(){for(var a in m)for(var b in m[a])g(b,a),m[a][b].Cm=!1};a.play=function(a){for(var b in m)for(var c in m[b])if(!a||m[b][c].Cm)e(c,b),m[b][c].Cm=!1}};b4w.module.__assets=function(a,q){function d(){return C.NA()?q(C.fc.Uk).data:null}function c(){var a={Dk:null,Nw:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.Dk=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=d();b&&a.Dk in b&&(a.status=200,b[a.Dk]&&(a.response=a.Nw(b[a.Dk])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function b(b){for(var c=0,d=0;d<b.length;d++){var g=b[d];20===g.state&&c++;if(c>=m.FB)break;if(10===g.state)switch(g.state=20,c++,g.type){case a.AT_ARRAYBUFFER:l(g,"arraybuffer");break;case a.AT_JSON:l(g,"json");break;case a.AT_TEXT:l(g,"text");break;case a.AT_AUDIOBUFFER:f(g);break;case a.AT_IMAGE_ELEMENT:k(g);
break;case a.AT_AUDIO_ELEMENT:n(g);break;case a.xk:r(g);break;case a.wk:e(g);break;default:D.ka("Wrong asset type: "+g.type)}}}function l(a,b){var e=d(),g=e&&a.s in e?new c:new XMLHttpRequest;g.open("GET",a.s,!0);"text"==b?(g.overrideMimeType("text/plain"),g.responseType="text"):"json"==b?(g.overrideMimeType("application/json"),g.responseType="text"):g.responseType=b;g.onreadystatechange=function(){if(40!=a.state&&4==g.readyState){if(200==g.status||0==g.status){var c=g.response;if(c){if("json"==b&&
"string"==typeof c)try{c=JSON.parse(c)}catch(d){H.error(d+" (parsing JSON "+a.s+")");a.tb(null,a.uri,a.type,a.s,a.yb);return}a.tb(c,a.uri,a.type,a.s,a.yb)}else H.error("empty responce when trying to get "+a.s),a.tb(null,a.uri,a.type,a.s,a.yb)}else H.error(g.status+" when trying to get "+a.s),a.tb(null,a.uri,a.type,a.s,a.yb);a.state=30}};g.addEventListener("progress",function(b){b.lengthComputable&&a.Ft(b.loaded/b.total)},!1);g.send(null)}function f(a){var b=d(),e=b&&a.s in b?new c:new XMLHttpRequest;
e.open("GET",a.s,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?u.$y(b,function(b){a.tb(b,a.uri,a.type,a.s,a.yb);a.state=30},function(){a.tb(null,a.uri,a.type,a.s,a.yb);H.error("failed to decode "+a.s);a.state=30}):(a.tb(null,a.uri,a.type,a.s,a.yb),H.error("empty responce when trying to get "+a.s),a.state=30)}else a.tb(null,a.uri,a.type,a.s,a.yb),H.error(e.status+" when trying to get "+a.s),a.state=
30};e.send(null)}function k(a){var b=document.createElement("img");v.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.tb(b,a.uri,a.type,a.s,a.yb),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.tb(null,a.uri,a.type,a.s,a.yb),H.error("could not load image: "+a.s),a.state=30)},!1);var c=d();if(c&&a.s in c)if(c[a.s]){var e=h(a.s);b.src="data:"+e+";base64,"+c[a.s]}else B.to()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=
new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.s}function n(a){var b=document.createElement("audio");if(v.allow_cors||v.mr)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.tb(b,a.uri,a.type,a.s,a.yb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.tb(null,a.uri,a.type,a.s,a.yb),H.error("could not load sound: "+a.s),a.state=30)},!1);var c=d();if(c&&a.s in c)if(c[a.s]){var e=p(a.s);b.src="data:"+e+";base64,"+c[a.s];40!=a.state&&(a.tb(b,
a.uri,a.type,a.s,a.yb),a.state=30)}else B.to()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.s,v.Ig&&b.load();v.Ko&&(b.autoplay=!0,b.pause());setTimeout(function(){b.lD=1},5E3)}function r(a){function b(){40!=a.state&&(a.tb(null,a.uri,a.type,a.s),H.error("could not load video: "+a.s,a.yb),a.state=30)}var c=document.createElement("video");c.muted=!0;if(v.allow_cors||v.Ig)c.crossOrigin="Anonymous";c.addEventListener("loadeddata",
function(){c.removeEventListener("error",b,!1);40!=a.state&&(a.tb(c,a.uri,a.type,a.s,a.yb),a.state=30)},!1);c.addEventListener("error",b,!1);var e=d();if(e&&a.s in e)if(e[a.s]){var g=w(a.s);c.src="data:"+g+";base64,"+e[a.s];40!=a.state&&c.addEventListener("loadeddata",function(){a.tb(c,a.uri,a.type,a.s,a.yb);a.state=30},!1)}else B.to()?(e=document.createEvent("CustomEvent"),e.initCustomEvent("error",!1,!1,null)):e=new CustomEvent("error"),c.dispatchEvent(e);else c.src=a.s,v.Ig&&c.load();v.Ko&&(c.autoplay=
!0,c.pause());setTimeout(function(){c.lD=1},1E4)}function e(a){function b(c){a.tb(c,a.uri,a.type,a.s,a.yb)}var e=d(),f=e&&a.s in e?new c:new XMLHttpRequest;f.open("GET",a.s,!0);f.responseType="arraybuffer";f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var c=f.response;c?g(c,b):(a.tb(null,a.uri,a.type,a.s,a.yb),H.error("empty responce when trying to get "+a.s))}else a.tb(null,a.uri,a.type,a.s,a.yb),H.error(f.status+" when trying to get "+a.s);a.state=
30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.Ft(b.loaded/b.total)},!1);f.send(null)}function g(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],g={images:[],Mq:[],mc:c[4]},f=20,h=0;h<e;h++){var k=c[f/4],l=new Blob([d.subarray(f+4,f+4+k)],{type:"image/jpg"}),n=document.createElement("img");n.src=window.URL.createObjectURL(l);g.images.push(n);g.Mq.push(l);f+=k+8-k%4}n.onload=function(){for(var a=0;a<g.images.length;a++)window.URL.revokeObjectURL(g.images[a].src);delete g.Mq;
b(g)}}function h(a){var b="image";switch(D.Yn(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function p(a){var b="audio";switch(D.Yn(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function w(a){var b="video";switch(D.Yn(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var C=q("__config"),B=q("__compat"),
H=q("__print"),u=q("__sfx"),D=q("__util"),G=q("__version"),v=C.q,m=C.Kd;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.xk=70;a.wk=80;var t=[],z=0,L={};a.ik=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.yG=function(a){if(L[a])return L[a];var b=m.Yo?a+G.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=
c.responseText;if(b.length)return L[a]=b;D.ka("Error XHR: responce is empty, GET "+a)}else D.ka("Error XHR: "+c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<t.length;a++)t[a].state=40;t=[];z=0;L={}};a.enqueue=function(a,c,e,g){for(var f=0;f<a.length;f++){var h=a[f],h={uri:h[0],type:h[1],s:h[2],yb:h[3],state:10,tb:c||function(){},vt:e||function(){},Ft:g||function(){},wt:z};if(m.Yo){var k=d();k&&h.s in k||(h.s+=G.timestamp())}t.push(h)}b(t);z++};a.update=function(){b(t);for(var a=t,c=0,d=
!0,e=0;e<a.length;e++){var g=a[e];g.wt===a[c].wt?30!==g.state&&(d=!1):(d&&(a[e-1].vt(),d=e-c,a.splice(c,d),e-=d),c=e,d=30===a[e].state?!0:!1);e===a.length-1&&d&&(a[e].vt(),a.splice(c))}}};b4w.module.__loader=function(a,q){function d(b,d,e,g){var f=u,k=C.create(),l;for(l in d){var n=c(d[l]);(g&&n.fb||!b&&n.rb)&&h(n);C.u(k,n)}for(l in d)for(n=d[l],n.name=l,b=0;b<n.C.length;b++)C.n(k,d[n.C[b]],n,null);d=c({name:"out",Ra:a.ov,mb:function(a,b,c,d,e){0===b.id&&(f.vp=!0);w(b)||(b.status=2);b.Xs(b.id,!0);e(b,c);B.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},hb:5});var p=[];if(e)for(e=C.ms(k),b=0;b<e.length;b++)p.push(C.Qa(k,e[b]));else C.W(k,function(a,b){b.ab||p.push(b)});C.u(k,
d);for(b=0;b<p.length;b++)d.C.push(p[b].name),C.n(k,p[b],d,null);return k}function c(a){a.ab=a.ab||!1;a.Ra||0===a.Ra||(a.Ra=a.qd);a.C=a.C||[];a.Kj=a.Kj||!1;a.np=a.np||!1;a.hb=a.hb||0;a.fb=a.fb||!1;a.rb=a.rb||!1;a.status=0;a.YG=0;a.Co=0;a.lg=a.lg||null;return a}function b(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var g=b[e];C.Qa(a.ae,g).Kj&&(C.Tf(a.ae,g,function(d){var e=!0;C.Ue(a.ae,d,function(a,b){if(!b.Kj)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-
1;0<=e;e--)b.splice(d[e],1);return c}function l(a){function c(b,d){var e=C.Qa(a.ae,b),g=C.Qa(a.ae,d),f=g.Ra-e.Ra;0==f&&(f=e.ab-g.ab);return f}var d=[],e=a.Se,g=!1;do{var f=b(a,e);d.push.apply(d,e);0<f.length&&(g=!0);e=f}while(0<f.length);g&&d.sort(c);a.Se=d;return a.Se.length}function f(a,b,c){if(b.np)return b.Kj=!0,n(a,b),!1;if(!b.mb&&!b.gf&&!b.cj)return n(a,b),!1;if(0==b.status&&(b.status++,b.mb))return b.mb(c,a,b,b.lg,n,r),!0;if(1==b.status){if(b.gf)return b.gf(c,a,b,b.lg,n,r),!0;b.status++}return 2==
b.status&&(b.status++,b.cj)?(b.cj(c,a,b,b.lg,n,r),!0):!1}function k(a){if(0==a.tm)return 100;var b=0;C.W(a.ae,function(c,d){a.do_not_load_resources&&d.fb||(b+=d.Co*d.hb)});return H.trunc(100*b/a.tm)}function n(a,b){b.Kj=!0;b.status=3;e(a,b,1)}function r(a,b,c){1>c?e(a,b,c):b.status++}function e(a,b,c){var d=u;if(b.mb||b.gf||b.cj)if(b.Co=c,b=k(a),a.wr!=b||1==c)a.up(b,performance.now()-a.Iu),a.wr=b,d.Fo=!0}function g(a,b){var c=null;C.W(a.ae,function(a,d){if(d.name==b)return c=d,1});return c}function h(a){a.np=
!0;a.Co=1}function p(a){a.up=null;a.qn=null;a.ae=null;a.Se=null}function w(a){return a&&(3==a.status||4==a.status)}var C=q("__graph"),B=q("__print"),H=q("__util");a.qd=0;a.he=1;a.ov=2;var u=null;a.ls=function(){return u};a.Hy=function(){var a={de:[],zn:0,Fk:0,vp:!1,Fo:!1};return u=a};a.Py=function(a,b,c,e,g,f,h,k){var l=u,n={id:l.de.length,status:0,s:b,Kq:"",Xs:c||function(){},Ws:k||!1,yH:f,Iu:0,wr:0,tm:0,ep:!1,up:e||function(){},qn:g||function(){},ae:null,Se:null,jo:!1,io:!1,no:!1};a=d(0===n.id,
a,f,h);n.ae=a;b=[];c=C.rA(a);for(e=0;e<c.length;e++)b.push(c[e]);n.Se=b;C.W(a,function(a,b){!(b.mb||b.gf||b.cj)||n.do_not_load_resources&&b.fb||(n.tm+=b.hb)});l.de.push(n);l.Fk++;return n.id};a.mE=function(b){var c=u;if(c&&0!=u.Fk)if(c.Fo)c.Fo=!1;else{var d=performance.now();do{var e=c.de[c.zn],g=b[e.id];if(!w(e))if(0==e.status&&(e.status=1,e.Iu=performance.now(),e.up(0,0)),l(e)){var h=e,k=h.Se.length;do{var n=C.Qa(h.ae,h.Se[0]),r=f(h,n,g);n.Ra==a.he&&(h.ep=!0);n=h.Se.shift();h.Se.push(n);k--}while(!r&&
0!=k)}else h=c,k=e,k.qn(g,k),k.status=3,h.Fk--,p(k);c.vp&&(c.zn=(c.zn+1)%c.de.length);if(e.ep){e.ep=!1;break}}while(16>performance.now()-d)}};a.sq=function(a){var b=u;a.qn(null,a);a.status=3;b.Fk--;p(a);a.status=4;0===a.id&&(b.vp=!0);a.Xs(a.id,!1)};a.qH=r;a.iu=function(a,b){var c=g(a,b);null!==c&&h(c)};a.KD=w;a.is_primary_loaded=function(a){var b=u;if(!b)return!1;a|=0;return b.de[a]&&(3==b.de[a].status||2==b.de[a].status)};a.cleanup=function(){u=null}};b4w.module.__nla=function(a,q){function d(){return{type:"CLIP",G:0,N:0,Le:!1,paused:!1,gg:"",Yi:"",Rb:0,Wi:0,Vi:0,Jr:0,Ir:0,Ci:!1,Vu:!1,scale:1,repeat:1}}function c(a,b){if(a.animation_data){var d=a.animation_data.nla_tracks;if(d)for(var e=0;e<d.length;e++)b.push(d[e])}d=a.nodes;for(e=0;e<d.length;e++){var g=d[e];g.node_group&&(g=g.node_group.node_tree)&&c(g,b)}}function b(a,b){function c(a){return function(c,d,e,g){e=b.Kb[a];if(!(e>=f.length||0>e)&&(e=b.scripts[a][e],"SELECT"==e.type||"SELECT_PLAY"==
e.type&&!e.De)){for(e=0;e<g.Wt;e++)if(B.get_sensor_value(c,d,e)&&e==g.Vt){g.Me=1;return}g.Me=0}}}for(var d=a.b4w_logic_nodes,e=b.scripts,g=0;g<d.length;g++)b.Kb.push(0);for(g=0;g<d.length;g++){e.push([]);for(var f=e[e.length-1],h=d[g],k=0;k<h.length;k++){var l=h[k],n={type:l.type,label:l.label,Fd:l.slot_idx_order,ti:-1,G:-1,N:-1,De:!1,Me:-1,Wt:-1,Vt:-1,ir:"",li:"",mi:"",Ot:"",Rl:-1,Sl:-1,lt:-1,fh:-1,url:"",xt:"",qt:"",mute:l.mute};switch(l.type){case "PLAY":n.G=l.frame_range[0];n.N=l.frame_range[1];
n.De=!1;f.push(n);break;case "SELECT":case "SELECT_PLAY":n.ti=l.slot_idx_jump;var m=D.pf(D.Si,l.object,0),p=D.qA(),r=p.indexOf(m);if(-1==r){G.error("NLA script error: non-selectable object:",l.object[l.object.length-1]);return}n.Me=-1;n.Wt=p.length;n.Vt=r;n.G=l.frame_range[0];n.N=l.frame_range[1];n.De=!1;l=[];for(r=0;r<p.length;r++)l.push(B.create_selection_sensor(p[r],!0));B.create_sensor_manifold(m,"NLA_SELECT_"+k,B.CT_SHOT,l,B.az,c(g),n);f.push(n);break;case "CONDJUMP":n.ir=l.condition;n.li=l.register1;
n.mi=l.register2;n.Rl=l.number1;n.Sl=l.number2;n.ti=l.slot_idx_jump;f.push(n);break;case "REGSTORE":n.Ot=l.registerd;n.lt=l.number1;f.push(n);break;case "MATH":n.qt=l.operation;n.li=l.register1;n.mi=l.register2;n.Rl=l.number1;n.Sl=l.number2;n.fh=l.registerd;f.push(n);break;case "SHOW":case "HIDE":m=D.pf(D.Si,l.object,0);n.obj=m;f.push(n);break;case "REDIRECT":n.url=l.url;f.push(n);break;case "PAGEPARAM":n.xt=l.param_name;n.fh=l.registerd;f.push(n);break;case "ENTRYPOINT":case "NOOP":f.push(n)}}}}
function l(a,b,c,d,e){var g=a.scripts[b];if(g.length)if(a.Kb[b]>=g.length||0>a.Kb[b])a.ja-=L.Pa*d;else{var h=k(a,c,!1,e),g=g[a.Kb[b]];if(g.mute)"ENTRYPOINT"==g.type?a.ja-=L.Pa*d:(a.Kb[b]=g.Fd,l(a,b,c,d,e));else switch(g.type){case "PLAY":g.De?h>=g.N&&(g.De=!1,a.Kb[b]=g.Fd,l(a,b,c,d,e)):(a.ja+=g.G-h,g.De=!0,f(a,b,g));break;case "SELECT":case "SELECT_PLAY":-1<g.Me?"SELECT"==g.type||"SELECT_PLAY"==g.type&&0==g.Me?(a.Kb[b]=g.Me?g.ti:g.Fd,g.Me=-1,l(a,b,c,d,e)):g.De?h>=g.N&&(g.De=!1,a.Kb[b]="SELECT"==g.type?
g.ti:g.Fd,g.Me=-1,l(a,b,c,d,e)):(a.ja+=g.G-h,g.De=!0,f(a,b,g)):a.ja-=L.Pa*d;break;case "JUMP":a.Kb[b]=g.ti;l(a,b,c,d,e);break;case "CONDJUMP":var h=-1==g.li?g.Rl:a.Yd[g.li],n=-1==g.mi?g.Sl:a.Yd[g.mi],m=!1;switch(g.ir){case "EQUAL":h==n&&(m=!0);break;case "NOTEQUAL":h!=n&&(m=!0);break;case "LESS":h<n&&(m=!0);break;case "GREATER":h>n&&(m=!0);break;case "LEQUAL":h<=n&&(m=!0);break;case "GEQUAL":h>=n&&(m=!0)}a.Kb[b]=m?g.ti:g.Fd;l(a,b,c,d,e);break;case "REGSTORE":a.Yd[g.Ot]=g.lt;a.Kb[b]=g.Fd;l(a,b,c,d,
e);break;case "MATH":h=-1==g.li?g.Rl:a.Yd[g.li];n=-1==g.mi?g.Sl:a.Yd[g.mi];switch(g.qt){case "ADD":a.Yd[g.fh]=h+n;break;case "MUL":a.Yd[g.fh]=h*n;break;case "SUB":a.Yd[g.fh]=h-n;break;case "DIV":0==n&&z.ka("Division by zero in NLA script"),a.Yd[g.fh]=h/n}a.Kb[b]=g.Fd;l(a,b,c,d,e);break;case "SHOW":v.show_object(g.obj);a.Kb[b]=g.Fd;l(a,b,c,d,e);break;case "HIDE":v.hide_object(g.obj);a.Kb[b]=g.Fd;l(a,b,c,d,e);break;case "REDIRECT":window.location.href=g.url;for(b=0;b<a.scripts.length;b++)a.scripts[b].length=
0;break;case "PAGEPARAM":a:{h=location.href.toString();if(-1!=h.indexOf("?"))for(h=h.split("?")[1].split("&"),n=0;n<h.length;n++)if(m=h[n].split("="),1<m.length&&m[0]==g.xt){h=Number(m[1]);break a}h=0}a.Yd[g.fh]=h;a.Kb[b]=g.Fd;l(a,b,c,d,e);break;case "NOOP":case "ENTRYPOINT":a.Kb[b]=g.Fd,l(a,b,c,d,e)}}}function f(a,b,c){a=a.scripts[b];for(b=0;b<a.length;b++){var d=a[b];d!=c&&(d.Me=-1)}}function k(a,b,c,d){b=(b-d)*L.Pa+a.ja-a.G;a.cyclic&&c&&(b%=a.N-a.G+1);return b+=a.G}function n(a,b){a=z.clamp(a,
b.G,b.N);var c=a-b.G,d=(b.N-b.G)/b.repeat,c=c/d&&0==c%d?b.Vi:b.Wi+c%d/b.scale;b.Vu&&(c=b.Vi-c+b.Wi);return c}function r(a,b,c){b?t.pause_video(a.name,c):(t.reset_video(a.name,c),t.play_video(a.name,c))}function e(a,b){for(var c=[],e=0;e<a.length;e++){var g=a[e].strips;if(g)for(var f=0;f<g.length;f++){var h=g[f],k=d();k.type=h.type;k.G=h.frame_start;k.N=h.frame_end;k.Rb=b;k.Wi=h.action_frame_start;k.Vi=h.action_frame_end;k.Vu=h.use_reverse;k.scale=h.scale;k.repeat=h.repeat;h.action&&(k.gg=h.action.name,
k.Yi=h.action.uuid);c.push(k)}}return c}function g(a){var b=a.J;return m.Ee(a)&&b.data.animation_data&&b.data.animation_data.nla_tracks.length?!0:!1}function h(a){var b=a.J;if("MESH"!=a.type||!b.data)return!1;a=b.data.materials;if(!a)return!1;for(b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c=c.use_nodes&&d)a:{if(d.animation_data&&(c=d.animation_data.nla_tracks)&&c.length){c=!0;break a}d=d.nodes;for(c=0;c<d.length;c++);c=!1}if(c)return!0}return!1}function p(a,b){var c=v.get_active();c.ta&&(c.ta.ja-=
k(c.ta,b,!0,N)-a,c.ta.Rn=!0)}var w=q("__animation"),C=q("__camera"),B=q("__controls"),H=q("__config"),u=q("__lights");q("__loader");var D=q("__objects"),G=q("__print"),v=q("__scenes"),m=q("__sfx"),t=q("__textures"),z=q("__util"),L=H.me,A=H.q,J=[],N=-1;a.lE=function(a,f,h){f={G:a.frame_start,N:a.frame_end,ja:0,Oj:-1,im:a.frame_end,bp:a.frame_start,Mi:null,lc:h,cyclic:f,Ke:[],S:[],scripts:[],Mj:!1,Rn:!1,jH:a.name,Kb:[],Yd:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}};a.ta=f;b(a,f);for(var k=D.pA(a,h),
l=0;l<k.length;l++){var n=k[l],p=n.J,r=0,v=[];if((h=p.animation_data)&&h.nla_tracks.length){var q=h.nla_tracks;if(z.is_armature(n)||C.is_camera(n)||z.is_mesh(n)||z.El(n)||u.Hl(n)||m.Ee(n))q=e(q,r),q.length&&(v=v.concat(q),r++)}g(n)&&(q=p.data.animation_data.nla_tracks,q=e(q,r),q.length&&(v=v.concat(q),r++));if(w.BA(n)){var t=p.data.materials;for(h=0;h<t.length;h++){var B=t[h].node_tree;if(B&&(q=[],c(B,q),q=e(q,r),q.length)){for(var B=r,H=q,N=w.Yr(),L=[],ka=0,la=0;la<H.length;la++){var ba=H[la];""!=
ba.Yi?ba=z.keysearch("uuid",ba.Yi,N):(ba=ba.gg,ba=z.keysearch("name",ba,N)||z.keysearch("name",ba+"_B4W_BAKED",N));if(ba){var ba=ba.fcurves,ea=[],F;for(F in ba)ea.push(F);L.push(ea)}}for(la=0;la<L.length;la++){N=!1;for(ba=0;ba<la;ba++)if(z.qx(L[la],L[ba])){H[la].Rb=H[ba].Rb;N=!0;break}N||(H[la].Rb=r+ka++)}r=B+ka;v=v.concat(q)}}}for(h=0;h<p.particle_systems.length;h++)q=p.particle_systems[h],t=q.settings,"EMITTER"==t.type&&t.b4w_allow_nla&&(t=d(),t.type="CLIP",t.G=f.G,t.N=f.N+1,t.gg=q.name,t.Rb=r,
t.Wi=t.G,t.Vi=t.N,v.push(t),r++);p=r+1;for(h=0;h<n.Pb.length;h++)q=n.Pb[h],q.Qw&&(r=p,t=d(),t.type="CLIP",t.G=f.G,t.N=f.N+1,t.gg=q.name,t.Rb=r,t.Wi=t.G,t.Vi=t.N,v.push(t));v.length&&(n.Ql=v,f.Ke.push(n))}a=a.k.sk;for(h=0;h<a.length;h++)if(F=a[h].k,F.Ya||F.oi)t=d(),t.type="VIDEO",k=1,A.nd&&(k=F.mc),t.G=Math.min(F.G*k,f.N),t.N=F.mh?f.N:Math.min((F.Oh+F.G+F.ja)*k,f.N),t.gg=a[h].name,F.Lw=t,f.S.push(F);a=f.G;h=f.N;for(F=0;F<f.Ke.length;F++)for(k=f.Ke[F],l=k.Ql,n=0;n<l.length;n++)v=l[n],p=k.name+" ["+
v.G+":"+v.N+"]",v.G=Math.max(a,v.G),v.N=Math.min(h+1,v.N),v.G>v.N?(G.warn("NLA: out of scene range: "+p),l.splice(n,1),n--):v.gg||"CLIP"!=v.type||(G.warn('NLA: no action in strip for object "'+k.name+'".'),l.splice(n,1),n--);for(a=0;a<f.Ke.length;a++)for(h=f.Ke[a].Ql,F=0;F<h.length;F++){k=h[F];l=f.G;n=f.N+1;for(v=0;v<h.length;v++)p=h[v],k.Rb==p.Rb&&(p.N<=k.G&&(l=k.G),p.G>=k.N&&(n=Math.min(n,p.G)));k.Jr=l;k.Ir=n}J.push(f)};a.start=function(){N=0};a.update=function(a,b){if(!(0>N)){0==N&&(N=a);for(var c=
0;c<J.length;c++){var d=J[c];if(d.Mj&&(d.ja-=L.Pa*b,!d.Rn))continue;d.Rn=!1;for(var e=0;e<d.scripts.length;e++)l(d,e,a,b,N);var g=k(d,a,!0,N);if(g>=d.im)if(d.cyclic)d.Mi&&d.Mi(),p(d.bp,a),g=k(d,a,!0,N);else{d.Mj=!0;d.ja-=g-d.im;d.Mi&&d.Mi();continue}for(var f=0;f<d.Ke.length;f++){for(var h=d.Ke[f],v=h.Ql,e=0;e<v.length;e++){var q=v[e];"SOUND"==q.type&&g<d.Oj-1E-6&&(q.Le=!1)}for(e=0;e<v.length;e++)switch(q=v[e],q.type){case "CLIP":if(q.Jr<=g&&g<q.Ir&&!q.Le){var t=h,u=q;""!=u.Yi?w.jx(t,u.Yi,u.Rb):w.apply(t,
u.gg,u.Rb);w.set_behavior(t,w.AB_FINISH_STOP,u.Rb);var G=n(u.G,u);w.set_frame(t,G,u.Rb);for(t=0;t<v.length;t++)v[t]!=q&&v[t].Rb==q.Rb&&(v[t].Le=!1);q.Le=!0}q.Le&&(t=h,u=n(g,q),G=w.get_current_frame_float(t,q.Rb),1E-6<Math.abs(u-G)&&w.set_frame(t,u,q.Rb));break;case "SOUND":(g<d.Oj-1E-6||d.Oj<q.G)&&q.G<=g&&g<q.N&&!q.Le&&(m.play(h,(q.G-g)/L.Pa,(q.N-q.G)/L.Pa),q.Le=!0),d.Oj<q.N&&q.N<=g&&q.Le&&(q.Le=!1)}}for(f=0;f<d.S.length;f++)q=d.S[f].Lw,q.G<=Math.round(g)&&Math.round(g)<q.N&&!q.Ci&&(r(d.S[f],q.Ci,
d.lc),q.Ci=!0),q.N<=Math.round(g)&&q.Ci&&(r(d.S[f],q.Ci,d.lc),q.Ci=!1);d.Oj=g}}};a.cleanup=function(){J.length=0;N=-1};a.ys=function(a){var b=a.J.animation_data;return b&&b.nla_tracks.length||g(a)||h(a)?!0:!1};a.set_frame=p;a.get_frame=function(a){var b=v.get_active();return b.ta?k(b.ta,a,!0,N):-1};a.AD=function(){var a=v.get_active();a.ta&&(a.ta.Mj=!0)};a.dC=function(a){var b=v.get_active();b.ta&&(b.ta.Mj=!1,b.ta.Mi=a?a:null)};a.get_frame_start=function(){var a=v.get_active();return a.ta?a.ta.G:
-1};a.get_frame_end=function(){var a=v.get_active();return a.ta?a.ta.N:-1};a.is_play=function(){var a=v.get_active();return a.ta?!a.ta.Mj:!1};a.check_nla=function(){var a=v.get_active();return a.ta?a.b4w_use_nla:!1};a.check_logic_nodes=function(){var a=v.get_active();return a.ta?0<a.b4w_logic_nodes.length:!1};a.set_range=function(a,b){var c=v.get_active();if(c.ta)c.ta.bp=a,c.ta.im=b;else return!1};a.reset_range=function(){var a=v.get_active();if(a.ta)a=a.ta,a.bp=a.G,a.im=a.N;else return!1};a.set_cyclic=
function(a){var b=v.get_active();if(b.ta)b.ta.cyclic=a;else return!1};a.clear_callback=function(){var a=v.get_active();a.ta&&(a.ta.Mi=null)}};b4w.module.__camera=function(a,q){function d(b){b=b.f;switch(b.Ca){case a.MS_TARGET_CONTROLS:b.Vh=V.dist(b.i,b.Vb);b.Wh=b.L[0].top;break;case a.MS_HOVER_CONTROLS:b.jb&&(b.Vh=V.dist(b.i,b.ec),b.Wh=b.L[0].top)}}function c(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),gb:new Float32Array([0,0,0,0]),eb:new Float32Array([0,0,0,0])}}function b(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;
case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function l(b){var d={type:b,name:"",Pf:1,width:0,height:0,Ae:null,pb:null,dd:null,Ea:0,Jc:0,gb:0,eb:0,left:0,right:0,top:0,bottom:0,of:new Float32Array(3),Mr:new Float32Array(3),quat:new Float32Array(4),za:new Float32Array(16),HF:new Float32Array(16),Aa:new Float32Array(16),Oi:new Float32Array(16),kC:new Float32Array(16),Zd:new Float32Array(16),du:new Float32Array(16),Gd:new Float32Array(16),
dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,we:null,dof_on:0,Bj:c(),lk:0,be:0,gc:null,kj:null,wn:null,tr:new Float32Array(4),bm:new Float32Array(4)};if(b==a.Bb)return d;switch(b){case a.Qb:r(d,40,.1,1E3);break;case a.$c:r(d,2.5,.1,1E3);break;case a.ie:break;case a.$e:break;case a.dg:break;case a.Cb:case a.Hb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return d}function f(b,c,d){if(b.type!=a.Cb&&b.type!=a.Hb)throw"set_stereo_params(): wrong camera type";
b.lk=c;b.be=d;m(b,b.Ea);if(W.ia()&&(c=W.get_active(),b=c.k.Zb))for(c=W.Fj(c).f.L,d=0;d<c.length;d++)N(c[d],b)}function k(a,b){return n(a.f.quat,b)}function n(a,b){var c=Q.quat_to_dir(a,Q.AXIS_Y,ba),d=Q.quat_to_dir(a,Q.AXIS_Z,ea),e=-Math.asin(c[1]/V.length(c)),c=Math.abs(e)>Math.PI/4?V.scale(d,-Q.sign(e),F):V.scale(c,-Q.sign(d[1]),F),g=Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(e=Q.sign(e)*Math.PI-e);d=g;0>c[2]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=e;return b}function r(b,c,d,e,g){switch(b.type){case a.Qb:case a.Cb:case a.Hb:b.Jc=
c;b.Ea=1;break;case a.$c:b.top=c;b.Ea=1;break;case a.ie:delete b.Jc;b.Jc=c;b.Ea=g/c;break;case a.$e:b.top=c;b.Ea=g/c;break;default:fa.error("set_frustum(): Unsupported camera type: "+b.type)}b.gb=d;b.eb=e}function e(b,c){var d=c.f.i,e=c.f.quat,g=ha;U.rotateX(c.f.Z,-Math.PI/2,g);U.invert(g,b.za);if(b.gc){var g=b.gc[0],f=b.gc[1],h=b.gc[2],k=b.gc[3],l=ha;l[0]=1-2*g*g;l[1]=-2*g*f;l[2]=-2*g*h;l[3]=0;l[4]=-2*g*f;l[5]=1-2*f*f;l[6]=-2*f*h;l[7]=0;l[8]=-2*g*h;l[9]=-2*f*h;l[10]=1-2*h*h;l[11]=0;l[12]=-2*g*k;
l[13]=-2*f*k;l[14]=-2*h*k;l[15]=1;U.multiply(b.za,l,b.za);m(b,b.Ea,!0);g=P;f=ha;U.invert(b.za,f);U.transpose(f,f);oa.transformMat4(b.gc,f,g);f=ua;f[0]=(Q.sign(g[0])+b.Aa[8])/b.Aa[0];f[1]=(Q.sign(g[1])+b.Aa[9])/b.Aa[5];f[2]=-1;f[3]=(1+b.Aa[10])/b.Aa[14];oa.scale(g,2/(g[0]*f[0]+g[1]*f[1]+g[2]*f[2]+g[3]*f[3]),g);b.Aa[2]=g[0];b.Aa[6]=g[1];b.Aa[10]=g[2]+1;b.Aa[14]=g[3]}b.type==a.Cb?b.za[12]+=b.be/2:b.type==a.Hb&&(b.za[12]-=b.be/2);U.multiply(b.Aa,b.za,b.Gd);z(b);t(b);V.copy(b.of,b.Mr);V.copy(d,b.of);R.copy(e,
b.quat)}function g(b,c,d,e){U.lookAt(c,d,e,b.za);b.type==a.Cb?b.za[12]+=b.be/2:b.type==a.Hb&&(b.za[12]-=b.be/2);U.multiply(b.Aa,b.za,b.Gd);z(b);t(b);V.copy(c,b.of)}function h(a){var b=a.f.L;if(!b)throw"Wrong object";for(var c=a.f,d=0;d<b.length;d++){var g=b[d];e(g,a);Q.pl(g.Gd,g.Bj);if(g.we)if(g.dof_on){var f=c.i,h=aa.get_translation(g.we,ba),f=V.dist(f,h);g.dof_distance=f}else g.dof_distance=0}}function p(b){b=b.f;if(b.Ca==a.MS_TARGET_CONTROLS){var c=Q.quat_to_dir(b.quat,Q.AXIS_Z,ba);b.Ep=0<c[1]}}
function w(b,c){var d=b.f,e=d.dc;!e||d.Ca!=a.MS_EYE_CONTROLS&&d.Ca!=a.MS_TARGET_CONTROLS||(c&&(d=k(b,ka),e.left+=d[0],e.right+=d[0]),e.left=Q.angle_wrap_0_2pi(e.left),e.right=Q.angle_wrap_0_2pi(e.right))}function C(b,c){var d=b.f,e=d.jc;!e||d.Ca!=a.MS_EYE_CONTROLS&&d.Ca!=a.MS_TARGET_CONTROLS||(c&&(d=k(b,ka),e.ib+=d[1],e.Va+=d[1]),e.ib=Q.angle_wrap_periodic(e.ib,-Math.PI,Math.PI),e.Va=Q.angle_wrap_periodic(e.Va,-Math.PI,Math.PI))}function B(b){var c=b.f;if(A(b)&&c.L[0].type===a.$c){if(c.Ca===a.MS_TARGET_CONTROLS)var d=
V.dist(c.i,c.Vb),c=d/c.Vh*c.Wh;else c.jb&&c.Ca===a.MS_HOVER_CONTROLS?(d=V.distance(c.i,c.ec),c=d/c.Vh*c.Wh):c=b.f.L[0].top;for(var e in b.f.L)d=b.f.L[e],d.top=c,m(d,d.Ea);h(b)}}function H(a,b,c,d,e){var g=a.f,f=b,h=c;if(d||e)a=k(a,la),d&&(f=b-a[0]),e&&(h=c-a[1]);if(f||h)b=R.identity(I),f&&(f=R.setAxisAngle(Q.AXIS_Y,f,da),R.multiply(b,f,b)),h&&(f=Q.quat_to_dir(g.quat,Q.AXIS_X,ba),h=R.setAxisAngle(f,h,da),R.normalize(h,h),R.multiply(b,h,b)),R.multiply(b,g.quat,g.quat)}function u(a,b,c,d,e){var g=a.f,
f=b,h=c;if(d||e){var l=k(a,la);d&&(f=b-l[0]);e&&(h=c-l[1])}G(a,a.f.Vb,f,h);a=k(a,la);a=Q.angle_wrap_periodic(a[1],-Math.PI,Math.PI);g.Ep=Math.abs(a)>Math.PI/2}function D(a,b,c,d,e){var g=a.f,f=b,h=c;if(d||e){var l=k(a,la);d&&(f=b-l[0]);e&&(h=c-l[1])}g.Hn||(f=0);G(a,g.ec,f,h);h&&v(a)}function G(a,b,c,d){var e=a.f;if(c||d){var g=R.identity(I);c&&(c=R.setAxisAngle(Q.AXIS_Y,c,da),R.multiply(g,c,g));a=J(a);d&&(!a||a&&e.jb)&&(a=Q.quat_to_dir(e.quat,Q.AXIS_X,ba),d=R.setAxisAngle(a,d,da),R.normalize(d,d),
R.multiply(g,d,g));Q.BC(e.i,b,g,e.i);R.multiply(g,e.quat,e.quat)}}function v(a){var b=a.f;if(b.jb){var c=k(a,ka)[1];a=a.f;a.Gb.Va-a.Gb.ib?(c=(a.Gb.Va-c)/(a.Gb.Va-a.Gb.ib),c=Math.max(c,0)):c=0;c=c*(a.ug-a.ve)+a.ve;a=Q.quat_to_dir(b.quat,Q.AXIS_MY,ba);V.normalize(a,a);V.scale(a,c,a);V.subtract(b.ec,a,b.i)}}function m(b,c,d){switch(b.type){case a.Qb:if(!c)throw"No aspect ratio";b.Ea=c;case a.ie:U.perspective(Q.gm(b.Jc),b.Ea,b.gb,b.eb,b.Aa);break;case a.$c:if(!c)throw"No aspect ratio";b.Ea=c;case a.$e:c=
b.top*b.Ea;U.ortho(-c,c,-b.top,b.top,b.gb,b.eb,b.Aa);break;case a.dg:U.ortho(b.left,b.right,b.bottom,b.top,b.gb,b.eb,b.Aa);break;case a.Cb:case a.Hb:if(!c)throw"No aspect ratio";b.Ea=c;var e=Math.tan(b.Jc*Math.PI/360);c=b.gb*e;var g=b.Ea*b.lk*e;b.type==a.Cb?(e=g-b.be/2,g+=b.be/2):(e=g+b.be/2,g-=b.be/2);e=-(b.gb/b.lk*e);g*=b.gb/b.lk;U.frustum(e,g,-c,c,b.gb,b.eb,b.Aa);b.left=e;b.right=g;break;case a.Bb:return;default:throw"Wrong camera type: "+b.type;}d||(U.multiply(b.Aa,b.za,b.Gd),z(b),t(b))}function t(a){U.copy(a.za,
a.Zd);a.Zd[12]=0;a.Zd[13]=0;a.Zd[14]=0;a.Zd[15]=1;U.multiply(a.Aa,a.Zd,a.Zd);U.invert(a.Zd,a.Zd)}function z(a){U.copy(a.za,a.Oi);U.multiply(a.Aa,a.Oi,a.Oi);U.invert(a.Oi,a.Oi)}function L(b,c,d,e,g){e||(e=new Float32Array(24));c||(c=b.gb);d||(d=b.eb);var f,h,k,l,n,m,p,r;switch(b.type){case a.Bb:throw"Extraction from NONE camera is not possible";case a.Qb:case a.ie:f=c*Math.tan(b.Jc*Math.PI/360);l=-f;h=f*b.Ea;k=-h;n=d/c*f;r=-n;m=n*b.Ea;p=-m;break;case a.$c:case a.$e:k=b.top*b.Ea;f=n=b.top;h=m=k;l=r=
-b.top;k=p=-k;break;case a.dg:f=n=b.top;h=m=b.right;l=r=b.bottom;k=p=b.left;break;case a.Cb:case a.Hb:n=c/b.gb;f=c*Math.tan(b.Jc*Math.PI/360);l=-f;h=b.right*n;k=b.left*n;p=d/c;n=f*p;r=-n;m=h*p;p*=k;break;default:throw"Wrong camera type: "+b.type;}e[0]=k;e[1]=l;e[2]=-c;e[3]=h;e[4]=l;e[5]=-c;e[6]=h;e[7]=f;e[8]=-c;e[9]=k;e[10]=f;e[11]=-c;e[12]=p;e[13]=r;e[14]=-d;e[15]=p;e[16]=n;e[17]=-d;e[18]=m;e[19]=n;e[20]=-d;e[21]=m;e[22]=r;e[23]=-d;g&&(c=ha,U.invert(b.za,c),Q.Hf(e,c,e,0));return e}function A(a){return"CAMERA"===
a.type}function J(b){return A(b)&&b.f&&b.f.Ca==a.MS_HOVER_CONTROLS?!0:!1}function N(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.kj){var d=b.csm_num;a.kj=Array(d);for(var e=0;e<d;e++)a.kj[e]=new Float32Array(3);a.wn=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.gb:M(b,a,d-1),g=M(b,a,d),e=L(a,e,g,ga),e=K.jA(e);a.kj[d].set(e.F);a.wn[d]=e.La;a.tr[d]=V.length(e.F);a.bm[d]=y(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.bm[0]=b.first_cascade_blur_radius}function M(a,b,c){var d=
a.csm_num,e=Q.clamp(a.csm_first_cascade_border,b.gb,b.eb);a=Q.clamp(a.csm_last_cascade_border,b.gb,b.eb);return Q.clamp(y(e,a,d,c),b.gb,b.eb)}function y(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var K=q("__boundings");q("__config");var x=q("__constraints"),S=q("__container"),T=q("__mat3"),U=q("__mat4"),fa=q("__print"),R=q("__quat"),W=q("__scenes"),aa=q("__transform"),Q=q("__util"),V=q("__vec3"),oa=q("__vec4");a.Bb=10;a.Qb=20;a.$c=30;a.ie=
40;a.$e=50;a.dg=60;a.Cb=70;a.Hb=80;a.MS_STATIC=0;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var ca=Math.PI/180/2,ka=new Float32Array(2),la=new Float32Array(2),ba=new Float32Array(3),ea=new Float32Array(3),F=new Float32Array(3),I=new Float32Array(4),da=new Float32Array(4),P=new Float32Array(4),ua=new Float32Array(4),ma=new Float32Array(16),ha=new Float32Array(16),ga=new Float32Array(24);a.Mx=function(c,e){var g=e.f,f=c.data;switch(f.type){case "PERSP":var h=l(a.Qb);if(f.angle_y)var n=
f.angle_y/Math.PI*180;r(h,n,f.clip_start,f.clip_end);break;case "ORTHO":h=l(a.$c),r(h,f.ortho_scale/2,f.clip_start,f.clip_end)}h.name=e.name;g.Lu=!1;g.Ca=b(f.b4w_move_style);g.dof_distance=c.data.dof_distance;n=c.data.dof_object;g.we=n?n.Db:null;g.dof_front=c.data.b4w_dof_front;g.dof_rear=c.data.b4w_dof_rear;g.dof_power=c.data.b4w_dof_power;g.Hn=c.data.b4w_enable_hover_hor_rotation;g.L=[h];g.Wp=c.data.b4w_trans_velocity;g.Vp=c.data.b4w_rot_velocity;g.Xp=c.data.b4w_zoom_velocity;g.Ca==a.MS_TARGET_CONTROLS&&
(g.Vb.set(f.b4w_target),p(e));var m=e.J,f=e.f,n=f.Ca;if(n===a.MS_TARGET_CONTROLS||n===a.MS_EYE_CONTROLS||n===a.MS_HOVER_CONTROLS){var m=m.data,x=null,F=null,q=null;n===a.MS_TARGET_CONTROLS||n===a.MS_EYE_CONTROLS?(m.b4w_use_panning&&(f.Uu=m.b4w_use_panning),m.b4w_use_horizontal_clamping&&(x={left:m.b4w_rotation_left_limit,right:m.b4w_rotation_right_limit}),m.b4w_use_vertical_clamping&&(F={Va:m.b4w_rotation_down_limit,ib:m.b4w_rotation_up_limit}),n===a.MS_TARGET_CONTROLS&&(f.jb=m.b4w_use_distance_limits&&
m.b4w_distance_min<=m.b4w_distance_max,f.jb&&(f.ve=m.b4w_distance_min,f.ug=m.b4w_distance_max))):n===a.MS_HOVER_CONTROLS&&(m.b4w_use_horizontal_clamping&&m.b4w_horizontal_translation_min<=m.b4w_horizontal_translation_max&&(x={left:m.b4w_horizontal_translation_min,right:m.b4w_horizontal_translation_max}),m.b4w_use_vertical_clamping&&m.b4w_vertical_translation_min<=m.b4w_vertical_translation_max&&(F={Va:m.b4w_vertical_translation_min,ib:m.b4w_vertical_translation_max}),f.jb=m.b4w_use_distance_limits&&
m.b4w_hover_angle_min<=m.b4w_hover_angle_max&&m.b4w_distance_min<=m.b4w_distance_max,f.jb&&(q={Va:m.b4w_hover_angle_min,ib:m.b4w_hover_angle_max},f.ve=m.b4w_distance_min,f.ug=m.b4w_distance_max));var y=x;y&&n==a.MS_EYE_CONTROLS&&(y.left*=-1,y.right*=-1);if(y=F)switch(n){case a.MS_TARGET_CONTROLS:y.Va*=-1;y.ib*=-1;break;case a.MS_HOVER_CONTROLS:var t=-y.Va;y.Va=-y.ib;y.ib=t}(y=q)&&n==a.MS_HOVER_CONTROLS&&(y.Va*=-1,y.ib*=-1);f.dc=x;f.jc=F;f.Gb=q;w(e,"LOCAL"==m.b4w_horizontal_clamping_type);C(e,"LOCAL"==
m.b4w_vertical_clamping_type)}if(g.Ca===a.MS_HOVER_CONTROLS)if(g=e.f,g.jb){n=e.J;f=e.f;m=Q.quat_to_dir(f.quat,Q.AXIS_MY,ba);x=P;x.set(Q.AXIS_Y);x[3]=0;n=Q.line_plane_intersect(x,-n.data.b4w_hover_zero_level,f.i,m,f.ec);m=k(e,ka)[1];if(!n||Math.abs(m)<ca)fa.warn("Active hover camera view vector and the supporting plane are parallel to each other. Set hover pivot based on the camera position."),f.ec[0]=f.i[0],f.ec[1]=0,f.ec[2]=f.i[2];f=k(e,ka);g=Q.ff(f[1],g.Gb.ib,g.Gb.Va);0<f[1]&&fa.warn("Active hover camera has wrong orientation");
g?D(e,0,g):v(e)}else g.Hn=!1;h.type==a.$c&&d(e)};a.IA=d;a.wy=c;a.ub=l;a.IF=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.pb);case "DEPTH":return Boolean(a.dd);case "SCREEN":return!Boolean(a.pb)&&!Boolean(a.dd);default:throw"Wrong attachment type: "+b;}};a.nm=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.pb=c;break;case "DEPTH":a.dd=c;break;case "SCREEN":a.pb=null;a.dd=null;break;default:throw"Wrong attachment type: "+b;}};a.tG=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.pb;
case "DEPTH":return a.dd;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.Zs=function(b,c){if(b.type!=a.Qb||c!=a.Cb&&c!=a.Hb)throw"make_stereo(): wrong camera type";b.type=c;f(b,6,.065)};a.XC=f;a.get_camera_angles=k;a.as=n;a.get_camera_angles_char=function(a,b){k(a,b);b[0]=Q.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.get_angles=function(a,b){var c=a.f,d=Q.quat_to_dir(c.quat,Q.AXIS_MY,ba),e=Math.asin(d[1]/V.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=
0>=e?Q.quat_to_dir(c.quat,Q.AXIS_MZ,ea):Q.quat_to_dir(c.quat,Q.AXIS_Z,ea)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b};a.om=r;a.NC=function(b,c,d,e,g,f,h){switch(b.type){case a.dg:b.left=c;b.right=d;b.bottom=e;b.top=g;b.gb=f;b.eb=h;break;default:fa.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.f.Ca};a.$C=e;a.kH=g;a.au=function(a,b,c){var d=ba;d[0]=0;d[1]=-1;d[2]=0;V.transformQuat(d,
c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=ea;e[0]=0;e[1]=0;e[2]=-1;V.transformQuat(e,c,e);g(a,b,d,e)};a.wz=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];U.lookAt(a,b,c,ha);U.invert(ha,ha);U.rotateX(ha,Math.PI/2,ha);T.fromMat4(ha,ma);R.fromMat3(ma,e)};a.bE=h;a.aE=function(b){var c=b.f,d=b.f;if(d.Ca===a.MS_TARGET_CONTROLS||d.Ca===a.MS_EYE_CONTROLS){if(d.dc){var e=d.dc.left,g=d.dc.right,f=k(b,ka);(f=d.Ca==a.MS_TARGET_CONTROLS?Q.ff(f[0],e,g):Q.ff(f[0],g,e))&&(d.Ca==a.MS_TARGET_CONTROLS?u(b,f,0):
H(b,f,0))}d.jc&&(e=d.jc.Va,g=d.jc.ib,f=k(b,ka),(f=d.Ca==a.MS_TARGET_CONTROLS?Q.ff(f[1],g,e):Q.ff(f[1],e,g))&&(d.Ca==a.MS_TARGET_CONTROLS?u(b,0,f):H(b,0,f)));d.Ca===a.MS_TARGET_CONTROLS&&d.jb&&(f=b.f,e=V.subtract(f.i,f.Vb,ba),g=V.length(e),g>f.ug?(V.scale(e,f.ug/g,e),V.add(f.Vb,e,f.i)):g<f.ve&&(g=Q.quat_to_dir(f.quat,Q.AXIS_MY,ea),V.scale(g,100*f.ve,g),V.add(e,g,e),V.scale(e,-f.ve/V.length(e),e),V.add(f.Vb,e,f.i)))}d.Ca===a.MS_HOVER_CONTROLS&&(d=b.f,f=d.jb?d.ec:d.i,d.dc&&(e=Q.clamp(f[0],d.dc.left,
d.dc.right)-f[0],f[0]+=e,d.jb&&(d.i[0]+=e)),d.jc&&(e=Q.clamp(f[2],d.jc.Va,d.jc.ib)-f[2],f[2]+=e,d.jb&&(d.i[2]+=e)),d=b.f,d.jb&&d.Gb&&(f=k(b,ka)[1],f=Q.ff(f,d.Gb.ib,d.Gb.Va),Q.quat_to_dir(d.quat,Q.AXIS_MY,ba),f&&D(b,0,f)));B(b);switch(c.Ca){case a.MS_TARGET_CONTROLS:x.CC(c.i,c.quat,c.Vb);x.correct_up(b,Q.AXIS_Y);break;case a.MS_EYE_CONTROLS:b.qb||x.correct_up(b,Q.AXIS_Y)}p(b)};a.Op=p;a.fC=w;a.jC=C;a.kE=B;a.rotate_eye_camera=H;a.rotate_target_camera=u;a.rotate_hover_camera=D;a.HA=v;a.QG=function(b){switch(b.type){case a.Qb:case a.$c:case a.Cb:case a.Hb:return!0;
default:return!1}};a.Vz=function(b){b=b.f.L[0];switch(b.type){case a.Qb:case a.ie:case a.Cb:case a.Hb:return Math.PI*b.Jc/180;default:return fa.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.Kf=m;a.hn=t;a.Tq=z;a.uz=L;a.sx=function(a){a=a.f;var b=K.pd();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Ib=b;var c=K.el(1,[0,0,0]);a.bd=c;a.Vm=K.nr(1,b);a.Xm=K.pr(1,b);a.Wm=K.or(1,b)};a.is_camera=A;a.is_target_camera=function(b){return A(b)&&b.f&&b.f.Ca==a.MS_TARGET_CONTROLS?
!0:!1};a.is_eye_camera=function(b){return A(b)&&b.f&&b.f.Ca==a.MS_EYE_CONTROLS?!0:!1};a.is_hover_camera=J;a.Np=N;a.Ty=M;a.project_point=function(b,c,d){b=b.f.L[0];switch(b.type){case a.Qb:case a.ie:case a.$c:case a.$e:case a.Cb:case a.Hb:var e=P;e.set(c);e[3]=1;oa.transformMat4(e,b.Gd,e);c=-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;S.OE(d[0],d[1],d,b);2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+1)/2);return d;default:return fa.error("Non-compatible camera"),d}};a.hA=function(a){return a.f.L[0]};
a.ul=function(b,c){switch(b.type){case a.Qb:case a.ie:case a.Cb:case a.Hb:var d=Math.tan(Q.gm(b.Jc)/2);switch(c){case "LEFT":return-d*b.Ea;case "RIGHT":return d*b.Ea;case "TOP":return d;case "BOTTOM":return-d}break;case a.$c:case a.$e:switch(c){case "LEFT":return-b.top*b.Ea;case "RIGHT":return b.top*b.Ea;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.dg:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;default:Q.ka("Unknown camera type")}};
a.VA=function(b){switch(b.type){case a.$c:case a.$e:case a.dg:return!0;default:return!1}};a.get_fov=function(b,c){switch(b.type){case a.Qb:case a.ie:case a.Cb:case a.Hb:var d=Q.gm(b.Jc);return c?d*b.Ea:d;default:return 0}}};b4w.module.__lights=function(a,q){function d(a){b.scale(a.color,a.Ih,a.$k)}q("__print");var c=q("__util"),b=q("__vec3"),l=new Float32Array(3);a.ZA=function(a,k){var n=a.data,r=k.Ka={name:"",type:n.type,Bt:new Float32Array(3),direction:new Float32Array(3),color:new Float32Array(3),$k:new Float32Array(3),Ar:0,Qe:0,jk:0,Xr:!1,dt:!1,Fr:!1,Ki:!0,oh:!0,Ih:1,distance:25,gG:"INVERSE_SQUARE"};r.name=k.name;r.Ki=n.use_diffuse;r.oh=n.use_specular;var e=c.quat_to_dir(k.f.quat,c.AXIS_Y,l);b.normalize(e,e);r.direction.set(e);
r.color[0]=n.color[0];r.color[1]=n.color[1];r.color[2]=n.color[2];r.Ih=r.Ar=n.energy;d(r);r.distance=n.distance;if("POINT"===r.type||"SPOT"===r.type)r.distance=n.distance;"SPOT"===r.type?(r.jk=n.spot_blend,r.Qe=n.spot_size):"POINT"===r.type&&(r.Qe=Math.PI/2);r.Xr=n.b4w_generate_shadows;r.Fr=n.b4w_dynamic_intensity};a.QC=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];d(a)};a.SC=function(a,b){a.jk=b};a.RC=function(a,b){a.distance=b};a.TC=function(a,b){a.Qe=b};a.Yt=function(a,b){a.Ih=
b;d(a)};a.Hl=function(a){return"LAMP"===a.type};a.gE=function(a){if("LAMP"!=a.type)throw"Wrong light object";var d=a.Ka;if(d){c.quat_to_dir(a.f.quat,c.AXIS_Y,d.direction);b.normalize(d.direction,d.direction);if("SUN"==d.type){a=Math.acos(b.dot(d.Bt,c.mq));var l=Math.acos(b.dot(d.direction,c.mq));d.dt=Math.floor(a/.025)!=Math.floor(l/.025)?!0:!1}b.copy(d.direction,d.Bt)}}};b4w.module.__scenes=function(a,q){function d(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c.Id||!c.Id.length)return c}return null}function c(){if(!pb)throw"No active scene available";return pb}function b(a,b){for(var c=0;c<b.length;c++)b[c].k&&b[c].k.Xh&&a.k.sk.push(b[c])}function l(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&l(e.objects,b,c)}}function f(a,b,c){if(!xa.pj||!k(a,b,c))return null;a=a.b4w_shadow_settings;c={};a.csm_resolution>xa.Ub?
(c.csm_resolution=xa.Ub,Qa.error("Shadow map texture has unsupported size. Changed to "+xa.Ub+".")):c.csm_resolution=a.csm_resolution;c.self_shadow_polygon_offset=a.self_shadow_polygon_offset;c.self_shadow_normal_offset=a.self_shadow_normal_offset;c.enable_csm=a.b4w_enable_csm;if(b=ra.Zn(b)||b[0])c.Jg=b.Ka.type,c.Qe=b.Ka.Qe,c.distance=b.Ka.distance,"SPOT"!=c.Jg&&"POINT"!=c.Jg||!c.enable_csm||(Qa.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),c.enable_csm=!1);c.enable_csm?
(c.csm_num=a.csm_num,c.csm_first_cascade_border=a.csm_first_cascade_border,c.first_cascade_blur_radius=a.first_cascade_blur_radius,c.csm_last_cascade_border=a.csm_last_cascade_border,c.last_cascade_blur_radius=a.last_cascade_blur_radius,c.fade_last_cascade=a.fade_last_cascade,c.blend_between_cascades=a.blend_between_cascades):(c.csm_num=1,c.csm_first_cascade_border=a.csm_first_cascade_border,c.first_cascade_blur_radius=a.first_cascade_blur_radius,c.csm_last_cascade_border=a.csm_last_cascade_border,
c.last_cascade_blur_radius=a.last_cascade_blur_radius,c.fade_last_cascade=!1,c.blend_between_cascades=!1);return c}function k(a,b,c){if(xa.gk)switch(a.b4w_render_shadows){case "OFF":return!1;case "ON":return!0}else return!1;var d=!1,e=!1;a=xa.Re&&a.b4w_enable_ssao;if(0==b.length&&!a)return!1;for(b=0;b<c.length;b++){var g=c[b].J;g.b4w_shadow_cast&&(d=!0);g.b4w_shadow_receive&&(e=!0);if((a||d)&&e)return!0}return!1}function n(a){for(var b=0;b<a.length;b++)if("SUN"==a[b].Ka.type)return!0;return!1}function r(a){if(!xa.shore_smoothing)return!1;
a=la(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}function e(a){for(var b=0;b<a.length;b++)for(var c=a[b].J.particle_systems,d=0;d<c.length;d++){var e=c[d].settings;if(e.b4w_enable_soft_particles&&0<e.b4w_particles_softness)return!0}return!1}function g(a){for(var b=la(a),c=[],d=0;d<b.length;d++){var e=b[d];if(e.b4w_water){for(var g={},f=0;f<a.length;f++)for(var h=a[f].J,l=h.data.materials,k=0;k<l.length;k++)l[k]==e&&(g.$f=h.location[1]);g.bc=
e.b4w_water_fog_color.slice(0);g.bc.push(e.b4w_water_fog_density);e.b4w_water_dynamic?(g.tj=!0,g.waves_height=e.b4w_waves_height,g.waves_length=e.b4w_waves_length,g.dst_noise_scale0=e.b4w_water_dst_noise_scale0,g.dst_noise_scale1=e.b4w_water_dst_noise_scale1,g.dst_noise_freq0=e.b4w_water_dst_noise_freq0,g.dst_noise_freq1=e.b4w_water_dst_noise_freq1,g.dir_min_shore_fac=e.b4w_water_dir_min_shore_fac,g.dir_freq=e.b4w_water_dir_freq,g.dir_noise_scale=e.b4w_water_dir_noise_scale,g.dir_noise_freq=e.b4w_water_dir_noise_freq,
g.dir_min_noise_fac=e.b4w_water_dir_min_noise_fac,g.dst_min_fac=e.b4w_water_dst_min_fac,g.waves_hor_fac=e.b4w_water_waves_hor_fac):(g.tj=!1,g.waves_height=0,g.waves_length=0);g.qe=e.b4w_water_enable_caust;g.Ox=e.b4w_water_caust_scale;g.Nx=e.b4w_water_caust_brightness;g.Px=new Float32Array([.3,.7]);g.qm=null;e=e.texture_slots;for(f=0;f<e.length;f++)h=e[f].texture,!0===h.b4w_shore_dist_map&&(g.qm=h.image,g.ri=h.image.size[0],g.gD=h.b4w_shore_boundings,g.bi=h.b4w_max_shore_dist);c.push(g)}}if(0<c.length){g=
c[0];if(!g.tj)for(d=0;d<c.length;d++)c[d].tj&&(g=c[d]);return g}return null}function h(a){function b(a){if(a){a=a.nodes;for(var d=0;d<a.length;d++){var e=a[d];"GROUP"==e.type&&e.node_group&&b(e.node_group.node_tree);"GROUP"==e.type&&"B4W_REFRACTION"==e.node_tree_name&&(c.tc=!0)}}}var c={tc:!1};a=la(a);for(var d=0;d<a.length;d++){var e=a[d];e.b4w_refractive&&(c.tc=!0);e.node_tree&&b(e.node_tree)}return c}function p(a,b){if(xa.jm)switch(a.b4w_render_reflections){case "OFF":return!1}else return!1;for(var c=
[],d=0,e=0;e<b.length;e++){var g=b[e];g.f.sc&&"CUBE"==g.f.Xd&&d++;if(g.dk.length){for(var f=null,h=0;h<c.length;h++)if(c[h]==g){f=h;break}null==f&&c.push(g)}}return{Mt:c,mt:d,jf:[],Gf:[]}}function w(a,b){var c=a.b4w_sky_settings,d={};d.tC=c.render_sky;d.procedural_skydome=c.procedural_skydome&&b;d.use_as_environment_lighting=c.use_as_environment_lighting;d.si=c.color;d.rayleigh_brightness=c.rayleigh_brightness;d.mie_brightness=c.mie_brightness;d.spot_brightness=c.spot_brightness;d.scatter_strength=
c.scatter_strength;d.rayleigh_strength=c.rayleigh_strength;d.mie_strength=c.mie_strength;d.rayleigh_collection_power=c.rayleigh_collection_power;d.mie_collection_power=c.mie_collection_power;d.mie_distribution=c.mie_distribution;d.hc=c.reflexible;d.Wb=c.reflexible_only;!b&&c.procedural_skydome&&Qa.warn("There is no sun on the scene. Procedural sky won't be rendered");return d}function C(a){var b={};a=a.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.FA=a.hemisphere;b.Fx=a.blur_depth;b.Nq=
a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;b.FC=a.samples;return b}function B(a){if(!(xa.Qk&&a.b4w_enable_bloom&&a.k.lh))return null;var b={};a=a.b4w_bloom_settings;b.blur=a.blur;b.jz=a.edge_lum;b.key=a.key;return b}function H(a){var b={};a=a.b4w_motion_blur_settings;b.mb_decay_threshold=a.motion_blur_decay_threshold;b.mb_factor=a.motion_blur_factor;return b}function u(a){var b={};a=a.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=
a.exposure;b.saturation=a.saturation;return b}function D(a){var b={};a=a.b4w_god_rays_settings;b.qo=a.intensity;b.ai=a.max_ray_length;b.Bi=a.steps_per_pass;return b}function G(a){var b={};b.Ef=a.b4w_outline_color;b.Uj=a.b4w_outline_factor;return b}function v(a){var b={};a=a.b4w_glow_settings;b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b}function m(a,
b){var c=a.light_settings,d={};d.nf=c.environment_energy;d.Sp=c.use_environment_light;d.In=c.environment_color;d.tf=a.horizon_color.slice(0);d.cg=a.zenith_color.slice(0);d.HE=a.use_sky_paper;d.GE=a.use_sky_blend;d.IE=a.use_sky_real;d.mu=null;d.op=null;d.Jn=null;if(d.Sp&&"SKY_TEXTURE"==d.In&&(!b.procedural_skydome||!b.use_as_environment_lighting)){for(var c=null,e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_environment_lighting){c=a.texture_slots[e];break}c?d.Jn=c:(Qa.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),
d.Sp=!1)}for(e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_skydome){c=a.texture_slots[e];d.mu=c;d.op={Cx:c.blend_factor,GA:c.horizon_factor,XE:c.zenith_up_factor,WE:c.zenith_down_factor,color:c.color,Ia:c.default_value,invert:c.invert,FE:c.use_rgb_to_intensity,Dx:c.blend_type,BE:c.use_map_blend,CE:c.use_map_horizon,EE:c.use_map_zenith_up,DE:c.use_map_zenith_down};break}return d}function t(a){var b=a.fog_settings,c={};c.xE=b.use_fog;c.qo=b.intensity;c.depth=b.depth;c.start=
b.start;c.height=b.height;c.xz=b.falloff;c.color=b.use_custom_color?b.color.slice(0):a.horizon_color.slice(0);a=c.color;c.bc=new Float32Array([a[0],a[1],a[2],1/c.depth]);c.sl=new Float32Array([c.qo,c.depth,c.start,c.height]);return c}function z(a){if(!xa.Eb)return!1;for(var b=!1,c=!1,d=0;d<a.length;d++){for(var e=a[d].J,g=e.data.materials,f=0;f<g.length;f++)g[f].b4w_terrain&&(b=!0);e=e.particle_systems;for(f=0;f<e.length;f++)g=e[f].settings,"HAIR"==g.type&&g.b4w_dynamic_grass&&(c=!0);if(b&&c)return!0}return!1}
function L(a,b){if(Ec.outlining_overview_mode)return!0;if(xa.enable_selectable)switch(a.b4w_enable_object_selection){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c].f.jh)return!0;return!1}else return!1}function A(a,b){if(Ec.outlining_overview_mode)return!0;if(xa.enable_outlining)switch(a.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c].f.Mb)return!0;return!1}else return!1}function J(a,b){if(xa.rf)switch(a.b4w_enable_glow_materials){case "OFF":return!1;
case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)for(var d=b[c].J.data.materials,e=0;e<d.length;e++)if(Ub.$q(d[e]))return!0;return!1}else return!1}function N(a,b){if(xa.tc)switch(a.b4w_render_refractions){case "OFF":return!1;case "ON":return!0;case "AUTO":return b.tc}else return!1}function M(a){for(var b=0;b<a.length;b++)for(var c=a[b].J.data.materials,d=0;d<c.length;d++){var e=c[d],g=e.game_settings.alpha_blend;if(e.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g)return!0}return!1}function y(a,
b){switch(a.b4w_enable_anchors_visibility){case "OFF":return!1;case "ON":return!0}for(var c=0;c<b.length;c++){var d=b[c];if(d.anchor&&d.anchor.Fh)return!0}return!1}function K(a,b,c){var d=pa.Wg(a,b);pa.Ue(a,d,function(a,b,d){if(d.$a){switch(d.X){case "COLOR":case "CUBEMAP":a=b.j.pb;break;case "DEPTH":a=b.j.dd;break;case "SCREEN":a=null;break;case "MAIN_CUBE_REFLECT":return;default:throw"Wrong slink";}switch(d.ya){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "u_cube_reflection":case "u_plane_reflection":break;
default:if(!a)throw"Connection of SCREEN is forbidden";if(a.Yf)throw"Batch texture can't use renderbuffer";na.br(c.ic,d.ya)&&E.zh(c,a,d.ya)}}});for(a=0;a<b.sa.length;a++){var d=b.sa[a],e=b.ce[a];switch(d.ya){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(e.Yf)throw"Batch texture can't use renderbuffer";na.br(c.ic,d.ya)&&E.zh(c,e,d.ya)}}}function x(a,b){return{cb:!0,Fn:[!0,!0,!0,!0,!0,!0],zd:a,D:b}}function S(a,b,c,d,e,g){for(var f=b.f,h=ra.Ja(b,
e).T,l=0;l<h.length;l++){var k=h[l];k.vc||k.Wb||"MAIN"!=k.type&&"NODES_GLOW"!=k.type&&"PARTICLES"!=k.type||!("OPAQUE"==k.Sa&&"OPAQUE"==d||"BLEND"==k.Sa&&"BLEND"==d||"XRAY"==k.Sa&&"XRAY"==d||"NODES_GLOW"==k.type&&"GLOW"==d)||(g||(T(k,a,b,c,d,e),E.sb(k),U(k)),a.o.push(x(f,k)),K(c,a,k),fa(k))}a.o.sort(function(a,b){var c;if(a.D&&b.D){c=a.D.Ha;var d=b.D.Ha;(c=c==d?0:c>d?1:-1)||(c=a.D.Yg,d=b.D.Yg,c=c==d?0:c>d?1:-1)}else c=0;return c})}function T(a,b,c,d,e,g){var f=c.f,h=ra.Ja(c,g),l="NO_SHADOWS";if((c=
ja.Wa(d,"SHADOW_CAST"))&&a.wc){switch(e){case "OPAQUE":l="SHADOW_MAPPING_OPAQUE";break;case "BLEND":case "XRAY":l="SHADOW_MAPPING_BLEND";break;case "COLOR_ID":case "REFLECT":case "GLOW":l="NO_SHADOWS";break;case "DEPTH":l="SHADOW_MASK_GENERATION";break;default:throw"Wrong subscene type";}E.Bq(a,g.k.Zb,c)}c=a.Xa;na.I(c,"SHADOW_USAGE",l);a.Eb&&(l=ja.Wa(d,"GRASS_MAP"))&&R(a,l,f);if("DEPTH"!=a.type&&"COLOR_ID"!=e||a.Th)if(e=b.Bf,na.I(c,"NUM_LIGHTS",e),na.I(c,"NUM_LFACTORS",0==e%2?e/2:Math.floor(e/2)+
1),"special_skydome.glslf"==na.es(c)&&na.I(c,"REFLECTION_PASS",0),na.I(c,"SSAO_ONLY",0),b.ob&&b.Hd?na.I(c,"WATER_EFFECTS",1):na.I(c,"WATER_EFFECTS",0),b.ob&&b.qe&&f.qe?(na.I(c,"CAUSTICS",1),na.I(c,"CAUST_SCALE",na.r(b.Vq)),na.I(c,"CAUST_SPEED",na.r(b.Wq,2)),na.I(c,"CAUST_BRIGHT",na.r(b.Uq))):na.I(c,"CAUSTICS",0),b.ob&&(na.I(c,"WAVES_HEIGHT",na.r(b.ag)),na.I(c,"WAVES_LENGTH",na.r(b.uh)),na.I(c,"WATER_LEVEL",na.r(b.$f))),f=h.jf,h=h.Gf,-1!==a.Ob.indexOf("u_mirrormap")?na.I(c,"REFLECTION_TYPE","REFL_MIRRORMAP"):
a.sc&&f?(f=f.j.pb,E.zh(a,f,"u_cube_reflection"),na.I(c,"REFLECTION_TYPE","REFL_CUBE")):a.sc&&h?(f=h.j.pb,E.zh(a,f,"u_plane_reflection"),na.I(c,"REFLECTION_TYPE","REFL_PLANE")):na.I(c,"REFLECTION_TYPE","REFL_NONE"),(h=ja.Wa(d,"SKY"))?a.Et?(f=h.j.pb,E.zh(a,f,"u_sky")):xa.em?(a.Ec=h.Ec,na.I(c,"PROCEDURAL_FOG",1)):na.I(c,"PROCEDURAL_FOG",0):na.I(c,"PROCEDURAL_FOG",0),f=g.k.cq,f.Sp&&(na.I(c,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==f.In?(f=f.Jn?E.Zz(f.Jn,!1):h.j.pb,na.I(c,"SKY_TEXTURE",1),E.zh(a,f,"u_sky_texture")):
"SKY_COLOR"==f.In&&na.I(c,"SKY_COLOR",1)),f=g.k.lv,f.xE&&(na.I(c,"USE_FOG",1),na.I(c,"FOG_TYPE",f.xz)),a.dp?(xa.pj&&na.I(c,"USE_REFRACTION_CORRECTION",1),"MAIN"==a.type&&a.Th||"NODES_GLOW"==a.type?(na.I(c,"REFRACTIVE",1),g.k.tc?na.I(c,"USE_REFRACTION",1):na.I(c,"USE_REFRACTION",0)):g.k.tc?na.I(c,"REFRACTIVE",1):na.I(c,"REFRACTIVE",0)):(na.I(c,"REFRACTIVE",0),na.I(c,"USE_REFRACTION",0),na.I(c,"USE_REFRACTION_CORRECTION",0)),a.Zf&&(xa.shore_smoothing&&a.Dm&&ja.Wa(d,"DEPTH")?na.I(c,"SHORE_SMOOTHING",
1):na.I(c,"SHORE_SMOOTHING",0),a.water_dynamic&&b.ob&&b.ag?na.I(c,"DYNAMIC",1):na.I(c,"DYNAMIC",0)),"PARTICLES"==a.type&&(na.I(c,"SIZE_RAMP_LENGTH",a.ra.gu),na.I(c,"COLOR_RAMP_LENGTH",a.ra.hr)),!a.zg)for(a=a.S,b=0;b<a.length;b++)if(f=a[b],"SCENE"==f.source)for(d=0;d<Sa.length;d++)for(c=Sa[d],h=Sa[d].Id,e=0;e<h.length;e++)h[e].k==f&&pa.n(fc,c,g,null)}function U(a){var b=a.ic.attributes,c=a.R.Nb,d;for(d in b)c[d]||ya.ka('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES_GLOW"==a.type)if(b=
na.vA(a.ic.Zp),10<b&&("MAIN"==a.type&&Qa.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.Kc.join(", ")+'"'),"MAIN"==a.type&&a.Th||"NODES_GLOW"==a.type))d=c=0,a.ph&&(c=ya.Td(a.ph)),a.Ab&&(d=ya.Td(a.Ab)),Qa.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.Kc.join(", ")+'"')}function fa(a){8<a.S.length&&Qa.warn(a.type,"too many textures used - "+a.S.length+' (max 8), materials "'+a.Kc.join(", ")+'"')}function R(a,b,c){a.nc=b.nc;var d=b.nc[0],
e=b.nc[1],g=b.nc[2];c=c.Ib;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);g=0==g?c:Math.max(g,c);b.nc[2]=g;b=b.j;ta.om(b,g/2,-e,-d,g/2);ta.Kf(b);d=a.co||0;d=0==d?c:Math.max(d,c);a.co=d}function W(a){var b=F(a,"MAIN_OPAQUE"),c=!0,d=a.k.Zb;pa.W(a.k.nb,function(a,e){"SHADOW_CAST"===e.type&&(Q(e,b.j,e.o,d,c),c=!1)})}function aa(a){pa.W(a.k.nb,function(a,b){"OUTLINE"===b.type&&(b.Gn=1)})}function Q(a,b,c,d,e){if(0!=c.length){var g=a.j;ob.copy(b.of,g.of);La.copy(b.za,g.du);if("SUN"===d.Jg||"HEMI"===d.Jg){var f=
Va;ia.pd(f);for(var h=0;h<c.length;h++){var l=c[h].zd;0==h?ia.cl(l.lb,f):ia.Hr(f,l.lb)}c=ia.tz(f,fb);ya.Hf(c,g.za,c);if(d.enable_csm){d=ob.copy(b.kj[a.vn],Xb);f=La.invert(b.za,zc);ya.Hf(d,f,d);ya.Hf(d,g.za,d);a=b.wn[a.vn];if(e)for(ib=0,Nb=-Infinity,e=2;e<c.length;e+=3)ib=Math.min(ib,c[e]),Nb=Math.max(Nb,c[e]);e=Va;e.max_x=d[0]+a;e.max_y=d[1]+a;e.max_z=Nb;e.min_x=d[0]-a;e.min_y=d[1]-a;e.min_z=ib}else{a=e=Va;b=Ta;b.set(c);c=Kc/9;d=La.identity(zc);La.rotate(d,c,ya.AXIS_MZ,d);h=f=-1;for(l=0;10>l;l++){var k=
ia.zx(b,gb),n=(k.max_x-k.min_x)*(k.max_y-k.min_y);if(-1==f||n<f)f=n,h=l,ia.cl(k,a);ya.Hf(b,d,b)}c*=h;0<c&&(a=La.identity(zc),La.rotate(a,c,ya.AXIS_MZ,a),La.multiply(a,g.za,g.za));c=e.max_x-e.min_x;a=e.max_y-e.min_y;c&&a&&(b=Math.abs(c-a)/2,2<c/a?(e.max_y+=b,e.min_y-=b):2<a/c&&(e.max_x+=b,e.min_x-=b));e.max_x+=.005;e.max_y+=.005;e.max_z+=.005;e.min_x-=.005;e.min_y-=.005;e.min_z-=.005}ta.NC(g,e.min_x,e.max_x,e.min_y,e.max_y,-e.max_z,-e.min_z);ta.Kf(g);ya.pl(g.Gd,g.Bj)}else"SPOT"!==d.Jg&&"POINT"!==d.Jg||
ta.Kf(g,g.Ea)}}function V(a,b,c,d,e){for(var g=b.f,f=ra.Ja(b,d).T,h=0;h<f.length;h++){var l=f[h];"COLOR_ID"==l.type&&(e||(T(l,a,b,c,"COLOR_ID",d),E.sb(l),U(l)),"COLOR_PICKING"==a.type&&"COLOR_ID"==l.Sa||"COLOR_PICKING_XRAY"==a.type&&"COLOR_ID_XRAY"==l.Sa)&&(e||(E.xa(l,"USE_OUTLINE",0),E.sb(l),U(l)),a.o.push(x(g,l)))}}function oa(a,b,c,d,e){d||(e.Eb&&(d=ja.Wa(c,"GRASS_MAP"))&&R(e,d,b),E.sb(e),U(e));a.o.push(x(b,e));K(c,a,e);fa(e)}function ca(a,b){for(var c=ea(b,Vb),d=a.Ka,e=a.f,g=ra.Ja(a,b),f=g.Pj,
h=0;h<c.length;h++){var l=c[h];l.wf.set(e.i,3*f);l.Mg.set(d.direction,3*f);l.Lg.set(d.$k,3*f);switch(d.type){case "SUN":l.Du.set(e.quat);l.Cu=d.$k;"SKY"===l.type?(l.Ol=d.dt,ob.copy(d.direction,l.zp),ka(b,l)):ob.copy(d.direction,l.zp);break;case "HEMI":case "POINT":case "SPOT":break;default:Qa.error("Unknown light type: "+d.type+'".')}var k=Lb;k[0]=d.Ki?1:0;k[1]=d.oh?1:0;l.Ng.set(k,2*f);l.wa=!0;for(k=0;k<l.o.length;k++){var n=l.o[k].D;n.Kg&&E.PC(n,a)}}c=F(b,"MAIN_OPAQUE").j;g=g.eu;d=b.k.Zb;for(h=0;h<
g.length;h++)l=g[h],ta.au(l.j,e.i,e.quat),Q(l,c,l.o,d,!0)}function ka(a,b){vb.sj(b);if(b.Ol)for(var c=ea(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_GLOW"]),d=0;d<c.length;d++)for(var e=c[d].o,g=0;g<e.length;g++){var f=e[g];f.cb&&(f=f.D,E.Sx(f)&&vb.YD(f))}}function la(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].J.data,e=0;e<d.materials.length;e++){var g=d.materials[e];-1==b.indexOf(g)&&b.push(g)}return b}function ba(a,b,c){for(var d=a.k,e=a.eg.f.L,g=0;g<e.length;g++){var f=e[g];ta.Kf(f,
b/c);d.Zb&&ta.Np(f,d.Zb)}d.Zb&&(d.Pl=!0,F(a,"DEPTH").wa=!0,F(a,"MAIN_BLEND").wa=!0);var h=d.nb;ja.PD(h,function(d,e,g){if(d.Ji){var f=d.Pf*b,l=d.Pf*c;if(e)for(e=0;e<g.sa.length;e++)g.sa[e]==d&&ec.resize(d.Ba,f,l);else switch(ec.Nj(d.Ba)&&ec.resize(d.Ba,f,l),d=g.j,d.width=f,d.height=l,g.type){case "DOF":I(a,{dof_power:g.j.dof_power,dof_on:g.j.dof_on});break;case "GLOW_COMBINE":P(a,{small_glow_mask_width:g.small_glow_mask_width,large_glow_mask_width:g.large_glow_mask_width});break;case "BLOOM":da(a,
{bloom_blur:g.bloom_blur});break;case "OUTLINE":g=ja.Oa(h,g,"POSTPROCESSING");f=ja.Oa(h,g,"POSTPROCESSING");l=ja.Oa(h,f,"POSTPROCESSING");d=ja.Oa(h,l,"POSTPROCESSING");ja.Rc(g,1/b,1/c);ja.Rc(f,1/b,1/c);ja.Rc(l,1/b,1/c);ja.Rc(d,1/b,1/c);break;default:ja.Rc(g,1/b,1/c)}}})}function ea(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];pa.W(a.k.nb,function(a,b){b.type==e&&c.push(b)})}return c}function F(a,b){return ja.Wa(a.k.nb,b)}function I(a,b){var c=F(a,"DOF");if(!c)return Qa.error("DOF is not enabled on the scene. Check camera settings"),
0;var d=a.k.nb;"boolean"==typeof b.dof_on&&(c.j.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.j.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.j.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.j.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.j.dof_power=b.dof_power;var e=ja.Oa(d,c,"POSTPROCESSING"),d=ja.Oa(d,e,"POSTPROCESSING");ja.Yb(e,c.j.dof_power);ja.Rc(e,1/c.j.width,1/c.j.height);ja.Yb(d,c.j.dof_power);ja.Rc(d,1/c.j.width,1/c.j.height)}c.wa=!0}
function da(a,b){var c=F(a,"LUMINANCE_TRUNCED"),d=F(a,"BLOOM");if(!c||!d)return Qa.error("Bloom is not enabled on the scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.wa=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.wa=!0);if("number"==typeof b.bloom_blur){var e=a.k.nb,c=ja.Oa(e,d,"BLOOM_BLUR"),e=ja.Oa(e,c,"BLOOM_BLUR");d.bloom_blur=b.bloom_blur;ja.Yb(c,b.bloom_blur);ja.Rc(c,1/d.j.width,1/d.j.height);ja.Yb(e,b.bloom_blur);ja.Rc(e,1/d.j.width,1/d.j.height)}}
function P(a,b){var c=F(a,"GLOW_COMBINE");if(!c)return Qa.error("Glow is not enabled on the scene"),null;for(var d=a.k.nb,e=ja.kA(d,c),g=0;g<e.length;++g){var f=e[g];if("POSTPROCESSING"===f.type&&"GLOW_MASK_LARGE"===f.Sa)var h=f;if("POSTPROCESSING"===f.type&&"GLOW_MASK_SMALL"===f.Sa)var l=f}e=ja.Oa(d,h,"POSTPROCESSING");d=ja.Oa(d,l,"POSTPROCESSING");"number"==typeof b.small_glow_mask_coeff&&(c.small_glow_mask_coeff=b.small_glow_mask_coeff,c.wa=!0);"number"==typeof b.large_glow_mask_coeff&&(c.large_glow_mask_coeff=
b.large_glow_mask_coeff,c.wa=!0);"number"==typeof b.small_glow_mask_width&&(c.small_glow_mask_width=b.small_glow_mask_width,ja.Yb(l,b.small_glow_mask_width),ja.Rc(l,1/c.j.width,1/c.j.height),l.wa=!0,ja.Yb(d,b.small_glow_mask_width),ja.Rc(d,1/c.j.width,1/c.j.height),d.wa=!0);"number"==typeof b.large_glow_mask_width&&(c.large_glow_mask_width=b.large_glow_mask_width,ja.Yb(h,b.large_glow_mask_width),ja.Rc(h,1/c.j.width,1/c.j.height),h.wa=!0,ja.Yb(e,b.large_glow_mask_width),ja.Rc(e,1/c.j.width,1/c.j.height),
e.wa=!0)}function ua(a,b){var c=F(pb,"MAIN_OPAQUE");if(!c||!c.ob)return Qa.error("get_water_surface_level() - no water parameters on the scene"),0;var d=c.ag,e=c.uh,g=c.$f,f=c.ob;if(!d||!f.tj)return f.$f;var h=ob.length(c.Ve),l=c.time;h&&(l*=h);var k=Lb;k[0]=20/e*(a-.25*l);k[1]=20/e*(b-.25*l);h=ya.Xq(k);k[0]=17/e*(b+.1*l);k[1]=17/e*(a+.1*l);var k=ya.Xq(k),h=h+k-1,n=f.dst_noise_scale0,k=f.dst_noise_scale1,E=f.dst_noise_freq0,m=f.dst_noise_freq1,p=Lb;p[0]=n*(a+E*l);p[1]=n*(b+E*l);n=ya.pp(p);p[0]=k*
(b-m*l);p[1]=k*(a-m*l);k=ya.pp(p);k*=d*n;if(c.Am)if(m=(a-c.Mf[0])/c.Nf[0],p=(c.Mf[1]+b)/c.Nf[1],m+=.5,p+=.5,1<m||0>m||1<p||0>p)d=k;else var m=ya.Zr(pb.k.lp,c.ri,m,p),n=f.dir_freq,O=f.dir_noise_scale,r=f.dir_noise_freq,E=f.dir_min_noise_fac,p=f.dst_min_fac,c=e/c.bi/Math.PI,O=[O/e*(a+r*l),O/e*(b+r*l)],e=Math.sqrt(m),d=d*Math.max(m,f.dir_min_shore_fac)*Math.sin(e/c+n*l)*Math.max(ya.pp(O),E),f=Math.max(e,p),d=d*(1-f)+k*f,h=h*m;else d=k;return g+(d+.05*h)}function ma(a,b){a.Lj&&"POSTPROCESSING"==a.type&&
b.cb!=a.cb&&(a.cb=b.cb);b.cb||"OUTLINE"!=a.type||(a.Gn=0)}function ha(a,b,c,d){var e=pa.Qa(a,b);ta.nm(e.j,c,d);e.Tm=!0;pa.Tf(a,b,function(b,e,g){g.$a&&g.X==c&&ja.by(g)&&ga(a,b,g.ya,d)});pa.Ue(a,b,function(b,e,g){g.$a&&g.X==c&&g.X==g.ya&&ha(a,b,c,d)})}function ga(a,b,c,d){a=pa.Qa(a,b).o;for(b=0;b<a.length;b++)E.xC(a[b].D,d,c)}function Y(a){var b=F(a,"GRASS_MAP");if(b){var c=b.j,d=a.eg.f,e=d.i;a=Xb;a[0]=0;a[1]=-b.nc[2]/2;a[2]=0;ob.transformQuat(a,d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=lb;b[0]=0;b[1]=
0;b[2]=0;b[3]=1;ta.au(c,a,b)}}function qa(a,b){pa.W(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.sa[0]||!d.ce[0])throw"Wrong MOTION_BLUR subscene";var e=d.sa[0],g=d.ce[0];d.ce[0]=d.j.pb;pa.Tf(a,c,function(b,c,d){d.$a&&ga(a,b,d.ya,g)});ha(a,c,e.X,g);ga(a,c,e.ya,d.ce[0]);d.ct=Math.exp(-b/d.mb_factor)}})}function O(a){return a.k.Ve}var E=q("__batch"),ia=q("__boundings"),ta=q("__camera"),Z=q("__config"),Gb=q("__container");q("__constraints");var kb=q("__debug"),Aa=q("__geometry"),pa=q("__graph"),yc=
q("__hud"),La=q("__mat4"),Ub=q("__nodemat"),ra=q("__obj_util"),ub=q("__physics"),Ea=q("__prerender"),Wb=q("__primitives"),Qa=q("__print"),vb=q("__renderer"),ja=q("__scenegraph"),wb=q("__sfx"),na=q("__shaders"),ec=q("__textures"),ya=q("__util"),ob=q("__vec3"),ab=Z.me,xa=Z.q,Ec=Z.Mb,qc=Z.ni,Hb="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH OUTLINE_MASK WIREFRAME".split(" ");a.oF=Hb;var Vb="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),
Nc="MAIN_OPAQUE SSAO MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Jc="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS OUTLINE_MASK WIREFRAME".split(" "),Rc="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Ic=0,Ob=null,pb=null,Sa=[],fc=null,Kc=Math.PI/2,Lb=new Float32Array(2),Xb=new Float32Array(3),lb=new Float32Array(4),zc=new Float32Array(16),
fb=new Float32Array(24),Ta=new Float32Array(24),Va=ia.pd(),gb=ia.pd(),ib=0,Nb=-Infinity;a.UF=function(){return{}};a.set_active=function(a){pb=a;wb.LC(a)};a.iC=function(a,b){var c=a.k,d=ja.Gy(c.nb);if(a==b){ba(a,Gb.xA(),Gb.wA());for(var e=0;e<d.length;e++)a.k.eh.push(d[e])}else for(e=a.Id[0],ba(a,e.k.kh,e.k.kh),e=0;e<d.length;e++)b.k.eh.push(d[e]);d=ea(a,Jc);for(e=0;e<d.length;e++)d[e].Ve.set(c.Ve);for(e=0;e<c.eh.length;e++)"SHADOW_CAST"==c.eh[e].type&&vb.sj(c.eh[e])};a.Dg=function(){Ob||(Ob=d(Sa));
return Ob};a.ql=d;a.get_active=c;a.ia=function(){return pb?!0:!1};a.Fj=function(a){return a.eg};a.Qh=function(){return Sa};a.nA=function(){if(1==Sa.length)return Sa;for(var a=0;a<Sa.length;a++){var b=Sa[a].k.nb;pa.W(b,function(b,c){for(var d=0;d<c.o.length;d++){for(var e=c.o[d].D.S,g=null,f=0;f<e.length;f++)if("SCENE"==e[f].source&&e[f].qp==Sa[a].name&&"COPY"!=c.type){Qa.error('Texture-scene loop detected. A scene is rendered to texture "'+e[f].name+'" yet this texture belongs to the same scene.');
pa.Wg(fc,Sa[a]);g=c.o[d].D;break}g&&(g.S=[],g.Ob=[],E.XD(g,null),E.sb(g))}})}for(var c=[],a=0;a<Sa.length;a++)if(b=Sa[a],!b.Id.length){b=pa.Wg(fc,b);pa.nz(fc,b);b=pa.xp(fc,b,pa.Fm);b=pa.Jp(b);pa.W(b,function(a,b){c.push(b)});break}return c};a.Zw=function(a,c,d,l,k,E){a.Id=a.Id||[];a.ta=null;var O=a.k,x=a.eg.f;O.sk=[];b(a,c);c=a.world;O.$A=l.length;O.lh=n(l);O.sm=w(c,O.lh);O.cq=m(c,O.sm);O.lv=t(c);O.Rw=y(a,E);x.L[0].type!=ta.Qb&&xa.anaglyph_use?(Qa.warn("Anaglyph stereo is disabled for the non-perspective camera"),
E=!1):E=xa.anaglyph_use;O.anaglyph_use=E;O.ki=p(a,d);O.Ex=B(a);O.HB=H(a);O.Qx=u(a);O.zA=D(a);O.SB=G(a);O.sf=v(a);O.Hh=xa.Hh&&(0<x.dof_distance||x.we);O.Vg=xa.Vg&&a.b4w_enable_motion_blur;O.Dh=xa.Dh&&a.b4w_enable_color_correction;O.antialiasing=xa.antialiasing&&a.b4w_enable_antialiasing;O.Re=xa.Re&&a.b4w_enable_ssao;O.Rh=xa.Rh&&a.b4w_enable_god_rays&&O.lh;O.ez=xa.pj;O.bo=a.world.b4w_render_glow_over_blend;O.yD=C(a);E=h(k);O.DB=E;O.tc=N(a,E);O.Zb=f(a,l,k);O.ob=g(k);O.Xe=M(k);O.jD=e(k);O.shore_smoothing=
r(k);O.Eb=z(k);O.iy=L(a,k);O.outline=A(a,k);O.rf=J(a,k);switch(a.b4w_reflection_quality){case "LOW":O.rg=qc.ur;O.$j=qc.yt;break;case "MEDIUM":O.rg=qc.Vy;O.$j=qc.bC;break;case "HIGH":O.rg=qc.Uy;O.$j=qc.aC;break;default:O.rg=qc.ur,O.$j=qc.yt}l=a.Id.sort(function(a,b){return b.k.kh-a.k.kh});O.nb=ja.Fy(O,x,l);O.eh=[];O.Pl=!1;O.Mo=!1;O.No=!1;O.Ve=new Float32Array(3);Sa.push(a);fc||(fc=pa.create());pa.u(fc,a);for(O=0;O<d.length;O++)ra.jp(d[O],!0,a)};a.$w=b;a.jy=function(a){var b="ALL",c=[];l(a.objects,
b,c);return c};a.fs=function(a){return a.k.nb};a.Iz=function(a){pa.W(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=E.sr(c.dm);break;case "SSAO":d=E.My(c);break;case "SSAO_BLUR":d=E.Ny(c);break;case "DEPTH_PACK":d=E.uy();break;case "REFRACT":case "COPY":d=E.sr("NONE");break;case "GOD_RAYS":ja.Oa(a,c,"WIREFRAME")||ja.Oa(a,c,"MAIN_BLEND")||ja.Oa(a,c,"GOD_RAYS");d=E.yy(c.ut,c.Zf,c.Bi);break;case "GOD_RAYS_COMBINE":ja.Oa(a,c,"WIREFRAME")||ja.Oa(a,c,"MAIN_BLEND");ja.Oa(a,c,"GOD_RAYS");
d=E.zy();break;case "MOTION_BLUR":d=E.Cy();break;case "DOF":var d=E.vy(),e=ja.Oa(a,c,"POSTPROCESSING"),g=ja.Oa(a,e,"POSTPROCESSING");ja.Yb(e,c.j.dof_power);ja.Yb(g,c.j.dof_power);break;case "OUTLINE":var d=E.Dy(),e=ja.Oa(a,c,"POSTPROCESSING"),g=ja.Oa(a,e,"POSTPROCESSING"),f=ja.Oa(a,g,"POSTPROCESSING"),h=ja.Oa(a,f,"POSTPROCESSING");ja.Yb(g,c.an);ja.Yb(e,c.an);ja.Yb(h,c.Mn*c.Uj);ja.Yb(f,c.Mn*c.Uj);break;case "GLOW_COMBINE":d=E.xy();break;case "COMPOSITING":d=E.sy();break;case "ANTIALIASING":d=E.oy();
break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=E.Ky(c.type);break;case "ANAGLYPH":d=E.my();break;case "SKY":d=E.Ey();break;case "LUMINANCE":d=E.Ay();break;case "AVERAGE_LUMINANCE":d=E.py();break;case "LUMINANCE_TRUNCED":d=E.By();break;case "BLOOM_BLUR":d=E.qy();break;case "BLOOM":d=ja.Oa(a,c,"BLOOM_BLUR");e=ja.Oa(a,d,"BLOOM_BLUR");ja.Yb(d,c.bloom_blur);ja.Yb(e,c.bloom_blur);d=E.ry();break;case "VELOCITY":d=E.Qy();break;
case "ANCHOR_VISIBILITY":d=E.ny()}d&&(e=x(ra.Eh("NONE"),d),U(d),c.o.push(e),K(a,c,d),fa(d))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":var d=a.k.nb,e=b.f;!ja.Wa(d,"SHADOW_CAST")&&e.wc&&(e.wc=!1);e=ea(a,Hb);c&&(ub.K(b)&&ub.append_object(b,a),b.Nc&&b.parent&&b.parent.J.dupli_group.objects&&(b.Ro=b.name,b.parent.J.dupli_group.objects.push(b.J)));for(var g=0;g<e.length;g++){var f=e[g],h=b,l=d,k=a,n=c;switch(f.type){case "MAIN_OPAQUE":S(f,h,l,"OPAQUE",k,n);break;case "MAIN_BLEND":S(f,
h,l,"BLEND",k,n);break;case "MAIN_XRAY":S(f,h,l,"XRAY",k,n);break;case "MAIN_GLOW":S(f,h,l,"GLOW",k,n);break;case "MAIN_PLANE_REFLECT":case "MAIN_CUBE_REFLECT":for(var m=h.f,p=ra.Ja(h,k).T,O=0;O<p.length;O++){var r=p[O];if(("MAIN"==r.type||"PARTICLES"==r.type)&&"REFLECT"==r.Sa){if("MAIN_PLANE_REFLECT"==f.type){var F;a:{F=k.k.ki.Gf;for(var w=0;w<F.length;w++)if(F[w]==f){F=w;break a}F=null}if(F==m.Oc)continue}else{a:{if(k.k.ki)for(F=k.k.ki.jf,w=0;w<F.length;w++)if(F[w]==f){F=w;break a}F=null}if(F==
m.cd)continue}n||(T(r,f,h,l,"REFLECT",k),F=r.Xa,na.I(F,"DISABLE_FOG",0),na.I(F,"WATER_EFFECTS",0),"special_skydome.glslf"==na.es(F)&&na.I(F,"REFLECTION_PASS",1),na.I(F,"TEXTURE_NORM",0),E.sb(r),U(r));f.o.push(x(m,r))}}break;case "DEPTH":m=ra.Ja(h,k).T;for(p=0;p<m.length;p++)O=m[p],"DEPTH"!=O.type||O.vc||"DEPTH"!=O.Sa&&"NODES"!=O.Sa||(n||(T(O,f,h,l,"DEPTH",k),E.sb(O),U(O)),f.o.push(x(h.f,O)),K(l,f,O),fa(O));break;case "SHADOW_CAST":m=!1;p=h.f;h=ra.Ja(h,k).T;O=ja.Wa(l,"GRASS_MAP");for(r=0;r<h.length;r++)F=
h[r],"DEPTH"==F.type&&"SHADOW_CAST"==F.Sa&&(m=!0,n||(na.I(F.Xa,"SHADOW_USAGE","SHADOW_CASTING"),F.Eb&&O&&R(F,O,p),E.xa(F,"SHADOW_TEX_RES",na.r(k.k.Zb.csm_resolution)),E.sb(F),U(F)),f.o.push(x(p,F)));m&&(h=k.k.Zb,k=ja.Wa(l,"MAIN_OPAQUE"),Q(f,k.j,f.o,h,!0));break;case "COLOR_PICKING":V(f,h,l,k,n);break;case "COLOR_PICKING_XRAY":V(f,h,l,k,n);break;case "OUTLINE_MASK":l=h.f;h=ra.Ja(h,k).T;for(k=0;k<h.length;k++)m=h[k],"COLOR_ID"==m.type&&"OUTLINE"==m.Sa&&(n||(E.xa(m,"USE_OUTLINE",1),E.sb(m),U(m)),f.o.push(x(l,
m)));break;case "GRASS_MAP":l=h.f;h=ra.Ja(h,k).T;for(k=0;k<h.length;k++)m=h[k],"GRASS_MAP"==m.type&&(n||(E.sb(m),U(m)),f.o.push(x(l,m)),m=f.j,F=l.lb,p=f.nc[0],O=f.nc[1],r=f.nc[2],0==p&&0==O?(p=F.min_y,O=F.max_y):(p=Math.min(p,F.min_y),O=Math.max(O,F.max_y)),F=1E-4*(O-p),f.nc[0]=p-F,f.nc[1]=O+F,ta.om(m,r/2,-O,-p,r/2),ta.Kf(m));break;case "WIREFRAME":for(m=h.f,h=ra.Ja(h,k).T,k=0;k<h.length;k++)p=h[k],"WIREFRAME"==p.type&&oa(f,m,l,n,p)}}break;case "LAMP":ca(b,a)}ra.jp(b,!0,a)};a.kp=function(a){a.k.Pl=
!0};a.dA=function(a,b){for(var c=a.k.Zb,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=ta.Ty(c,b,e);return d};a.uF=oa;a.hide_object=function(a){a.f.Uh=!0};a.show_object=function(a){a.f.Uh=!1};a.is_hidden=function(a){return a.f.Uh};a.rC=function(a,b,c){b=b.f;a=ea(a,Hb);for(var d=0;d<a.length;d++)for(var e=a[d].o,g=e.length-1;0<=g;g--){var f=e[g];f.zd==b&&(f.D&&c&&Aa.dr(f.D.R),e.splice(g,1))}};a.Uf=ca;a.cleanup=function(){for(var a=0;a<Sa.length;a++){var b=Sa[a];pa.W(b.k.nb,function(a,b){if("SINK"!=
b.type){var c=b.j;vb.uC(c.Ae,c.pb,c.dd,c.width,c.height);for(var c=b.o,d=0;d<c.length;d++){var e=c[d].D;e&&E.hy(e)}}});b.k.nb=[];b.k.eh=[]}pb=Ob=null;Sa.length=0;fc=null};a.Ys=function(a,b,c){a=ta.uz(a,a.gb,a.eb,null,!0);var d=Wb.Nz(a);a=ra.Eh("DYNAMIC");a.lb=a.Ib={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.Jb=a.bd=ia.Bx();var e=a.Jb.La;a.ig=a.ef=ia.dl([e,0,0],[0,e,0],[0,0,e],a.Jb.F);c=E.Jy(d,c);b.o.push(x(a,c))};a.xG=function(a){return[a.frame_start,a.frame_end]};a.bu=
function(a,b,c){Gb.dD(a,b,c);pb&&ba(pb,a,b)};a.Bu=ea;a.ea=F;a.get_environment_colors=function(a){a=ea(a,Vb)[0];var b=a.tf,c=a.cg,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.nf,d,e]};a.set_environment_colors=function(a,b,c,d){a=ea(a,Vb);for(var e=0;e<a.length;e++){var g=a[e];isNaN(b)||(g.nf=b);c&&g.tf.set(c);d&&g.cg.set(d);g.wa=!0}};a.get_sky_params=function(a){if(a=F(a,"SKY")){var b={};b.color=Array(3);ob.copy(a.si,b.color);b.procedural_skydome=a.procedural_skydome;
b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=F(a,"SKY");c&&("number"==
typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.si.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=
b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.wa=!0,c.Ol=!0,ka(a,c))};a.get_fog_color_density=function(a,b){var c=
b||[],d=ea(a,Nc)[0].bc;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=ea(a,Nc),d=0;d<c.length;d++){var e=c[d];e.bc.set(b);e.wa=!0}};a.get_ssao_params=function(a){var b=F(a,"SSAO");a=F(a,"SSAO_BLUR");if(!b)return null;var c=b.o[0].D,d={};d.ssao_quality=E.Fb(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.Nq=a.ssao_blur_discard_value;d.radius_increase=b.xi;d.influence=b.wi;d.dist_factor=b.vi;d.ssao_only=
b.ssao_only;d.ssao_white=E.Fb(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=F(a,"SSAO"),d=F(a,"SSAO_BLUR");if(!c)return Qa.error("SSAO is not enabled on the scene"),0;if("string"==typeof b.ssao_quality){var e=c.o[0].D;E.xa(e,"SSAO_QUALITY",b.ssao_quality);E.sb(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.o[0].D,E.xa(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),E.sb(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.o[0].D,E.xa(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),E.sb(e,!0));"number"==
typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.xi&&(c.xi=b.xi);"number"==typeof b.wi&&(c.wi=b.wi);"number"==typeof b.vi&&(c.vi=b.vi);if("number"==typeof b.ssao_only){c=F(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var g=0;g<c.o.length;g++)e=c.o[g].D,E.xa(e,"SSAO_ONLY",b.ssao_only),E.sb(e,!0)}"number"==typeof b.ssao_white&&(e=c.o[0].D,E.xa(e,"SSAO_WHITE",b.ssao_white),E.sb(e,!0));c.wa=!0;d.wa=!0};a.get_dof_params=function(a){a=F(a,"DOF");
if(!a)return null;var b={};b.dof_distance=a.j.dof_distance;b.dof_front=a.j.dof_front;b.dof_rear=a.j.dof_rear;b.dof_power=a.j.dof_power;b.we=a.j.we;return b};a.set_dof_params=I;a.get_god_rays_params=function(a){var b=ea(a,["GOD_RAYS"]);a=F(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].ai;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=E.Fb(b[0].o[0].D,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=ea(a,["GOD_RAYS"]),d=F(a,"GOD_RAYS_COMBINE");
if(!c||!d)return Qa.error("God Rays are not enabled on the scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,g=0;g<c.length;g++)c[g].ai=e,c[g].hm=e/c[g].Bi/(g+1),c[g].wa=!0;if("number"==typeof b.god_rays_steps)for(var f=na.r(b.god_rays_steps,1),e=c[0].ai,g=0;g<c.length;g++){c[g].Bi=f;c[g].hm=e/f/(g+1);c[g].wa=!0;var h=c[g].o[0].D;E.xa(h,"STEPS_PER_PASS",f);E.sb(h,!0)}d.wa=!0};
a.get_bloom_params=function(a){var b=F(a,"LUMINANCE_TRUNCED");a=F(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=da;a.get_glow_material_params=function(a){a=F(a,"GLOW_COMBINE");if(!a)return null;var b={};b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;
return b};a.set_glow_material_params=P;a.get_wind_params=function(a){a=O(a);var b=ob.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.IC=function(a){a.k.Mo=!0};a.get_water_surface_level=ua;a.get_water_mat_params=function(a,b){var c=F(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.ag,b.waves_length=c.uh,c.Hd)){b.water_fog_density=c.Hd[3];var d=b.water_fog_color=[];d[0]=c.Hd[0];d[1]=c.Hd[1];d[2]=c.Hd[2]}};a.set_water_params=function(a,b){var c=
F(a,"MAIN_OPAQUE");if(!c||!c.ob)return Qa.error("set_water_params() - no water parameters on the scene"),null;c=c.ob;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==
typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.tj=b.water_dynamic);for(var d=ea(a,Rc),e=0;e<d.length;e++){var g=d[e];
"number"==typeof b.water_fog_density&&c.bc&&(g.Hd[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.bc&&g.Hd.set(b.water_fog_color);"number"==typeof b.waves_height&&(g.ag=b.waves_height);"number"==typeof b.waves_length&&(g.uh=b.waves_length);g.wa=!0}};a.get_shore_dist=function(a,b){var c=F(pb,"MAIN_OPAQUE");if(!c.Am)return 100;var d=c.bi,e=c.$f,g=(a[0]-c.Mf[0])/c.Nf[0],f=(c.Mf[1]+a[2])/c.Nf[1],g=g+.5,f=f+.5;if(1<g||0>g||1<f||0>f)e=1;else return c=d*ya.Zr(pb.k.lp,c.ri,g,f),e=(e-a[1])*b,
e=Math.sqrt(c*c+e*e)};a.update=function(a,b){for(var d=c().eg.f,e=0;e<Sa.length;e++){var g=Sa[e],f=g.k.nb,h=g.k;if(h.ob)var l=d.i[1]-ua(d.i[0],d.i[2]);for(var k=h.sk,g=0;g<k.length;g++){var n=k[g].k,E=n.Ya,m=n.Oh+n.ja;if(E){var p=Math.round(E.currentTime*n.mc),O=n.ja/n.mc;if(p<n.ja-(xa.Ig?5:0)||k[g].k.mh&&p>m)E.currentTime=O;!n.mh&&p>m&&E.pause();2<=E.readyState&&!E.paused&&ec.qE(n)}else if(n.oi){E=Math.min(n.oi.length,n.Oh+n.ja);if(n.Ne<n.ja||n.mh&&n.Ne>=E)n.Ne=n.ja;!n.mh&&n.Ne>=E&&(n.pi=!1);E=Math.round(a*
ab.Pa/n.mc)*n.Xt;E!=Ic&&n.pi&&(ec.nE(n),n.Ne++);Ic=E}}pa.W(f,function(b,c){-1<Jc.indexOf(c.type)&&(c.time=a);h.ob&&(c.jn=l)})}for(e=0;e<Sa.length;e++)if(g=Sa[e],h=g.k,f=h.nb,d=h.eh,d.length)for(h.Pl&&(W(g),h.Pl=!1),h.Mo&&(Y(g),h.Mo=!1),h.No&&(aa(g),h.No=!1),h.Vg&&qa(f,b),f=ja.Wa(f,"OUTLINE_MASK"),g=0;g<d.length;g++)k=d[g],Ea.Xo(k),f&&ma(k,f),vb.sj(k);xa.show_hud_debug_info&&yc.hD(Sa,b)};a.yC=function(a){a.k.No=!0};a.Xn=function(a){var b=[];pa.W(a.k.nb,function(a,c){b.push(c)});return b};a.get_cam_water_depth=
function(){var a=F(pb,"MAIN_BLEND"),b=pb;return a||b.k.ob?a.jn:null};a.get_object_data_id=function(a){return a.f.lc};a.Qp=function(a){pa.W(a.k.nb,function(a,b){b.wa=!0})};a.bD=function(a,b){switch(b){case "WM_NONE":a.cb=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.o.length;c++)a.o[c].D.wireframe_mode=kb.nq[b];a.cb=!0}a.Ha="WM_TRANSPARENT_WIREFRAME"==b;a.wa=!0};a.aD=function(a,b){for(var c=0;c<a.o.length;c++)a.o[c].D.wireframe_edge_color=
b,a.wa=!0};a.fE=function(a,b){var c=b.Kh,d=a.k.Ve;if(c&&"WIND"==c.type&&d){ya.quat_to_dir(b.f.quat,ya.AXIS_Y,d);ob.normalize(d,d);ob.scale(d,c.yu,d);for(var c=ea(a,Jc),e=0;e<c.length;e++)c[e].Ve.set(d)}};a.VB=function(a,b,c){var d=F(a,"COLOR_PICKING");if(d)return b=Gb.kn(b,c,Lb,d.j),Ea.Xo(d),vb.sj(d),(a=F(a,"COLOR_PICKING_XRAY"))?(Ea.Xo(a),vb.sj(a),d=a.j):d=d.j,b[1]=d.height-b[1],vb.Lt(d.Ae,b[0],b[1]);Qa.error("Object Selection is not available on the scene");return null};a.set_outline_color=function(a){var b=
c();if(b=F(b,"OUTLINE"))b.Ef.set(a),b.wa=!0};a.BG=O;a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};a.Nu=function(a,b){var c=Xb;ob.negate(b,c);for(var d=0;6>d;d++){var e=a.lj[d],g=a.xn[d],f=a.j;La.translate(ya.pv[d],c,e);La.multiply(f.Aa,e,f.Gd);ya.pl(f.Gd,g)}};a.Qu=function(a,b,c){ya.ND(b,c,ya.AXIS_Y,a.j.gc)};a.ux=function(a,b,c){var d=a.k.Zb,e=a.k.ki;c=ra.Zn(c)||c[0];for(var g=0;g<b.length;g++){var f=
b[g],h=ra.Ja(f,a);if(e)if(null!=f.f.Oc){var l=e.Gf;if(l.length){var k=f.f.Oc;h.Gf=l[k]}}else null!=f.f.cd&&(l=e.jf,l.length&&(k=f.f.cd,h.jf=l[k]));d&&f==c&&(h.eu=ea(a,["SHADOW_CAST"]))}};a.marker_frame=function(a,b){return a.timeline_markers[b]}};b4w.module.__physics=function(a,q){function d(a,b){for(var c=a.td,e=0;e<c.length;e++)c[e].Bd.qk&&b.push(c[e]),d(c[e],b)}function c(a,b,c){for(var d=a.Za.o,e=0;e<d.length;e++)for(var g=d[e].m,f=0;f<g.kc.length;f++){var h=g.kc[f];"ANY"!=h.bb&&c!=h.bb||G(h,a,b)}}function b(a,b,c){if(x.Dl(a))switch(b){case x.yv:var d=l(a);d.Za.kv=!0;x.A(a,x.fw,Date.now()-performance.now(),ca.yd,ca.gn?ka.Rr:0);break;case x.zv:U.Eo("URANIUM:",c.slice(1));break;case x.uv:U.error(c);break;case x.vv:K.fbmsg.apply(this,c.slice(1));
break;case x.Ev:var e=f(c.v);if(e){a=c.i;d=c.quat;b=c.Ud;var g=c.Jd,e=e.m;e.hl=c.time;aa.set_sep(a,1,d,e.yn);V.copy(b,e.Ud);V.copy(g,e.Jd)}break;case x.Bv:(a=f(c.ln))&&aa.set_sep(c.i,1,c.quat,a.l.bk[c.Zo]);break;case x.wv:if(d=f(c[1]))a=c[4],d=d.gd.Rk[c[2]],W.set_translation(d,c[3]),W.set_rotation(d,a),W.p(d);break;case x.Fv:if(e=f(c[1]))e.l.speed=c[2];break;case x.qv:d=l(a);k(d,c.jg,c.kg,c.result,null,null,0);break;case x.sv:d=l(a);k(d,c.jg,c.kg,c.result,c.og,c.coll_norm,c.coll_dist);break;case x.rv:if(e=
f(c[1]))a=e.m,a.ng&&a.ng(c[2]);break;case x.hq:case x.Cv:d=l(a);if(a=d.Za.If[c.id])if(d=f(c.Bh),b==x.hq)b=a.callback,b(a.id,c.hit_fract,d,c.hit_time);else{b=c.hit_fract;var g=c.hit_time,e=c.hit_pos,h=a.callback;e?h(a.id,b,d,g,e,c.hit_norm):h(a.id,b,d,g)}break;case x.Dv:t(id);break;case x.Av:a=ea.indexOf(a);console.log("Physics #"+a+" Ping: OUT "+(c[2]-c[1]).toFixed(3)+" ms, IN "+(performance.now()-c[2]).toFixed(3)+" ms, ALL "+(performance.now()-c[1]).toFixed(3)+" ms");break;case x.xv:ba=c[1];break;
case x.tv:a=ea.indexOf(a);console.log("Worker: #"+String(a));console.log(c[1]);break;default:U.error("Wrong message: "+b)}}function l(a){for(var b=0;b<ea.length;b++)if(ea[b]==a)return F[b]}function f(a){return I[a]||null}function k(a,b,c,d,e,g,h){a=a.Za.o;for(var l=0;l<a.length;l++)for(var k=a[l].m,m=0;m<k.kc.length;m++){for(var p=k.kc[m],O=p.Ff,r=!1,x=0;x<O.length;x++){var F=O[x];if(F[0]===b&&F[1]===c){p.Vj[x]=d;r=!0;break}}r&&(O=n(p),e&&p.bn!=b&&(r=e,x=g,F=h,r[0]+=x[0]*F,r[1]+=x[1]*F,r[2]+=x[2]*
F,x[0]*=-1,x[1]*=-1,x[2]*=-1),p.callback(O,O?p.bn==b?f(c):f(b):null,e,g,h))}}function n(a){a=a.Vj;for(var b=!1,c=0;c<a.length;c++)b=b||a[c];return b}function r(){ua.body++;return ua.body}function e(a){if("ANY"==a)return 0;var b=P.indexOf(a);return-1==b?(P.push(a),P.length-1):b}function g(a){return{v:a,Vd:0,Fl:!1,Of:!0,oc:!1,is_character:!1,PA:!1,bl:null,bb:"",fj:0,OF:{},kc:[],ng:null,hl:0,yn:new Float32Array([0,0,0,1,0,0,0,1]),Ud:new Float32Array(3),Jd:new Float32Array(3),Wk:new Float32Array(3),Vk:new Float32Array(4)}}
function h(a,b){switch(a){case "BOX":var c=b.Ib;break;case "CYLINDER":c=b.Xm;break;case "CONE":c=b.Wm;break;case "SPHERE":c=b.bd;break;case "CAPSULE":c=b.Vm}return c}function p(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.F&&(b.center=
a.F);"number"===typeof a.La&&(b.radius=a.La);"number"===typeof a.height&&(b.height=a.height);return b}function w(a,b,c,d,e){var g=a.f.i,f=b.f.Z,h=new Float32Array(16);S.invert(f,h);f=new Float32Array(3);V.transformMat4(g,h,f);switch(b.l.type){case 10:b=b.yc;a=a.f.Ib;x.A(e,x.Jv,c,f,b.ID,b.fp,(a.max_y-a.min_y)/2,d);break;case 20:x.A(e,x.Iv,c,f,a.sH)}}function C(a){return a.m&&a.m.bl}function B(a,b,c,d,e,g,f,h,l,k){var n;ua.qb++;n=ua.qb.toString(16);var m=b.m.v;x.A(H(m),x.Qv,n,a,h,m,c,d,e.m.v,g,f,l,
k);b.m.bl=n}function H(a){for(var b=0;b<F.length;b++)for(var c=F[b].Za.o,d=0;d<c.length;d++)if(c[d].m.v==a)return ea[b];return null}function u(a){var b=a.m;if(b&&(0===b.Vd||!0===b.Fl||!1===b.Of||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.f.i[0]!=a.m.Wk[0]||a.f.i[1]!=a.m.Wk[1]||a.f.i[2]!=a.m.Wk[2]||a.f.quat[0]!=a.m.Vk[0]||a.f.quat[1]!=a.m.Vk[1]||a.f.quat[2]!=a.m.Vk[2])){var b=a.m,c=a.f;V.copy(c.i,b.Wk);fa.copy(c.quat,b.Vk);var d=x.hs(x.Ak);d.v=b.v;d.i=c.i;"DYNAMIC"==b.type?fa.identity(d.quat):
d.quat=c.quat;x.A(H(b.v),x.Ak)}a=a.td;for(b=0;b<a.length;b++)u(a[b])}function D(a,b,c,d,e){e=e||new Float32Array(3);a=a.f.quat;e[0]=b;e[1]=c;e[2]=d;V.transformQuat(e,a,e)}function G(a,b,c){var d=a.Ff,e=a.Vj,g=a.bn,f=[],h=a.bb;if(!f)throw"At least one destination required";for(var l=0;l<b.Za.o.length;l++){var k=b.Za.o[l];if("ANY"==h||k.m.bb==h)k=k.m.v,f&&-1==f.indexOf(k)&&f.push(k)}for(b=0;b<f.length;b++)h=f[b],g<h&&!v(d,g,h)?(d.push([g,h]),e.push(!1)):g>h&&!v(d,h,g)&&(d.push([h,g]),e.push(!1));x.A(c,
x.Hv,g);x.A(c,x.Pv,d,a.Pd)}function v(a,b,c){for(var d=0;d<a.length;d++)if(a[d][0]==b&&a[d][1]==c)return!0;return!1}function m(a){a.m&&a.m.ng&&(a=a.m,x.A(H(a.v),x.bw,a.v),a.ng=null)}function t(a){var b=L(a),c=z(a).Za;c.If[a]&&(delete c.If[a],c.cp.splice(c.cp.indexOf,1),x.A(b,x.kw,a))}function z(a){for(var b=0;b<F.length;b++){var c=F[b];if(c.Za.If[a])return c}return null}function L(a){for(var b=0;b<F.length;b++)if(F[b].Za.If[a])return ea[b];return null}function A(a,b,c){if(b.Ai){a=a.m.v;var d=b.Jh*
b.yj,e=b.aj*b.bj,g=-b.yi*b.zi*2*Math.PI/b.kk;b.Ij&&(g*=-1);switch(b.type){case 10:x.A(c,x.xw,a,d,e,g);break;case 20:x.A(c,x.ww,a,d,e,g)}}}function J(a){return a.oc&&"CHASSIS"==a.yc.qc}function N(a){return a.oc&&"HULL"==a.yc.qc}function M(a){return a.Hg&&"MAIN_BODY"==a.Lh.qc}var y=q("__config");q("__constraints");var K=q("__debug"),x=q("__ipc"),S=q("__mat4"),T=q("__obj_util"),U=q("__print"),fa=q("__quat");q("__renderer");var R=q("__scenes"),W=q("__transform"),aa=q("__tsr"),Q=q("__util"),V=q("__vec3"),
oa=q("__version"),ca=y.m,ka=y.q,la=y.Kd,ba=0,ea=[],F=[],I={},da=[],P=[],ua={body:0,qb:0,It:0},ma=new Float32Array(3),ha=new Float32Array(4),ga=new Float32Array(4),Y=new Float32Array(16),qa=new Float32Array(8),O=new Float32Array(8);a.KA=function(a){a.Za={kv:!1,o:[],If:{},cp:[]};var c=ca.ok;la.Yo&&(c+=oa.timestamp());U.log("%cLOAD PHYSICS","color: #0a0",ca.Bm?"Using Separate Worker Thread,":"Using Same Thread,","Max FPS: "+ca.yd);U.log("%cPHYSICS PATH","color: #0a0",c);var d=x.Ry(c,!ca.Bm);x.wx(d,b);
ea.push(d);F.push(a);ca.ping&&setInterval(function(){x.A(d,x.hw,performance.now())},1E3)};a.cy=function(a){return a.Za?a.Za.kv:!0};a.cleanup=function(){for(var a=0;a<ea.length;a++)x.terminate(ea[a]);ea.length=0;F.length=0;I={};da.length=0;P.length=0;for(var b in ua)ua[b]=0};a.append_object=function(a,b){if(!a.f)throw"No object render: "+a.name;var f;a:{for(var l=0;l<F.length;l++)if(F[l]==b){f=ea[l];break a}f=void 0}var k=[];a.Bd.qk&&d(a,k);var n=b.Za.o;if(J(a)||N(a)||a.is_character||M(a)||a.Li){var m,
O=a,q=f,v=O.J,y=O.f,t=O.Bd,u=t.cm,G=r();if("CAMERA"==O.type)var P=t.Rp?t.Yk:"BOX",z=h(P,y),D=y.Aj,H=y.vj,D=.5,H=0;else"EMPTY"==O.type?(P="EMPTY",z=null,H=D=0):(P=t.Rp?t.Yk:"BOX",z=h(P,y),D=y.Aj,H=y.vj);var K=y.i,L=y.quat,ua=t.rk,ma=t.Wu,ha=t.Vd,ka=t.av,ba=t.$u,W=t.An,la=t.hp,aa=v.b4w_collision_id,qa=e(aa),Nc=t.gj,Jc=t.ej,Rc=t.hj,Ic=y.bd.La,Ob=p(z),pb=v.b4w_correct_bounding_offset,Sa;var fc=P;if(k.length){var Kc=[],Lb={};Lb.quat=new Float32Array([0,0,0,1]);Lb.trans=new Float32Array(3);Lb.worker_bounding=
Ob;Lb.bounding_type=fc;Kc.push(Lb);S.invert(y.Z,Y);fa.invert(y.quat,ga);for(var Xb=0;Xb<k.length;Xb++){var lb={},ca=k[Xb],fb=ca.Bd.Yk,oa=new Float32Array(4),Va=new Float32Array(3);V.transformMat4(ca.f.i,Y,Va);fa.multiply(ga,ca.f.quat,oa);lb.trans=Va;lb.quat=oa;lb.bounding_type=fb;lb.worker_bounding=p(h(fb,ca.f));Kc.push(lb)}Sa=Kc}else Sa=[];x.A(q,x.Mv,G,K,L,u,ua,ma,ha,ka,ba,W,la,qa,Nc,Jc,Rc,P,Ob,Ic,D,H,Sa,pb);I[G]=O;da.push(O);var gb=g(G);gb.type=u;gb.Vd=ha;gb.Fl=ua;gb.bb=aa;gb.fj=qa;m=gb;a.m=m;var ib=
{D:null,m:m};n.push(ib);c(b,f,m.bb)}else for(var Nb=T.Ja(a,b).T,Fa=0;Fa<Nb.length;Fa++){var va=Nb[Fa],gc;if(gc="PHYSICS"==va.type){var Ab;a:{for(var wa=b.Za.o,Wa=0;Wa<wa.length;Wa++){var X=wa[Wa].D;if(X&&X.id==va.id){Ab=!0;break a}}Ab=!1}gc=!Ab}if(gc)if(va.Uc.P)if(va.Zf&&b.k.ob){var Ja=va,Ba=b,Ca=f,za=R.ea(Ba,"MAIN_OPAQUE");x.A(Ca,x.Vv,za.$f);if(za.ob&&Ja.SE){var Oa={};Oa.dst_noise_scale0=Ja.dst_noise_scale0;Oa.dst_noise_scale1=Ja.dst_noise_scale1;Oa.dst_noise_freq0=Ja.dst_noise_freq0;Oa.dst_noise_freq1=
Ja.dst_noise_freq1;Oa.dir_min_shore_fac=Ja.dir_min_shore_fac;Oa.dir_freq=Ja.dir_freq;Oa.dir_noise_scale=Ja.dir_noise_scale;Oa.dir_noise_freq=Ja.dir_noise_freq;Oa.dir_min_noise_fac=Ja.dir_min_noise_fac;Oa.dst_min_fac=Ja.dst_min_fac;Oa.waves_hor_fac=Ja.waves_hor_fac;var hc=za.ag,Ra=za.uh;za.Am?x.A(Ca,x.jq,Oa,za.Nf[0],za.Nf[1],za.Mf[0],za.Mf[1],za.bi,hc,Ra,za.ri,Ba.k.lp):x.A(Ca,x.jq,Oa,0,0,0,0,0,hc,Ra,0,null)}}else{var Mb;if(va.rk){var zb=a,nb=va,rc=f,mb=r(),ic=nb.Uc,hb=ic.B[0].a_position,Ac=ic.oa||
null,qb=nb.bb,Bb=e(qb);x.A(rc,x.Sv,mb,hb,Ac,zb.f.i,Bb,nb.gj,nb.ej,nb.hj);var Ma=g(mb);Ma.Fl=!0;Ma.bb=qb;Ma.fj=Bb;Mb=Ma}else{var Ya=a,bb=va,Yb=f,jc=r(),Za=bb.Uc,Fc=Za.B[0].a_position,Bc=Za.oa||null,Cb=Ya.f.i,sc=bb.Aj,Ib=bb.vj,rb=bb.bb,sb=e(rb);x.A(Yb,x.Uv,jc,Fc,Bc,Cb,sc,Ib,sb,bb.gj,bb.ej,bb.hj);var Da=g(jc);Da.bb=rb;Da.fj=sb;Mb=Da}m=Mb;ib={D:va,m:m};n.push(ib);c(b,f,m.bb)}else U.error("Object "+a.name+" has collision material with no assigned vertices")}if(J(a)||N(a)){var Ga=a,sa=f,cb=Ga.m.v;J(Ga)?
(Ga.l.type=10,x.A(sa,x.Nv,cb,Ga.l.Ap,Ga.l.Cp,Ga.l.Bp,Ga.l.bq,Ga.l.Ho)):N(Ga)&&(Ga.l.type=20,x.A(sa,x.Lv,cb,Ga.l.yg,Ga.l.sh,Ga.l.th));if(Ga.l.dh){var Ha=Ga.l.dh;switch(Ga.l.type){case 10:w(Ha[1],Ga,cb,!0,sa);w(Ha[0],Ga,cb,!0,sa);w(Ha[3],Ga,cb,!1,sa);w(Ha[2],Ga,cb,!1,sa);break;case 20:for(var xb=0;xb<Ha.length;xb++)w(Ha[xb],Ga,cb,!1,sa)}}A(a,a.l,f)}else if(a.is_character){var Pa=f,Db=a.f,db=a.m,mc=Db.Ib.max_y-Db.Ib.min_y,Zb=db.v,Xa=a.Yq,nc=Xa.RE,tc=Xa.EC,kc=Xa.zD,Jb=Xa.YA,jb=Xa.TE,eb=Q.gz(a);x.A(Pa,
x.Ov,Zb,eb,mc,nc,tc,kc,Jb,jb);db.is_character=!0}else if(M(a)){var Ia=a,Kb=f,Na=Ia.m.v;x.A(Kb,x.Rv,Na,Ia.gd.yg,Ia.gd.sh,Ia.gd.th);if(Ia.gd.Rk)for(var $b=Ia.gd.Rk,yb=0;yb<$b.length;yb++){var Eb=$b[yb],Pb=Eb.f.i,Qb=Ia.f.Z,Ua=new Float32Array(16);S.invert(Qb,Ua);var Cc=new Float32Array(3);V.transformMat4(Pb,Ua,Cc);x.A(Kb,x.Kv,Na,Cc,Eb.Gx)}Ia.m.PA=!0}for(Fa=0;Fa<da.length;Fa++)if(a=da[Fa],a.m){var ac=a;if(!C(ac))for(var lc=0;lc<ac.Vo.length;lc++){var tb=ac.Vo[lc],bc=tb.target,uc=tb.XB;if(bc.m){var cc=
new Float32Array([tb.YB,tb.ZB,tb.$B]),Rb,vc=new Float32Array([tb.Ld,tb.Md,tb.Nd]);Rb=Q.euler_to_quat(vc,new Float32Array(4));var oc=S.fromRotationTranslation(Rb,cc,new Float32Array(16)),Oc=S.multiply(ac.f.Z,oc,new Float32Array(16)),wc=S.invert(bc.f.Z,new Float32Array(16)),dc=S.multiply(wc,Oc,wc),Fb=Q.$h(dc),Gc=Q.matrix_to_quat(dc),$a=tb,Ka={};Ka.use_limit_x=$a.yE;Ka.use_limit_y=$a.zE;Ka.use_limit_z=$a.AE;Ka.use_angular_limit_x=$a.tE;Ka.use_angular_limit_y=$a.uE;Ka.use_angular_limit_z=$a.vE;Ka.limit_max_x=
$a.hB;Ka.limit_min_x=$a.kB;Ka.limit_max_y=$a.iB;Ka.limit_min_y=$a.lB;Ka.limit_max_z=$a.jB;Ka.limit_min_z=$a.mB;Ka.limit_angle_max_x=$a.bB;Ka.limit_angle_min_x=$a.eB;Ka.limit_angle_max_y=$a.cB;Ka.limit_angle_min_y=$a.fB;Ka.limit_angle_max_z=$a.dB;Ka.limit_angle_min_z=$a.gB;B(uc,ac,cc,Rb,bc,Fb,Gc,Ka,null,null)}}}};a.zz=f;a.update=function(a,b){for(var c=0;c<ea.length;c++){var d=ea[c],e=a;d&&x.Hs(d)&&x.A(d,x.yw,e,b);for(var g=0;g<da.length;g++){var f=da[g],h=f.m;if(h.Of&&h.hl){var l=x.Hs(d)?e-h.hl:performance.now()/
1E3-h.hl,l=Math.min(l,10/ca.yd),l=l-1/ca.yd;ka.NB&&(l=0);var k=qa;aa.LA(h.yn,l,h.Ud,h.Jd,qa);W.set_tsr(f,k);W.p(f);u(f);if(f.l)for(var h=f,l=h.l.dh,k=h.f.Ma,n=qa,m=0;m<l.length;m++){var p=l[m];aa.multiply(k,h.l.bk[m],n);W.set_tsr(p,n);W.p(p)}f.l&&f.l.Ai&&(h=f.l,l=h.Ai)&&(k=f.l.vu,p=Y,n=f.f.i,m=f.f.quat,Q.Lp(f.l.wu,m,n,p),Q.$h(p,l.f.i),Q.matrix_to_quat(p,l.f.quat),p=ha,Q.Mp(k,m,n,p),k=ga,fa.setAxisAngle(p,-h.yi*h.zi*2*Math.PI,k),fa.multiply(k,l.f.quat,l.f.quat),W.p(l));f.l&&f.l.tp&&(h=f.l,l=h.tp)&&
(n=f.l.ru,k=Y,m=f.f.i,p=f.f.quat,Q.Lp(f.l.su,p,m,k),Q.$h(k,l.f.i),Q.matrix_to_quat(k,l.f.quat),k=ha,Q.Mp(n,p,m,k),n=ga,m=Math.abs(h.speed)*h.hk,m>h.ci&&(m=h.ci),fa.setAxisAngle(k,-m,n),fa.multiply(n,l.f.quat,l.f.quat),W.p(l));f.l&&f.l.Dp&&(h=f.l,l=h.Dp)&&(k=f.l.Fu,p=Y,n=f.f.i,m=f.f.quat,Q.Lp(f.l.Gu,m,n,p),Q.$h(p,l.f.i),Q.matrix_to_quat(p,l.f.quat),f=ha,Q.Mp(k,m,n,f),k=ga,fa.setAxisAngle(f,-Math.abs(h.Jh)*h.oj,k),fa.multiply(k,l.f.quat,l.f.quat),W.p(l))}}x.eC(d);d=R.ea(F[c],"MAIN_OPAQUE");d.ob&&0<
d.ob.waves_height&&(e=V.length(d.Ve),x.A(ea[c],x.vw,d.time*e))}};a.Uz=function(){return F[0]};a.pause=function(){for(var a=0;a<ea.length;a++)x.A(ea[a],x.gw)};a.resume=function(){for(var a=0;a<ea.length;a++)x.A(ea[a],x.lw)};a.enable_simulation=function(a){a=a.m;if(!a)throw"No object physics";if(!a.Of){var b=a.v,c=H(b);a.Of=!0;x.A(c,x.ew,b)}};a.disable_simulation=function(a){a=a.m;if(!a)throw"No object physics";if(a.Of){var b=a.v,c=H(b);a.Of=!1;x.A(c,x.dw,b)}};a.mm=function(a){return Boolean(a.Za)};
a.K=function(a){return Boolean(a.m)};a.has_dynamic_physics=function(a){return(a=a.m)&&a.Of&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.Vd&&0==a.Fl?!0:!1};a.has_simulated_physics=function(a){return(a=a.m)&&a.Of?!0:!1};a.set_gravity=function(a,b){var c=a.m.v;x.A(H(c),x.uw,c,b)};a.DA=C;a.apply_constraint=B;a.clear_constraint=function(a){a=a.m;x.A(H(body_a),x.jw,a.bl);a.bl=null};a.pull_to_constraint_pivot=function(b,c,d,e,g,f){c=aa.create_sep(c,1,d,qa);g=aa.create_sep(g,1,f,O);aa.invert(c,c);aa.multiply(g,
c,c);W.get_tsr(e,g);aa.multiply(g,c,c);W.set_tsr(b,c);W.p(b);a.set_transform(b,b.f.i,b.f.quat)};a.set_transform=function(a,b,c){var d=a.m;aa.set_sep(a.f.i,1,a.f.quat,d.yn);a=x.hs(x.Ak);a.v=d.v;a.i=b;a.quat=c;x.A(H(d.v),x.Ak)};a.sync_transform=u;a.apply_velocity=function(a,b,c,d){D(a,b,c,d,ma);a=a.m.v;b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(ma[0]),g=Math.abs(ma[1]),f=Math.abs(ma[2]);ma[0]=e?ma[0]/e*Math.max(e,b):0;ma[1]=g?ma[1]/g*Math.max(g,c):0;ma[2]=f?ma[2]/f*Math.max(f,d):0;x.A(H(a),
x.lq,a,ma[0],ma[1],ma[2])};a.apply_velocity_world=function(a,b,c,d){a=a.m.v;x.A(H(a),x.lq,a,b,c,d)};a.apply_force=function(a,b,c,d){D(a,b,c,d,ma);a=a.m.v;x.A(H(a),x.Wv,a,ma[0],ma[1],ma[2])};a.apply_torque=function(a,b,c,d){D(a,b,c,d,ma);a=a.m.v;x.A(H(a),x.Yv,a,ma[0],ma[1],ma[2])};a.set_character_move_dir=function(a,b,c){a=a.m.v;x.A(H(a),x.ow,a,b,c)};a.set_character_move_type=function(a,b){var c=a.m.v;x.A(H(c),x.pw,c,b)};a.set_character_walk_velocity=function(a,b){var c=a.m.v;x.A(H(c),x.tw,c,b)};a.set_character_run_velocity=
function(a,b){var c=a.m.v;x.A(H(c),x.rw,c,b)};a.set_character_fly_velocity=function(a,b){var c=a.m.v;x.A(H(c),x.mw,c,b)};a.character_jump=function(a){a=a.m.v;x.A(H(a),x.$v,a)};a.character_rotation_inc=function(a,b,c){a=a.m.v;x.A(H(a),x.aw,a,b,c)};a.set_character_rotation=function(a,b,c){a=a.m.v;x.A(H(a),x.qw,a,b,c)};a.set_character_rotation_h=function(a,b){var c=a.m.v;x.A(H(c),x.nw,c,b)};a.set_character_rotation_v=function(a,b){var c=a.m.v;x.A(H(c),x.sw,c,b)};a.append_collision_test=function(a,b,
c,d){var e=a.m,g=e.v;b=b||"ANY";for(var f=0;f<e.kc.length;f++)if(a=e.kc[f],a.bb==b&&a.callback==c)return;a={bn:g,Pd:d||!1,bb:b,callback:c,Ff:[],Vj:[]};e.kc.push(a);b=H(g);G(a,l(b),b)};a.remove_collision_test=function(a,b,c){a=a.m;for(var d=H(a.v),e=l(d),g=0;g<a.kc.length;g++){var f=a.kc[g];if(f.bb==b&&f.callback==c){if(n(f)){var h=V.set(0,0,0,ma);f.callback(!1,null,h,h,0)}a.kc.splice(g,1);g--;for(var h=d,f=f.Ff,k=e.Za.o,m=0;m<k.length;m++)for(var p=k[m].m,O=0;O<p.kc.length;O++)for(var r=p.kc[O],F=
0;F<r.Ff.length;F++)for(var w=r.Ff[F],q=0;q<f.length;q++){var v=f[q];w[0]==v[0]&&w[1]==v[1]&&(f.splice(q,1),q--)}f.length&&x.A(h,x.kq,f)}}};a.apply_collision_impulse_test=function(a,b){a.m&&a.m.ng&&m(a);var c=a.m;x.A(H(c.v),x.Xv,c.v);c.ng=b};a.clear_collision_impulse_test=m;a.append_ray_test=function(a,b,c,d,g,f,h,k,n){var m;ua.It++;m=ua.It;d=d||"ANY";a={id:m,v:a?a.m.v:0,X:new Float32Array(b),ya:new Float32Array(c),bb:d,fj:e(d),Hq:f,Jx:h,Pd:k,zl:n,callback:g};b=H(a.v)||ea[0];c=l(b).Za;m=a.id;c.If[m]=
a;c.cp.push(a);x.A(b,x.Tv,a.id,a.v,a.X,a.ya,a.fj,a.Hq,a.Jx,a.Pd,a.zl);return m};a.remove_ray_test=t;a.change_ray_test_from_to=function(a,b,c){var d=L(a),e=z(a).Za.If[a];e&&!e.Hq&&(e.X.set(b),e.ya.set(c),x.A(d,x.Zv,a,b,c))};a.Is=function(a){return z(a).Za.If[a]?!0:!1};a.vehicle_throttle=function(a,b){var c=a.l;c.Jh=b;A(a,c,H(a.m.v))};a.vehicle_steer=function(a,b){var c=a.l;c.yi=b;A(a,c,H(a.m.v))};a.vehicle_brake=function(a,b){var c=a.l;c.aj=b;A(a,c,H(a.m.v))};a.is_vehicle_chassis=J;a.is_vehicle_hull=
N;a.OA=function(a){if(!a.oc)return!1;a=a.yc.qc;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.MA=function(a){return a.oc?"BOB"==a.yc.qc?!0:!1:!1};a.QA=function(a){return a.Hg?"BOB"==a.Lh.qc?!0:!1:!1};a.Ls=function(a){return a.oc&&"STEERING_WHEEL"==a.yc.qc?!0:!1};a.Ks=function(a){return a.oc&&"SPEEDOMETER"==a.yc.qc?!0:!1};a.Ms=function(a){return a.oc&&"TACHOMETER"==a.yc.qc?!0:!1};a.get_vehicle_speed=function(a){return a.l.speed};a.VE=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;
case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=function(a){return a.is_character};a.RG=M;a.iA=function(){return ba};a.Zy=function(){for(var a=0;a<ea.length;a++)x.A(ea[a],x.cw)};a.qC=function(a){var b=da.indexOf(a);-1==b&&U.error("Object "+a.name+" doesn't have bounding physics");for(var c=a.m.v,d=H(c),e=l(d),g=e.Za.o,f=[],h=0;h<g.length;h++)for(var k=g[h].m,p=0;p<k.kc.length;p++)for(var O=k.kc[p],r=0;r<O.Ff.length;r++){var F=O.Ff[r],
w=O.Vj[r];if(F[0]==c||F[1]==c)O.Ff.splice(r,1),O.Vj.splice(r,1),r--,w&&!n(O)&&(w=V.set(0,0,0,ma),O.callback(!1,null,w,w,0)),f.push(F)}f.length&&x.A(d,x.kq,f);a.m&&a.m.ng&&m(a);delete I[c];da.splice(b,1);a=e.Za.o;for(b=0;b<a.length;b++)a[b].m.v==c&&(a.splice(b,1),b--);x.A(d,x.iw,c)}};b4w.module.__data=function(a,q){function d(a,b){wb[b.id]=null;na[b.id]=null}function c(a,b,c){var d;a instanceof ArrayBuffer&&(a=ua.ns(a));d=a.width;a=a.height;Z.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(ec)&&c&&Z.warn("image",b,"is not from app root.")}function b(a,b,c,d,e,g){d=b.s;if(!d)throw"Nothing requested";F.enqueue([[d,F.AT_JSON,d]],function(d,g,f,h){if(d){Z.log("%cLOAD METADATA","color: #616",h);g=ra.xu(d.b4w_format_version);
switch(ra.bv(g,Ea.Ug)){case -1:g[0]<Ea.Ug[0]?ra.ka("JSON version is too old relative to B4W engine: "+ra.Wf(g)+", required: "+ra.Wf(Ea.Ug)+". Reexport scene with the latest B4W addon to fix it."):Z.warn("JSON version is a bit old relative to B4W engine: "+ +ra.Wf(g)+", required: "+ra.Wf(Ea.Ug)+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");break;case 1:g[0]>Ea.Ug[0]?ra.ka("B4W engine version is too old relative to JSON. Can't load the scene. Update your engine version to fix it."):
Z.warn("B4W engine version is a bit old relative to JSON. Some compatibility issues can occur. Update your engine version to fix it.")}Ea.Do=g;for(var l in d)a[l]=d[l];0===b.id&&(ya=a);(d=a.binaries[0].binfile)?b.Kq=d:(ha.iu(b,"load_binaries"),ha.iu(b,"prepare_bindata"));d=a==ya;if(a.b4w_export_errors)for(l=0;l<a.b4w_export_errors.length;l++)g=a.b4w_export_errors[l],(d&&"PRIMARY"==g.type||"ALL"==g.type)&&Z.qz(g.text);d=a==ya;if(a.b4w_export_warnings)for(l=0;l<a.b4w_export_warnings.length;l++)g=a.b4w_export_warnings[l],
(d&&"PRIMARY"==g.type||"ALL"==g.type)&&Z.rz(g.text);e(b,c)}else ha.sq(b)},null,function(a){g(b,c,a)})}function l(a,b,c,d,e,g){d=V(b.s)+b.Kq;if(!d)throw"Binary data is missing";F.enqueue([[d,F.AT_ARRAYBUFFER,d]],function(d,g,f,h){d?(Z.log("%cLOAD BINARY","color: #616",h),a.bin_data=d,d=n(d),g=ra.xu(a.b4w_format_version),d[0]!=g[0]&&ra.ka("BIN version does not match to JSON version: "+ra.Wf(d)+", required: "+ra.Wf(Ea.Ug)+". Couldn't load the scene. Reexport scene to fix it."),d[1]!=g[1]&&Z.warn("BIN version does not match to JSON version: "+
+ra.Wf(d)+", required: "+ra.Wf(Ea.Ug)+". Some compatibility issues can occur. Reexport scene to fix it."),e(b,c)):ha.sq(b)},null,function(a){g(b,c,a)})}function f(a,b,c,d,e){yc.ay()&&e(b,c)}function k(a,b,c,d,e){d=a.bin_data;var g=a.binaries[0],f=a.objects,h=a.meshes;a=a.actions;for(var l=ra.Xx(),k=n(d),k=5<=k[0]&&4<k[1]?12:0,m=["indices"],p=["normal","tangent"],O=["color","group"],E=["position","texcoord","texcoord2"],x=0;x<h.length;x++)for(var F=h[x].submeshes,w=0;w<F.length;w++)for(var q in F[w]){var v=
F[w][q][1];if(-1!=m.indexOf(q)){var y=4*F[w][q][0]+g["int"]+k,t=F[w],u=q,G=d;if(l)var ia=new Uint32Array(G,y,v);else for(var ia=new Uint32Array(v),G=new DataView(G),I=0;I<v;I++)ia[I]=G.getUint32(y+4*I,!0);t[u]=ia}else if(-1!=E.indexOf(q))y=4*F[w][q][0]+g["float"]+k,F[w][q]=r(d,y,v,l);else if(-1!=p.indexOf(q)){y=2*F[w][q][0]+g["short"]+k;t=F[w];u=q;G=d;ia=new Float32Array(v);G=new DataView(G);for(I=0;I<v;I++)ia[I]=G.getInt16(y+2*I,!0)/32767;t[u]=ia}else if(-1!=O.indexOf(q)){y=2*F[w][q][0]+g.ushort+
k;t=F[w];u=q;G=d;ia=new Float32Array(v);G=new DataView(G);for(I=0;I<v;I++)ia[I]=G.getUint16(y+2*I,!0)/65535;t[u]=ia}}for(q=0;q<f.length;q++)for(h=f[q].particle_systems,m=0;m<h.length;m++)p=h[m],p.transforms=r(d,4*p.transforms[0]+g["float"]+k,p.transforms[1],l);for(f=0;f<a.length;f++){q=a[f];h=q.fcurves;m=q.frame_range;O=m[0];E=m[1];x=ea.Yz(O,E);m=null;0>x&&(x=0);var w=F=!1,pa;for(pa in h)F|=-1<pa.indexOf("rotation_euler"),w|=-1<pa.indexOf("rotation_quaternion");p=[];for(pa in h)if(F&&w&&-1<pa.indexOf("rotation_euler"))delete h[pa];
else{var v=h[pa],Aa;for(Aa in v)y=v[Aa],t=r(d,g["float"]+4*y.bin_data_pos[0]+k,y.bin_data_pos[1],l),u=new Float32Array(x),null===m&&(m=new Int8Array(x)),ea.ox(y,t,u,m,O,E),y.Bc=u;-1<pa.indexOf("rotation_euler")&&(ea.yz(h[pa]),p.push(pa))}for(O=0;O<p.length;O++)E=p[O],x=E.replace("euler","quaternion"),h[x]=h[E],delete h[E];q.Gw=m}e(b,c)}function n(a){var b=new Uint8Array(a,0,4),c=(new Uint32Array(a,4,1))[0];a=(new Uint32Array(a,8,1))[0];for(var d=0;d<b.length;d++)if("B4WB"[d]!=String.fromCharCode(b[d])){c=
5;a=4;break}return[c,a]}function r(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function e(a,b,c,d,e){var g=a.cameras,f=a.groups,h=a.materials,l=a.meshes,k=a.node_groups,n=a.objects,m=a.particles,p=a.scenes,O=a.speakers,r=a.textures,x=a.worlds;k||(Z.warn('"node_groups" datablock undefined. reexport main scene.'),k=a.node_groups=[]);for(var F="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),
q={},v=0;v<F.length;v++)for(var y=a[F[v]],t=0;t<y.length;t++){var G=y[t];q[G.uuid]=G}for(var ia=0;ia<p.length;ia++){for(var I=p[ia],da=I.objects,C=0;C<da.length;C++)D(da,C,q);I.camera&&D(I,"camera",q);I.world&&D(I,"world",q)}for(ia=0;ia<f.length;ia++)for(var P=f[ia].objects,C=0;C<P.length;C++)D(P,C,q);for(ia=0;ia<n.length;ia++){var z=n[ia];z.dupli_group&&D(z,"dupli_group",q);z.parent&&D(z,"parent",q);z.dg_parent&&D(z,"dg_parent",q);if(z.animation_data){var B=z.animation_data;B.action&&D(B,"action",
q);if(B.nla_tracks)for(C=0;C<B.nla_tracks.length;C++)for(var A=B.nla_tracks[C],H=0;H<A.strips.length;H++)A.strips[H].action&&D(A.strips[H],"action",q)}switch(z.type){case "MESH":if(!z.data)throw"mesh not found for object "+z.name;D(z,"data",q);for(var S=!1,N=z.modifiers,C=0;C<N.length;C++){var K=N[C];"ARMATURE"==K.type?(S&&Z.warn('Object "'+z.name+'" has more than one armature modifiers. Only the first one will be used.'),S=!0,D(K,"object",q)):"CURVE"==K.type&&D(K,"object",q)}var J=z.particle_systems;
if(J)for(C=0;C<J.length;C++)D(J[C],"settings",q);break;case "ARMATURE":D(z,"data",q);for(var T=z.pose.bones,yc=z.data.bones,C=0;C<T.length;C++){var Ea=T[C];Ea.bone=yc[Ea.bone];for(var L=Ea.parent_recursive,H=0;H<L.length;H++)L[H]=T[L[H]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":D(z,"data",q)}var U=z.constraints;if(U)for(C=0;C<U.length;C++){var Ub=U[C];Ub.target&&D(Ub,"target",q)}var ua=z.lod_levels;if(ua)for(C=0;C<ua.length;C++){var ma=ua[C];ma.object&&D(ma,"object",q)}}for(ia=
0;ia<l.length;ia++)for(var na=l[ia].materials,C=0;C<na.length;C++)D(na,C,q);for(ia=0;ia<h.length;ia++){for(var ub=h[ia],kb=ub.texture_slots,C=0;C<kb.length;C++)D(kb[C],"texture",q);var ha=ub.node_tree;ha&&u(ha,q)}for(ia=0;ia<k.length;ia++)(ha=k[ia].node_tree)&&u(ha,q);for(ia=0;ia<r.length;ia++){var ja=r[ia],ka=ja.type;"IMAGE"!=ka&&"ENVIRONMENT_MAP"!=ka||D(ja,"image",q)}for(ia=0;ia<g.length;ia++){var ec=g[ia];ec.dof_object&&D(ec,"dof_object",q)}for(ia=0;ia<O.length;ia++){var fa=O[ia];fa.sound&&D(fa,
"sound",q);if(fa.animation_data&&(B=fa.animation_data,B.action&&D(B,"action",q),B.nla_tracks))for(C=0;C<B.nla_tracks.length;C++)for(A=B.nla_tracks[C],H=0;H<A.strips.length;H++)A.strips[H].action&&D(A.strips[H],"action",q)}for(ia=0;ia<m.length;ia++){for(var R=m[ia],kb=R.texture_slots,C=0;C<kb.length;C++)D(kb[C],"texture",q);R.dupli_group&&D(R,"dupli_group",q);R.dupli_object&&D(R,"dupli_object",q)}for(ia=0;ia<x.length;ia++)if(kb=x[ia].texture_slots)for(C=0;C<kb.length;C++)D(kb[C],"texture",q);Gb.Ux(a);
for(var Q=b.id,ga=a.textures,ba=a==ya?a.scenes[0].b4w_anisotropic_filtering:w().b4w_anisotropic_filtering,Y=0;Y<ga.length;Y++)a==ya||"SCENE"!=ga[Y].b4w_source_type||(ga[Y].b4w_source_id=""),La.Oy(ga[Y],ba,a.scenes,Q);for(var Wb={},W=a.objects,la=0;la<W.length;la++){var wb=W[la];if("MESH"===wb.type&&!wb.particle_systems.length)for(var V=wb.data,aa=V.name,ob=V.submeshes,xa=V.materials,ab=0;ab<ob.length;ab++)0!==ob[ab].base_length||Wb[aa]||(xa[ab]&&Z.warn('material "'+xa[ab].name+'" is not assigned to any face (object "'+
wb.name+'").'),Wb[aa]=!0)}for(var qa=a.meshes,oa=0;oa<qa.length;oa++){var Hb=qa[oa];Hb.materials.length||Hb.uv_textures.length&&Z.warn('mesh "'+Hb.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",
specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},
type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});for(var Ec=a.meshes,Vb=ra.keysearch("name","DEFAULT",a.materials),kc=0;kc<Ec.length;kc++){var Jb=Ec[kc];0==Jb.materials.length&&Jb.materials.push(Vb)}for(var jb=a.actions,eb=b.id,
Ia=0;Ia<jb.length;Ia++){var Kb=jb[Ia];Kb.Iw=eb;ea.Tw(Kb)}for(var Na=a.scenes,$b=0;$b<Na.length;$b++){for(var yb=Na[$b],Eb=[],Pb=[],Qb=Na[$b].objects,Ua=0;Ua<Qb.length;Ua++){var Cc=Qb[Ua];M(Qb,Cc,Eb,Pb);var ac=Cc.dupli_group;if(ac)for(var lc=ac.objects,tb=0;tb<lc.length;tb++)M(lc,lc[tb],Eb,Pb)}for(Ua=0;Ua<Pb.length;Ua++)for(var bc=Pb[Ua],uc=[yb],cc=0;cc<uc.length;cc++){for(var Rb=uc[cc].objects,vc=0;vc<Rb.length;vc++){var oc=Rb[vc].dupli_group;if(oc){var Oc=oc.objects,wc=Oc.indexOf(bc);-1<wc&&Oc.splice(wc,
1)}}var wc=Rb.indexOf(bc);-1<wc&&Rb.splice(wc,1)}for(Ua=0;Ua<Eb.length;Ua++)ra.ix(Eb[Ua][0],Eb[Ua][1])}var dc=a==ya;!dc&&1<a.scenes.length&&(a.scenes=[Aa.ql(a.scenes)],Z.warn("loading data contains multiple scenes.","Only the first one will be loaded."));var Fb=w(),Gc=dc?Fb:Aa.ql(a.scenes);-1==vb.Pa&&(vb.Pa=Fb.fps);1<a.scenes.length&&(a.scenes.splice(a.scenes.indexOf(Fb),1),a.scenes.unshift(Fb));for(var $a=0;$a<a.scenes.length;$a++){var Ka=a.scenes[$a];Ka.k={};Ka.Jw=Ka==Gc;Ka.Kw=dc;Qa.enabled&&Ka.b4w_enable_physics&&
(dc||!ta.mm(w())&&Ka==Aa.ql(a))&&ta.KA(Ka);dc?Ka.b4w_enable_audio&&pa.Dq(Ka):Ka.b4w_enable_audio&&!Fb.da&&pa.Dq(Fb)}for(var Pc=b.id,Dc=w(),xc=a==ya,Sb=0;Sb<a.scenes.length;Sb++){var pc=a.scenes[Sb],Qc=Aa.jy(pc);(pc.b4w_use_nla||pc.b4w_use_logic_editor)&&Gb.tx(Qc,pc);for(var Lc=0;Lc<Qc.length;Lc++){var Tb=Qc[Lc];E.Vx(Tb,pc,a)&&(Tb.Cc||(Tb.Cc=[]),Tb.Cc.push(xc?pc:Dc))}}for(var Yc=ca(a,Pc),Sb=0;Sb<Yc.length;Sb++)if(Tb=Yc[Sb],!xc&&Tb.parent&&-1<qc.indexOf(Tb.parent.type)&&(Tb.parent=""),"MESH"==Tb.type){var Sc=
Gb.lx(Tb);Sc&&(a.meshes.push(Sc),Tb.data=Sc)}e(b,c)}function g(a,b,c,d,e){d=ca(a,b.id);for(var g=[],f=0;f<d.length;f++){var l=d[f];if(l.Cc)for(var k=l.particle_systems,n=0;n<k.length;n++){var m=k[n].settings;if("HAIR"==m.type)if("OBJECT"==m.render_type)m=m.dupli_object,m.Cc||(m.Cc=l.Cc.slice(),g.push(m));else if("GROUP"==m.render_type)for(var p=m.dupli_group,O=0;O<p.objects.length;O++)m=p.objects[O],m.Cc||(m.Cc=l.Cc.slice(),g.push(m));else Z.warn("render type",m.render_type,"not supported for particle systems ("+
m.name+").")}}h(d,b.id,!1);h(g,b.id,!0);for(d=0;d<a.scenes.length;d++)g=a.scenes[d],g.eg=g.camera.Db;if(a==ya)for(d=b.id,g=0;g<a.scenes.length;g++)for(f=a.scenes[g],l=0,k=E.na(f,"LAMP",d),n=0;n<k.length;n++)ia.Ja(k[n],f).Pj=l++;a=E.get_all_objects(b.id);for(d=0;d<a.length;d++)g=a[d],g.so||(E.iE(g),Ub.p(g));e(b,c)}function h(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];if(e.Cc){for(var g=ia.un(e.name,e.type,e.origin_name),f=0;f<e.Cc.length;f++)ia.Jk(g,e.Cc[f]);g.J=e;e.Db=g}}for(d=0;d<a.length;d++)e=
a[d],e.Cc&&(g=e.Db,E.Pp(e,g),g.f.lc=b,g.so=c)}function p(a,b,c,d,e){d=E.get_all_objects(b.id);for(var g=0;g<d.length;g++){var f=d[g];if("MESH"==f.type){var h=f.Kk;if(h){h=h.f;if(h.df){var l=f.f.ad,k=[],n;for(n in l){var m=l[n];k.push(4*m.nj,4*m.Oq)}h.at.push(k)}h.rm.push(f.f)}}}g=n=-1;f=ea.gs();for(h=0;h<d.length;h++)l=d[h],k=l.f,ra.is_mesh(l)&&k.Yh&&(l=k.Ie,l>n&&(n=l),f>=l&&l>g&&(g=l));for(h=0;h<d.length;h++)l=d[h],k=l.f,ra.is_mesh(l)&&k.Yh&&(k.zj=!0,n<f?k.Ie=n:k.Ie<=f?k.Ie=g:(Z.warn('too many bones for "'+
l.name+'" / '+k.Ie+" bones (max "+f+" with blending, "+2*f+" without blending). Blending between frames will be disabled."),k.Ie=n,k.zj=!1),k.zj=k.zj&&!vb.Sr);for(n=0;n<d.length;n++)if(g=d[n],f=g.J,ra.is_mesh(g)&&(h=f.lod_levels.length))for(l=g,k=0;k<h;k++)if(m=f.lod_levels[k].object){m=m.Db;m.f.Qg=g.f.Qg;l.f.xf=f.lod_levels[k].distance;m.f.Qj=f.lod_levels[k].distance;if(f.lod_levels[k+1])m.f.xf=f.lod_levels[k+1].distance;else{m.f.Kl=!0;m.f.xf=1E4;break}l.f.Kl=!1;l=m}else{l.f.Kl=!0;l.f.xf=f.lod_levels[k].distance;
break}for(n=0;n<d.length;n++)if(g=d[n],g.oc)if(f=g.yc,"CHASSIS"==f.qc){g.l={};g.l.yj=f.yj;g.l.bj=f.bj;g.l.Ap=f.Ap;g.l.Cp=f.Cp;g.l.Bp=f.Bp;g.l.bq=f.bq;g.l.fp=f.fp;g.l.Ho=f.Ho;g.l.Jh=0;g.l.aj=1;g.l.yi=0;g.l.speed=0;g.l.dh=[];g.l.bk=[];g.l.Ai=null;if(g.Nc&&g.parent)for(l=[],k=g.parent.J.dupli_group.objects,h=0;h<k.length;h++)l.push(k[h].Db);else l=d;for(h=0;h<l.length;h++)k=l[h],k.oc&&(m=k.yc,ta.OA(k)&&f.name==m.name?(m=ta.VE(k.yc.qc),g.l.dh[m]=k,g.l.bk[m]=new Float32Array(8)):ta.Ls(k)&&f.name==m.name?
(g.l.Ai=k,g.l.zi=m.zi,g.l.kk=m.kk,g.l.Ij=m.Ij,m=ga.invert(g.f.Z,new Float32Array(16)),k=ga.multiply(m,k.f.Z,m),g.l.wu=k,m=new Float32Array([1,0,0,0]),ub.transformMat4(m,k,m),g.l.vu=m):ta.Ks(k)&&f.name==m.name?(g.l.tp=k,g.l.hk=m.hk,g.l.ci=m.ci,m=ga.invert(g.f.Z,new Float32Array(16)),k=ga.multiply(m,k.f.Z,m),g.l.su=k,m=new Float32Array([1,0,0,0]),ub.transformMat4(m,k,m),g.l.ru=m):ta.Ms(k)&&f.name==m.name&&(g.l.Dp=k,g.l.oj=m.oj,m=ga.invert(g.f.Z,new Float32Array(16)),k=ga.multiply(m,k.f.Z,m),g.l.Gu=
k,m=new Float32Array([1,0,0,0]),ub.transformMat4(m,k,m),g.l.Fu=m));if(4!=g.l.dh.length)throw"Not enough wheels for chassis "+g.name;}else if("HULL"==f.qc){g.l={};g.l.dh=[];g.l.bk=[];g.l.yj=f.yj;g.l.bj=f.bj;g.l.yg=f.yg;g.l.sh=f.sh;g.l.th=f.th;g.l.Jh=0;g.l.aj=1;g.l.yi=0;g.l.speed=0;g.l.Ai=null;if(g.Nc&&g.parent)for(l=[],k=g.parent.J.dupli_group.objects,h=0;h<k.length;h++)l.push(k[h].Db);else l=d;for(h=0;h<l.length;h++)k=l[h],k.oc&&(m=k.yc,ta.MA(k)&&f.name==m.name?(g.l.dh.push(k),g.l.bk.push(new Float32Array(8))):
ta.Ls(k)&&f.name==m.name?(g.l.Ai=k,g.l.zi=m.zi,g.l.kk=m.kk,g.l.Ij=m.Ij,m=ga.invert(g.f.Z,new Float32Array(16)),k=ga.multiply(m,k.f.Z,m),g.l.wu=k,m=new Float32Array([1,0,0,0]),ub.transformMat4(m,k,m),g.l.vu=m):ta.Ks(k)&&f.name==m.name?(g.l.tp=k,g.l.hk=m.hk,g.l.ci=m.ci,m=ga.invert(g.f.Z,new Float32Array(16)),k=ga.multiply(m,k.f.Z,m),g.l.su=k,m=new Float32Array([1,0,0,0]),ub.transformMat4(m,k,m),g.l.ru=m):ta.Ms(k)&&f.name==m.name&&(g.l.Dp=k,g.l.oj=m.oj,m=ga.invert(g.f.Z,new Float32Array(16)),k=ga.multiply(m,
k.f.Z,m),g.l.Gu=k,m=new Float32Array([1,0,0,0]),ub.transformMat4(m,k,m),g.l.Fu=m))}for(n=0;n<d.length;n++)if(g=d[n],g.Hg&&(f=g.Lh,"MAIN_BODY"==f.qc)){g.gd={};g.gd.yg=f.yg;g.gd.sh=f.sh;g.gd.th=f.th;g.gd.Rk=[];if(g.Nc&&g.parent)for(h=[],k=g.parent.J.dupli_group.objects,l=0;l<k.length;l++)h.push(k[l].Db);else h=d;for(l=0;l<h.length;l++)k=h[l],k.Hg&&(m=k.Lh,ta.QA(k)&&f.name==m.name&&(g.gd.Rk.push(k),k.Gx=k.Lh.Eu))}d=w();n=a==ya;for(g=0;g<a.scenes.length;g++){f=n?a.scenes[g]:d;m=E.na(f,"ALL",b.id);h=n?
E.na(f,"LAMP",b.id):E.na(f,"LAMP",0);l=E.na(f,"MESH",b.id);k=E.na(f,"EMPTY",b.id);n?(Aa.Zw(f,a.textures,m,h,l,k),f.k.sk.length&&(b.jo=!0)):Aa.$w(f,a.textures);m=[];I.Qz(f,l,h,m);var p=Aa.fs(f);if(n){var O=f.k.sm;if(O.tC||O.procedural_skydome)O=I.Sz(f,O),m.push(O);Aa.Iz(p)}for(O=0;O<l.length;O++)I.qr(l[O],p,f);for(O=0;O<m.length;O++)I.qr(m[O],p,f),E.Pw(m[O]);for(O=0;O<k.length;O++)E.Ou(k[O]);m=E.na(f,"ALL",b.id);Aa.ux(f,m,h)}d=a.materials;if(Wb.Bn&&Ea.Su)for(n=0;n<d.length;n++){h=d[n];l=h.texture_slots;
for(g=0;g<l.length;g++)if(k=l[g],m=k.texture,"IMAGE"==m.type||"ENVIRONMENT_MAP"==m.type)f=m.image,f.Ac||(-1<f.filepath.indexOf(".dds")?f.Ac=!0:(f.Ac=!m.b4w_disable_compression&&!k.use_map_normal&&"ENVIRONMENT_MAP"!=m.type&&!m.b4w_shore_dist_map&&"MOVIE"!=f.source,f.Ac&&(f.filepath+=".dds")));if(g=h.node_tree)for(h=g.nodes,g=0;g<h.length;g++)f=h[g],"TEXTURE"==f.type&&(l=f.texture)&&(f=l.image)&&!f.Ac&&(f.Ac=l.k.Gk&&!l.b4w_disable_compression&&"MOVIE"!=f.source,f.Ac&&(f.filepath+=".dds"))}else for(d=
a.images,n=0;n<d.length;n++)g=d[n],g.Ac=Boolean("FILE"==g.source&&-1<g.filepath.indexOf(".dds"));for(d=0;d<a.scenes.length;d++)delete a.scenes[d].camera;e(b,c)}function w(){return Aa.ql(ya.scenes)}function C(a,b,c,d,e){d=a.groups;for(var g=a.objects,f={},h={},k={},l={},n=0;n<d.length;n++){var m=d[n];f[m.uuid]=m;k[m.uuid]=m}for(n=0;n<g.length;n++)m=g[n],h[m.uuid]=m,l[m.uuid]=m;a=a.scenes;for(n=0;n<a.length;n++)B(a[n].objects,null,l,k);for(var p in k)p in f||d.push(k[p]);for(p in l)p in h||g.push(l[p]);
e(b,c)}function B(a,b,c,d){for(var e=[],g=0;g<a.length;g++){var f=a[g],h=c[f.uuid];if(f=h.proxy){b&&-1==e.indexOf(f.uuid)&&e.push(f.uuid);for(var k=c[f.uuid],l=k.constraints,f=0;f<l.length;f++){var n=ra.mg(l[f]);n.name+="_CLONE";h.constraints.push(n)}"b4w_proxy_inherit_anim"in h&&!h.b4w_proxy_inherit_anim||(h.animation_data&&(k.animation_data=ra.mg(h.animation_data)),k.b4w_use_default_animation=h.b4w_use_default_animation,k.b4w_auto_skel_anim=h.b4w_auto_skel_anim,k.b4w_anim_behavior=h.b4w_anim_behavior,
k.b4w_cyclic_animation=h.b4w_cyclic_animation)}}for(g=0;g<e.length;g++)h=ra.$n(a,"uuid",e[g]),-1<h&&a.splice(h,1);e={};if(b)for(g=0;g<a.length;g++)f=a[g],h=c[f.uuid],l=ra.mg(h),h="origin_name"in h?h.origin_name:h.name,l.name=b.name+"*"+h,l.origin_name=h,l.dg_parent={uuid:b.uuid},H(l),c[l.uuid]=l,e[f.uuid]=l.uuid,f.uuid=l.uuid;for(g=0;g<a.length;g++)f=a[g],h=c[f.uuid],h.dupli_group&&(f=h.dupli_group,l=d[f.uuid],k=ra.mg(l),k.name=ra.Ii(l.name+"_CLONE"),k.uuid=Y.As("Group"+k.name),d[k.uuid]=k,f.uuid=
k.uuid,B(k.objects,h,c,d));if(b)for(g=0;g<a.length;g++){f=a[g];h=c[f.uuid];h.parent&&h.parent.uuid in e?h.parent.uuid=e[h.parent.uuid]:h.parent&&(Z.warn("Object's \""+h.name+'" parent is not in dupli group. Disabling parenting.'),h.parent=null);l=h.constraints;for(f=0;f<l.length;f++)b=l[f],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=h.modifiers;for(f=0;f<b.length;f++)d=b[f],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((h=h.lod_levels)&&h.length)for(f=0;f<
h.length;f++)b=h[f],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var m in e)ob[m]=e[m]}function H(a){a.uuid=Y.As("Object"+a.name)}function u(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&D(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in ob&&(e.lamp.uuid=ob[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&D(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var g=e[d];G(g,"from_node",c);G(g,"to_node",c);
v(g,"from_socket",g.from_node.outputs);v(g,"to_socket",g.to_node.inputs)}if(c=a.animation_data)if(c.action&&D(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],g=0;g<e.strips.length;g++)e.strips[g].action&&D(e.strips[g],"action",b)}function D(a,b,c){(c=c[a[b].uuid])||Z.error("Dangling link found:",b,a);a[b]=c}function G(a,b,c){c=ra.keysearch("name",a[b].name,c);a[b]=c}function v(a,b,c){c=ra.keysearch("identifier",a[b].identifier,c);a[b]=c}function m(a,b,d,e,g,f){if(!Ea.do_not_load_resources){for(var h=
V(b.s),k=a.images,l={},n=[],m=0;m<k.length;m++){var p=k[m],O=p.uuid;if("FILE"===p.source||"MOVIE"===p.source){var E=t(p,a.textures);if(!E.length)Z.warn("image ",p.name," has no users.");else if(!E[0].b4w_shore_dist_map){E=ra.Rj(h+p.filepath);if("FILE"===p.source){var r=p.Ac?F.AT_ARRAYBUFFER:F.AT_IMAGE_ELEMENT;Wb.Io&&Ea.zm&&(E=F.ik(E),"dds"==E[1]?(E=F.ik(E[0]),E=E[0]+".min50."+E[1]+".dds"):E=E[0]+".min50."+E[1])}else"MOVIE"===p.source&&(Ea.nd?(E=F.ik(E),E=E[0]+".altconv.seq",r=F.wk):(E=F.ik(E),r=pa.detect_video_container(E[1]),
E=r!=E[1]?E[0]+".altconv."+r:E[0]+"."+r,r=F.xk));n.push([O,r,E]);l[O]=p}}}n.length?(e.Bs=0,F.enqueue(n,function(g,h,k,m){if(g){if(k==F.xk||k==F.wk){if(k==F.xk)var p=g.videoWidth,O=g.videoHeight;else p=g.images[0].width,O=g.images[0].height;Z.log("%cLOAD VIDEO "+p+"x"+O,"color: #"+(2048<p||2048<O?"a00":1024<p||1024<O?"aa0":"0a0"),m);-1==m.indexOf(ec)&&Z.warn("video",m,"is not from app root.")}else c(g,m,!0);h=l[h];m=t(h,a.textures);for(p=0;p<m.length;p++){var O=m[p],E=O.image.filepath;k==F.wk?(O.k.Xt=
g.mc,La.nk(O.k,g.images,h.Ac,E,b.id)):La.nk(O.k,g,h.Ac,E,b.id)}}g=++e.Bs/n.length;f(b,d,g)},function(){Z.log("%cLOADED ALL IMAGES","color: #0a0");g(b,d)})):g(b,d)}}function t(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function z(a,b,c,d,e,g){if(!Ea.do_not_load_resources){a=V(b.s);for(var f=[],h={},k=E.get_all_objects(b.id),l=0;l<k.length;l++){var n=k[l],m=n.J;if(L(n)){var p=m.data.sound,m=p.uuid;"BACKGROUND_MUSIC"==pa.ao(n)?(m=ra.Vr(),b.io=!0):"NONE"!=pa.ao(n)&&
Ea.Cs&&(b.no=!0);if(!(m in h)){h[m]=[];p=ra.Rj(a+p.filepath);switch(pa.pu(n)){case pa.Em:var O=F.AT_AUDIOBUFFER;break;case pa.dq:O=F.AT_AUDIO_ELEMENT}var p=F.ik(p),r=pa.detect_audio_container(p[1]),p=r!=p[1]?p[0]+".altconv."+r:p[0]+"."+r;f.push([m,O,p])}h[m].push(n)}}f.length?F.enqueue(f,function(a,e,k,l){if(a)for(Z.log("%cLOAD SOUND","color: #0aa",l),-1==l.indexOf(ec)&&Z.warn("sound",l,"is not from app root."),e=h[e],k=0;k<e.length;k++)pa.oE(e[k],a);a=++d.nD/f.length;g(b,c,a)},function(){Z.log("%cLOADED ALL SOUNDS",
"color: #0aa");e(b,c)}):e(b,c)}}function L(a){return pa.Ee(a)&&pa.pu(a)!=pa.eq}function A(a,b,c){a=E.na(a,"SPEAKER",b);for(b=0;b<a.length;b++){var d=a[b];pa.Ee(d)&&(pa.is_cyclic(d)||c)&&pa.play_def(d)}}function J(a){a=a.k.sk;for(var b=0;b<a.length;b++)Ea.nd&&a[b].use_auto_refresh?a[b].k.pi=!0:a[b].k.Ya&&a[b].use_auto_refresh&&a[b].k.Ya.play()}function N(a,b,c,d,e){qa.start();Z.log("%cSTART NLA","color: #0a0");e(b,c)}function M(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,
g=0;g<e;g++){var f=b.lod_levels[g],h=f.object;if(h){var k=ra.dj(h);k.name=b.name+"_LOD_"+String(g+1);H(k);k.lod_levels=[];c.push([a,k]);d.push(h);f.object=k}}}function y(a,b,c,d,e){d=!0;for(var g=0;g<a.scenes.length;g++)if(!ta.cy(a.scenes[g])){d=!1;break}d&&(e(b,c),Z.log("%cPHYSICS READY","color: #0a0"))}function K(a,b,c,d,e){d=w();for(var g=0;g<a.scenes.length;g++){var f=a.scenes[g],h=a==ya?ta.mm(f):ta.mm(d)||ta.mm(f);a==ya||(f=d);if(Qa.enabled&&h)for(h=0;h<Hb.length;h++)for(var k=E.na(f,Hb[h],b.id),
l=0;l<k.length;l++){var n=k[l];n.f.lc==b.id&&(ta.append_object(n,f),b.Ws&&ta.K(n)&&ta.disable_simulation(n))}}e(b,c)}function x(a,b,d,e,g){var f={};e=[];for(var h=a.scenes,k=0;k<a.scenes.length;k++){var l=h[k];if(l.k.ob&&(l=l.k.ob.qm)&&"FILE"===l.source){var n=l.uuid,m=ra.Rj(V(b.s)+l.filepath);e.push([n,l.Ac?F.AT_ARRAYBUFFER:F.AT_IMAGE_ELEMENT,m]);f[n]=l}}e.length?F.enqueue(e,function(d,e,g,k){if(d){c(d,k,!0);e=f[e];k=t(e,a.textures);for(g=0;g<k.length;g++){var l=k[g];La.nk(l.k,d,e.Ac,l.image.filepath,
b.id)}for(g=0;g<h.length;g++)if(k=h[g],k.k.ob.qm===e){var n=d,m=document.createElement("canvas"),l=e.size[0],p=e.size[1];m.width=l;m.height=p;m=m.getContext("2d");m.drawImage(n,0,0);n=m.getImageData(0,0,l,p).data;m=new Float32Array(4);m[0]=1/16581375;m[1]=1/65025;m[2]=1/255;m[3]=1;for(var l=l*p,p=new Float32Array(l),O=0;O<l;O++)p[O]=m[1]*n[4*O+2]+m[2]*n[4*O+3];k.k.lp=p}}},function(){g(b,d)}):g(b,d)}function S(a,b,d,e,g){if(Ea.antialiasing&&Ea.smaa){e=a.scenes[0];a=[];for(var f=["SMAA_EDGE_DETECTION",
"SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],h=0;h<f.length;h++){var k=Aa.ea(e,f[h]);k&&a.push(k)}if(a.length){e=[];h=F.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",h,da.fc.smaa_search_texture_path]);e.push(["AREA_TEXTURE",h,da.fc.smaa_area_texture_path]);for(h=0;h<a.length;h++)if(f=a[h],"SMAA_BLENDING_WEIGHT_CALCULATION"==f.type){a=f.sa;for(h=0;h<a.length;h++)if(f=a[h],"u_search_tex"==f.ya)var l=f.Ba;else if("u_area_tex"==f.ya)var n=f.Ba;break}e.length?F.enqueue(e,
function(a,d,e,g){a&&(c(a,g,!1),d="SEARCH_TEXTURE"==d?l:n,d.source="IMAGE",d.Iq=!0,La.nk(d,a,-1!=g.indexOf(".dds")?1:0,g,b.id),La.fk(d,La.t,La.t))},function(){g(b,d)}):g(b,d)}else g(b,d)}else g(b,d)}function T(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];a==ya||(e=w());for(var g=E.na(e,"LAMP",b.id),f=0;f<g.length;f++){var h=g[f];h.f.lc==b.id&&d.Mm.push({Xb:e,obj:h})}g=E.na(e,"ALL",b.id);for(f=0;f<g.length;f++)h=g[f],"LAMP"!=h.type&&h.f.lc==b.id&&(b.Ws&&ra.is_mesh(h)&&Aa.hide_object(h),
d.Mm.push({Xb:e,obj:h}))}}function U(a,b,c,d,e,g){var f=d.Mm;e=d.ot;if(f.length){a=f[e].obj;e=f[e].Xb;var h=ia.Ja(a,e);Aa.append_object(e,a,!1);a.anchor&&ba.append(a);d=++d.ot/f.length;"LAMP"==a.type&&E.mD(e);null!=a.f.cd&&Aa.Nu(h.jf,a.f.i);f=a.dk;f.length&&e.k.ki&&(e=h.Gf,Aa.Qu(e,a.f.i,a.f.quat),ia.Ru(f,e.j.gc))}else d=1;g(b,c,d)}function fa(a,b,c,d,e){if(a==ya){a=Aa.nA();d=Aa.Dg();for(var g=0;g<a.length;g++){var f=a[g];Aa.iC(f,d);(f.b4w_use_nla||f.b4w_use_logic_editor)&&qa.lE(f,f.b4w_nla_cyclic,
b.id)}Aa.set_active(d)}else Aa.Qp(w());a=E.get_all_objects(b.id);E.jE(a);e(b,c)}function R(a,b,c,d,e){if(a==ya)for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||J(a.scenes[d]),A(a.scenes[d],b.id);else a.scenes[0].b4w_use_nla||J(w()),A(w(),b.id);e(b,c)}function W(a,b,c,d,e){Ea.Ig&&(b.jo||b.io||b.no)?ab||aa(a,e,b,c):e(b,c)}function aa(a,b,c,d){var e=Vb.parentElement;Ec=e.style.zIndex;e.style.zIndex="999";ab=document.createElement("div");ab.style.position="relative";ab.style.height="88px";ab.style.width=
"88px";var g=Math.round(Vb.offsetWidth/2-44);ab.style.top=Math.round(Vb.offsetHeight/2-44).toString()+"px";ab.style.left=g.toString()+"px";ab.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC')";
ab.style.backgroundSize="88px";xa=document.createElement("div");xa.style.position="relative";xa.style.height=Vb.offsetHeight.toString()+"px";xa.style.width=Vb.offsetWidth.toString()+"px";xa.style.background="rgba(0, 0, 0, 0.5)";xa.style.zIndex="999";e.appendChild(xa);xa.appendChild(ab);ab.addEventListener("click",function(){c.jo&&(La.play(),La.pause(),La.reset());if(c.io){if(a==ya)for(var e=0;e<a.scenes.length;e++)A(a.scenes[e],c.id,!0);else A(w(),c.id,!0);pa.pause()}c.no&&pa.cC();Q();b(c,d)},!1)}
function Q(){if(ab){var a=Vb.parentElement;a.style.zIndex=Ec;xa.removeChild(ab);a.removeChild(xa);ab=xa=null;Ec=0}}function V(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function oa(a,b,c){ea.is_animated(b)&&ea.remove(b);E.clear_outline_anim(b);P.check_sensor_manifold(b)&&P.remove_sensor_manifold(b);ta.K(b)&&ta.qC(b);Aa.rC(a,b,c);pa.Ee(b)&&pa.pD(b);ba.is_anchor(b)&&ba.remove(b)}function ca(a,b){if(!na[b]){for(var c=a.scenes,d=[],e=0;e<c.length;e++)ka(c[e].objects,0,a==ya,d);na[b]=
[];for(e=0;e<d.length;e++)for(var c=d[e],g=0;g<c.length;g++)for(var f=c[g],h=0;h<f.length;h++)na[b].push(f[h])}return na[b]}function ka(a,b,c,d){d[b]=d[b]||[];for(var e=d[b],g=0;g<a.length;g++){var f=a[g],h=la(f);e[h]=e[h]||[];(c||-1==qc.indexOf(f.type))&&-1==e[h].indexOf(f)&&e[h].push(f);(f=f.dupli_group)&&ka(f.objects,b+1,c,d)}}function la(a){return(a=a.parent||ea.$r(a))?1+la(a):0}var ba=q("__anchors"),ea=q("__animation"),F=q("__assets"),I=q("__batch");q("__camera");var da=q("__config"),P=q("__controls"),
ua=q("__dds"),ma=q("__extensions");q("__lights");var ha=q("__loader"),ga=q("__mat4"),Y=q("__md5"),qa=q("__nla"),O=q("__nodemat"),E=q("__objects"),ia=q("__obj_util"),ta=q("__physics"),Z=q("__print"),Gb=q("__reformer"),kb=q("__renderer"),Aa=q("__scenes"),pa=q("__sfx"),yc=q("__shaders"),La=q("__textures"),Ub=q("__transform"),ra=q("__util"),ub=q("__vec4"),Ea=da.q,Wb=da.Kd,Qa=da.m,vb=da.me,ja=da.w,wb=null,na=null,ec="",ya=null,ob={},ab=null,xa=null,Ec=0,qc=["LAMP","CAMERA"],Hb=["MESH","CAMERA","EMPTY"],
Vb=null;a.is_primary_loaded=function(a){return ha.is_primary_loaded(a)};a.update=function(){ha.mE(wb)};a.cD=function(a){Vb=a};a.hE=function(a,b){if(ab){xa.style.height=b.toString()+"px";xa.style.width=a.toString()+"px";var c=Math.round(a/2-44);ab.style.top=Math.round(b/2-44).toString()+"px";ab.style.left=c.toString()+"px"}};a.load=function(a,c,h,n,O){var E={load_main:{Ra:ha.he,ab:!1,C:[],fb:!1,hb:500,rb:!1,mb:b},duplicate_objects:{Ra:ha.qd,ab:!1,C:["load_main"],fb:!1,hb:50,rb:!1,mb:C},load_binaries:{Ra:ha.he,
ab:!1,C:["load_main"],fb:!1,hb:500,rb:!1,mb:l},wait_for_shaders:{Ra:ha.he,ab:!0,C:[],fb:!1,hb:50,rb:!0,gf:f},prepare_bindata:{Ra:ha.qd,ab:!1,C:["duplicate_objects","load_binaries"],fb:!1,hb:0,rb:!1,mb:k},prepare_bpy_data:{Ra:ha.qd,ab:!1,C:["duplicate_objects","prepare_bindata"],fb:!1,hb:100,rb:!1,mb:e},create_b4w_data:{Ra:ha.qd,ab:!1,C:["prepare_bpy_data"],fb:!1,hb:100,rb:!1,mb:g},prepare_b4w_data:{Ra:ha.qd,ab:!1,C:["create_b4w_data","wait_for_shaders"],fb:!1,hb:300,rb:!1,mb:p},load_smaa_textures:{Ra:ha.he,
ab:!0,C:["prepare_b4w_data"],fb:!1,hb:10,rb:!0,mb:S},load_shoremap:{Ra:ha.he,ab:!0,C:["prepare_b4w_data"],fb:!1,hb:10,rb:!0,mb:x},load_textures:{Ra:ha.he,ab:!0,C:["prepare_b4w_data"],fb:!0,hb:500,rb:!1,mb:m,lg:{Bs:0}},wait_physics_workers:{Ra:ha.he,ab:!0,C:["load_shoremap"],fb:!1,hb:20,rb:!1,gf:y},add_physics_objects:{Ra:ha.qd,ab:!1,C:["wait_physics_workers"],fb:!1,hb:20,rb:!1,mb:K},add_objects:{Ra:ha.qd,ab:!1,C:["add_physics_objects"],fb:!1,hb:800,rb:!1,mb:T,gf:U,cj:fa,lg:{Mm:[],ot:0}},load_speakers:{Ra:ha.he,
ab:!0,C:["add_objects"],fb:!0,hb:30,rb:!1,mb:z,lg:{nD:0}},mobile_media_start:{Ra:ha.qd,ab:!Ea.Ig,C:["load_textures","load_speakers"],fb:!0,hb:5,rb:!1,mb:W,gf:W},synchronize_media:{Ra:ha.qd,ab:!0,C:["mobile_media_start"],fb:!0,hb:70,rb:!1,mb:R},start_nla:{Ra:ha.qd,ab:!0,C:["mobile_media_start"],fb:!1,hb:5,rb:!1,mb:N}},r=ha.ls();r||(r=ha.Hy(),wb={},na={},ob={});wb[r.de.length]={};return ha.Py(E,a,c,h,d,n||ja.Fq,Ea.do_not_load_resources,O)};a.unload=function(a){var b=ha.ls();if(!b||!b.de.length||a&&
!ha.KD(b.de[a]))Z.error("Unable to unload data!");else{if(0==a)Z.log("%cUNLOAD ALL","color: #00a"),ba.cleanup(),ea.cleanup(),pa.cleanup(),qa.cleanup(),Aa.cleanup(),ha.cleanup(),ta.cleanup(),E.cleanup(),ra.cleanup(),kb.cleanup(),O.cleanup(),yc.cleanup(),P.cleanup(),ma.cleanup(),F.cleanup(),La.cleanup(),na=null,ob={},wb=ya=null;else{Z.log("%cUNLOAD DATA "+a,"color: #00a");ea.pC(a);for(var b=Aa.Qh(),c=0;c<b.length;c++)for(var d=b[c],e=E.na(d,"ALL",a),g=e.length-1;0<=g;g--){var f=e[g];oa(d,f,!0);e.splice(g,
1);var h=E.na(d,f.type,a),f=h.indexOf(f);-1!=f&&h.splice(f,1)}}Q()}};a.hC=oa;a.set_debug_resources_root=function(a){ec=a}};b4w.module.__batch=function(a,q){function d(a){a={type:a,Sa:"",id:0,sC:0,hi:"",S:[],Ob:[],Kc:[],ij:[],ph:null,Ab:{},ic:null,Xa:{Ni:null,Nh:null,mf:[],Af:[]},Eq:[],eH:null,R:null,ad:null,fe:!1,sg:!1,xr:!1,wireframe_mode:0,num_vertices:0,num_triangles:0,Ns:0,Os:0,os:0,co:0,nc:new Float32Array(3),Ec:new Float32Array(16),Ha:!1,fr:!1,ca:!1,Xe:!1,Ua:!1,$b:!1,Rd:!1,Sc:!1,vc:!1,wc:!1,hc:!1,Wb:!1,sc:!1,Eb:!1,Et:!1,xe:W.Ri,Ze:W.je,zg:!1,lC:"",mH:"",qs:!1,us:0,rs:0,vs:0,ws:0,ts:new Float32Array(3),ss:new Float32Array(3),
Eg:!1,le:0,ye:0,lf:1,reflect_factor:0,qu:0,rp:1,parallax_scale:0,kf:0,bf:1,it:0,Jo:0,Yg:0,Nt:0,Gc:Array(2),xc:new Float32Array(3),Sf:new Float32Array(3),$d:new Float32Array(3),ed:new Float32Array(4),xd:new Float32Array(4),Kg:null,xo:null,vo:null,uo:null,wo:null,Th:!1,Zf:!1,water_dynamic:!1,Dm:!1,fv:!1,gv:0,hv:0,ev:0,Pi:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,Qr:new Float32Array(2),Pr:new Float32Array(2),Pn:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
Xg:null,dp:!1,ra:null};a.ed[3]=1;a.fr=!0;a.ca=!0;return a}function c(a){switch(a.type){case "MAIN":case "PARTICLES":a.Sa=a.Ha?a.Xe?"XRAY":"BLEND":"OPAQUE";break;case "DEPTH":a.Sa=a.Th?"NODES":"DEPTH";break;case "COLOR_ID":a.Sa=a.Xe?"COLOR_ID_XRAY":"COLOR_ID"}}function b(a){var b=a.R;a.R=null;var c=V.pg(a);a.R=b;c.R=b;return c}function l(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],g=e.J,f=e.f,h=S.pd();S.cl(f.Ah,h);var l=g.data.b4w_bounding_cylinder_radius,m=g.data.b4w_bounding_sphere_radius,p=
g.data.b4w_bounding_sphere_center,r=g.data.b4w_bounding_ellipsoid_axes,g=g.data.b4w_bounding_ellipsoid_center;if(f.sd){var l=Math.max(Math.abs(h.max_x),Math.abs(h.min_x)),m=Math.max(Math.abs(h.max_y),Math.abs(h.min_y)),x=Math.max(Math.abs(h.max_z),Math.abs(h.min_z)),x=Math.sqrt(l*l+m*m+x*x),l=Math.sqrt(l*l+m*m);h.max_x=h.max_y=h.max_z=x;h.min_x=h.min_y=h.min_z=-x;m=x;p[0]=p[1]=p[2]=0;r[0]=r[1]=r[2]=x;g[0]=g[1]=g[2]=0}f.Ib=h;x=S.cn(h,f.Z);f.lb=x;n(f,l,l,h);h=S.el(m,p);f.bd=h;h=S.en(h,f.Z);f.Jb=h;r=
S.dl([r[0],0,0],[0,r[1],0],[0,0,r[2]],g);f.ef=r;r=S.dn(r,f.Ma);f.ig=r;c=c.concat(k(e,f,b))}return c}function f(a,b,c){for(var d=[],e=[],g={},f=0;f<a.length;f++){var h=a[f],l=h.J,n=h.f,m=S.pd();S.cl(n.Ah,m);var p=S.cn(m,n.Z),r=S.el(l.data.b4w_bounding_sphere_radius,l.data.b4w_bounding_sphere_center),x=S.en(r,n.Z),F=l.data.b4w_bounding_ellipsoid_axes,l=S.dl([F[0],0,0],[0,F[1],0],[0,0,F[2]],l.data.b4w_bounding_ellipsoid_center),F=S.dn(l,n.Ma);n.Ib=m;n.lb=p;n.bd=r;n.Jb=x;n.ef=l;n.ig=F;m={};m.Sc=n.Sc;
m.vc=n.vc;m.wc=n.wc;m.jh=n.jh;m.Vl=n.Vl;m.Mb=n.Mb;m.Ul=n.Ul;m.Tj=n.Tj;m.hc=n.hc;m.Wb=n.Wb;m.sc=n.sc;m.cd=n.cd;m.Oc=n.Oc;m.Xd=n.Xd;m.qe=n.qe;m.Zc=n.Zc;m.Ge=n.Ge;m.Tb=n.Tb;m.sd=n.sd;m.$i=n.$i;m.Zi=n.Zi;m.Eb=n.Eb;m.Gh=n.Gh;m.kl=n.kl;m.He=n.He;m.Sg=n.Sg;m.Ll=n.Ll;m.Lc=n.Lc;m.Rg=n.Rg;m.Ml=n.Ml;m.Rd=n.Rd;p=n.Jb.F;m.AA=0==c?[0,0]:[Math.floor(p[0]/c),Math.floor(p[2]/c)];m.xf=n.xf;m.Qj=n.Qj;m.Qg=n.Qg;n=JSON.stringify(m);g[n]=g[n]||[];g[n].push(h)}for(var w in g){m=JSON.parse(w);c=g[w];var h=V.Eh("STATIC"),
q;for(q in m)h[q]=m[q];h.lc=a[0].f.lc;h.ge=0;h.We=0;h.ue=0;h.te=0;h.oe=0;h.Uh=!1;for(f=0;f<c.length;f++)n=c[f],0==f?(h.lb=P.ma(n.f.lb),h.Jb=P.ma(n.f.Jb),h.ef=P.ma(n.f.ef),h.ig=P.ma(n.f.ig)):(S.Hr(h.lb,n.f.lb),S.pz(h.Jb,n.f.Jb));h.Ib=P.ma(h.lb);h.bd=P.ma(h.Jb);e.push({f:h,Ke:c})}for(a=0;a<e.length;a++)for(g=e[a].f,f=e[a].Ke,w=0;w<f.length;w++){q=f[w];c=q.J;h=k(q,g,b);q.f.sd&&!q.f.$m?(n=da.create(),da.set_trans(q.f.i,n)):(n=q.f,n=da.create_sep(n.i,n.scale,n.quat));m={};if(g.Zc||g.sd)m.au_center_pos=
[n[0],n[1],n[2]];g.Zc&&(m.au_wind_bending_amp=[q.f.ge],m.au_wind_bending_freq=[c.b4w_wind_bending_freq],m.au_detail_bending_amp=[c.b4w_detail_bending_amp],m.au_detail_bending_freq=[c.b4w_detail_bending_freq],m.au_branch_bending_amp=[c.b4w_branch_bending_amp]);for(p=0;p<h.length;p++)l=h[p].f,r=h[p].Uc,x=h[p].D,l.Gl?l.sd?W.DD(r,n):W.Au(r,n):("COLOR_ID"==x.type&&(l=h[p].f=q.f,x.hi=c.uuid,G(x,l),N(x,P.Ch(l,0))),r=W.Au(r,n),W.CD(r,m));d=d.concat(h)}return d}function k(a,b,c){var g=a.J,f=[],h=r(c,b),k=
P.Ch(b,0),l=g.data,n=l.materials,m=Array(n.length),p=ea.Wa(c,"MAIN_OPAQUE"),x=!1;p&&(x=p.wf.length?!0:!1);for(var w=0;w<h.length;w++){var q=h[w];if(!g.b4w_do_not_render||"PHYSICS"==q)for(var v=0;v<n.length;v++){var y=n[v];if(("LENS_FLARES"!=y.name||x)&&!W.xs(l,v)){var t=d(q);"MAIN"==q&&(m[v]=t);if(J(t,y)){"DEPTH"==q&&m[v]&&(t.$b=m[v].$b);t.xe=b.fe||b.Rd?W.yk:W.Ri;G(t,b);for(var u=t,I=g.particle_systems,C=0;C<I.length;C++){var da=I[C].settings.b4w_vcol_from_name,B=I[C].settings.b4w_vcol_to_name;""!==
da&&""!==B&&(u.Ab[da]={Cg:!1,src:[{name:da,kd:7}]})}"DYNAMIC"==b.type&&(t.hi=g.uuid);N(t,k);var H=W.Kr(l,v,t.ij,t.ad,t.Ab,t.ph);"LENS_FLARES"==y.name&&(H=oa.gC(H));f.push({D:t,Uc:H,pc:[y.name],f:b,Cd:[a]})}}}}var D=g.particle_systems;if(0<D.length&&f.length){for(var M=!1,S=!1,w=0;w<D.length;w++){var K=D[w],T=K.settings;T.use_render_emitter&&(M=!0);"HAIR"!=T.type||"OBJECT"!=T.render_type&&"GROUP"!=T.render_type&&K.transforms.length||(S=!0);if(M&&S)break}var L=f[0].D.Ab,U;if(S){var ma;if(1<n.length){for(var ka=
{},R=0;R<D.length;R++){var Q=D[R].settings;if("HAIR"==Q.type&&("OBJECT"==Q.render_type||"GROUP"==Q.render_type)){var ga=Q.b4w_vcol_from_name,ba=Q.b4w_vcol_to_name;""!==ga&&""!==ba&&(ka[ga]=P.ma(L[ga]))}}"a_bending_col_main"in L&&(ka.a_bending_col_main=P.ma(L.a_bending_col_main));"a_bending_col_detail"in L&&(ka.a_bending_col_detail=P.ma(L.a_bending_col_detail));ma=W.Lr(l,[],ka)}else ma=f[0].Uc;U=ma}else U=null;for(var Y,V=U,aa=a.J,qa=[],ca=aa.particle_systems,lb=aa.data,zc=0;zc<ca.length;zc++){var fb=
ca[zc],Ta=fb.settings;if(Ta.count)if("EMITTER"==Ta.type){if("DYNAMIC"==b.type){var Va=d("PARTICLES"),gb,ib=lb.materials,Nb=fb.settings.material-1;Nb>=ib.length&&(fa.warn('Wrong material used for rendering particle system "'+fb.name+'"'),Nb=0);gb=ib[Nb];"HALO"===fb.settings.render_type&&(Va.Eg=!0);e(Va,gb);var Fa=Va,va=fb.settings;switch(va.b4w_billboard_align){case "VIEW":z(Fa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":z(Fa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":z(Fa,
"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":z(Fa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}z(Fa,"BILLBOARD",0);z(Fa,"SOFT_PARTICLES",va.b4w_enable_soft_particles&&0<va.b4w_particles_softness&&ha.pj?1:0);z(Fa,"SOFT_STRENGTH",F.r(va.b4w_particles_softness));F.I(Fa.Xa,"WORLD_SPACE","WORLD"==va.b4w_coordinate_system?1:0);Va.Rd=!0;Va.hi=a.name+"_"+Ta.uuid;Va.lC=fb.name;N(Va,k);oa.JA(Va,fb,gb);var gc=oa.Mz(Va,lb,fb,a.f.Ma);qa.push({D:Va,Uc:gc,
pc:[gb.name],f:b,Cd:[a]})}}else if("HAIR"==Ta.type){var Ab=P.Bl(fb.seed);Ta.b4w_dynamic_grass&&(b.Gh=!0);var wa=la.ar(ha.Do)&&!Ta.b4w_initial_rand_rotation&&!Ta.b4w_hair_billboard,Wa=4;wa&&(Wa=8);if(fb.transforms.length)var X=fb.transforms;else for(var Ja=W.Wn(V,Ta.count,!1,Ab),X=new Float32Array(Ja.length*Wa),Ba=0;Ba<Ja.length;Ba++){var Ca=.75+.5*P.md(Ab);X[Ba*Wa]=Ja[Ba][0];X[Ba*Wa+1]=Ja[Ba][1];X[Ba*Wa+2]=Ja[Ba][2];X[Ba*Wa+3]=Ca;wa&&(X[Ba*Wa+4]=1,X[Ba*Wa+5]=0,X[Ba*Wa+6]=0,X[Ba*Wa+7]=0)}var za=ea.Wa(c,
"GRASS_MAP")?!0:!1;if("OBJECT"==Ta.render_type)var Oa=[r(c,Ta.dupli_object.Db.f,!0)],hc=A(a,b,L,V,[Ta.dupli_object.Db],Oa,[X],Ta,fb,za,Ab,!1),qa=qa.concat(hc);else if("GROUP"==Ta.render_type){for(var Ra=[],Mb=Ta.dupli_group.objects,Ba=0;Ba<Mb.length;Ba++)Ra.push(Mb[Ba].Db);for(var zb=!1,Oa=[],Ba=0;Ba<Ra.length;Ba++){var nb=r(c,Ta.dupli_group.objects[Ba].Db.f,!0);Oa.push(nb)}if(Ta.use_whole_group){for(var rc,mb=X,ic=Ra,hb=wa,Ac=Wa,qb={},Bb=new Float32Array([0,0,0,1]),Ma=0;Ma<mb.length;Ma+=Ac)for(var Ya=
0;Ya<ic.length;Ya++){var bb=ua.create();ua.scale(ic[Ya].f.i,ic[Ya].f.scale,bb);var Yb=ua.clone([mb[Ma],mb[Ma+1],mb[Ma+2]]);qb[Ya]||(qb[Ya]=new Float32Array(mb.length));hb&&(qb[Ya][Ma+4]=Bb[0]=mb[Ma+4],qb[Ya][Ma+5]=Bb[1]=mb[Ma+5],qb[Ya][Ma+6]=Bb[2]=mb[Ma+6],qb[Ya][Ma+7]=Bb[3]=mb[Ma+7],P.$o(Bb,Bb),P.OD(bb,Bb,bb));ua.add(Yb,bb,Yb);qb[Ya][Ma]=Yb[0];qb[Ya][Ma+1]=Yb[1];qb[Ya][Ma+2]=Yb[2];qb[Ya][Ma+3]=mb[Ma+3]}rc=qb;zb=!0}else{var jc;if(Ta.use_group_count){for(var Za=X,Fc=Ra,Bc=Ta.dupli_weights,Cb=Ab,sc=
wa,Ib=Wa,rb={},sb=[],Da=0;Da<Fc.length;Da++)for(var Ga=Fc[Da],sa=Ga.Ro||Ga.name,cb=0;cb<Bc.length;cb++){var Ha=Bc[cb];sa==Ha.name.split(": ")[0]&&sb.push(Ha)}Bc.length!=sb.length&&fa.error("dupli weights match failed");for(Da=0;Da<Za.length;Da+=Ib){for(var xb,Pa=sb,Db=[0],db=0;db<Pa.length;db++)Db[db+1]=Db[db]+Pa[db].count;for(var mc=Db[Db.length-1]*P.md(Cb),Zb=0,db=0;db<Db.length;db++)if(mc>=Db[db]&&mc<Db[db+1]){Zb=db;break}xb=Zb;rb[xb]=rb[xb]||[];rb[xb].push(Za[Da],Za[Da+1],Za[Da+2],Za[Da+3]);sc&&
rb[xb].push(Za[Da+4],Za[Da+5],Za[Da+6],Za[Da+7])}for(xb in rb)rb[xb]=new Float32Array(rb[xb]);jc=rb}else{for(var Xa=X,nc=Ab,tc=wa,kc=Wa,Jb=Ra.length,jb={},eb=0;eb<Xa.length;eb+=kc){var Ia=Math.floor(Jb*P.md(nc));jb[Ia]=jb[Ia]||[];jb[Ia].push(Xa[eb],Xa[eb+1],Xa[eb+2],Xa[eb+3]);tc&&jb[Ia].push(Xa[eb+4],Xa[eb+5],Xa[eb+6],Xa[eb+7])}for(Ia in jb)jb[Ia]=new Float32Array(jb[Ia]);jc=jb}rc=jc}hc=A(a,b,L,V,Ra,Oa,rc,Ta,fb,za,Ab,zb);qa=qa.concat(hc)}"INSTANCE"==Ta.b4w_wind_bend_inheritance&&a.f.Zc&&fa.warn('Emitter object "'+
a.name+"\" has a particle system with wind bending inheritance from the particle instance. Wind bending on the emitter isn't disabled. Expect unforeseen behavior.")}else throw"Unknown particle settings type";}Y=qa;f=M?f.concat(Y):Y}return f}function n(a,b,c,d){a.Xm=S.pr(b,d);a.Vm=S.nr(c,d);a.Wm=S.or(b,d)}function r(a,b,c){var d=["MAIN","NODES_GLOW"];(b.jh&&ea.Wa(a,"COLOR_PICKING")||b.Mb&&ea.Wa(a,"OUTLINE_MASK"))&&!c&&d.push("COLOR_ID");ea.Wa(a,"WIREFRAME")&&d.push("WIREFRAME");d.push("PHYSICS");(ea.Wa(a,
"DEPTH")||ea.Wa(a,"SHADOW_CAST"))&&d.push("DEPTH");ea.Wa(a,"GRASS_MAP")&&d.push("GRASS_MAP");if(b.vc||b.Wb)for(a=null,b.vc&&(a=["MAIN","NODES_GLOW","COLOR_ID","PHYSICS","WIREFRAME"]),b.Wb&&(b=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],a=null!==a?P.px(a,b):b),b=a,a=0;a<b.length;a++)c=d.indexOf(b[a]),-1!==c&&d.splice(c,1);return d}function e(a,b){var c;switch(a.type){case "MAIN":if(b.b4w_do_not_render)c=!1;else{if(b.use_nodes)u(a,b,"MAIN");else{h(a,b);var d=b.game_settings.alpha_blend;a.Xe=b.b4w_render_above_all&&
"OPAQUE"!=d&&"CLIP"!=d;a.Yg=b.offset_z;a.Sf.set([1,1,1]);var e=b.texture_slots;ma.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ed);switch(b.name){case "LENS_FLARES":y(a,"special_lens_flares.glslv","special_lens_flares.glslf");t(a,"a_position");t(a,"a_texcoord");var f=p(e[0],null);K(a,f);break;default:y(a,"main_stack.glslv","main_stack.glslf");b.use_shadeless||(c=Q.tn(b.uuid,b.name,{$b:b.use_shadeless,qj:b.diffuse_shader,ui:b.specular_shader}),a.Xa.Af=Q.al(c));var k=w("use_map_color_diffuse",
e),l=w("use_map_color_spec",e),n=w("use_map_normal",e),m=w("use_map_mirror",e),f=w("use_stencil",e);c=k[0];l=l[0];n=n[0];m=m[0];k=k[1];e=f[0]&&w("use_rgb_to_intensity",e)[0];if(c){switch(c.blend_type){case "MIX":z(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":z(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}f=p(c,null);K(a,f,"u_colormap0");ha.Om&&"CLIP"==d&&I.fk(f,I.zc,I.zc);a.kf=c.diffuse_color_factor;a.bf=c.use_map_alpha?c.alpha_factor:0;a.Sf.set(c.scale)}d=c&&c==
l;l&&(d||(f=p(l,null),K(a,f,"u_specmap0")),a.qu=l.specular_color_factor);if(n&&(t(a,"a_normal"),t(a,"a_tangent"),f=p(n,null),K(a,f,"u_normalmap0"),a.it=n.normal_factor,f=n.texture,f.b4w_use_map_parallax&&ha.Xj)){var r=F.r(f.b4w_parallax_steps),x=F.r(f.b4w_parallax_lod_dist);z(a,"PARALLAX",1);z(a,"PARALLAX_STEPS",r);z(a,"PARALLAX_LOD_DIST",x);a.parallax_scale=f.b4w_parallax_scale}m&&(f=p(m,null),K(a,f,"u_mirrormap"),a.Jo=m.mirror_factor);if(m=c&&k&&e?1:0)f=p(k,null),K(a,f,"u_colormap1"),f=p(e,null),
K(a,f,"u_stencil0");(f=c||l||n)&&a.Sf.set(f.scale);z(a,"TEXTURE_SPEC",void 0==l?0:1);z(a,"ALPHA_AS_SPEC",d?1:0);z(a,"TEXTURE_STENCIL_ALPHA_MASK",m);t(a,"a_position");t(a,"a_normal");(c||l||n)&&t(a,"a_texcoord");if(b.b4w_water){a.Zf=!0;a.water_dynamic=b.b4w_water_dynamic;b.b4w_water_shore_smoothing&&!a.Ha?(fa.warn('Material: "'+b.name+'" is opaque.',"Disabling shore smoothing."),a.Dm=!1):a.Dm=b.b4w_water_shore_smoothing;y(a,"special_water.glslv","special_water.glslf");d=Q.tn(b.uuid,b.name,{$b:!1,qj:b.diffuse_shader,
ui:b.specular_shader});a.Xa.Af=Q.al(d);t(a,"a_position");ha.iv?(t(a,"a_polyindex"),a.ca=!0,a.wireframe_edge_color=[0,0,0],z(a,"DEBUG_WIREFRAME",1)):z(a,"DEBUG_WIREFRAME",0);m=b.texture_slots;d=w("use_map_normal",m);f=w("use_map_mirror",m)[0];d.length&&(r=p(d[0]),K(a,r,"u_normalmap0"),a.Pi=b.b4w_water_norm_uv_velocity);z(a,"NUM_NORMALMAPS",d.length);a.Xg=Array(d.length);for(r=0;r<d.length;r++)a.Xg[r]=new Float32Array(2),a.Xg[r].set([d[r].scale[0],d[r].scale[1]]);f&&(r=p(f),K(a,r,"u_mirrormap"),a.Jo=
f.mirror_factor);f=null;if(ha.Mh)for(r=0;r<m.length;r++){var q=m[r];if(!0===q.texture.b4w_water_foam){f=q;break}}f?(z(a,"FOAM",1),r=p(f),K(a,r,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.Qr.set(f.texture.b4w_foam_uv_freq),a.Pr.set(f.texture.b4w_foam_uv_magnitude),a.Pn[0]=f.scale[0],a.Pn[1]=f.scale[1]):z(a,"FOAM",0);for(r=0;r<m.length;r++)if(q=m[r],!0===q.texture.b4w_shore_dist_map){var v=q;break}v&&ha.Nm?(v=p(v),K(a,v,"u_shore_dist_map"),z(a,"SHORE_PARAMS",1),v=q.texture.b4w_shore_boundings,z(a,"MAX_SHORE_DIST",
F.r(q.texture.b4w_max_shore_dist)),z(a,"SHORE_MAP_SIZE_X",F.r(v[0]-v[1])),z(a,"SHORE_MAP_SIZE_Y",F.r(v[2]-v[3])),z(a,"SHORE_MAP_CENTER_X",F.r((v[0]+v[1])/2)),z(a,"SHORE_MAP_CENTER_Y",F.r((v[2]+v[3])/2))):z(a,"SHORE_PARAMS",0);if(b.b4w_generated_mesh&&ha.pj)z(a,"GENERATED_MESH",1),a.fv=!0,a.gv=b.b4w_water_num_cascads,a.hv=b.b4w_water_subdivs,a.ev=b.b4w_water_detailed_dist;else{t(a,"a_normal");if(f||d.length)t(a,"a_texcoord"),t(a,"a_tangent");z(a,"GENERATED_MESH",0)}if(b.b4w_water_dynamic){var q=F.r(b.b4w_water_dst_noise_scale0),
v=F.r(b.b4w_water_dst_noise_scale1),d=F.r(b.b4w_water_dst_noise_freq0),m=F.r(b.b4w_water_dst_noise_freq1),f=F.r(b.b4w_water_dir_min_shore_fac),r=F.r(b.b4w_water_dir_freq),x=F.r(b.b4w_water_dir_noise_scale),G=F.r(b.b4w_water_dir_noise_freq),da=F.r(b.b4w_water_dir_min_noise_fac),P=F.r(b.b4w_water_dst_min_fac),A=F.r(b.b4w_water_waves_hor_fac);z(a,"DST_NOISE_SCALE_0",q);z(a,"DST_NOISE_SCALE_1",v);z(a,"DST_NOISE_FREQ_0",d);z(a,"DST_NOISE_FREQ_1",m);z(a,"DIR_MIN_SHR_FAC",f);z(a,"DIR_FREQ",r);z(a,"DIR_NOISE_SCALE",
x);z(a,"DIR_NOISE_FREQ",G);z(a,"DIR_MIN_NOISE_FAC",da);z(a,"DST_MIN_FAC",P);z(a,"WAVES_HOR_FAC",A)}B(a,b);H(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;z(a,"ABSORB",F.r(b.b4w_water_absorb_factor));z(a,"SSS_STRENGTH",F.r(b.b4w_water_sss_strength));z(a,"SSS_WIDTH",F.r(b.b4w_water_sss_width))}"HALO"===b.type&&(q=b.halo,y(a,"halo.glslv","halo.glslf"),
z(a,"NUM_RINGS",q.ring_count),z(a,"NUM_LINES",q.line_count),z(a,"NUM_STARS",q.star_tip_count),z(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.ij=["a_position"],a.us=q.size,a.rs=q.hardness/20,a.ts.set(q.b4w_halo_rings_color),a.ss.set(q.b4w_halo_lines_color),a.vs=1/b.b4w_halo_stars_blend_height,a.ws=b.b4w_halo_stars_min_height,a.qs=!0);z(a,"TEXCOORD",0);z(a,"NORMAL_TEXCOORD",0);c&&g(a,c,"TEXTURE_COLOR0_CO");k&&g(a,k,"TEXTURE_COLOR1_CO");e&&g(a,e,"TEXTURE_STENCIL_ALPHA_MASK_CO");l&&g(a,l,"TEXTURE_SPEC_CO");
n&&g(a,n,"TEXTURE_NORM_CO");z(a,"SHADELESS",b.use_shadeless?1:0);z(a,"SHADELESS_MAT",b.use_shadeless?1:0);a.$b=b.use_shadeless}d=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===d?0:1);z(a,"ALPHA_CLIP","CLIP"===d?1:0);z(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(z(a,"VERTEX_COLOR",1),t(a,"a_color")):z(a,"VERTEX_COLOR",0);a.le=b.ambient;a.lf=b.diffuse_intensity;a.ye=b.emit;a.$d.set(b.specular_color);a.rp=b.specular_alpha;B(a,b);H(a,b);b.b4w_wettable?z(a,
"WETTABLE",1):z(a,"WETTABLE",0);C(a,b);a.dp=b.b4w_refractive;a.Nt=b.b4w_refr_bump}c=!0}break;case "NODES_GLOW":c=u(a,b,"GLOW");break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)c=!1;else if(h(a,b),a.Ha)c=!1;else{l=b.game_settings.alpha_blend;b.use_nodes&&"CLIP"==l?u(a,b,"DEPTH"):y(a,"depth.glslv","depth.glslf");t(a,"a_position");t(a,"a_normal");z(a,"ALPHA","OPAQUE"===l?0:1);a.Sf.set([1,1,1]);if((c=w("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===
l){a.Sf.set(c.scale);z(a,"TEXTURE_COLOR",1);t(a,"a_texcoord");if("IMAGE"==c.texture.k.source||"ENVIRONMENT_MAP"==c.texture.k.source)l=p(c),K(a,l,"u_colormap0");"NONE"==c.texture.k.source&&(l=p(c),K(a,l,"u_colormap0"))}else z(a,"TEXTURE_COLOR",0);c=!0}break;case "PHYSICS":b.b4w_collision?(a.rk=b.b4w_use_ghost,a.bb=b.b4w_collision_id,a.gj=b.b4w_collision_margin,a.ej=b.b4w_collision_group,a.hj=b.b4w_collision_mask,a.Aj=b.physics.friction,a.vj=b.physics.elasticity,c=!0):b.b4w_water?(a.Zf=!0,a.SE=b.b4w_water_dynamic,
a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,c=!0):c=!1;
break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_do_not_render||"HALO"===b.type)c=!1;else{h(a,b);a.Ze=W.je;a.ca=!0;a.Ha=!1;l=b.game_settings.alpha_blend;a.Xe=b.b4w_render_above_all&&"OPAQUE"!=l&&"CLIP"!=l;b.use_nodes&&"CLIP"==l?u(a,b,"COLOR_ID"):y(a,"color_id.glslv","color_id.glslf");t(a,"a_position");z(a,"ALPHA","OPAQUE"===l?0:1);a.Sf.set([1,1,1]);if((c=w("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===l){a.Sf.set(c.scale);z(a,"TEXTURE_COLOR",1);t(a,"a_texcoord");if("IMAGE"==c.texture.k.source||
"ENVIRONMENT_MAP"==c.texture.k.source)l=p(c),K(a,l,"u_colormap0");"NONE"==c.texture.k.source&&(l=p(c),K(a,l,"u_colormap0"))}else z(a,"TEXTURE_COLOR",0);c=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?c=!1:(h(a,b),a.Ha=!1,a.Ze=W.je,a.ca=!0,y(a,"grass_map.glslv","grass_map.glslf"),t(a,"a_position"),c=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,l=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.Ab.a_grass_size={Cg:!0,src:[]},c?(a.Ab.a_grass_size.src.push({name:c,
kd:4}),z(a,"DYNAMIC_GRASS_SIZE",1)):z(a,"DYNAMIC_GRASS_SIZE",0),a.Ab.a_grass_color={Cg:!0,src:[]},l?(a.Ab.a_grass_color.src.push({name:l,kd:7}),z(a,"DYNAMIC_GRASS_COLOR",1)):z(a,"DYNAMIC_GRASS_COLOR",0),c=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?c=!1:(y(a,"wireframe.glslv","wireframe.glslf"),t(a,"a_position"),t(a,"a_normal"),t(a,"a_polyindex"),a.ca=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],c=!0);break;case "PARTICLES":if(b.b4w_do_not_render)c=
!1;else{c=b.texture_slots;if(a.Eg)y(a,"particles_color.glslv","particles_color.glslf");else if(y(a,"particles_texture.glslv","particles_texture.glslf"),l=Q.tn(b.uuid,b.name,{$b:!1,qj:b.diffuse_shader,ui:b.specular_shader}),a.Xa.Af=Q.al(l),c=w("use_map_color_diffuse",c)[0]){z(a,"TEXTURE_COLOR",1);switch(c.blend_type){case "MIX":z(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":z(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.kf=c.diffuse_color_factor;a.bf=c.use_map_alpha?
c.alpha_factor:0;c=p(c);K(a,c)}ma.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ed);a.le=b.ambient;a.lf=b.diffuse_intensity;a.ye=b.emit;a.$d.set(b.specular_color);a.rp=b.specular_alpha;t(a,"a_position");t(a,"a_normal");c=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===c?0:1);z(a,"ALPHA_CLIP","CLIP"===c?1:0);z(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);B(a,b);H(a,b);h(a,b);c=b.game_settings.alpha_blend;a.Xe=b.b4w_render_above_all&&"OPAQUE"!=c&&"CLIP"!=c;a.Yg=b.offset_z;
c=!0}break;default:throw"Wrong batch type: "+a.type;}return c}function g(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":z(a,c,"TEXTURE_COORDS_UV_ORCO");z(a,"TEXCOORD",1);break;case "NORMAL":z(a,c,"TEXTURE_COORDS_NORMAL");z(a,"NORMAL_TEXCOORD",1);break;default:z(a,c,0)}}function h(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.Ha=!0;a.Ze=W.oq;a.ca=!0;break;case "ALPHA":a.Ha=!0;a.Ze=W.je;a.ca=!0;break;case "CLIP":a.Ha=!1;a.Ze=W.je;a.ca=!0;break;case "ADD":a.Ha=!0;a.Ze=
W.je;a.ca=!1;break;case "OPAQUE":a.Ha=!1;a.Ze=W.je;a.ca=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.Ua=c.use_backface_culling}function p(a,b){var c=a.texture,d=c.k,c=c.image;d&&b&&c&&I.nk(d,b,c.Ac,c.filepath);return d}function w(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var g=b[e];1==g[a]&&g.texture&&g.texture.k&&c.push(g)}return c}function C(a,b){var c=b.raytrace_transparency;a.xd[0]=c.fresnel;a.xd[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.reflect_factor=c.reflect_factor;
a.xd[2]=c.fresnel;a.xd[3]=1-c.fresnel_factor/5}function B(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":c=b.specular_hardness;break;case "WARDISO":c=b.specular_slope;break;case "TOON":c=b.specular_toon_size;d=b.specular_toon_smooth;break;case "BLINN":c=b.specular_ior;d=b.specular_hardness;break;default:fa.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.xc[0]=b.specular_intensity;a.xc[1]=c;a.xc[2]=d}function H(a,b){switch(b.diffuse_shader){case "LAMBERT":a.Gc[0]=
0;a.Gc[1]=0;break;case "OREN_NAYAR":a.Gc[0]=b.roughness;a.Gc[1]=0;break;case "FRESNEL":a.Gc[0]=b.diffuse_fresnel;a.Gc[1]=b.diffuse_fresnel_factor;break;case "MINNAERT":a.Gc[0]=b.darkness;a.Gc[1]=0;break;case "TOON":a.Gc[0]=b.diffuse_toon_size;a.Gc[1]=b.diffuse_toon_smooth;break;default:fa.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.Gc[0]=0,a.Gc[1]=0}}function u(a,b,c){if(!b.use_nodes||b.b4w_do_not_render)return!1;var d;switch(c){case "MAIN":y(a,"main.glslv",
"main.glslf");d=!1;break;case "GLOW":y(a,"main.glslv","main.glslf");d=!0;break;case "DEPTH":y(a,"depth.glslv","depth.glslf");d=!1;break;case "COLOR_ID":y(a,"color_id.glslv","color_id.glslf"),d=!1}c=Q.ky(b.node_tree,b.uuid,!1,b.name,c);if(!c)return fa.error('Failed to create node graph for material "'+b.name+'", disable nodes'),D(a,b),!0;a.Th=!0;z(a,"NODES",1);z(a,"NODES_GLOW",d?1:0);var e=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===e?0:1);z(a,"ALPHA_CLIP","CLIP"===e?1:0);z(a,"DOUBLE_SIDED_LIGHTING",
b.b4w_double_sided_lighting?1:0);t(a,"a_position");b.use_orco_tex_coord&&t(a,"a_orco_tex_coord");h(a,b);a.Yg=b.offset_z;e=b.game_settings.alpha_blend;a.Xe=b.b4w_render_above_all&&"OPAQUE"!=e&&"CLIP"!=e;ma.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ed);a.ye=b.emit;a.le=b.ambient;C(a,b);b.b4w_wettable?z(a,"WETTABLE",1):z(a,"WETTABLE",0);a.Xa.Af=Q.al(c);var g=!1;aa.W(c,function(b,c){switch(c.type){case "UVMAP":case "TEX_COORD_UV":case "GEOMETRY_UV":case "UV_MERGED":var d=
c.data.name,f=c.data.value;a.ph||(a.ph={});a.ph[f]=d;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":d=c.data.name;a.Ab[d]={Cg:!0,src:[{name:c.data.value}]};f=0;if("GEOMETRY_VC"==c.type)f=7;else for(var h=0;h<c.qa.length;h++){var l="RGB".indexOf(c.qa[h].identifier);-1<l&&(f|=1<<2-l)}a.Ab[d].src[0].kd=f;break;case "TEX_COORD_NO":case "GEOMETRY_NO":t(a,"a_normal");break;case "MATERIAL_BEGIN":d=c.data.value;t(a,"a_normal");z(a,"SHADELESS_MAT",d.$b?1:0);a.$b=d.$b;
g=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":d=c.data.name;f=c.data.value;!1!==f.k.Gk&&(f.k.Gk="TEXTURE_ENVIRONMENT"!=c.type?!0:!1);K(a,f.k,d);ha.Om&&"CLIP"==e&&I.fk(c.data.value.k,I.zc,I.zc);break;case "TEXTURE_NORMAL":case "B4W_PARALLAX":z(a,"CALC_TBN_SPACE",1);t(a,"a_normal");t(a,"a_tangent");d=c.data.name;f=c.data.value;f.k.Gk=!1;K(a,f.k,d);break;case "LAMP":c.data&&(a.Kg=c.data);break;case "B4W_REFRACTION":a.dp=!0}});g||(a.$b=!0);return!0}function D(a,b){switch(a.type){case "DEPTH":y(a,
"depth.glslv","depth.glslf");break;case "COLOR_ID":y(a,"color_id.glslv","color_id.glslf");break;default:y(a,"main_stack.glslv","main_stack.glslf")}z(a,"SHADELESS",1);t(a,"a_position");t(a,"a_normal");ma.set(1,0,1,1,a.ed);if(b){var c=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===c?0:1);z(a,"ALPHA_CLIP","CLIP"===c?1:0);z(a,"VERTEX_COLOR",0);a.Yg=b.offset_z;h(a,b)}return!0}function G(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.Gl?z(a,"AU_QUALIFIER","attribute"):z(a,"AU_QUALIFIER","uniform"),
z(a,"STATIC_BATCH",0)):(z(a,"AU_QUALIFIER","attribute"),z(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(R.sA()?z(a,"WIREFRAME_QUALITY",1):z(a,"WIREFRAME_QUALITY",0),a.sg?(z(a,"DEBUG_SPHERE",1),a.xr?z(a,"DEBUG_SPHERE_DYNAMIC",1):z(a,"DEBUG_SPHERE_DYNAMIC",0)):z(a,"DEBUG_SPHERE",0),z(a,"ALPHA",1));b.fe&&(a.fe=b.fe);b.Zc?(""!==b.Ge?(a.Ab.a_bending_col_main={Cg:!0,src:[{name:b.Ge,kd:4}]},t(a,"a_bending_col_main"),""!==b.Tb.Ss&&""!==b.Tb.Rs&&""!==b.Tb.tt?(a.Ab.a_bending_col_detail={Cg:!0,src:[{name:b.Tb.Ss,
kd:4},{name:b.Tb.Rs,kd:2},{name:b.Tb.tt,kd:1}]},t(a,"a_bending_col_detail"),t(a,"a_normal"),z(a,"DETAIL_BEND",1)):z(a,"DETAIL_BEND",0),z(a,"MAIN_BEND_COL",1)):z(a,"MAIN_BEND_COL",0),z(a,"WIND_BEND",1)):z(a,"WIND_BEND",0);b.Ok?z(a,"BEND_CENTER_ONLY",1):z(a,"BEND_CENTER_ONLY",0);z(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.$m|0);b.sd?z(a,"BILLBOARD",1):z(a,"BILLBOARD",0);b.sd&&b.Gl?z(a,"HAIR_BILLBOARD",1):z(a,"HAIR_BILLBOARD",0);b.Zi?z(a,"BILLBOARD_SPHERICAL",1):z(a,"BILLBOARD_SPHERICAL",0);switch(b.$i){case "RANDOM":z(a,
"BILLBOARD_RANDOM",1);z(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":z(a,"BILLBOARD_RANDOM",0);z(a,"BILLBOARD_JITTERED",1);break;default:z(a,"BILLBOARD_RANDOM",0),z(a,"BILLBOARD_JITTERED",0)}b.Eb&&ha.Nm?z(a,"DYNAMIC_GRASS",1):z(a,"DYNAMIC_GRASS",0);a.Eb=b.Eb;a.Rd=b.Rd;a.Sc=b.Sc;a.vc=b.vc;a.wc=b.wc&&!a.$b&&!(a.Ha&&ha.Cr);a.hc=b.hc;a.Wb=b.Wb;a.sc=b.sc;b.Yh?(t(a,"a_influence"),z(a,"SKINNED",1),b.zj?z(a,"FRAMES_BLENDING",1):z(a,"FRAMES_BLENDING",0),z(a,"MAX_BONES",b.Ie)):(z(a,"SKINNED",0),z(a,"FRAMES_BLENDING",
0));b.Pb?(z(a,"VERTEX_ANIM",1),ha.cv?z(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):z(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):z(a,"VERTEX_ANIM",0);if(b.Yh&&b.Pb)throw"Skinning and vertex animation are mutually exlusive";b.kl?z(a,"DISABLE_FOG",1):z(a,"DISABLE_FOG",0);b.ad&&(a.ad=b.ad);if(a.Th){for(var c=a.Xa.Af,d=b.Sg,e=b.Rg,g=0;g<c.length;g++){var f=c[g];switch(f.id){case "VALUE":var h=f.Zl[0];if(h)for(var l=0;l<d.length;l+=2)if(d[l]==h){f.fd.push(["VALUE_IND",d[l+1]]);break}break;case "RGB":if(h=
f.Zl[0])for(l=0;l<e.length;l+=2)if(e[l]==h){f.fd.push(["RGB_IND",e[l+1]]);break}}}z(a,"NUM_VALUES",b.He.length);z(a,"NUM_RGBS",b.Lc.length)}}}function v(a,b,c){if(b.length){var d=V.Zn(b)||b[0],e=a.Xa;if(a.Kg){var g=0,f;for(f in a.Kg)g++;a.xo=new Float32Array(3*g);a.vo=new Float32Array(3*g);a.uo=new Float32Array(3*g);a.wo=new Float32Array(4*g);F.I(e,"NUM_LAMP_LIGHTS",g)}for(g=e=0;g<a.Xa.Af.length;g++)if(f=a.Xa.Af[g],"LIGHTING_LAMP"==f.id){var h=b[e++%b.length],l=h.Ka;"AREA"==l.type&&(h=b[e++%b.length],
l=h.Ka);var k=V.Ja(h,c);if("SPOT"==l.type||"POINT"==l.type)var n=Math.cos(l.Qe/2);if("SPOT"==l.type)var p=l.jk*(1-n);var k=k.Pj,r=h==d?0:-1;f.fd=[["LAMP_TYPE",l.type],["LAMP_IND",k],["LAMP_LIGHT_FACT_IND",Math.floor(k/2)],["LAMP_FAC_CHANNELS",0==k%2?"rg":"ba"],["LAMP_SPOT_SIZE",F.r(n||.01)],["LAMP_SPOT_BLEND",F.r(p||.01)],["LAMP_LIGHT_DIST",F.r(l.distance)],["LAMP_SHADOW_MAP_IND",r]];a.Kg&&m(a,h)}}}function m(a,b){var c=b.J.uuid;if(c in a.Kg){c=a.Kg[c];a.xo.set(b.f.i,3*c);a.vo.set(b.Ka.direction,
3*c);a.uo.set(b.Ka.$k,3*c);var d=qa,e=b.Ka;d[0]=-1;d[1]=-1;d[2]=-1;d[3]=e.oh?1:0;switch(e.type){case "POINT":d[2]=e.distance;break;case "SPOT":d[2]=e.distance;var g=d[0]=Math.cos(e.Qe/2);d[1]=e.jk*(1-g)}a.wo.set(d,4*c)}}function t(a,b){var c=a.ij;-1==c.indexOf(b)&&c.push(b)}function z(a,b,c){F.I(a.Xa,b,c)}function L(a,b){if("PHYSICS"==a.type)a.Uc=b;else{var c=a.Ze,d=a.xe;a.qs&&(b=W.vz(b));a.fv&&(b=ca.Rz(a.gv,a.hv,a.ev));c=W.FD(b,c,d,a.Ab);a.R=c;a.Rd||c.Al||a.fe||(c.uf=null,c.Yc=null);c=b.B.length;
a.num_vertices=b.P*c;a:switch(a.xe){case W.Ri:case W.zk:case W.yk:d=!0;break a;default:d=!1}d?W.RA(b)?a.num_triangles=b.oa.length/3*c:a.num_triangles=b.P/3*c:a.num_triangles=0}}function A(a,b,c,e,g,f,h,l,k,n,m,p){var r=[],x=l.b4w_dynamic_grass;if(!n&&x)return r;for(var F="INSTANCE"==l.b4w_wind_bend_inheritance,w="INSTANCE"==l.b4w_shadow_inheritance,q="INSTANCE"==l.b4w_reflection_inheritance,v=[],y=[],t=0;t<g.length;t++){var u=g[t],I=P.dj(b);I.sd=l.b4w_hair_billboard;I.$i=l.b4w_hair_billboard_type;
I.Zi="SPHERICAL"==l.b4w_hair_billboard_geometry;I.Eb=x;I.Gl=!0;I.He=u.f.He;I.Sg=u.f.Sg;I.Lc=u.f.Lc;I.Rg=u.f.Rg;F?(I.Zc=u.f.Zc,I.uk=u.f.uk,I.We=u.f.We,I.ue=u.f.ue,I.Ge=u.f.Ge,I.te=u.f.te,I.oe=u.f.oe,I.ge=u.f.ge,I.Tb=u.f.Tb,I.Ok=!1):(I.Zc=a.f.Zc,I.uk=a.f.uk,I.We=a.f.We,I.ue=a.f.ue,I.Ge=a.f.Ge,I.te=a.f.te,I.oe=a.f.oe,I.ge=a.f.ge,I.Tb=a.f.Tb,I.Ok=!0);w?(I.Sc=u.f.Sc,I.vc=u.f.vc,I.wc=u.f.wc):(I.Sc=a.f.Sc,I.vc=a.f.vc,I.wc=a.f.wc);q?(I.hc=u.f.hc,I.Wb=u.f.Wb,I.sc=u.f.sc,I.cd=u.f.cd,I.Oc=u.f.Oc,I.Xd=u.f.Xd):
(I.hc=a.f.hc,I.Wb=a.f.Wb,I.sc=a.f.sc,I.cd=a.f.cd,I.Oc=a.f.Oc,I.Xd=a.f.Xd);v.push(I);var C=h[t];C||(C=new Float32Array);p&&P.Bl(k.seed,m);var z=new Float32Array(3),B=new Float32Array([0,0,0,1]),A=[],H=la.ar(ha.Do)&&!l.b4w_initial_rand_rotation&&!l.b4w_hair_billboard,D=4;H&&(D=8);for(var M=0;M<C.length;M+=D){z[0]=C[M];z[1]=C[M+1];z[2]=C[M+2];var S=C[M+3]*u.f.scale;if(l.b4w_initial_rand_rotation){switch(l.b4w_rotation_type){case "XYZ":var K=new Float32Array([P.md(m),P.md(m),P.md(m)]);ua.normalize(K,
K);break;case "Z":K=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+l.b4w_rotation_type;}ka.setAxisAngle(K,l.b4w_rand_rotation_strength*(2*Math.PI*P.md(m)-Math.PI),B)}else H&&(B.set(C.subarray(M+4,M+8)),P.$o(B,B),l.use_whole_group||(l.use_rotation_dupli?ka.multiply(B,u.f.quat,B):ka.multiply(B,Y,B)));var T=da.create_sep(z,S,B);A.push(T)}y.push(A)}for(var L={},t=0;t<g.length;t++){var u=g[t],U=u.J,R=f[t],I=v[t],Q={};I.Zc&&(Q.au_wind_bending_amp=[I.ge],Q.au_wind_bending_freq=
[I.We],Q.au_detail_bending_freq=[I.ue],Q.au_detail_bending_amp=[I.te],Q.au_branch_bending_amp=[I.oe],I.ge=0,I.We=0,I.ue=0,I.te=0,I.oe=0);var ga=P.Ch(I,0),A=y[t];if(A.length)for(var ba=U.data,ea=ba.materials,V=Array(ea.length),M=0;M<ea.length;M++)if(!W.xs(ba,M))for(var aa=0;aa<R.length;aa++){var qa=R[aa],ca=d(qa),oa=ea[M];"MAIN"==qa&&(V[M]=ca);if(J(ca,oa)){"DEPTH"==qa&&V[M]&&(ca.$b=V[M].$b);ca.xe=W.Ri;G(ca,I);ca.hi=l.uuid;"JITTERED"==l.b4w_hair_billboard_type&&(ca.Ns=l.b4w_hair_billboard_jitter_amp,
ca.Os=l.b4w_hair_billboard_jitter_freq);x&&(ca.os=l.b4w_dynamic_grass_scale_threshold);F||(delete ca.Ab.a_bending_col_main,delete ca.Ab.a_bending_col_detail);N(ca,ga);var Ta=W.Kr(ba,M,ca.ij,ca.ad,ca.Ab,ca.ph),Va=W.yB(Ta,Q,A),gb=Va,ib=A;gb.M.au_center_pos=new Float32Array(3*gb.P);for(var Nb=ib.length,Fa=gb.P/Nb,va=0;va<Nb;va++)for(var gc=ib[va],Ab=3*Fa*va,wa=0;wa<Fa;wa++)gb.M.au_center_pos[Ab+3*wa]=gc[0],gb.M.au_center_pos[Ab+3*wa+1]=gc[1],gb.M.au_center_pos[Ab+3*wa+2]=gc[2];Va=gb;if(I.Zc&&I.Ok){var Wa=
Va,X=a.f.Z;Wa.M.a_emitter_center=new Float32Array(3*Wa.P);var Ja=ma.fromValues(0,0,0,1);ma.transformMat4(Ja,X,Ja);for(var Ba=0;Ba<Wa.P;Ba++)Wa.M.a_emitter_center[3*Ba]=Ja[0],Wa.M.a_emitter_center[3*Ba+1]=Ja[1],Wa.M.a_emitter_center[3*Ba+2]=Ja[2];Va=Wa}var Ca=l.b4w_vcol_from_name,za=l.b4w_vcol_to_name,Oa=ca,hc=c,Ra=!F,Mb=ba,zb=[];if(""!==Ca&&""!==za){var nb,rc=za,mb=Oa.Ab,ic=[],hb=void 0;for(hb in mb)for(var Ac=mb[hb].src,qb=0,Bb=0;Bb<Ac.length;Bb++){var Ma=Ac[Bb].kd;rc==Ac[Bb].name&&ic.push(hb,Ma,
qb);qb+=P.ih(Ma)}nb=ic;if(0<nb.length)for(var Ya=0;Ya<nb.length;Ya+=3)zb.push({wj:Ca,ol:7,$l:nb[Ya],am:nb[Ya+1],ll:nb[Ya+2]});else W.CA(Oa.ij,"a_color")&&za==Mb.active_vcol_name&&zb.push({wj:Ca,ol:7,$l:"a_color",am:7,ll:0})}Ra&&("a_bending_col_main"in hc&&zb.push({wj:"a_bending_col_main",ol:4,$l:"a_bending_col_main",am:4,ll:0}),"a_bending_col_detail"in hc&&zb.push({wj:"a_bending_col_detail",ol:7,$l:"a_bending_col_detail",am:7,ll:0}));for(var bb=Va,Yb=A,jc=e,Za=zb,Fc=ca.Ab,Bc=!1,Cb=0;Cb<Za.length;Cb++){var sc=
Za[Cb].wj,Ib=jc.M[sc];if(Ib&&0<Ib.length){Bc=!0;break}}if(Bc){var rb,sb=a.f.Ib,Da=jc.B[0].a_position,Ga=Yb,sa=L,cb=new Float32Array(3),Ha=new Float32Array(3),xb=new Uint32Array(Ga.length);if(!("verts_indices"in sa)){sa.re=new Float32Array(3);sa.ne=new Float32Array(3);sa.Yp=new Uint32Array(Da.length/3);sa.Sj=new Uint32Array(Da.length/3);sa.re[0]=(sb.max_x-sb.min_x)/20;sa.re[1]=(sb.max_y-sb.min_y)/20;sa.re[2]=(sb.max_z-sb.min_z)/20;sa.ne[0]=sb.min_x;sa.ne[1]=sb.min_y;sa.ne[2]=sb.min_z;for(var Pa=0;Pa<
Da.length/3;Pa++){var Db=P.trunc((Da[3*Pa]-sa.ne[0])/sa.re[0]),db=P.trunc((Da[3*Pa+1]-sa.ne[1])/sa.re[1]),mc=P.trunc((Da[3*Pa+2]-sa.ne[2])/sa.re[2]),Db=P.clamp(Db,0,19),db=P.clamp(db,0,19),mc=P.clamp(mc,0,19);sa.Yp[Pa]=Pa;sa.Sj[Pa]=mc*Math.pow(20,2)+20*db+Db}W.ou(sa.Sj,sa.Yp,W.Im,!0);sa.qh=new Uint32Array(Math.pow(20,3));for(Pa=0;Pa<sa.Sj.length;Pa++)sa.qh[sa.Sj[Pa]]++;delete sa.Sj;for(Pa=1;Pa<sa.qh.length;Pa++)sa.qh[Pa]+=sa.qh[Pa-1]}for(var Zb=0;Zb<Ga.length;Zb++){cb[0]=Ga[Zb][0];cb[1]=Ga[Zb][1];
cb[2]=Ga[Zb][2];for(var Xa=1E10,nc=-1,tc=P.trunc((cb[0]-sa.ne[0])/sa.re[0]),kc=P.trunc((cb[1]-sa.ne[1])/sa.re[1]),Jb=P.trunc((cb[2]-sa.ne[2])/sa.re[2]),tc=P.clamp(tc,0,19),kc=P.clamp(kc,0,19),Jb=P.clamp(Jb,0,19),jb=Jb*Math.pow(20,2)+20*kc+tc,eb=sa.qh[jb],Ia=0==jb?0:sa.qh[jb-1];Ia<eb;Ia++){var Kb=sa.Yp[Ia];Ha[0]=Da[3*Kb];Ha[1]=Da[3*Kb+1];Ha[2]=Da[3*Kb+2];ua.sub(Ha,cb,Ha);var Na=ua.sqrLen(Ha);Na<=Xa&&(Xa=Na,nc=Kb)}if(-1==nc)for(Ia=0;Ia<Da.length/3;Ia++)Ha[0]=Da[3*Ia],Ha[1]=Da[3*Ia+1],Ha[2]=Da[3*Ia+
2],ua.sub(Ha,cb,Ha),Na=ua.sqrLen(Ha),Na<=Xa&&(Xa=Na,nc=Ia);xb[Zb]=nc}rb=xb;for(var $b=bb.P/Yb.length,Cb=0;Cb<Za.length;Cb++){var yb=Za[Cb].$l,Eb=Za[Cb].am,sc=Za[Cb].wj,Pb=Za[Cb].ol,Ib=jc.M[sc];switch(yb){case "a_bending_col_main":var Qb=1;break;case "a_bending_col_detail":Qb=3;break;case "a_color":Qb=3;break;default:for(var Ua=Qb=0;Ua<Fc[yb].src.length;Ua++)Qb+=P.ih(Fc[yb].src[Ua].kd)}if(Ib&&0<Ib.length){var Cc=P.ih(Pb),ac=P.ih(Eb),lc=Pb&Eb,tb=P.St(lc);lc!=Eb&&fa.error("Wrong color extraction from "+
sc+" to "+yb+".");if("a_bending_col_main"==yb||"a_bending_col_detail"==yb)bb.M[yb]=new Float32Array(bb.P*ac);for(Ua=0;Ua<Yb.length;Ua++){var bc=rb[Ua],uc=bc*Cc,cc=Ua*$b*Qb;if(-1!=bc)for(var Rb=0;Rb<$b;Rb++)for(var vc=Rb*Qb,oc=0;oc<tb.length;oc++)tb[oc]&&(bb.M[yb][cc+vc+(Za[Cb].ll+P.ek(Eb,oc))]=Ib[uc+P.ek(Pb,oc)])}}else bb.M[yb]=new Float32Array(0)}}Va=bb;r.push({D:ca,Uc:Va,pc:[oa.name],f:I,Cd:[a]})}}}return r}function J(a,b){var c=!0;"NODES_GLOW"==a.type&&(c=Q.$q(b));return c=c&&e(a,b)}function N(a,
b){for(var c=null,d=null,e=0;e<a.S.length;e++){var g=a.S[e].pe;g&&(c||(c={}),c[e]=g,a.S[e].pe=null);if(g=a.S[e].Ya)d||(d={}),d[e]=g,a.S[e].Ya=null}a.id=0;a.sC=b;a.id=P.Ch(a,b);if(c)for(var f in c)a.S[f].pe=c[f];if(d)for(f in d)a.S[f].Ya=d[f]}function M(a,b,c,e,g){var f=d("WIREFRAME");y(f,"wireframe.glslv","wireframe.glslf");f.wireframe_mode=0;f.sg=!0;f.ca=!0;f.hi=c;g&&(f.xr=!0);G(f,b);N(f,P.Ch(b,0));e?(b=ca.Vn(1,a.F),W.Ut(b,[a.Ld[0],a.Md[1],a.Nd[2]],a.F)):b=ca.Vn(a.La,a.F);W.um(b,1,!0);b.M.a_polyindex=
W.Nn(b);L(f,b);return f}function y(a,b,c){a.Xa.Ni=b;a.Xa.Nh=c;F.MC(a.Xa)}function K(a,b,c){1==a.S.length&&0==a.Ob.length&&a.Ob.push("default0");c=c||"default"+String(a.S.length);-1==a.Ob.indexOf(c)&&(a.S.push(b),a.Ob.push(c));a.ic&&ba.Cq(a)}function x(a){if(!a.Xa)throw"No shaders info for batch "+a.name;a.ic=F.bA(a.Xa);ba.vx(a.ic);ba.Aq(a);ba.Cq(a)}var S=q("__boundings"),T=q("__camera"),U=q("__config"),fa=q("__print"),R=q("__extensions"),W=q("__geometry"),aa=q("__graph"),Q=q("__nodemat"),V=q("__obj_util"),
oa=q("__particles"),ca=q("__primitives"),ka=q("__quat"),la=q("__reformer"),ba=q("__renderer"),ea=q("__scenegraph"),F=q("__shaders"),I=q("__textures"),da=q("__tsr"),P=q("__util"),ua=q("__vec3"),ma=q("__vec4"),ha=U.q,ga=["MAIN"],Y=new Float32Array([0,-Math.sqrt(.5),0,Math.sqrt(.5)]),qa=new Float32Array(4);a.JG=d;a.Qz=function(a,b,d,e){for(var g=[],h=a.k.nb,k=[],n=[],m=0;m<b.length;m++){var p=b[m];p.so||(V.pa(p)?k.push(p):n.push(p))}for(var m=[],m=m.concat(l(k,h)),n=m=m.concat(f(n,h,a.b4w_batch_grid_size)),
m=[],p=[],r={},h=0;h<n.length;h++){var x=n[h].D,F=n[h].f,w=null;if(x.id in r){for(var q=r[x.id],y=p[q].D,t=p[q].f,u=null,I=null,k=0;k<x.S.length;k++){var G=x.S[k].pe;G&&(u||(u={}),u[k]=G,x.S[k].pe=null);if(G=x.S[k].Ya)I||(I={}),I[k]=G,x.S[k].Ya=null}P.zu(x,y)&&P.zu(F,t)&&(w=p[q]);if(u)for(k in u)x.S[k].pe=u[k];if(I)for(k in I)x.S[k].Ya=I[k];if(!w){do x.id++;while(r[x.id])}}w||(w={D:x,f:n[h].f,Cd:[],yp:[],pc:[]},r[x.id]=p.length,p.push(w));w.Cd=w.Cd.concat(n[h].Cd);n[h].Uc&&n[h].Uc.P&&w.yp.push(n[h].Uc);
if(w.pc.length)for(k=0;k<n[h].pc.length;k++)x=n[h].pc[k],-1==w.pc.indexOf(x)&&w.pc.push(x);else w.pc=n[h].pc;W.ou(w.pc,w.yp,W.Aw,!1)}for(h=0;h<p.length;h++){n=p[h].yp;if(0==n.length)k=P.vb(P.Ii("%empty"));else if(1==n.length)k=n[0];else{r=[];for(k=0;k<n.length;k++)W.SA(n[k])||r.push(k);if(r.length<n.length)for(k=0;k<r.length;k++)W.um(n[r[k]]);k=W.ED(n)}m.push({D:p[h].D,f:p[h].f,Uc:k,pc:p[h].pc,Cd:p[h].Cd})}g.push.apply(g,m);for(m=0;m<g.length;m++)if(k=g[m].D,k.Kc=g[m].pc,L(k,g[m].Uc),v(k,d,a),"STATIC"==
g[m].f.type&&"COLOR_ID"!=k.type)p=P.Ii("%meta%"+k.type+"%"+k.Kc.join("%")+"%"),p=V.rr(p),p.f=g[m].f,V.Jk(p,a),V.Ik(p,a,k),e.push(p);else for(n=[],h=0;h<g[m].Cd.length;h++)p=g[m].Cd[h],-1==n.indexOf(p.name)&&(V.Ik(p,a,k),n.push(p.name));if(ha.wireframe_debug){for(m=0;m<g.length;m++)if(d=g[m].f,"DYNAMIC"==d.type&&(p=g[m].Cd[0],-1<ga.indexOf(g[m].D.type))){h=V.Ja(p,a);k=h.T;n=!1;for(h=0;h<k.length;h++)k[h].sg&&(n=!0);n||(d=M(d.ef,d,p.name,!0,!0),V.Ik(p,a,d))}for(m=0;m<e.length;m++)p=e[m],d=p.f,h=V.Ja(p,
a),k=h.T,-1<ga.indexOf(k[0].type)&&(d=M(d.bd,d,p.name,!1),V.Ik(p,a,d))}for(m=0;m<b.length;m++)for(h=V.Ja(b[m],a),k=h.T,h=0;h<k.length;h++)c(k[h]);for(m=0;m<e.length;m++)for(h=V.Ja(e[m],a),k=h.T,h=0;h<k.length;h++)c(k[h])};a.Sz=function(a,b){var e=a.k.cq,g=d("MAIN");y(g,"special_skydome.glslv","special_skydome.glslf");if(b.procedural_skydome)z(g,"PROCEDURAL_SKYDOME",1),g.Et=!0;else{var f=e.op;if(f){z(g,"WO_SKYTEX",1);var h=p(e.mu,null);K(g,h,"u_sky");f.invert&&z(g,"MTEX_NEGATIVE",1);f.FE&&z(g,"MTEX_RGBTOINT",
1);z(g,"BLENDTYPE",f.Dx);f.BE&&z(g,"WOMAP_BLEND",1);f.CE&&z(g,"WOMAP_HORIZ",1);f.EE&&z(g,"WOMAP_ZENUP",1);f.DE&&z(g,"WOMAP_ZENDOWN",1)}e.GE&&z(g,"WO_SKYBLEND",1);e.HE&&z(g,"WO_SKYPAPER",1);e.IE&&z(g,"WO_SKYREAL",1)}b.hc&&(g.hc=!0,b.Wb&&(g.Wb=!0));g.Yg=99999;t(g,"a_position");e=ca.Oz();L(g,e);c(g);e=P.Ii("%meta_sky%");e=V.rr(e);V.Jk(e,a);f=V.Ja(e,a);e.f=V.Eh("STATIC");e.f.Gh=!0;e.f.Ib=S.pd();e.f.bd=S.vk();e.f.lb=S.pd();e.f.Jb=S.vk();f.T.push(g);return e};a.qr=function(a,c,d){d=V.Ja(a,d).T;var e=[],
g=ea.Wa(c,"SHADOW_CAST"),f=ea.Wa(c,"MAIN_PLANE_REFLECT"),h=ea.Wa(c,"MAIN_CUBE_REFLECT"),l=ea.Wa(c,"OUTLINE_MASK");c=ea.Wa(c,"COLOR_PICKING");for(var k=0;k<d.length;k++){var n=d[k],m=null;"DEPTH"==n.type&&g&&n.Sc&&(m=b(n),m.Sa="SHADOW_CAST");"MAIN"!=n.type&&"PARTICLES"!=n.type||!f&&!h||n.Ha||!n.hc||(m=b(n),m.Sa="REFLECT");"COLOR_ID"==n.type&&(l&&c?(m=b(n),m.Sa="OUTLINE"):l&&!c&&(n.Sa="OUTLINE"));m&&(m.zg=!0,N(m,a.f.id),e.push(m))}d.push.apply(d,e)};a.UC=n;a.UE=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);
else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.yx=function(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}};a.Zz=p;a.XD=D;a.WD=v;a.PC=m;a.Bq=function(a,b,c){c&&c.j.type==T.Qb&&z(a,"PERSPECTIVE_SHADOW_CAST",1);z(a,"CSM_SECTION0",0);z(a,"CSM_SECTION1",0);z(a,"CSM_SECTION2",0);z(a,"CSM_SECTION3",0);if(b){for(c=0;c<b.csm_num;c++)z(a,"CSM_SECTION"+String(c),1);z(a,"SHADOW_TEX_RES",F.r(b.csm_resolution));
z(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);z(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)}else z(a,"SHADOW_TEX_RES",0),z(a,"CSM_FADE_LAST_CASCADE",0),z(a,"CSM_BLEND_BETWEEN_CASCADES",0)};a.xa=z;a.Fb=function(a,b){return F.fA(a.Xa,b)};a.UD=L;a.VD=N;a.RF=M;a.zh=K;a.xC=function(a,b,c){c=a.Ob.indexOf(c);-1<c&&(a.S[c]=b)};a.Jy=function(a,b){var c=d("MAIN");c.Ha=!0;ma.set(b[0],b[1],b[2],.5,c.ed);c.xe=W.zk;L(c,a);y(c,"main_stack.glslv","main_stack.glslf");z(c,"SHADELESS",1);x(c);
return c};a.sb=x;a.Sx=function(a){return a.ic.Zj.length?a.ic.Uo.u_cube_fog?!0:!1:!1};a.uy=function(){var a=d("DEPTH_PACK");a.Ua=!0;a.ca=!1;var b=ca.wb();L(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");x(a);return a};a.sr=function(a){var b=d("POSTPROCESSING");y(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":z(b,"POST_EFFECT","POST_EFFECT_NONE");break;case "GRAYSCALE":z(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");
break;case "X_BLUR":z(b,"POST_EFFECT","POST_EFFECT_X_BLUR");break;case "Y_BLUR":z(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");break;case "X_GLOW_BLUR":z(b,"POST_EFFECT","POST_EFFECT_X_GLOW_BLUR");break;case "Y_GLOW_BLUR":z(b,"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR");break;case "X_EXTEND":z(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");break;case "Y_EXTEND":z(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");break;default:throw"Wrong postprocessing effect: "+a;}b.Ua=!0;b.ca=!1;a=ca.wb();L(b,a);x(b);return b};a.My=function(a){var b=
d("SSAO");b.ca=!1;b.Ua=!0;var c=ca.wb();L(b,c);y(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");z(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.uu);z(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:I.Tz(a)};c={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=p(a,c);K(b,a,"u_ssao_special_tex");
x(b);return b};a.Ny=function(a){var b=d("SSAO_BLUR");b.ca=!1;b.Ua=!0;var c=ca.wb();L(b,c);y(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");z(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);x(b);return b};a.vy=function(){var a=d("DOF");a.ca=!1;a.Ua=!0;var b=ca.wb();L(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");z(a,"DEPTH_RGBA",1);x(a);return a};a.Dy=function(){var a=d("OUTLINE");a.ca=!1;a.Ua=!0;var b=ca.wb();L(a,b);y(a,"postprocessing/postprocessing.glslv",
"postprocessing/outline.glslf");x(a);return a};a.xy=function(){var a=d("GLOW_COMBINE");a.ca=!1;a.Ua=!0;var b=ca.wb();L(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");x(a);return a};a.yy=function(a,b,c){var e=d("GOD_RAYS");e.ca=!1;e.Ua=!0;var g=ca.Jz();L(e,g);y(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");z(e,"DEPTH_RGBA",a?1:0);z(e,"WATER_EFFECTS",b?1:0);z(e,"STEPS_PER_PASS",F.r(c,1));x(e);return e};a.zy=function(){var a=d("GOD_RAYS_COM");a.ca=!1;
a.Ua=!0;var b=ca.wb();L(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");x(a);return a};a.Ey=function(){var a=d("SKY");a.ca=!1;a.Ua=!0;var b=ca.Kz();L(a,b);y(a,"procedural_skydome.glslv","procedural_skydome.glslf");z(a,"WATER_EFFECTS",1);x(a);return a};a.oy=function(){var a=d("ANTIALIASING");a.ca=!1;a.Ua=!0;var b=ca.wb();L(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");z(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");x(a);return a};
a.Ky=function(a){var b=d("SMAA"),c=ca.wb();L(b,c);y(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");z(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");z(b,"SMAA_PASS",a);z(b,"SMAA_PREDICATION",0);z(b,"SMAA_REPROJECTION",0);x(b);b.ca=!1;b.Ua=!0;return b};a.sy=function(){var a=d("COMPOSITING");a.ca=!1;a.Ua=!0;var b=ca.wb();L(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");x(a);return a};a.Cy=function(){var a=d("MOTION_BLUR");a.Ua=!0;a.ca=!1;var b=ca.wb();L(a,b);y(a,
"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");x(a);return a};a.my=function(){var a=d("ANAGLYPH");a.Ua=!0;a.ca=!1;var b=ca.wb();L(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");x(a);return a};a.Ay=function(){var a=d("LUMINANCE");a.ca=!1;a.Ua=!0;var b=ca.wb();L(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");x(a);return a};a.py=function(){var a=d("LUMINANCE");a.ca=!1;a.Ua=!0;var b=ca.wb();L(a,b);y(a,"postprocessing/postprocessing.glslv",
"postprocessing/luminance_av.glslf");x(a);return a};a.By=function(){var a=d("LUMINANCE_X_BLUR");a.ca=!1;a.Ua=!0;var b=ca.wb();L(a,b);y(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");x(a);return a};a.qy=function(){var a=d("POSTPROCESSING");a.Ua=!0;a.ca=!1;var b=ca.wb();L(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");x(a);return a};a.ry=function(){var a=d("BLOOM");a.ca=!1;a.Ua=!0;var b=ca.wb();L(a,b);y(a,"postprocessing/postprocessing.glslv",
"postprocessing/bloom_combine.glslf");x(a);return a};a.Qy=function(){var a=d("VELOCITY");a.ca=!1;a.Ua=!0;var b=ca.wb();L(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");x(a);return a};a.ny=function(){var a=d("ANCHOR_VISIBILITY");a.ca=!0;a.Ua=!0;a.xe=W.gq;y(a,"anchors.glslv","anchors.glslf");var b=ca.Wr(1);L(a,b);z(a,"ANCHOR_NUM",1);x(a);a.ji=new Float32Array([0,0,0]);return a};a.TD=function(a,b){var c=b.length/3;if(c!=a.ji.length/3){var d=ca.Wr(c);L(a,d);z(a,"ANCHOR_NUM",
c);x(a)}a.ji=b};a.va=function(a,b,c){a=a.aa[0].T;for(var d=0;d<a.length;d++)if(a[d].type==c&&!a[d].zg&&-1!=a[d].Kc.indexOf(b))return a[d];return null};a.Ic=function(a,b,c){a=a.aa[0].T;for(var d=0;d<a.length;d++)if(a[d].type==c&&a[d].zg&&-1!=a[d].Kc.indexOf(b))return a[d];return null};a.Zt=function(a,b){a.ed.set(b.ed);a.lf=b.lf;a.$d.set(b.$d);a.xc.set(b.xc);a.ye=b.ye;a.le=b.le;a.kf=b.kf;a.bf=b.bf;a.reflect_factor=b.reflect_factor;a.xd.set(b.xd);a.parallax_scale=b.parallax_scale;a.shallow_water_col.set(b.shallow_water_col);
a.shallow_water_col_fac=b.shallow_water_col_fac;a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.Pi=b.Pi};a.JF=function(a,b){for(var c=a.aa[0].T,d=0;d<c.length;d++)if(c[d].type==b)return!0;return!1};a.hy=function(a){for(var b=a.S,c=0;c<b.length;c++)I.dz(b[c].kb);W.dr(a.R)}};b4w.module.__nodemat=function(a,q){function d(a,b,l,r,x){var F;a:switch(x){case "GLOW":F=b+"11";break a;case "COLOR_ID":case "DEPTH":F=b+"00";break a;default:F=b+"10"}if(F in ta)return ta[F];if("DEPTH"!=x&&"COLOR_ID"!=x){var w=P.create(),q=a.nodes,v=a.links;b=a.animation_data;for(var y=0;y<q.length;y++)if(null==L(w,q[y],0,b,r,x))return ta[F]=null;if(l&&-1==t(a,w,"GROUP_OUTPUT","group"))return null;y=ca(w);if(!ka(w,v,y))return null;if(l)return w;for(y=0;y<v.length;y++){l=v[y];for(var q=h(l.from_node,
w),u=h(l.to_node,w),I=0;I<q.length;I++)for(var E=0;E<u.length;E++){var G=q[I],da=u[E],z=P.Qa(w,G),B=P.Qa(w,da);if(!V(w,G,da,z,B,l))return ta[F]=null}}g(w);a="GLOW"==x?t(a,w,"B4W_GLOW_OUTPUT","material",!0):t(a,w,"OUTPUT","material",!1,!0);-1==a&&(w=k(),a=0);p(w);a=P.xp(w,a,P.Fm);c(a,b,r);n(a);C(a);m(a);e(a,b,r,x)}else r=d(a,b,l,r,"MAIN"),r=P.clone(r,function(a){var b=O.dj(a);b.C=O.ma(a.C);b.qa=O.ma(a.qa);return b}),a=t(a,r,"OUTPUT","material",!1,!0),f(r,a),a=P.xp(r,a,P.Fm),n(a);return ta[F]=a}function c(a,
c,d){var e=[];P.W(a,function(a,b){"MATERIAL"!=b.type&&"MATERIAL_EXT"!=b.type||e.push({QB:a,node:b})});for(var g=0;g<e.length;++g){var f=e[g].QB,h=e[g].node,l=P.Ej(a);P.yh(a,l,h.data.BB);var k=P.Ej(a);P.yh(a,k,h.data.CB);P.Sb(a,l,k,[4,2]);for(var n={5:["LIGHTING_APPLY",10],6:["LIGHTING_APPLY",6],7:["MATERIAL_END",3],8:["MATERIAL_END",4],9:["MATERIAL_END",5]},m=P.mo(a,f),p=[],r=[],x=[],F={},w=0;w<m;w++){var q=P.Gj(a,f,w);q in F||(F[q]=0);var v=P.Be(a,q,f,F[q]++);p.push([q,f,v]);var y=n[v[1]];if(y)switch(y[0]){case "MATERIAL_END":r.push([q,
k,[v[0],y[1]]]);break;case "LIGHTING_APPLY":x.push([q,[v[0],y[1]]])}else r.push([q,l,v])}b(a,h.data.value,l,k,x,c,d);for(w=0;w<p.length;w++)P.km(a,p[w][0],p[w][1],p[w][2]);for(w=0;w<r.length;w++)P.Sb(a,r[w][0],r[w][1],r[w][2]);h=P.Df(a,f);l=[];n=[];m={};for(w=0;w<h;w++)p=P.qf(a,f,w),p in m||(m[p]=0),v=P.Be(a,f,p,m[p]++),l.push([f,p,v]),n.push([k,p,v]);for(w=0;w<l.length;w++)P.km(a,l[w][0],l[w][1],l[w][2]);for(w=0;w<n.length;w++)P.Sb(a,n[w][0],n[w][1],n[w][2]);P.hh(a,f)}}function b(a,b,c,d,e,g,f){var h=
{name:"LIGHTING_AMBIENT",type:"LIGHTING_AMBIENT"},k=L(a,h,0,g,f,null),n=k;l(a,c,k,"E");l(a,c,k,"A");l(a,c,k,"D");k=qa.Dg();k=ha.na(k,"LAMP",ha.DATA_ID_ALL);if(!b.$b)for(var m,p,r=0;r<k.length;r++){var x=k[r].Ka,h={name:"LIGHTING_LAMP",type:"LIGHTING_LAMP"};m=L(a,h,0,g,f,null);h={name:"LIGHTING_APPLY",type:"LIGHTING_APPLY"};p=L(a,h,0,g,f,null);l(a,n,p,"color");l(a,n,p,"specular");l(a,m,p,"ldir");l(a,c,p,"normal");l(a,c,p,"D");l(a,c,p,"S");l(a,m,p,"lcolorint");l(a,c,m,"shadow_factor");n="COOKTORR"==
b.ui?"SPECULAR_PHONG":"SPECULAR_"+b.ui;h={name:n,type:n};h=L(a,h,0,g,f,null);l(a,m,h,"ldir");l(a,m,h,"lfac");l(a,c,h,"normal");l(a,h,p,"sfactor");"SPECULAR_PHONG"!=n&&"SPECULAR_BLINN"!=n||l(a,m,h,"norm_fac");l(a,c,h,"sp_params");n="HEMI"==x.type?"DIFFUSE_LAMBERT":"DIFFUSE_"+b.qj;h={name:n,type:n};h=L(a,h,0,g,f,null);l(a,m,h,"ldir");l(a,m,h,"lfac");l(a,c,h,"normal");l(a,m,h,"norm_fac");l(a,h,p,"lfactor");"DIFFUSE_LAMBERT"!=n&&l(a,c,h,"dif_params");for(m=0;m<e.length;m++)P.Sb(a,e[m][0],p,e[m][1]);n=
p}l(a,n,d,"color");l(a,n,d,"specular")}function l(a,b,c,d){for(var e=P.Qa(a,b),g=P.Qa(a,c),f,h=0;h<g.C.length;h++)if(d==g.C[h].identifier){f=h;break}for(var l,h=0;h<e.qa.length;h++)if(d==e.qa[h].identifier){l=h;break}void 0!=f&&void 0!=l&&P.Sb(a,b,c,[l,f])}function f(a,b){P.ee(a,function(c,d,e){var g=P.Qa(a,d);d==b&&"Color"==g.C[e[1]].identifier&&P.km(a,c,d,e)})}function k(){var a=P.create(),b={data:null,fd:[],O:[],C:[{Ia:new Float32Array([0,0,0]),identifier:"Color",xb:!1,name:"Color"},{Ia:1,identifier:"Alpha",
xb:!1,name:"Alpha"}],qa:[],type:"OUTPUT",Xf:[]};P.yh(a,0,b);return a}function n(a){P.W(a,function(b,c){for(var d=c.C,e=c.qa,g=0;g<d.length;g++)r(a,d[g],b,g,1);for(g=0;g<e.length;g++)r(a,e[g],b,g,0)})}function r(a,b,c,d,e){if(b.xb){var g=!0;P.ee(a,function(a,b,f){if(!e&&a==c&&f[0]==d||e&&b==c&&f[1]==d)g=!1});g&&(b.xb=!1)}}function e(a,b,c,d){var e=[];P.ee(a,function(g,f,h){var l=P.Qa(a,g),k=P.Qa(a,f),l=O.is_vector(l.qa[h[0]].Ia),k=O.is_vector(k.C[h[1]].Ia);if(l!=k){var n,m={default_value:[0,0,0],identifier:"Vector",
is_linked:!0,name:"Vector"},p={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};l&&!k?n=z("vector_to_scalar","B4W_VECTOSCAL",[m],[p]):!l&&k&&(n=z("scalar_to_vector","B4W_SCALTOVEC",[p],[m]));L(a,n,0,b,c,d);e.push([g,f,a.V[a.V.length-2],h])}});for(var g=0;g<e.length;++g)P.km(a,e[g][0],e[g][1],e[g][3]),P.Sb(a,e[g][0],e[g][2],[e[g][3][0],0]),P.Sb(a,e[g][2],e[g][1],[0,e[g][3][1]])}function g(a){var b=[];P.W(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":P.ee(a,function(a,e,g){a==
c&&"Translucency"==d.qa[g[0]].name&&b.push(a,e,[g[0]+1,g[1]+1])})}});for(var c=0;c<b.length;c+=3)P.Sb(a,b[c],b[c+1],b[c+2])}function h(a,b){var c=[];P.W(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function p(a){var b=[];P.W(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var g=w(a,d);if(-1!=g){var f=P.Gj(a,g,0);P.gh(a,g,d,-1);-1!=f&&P.gh(a,f,g,-1);d=P.Qa(a,
g);e.data=d.data;e.O[0]=d.O[0];P.hh(a,g)}e.C.splice(1,1)}else if("REROUTE"==e.type){for(var e=P.Gj(a,d,0),h=P.Df(a,d),g=[],f=[],l=[],k=0;k<h;k++){var n=P.qf(a,d,k),m=f.indexOf(n);-1!=m?l[m]+=1:(f.push(n),l.push(1),g.push(d,n))}if(-1!=e)for(h=P.Be(a,e,d,0)[0],k=0;k<f.length;k++)for(n=0;n<l[k];n++)m=P.Be(a,d,f[k],n)[1],P.Sb(a,e,f[k],[h,m]);for(k=0;k<g.length;k+=2)P.gh(a,g[k],g[k+1],-1)}}}function w(a,b){for(var c=a.Y,d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function C(a){H(a);
D(a);B(a)}function B(a){var b=[],c="",d="",e={};P.W(a,function(a,g){if("GEOMETRY_UV"==g.type||"UVMAP"==g.type||"TEX_COORD_UV"==g.type){b.push(a,g);var f=g.data.value;c?c==f||d||(d=f,e[d]=0):(c=f,e[c]=0);e[f]++}});for(var g in e)if(2>e[g]){for(var f=0;f<b.length;f+=2)b[f+1].data.value==g&&b.splice(f,2);delete e[g];c==g&&(c=d,d="");d==g&&(d="")}if(!(3>b.length)){var f={default_value:[0,0,0],identifier:"UV_geom",is_linked:!1,name:"UV_geom"},h={default_value:[0,0,0],identifier:"UV_cycles",is_linked:!1,
name:"UV_cycles"};g=z("merged_uv","UV_MERGED",[],[f,h]);g.uv_layer=c;L(a,g,0,null,"",void 0);var l=a.V[a.V.length-2];g=a.V[a.V.length-1];if(d){h=z("merged_uv","UV_MERGED",[],[f,h]);h.uv_layer=d;L(a,h,0,null,"",void 0);var k=a.V[a.V.length-2],h=a.V[a.V.length-1]}else h=null;for(var n=-1,m=null,f=0;f<b.length;f+=2){var p=b[f],r=b[f+1];v(r,b[1])?(n=l,m=g):h&&(n=k,m=h);for(var x=[],F=P.Df(a,p),w={},q=0;q<F;q++){var y=P.qf(a,p,q);y in w||(w[y]=0);var t=P.Be(a,p,y,w[y]++);x.push(p,y,t);t=t.splice(0,t.length);
switch(r.type){case "GEOMETRY_UV":t[0]=0;m.qa[0].xb=!0;break;case "UVMAP":case "TEX_COORD_UV":t[0]=1,m.qa[1].xb=!0}P.Sb(a,n,y,t)}for(var q=0;q<x.length;q+=3)P.gh(a,x[q],x[q+1],0);P.hh(a,p)}}}function H(a){var b=[];P.W(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type&&"GEOMETRY_LO"!=c.type&&"GEOMETRY_OR"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],g=b[d+1],f=!0,h=0;h<c.length;h++){var l=c[h];
if(G(g,l.Dc)){f=[];h=P.Df(a,e);for(m=0;m<h;m++){var k=P.qf(a,e,m),n=P.Be(a,e,k,0);f.push(e,k,n);P.Sb(a,l.id,k,n)}for(var m=0;m<f.length;m+=3)P.gh(a,f[m],f[m+1],0);P.hh(a,e);f=!1;break}}f&&(l={id:e,Dc:g},c.push(l))}}function u(a){for(var b={},c=0;c<a.V.length;c+=2)b[a.V[c]]=[];for(c=0;c<a.Y.length;c+=3){for(var d=a.Y[c],e=a.Y[c+1],g=b[e],f=d,h=0;h<=g.length;h++){if(h>=g.length||g[h]>f)g.splice(h,0,f);else if(g[h]!=f)continue;break}for(var e=b[e],d=b[d],f=g=0,h=e.length+d.length,l=[],k=0;k<h;k++)g>
e.length||e[g]>d[f]?l.push(d[f++]):l.push(e[g++])}return b}function D(a){var b=[];P.W(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=u(a),d=[],e=0;e<b.length;e+=2){for(var g=b[e],f=b[e+1],h=!0,l=0;l<d.length;l++){var k=d[l];if(!(3<=k.di.length||!G(f,k.Dc)||-1<c[g].indexOf(k.id)||-1<c[k.id].indexOf(g))){for(var n=!1,m=0;m<k.di.length;m++){var p=k.di[m].id;if(-1<c[g].indexOf(p)||-1<c[p].indexOf(g)){n=!0;break}}if(!n){for(var l=[],p=P.mo(a,g),
r={},m=0;m<p;m++)n=P.Gj(a,g,m),n in r||(r[n]=0),h=P.Be(a,n,g,r[n]++),l.push(n,g,h);for(var p=[],r=P.Df(a,g),x={},m=0;m<r;m++)n=P.qf(a,g,m),n in x||(x[n]=0),h=P.Be(a,g,n,x[n]++),p.push(g,n,h);h=l.concat(p);for(m=0;m<h.length;m+=3)P.gh(a,h[m],h[m+1],0);P.hh(a,g);m={id:g,Dc:f,kz:l,lz:p};k.di.push(m);h=!1;break}}}h&&(k={id:g,Dc:f,di:[]},d.push(k))}for(e=0;e<d.length;e++){k=d[e];c=k.di.length;for(l=0;l<c;l++){f=k.di[l];m=f.Dc;g=f.kz;f=f.lz;k.Dc.C[l+1].xb=m.C[0].xb;k.Dc.C[l+1].Ia=m.C[0].Ia;k.Dc.qa[2*(l+
1)].xb=m.qa[0].xb;k.Dc.qa[2*(l+1)].Ia=m.qa[0].Ia;k.Dc.qa[2*(l+1)+1].xb=m.qa[1].xb;k.Dc.qa[2*(l+1)+1].Ia=m.qa[1].Ia;for(m=0;m<g.length;m+=3)n=g[m],h=g[m+2],h[1]+=l+1,P.Sb(a,n,k.id,h);for(m=0;m<f.length;m+=3)n=f[m+1],h=f[m+2],h[0]+=2*(l+1),P.Sb(a,k.id,n,h);k.Dc.fd.push(["USE_uv"+(l+2),1])}P.hh(a,k.id);P.yh(a,k.id,k.Dc)}}}function G(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":case "GEOMETRY_LO":case "GEOMETRY_OR":return!0;
case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function v(a,b){var c=["GEOMETRY_UV","TEX_COORD_UV","UVMAP"];return-1!=c.indexOf(a.type)&&-1!=c.indexOf(b.type)?a.data.value==b.data.value:!1}function m(a){var b=[];P.W(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],g=!1,f=[],h=[],l=[[],[],[]],k=P.Df(a,d),m=0;m<k;m++){var n=P.qf(a,d,m);if("SEPRGB"!=P.Qa(a,n).type){g=!1;break}f.push(d,n);for(var p=
{},r=P.Df(a,n),g=0;g<r;g++){var x=P.qf(a,n,g);x in p||(p[x]=0);var F=P.Be(a,n,x,p[x]++);f.push(n,x);l[F[0]].push(d,x,F)}h.push(n);g=!0}if(g){for(m=d=k=0;m<l.length;m++)l[m].length&&(k++,d|=1<<2-m);if(k){e.type+=k;e.qa=[];for(m=0;m<l.length;m++)if(l[m].length)for(e.qa.push({Ia:0,identifier:"RGB"[m],xb:!0,name:"RGB"[m]}),g=0;g<l[m].length;g+=3)l[m][g+2][0]=O.ek(d,m);for(m=0;m<f.length;m+=2)P.gh(a,f[m],f[m+1],0);for(m=0;m<h.length;m++)P.hh(a,h[m]);for(m=0;m<l.length;m++)for(g=0;g<l[m].length;g+=3)P.Sb(a,
l[m][g],l[m][g+1],l[m][g+2])}}}}function t(a,b,c,d,e,g){a=a.nodes;for(var f=null,l=0;l<a.length;l++){var k=a[l];e?"GROUP"==k.type&&k.node_tree_name==c&&(f=k):k.type==c&&(f=k)}return f?h(f,b)[0]:(g||ga.error('No "'+c+'" node in node '+d),-1)}function z(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function L(a,b,c,d,e,g){var f=b.name,h=b.type,l=[],k=[],m=[],n=[],p=null,r=[];switch(h){case "BSDF_ANISOTROPIC":case "BSDF_DIFFUSE":case "BSDF_GLOSSY":case "BSDF_GLASS":case "BSDF_HAIR":case "BSDF_TRANSPARENT":case "BSDF_TRANSLUCENT":case "BSDF_REFRACTION":case "BSDF_TOON":case "BSDF_VELVET":case "SUBSURFACE_SCATTERING":case "EMISSION":case "AMBIENT_OCCLUSION":case "VOLUME_ABSORPTION":case "VOLUME_SCATTER":case "BUMP":case "NORMAL_MAP":case "VECT_TRANSFORM":case "BLACKBODY":case "WAVELENGTH":case "SEPXYZ":case "COMBXYZ":case "LIGHT_FALLOFF":case "TEX_IMAGE":case "TEX_ENVIRONMENT":case "TEX_SKY":case "TEX_NOISE":case "TEX_WAVE":case "TEX_MUSGRAVE":case "TEX_GRADIENT":case "TEX_MAGIC":case "TEX_CHECKER":case "TEX_BRICK":case "WIREFRAME":case "LAYER_WEIGHT":case "TANGENT":case "LIGHT_PATH":case "ATTRIBUTE":case "HOLDOUT":case "PARTICLE_INFO":case "HAIR_INFO":case "OBJECT_INFO":case "SCRIPT":case "NEW_GEOMETRY":k=
W(b);m=aa(b);ga.warn(h+" node is not fully supported.");break;case "BRIGHTCONTRAST":case "ADD_SHADER":case "MIX_SHADER":k=W(b);m=aa(b);break;case "UVMAP":var p=M("param_"+h+"_a"),F=M("param_"+h+"_v");l.push(Q(p));l.push(Q(F));m=aa(b);n.push(Q(F));p={name:p,value:b.uv_layer};break;case "UV_MERGED":p=M("param_UV_MERGED_a");F=M("param_UV_MERGED_v");l.push(Q(p));l.push(Q(F));m.push(U(b,"UV_geom"));m.push(U(b,"UV_cycles"));n.push(Q(F));p={name:p,value:b.uv_layer};break;case "CAMERA":k=[];m=aa(b);break;
case "COMBRGB":case "COMBHSV":k=W(b);m=aa(b);break;case "CURVE_RGB":k=W(b);m=aa(b);ga.warn("CURVE_RGB node is not fully supported.");break;case "CURVE_VEC":k=W(b);m=aa(b);ga.warn("CURVE_VEC node is not fully supported.");break;case "GEOMETRY":if(!y(b))return!0;h=K(b,c);if(!h)return ga.error("Geometry output is not supported"),null;switch(h){case "GEOMETRY_UV":if(!b.uv_layer)return ga.error('Missing uv layer in node "',b.name,'"'),null;p=M("param_GEOMETRY_UV_a");F=M("param_GEOMETRY_UV_v");l.push(Q(p));
l.push(Q(F));m.push(U(b,"UV"));n.push(Q(F));p={name:p,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return ga.error("Missing vertex color layer in node ",b.name),null;p=M("param_GEOMETRY_VC_a");F=M("param_GEOMETRY_VC_v");l.push(Q(p));l.push(Q(F));m.push(U(b,"Vertex Color"));n.push(Q(F));p={name:p,value:b.color_layer};break;case "GEOMETRY_NO":m.push(U(b,"Normal"));break;case "GEOMETRY_FB":m.push(U(b,"Front/Back"));break;case "GEOMETRY_VW":m.push(U(b,"View"));break;case "GEOMETRY_GL":m.push(U(b,
"Global"));break;case "GEOMETRY_LO":m.push(U(b,"Local"));break;case "GEOMETRY_OR":F=M("param_GEOMETRY_OR_v"),l.push(Q(F)),m.push(U(b,"Orco")),n.push(Q(F))}break;case "TEX_COORD":if(!y(b))return!0;h=x(b,c);if(!h)return ga.error("Texture coordinate output is not supported"),null;switch(h){case "TEX_COORD_UV":p=M("param_TEX_COORD_UV_a");F=M("param_TEX_COORD_UV_v");l.push(Q(p));l.push(Q(F));m.push(U(b,"UV"));n.push(Q(F));p={name:p,value:b.uv_layer};break;case "TEX_COORD_NO":m.push(U(b,"Normal"));break;
case "TEX_COORD_GE":F=M("param_TEX_COORD_GE_v");l.push(Q(F));m.push(U(b,"Generated"));n.push(Q(F));break;case "TEX_COORD_OB":m.push(U(b,"Object"));ga.warn('Output "Object" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_CA":m.push(U(b,"Camera"));break;case "TEX_COORD_WI":m.push(U(b,"Window"));ga.warn('Output "Window" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_RE":m.push(U(b,"Reflection")),ga.warn('Output "Reflection" of node "Texture Coordinate" doesn\'t supported fully.')}break;
case "GROUP":F=b.node_tree_name;switch(F){case "B4W_LINEAR_TO_SRGB":if(!A(b,[1],[1])){p=J(b,e,g);break}h="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!A(b,[1],[1])){p=J(b,e,g);break}h="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!A(b,[1],[1])){p=J(b,e,g);break}h="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!A(b,[1,1],[1])){p=J(b,e,g);break}h="B4W_REFLECT";break;case "B4W_REFRACTION":if(!A(b,[1,0],[1])){p=J(b,e,g);break}h="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!A(b,
[1,1,0,0,0],[1])){p=J(b,e,g);break}var h="B4W_PARALLAX",w=M("temp_texture");n.push(Q(w));break;case "B4W_CLAMP":if(!A(b,[1],[1])){p=J(b,e,g);break}h="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!A(b,[0,0,0,0,0],[0])){p=J(b,e,g);break}h="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!A(b,[],[0])){p=J(b,e,g);break}h="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!A(b,[0,0,0],[0])){p=J(b,e,g);break}h="B4W_SMOOTHSTEP";break;case "B4W_GLOW_OUTPUT":h="B4W_GLOW_OUTPUT";break;default:p=J(b,e,g)}k=W(b);m=aa(b);"B4W_TRANSLUCENCY"==
F&&(F=R("TranslucencyParams","TranslucencyParams",[0,0,0,0]),F.xb=m[0].xb,m.push(F));break;case "LAMP":p=b.lamp;if(!p)return ga.error("There is no lamp in node: "+b.name),null;m.push(U(b,"Color"));m.push(U(b,"Light Vector"));m.push(U(b,"Distance"));m.push(U(b,"Visibility Factor"));p.uuid in Z?r.push(["LAMP_INDEX",String(Z[p.uuid])]):(Z[p.uuid]=Gb,r.push(["LAMP_INDEX",String(Gb++)]));p=Z;break;case "LIGHTING_AMBIENT":k=[R("E","E",[0,0,0],!0),R("A","A",[0,0,0],!0),R("D","D",[0,0,0],!0)];m=[R("color",
"color",[0,0,0],!0),R("specular","specular",[0,0,0],!0)];break;case "LIGHTING_BEGIN":m=[R("E","E",[0,0,0],!0),R("A","A",[0,0,0],!0),R("D","D",[0,0,0],!0),R("S","S",[0,0,0],!0),R("normal","normal",[0,0,0],!0),R("dif_params","dif_params",[0,0],!0),R("sp_params","sp_params",[0,0],!0),R("shadow_factor","shadow_factor",0,!0),R("translucency_color","translucency_color",0,!0),R("translucency_params","translucency_params",[0,0,0,0],!0)];break;case "LIGHTING_END":k=[R("color","color",[0,0,0],!0),R("specular",
"specular",[0,0,0],!0)];break;case "LIGHTING_LAMP":k=[R("shadow_factor","shadow_factor",0,!0)];m=[R("ldir","ldir",[0,0,0],!0),R("lfac","lfac",[0,0],!0),R("lcolorint","lcolorint",[0,0,0],!0),R("norm_fac","norm_fac",0,!0)];break;case "DIFFUSE_LAMBERT":k=[R("ldir","ldir",[0,0,0],!0),R("lfac","lfac",[0,0],!0),R("normal","normal",[0,0,0],!0),R("norm_fac","norm_fac",0,!0)];m=[R("lfactor","lfactor",0,!0)];break;case "DIFFUSE_FRESNEL":case "DIFFUSE_MINNAERT":case "DIFFUSE_OREN_NAYAR":case "DIFFUSE_TOON":k=
[R("ldir","ldir",[0,0,0],!0),R("lfac","lfac",[0,0],!0),R("normal","normal",[0,0,0],!0),R("norm_fac","norm_fac",0,!0),R("dif_params","dif_params",[0,0],!0)];m=[R("lfactor","lfactor",0,!0)];break;case "SPECULAR_BLINN":case "SPECULAR_PHONG":k=[R("ldir","ldir",[0,0,0],!0),R("lfac","lfac",[0,0],!0),R("normal","normal",[0,0,0],!0),R("norm_fac","norm_fac",0,!0),R("sp_params","sp_params",[0,0],!0)];m=[R("sfactor","sfactor",0,!0)];break;case "SPECULAR_TOON":case "SPECULAR_WARDISO":k=[R("ldir","ldir",[0,0,
0],!0),R("lfac","lfac",[0,0],!0),R("normal","normal",[0,0,0],!0),R("sp_params","sp_params",[0,0],!0)];m=[R("sfactor","sfactor",0,!0)];break;case "LIGHTING_APPLY":k=[R("color","color",[0,0,0,0],!0),R("specular","specular",[0,0,0],!0),R("lfactor","lfactor",0,!0),R("sfactor","sfactor",0,!0),R("ldir","ldir",[0,0,0],!0),R("normal","normal",[0,0,0],!0),R("translucency_params","translucency_params",[0,0,0,0],!0),R("D","D",[0,0,0],!0),R("S","S",[0,0,0],!0),R("lcolorint","lcolorint",[0,0,0],!0),R("translucency_color",
"translucency_color",0,!0)];m=[R("color","color",[0,0,0,0],!0),R("specular","specular",[0,0,0],!0)];break;case "NORMAL":k=W(b);m=aa(b);F=U(b,"Normal");n.push(Q(M("param_NORMAL_Normal"),F.Ia,3));break;case "MAPPING":F=b.vector_type;h="MAPPING";k.push(T(b,"Vector"));m.push(U(b,"Vector"));var w=b.rotation,q=b.scale,v=b.translation,t=ua.create(),u=O.oz(w);"TEXTURE"==F&&(q[0]=q[0]||1,q[1]=q[1]||1,q[2]=q[2]||1);var I=new Float32Array([q[0],0,0,0,q[1],0,0,0,q[2]]);ua.multiply(u,I,t);t=O.AB(t,ma.create());
switch(F){case "POINT":t[12]=v[0];t[13]=v[1];t[14]=v[2];break;case "TEXTURE":t[12]=v[0];t[13]=v[1];t[14]=v[2];t=ma.invert(t,t);break;case "NORMAL":ma.invert(t,t),ma.transpose(t,t)}switch(F){case "NORMAL":r.push(["MAPPING_IS_NORMAL",1]);case "TEXTURE":r.push(["MAPPING_TRS_MATRIX",Y.r(t,16)]);break;case "POINT":0!==E.length(w)?r.push(["MAPPING_TRS_MATRIX",Y.r(t,16)]):(0!==E.length(q)&&r.push(["MAPPING_SCALE",Y.r(q,3)]),0!==E.length(v)&&r.push(["MAPPING_TRANSLATION",Y.r(v,3)]));break;case "VECTOR":0!==
E.length(w)?r.push(["MAPPING_TRS_MATRIX",Y.r(t,16)]):0!==E.length(q)&&r.push(["MAPPING_SCALE",Y.r(q,3)])}b.use_min&&r.push(["MAPPING_MIN_CLIP",Y.r(b.min,3)]);b.use_max&&r.push(["MAPPING_MAX_CLIP",Y.r(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":p=[];F=[];w=[];q=[R("E","E",[0,0,0],!0),R("A","A",[0,0,0],!0),R("D","D",[0,0,0],!0),R("S","S",[0,0,0],!0),R("normal","normal",[0,0,0],!0),R("dif_params","dif_params",[0,0],!0),R("sp_params","sp_params",[0,0],!0),R("shadow_factor","shadow_factor",0,
!0)];v=[R("color","color",[0,0,0],!0),R("specular","specular",[0,0,0],!0),R("normal","normal",[0,0,0],!0)];t=[U(b,"Color"),U(b,"Alpha"),U(b,"Normal")];u=[];I=T(b,"Color");I.Ia.splice(3);w.push(I);k.push(I);I=T(b,"Spec");I.Ia.splice(3);w.push(I);k.push(I);w.push(R("DiffuseIntensity","DiffuseIntensity",b.diffuse_intensity));k.push(I);var G=T(b,"Normal");G.Ia.splice(3);w.push(G);k.push(G);"MATERIAL_EXT"==h?((I=T(b,"Emit"))||(I=R("Emit","Emit",0)),w.push(I),k.push(I),(I=T(b,"Translucency"))?(I.Ia=0,I.name=
"Translucency",I.identifier="Translucency"):I=R("Translucency","Translucency",0),k.push(I),(I=T(b,"Translucency"))?(I.Ia=[0,0,0,0],I.name="TranslucencyParams",I.identifier="TranslucencyParams"):I=R("TranslucencyParams","TranslucencyParams",[0,0,0,0]),k.push(I),m=T(b,"Reflectivity"),I=T(b,"Ray Mirror"),m?(I=m,m="Reflectivity"):I?m="Ray Mirror":(I=m,m="Reflectivity"),I||(I=R(m,m,0)),k.push(I),v.push(I),(I=T(b,"SpecTra"))||(I=R("SpecTra","SpecTra",0)),k.push(I),v.push(I),(I=T(b,"Alpha"))||(I=R("Alpha",
"Alpha",b.alpha)),k.push(I),v.push(I),t.push(U(b,"Diffuse")),t.push(U(b,"Spec")),p.push(["MATERIAL_EXT",1]),F.push(["MATERIAL_EXT",1])):(w.push(R("emit_intensity","emit_intensity",0)),v.push(R("reflect_factor","reflect_factor",0)),v.push(R("specular_alpha","specular_alpha",0)),v.push(R("alpha_in","alpha_in",0)),t.push(R("diffuse_out","diffuse_out",0)),t.push(R("spec_out","spec_out",0)),p.push(["MATERIAL_EXT",0]),F.push(["MATERIAL_EXT",0]));u.push(Q(M("param_MATERIAL_alpha"),b.alpha));u.push(Q(M("param_MATERIAL_spec_alpha"),
b.specular_alpha));m=t;G.xb&&p.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&(p.push(["USE_MATERIAL_DIFFUSE",1]),F.push(["USE_MATERIAL_DIFFUSE",1]));b.use_specular&&F.push(["USE_MATERIAL_SPECULAR",1]);var I=[],C=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":G=b.specular_hardness;break;case "WARDISO":G=b.specular_slope;break;case "TOON":G=b.specular_toon_size;C=b.specular_toon_smooth;break;case "BLINN":G=b.specular_ior;C=b.specular_hardness;break;default:ga.error("unsupported specular shader: "+
b.specular_shader+' (material "'+b.material_name+'")'),G=b.specular_hardness}var da,z;switch(b.diffuse_shader){case "LAMBERT":z=da=0;break;case "OREN_NAYAR":da=b.roughness;z=0;break;case "FRESNEL":da=b.diffuse_fresnel;z=b.diffuse_fresnel_factor;break;case "MINNAERT":da=b.darkness;z=0;break;case "TOON":da=b.diffuse_toon_size;z=b.diffuse_toon_smooth;break;default:ga.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),z=da=0}I.push(Q(M("param_MATERIAL_diffuse"),
[da,z],2));I.push(Q(M("param_MATERIAL_spec"),[b.specular_intensity,G,C],3));G={name:b.name,value:{ui:b.specular_shader,qj:b.diffuse_shader,$b:b.use_shadeless}};p={name:b.name,value:{ui:b.specular_shader,qj:b.diffuse_shader,$b:b.use_shadeless},BB:{name:"material_begin",type:"MATERIAL_BEGIN",C:w,qa:q,O:I,data:G,fd:p,Xf:[]},CB:{name:"material_end",type:"MATERIAL_END",C:v,qa:t,O:u,data:G,fd:F,Xf:[]}};break;case "MATH":switch(b.operation){case "ADD":h="MATH_ADD";break;case "SUBTRACT":h="MATH_SUBTRACT";
break;case "MULTIPLY":h="MATH_MULTIPLY";break;case "DIVIDE":h="MATH_DIVIDE";break;case "SINE":h="MATH_SINE";break;case "COSINE":h="MATH_COSINE";break;case "TANGENT":h="MATH_TANGENT";break;case "ARCSINE":h="MATH_ARCSINE";break;case "ARCCOSINE":h="MATH_ARCCOSINE";break;case "ARCTANGENT":h="MATH_ARCTANGENT";break;case "POWER":h="MATH_POWER";break;case "LOGARITHM":h="MATH_LOGARITHM";break;case "MINIMUM":h="MATH_MINIMUM";break;case "MAXIMUM":h="MATH_MAXIMUM";break;case "ROUND":h="MATH_ROUND";break;case "LESS_THAN":h=
"MATH_LESS_THAN";break;case "GREATER_THAN":h="MATH_GREATER_THAN";break;case "MODULO":h="MATH_MODULO";break;case "ABSOLUTE":h="MATH_ABSOLUTE";break;default:return ga.error("Unsupported MATH operation: "+b.operation),null}r.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);k=W(b);m=aa(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":h="MIX_RGB_MIX";break;case "ADD":h="MIX_RGB_ADD";break;case "MULTIPLY":h="MIX_RGB_MULTIPLY";break;case "SUBTRACT":h="MIX_RGB_SUBTRACT";break;case "SCREEN":h="MIX_RGB_SCREEN";
break;case "DIVIDE":h="MIX_RGB_DIVIDE";break;case "DIFFERENCE":h="MIX_RGB_DIFFERENCE";break;case "DARKEN":h="MIX_RGB_DARKEN";break;case "LIGHTEN":h="MIX_RGB_LIGHTEN";break;case "OVERLAY":h="MIX_RGB_OVERLAY";break;case "DODGE":h="MIX_RGB_DODGE";break;case "BURN":h="MIX_RGB_BURN";break;case "HUE":h="MIX_RGB_HUE";break;case "SATURATION":h="MIX_RGB_SATURATION";break;case "VALUE":h="MIX_RGB_VALUE";break;case "COLOR":h="MIX_RGB_COLOR";break;case "SOFT_LIGHT":h="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":h=
"MIX_RGB_LINEAR_LIGHT";break;default:return ga.error("Unsupported MIX_RGB blend type: "+b.blend_type),null}r.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);k=W(b);m=aa(b);break;case "OUTPUT":k=W(b);m=[];break;case "RGB":F=e+"%join%"+b.name;F={name:"-1",value:F};n.push(F);m.push(U(b,"Color"));break;case "SEPRGB":case "SEPHSV":k=W(b);m=aa(b);break;case "TEXTURE":h=S(b);if("TEXTURE_EMPTY"==h)m.push(U(b,"Color")),m.push(U(b,"Normal")),m.push(U(b,"Value"));else if("TEXTURE_ENVIRONMENT"==h)k.push(T(b,
"Vector")),m.push(U(b,"Color")),m.push(U(b,"Value"));else{if("TEXTURE_NORMAL"==h&&"ENVIRONMENT_MAP"==b.texture.type)return ga.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),null;for(p=0;4>p;++p)p?(I=R("Vector"+p,"Vector"+p,[0,0,0]),"TEXTURE_COLOR"==h&&(F=R("Color"+p,"Color"+p,[0,0,0]),w=R("Value"+p,"Value"+p,0)),"TEXTURE_NORMAL"==h&&(F=R("Normal"+p,"Normal"+p,[0,0,0]),w=R("Value"+p,"Value"+p,0))):(I=T(b,"Vector"),"TEXTURE_COLOR"==h&&(F=U(b,"Color"),w=U(b,"Value")),"TEXTURE_NORMAL"==h&&
(F=U(b,"Normal"),w=U(b,"Value"))),k.push(I),m.push(F),m.push(w)}w=M("param_TEXTURE_texture");n.push(Q(w));p={name:w,value:b.texture};break;case "VALTORGB":k=W(b);m=aa(b);ga.warn("VALTORGB node is not fully supported.");break;case "VALUE":h="VALUE";F=e+"%join%"+b.name;F={name:"-1",value:F};n.push(F);m.push(U(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":h="VECT_MATH_ADD";break;case "SUBTRACT":h="VECT_MATH_SUBTRACT";break;case "AVERAGE":h="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":h=
"VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":h="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":h="VECT_MATH_NORMALIZE";break;default:return ga.error("Unsupported VECT_MATH operation: "+b.operation),null}k=W(b);m=aa(b);break;default:k=W(b),m=aa(b)}h={name:f,type:h,Xf:l,C:k,qa:m,O:n,data:p,fd:r};f=P.Ej(a);P.yh(a,P.Ej(a),h);if(!(h="GEOMETRY"!=b.type&&"TEX_COORD"!=b.type)){a:{h=b.outputs;for(k=l=0;k<h.length;k++)if(h[k].is_linked&&l++>c){h=!0;break a}h=!1}h=!h}return h||null!=L(a,b,++c,d,e,g)?
f:null}function A(a,b,c){for(var d=a.inputs,e=a.outputs,g=a.node_tree_name,f=0;f<b.length;f++){var h=d[f],k=b[f];if(!h||h.default_value instanceof Array!=k)return ga.warn('Wrong inputs for custom node group "'+a.name+'" of type: "',g,'".Processing as general node group.'),!1}for(f=0;f<c.length;f++)if(b=e[f],d=c[f],!b||b.default_value instanceof Array!=d)return ga.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',g,'".Processing as general node group.'),!1;return!0}function J(a,b,
c){var e=a.node_group.node_tree,g={},f;for(f in e)if("links"==f||"nodes"==f){g[f]=[];for(var h=0;h<e[f].length;h++){g[f][h]={};for(var k in e[f][h])if("links"==f){g[f][h][k]={};for(var l in e[f][h][k])g[f][h][k][l]=N(e[f][h][k][l])}else g[f][h][k]=N(e[f][h][k])}}else g[f]=N(e[f]);e=a.node_tree_name;if("B4W_REPLACE"==e||"B4W_LEVELS_OF_QUALITY"==e)f=z("Group input","GROUP_INPUT",[],a.inputs),h=z("Group output","GROUP_OUTPUT",a.outputs,[]),k=null,k="B4W_REPLACE"==e||"B4W_LEVELS_OF_QUALITY"==e&&(kb.quality==
da.P_LOW||kb.Qn)?{from_node:f,from_socket:f.outputs[1],to_node:h,to_socket:h.inputs[0]}:{from_node:f,from_socket:f.outputs[0],to_node:h,to_socket:h.inputs[0]},g.nodes=[f,h],g.links=[k];e=a.name;f=g.nodes;h=g.links;for(k=0;k<f.length;k++)f[k].name=oa(f[k].type,e,f[k].name);for(k=0;k<h.length;k++)h[k].from_node.name=oa(h[k].from_node.type,e,h[k].from_node.name),h[k].to_node.name=oa(h[k].to_node.type,e,h[k].to_node.name);return{OB:d(g,a.node_group.uuid,!0,b,c),PB:g.links}}function N(a){var b=typeof a;
return"string"!=b&&"number"!=b&&"boolean"!=b&&a?O.dj(a):a}function M(a){ia[a]||(ia[a]=0);var b=a+ia[a],b=b.replace(/ /g,"_").replace(/\//g,"_");ia[a]++;return b}function y(a){a=a.outputs;for(var b=0;b<a.length;b++)if(a[b].is_linked)return!0;return!1}function K(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var g=c[e];if(g.is_linked&&!(d++<b))switch(g.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";
case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";case "Local":return"GEOMETRY_LO";case "Orco":return"GEOMETRY_OR";default:return null}}}function x(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var g=c[e];if(g.is_linked&&!(d++<b))switch(g.identifier){case "Camera":return"TEX_COORD_CA";case "Generated":return"TEX_COORD_GE";case "Normal":return"TEX_COORD_NO";case "Object":return"TEX_COORD_OB";case "Reflection":return"TEX_COORD_RE";case "UV":return"TEX_COORD_UV";case "Window":return"TEX_COORD_WI";
default:return null}}}function S(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,e=!1,g=0;g<b.length;g++){var f=b[g];if(f.is_linked)switch(f.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":e=!0;break;default:throw"Unknown texture output";}}if(c)return d&&ga.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(e)return"ENVIRONMENT_MAP"==
a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function T(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return fa(e)}return null}function U(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return fa(e)}return null}function fa(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=O.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,xb:d,Ia:a}}function R(a,b,c,d){return{name:a,identifier:b,xb:d||!1,Ia:c}}function W(a){for(var b=
[],c=0;c<a.inputs.length;c++){var d=fa(a.inputs[c]);d.Ia.length&&d.Ia.splice(3);b.push(d)}return b}function aa(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=fa(a.outputs[c]);b.push(d)}return b}function Q(a,b,c){b=null===b||void 0===b?null:Y.r(b,c);return{name:a,value:b}}function V(a,b,c,d,e,g){var f=[],h=g.from_socket.identifier;g=g.to_socket.identifier;var k=d.qa;for(d=0;d<k.length;d++)if(k[d].identifier==h){f.push(d);break}e=e.C;for(d=0;d<e.length;d++)if(e[d].identifier==g){f.push(d);break}2==
f.length&&P.Sb(a,b,c,f);return!0}function oa(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function ca(a){var b=[];P.W(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function ka(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.OB,g=c[d].data.PB;if(!e)return!1;P.W(e,function(b,c){P.yh(a,P.Ej(a),c)});for(e=0;e<g.length;e++)b.push(g[e]);I(c[d],b,a)}return!0}function la(a,b,c,d,e,g){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+
"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||g.push(c)}}function ba(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var g=c[e],f=null,h=0;h<b.length;h++)if(g.from_socket.identifier==b[h].to_socket.identifier){f=b[h];break}f?(g.from_node=f.from_node,g.from_socket=f.from_socket):d.push(g)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function ea(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function F(a,b,c,
d){for(var e=0;e<d.length;e++){for(var g=d[e],f,k=0;k<c.C.length;k++)if(g.from_socket.identifier==c.C[k].identifier){f=c.C[k].Ia;break}for(var k=g,l=b,m=f,n=h(k.to_node,l),p=0;p<n.length;p++)for(var r=P.Qa(l,n[p]),F=0;F<r.C.length;F++)if(r.C[F].identifier==k.to_socket.identifier){r.C[F].Ia=m;break}g=a.indexOf(g);-1!=g&&a.splice(g,1)}}function I(a,b,c){for(var d=a.name,e=[],g=[],f=[],h=[],k=0;k<b.length;k++){var l=b[k];la(l.from_node,d,l,e,f,h);la(l.to_node,d,l,g,f,h)}g=ba(b,g,f);e=ba(b,h,e);ea(b,
g);F(b,c,a,g);if(e.length){var m;P.W(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(m=b)});F(b,c,m,e)}}var da=q("__config"),P=q("__graph"),ua=q("__mat3"),ma=q("__mat4"),ha=q("__objects"),ga=q("__print"),Y=q("__shaders"),qa=q("__scenes"),O=q("__util"),E=q("__vec3"),ia={},ta={},Z={},Gb=0;new Float32Array(4);var kb=da.q;a.ky=d;a.tn=function(a,c,d){if(a in ta)return ta[a];var e=P.create(),g={name:"LIGHTING_BEGIN",type:"LIGHTING_BEGIN"},f=L(e,g,0,null,c,null),g={name:"LIGHTING_END",
type:"LIGHTING_END"},g=L(e,g,0,null,c,null);b(e,d,f,g,[[f,[8,10]],[f,[9,6]]],null,c);n(e);return ta[a]=e};a.al=function(a){var b=[],c={};ia={};var d=P.Jp(a);P.W(d,function(a,d){var e;e=[];for(var g=[],f=[],h=[],k=[],l=[],m=0;m<d.C.length;m++){var n=d.C[m];if(n.xb)e.push(null),g.push(null);else{e.push(M("in_"+d.type+"_"+n.identifier));var p=Y.r(n.Ia,0);kb.cu&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==n.identifier||"Color2"==n.identifier||"Fac"==n.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==
n.identifier||"Value_001"==n.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==n.identifier)&&(n=p,n=n.replace(/(,)/g,"$1 "),n=n.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),n=n.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),p=n=n.replace(/\s+/g,""));g.push(p)}}for(m=0;m<d.qa.length;m++)n=d.qa[m],n.xb?f.push(null):f.push(M("out_"+d.type+"_"+n.identifier));for(m=0;m<d.O.length;m++)n=d.O[m],h.push(n.name),k.push(n.value);for(m=0;m<d.Xf.length;m++)l.push(d.Xf[m].name);
e={id:d.type,C:e,oo:g,qa:f,O:h,Zl:k,Xf:l,fd:JSON.parse(JSON.stringify(d.fd))};b.push(e);c[a]=e});P.ee(d,function(a,b,e){var g=P.Qa(d,a);P.Qa(d,b);var f=g.qa[e[0]];a=c[a].qa;b=c[b].C;g=a[e[0]]||M("out_"+g.type+"_"+f.identifier);a[e[0]]=g;b[e[1]]=g});return b};a.$q=function(a){if(a.node_tree)for(var b=0;b<a.node_tree.nodes.length;b++){var c=a.node_tree.nodes[b];if("GROUP"==c.type&&"B4W_GLOW_OUTPUT"==c.node_tree_name)return!0}return!1};a.cleanup=function(){for(var a in ta)delete ta[a];for(var b in Z)delete Z[b];
Gb=0}};b4w.module.__animation=function(a,q){function d(a,b){var c=a.H[b];c&&c.On&&c.xj&&(c.xj=!1,c.On(a,b))}function c(a,b,c){c=a.H[c];c.type=30;var d=b.G,e=b.N-d+1;c.start=d;c.length=e;c.Fc=d;c.hg=b.name;for(e=d=0;e<a.Pb.length;e++){var g=a.Pb[e];if(g==b)break;else d+=g.N-g.G+1}c.Zu=d}function b(a,b,c){for(var d=a.aa,e=0;e<d.length;e++)for(var g=d[e].T,f=0;f<g.length;f++){var h=g[f].ra;if(h&&h.name==b){var k=a.H[c];k.type=50;k.hg=h.name;k.start=h.G;k.length=h.N-k.start;h.cyclic||(k.length+=h.Ao)}}}function l(a){return a.replace(/_B4W_BAKED$/,
"")}function f(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:ba.ka("Wrong animation behavior")}}function k(a){var b=[];a=a.J.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&n(d,b)}return b}function n(a,b){if(a.animation_data){var c=a.animation_data.action;c&&ba.Td(c.fcurves)&&b.push(c)}for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];e.node_group&&(e=e.node_group.node_tree)&&n(e,b)}}function r(a){return ba.is_mesh(a)&&a.f.Pb?
!0:!1}function e(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function g(a,b,c,e){D(a,b,c,e);d(a,c);a.f.df&&(m(a,b),v(a,b))}function h(a,b,c){var d=b.frame_range;if(d[0]>d[1])return Q.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;var e=b.k,g=a.H[c];g.hg=b.name;g.Lm=d;g.uq=e.WB;g.tq=e.Ax;g.Xk=e.Xk;g.start=d[0];g.length=d[1]-d[0];g.Fc=d[0];d=ba.Td(e.Tk);if(ba.is_armature(a)&&d){g.type=10;var f=p(a,b);f||(f=t(a,b,B(a)),a.ke.push(b,f));g.i=
f.i;g.Ga=f.Ga;var g=a.f,f=g.rm,h=a.H[c],e=h.mp,k;a:{k=g.hu;for(var l=0;l<k.length;l+=2)if(b==k[l]){k=k[l+1];break a}k=null}if(k)h.mp=k;else{for(h=0;h<f.length;h++)k=t(a,b,f[h].ad),e.push(k);g.hu.push(b,e)}g.df&&(b=g.xm,c>b[1]?(g=b[1],b[1]=c,b[0]=g):c>b[0]&&c<b[1]&&(b[0]=c),w(a))}else if(ca.Ee(a)&&(e.O.volume||e.O.pitch))g.volume=e.O.volume||null,g.pitch=e.O.pitch||null,g.type=40;else if("MESH"==a.type&&u(b)){g.type=60;e=p(a,b);if(!e){e=[];h=[];k=[];var l=[],m=b.k,n=a.f.Ll,r=a.f.Ml;for(f in m.O){var F=
b.name+"%join%"+f;H(f,F,m,h,e,n);H(f,F,m,l,k,r)}e={JE:e,values:h,zC:k,AC:l};a.ke.push(b,e)}g.ft=e.JE;g.ht=e.values;g.et=e.zC;g.gt=e.AC}else if(f=e.O.tsr){g.type=20;e=p(a,b);if(!e){e=b.k.nt;h=[];k=[];for(l=0;l<e;l++)h.push(f.subarray(8*l,8*l+4)),k.push(f.subarray(8*l+4,8*l+8));e={i:h,Ga:k};a.ke.push(b,e)}g.i=e.i;g.Ga=e.Ga;W.gi(a)&&W.pE(a,g.i[0],g.Ga[0])}else return Q.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;ba.is_armature(a)&&!d&&C(a,c);return!0}function p(a,
b){for(var c=a.ke,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function w(a){var b=a.f.xm;if(-1!=b[0]&&-1!=b[1]){var c=a.H;a=c[b[1]].Fc;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.Fc;d=Math.floor(a);b.Fc=d+e}}function C(a,b){var c=a.f.xm,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.H;0<=d;d--){var g=e[d];if(g&&10==g.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function B(a){var b=a.J;a=b.data.bones;for(var b=b.pose.bones,c={},d=0;d<a.length;d++){var e=a[d].name;c[e]={Oq:d,nj:d,Wo:ba.$n(b,
"name",e),dv:-1}}return c}function H(a,b,c,d,e,g){for(var f=0;f<g.length;f+=2)b==g[f]&&(e.push(g[f+1]),d.push(new Float32Array(c.O[a])))}function u(a){a=a.k;for(var b in a.O)if(-1!=b.indexOf("nodes"))return!0;return!1}function D(a,b,c,d){if((c=a.H[c])&&null!=c.type&&(c.play||d)){var e=a.f,g=c.Fc,f=c.start,h=c.length,g=g+c.speed*b*F.Pa,k=c.type,l=c.speed;if(0<=l&&g>=f+h||0>l&&g<f)switch(d||(c.xj=!0),c.behavior){case 10:g=0<=l?(g-f)%h+f:f+h-1E-6;break;case 20:g=0<=l?f:f+h-1E-6;c.play=!1;break;case 30:g=
0<=l?f+h-1E-6:f,c.play=!1}c.Fc=g;switch(k){case 10:if(!e.df){d=G(c,g,da);b=d[0];g=d[1];d=d[2];e.Qc=c.Ga[b];e.Pc=c.Ga[g];e.Xc=c.i[b];e.Wc=c.i[g];e.Ag=d;e=e.rm;c=c.mp;for(f=0;f<e.length;f++)h=e[f],k=c[f],h.Qc=k.Ga[b],h.Pc=k.Ga[g],h.Xc=k.i[b],h.Wc=k.i[g],h.Ag=d;ka.p(a)}break;case 20:h=d=G(c,g,da);(e=P)||(e=new Float32Array(4));var g=h[0],f=h[1],h=h[2],k=c.i,l=k[g][1],m=k[g][2],n=k[f][1],p=k[f][2];e[0]=(1-h)*k[g][0]+h*k[f][0];e[1]=(1-h)*l+h*n;e[2]=(1-h)*m+h*p;g=d;(f=ma)||(f=new Float32Array(4));h=c.Ga;
V.slerp(h[g[0]].subarray(0,4),h[g[1]].subarray(0,4),g[2],f);g=f;f=d[2];h=c.i;d=(1-f)*h[d[0]][3]+f*h[d[1]][3];c.Kp&&(f=ua,ka.get_translation(a,f),ba.smooth_v(e,f,b,c.Kp,e));c.ap&&(f=ha,ka.get_rotation(a,f),ba.nu(g,f,b,c.ap,g));c=c.Xk;c[0]&&ka.set_translation_rel(a,e);c[1]&&ka.set_rotation_rel(a,g);c[2]&&ka.set_scale_rel(a,d);ka.p(a);aa.sync_transform(a);break;case 30:(a=da)||(a=Array(3));g-=c.start;0>g&&(g=0);g>=c.length&&(g=c.length);b=Math.floor(g);d=b+1;g-=b;10!=c.behavior&&d==c.length&&(d=--b,
g=1);c=c.Zu;a[0]=b+c;a[1]=d+c;a[2]=g;d=da;e.Up=d[0];e.Yu=d[2];break;case 40:d=G(c,g,da);b=d[0];e=d[1];d=d[2];c.volume&&ca.set_volume(a,(1-d)*c.volume[b]+d*c.volume[e]);c.pitch&&ca.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[e]);break;case 50:W.YC(a,c.hg,g/F.Pa);break;case 60:d=G(c,g,da);b=d[0];e=d[1];d=d[2];k=c.ht;l=c.ft;g=c.gt;c=c.et;for(f=0;f<l.length;f++)m=k[f],h=l[f],a.f.He[h]=(1-d)*m[b]+d*m[e];for(f=0;f<c.length;f++)k=g[f],h=c[f],k=ea.lerp(k.subarray(3*b,3*b+3),k.subarray(3*e,3*e+3),d,P),a.f.Lc[h]=
k[0],a.f.Lc[h+1]=k[1],a.f.Lc[h+2]=k[2];break;default:ba.ka("Unknown animation type:"+k)}}}function G(a,b,c){c||(c=Array(3));var d=a.Lm[0],e=a.Lm[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.uq;e=Math.floor(b);a=a.tq[e]?b-e:0;b=Math.ceil(e+a);c[0]=e;c[1]=b;c[2]=a;return c}function v(a,b){var c=a.f,d=c.cf,e=c.xm,g=e[0],e=e[1];if(-1!=e){if(-1!=g){var f=a.H[g];if(f.play||0==b)var h=G(f,f.Fc,da),k=h[0],l=h[1],h=h[2],m=f.Ga[k],n=f.Ga[l],k=f.i[k],l=f.i[l];else d=1}else d=1;e=a.H[e];if(e.play||0==b)var h=G(e,e.Fc,
da),p=h[0],r=h[1],h=h[2];else if(-1!=g&&f.play)d=0;else return;g=e.Ga[p];f=e.Ga[r];p=e.i[p];e=e.i[r];if(1==d)c.Qc.set(g),c.Pc.set(f),c.Xc.set(p),c.Wc.set(e);else if(0==d)c.Qc.set(m),c.Pc.set(n),c.Xc.set(k),c.Wc.set(l);else{for(r=0;r<m.length;r+=4){for(var F=ma,x=ha,w=0;4>w;w++)F[w]=m[r+w],x[w]=g[r+w];V.slerp(F,x,d,F);for(w=0;4>w;w++)c.Qc[r+w]=F[w];for(w=0;4>w;w++)F[w]=n[r+w],x[w]=f[r+w];V.slerp(F,x,d,F);for(w=0;4>w;w++)c.Pc[r+w]=F[w]}ba.Lq(k,p,d,c.Xc);ba.Lq(l,e,d,c.Wc)}ka.p(a);d=c.rm;m=c.at;for(r=
0;r<d.length;r++){n=d[r];k=m[r];for(l=0;l<k.length;l+=2)for(p=k[l],g=k[l+1],f=0;4>f;f++)n.Qc[p+f]=c.Qc[g+f],n.Pc[p+f]=c.Pc[g+f],n.Xc[p+f]=c.Xc[g+f],n.Wc[p+f]=c.Wc[g+f];n.Ag=h}}}function m(a,b){var c=a.f,d=c.cf,e=c.Qm;if(0!=e){var d=c.Pm-d,g=e*b;ba.sign(d)==ba.sign(e)&&Math.abs(g)<Math.abs(d)?c.cf+=g:(c.cf=c.Pm,c.Qm=0)}}function t(a,b,c){for(var d=a.J.pose.bones,e=[],g=[],f=b.k.nt,h=0;h<f;h++){for(var k=0;k<d.length;k++){var l=d[k],m=la.create(),n=b.k.Tk[l.name];n&&la.copy(n.subarray(8*h,8*h+8),m);
l.qq=m;l.Ek=!1}k=z(a,c);e.push(k.i);g.push(k.Ga)}return{i:e,Ga:g}}function z(a,b){var c=[],d=[],e=a.J.pose.bones,g=new Float32Array(4),f=new Float32Array(4),h;for(h in b){var k=b[h],l=k.nj,m=e[k.Wo],k=g,n=f,p=m.Hw,r=p[p.length-1],F=r.Km;r.Ek||la.identity(F);for(r=p.length-1;0<=r;r--){var m=p[r],x=m.Km;if(m.Ek)F=x;else{var w=m.rq,q=m.qq;la.invert(w,ga);la.multiply(q,ga,ga);la.multiply(w,ga,ga);la.multiply(F,ga,x);F=x;m.Ek=!0}}m=m.Km;k[0]=m[0];k[1]=m[1];k[2]=m[2];k[3]=m[3];n[0]=m[4];n[1]=m[5];n[2]=
m[6];n[3]=m[7];V.normalize(n,n);for(k=0;4>k;k++)n=4*l+k,c[n]=g[k],d[n]=f[k]}c=new Float32Array(c);d=new Float32Array(d);return{i:c,Ga:d}}function L(a){var b=[0,0,0],c;for(c in a)"location"==c?b[0]=1:"rotation_quaternion"==c?b[1]=1:"scale"==c&&(b[2]=1);return b}function A(a,b,c,d,e,g,f){var h=a+(b-a)/2,k=J(h,d,e,g,f)-c;return.02>Math.abs(k)?h:0<k?A(a,h,c,d,e,g,f):A(h,b,c,d,e,g,f)}function J(a,b,c,d,e){var g=1-a;return b*g*g*g+3*c*g*g*a+3*d*g*a*a+e*a*a*a}function N(a,b){if(!a.H.length)for(var c=0;8>
c;c++)a.H.push(null);a.H[b]={type:null,hg:null,Lm:null,uq:0,tq:null,Xk:null,Ga:null,i:null,mp:[],play:!1,behavior:20,Fc:0,start:0,length:0,Kp:0,ap:0,xj:!1,Zu:null,speed:1,volume:null,pitch:null,ht:[],ft:[],gt:[],et:[]};a.ke=a.ke||[];-1==Y.indexOf(a)&&Y.push(a)}function M(a,b){ka.p(a);aa.sync_transform(a);g(a,0,b,!0)}function y(a,d,e){e=e||0;if(ba.is_mesh(a)){var g=T(a,d);if(g)return N(a,e),c(a,g,e),M(a,e),!0;if((g=U(a,d))&&"EMITTER"==g.So)return N(a,e),b(a,g.name,e),M(a,e),!0}if(g=ba.keysearch("name",
d,qa)||ba.keysearch("name",d+"_B4W_BAKED",qa)){N(a,e);if(h(a,g,e))return M(a,e),!0;a.H[e]=null}Q.error('Unsupported object: "'+a.name+'" or animation name: "'+d+'"');return!1}function K(a){var b=a.J;if("MESH"!=a.type||!b.data)return!1;a=b.data.materials;if(!a)return!1;for(b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&S(d))return!0}return!1}function x(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&
d&&S(d))return!0}return!1}function S(a){var b=a.animation_data;if(b&&(b.action||b.nla_tracks&&b.nla_tracks.length))return!0;a=a.nodes;for(b=0;b<a.length;b++){var c=a[b];if(c.node_group&&(c=c.node_group.node_tree)&&S(c))return!0}return!1}function T(a,b){for(var c=0;c<a.Pb.length;c++){var d=a.Pb[c];if(d.name===b)return d}return null}function U(a,b){for(var c=a.aa,d=0;d<c.length;d++)for(var e=c[d].T,g=0;g<e.length;g++){var f=e[g].ra;if(f&&f.name===b)return f}return null}function fa(a){a=a.modifiers;
for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}var R=q("__config"),W=q("__particles"),aa=q("__physics"),Q=q("__print"),V=q("__quat"),oa=q("__reformer"),ca=q("__sfx"),ka=q("__transform"),la=q("__tsr"),ba=q("__util"),ea=q("__vec3"),F=R.me,I=R.q;a.Gv=1E-6;a.OBJ_ANIM_TYPE_NONE=0;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.SLOT_0=0;a.SLOT_1=1;
a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var da=Array(3),P=new Float32Array(3),ua=new Float32Array(3),ma=new Float32Array(4),ha=new Float32Array(4),ga=new Float32Array(8);new Float32Array(16);var Y=[],qa=[];a.gs=function(){return ba.trunc((I.$s-50)/4)};a.frame_to_sec=function(a){return a/F.Pa};a.update=function(a){for(var b=0;b<Y.length;b++){for(var c=Y[b],e=0;8>e;e++)D(c,a,e);c.f.df&&(m(c,a),v(c,a))}for(b=
0;b<Y.length;b++)for(c=Y[b],e=0;8>e&&c.H.length;e++)d(c,e)};a.Yr=function(){return qa};a.get_anim_names=function(a){var b=[];if(r(a))for(var c=0;c<a.Pb.length;c++)b.push(a.Pb[c].name);var d,c=[];for(d=0;d<qa.length;d++){var e=qa[d],g=e.k;ba.Td(e.k.Tk)?"ARMATURE"==a.type&&c.push(e):g.O.volume||g.O.pitch?ca.Ee(a)&&c.push(e):!u(e)&&ba.Td(e.fcurves)&&c.push(e)}"MESH"==a.type&&(c=c.concat(k(a)));d=c;for(c=0;c<d.length;c++)b.push(l(d[c].name));if(W.gi(a)&&W.Qo(a))for(a=a.aa,c=0;c<a.length;c++)for(d=a[c].T,
e=0;e<d.length;e++)(g=d[e].ra)&&b.push(g.name);return b};a.BD=l;a.get_anim_type=function(a,b){var c=a.H[b];return c?c.type:0};a.apply_def=function(a){var d=a.J,e=0,g;g=a.J;var l=[],m=g.animation_data;if(m&&m.action&&(m=m.action,ba.Td(m.fcurves))){var n=ba.Td(m.k.Tk);"ARMATURE"!=a.type&&n||l.push(m)}ca.Ee(a)&&g.data.animation_data&&g.data.animation_data.action&&l.push(g.data.animation_data.action);"MESH"==a.type&&(l=l.concat(k(a)));g=l;m=a.aa;for(l=0;l<m.length;l++)for(var n=m[l].T,p=0;p<n.length;p++){var F=
n[p].ra;F&&"EMITTER"==F.So&&(N(a,e),b(a,F.name,e),M(a,e),a.H[e].behavior=f(d.b4w_anim_behavior),F.cyclic&&(a.H[e].behavior=10),e++)}for(l=0;l<g.length;l++)m=g[l],N(a,e),h(a,m,e)?(M(a,e),a.H[e].behavior=f(d.b4w_anim_behavior),e++):a.H[e]=null;r(a)&&(N(a,e),c(a,a.Pb[0],e),M(a,e),a.H[e].behavior=f(d.b4w_anim_behavior))};a.play=function(a,b,c){e(a.H,c,function(a){a.play=!0;a.On=b?b:null;a.xj=!1});a.f.df&&w(a)};a.stop=function(a,b){e(a.H,b,function(a){a.play=!1;a.On=null;a.xj=!1})};a.is_play=function(a,
b){var c=a.H[b];return c?c.play:!1};a.set_frame=function(a,b,c){var d=a.H;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.Fc=b,g(a,0,c,!0))}else if(e=d[c])e.Fc=b,g(a,0,c,!0)};a.get_current_frame_float=function(a,b){var c=a.H[b];return c&&c.Fc?c.Fc:0};a.is_cyclic=function(a,b){var c=a.H[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){e(a.H,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.H[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){e(a.H,d,function(a){a.Kp=
b||0;a.ap=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.H[c]=null;else a.H[b]=null;a.f.df&&C(a,b)};a.update_object_animation=g;a.pt=function(a){var b=a.J;if("ARMATURE"==a.type||a.Kk)return!0;var c=b.animation_data;return c&&c.action||"SPEAKER"==a.type&&b.data.animation_data&&b.data.animation_data.action||W.gi(a)&&W.Qo(a)||"MESH"==a.type&&a.Pb.length||K(a)?!0:!1};a.Pq=function(a){if("ARMATURE"==a.type||fa(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==
a.type&&a.data.animation_data&&a.data.animation_data.action||W.Ix(a)&&W.Hx(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||x(a)?!0:!1};a.is_animated=function(a){return Boolean(a.H.length)};a.Kx=B;a.Rq=z;a.Tw=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);V.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=4,e=0==b?3:b-1):-1<a.indexOf("scale")?(d=3,e=0):(d=0,e=b);return d+e}function d(a,b,c,e,h){if(-1<
c.search(g)){a=b;c=c.split('"')[1];var k=f}else 8==h?(c="tsr",k=f):k=1<h?new Float32Array(h):0;if(!a[c]){h=a;b=c;if("object"==typeof k&&k.length)for(var l=k.length,m=new Float32Array(e*l),n=0;n<e;n++)for(var p=0;p<l;p++)m[n*l+p]=k[p];else if("number"==typeof k)for(m=new Float32Array(e),n=0;n<e;n++)m[n]=k;else ba.ka("Wrong storage default value");h[b]=m}return a[c]}a.k={};var e=a.k;e.WB=1/F.Bg;var g=new RegExp(/pose.bones\[\".+\"\]/g),f=la.create(),h=a.fcurves,k={},l={},m=0,n;for(n in h){var p=h[n],
r;for(r in p){var x=p[r],w=x.Bc;oa.Rx(x,a);x=x.num_channels;m||(m=w.length);for(var x=d(k,l,n,m,x),q=x.length/m,v=c(n,r|0),t=0;t<m;t++)x[t*q+v]=w[t]}}for(var y in k)"tsr"==y&&b(k[y],m);for(var I in l)b(l[I],m);e.O=k;e.Tk=l;e.Ax=a.Gw;e.nt=m;e.Xk="tsr"in k?L(h):null;qa.push(a)};a.Yz=function(a,b){return(b-a)*F.Bg+1};a.ox=function(a,b,c,d,e,g){var f,h,k=new Float32Array(2),l=new Float32Array(2),m=new Float32Array(2),n=new Float32Array(2),p=b[1],r=b[2],x=b[a.last_frame_offset+1];a=b[a.last_frame_offset+
2];for(var w=0,q=0,v=null;e<=g;e++)if(e<p)for(var t=0;t<F.Bg;t++)c[w++]=r;else if(e>x)for(t=0;t<F.Bg;t++)c[w++]=a;else{var y=b[q],I=3;0===y&&(I+=2);0===v&&(I+=2);var u=2===y?0:1;if(b[q+1]==b[q+I+1])v=y,q+=I;else{t=0;e==b[q+1]&&(u&&(d[w]=1),c[w]=b[q+2],w++,t++);if(e==x)for(;t<F.Bg;t++)c[w++]=a;else for(k[0]=b[q+1],k[1]=b[q+2],0!==y?(l[0]=0,l[1]=0):0===v?(l[0]=b[q+5],l[1]=b[q+6]):(l[0]=b[q+3],l[1]=b[q+4]),0!==y?(m[0]=0,m[1]=0):(m[0]=b[q+I+3],m[1]=b[q+I+4]),n[0]=b[q+I+1],n[1]=b[q+I+2];t<F.Bg;t++){var G=
e+t/F.Bg;switch(y){case 0:f=k;h=l;var C=m,da=n,z=[],P=[],B=void 0,H=void 0,D=void 0,B=void 0;z[0]=f[0]-h[0];z[1]=f[1]-h[1];P[0]=da[0]-C[0];P[1]=da[1]-C[1];D=da[0]-f[0];B=Math.abs(z[0]);H=Math.abs(P[0]);0!=B+H&&B+H>D&&(B=D/(B+H),h[0]=f[0]-B*z[0],h[1]=f[1]-B*z[1],C[0]=da[0]-B*P[0],C[1]=da[1]-B*P[1]);u&&(d[w]=1);c[w]=J(A(0,1,G,k[0],l[0],m[0],n[0]),k[1],l[1],m[1],n[1]);w++;break;case 1:h=k[0];C=k[1];f=da=(n[1]-C)/(n[0]-h);h=C-da*h;u&&(d[w]=1);c[w]=f*G+h;w++;break;case 2:u&&(d[w]=1);c[w]=b[q+2];w++;break;
default:ba.ka("Unknown keyframe intepolation mode: "+y)}}e+1==b[q+I+1]&&(v=y,q+=I)}}};a.apply=y;a.jx=function(a,b,c){c=c||0;var d=ba.keysearch("uuid",b,qa);if(d){N(a,c);if(h(a,d,c)){M(a,c);return}a.H[c]=null}Q.error('Unsupported object: "'+a.name+'" or animation uuid: "'+b+'"')};a.KE=function(a,b){var c=ba.keysearch("name",b,qa)||ba.keysearch("name",b+"_B4W_BAKED",qa);if(c){if(!ba.Td(c.fcurves))return!1}else if(!(U(a,b)||ba.is_mesh(a)&&T(a,b)))return!1;return!0};a.get_slot_num_by_anim=function(a,
b){for(var c=a.H,d=0;d<c.length;d++){var e=c[d];if(e&&l(e.hg)==l(b))return d}return-1};a.Wz=function(a,b){var c=a.H[b];return c&&c.hg?l(c.hg):null};a.remove=function(a){a.H.length=0;a=Y.indexOf(a);-1!=a&&Y.splice(a,1)};a.pC=function(a){for(var b=qa.length-1;0<=b;b--)qa[b].Iw==a&&qa.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.H.length)return y(a,b,0)?0:-1;for(var c=0;c<a.H.length;c++)if(!a.H[c])return y(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.f.Qm=(b-a.f.cf)/c;a.f.Pm=
b};a.set_speed=function(a,b,c){e(a.H,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.H[b].speed};a.get_anim_start_frame=function(a,b){return a.H[b].start};a.get_anim_length=function(a,b){return a.H[b].length};a.BA=K;a.CG=x;a.cleanup=function(){Y.length=0;qa.length=0};a.yz=function(a){var b=(a[0]||a[1]||a[2]).Bc.length,c=ma,d=P,e=Boolean(a[0]);e||(a[0]={Bc:new Float32Array(b),num_channels:8});var g=Boolean(a[1]);g||(a[1]={Bc:new Float32Array(b),num_channels:8});var f=Boolean(a[2]);f||
(a[2]={Bc:new Float32Array(b),num_channels:8});a[3]={Bc:new Float32Array(b),num_channels:8};for(var h=0;h<b;h++)d[0]=e?a[0].Bc[h]:0,d[1]=g?a[1].Bc[h]:0,d[2]=f?a[2].Bc[h]:0,ba.euler_to_quat(d,c),a[0].Bc[h]=c[3],a[1].Bc[h]=c[0],a[2].Bc[h]=c[1],a[3].Bc[h]=c[2]};a.$r=fa};b4w.module.__time=function(a,q){q("__print");q("__util");var d=0,c=0,b=[],l=0,f=0,k=[];a.$t=function(a){d=a;c=performance.now();for(a=0;a<b.length;a++){var f=b[a];d>f.Kn&&(b.splice(a,1),a--,f.callback())}for(a=0;a<k.length;a++){var f=k[a],e=1-(f.Kn-d)/f.duration,e=Math.min(e,1);f.callback(f.X+e*(f.ya-f.X));1==e&&(k.splice(a,1),a--)}};a.get_timeline=function(){return d};a.set_timeout=function(a,f){var e;l++;e=l;b.push({id:e,callback:a,Kn:d+(performance.now()-c+f)/1E3});return e};a.clear_timeout=function(a){for(var c=
0;c<b.length;c++)if(b[c].id==a){b.splice(c,1);break}};a.clear_animation=function(a){for(var b=k.length;b--;)if(k[b].id==a){k.splice(b,1);break}};a.animate=function(a,b,c,g){c/=1E3;var h;f++;h=f;k.push({id:h,callback:g,X:a,ya:b,Kn:d+c,duration:c});g(a);return h};a.reset=function(){c=d=0;b.length=0;f=l=k.length=0}};b4w.module.__transform=function(a,q){function d(a,b){g.jd(a)?u.set_trans(b,g.hd(a)):m.copy(b,a.f.i)}function c(a,b){var c=a.f;if(g.jd(a)){u.set_quat(b,c.Ma);var d=g.tl(a),d=u.invert(d,A);u.multiply(d,c.Ma,g.hd(a))}else C.copy(b,c.quat)}function b(a,b){g.jd(a)?u.set_quat(b,g.hd(a)):C.copy(b,a.f.quat)}function l(a,b){g.jd(a)?u.copy(b,g.hd(a)):f(a,b)}function f(a,b){var c=a.f;c.i[0]=b[0];c.i[1]=b[1];c.i[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}function k(a,b){if(g.jd(a))u.copy(g.hd(a),
b);else{var c=a.f;u.set_sep(c.i,c.scale,c.quat,b)}return b}function n(a){var b=a.f,c=a.aa,d=a.type;"CAMERA"==d&&e.Op(a);g.dE(a,N);"CAMERA"==d&&e.aE(a);var f=b.i,k=b.scale,l=b.quat;u.set_sep(f,k,l,b.Ma);var m=b.Z;p.fromQuat(l,m);"CAMERA"!=d&&v.GC(m,k,m);m[12]=f[0];m[13]=f[1];m[14]=f[2];p.invert(m,b.Ds);b.Ib&&b.lb&&(r.cn(b.Ib,m,b.lb),r.en(b.bd,m,b.Jb),r.dn(b.ef,b.Ma,b.ig));switch(d){case "SPEAKER":H.rD(a,N);break;case "MESH":if(k=a.Kk)u.invert(k.f.Ma,A),u.multiply(A,b.Ma,A),t.set(A[0],A[1],A[2],A[3],
b.Sm),C.set(A[4],A[5],A[6],A[7],b.Rm);break;case "CAMERA":e.bE(a);B.ia()&&(k=B.get_active(),B.Fj(k)==a&&H.nB(k,f,l,N));break;case "LAMP":h.gE(a)}for(k=0;k<c.length;k++){var q=c[k];if(q.Dl){var m=q.Xb,z=m.k,J=q.T;switch(d){case "LAMP":B.Uf(a,m);break;case "CAMERA":B.IC(m);z.Zb&&z.Zb.enable_csm&&B.kp(m);break;case "MESH":b.Ib&&b.lb&&(b.Sc&&B.kp(m),z=q.jf,null!=b.cd&&z&&B.Nu(z,f));a.H.length&&w.Qo(a)&&w.eE(a,J);break;case "EMPTY":D.Ou(a)}q=q.Gf;J=a.dk;J.length&&q&&(z=q.j,B.Qu(q,f,l),G.Ru(J,z.gc),e.$C(z,
B.Fj(m)),v.pl(z.Gd,z.Bj))}}a=a.td;for(k=0;k<a.length;k++)n(a[k]);b.Sn=!0}var r=q("__boundings"),e=q("__camera"),g=q("__constraints"),h=q("__lights");q("__mat3");var p=q("__mat4"),w=q("__particles"),C=q("__quat"),B=q("__scenes"),H=q("__sfx"),u=q("__tsr"),D=q("__objects"),G=q("__obj_util"),v=q("__util"),m=q("__vec3"),t=q("__vec4"),z=new Float32Array(3),L=new Float32Array(4);new Float32Array(9);var A=u.create(),J=u.create(),N=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.SPACE_PARENT=2;a.update=function(a){N=
a};a.set_translation=function(a,b){var c=a.f;if(g.jd(a)){u.set_trans(b,c.Ma);var d=g.tl(a),d=u.invert(d,A);u.multiply(d,c.Ma,g.hd(a))}else m.copy(b,c.i)};a.set_translation_rel=d;a.get_translation=function(a,b){m.copy(a.f.i,b);return b};a.get_translation_rel=function(a,b){g.jd(a)?m.copy(u.get_trans_view(g.hd(a)),b):m.copy(a.f.i,b);return b};a.set_rotation=c;a.set_rotation_rel=b;a.get_rotation=function(a,b){C.copy(a.f.quat,b);return b};a.get_rotation_rel=function(a,b){g.jd(a)?C.copy(u.get_quat_view(g.hd(a)),
b):C.copy(a.f.quat,b);return b};a.set_rotation_euler=function(a,b){var d=v.euler_to_quat(b,L);c(a,d)};a.set_rotation_euler_rel=function(a,c){var d=v.euler_to_quat(c,L);b(a,d)};a.set_scale=function(a,b){var c=a.f;if(g.jd(a)){var c=g.hd(a),d=u.get_scale(g.tl(a));u.set_scale(b/d,c)}else c.scale=b};a.set_scale_rel=function(a,b){g.jd(a)?u.set_scale(b,g.hd(a)):a.f.scale=b};a.get_scale=function(a){return a.f.scale};a.get_scale_rel=function(a){return g.jd(a)?u.get_scale(g.hd(a)):a.f.scale};a.set_tsr=function(a,
b){var c=a.f;if(g.jd(a)){u.set_trans(trans,c.Ma);var d=g.tl(a),d=u.invert(d,A);u.multiply(d,c.Ma,g.hd(a))}else f(a,b)};a.set_tsr_rel=l;a.get_tsr=function(a,b){var c=a.f;u.set_sep(c.i,c.scale,c.quat,b);return b};a.get_tsr_rel=k;a.get_object_size=function(a){var b=a.f,c=b.Ah;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(a=a.f,m.copy(a.Jb.F,c)):(a=a.f,b=a.Ah,c[0]=
(b.max_x+b.min_x)/2,c[1]=(b.max_y+b.min_y)/2,c[2]=(b.max_z+b.min_z)/2,m.transformMat4(c,a.Z,c));return c};a.move_local=function(a,b,c,e){var g=k(a,A);z[0]=b;z[1]=c;z[2]=e;u.transform_vec3(z,g,z);d(a,z)};a.gp=function(a,b){var c=k(a,A),d=u.set_quat(b,u.identity(J));u.multiply(c,d,d);l(a,d)};a.p=n;a.distance=function(a,b){return m.dist(a.f.i,b.f.i)};a.RB=function(a,b){return m.dist(a.f.i,b)};a.get_object_bounding_box=function(a){return{max_x:a.f.lb.max_x,min_x:a.f.lb.min_x,max_y:a.f.lb.max_y,min_y:a.f.lb.min_y,
max_z:a.f.lb.max_z,min_z:a.f.lb.min_z}}};b4w.module.__tsr=function(a,q){function d(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3];return d}function c(a,b,c){var d=b[0],f=b[1],k=b[2],l=b[3],n=b[4],r=b[5],q=b[6];b=b[7];var G=a[0]*l,v=a[1]*l,m=a[2]*l;a=b*G+r*m-q*v;var l=b*v+q*G-n*m,t=b*m+n*v-r*G,G=-n*G-r*v-q*m;c[0]=a*b+G*-n+l*-q-t*-r;c[1]=l*b+G*-r+t*-n-a*-q;c[2]=t*b+G*-q+a*-r-l*-n;c[0]+=d;c[1]+=f;c[2]+=k;return c}var b=q("__mat4"),l=q("__quat"),f=q("__util"),k=q("__vec3"),n=new Float32Array(3),r=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.from_values=function(a,b,c,d,f,k,l,n){var r=new Float32Array(8);r[0]=a;r[1]=b;r[2]=c;r[3]=d;r[4]=f;r[5]=k;r[6]=l;r[7]=n;return r};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];return b};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.create_sep=function(a,b,c,f){f||(f=new Float32Array(8));d(a,b,c,f);return f};
a.set_sep=d;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set_scale=function(a,b){b[3]=a;return b};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set_quat=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3];return b};a.get_trans_view=function(a){return a.subarray(0,3)};a.get_scale=function(a){return a[3]};a.get_quat_view=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],f=a[1],k=a[2];r[0]=a[4];
r[1]=a[5];r[2]=a[6];r[3]=a[7];l.invert(r,r);var n=r[0],q=r[1],u=r[2],D=r[3],d=d*c,f=f*c,G=k*c,k=D*d+q*G-u*f,v=D*f+u*d-n*G,m=D*G+n*f-q*d,d=-n*d-q*f-u*G;b[0]=-(k*D+d*-n+v*-u-m*-q);b[1]=-(v*D+d*-q+m*-n-k*-u);b[2]=-(m*D+d*-u+k*-q-v*-n);b[3]=c;b[4]=n;b[5]=q;b[6]=u;b[7]=D;return b};a.to_mat4=function(a,c){var d=a[3];b.fromRotationTranslation(a.subarray(4),a.subarray(0,3),c);for(var f=0;12>f;f++)c[f]*=d;return c};a.from_mat4=function(a,b){var c=f.$h(a,n),k=f.Go(a),l=f.matrix_to_quat(a,r);d(c,k,l,b);return b};
a.multiply=function(a,b,d){c(b,a,d);d[3]=a[3]*b[3];var f=a[4],k=a[5],l=a[6];a=a[7];var n=b[4],r=b[5],q=b[6];b=b[7];d[4]=f*b+a*n+k*q-l*r;d[5]=k*b+a*r+l*n-f*q;d[6]=l*b+a*q+f*r-k*n;d[7]=a*b-f*n-k*r-l*q;return d};a.transform_vec3=c;a.transform_vec3_inv=function(a,b,c){var d=b[3],f=a[0]-b[0],k=a[1]-b[1],l=a[2]-b[2];a=b[4];var n=b[5],r=b[6];b=b[7];var q=a*a+n*n+r*r+b*b,q=q?1/q:0;a=-a*q;n=-n*q;r=-r*q;b*=q;var q=b*f+n*l-r*k,G=b*k+r*f-a*l,v=b*l+a*k-n*f,f=-a*f-n*k-r*l;c[0]=q*b+f*-a+G*-r-v*-n;c[1]=G*b+f*-n+
v*-a-q*-r;c[2]=v*b+f*-r+q*-n-G*-a;c[0]/=d;c[1]/=d;c[2]/=d;return c};a.transform_vectors=function(a,b,c,d){d||(d=0);var f=a.length,k=b[0],l=b[1],n=b[2],r=b[3],q=b[4],G=b[5],v=b[6];b=b[7];for(var m=0;m<f;m+=3){var t=a[m]*r,z=a[m+1]*r,L=a[m+2]*r,A=b*t+G*L-v*z,J=b*z+v*t-q*L,N=b*L+q*z-G*t,t=-q*t-G*z-v*L;c[d+m]=A*b+t*-q+J*-v-N*-G;c[d+m+1]=J*b+t*-G+N*-q-A*-v;c[d+m+2]=N*b+t*-v+A*-G-J*-q;c[d+m]+=k;c[d+m+1]+=l;c[d+m+2]+=n}return c};a.transform_dir_vectors=function(a,b,c,d){d||(d=0);var f=a.length,k=b[3],l=
b[4],n=b[5],r=b[6];b=b[7];for(var q=0;q<f;q+=3){var G=a[q]*k,v=a[q+1]*k,m=a[q+2]*k,t=b*G+n*m-r*v,z=b*v+r*G-l*m,L=b*m+l*v-n*G,G=-l*G-n*v-r*m;c[d+q]=t*b+G*-l+z*-r-L*-n;c[d+q+1]=z*b+G*-n+L*-l-t*-r;c[d+q+2]=L*b+G*-r+t*-n-z*-l}return c};a.transform_dir_vec3=function(a,b,c){var d=b[3],f=b[4],k=b[5],l=b[6];b=b[7];var n=a[0]*d,r=a[1]*d,q=a[2]*d;a=b*n+k*q-l*r;var d=b*r+l*n-f*q,G=b*q+f*r-k*n,n=-f*n-k*r-l*q;c[0]=a*b+n*-f+d*-l-G*-k;c[1]=d*b+n*-k+G*-f-a*-l;c[2]=G*b+n*-l+a*-k-d*-f;return c};a.transform_tangents=
function(a,b,c,d){d||(d=0);var f=a.length,k=b[3],l=b[4],n=b[5],r=b[6];b=b[7];for(var q=0;q<f;q+=4){var G=a[q]*k,v=a[q+1]*k,m=a[q+2]*k,t=b*G+n*m-r*v,z=b*v+r*G-l*m,L=b*m+l*v-n*G,G=-l*G-n*v-r*m;c[d+q]=t*b+G*-l+z*-r-L*-n;c[d+q+1]=z*b+G*-n+L*-l-t*-r;c[d+q+2]=L*b+G*-r+t*-n-z*-l;c[d+q+3]=a[q+3]}return c};a.translate=function(a,b,c){var d=a[3],f=a[4],k=a[5],l=a[6],n=a[7],r=b[0]*d,q=b[1]*d,G=b[2]*d;b=n*r+k*G-l*q;var d=n*q+l*r-f*G,v=n*G+f*q-k*r,r=-f*r-k*q-l*G;c[0]=a[0]+b*n+r*-f+d*-l-v*-k;c[1]=a[1]+d*n+r*-k+
v*-f-b*-l;c[2]=a[2]+v*n+r*-l+b*-k-d*-f;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,d){d||(d=new Float32Array(8));k.lerp(a.subarray(0,3),b.subarray(0,3),c,d.subarray(0,3));var f=a[3];d[3]=f+c*(b[3]-f);l.slerp(a.subarray(4),b.subarray(4),c,d.subarray(4));return d};a.fG=function(a,b,c,d){d||(d=new Float32Array(8));var f=a.subarray(0,3),k=b.subarray(0,3),n=d.subarray(0,3);n[0]=k[0]*(c+1)-f[0]*c;n[1]=k[1]*(c+1)-f[1]*c;n[2]=k[2]*(c+1)-f[2]*c;d[3]=b[3]*(c+1)-
a[3]*c;a=a.subarray(4);b=b.subarray(4);f=d.subarray(4);f[0]=b[0]*(c+1)-a[0]*c;f[1]=b[1]*(c+1)-a[1]*c;f[2]=b[2]*(c+1)-a[2]*c;f[3]=b[3]*(c+1)-a[3]*c;l.normalize(f,f);return d};a.LA=function(a,b,c,d,f){f[0]=a[0]+b*c[0];f[1]=a[1]+b*c[1];f[2]=a[2]+b*c[2];f[3]=a[3];c=d[0];var k=d[1];d=d[2];var l=a[4],n=a[5],r=a[6],q=a[7];f[4]=.5*(c*q+k*r-d*n);f[5]=.5*(k*q+d*l-c*r);f[6]=.5*(d*q+c*n-k*l);f[7]=.5*(-c*l-k*n-d*r);f[4]=a[4]+f[4]*b;f[5]=a[5]+f[5]*b;f[6]=a[6]+f[6]*b;f[7]=a[7]+f[7]*b;a=f[4];b=f[5];c=f[6];k=f[7];
a=a*a+b*b+c*c+k*k;0<a&&(a=1/Math.sqrt(a),f[4]*=a,f[5]*=a,f[6]*=a,f[7]*=a)}};b4w.module.__util=function(a,q){function d(a){return 0<a?1:0>a?-1:0}function c(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function b(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function l(a,b){var c=b;switch(typeof a){case "number":return f(a,c);case "string":return k(a,c);case "boolean":return f(a|0,c);case "function":case "undefined":return f(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==
a.byteLength)for(d=0;d<a.length;d++)c=f(a[d],c);else if(d)for(d=0;d<a.length;d++)c=l(a[d],c);else for(var e in a)c=l(a[e],c)}else c=f(0,c)}return c}function f(a,b){var c=b;S[0]=a;c=(c<<5)-c+T[0];c&=c;c=(c<<5)-c+T[1];return c&c}function k(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),c&=c;return c}function n(a){return(34*a+1)*a%289}function r(a){return a-Math.floor(a)}function e(a){return g((34*a+5)*a)}function g(a){return a-289*Math.floor(a/289)}function h(a){return a-7*Math.floor(a/
7)}function p(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function w(a){return p(a,0,2*Math.PI)}function C(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!B(a[c],b[c]))return!1}else if(d){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!B(a[f],
b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function B(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return C(a,b);default:return!0}}function H(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=
c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}var u=q("__mat3"),D=q("__mat4"),G=q("__print"),v=q("__quat"),m=q("__vec3"),t=q("__vec4"),z=0,L={},A=new Float32Array(3),J=new Float32Array(3),N=new Float32Array(4),M=new Float32Array(4),y=new Float32Array(9),K=new Float32Array(16),x=new Float32Array(16),S=new Float64Array(1),T=new Uint32Array(S.buffer),U=new Float32Array([0,0,0]),fa=new Float32Array([0,0,0,1]),R=new Float32Array([0,0,0,1,0,0,0,1]),W=new Float32Array([1,1,1]),aa=new Float32Array([1,
0,0]),Q=new Float32Array([0,1,0]),V=new Float32Array([0,0,1]),oa=new Float32Array([-1,0,0]),ca=new Float32Array([0,-1,0]),ka=new Float32Array([0,0,-1]),la=Math.floor(44488.07041494893),ba=[new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,
0,0,0,1])];a.Fw=U;a.zw=fa;a.pF=R;a.mq=W;a.AXIS_X=aa;a.AXIS_Y=Q;a.AXIS_Z=V;a.AXIS_MX=oa;a.AXIS_MY=ca;a.AXIS_MZ=ka;a.pv=ba;a.keyfind=function(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d};a.Az=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.QD=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Xx=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,
!0)};a.px=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.sign=d;a.TG=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.SG=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.$n=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==
c)return d;return-1};a.ix=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.MF=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.MD=function(a,b,c,d){d||(d=new Float32Array(16));D.identity(d);d[12]=a;d[13]=b;d[14]=c};var ea=1;a.mC=function(){ea=(69069*ea+5)%Math.pow(2,32);return Math.round(ea/65536)%32768/32767};a.xD=function(a){ea=a};a.md=function(a){var b=a[0]%la*48271-3399*Math.floor(a[0]/la);a[0]=0<b?b:b+2147483647;
return(a[0]-1)/2147483646};a.Bl=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),g=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.oz=function(a){var b=u.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),g=Math.sin(a[1]);a=Math.sin(a[2]);var h=c*e,k=c*a,l=f*e,m=
f*a;b[0]=d*e;b[1]=d*a;b[2]=-g;b[3]=g*l-k;b[4]=g*m+h;b[5]=d*f;b[6]=g*h+m;b[7]=g*k-l;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=e*e,h=c*d+e*f;.499999<h?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=Math.PI/2):-.499999>h?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*g),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*g),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));m.transformQuat(b,a,c);return c};
a.aG=function(a,b,c){c||(c=new Float32Array(4));a=m.normalize(a,A);var d=m.dot(b,a);a=m.cross(b,a,J);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.ND=function(a,b,c,d){d||(d=new Float32Array(4));m.transformQuat(c,b,d);d[3]=-m.dot(a,d)};a.gz=function(a){var b=a.f.quat;switch(a.type){case "CAMERA":A[0]=0;A[1]=-1;A[2]=0;m.transformQuat(A,b,A);J[0]=0;J[1]=0;J[2]=-1;break;case "MESH":A[0]=0;A[1]=0;A[2]=1;m.transformQuat(A,b,A);J[0]=
0;J[1]=0;J[2]=1;break;case "EMPTY":A[0]=0,A[1]=1,A[2]=0,m.transformQuat(A,b,A),J[0]=0,J[1]=1,J[2]=0}A[1]=0;m.normalize(A,A);a=m.dot(A,J);return Math.acos(a)*(0<-A[0]*J[2]?-1:1)};a.Lq=function(a,b,c,d){if(0!=c){d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.vH=function(){z++;return z.toString(16)};a.Ii=function(a){L[a]||(L[a]=0);var b=a+L[a];L[a]++;return b};a.ud=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.vb=function(a){var b=
{a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,P:0,oa:null,B:[],M:b,ba:[]}};a.mg=function(a){return JSON.parse(JSON.stringify(a))};a.ma=function(b){if(!(b instanceof Object))return b;var c;c=b.constructor;switch(c){case Float32Array:case Uint32Array:case Uint16Array:c=new c(b);break;case Array:c=new c(b.length);for(var d=0;d<b.length;d++)c[d]=a.ma(b[d]);break;default:for(d in c=new c,b)c[d]=a.ma(b[d])}return c};a.dj=function(a){var b=a instanceof
Array?[]:{},c;for(c in a)if(a[c]instanceof Object){var d=a[c].constructor;switch(d){case Float32Array:case Uint32Array:case Uint16Array:b[c]=new d(a[c]);break;case Array:b[c]=a[c].slice(0);break;default:b[c]=a[c]}}else b[c]=a[c];return b};a.is_mesh=function(a){return"MESH"===a.type};a.El=function(a){return"EMPTY"===a.type};a.is_armature=function(a){return"ARMATURE"===a.type};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));u.fromMat4(a,y);var c=y[0],d=y[3],e=y[6],f=y[1],g=y[4],h=y[7],k=y[2],
l=y[5],m=y[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+g*g+h*h)||1,k=Math.sqrt(k*k+l*l+m*m)||1;y[0]/=c;y[3]/=c;y[6]/=c;y[1]/=f;y[4]/=f;y[7]/=f;y[2]/=k;y[5]/=k;y[8]/=k;v.fromMat3(y,b);return b};a.$h=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.Go=function(a){N[0]=.577350269189626;N[1]=.577350269189626;N[2]=.577350269189626;N[3]=0;t.transformMat4(N,a,N);return t.length(N)};a.pl=function(a,b){var d=b.left,e=b.right,f=b.top,g=b.bottom,h=b.gb,k=b.eb;d[0]=a[3]+
a[0];d[1]=a[7]+a[4];d[2]=a[11]+a[8];d[3]=a[15]+a[12];e[0]=a[3]-a[0];e[1]=a[7]-a[4];e[2]=a[11]-a[8];e[3]=a[15]-a[12];f[0]=a[3]-a[1];f[1]=a[7]-a[5];f[2]=a[11]-a[9];f[3]=a[15]-a[13];g[0]=a[3]+a[1];g[1]=a[7]+a[5];g[2]=a[11]+a[9];g[3]=a[15]+a[13];h[0]=a[3]+a[2];h[1]=a[7]+a[6];h[2]=a[11]+a[10];h[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];c(d);c(e);c(f);c(g);c(h);c(k)};a.sD=function(a,c,d){return d<-b(a,c.left)||d<-b(a,c.right)||d<-b(a,c.top)||d<-b(a,c.bottom)||d<-b(a,
c.gb)||d<-b(a,c.eb)?!0:!1};a.mz=function(a,c,d,e,f){g=m.dot(d,c.eb);h=m.dot(e,c.eb);k=m.dot(f,c.eb);g=Math.sqrt(g*g+h*h+k*k);if(g<-b(a,c.gb)||g<-b(a,c.eb))return!0;var g=m.dot(d,c.left),h=m.dot(e,c.left),k=m.dot(f,c.left);if(Math.sqrt(g*g+h*h+k*k)<-b(a,c.left))return!0;g=m.dot(d,c.right);h=m.dot(e,c.right);k=m.dot(f,c.right);if(Math.sqrt(g*g+h*h+k*k)<-b(a,c.right))return!0;g=m.dot(d,c.top);h=m.dot(e,c.top);k=m.dot(f,c.top);if(Math.sqrt(g*g+h*h+k*k)<-b(a,c.top))return!0;g=m.dot(d,c.bottom);h=m.dot(e,
c.bottom);k=m.dot(f,c.bottom);return Math.sqrt(g*g+h*h+k*k)<-b(a,c.bottom)?!0:!1};a.Hf=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*k+b[13];c[d+f+2]=b[2]*g+b[6]*h+b[10]*k+b[14]}};a.NE=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k}};a.JD=function(a,b,c){for(var d=0,d=
0,e=a.length,f=0;f<e;f+=4){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k;c[d+f+3]=a[f+3]}};a.LE=function(a,b,c){c||(c=new Float32Array(3));N[0]=a[0];N[1]=a[1];N[2]=a[2];N[3]=0;t.transformMat4(N,b,N);c[0]=N[0];c[1]=N[1];c[2]=N[2]};a.iG=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=
0;f<d;f++)b[e*d+f]=a[e][f];return b};a.ME=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.Pk=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.Pk(b,c,d,f-1):b[f]<c?a.Pk(b,c,f+1,e):f};a.hf=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.NF=function(a,b,c){for(var d=0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;return!0};a.GC=function(a,b,c){c||(c=new Float32Array(16));for(var d=
0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.Lp=function(a,b,c,d){d||(d=new Float32Array(16));b=D.fromRotationTranslation(b,c,K);D.multiply(b,a,d)};a.transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));c=D.fromRotationTranslation(c,d,K);1!==b&&(d=D.identity(x),b=m.set(b,b,b,A),D.scale(d,b,d),D.multiply(c,d,c));m.transformMat4(a,c,e);return e};a.Mp=function(a,b,c,d){d||(d=new Float32Array(4));b=D.fromRotationTranslation(b,c,K);t.transformMat4(a,b,d)};a.LG=function(a,
b,c,d,e){e||(e=new Float32Array(3));b=D.fromRotationTranslation(c,d,K);D.invert(b,b);m.transformMat4(a,b,e);return e};a.tH=function(a,b,c){c||(c=new Float32Array(16));D.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.bH=function(b,c,d){a.$h(b,c);c[3]=a.Go(b);a.matrix_to_quat(b,d)};a.vF=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.BC=function(a,b,c,d){d||(d=new Float32Array(3));m.subtract(b,a,A);m.transformQuat(A,c,A);m.subtract(b,
A,d)};a.Lz=function(){A[0]=0;A[1]=0;A[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16);D.lookAt(A,[-1,0,0],[0,-1,0],a);D.scale(a,[-1,1,1],a);D.scale(a,[-1,1,-1],b);D.lookAt(A,[0,-1,0],[0,0,-1],c);D.scale(c,[1,1,-1],c);D.scale(c,[1,-1,-1],d);D.lookAt(A,[0,0,-1],[0,-1,0],e);D.scale(e,[-1,1,1],e);D.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.Pz=function(){A[0]=0;A[1]=0;A[2]=0;var a=new Float32Array(16),
b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16);D.lookAt(A,[1,0,0],[0,-1,0],a);D.scale(a,[-1,1,-1],b);D.lookAt(A,[0,1,0],[0,0,1],c);D.scale(c,[1,-1,-1],d);D.lookAt(A,[0,0,1],[0,-1,0],e);D.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.Ch=function(a,b){return l(a,b)};a.hash_code=l;a.GG=k;a.aH=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,k,l,m,n,p,r,q,x,w;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*
b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];h=a[2];k=a[3];l=a[4];m=a[5];n=a[6];p=a[7];r=a[8];q=a[9];x=a[10];w=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=k;c[4]=l;c[5]=m;c[6]=n;c[7]=p;c[8]=r;c[9]=q;c[10]=x;c[11]=w;c[12]=f*d+l*e+r*b+a[12];c[13]=g*d+m*e+q*b+a[13];c[14]=h*d+n*e+x*b+a[14];c[15]=k*d+p*e+w*b+a[15];return c};a.AB=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=
a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.gm=function(a){return a*Math.PI/180};a.cz=function(a){return 180*a/Math.PI};a.pp=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*
c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=b>a?1:0,g=1-f,e=b+.211324865405187-f,h=a+.211324865405187-g,k=b+-.577350269189626,l=a+-.577350269189626,c=c%289,d=d%289,m=n(n(d)+c),g=n(n(d+g)+c+f),p=n(n(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+h*h),0),f=Math.max(.5-(k*k+l*l),0),q=2*r(.024390243902439*m)-1,x=2*r(.024390243902439*g)-1,w=2*r(.024390243902439*p)-1,m=Math.abs(q)-.5,g=Math.abs(x)-.5,p=Math.abs(w)-.5,q=q-Math.floor(q+.5),x=x-Math.floor(x+.5),w=w-Math.floor(w+.5),c=c*c*c*c*
(1.79284291400159-.85373472095314*(q*q+m*m)),d=d*d*d*d*(1.79284291400159-.85373472095314*(x*x+g*g)),f=f*f*f*f*(1.79284291400159-.85373472095314*(w*w+p*p));return 130*(c*(q*b+m*a)+d*(x*e+g*h)+f*(w*k+p*l))};a.Xq=function(a){var b=1/7,c=b/2,d=g(Math.floor(a[0])),f=g(Math.floor(a[1])),k=r(a[0]);a=r(a[1]);var l=k-.5,m=k-1.5,k=a-.5;a-=1.5;var n=e(d),p=e(d+1),q=n,d=p,n=e(n+f),p=e(p+f),q=e(q+f+1),d=e(d+f+1),f=l+.7*(h(n)*b+c),x=m+.7*(h(p)*b+c),l=l+.7*(h(q)*b+c),m=m+.7*(h(d)*b+c),n=k+.7*(h(Math.floor(n*b))*
b+c),k=k+.7*(h(Math.floor(p*b))*b+c),q=a+.7*(h(Math.floor(q*b))*b+c),b=a+.7*(h(Math.floor(d*b))*b+c);return Math.min(f*f+n*n,x*x+k*k,l*l+q*q,m*m+b*b)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=m.transformQuat(b,a,A);b=c[0];var f=c[1];c=c[2];y[0]=f*f+c*c;y[1]=-f*b;y[2]=-c*b;y[3]=-b*f;y[4]=b*b+c*c;y[5]=-c*f;y[6]=-b*c;y[7]=-f*c;y[8]=b*b+f*f;m.transformMat3(a,y,a);m.normalize(a,a);v.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=
N,d=M,c=v.setAxisAngle([0,1,0],Math.PI,v.create()),d=v.setAxisAngle([1,0,0],Math.PI/2,v.create());v.multiply(c,d,c);v.multiply(a,c,b);return b};a.cleanup=function(){z=0;L={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.nu=function(a,b,c,d,e){e||(e=new Float32Array(a.length));v.slerp(a,
b,Math.exp(-c/d),e)};a.MG=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=u.fromQuat(a,y);J[0]=0;J[1]=1;J[2]=0;A[0]=c[3];A[1]=c[4];A[2]=c[5];var d=m.cross(J,A,A);m.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);J[0]=c[0];J[1]=c[1];J[2]=c[2];m.normalize(J,J);v.rotationTo(J,
d,M);v.multiply(M,a,a)};a.Zr=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],k=a[e*b+Math.min(c+1,g)],l=a[Math.min(e+1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+k*d)*(1-f)+(l*(1-d)+a*d)*f};a.ih=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.St=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.ek=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&
0<(a&2)&&c++;return c};a.Vr=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.Td=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];m.normalize(c,c)};a.OD=function(a,b,c){var d=a[0],
e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var k=g*a-h*e,l=h*d-f*a,m=f*e-g*d,n=g*m-h*l,h=h*k-f*m,f=f*l-g*k;c[0]=d+2*k*b+2*n;c[1]=e+2*l*b+2*h;c[2]=a+2*m*b+2*f};a.assert=function(a){if(!a)throw Error("Assertion failed");};a.ka=function(a){a&&G.error.apply(G,arguments);throw"panic: see above for possible error messages";};a.angle_wrap_periodic=p;a.angle_wrap_0_2pi=w;a.Yn=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.zu=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=
e==f;break;case "object":d=C(e,f)}if(!d)return!1}return!0};a.$o=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.Ur=function(a){a+=1;132651<a&&G.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d,e){N.set(a);N[3]=b;M.set(d);M[3]=0;a=t.dot(N,M);if(0==a)return null;M.set(c);M[3]=1;a=-t.dot(N,M)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};
a.mA=function(a,b,c,d){var e=b[0]-a[0],f=c[0]-a[0],g=b[1]-a[1],h=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=g*a-b*h;d[1]=f*b-e*a;d[2]=e*h-g*f;return d};a.PF=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.DC=function(a,b,c){var d=m.dot(a,b);-.9999999>d?(m.cross(aa,a,A),1E-6>m.length(A)&&m.cross(Q,a,A),m.normalize(A,A),v.setAxisAngle(A,Math.PI,c)):(m.cross(a,b,A),c.set(A),c[3]=1+d,v.normalize(c,c));return c};a.ff=function(a,b,c){if(b==c)return c-a;a=w(a);b=w(b);c=w(c);var d=Math.abs(b-c);
if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-b;c=w(c+b);a=w(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a,b,c){isFinite(b)&&isFinite(c)&&(a=clamp(a,b,c));return a*a*(3-2*a)};a.lerp=function(a,b,c){return b+a*(c-b)};a.qx=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(b[d]==a[c])return!0;return!1};a.VF=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=0;return b};a.bv=function(a,b){for(var c=Math.max(a.length,b.length),e=0;e<c;e++){var f=
d((e>=a.length?0:a[e])-(e>=b.length?0:b[e]));if(f)return f}return 0};a.Wf=function(a){return a.join(".")};a.xu=function(a){return a.split(".").map(function(a){return a|0})};a.tu=function(a,b){b[0]=Math.pow(a[0],2.2);b[1]=Math.pow(a[1],2.2);b[2]=Math.pow(a[2],2.2)};a.Bo=function(a,b){b[0]=Math.pow(a[0],1/2.2);b[1]=Math.pow(a[1],1/2.2);b[2]=Math.pow(a[2],1/2.2);return b};a.Rj=function(a){var b=a.split("://",2);return 1<b.length?(b[1]=H(b[1]),b.join("://")):H(a)}};b4w.module.__sfx=function(a,q){function d(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;B.warn("deprecated WebAudio implementation");return null}B.warn("WebAudio is not supported");return null}function c(a,c,d){var e=a.w;if("NONE"!=e.behavior){d||(d=0);var g=e.loop,h=e.pitch;if(e.src&&(g||0<=d)){e.Um=Math.floor(5E4*Math.random());var l=J.currentTime+c;e.Tc=l;e.state=20;b(a);"POSITIONAL"==e.behavior||"BACKGROUND_SOUND"==e.behavior?(c=J.createBufferSource(),
c.buffer=e.src,c.playbackRate.value=h,g?(e.zb&&e.zb.disconnect(),c.loop=!0,c.start(l),e.duration=0):(g=c.buffer?c.buffer.duration:0,d>g?(g=l+d+e.Hc,c.loop=!0,c.start(l),c.stop(g),e.duration=d):(c.loop=!1,c.start(l),e.duration=g)),c.connect(e.rc),e.zb=c,f(e),k(e)):"BACKGROUND_MUSIC"==e.behavior&&(H.clear_timeout(e.Ym),H.clear_timeout(e.Zm),d=function(){var b=a.w,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.zb=b.zb||J.createMediaElementSource(c),b.zb.connect(b.rc),20==b.state&&(c.currentTime&&(c.currentTime=
0),c.play()))},0==c?d():e.Ym=H.set_timeout(d,1E3*c),e.duration=g?0:w(a));n(e,l)}}}function b(a){var b=a.w;if(!b.rc){var c=a.f.i;a=a.f.quat;if(v.Nl){var d=J.createBiquadFilter();d.type="peaking"}else d=null;var e=J.createGain();switch(b.behavior){case "POSITIONAL":var f=J.createPanner();"string"!=typeof f.panningModel?(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],c[1],c[2]);D.copy(c,b.yo);c=m;u.quat_to_dir(a,
u.AXIS_MY,c);f.setOrientation(c[0],c[1],c[2]);D.copy(c,b.direction);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.jr;f.coneOuterAngle=b.kr;f.coneOuterGain=b.lr;var g=J.createGain();g.gain.value=p(b);d?(f.connect(d),d.connect(g)):f.connect(g);g.connect(e);b.rc=f;if(b.rh){var h=J.createGain();e.connect(h);h.connect(J?N.da.rc:null)}else h=null,e.connect(J?N.da.rc:null);break;case "BACKGROUND_SOUND":f=null;g=J.createGain();g.gain.value=p(b);d?(b.rc=
d,d.connect(g)):b.rc=g;g.connect(e);b.rh?(h=J.createGain(),e.connect(h),h.connect(J?N.da.rc:null)):(h=null,e.connect(J?N.da.rc:null));break;case "BACKGROUND_MUSIC":h=f=null,g=J.createGain(),g.gain.value=p(b),d?(b.rc=d,d.connect(g)):b.rc=g,g.connect(e),e.connect(J?N.da.rc:null)}b.Wj=f;b.Sd=d;b.Ph=g;b.wg=e;b.Ht=h}}function l(a){var b=a.w,d=b.duration,b=b.delay+b.Br*Math.random();c(a,b,d)}function f(a){a.rh&&a.Ht.gain.cancelScheduledValues(a.Tc);a.ii&&a.zb.playbackRate.cancelScheduledValues(a.Tc);a.tk=
a.Tc}function k(a){if(a.rh||a.ii){var b=a.Ht,c=a.zb,d=c.buffer?c.buffer.duration:0;if(d){var e=a.Tc;y[0]=a.Um;for(var f=0;5>f;){var g=a.pitch+a.ii*u.md(y);if(e>=a.tk){if(a.rh){var h=1-u.clamp(a.rh,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.ii&&c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.tk=e-.001}}}function n(a,b){if(a.xg||a.Hc){var c=a.wg;c.gain.cancelScheduledValues(b);a.xg?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.xg)):c.gain.setValueAtTime(1,b);a.Hc&&!a.loop&&(c.gain.setValueAtTime(1,
b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.Hc))}}function r(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.w;if(20==b.state||40==b.state){var c=b.wg,d=J.currentTime;b.Hc&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.Hc));"BACKGROUND_MUSIC"==b.behavior?b.src&&(H.clear_timeout(b.Ym),H.clear_timeout(b.Zm),b.Zm=H.set_timeout(function(){var b=a.w.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.Hc)):(c=b.zb,b.duration<c.buffer.duration?
b.Hc&&20==b.state?c.stop(d+b.Hc):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),b.Tc=0,b.To=0,b.fn=0);b.state=30}}function e(a){a=a.w;if(20==a.state){var b=J.currentTime;a.To=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.Tc){y[0]=a.Um;for(var d=a.zb.buffer.duration,e=a.Tc;e<b;)c=a.pitch+a.ii*u.md(y),e+=d/c;c*=d/c-(e-b)}else c=0;a.fn=c;a.zb.stop(0);a.zb.disconnect();f(a)}a.state=40}}function g(a){var b=a.w;if(40==b.state){var c=J.currentTime;b.Tc+=c-b.To;if("BACKGROUND_MUSIC"==
b.behavior)b.src.play();else{a=a.w;var d=J.createBufferSource();d.loop=a.zb.loop;d.buffer=a.zb.buffer;d.playbackRate.value=a.zb.playbackRate.value;a.Wj?d.connect(a.Wj):d.connect(a.Ph);a.zb=d;b.tk=c;b.zb.start(b.Tc,b.fn);k(b)}n(b,b.Tc);b.state=20}}function h(a){return!a.w||20!=a.w.state&&40!=a.w.state&&30!=a.w.state?!1:!0}function p(a){return a.muted?0:a.volume}function w(a){a=a.w;return(a=a.src)?a.duration:0}var C=q("__config"),B=q("__print"),H=q("__time"),u=q("__util"),D=q("__vec3"),G=C.q,v=C.w;
a.eq=10;a.Em=20;a.dq=30;var m=new Float32Array(3),t=new Float32Array(3),z=new Float32Array(3),L=[],A=[],J=null,N=null,M=[],y=[1],K=null;a.Iy=function(){return{behavior:"NONE",tg:!1,muted:!1,volume:1,pitch:1,attenuation:1,dist_ref:1,dist_max:1E4,jr:360,kr:360,lr:1,cyclic:!1,loop:!1,delay:0,Br:0,rh:0,ii:0,xg:0,Hc:0,Tc:0,To:0,fn:0,duration:0,tk:0,Um:1,src:null,state:10,yo:new Float32Array(3),direction:new Float32Array(3),sp:new Float32Array(3),Ym:-1,Zm:-1,vg:0}};a.init=function(){var a=document.createElement("audio"),
b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(L.push("ogg"),L.push("ogv")),""!=a.canPlayType("audio/mpeg")&&L.push("mp3"),""!=a.canPlayType("audio/mp4")&&(L.push("mp4"),L.push("m4v")),""!=a.canPlayType("audio/webm")&&L.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&A.push("ogv"),""!=b.canPlayType("video/mp4")&&A.push("m4v"),""!=b.canPlayType("video/webm")&&A.push("webm"));(J=v.$p?d():null)&&B.log("%cINIT WEBAUDIO: "+J.sampleRate+"Hz","color: #00a")};
a.Dq=function(a){var b={Og:new Float32Array(3),Vs:new Float32Array(3),Zh:new Float32Array(3)};a.da=b;if(J){var c=J.createGain(),d=J.createGain();b.Ph=c;b.wg=d;c.connect(d);d.connect(J.destination);if(a.b4w_enable_dynamic_compressor){var d=J.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.jj=d;b.rc=d}else b.jj=null,b.rc=c;c=J.listener;b.tg=G.En;b.tg||
(c.dopplerFactor=a.audio_doppler_factor,c.speedOfSound=a.audio_doppler_speed);b.muted=!1;b.volume=1;b.vg=0}};a.LC=function(a){N=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<L.indexOf(a)?a:"ogg"==a&&-1<L.indexOf("mp4")?"mp4":"mp3"==a&&-1<L.indexOf("ogg")?"ogg":"mp4"==a&&-1<L.indexOf("ogg")?"ogg":"ogv"==a&&-1<L.indexOf("m4v")?"m4v":"webm"==a&&-1<L.indexOf("m4v")?"m4v":"m4v"==a&&-1<L.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<A.indexOf(a)?
a:"ogv"==a&&-1<A.indexOf("m4v")?"m4v":"webm"==a&&-1<A.indexOf("m4v")?"m4v":"m4v"==a&&-1<A.indexOf("webm")?"webm":""};a.Pp=function(a,b){if("SPEAKER"!=b.type)throw"Wrong speaker object";var c=a.data,d=b.w;switch(c.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":d.behavior=J?c.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var e;J?(window.MediaElementAudioSourceNode?e=!0:(B.warn("MediaElementAudioSourceNode not found"),e=!1),e=e?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):e="NONE";d.behavior=
e;break;default:throw"Wrong speaker behavior";}c.sound||(d.behavior="NONE");d.tg=c.b4w_disable_doppler||G.En;d.muted=c.muted;d.volume=c.volume;d.pitch=c.pitch;d.attenuation=c.attenuation;d.dist_ref=c.distance_reference;d.dist_max=c.distance_max||1E4;d.jr=c.cone_angle_inner;d.kr=c.cone_angle_outer;d.lr=c.cone_volume_outer;d.cyclic=c.b4w_cyclic_play;d.loop=c.b4w_loop;d.delay=c.b4w_delay;d.Br=c.b4w_delay_random;d.rh=c.b4w_volume_random;d.ii=c.b4w_pitch_random;d.xg=c.b4w_fade_in;d.Hc=c.b4w_fade_out;M.push(b)};
a.pu=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.w.behavior){case "POSITIONAL":return a.Em;case "BACKGROUND_SOUND":return a.Em;case "BACKGROUND_MUSIC":return a.dq;case "NONE":return a.eq;default:throw"Wrong speaker behavior";}};a.oE=function(a,b){var c=a.w;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.cC=function(){var a=J.createBufferSource();a.buffer=J.createBuffer(1,
22050,22050);a.connect(J.destination);a.start(0)};a.$y=function(a,b,c){J?J.decodeAudioData(a,b,c):c()};a.pD=function(a){r(a);a.w=null;M.splice(M.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<M.length;a++){var b=M[a].w;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.zb&&b.zb.disconnect()}N&&N.da&&(a=N.da,a.Og[0]=0,a.Og[1]=0,a.Og[2]=0,a.Zh[0]=0,a.Zh[1]=0,a.Zh[2]=0);N=null;M.splice(0);K=null};a.update=function(a){if(J&&0!=M.length){for(var b=0;b<M.length;b++){var c=M[b],d=c.w,e=J.currentTime;
J&&!d.loop&&d.cyclic&&20==d.state&&d.duration&&d.Tc+d.duration<e&&l(c);20==d.state&&3>d.tk-e&&k(d)}K&&K.Pe.length&&(-1==K.$a||a>K.vq+K.Er[K.$a])&&(b=K,-1<b.$a&&r(b.Pe[b.$a]),-1==b.$a&&b.random?c=Math.round(Math.random()*(b.Pe.length-1)):b.random?(c=1+Math.round(Math.random()*(b.Pe.length-2)),c=(b.$a+c)%b.Pe.length):c=(b.$a+1)%b.Pe.length,l(b.Pe[c]),b.$a=c,b.vq=a)}};a.play=c;a.play_def=l;a.stop=r;a.is_play=function(a){return 20==a.w.state};a.oD=e;a.qD=g;a.playrate=function(a,b){var c=a.w;c.pitch=b;
!h(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.zb.playbackRate.value=b,f(c),k(c))};a.get_playrate=function(a){return a.w.pitch};a.cyclic=function(a,b){a.w.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.w.cyclic};a.nB=function(a,b,c,d){if(J&&a.da){var e=m;e[0]=0;e[1]=-1;e[2]=0;D.transformQuat(e,c,e);t[0]=0;t[1]=0;t[2]=-1;D.transformQuat(t,c,t);c=J.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],t[0],t[1],t[2]);D.copy(e,a.da.Vs);!a.da.tg&&d&&(z[0]=(b[0]-
a.da.Og[0])/d,z[1]=(b[1]-a.da.Og[1])/d,z[2]=(b[2]-a.da.Og[2])/d,u.smooth_v(z,a.da.Zh,d,.3,z),c.setVelocity(z[0],z[1],z[2]),D.copy(z,a.da.Zh));D.copy(b,a.da.Og)}};a.listener_reset_speed=function(a,b){if(J&&N.da&&!N.da.tg){var c=m;b?D.copy(b,c):D.copy(N.da.Vs,c);D.scale(c,a,c);J.listener.setVelocity(c[0],c[1],c[2]);D.copy(c,N.da.Zh)}};a.rD=function(a,b){var c=a.w;if(h(a)&&"POSITIONAL"==c.behavior){var d=a.f.i,e=c.Wj;e.setPosition(d[0],d[1],d[2]);var f=m;u.quat_to_dir(a.f.quat,u.AXIS_MY,f);e.setOrientation(f[0],
f[1],f[2]);f=c.yo;!c.tg&&b&&(t[0]=(d[0]-f[0])/b,t[1]=(d[1]-f[1])/b,t[2]=(d[2]-f[2])/b,u.smooth_v(t,c.sp,b,.3,t),e.setVelocity(t[0],t[1],t[2]),D.copy(t,c.sp));D.copy(d,f)}};a.speaker_reset_speed=function(a,b,c){var d=a.w;if(h(a)&&"POSITIONAL"==d.behavior&&!d.tg){var e=m;c?D.copy(c,e):D.copy(d.direction,e);D.scale(e,b,e);d.Wj.setVelocity(e[0],e[1],e[2]);D.copy(e,d.sp);D.copy(a.f.i,d.yo)}};a.Ee=function(a){return a.w?!0:!1};a.ao=function(a){return a.w.behavior};a.check_active_speakers=function(){for(var a=
0;a<M.length;a++)if(h(M[a]))return!0;return!1};a.VC=function(a){var b=N.da;b&&(b.volume=a,J&&(b.Ph.gain.value=p(b)))};a.lA=function(){var a=N.da;return a?a.volume:0};a.set_volume=function(a,b){var c=a.w;c.volume=b;h(a)&&(c.Ph.gain.value=p(c))};a.get_volume=function(a){return a.w.volume};a.mute=function(a,b){a.w.muted=Boolean(b);h(a)&&(a.w.Ph.gain.value=p(a.w))};a.is_muted=function(a){return a.w.muted};a.MB=function(a){var b=N.da;b&&(b.muted=Boolean(a),J&&(b.Ph.gain.value=p(b)))};a.TA=function(){var a=
N.da;return a?a.muted:!1};a.get_speaker_objects=function(){return M};a.pause=function(){for(var a=0;a<M.length;a++)e(M[a])};a.resume=function(){for(var a=0;a<M.length;a++)g(M[a])};a.set_compressor_params=function(a,b){if(a.da&&a.da.jj){var c=a.da.jj;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.da||!a.da.jj)return null;a=a.da.jj;return{threshold:a.threshold.value,knee:a.knee.value,
ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(h(a)){a=a.w;var d=a.wg,e=J.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.vg=c}};a.unduck=function(a){if(h(a)){a=a.w;var b=a.wg,c=J.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.vg);a.vg=0}};a.iz=function(a,b){if(J){var c=N.da,d=c.wg,e=J.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+
b);c.vg=b}};a.RD=function(){if(J){var a=N.da,b=a.wg,c=J.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.vg);a.vg=0}};a.apply_playlist=function(a,b,c){K={$a:-1,vq:0,random:c,Pe:[],Er:[]};for(c=0;c<a.length;c++){var d=a[c],e=w(d);0==e?B.warn("Ignoring speaker with zero duration: "+d.name):(r(d),d.w.cyclic=!1,K.Pe.push(d),K.Er.push(e+b))}};a.get_duration=w;a.clear_playlist=function(){if(K)for(var a=K.Pe,b=0;b<a.length;b++)r(a[b]);K=null};a.get_positional_params=
function(a){return(a=a.w)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.w;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.Wj;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.w;c&&c.Sd&&(c.Sd.frequency.value=b.freq,c.Sd.Q.value=b.Q,c.Sd.gain.value=b.gain)};a.get_filter_params=
function(a){return(a=a.w)&&a.Sd?{freq:a.Sd.frequency.value,Q:a.Sd.Q.value,gain:a.Sd.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.w;if(!a||!a.Sd)return null;a.Sd.getFrequencyResponse(b,c,d)}};b4w.module.__vec3=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new q(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var b=new q(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.fromValues=function(a,b,d){var f=new q(3);f[0]=a;f[1]=b;f[2]=d;return f};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set=function(a,b,d,f){f[0]=a;f[1]=b;f[2]=d;return f};a.add=function(a,b,d){d[0]=a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];
return d};a.subtract=function(a,b,d){d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];return d};a.sub=a.subtract;a.multiply=function(a,b,d){d[0]=a[0]*b[0];d[1]=a[1]*b[1];d[2]=a[2]*b[2];return d};a.mul=a.multiply;a.divide=function(a,b,d){d[0]=a[0]/b[0];d[1]=a[1]/b[1];d[2]=a[2]/b[2];return d};a.div=a.divide;a.min=function(a,b,d){d[0]=Math.min(a[0],b[0]);d[1]=Math.min(a[1],b[1]);d[2]=Math.min(a[2],b[2]);return d};a.max=function(a,b,d){d[0]=Math.max(a[0],b[0]);d[1]=Math.max(a[1],b[1]);d[2]=Math.max(a[2],
b[2]);return d};a.scale=function(a,b,d){d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;return d};a.scaleAndAdd=function(a,b,d,f){f[0]=a[0]+b[0]*d;f[1]=a[1]+b[1]*d;f[2]=a[2]+b[2]*d;return f};a.distance=function(a,b){var d=b[0]-a[0],f=b[1]-a[1],k=b[2]-a[2];return Math.sqrt(d*d+f*f+k*k)};a.dist=a.distance;a.squaredDistance=function(a,b){var d=b[0]-a[0],f=b[1]-a[1],k=b[2]-a[2];return d*d+f*f+k*k};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],d=a[1];a=a[2];return Math.sqrt(b*b+d*d+a*a)};a.len=a.length;
a.squaredLength=function(a){var b=a[0],d=a[1];a=a[2];return b*b+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];return b};a.normalize=function(a,b){var d=a[0],f=a[1],k=a[2],d=d*d+f*f+k*k;0<d&&(d=1/Math.sqrt(d),b[0]=a[0]*d,b[1]=a[1]*d,b[2]=a[2]*d);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};a.cross=function(a,b,d){var f=a[0],k=a[1];a=a[2];var n=b[0],r=b[1];b=b[2];
d[0]=k*b-a*r;d[1]=a*n-f*b;d[2]=f*r-k*n;return d};a.lerp=function(a,b,d,f){var k=a[0],n=a[1];a=a[2];f[0]=k+d*(b[0]-k);f[1]=n+d*(b[1]-n);f[2]=a+d*(b[2]-a);return f};a.random=function(a,b){a=a||1;var l=2*d()*Math.PI,f=2*d()-1,k=Math.sqrt(1-f*f)*a;b[0]=Math.cos(l)*k;b[1]=Math.sin(l)*k;b[2]=f*a;return b};a.transformMat4=function(a,b,d){var f=a[0],k=a[1];a=a[2];var n=b[3]*f+b[7]*k+b[11]*a+b[15],n=n||1;d[0]=(b[0]*f+b[4]*k+b[8]*a+b[12])/n;d[1]=(b[1]*f+b[5]*k+b[9]*a+b[13])/n;d[2]=(b[2]*f+b[6]*k+b[10]*a+b[14])/
n;return d};a.transformMat3=function(a,b,d){var f=a[0],k=a[1];a=a[2];d[0]=f*b[0]+k*b[3]+a*b[6];d[1]=f*b[1]+k*b[4]+a*b[7];d[2]=f*b[2]+k*b[5]+a*b[8];return d};a.transformQuat=function(a,b,d){var f=a[0],k=a[1],n=a[2];a=b[0];var r=b[1],e=b[2];b=b[3];var g=b*f+r*n-e*k,h=b*k+e*f-a*n,p=b*n+a*k-r*f,f=-a*f-r*k-e*n;d[0]=g*b+f*-a+h*-e-p*-r;d[1]=h*b+f*-r+p*-a-g*-e;d[2]=p*b+f*-e+g*-r-h*-a;return d};a.rotateX=function(a,b,d,f){var k=[],n=[];k[0]=a[0]-b[0];k[1]=a[1]-b[1];k[2]=a[2]-b[2];n[0]=k[0];n[1]=k[1]*Math.cos(d)-
k[2]*Math.sin(d);n[2]=k[1]*Math.sin(d)+k[2]*Math.cos(d);f[0]=n[0]+b[0];f[1]=n[1]+b[1];f[2]=n[2]+b[2];return f};a.rotateY=function(a,b,d,f){var k=[],n=[];k[0]=a[0]-b[0];k[1]=a[1]-b[1];k[2]=a[2]-b[2];n[0]=k[2]*Math.sin(d)+k[0]*Math.cos(d);n[1]=k[1];n[2]=k[2]*Math.cos(d)-k[0]*Math.sin(d);f[0]=n[0]+b[0];f[1]=n[1]+b[1];f[2]=n[2]+b[2];return f};a.rotateZ=function(a,b,d,f){var k=[],n=[];k[0]=a[0]-b[0];k[1]=a[1]-b[1];k[2]=a[2]-b[2];n[0]=k[0]*Math.cos(d)-k[1]*Math.sin(d);n[1]=k[0]*Math.sin(d)+k[1]*Math.cos(d);
n[2]=k[2];f[0]=n[0]+b[0];f[1]=n[1]+b[1];f[2]=n[2]+b[2];return f};a.forEach=function(){var c=a.create();return function(a,d,f,k,n,r){d||(d=3);f||(f=0);for(k=k?Math.min(k*d+f,a.length):a.length;f<k;f+=d)c[0]=a[f],c[1]=a[f+1],c[2]=a[f+2],n(c,r,c),a[f]=c[0],a[f+1]=c[1],a[f+2]=c[2];return a}}();a.tF=function(c,b){var d=a.fromValues(c[0],c[1],c[2]),f=a.fromValues(b[0],b[1],b[2]);a.normalize(d,d);a.normalize(f,f);d=a.dot(d,f);return 1<d?0:Math.acos(d)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+
a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};b4w.module.vec3=b4w.module.__vec3;
b4w.module.__vec4=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new q(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var b=new q(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=function(a,b,d,f){var k=new q(4);k[0]=a;k[1]=b;k[2]=d;k[3]=f;return k};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set=function(a,b,d,f,k){k[0]=a;k[1]=b;k[2]=d;k[3]=f;return k};a.add=function(a,b,d){d[0]=
a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];d[3]=a[3]+b[3];return d};a.subtract=function(a,b,d){d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];d[3]=a[3]-b[3];return d};a.sub=a.subtract;a.multiply=function(a,b,d){d[0]=a[0]*b[0];d[1]=a[1]*b[1];d[2]=a[2]*b[2];d[3]=a[3]*b[3];return d};a.mul=a.multiply;a.divide=function(a,b,d){d[0]=a[0]/b[0];d[1]=a[1]/b[1];d[2]=a[2]/b[2];d[3]=a[3]/b[3];return d};a.div=a.divide;a.min=function(a,b,d){d[0]=Math.min(a[0],b[0]);d[1]=Math.min(a[1],b[1]);d[2]=Math.min(a[2],b[2]);d[3]=
Math.min(a[3],b[3]);return d};a.max=function(a,b,d){d[0]=Math.max(a[0],b[0]);d[1]=Math.max(a[1],b[1]);d[2]=Math.max(a[2],b[2]);d[3]=Math.max(a[3],b[3]);return d};a.scale=function(a,b,d){d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;d[3]=a[3]*b;return d};a.scaleAndAdd=function(a,b,d,f){f[0]=a[0]+b[0]*d;f[1]=a[1]+b[1]*d;f[2]=a[2]+b[2]*d;f[3]=a[3]+b[3]*d;return f};a.distance=function(a,b){var d=b[0]-a[0],f=b[1]-a[1],k=b[2]-a[2],n=b[3]-a[3];return Math.sqrt(d*d+f*f+k*k+n*n)};a.dist=a.distance;a.squaredDistance=
function(a,b){var d=b[0]-a[0],f=b[1]-a[1],k=b[2]-a[2],n=b[3]-a[3];return d*d+f*f+k*k+n*n};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],d=a[1],f=a[2];a=a[3];return Math.sqrt(b*b+d*d+f*f+a*a)};a.len=a.length;a.squaredLength=function(a){var b=a[0],d=a[1],f=a[2];a=a[3];return b*b+d*d+f*f+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];b[3]=1/a[3];return b};a.normalize=
function(a,b){var d=a[0],f=a[1],k=a[2],n=a[3],d=d*d+f*f+k*k+n*n;0<d&&(d=1/Math.sqrt(d),b[0]=a[0]*d,b[1]=a[1]*d,b[2]=a[2]*d,b[3]=a[3]*d);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};a.lerp=function(a,b,d,f){var k=a[0],n=a[1],r=a[2];a=a[3];f[0]=k+d*(b[0]-k);f[1]=n+d*(b[1]-n);f[2]=r+d*(b[2]-r);f[3]=a+d*(b[3]-a);return f};a.random=function(c,b){c=c||1;b[0]=d();b[1]=d();b[2]=d();b[3]=d();a.normalize(b,b);a.scale(b,c,b);return b};a.transformMat4=function(a,b,d){var f=a[0],
k=a[1],n=a[2];a=a[3];d[0]=b[0]*f+b[4]*k+b[8]*n+b[12]*a;d[1]=b[1]*f+b[5]*k+b[9]*n+b[13]*a;d[2]=b[2]*f+b[6]*k+b[10]*n+b[14]*a;d[3]=b[3]*f+b[7]*k+b[11]*n+b[15]*a;return d};a.transformQuat=function(a,b,d){var f=a[0],k=a[1],n=a[2],r=b[0],e=b[1],g=b[2];b=b[3];var h=b*f+e*n-g*k,p=b*k+g*f-r*n,q=b*n+r*k-e*f,f=-r*f-e*k-g*n;d[0]=h*b+f*-r+p*-g-q*-e;d[1]=p*b+f*-e+q*-r-h*-g;d[2]=q*b+f*-g+h*-e-p*-r;d[3]=a[3];return d};a.forEach=function(){var c=a.create();return function(a,d,f,k,n,r){d||(d=4);f||(f=0);for(k=k?Math.min(k*
d+f,a.length):a.length;f<k;f+=d)c[0]=a[f],c[1]=a[f+1],c[2]=a[f+2],c[3]=a[f+3],n(c,r,c),a[f]=c[0],a[f+1]=c[1],a[f+2]=c[2],a[f+3]=c[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};b4w.module.vec4=b4w.module.__vec4;
b4w.module.__quat=function(a,q){var d=q("__vec3"),c=q("__vec4"),b=q("__mat3"),l="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new l(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=d.create(),c=d.fromValues(1,0,0),l=d.fromValues(0,1,0);return function(r,e,g){var h=d.dot(r,e);if(-.9999999>h)return d.cross(c,r,b),1E-6>d.length(b)&&d.cross(l,r,b),d.normalize(b,b),a.setAxisAngle(b,Math.PI,g),g;if(.9999999<h)return g[0]=0,g[1]=0,g[2]=0,g[3]=1,g;d.cross(r,
e,b);g[0]=b[0];g[1]=b[1];g[2]=b[2];g[3]=1+h;return a.normalize(g,g)}}();a.setAxes=function(){var c=b.create();return function(b,d,l,e){c[0]=d[0];c[3]=d[1];c[6]=d[2];c[1]=l[0];c[4]=l[1];c[7]=l[2];c[2]=-b[0];c[5]=-b[1];c[8]=-b[2];return a.normalize(a.fromMat3(c,e),e)}}();a.clone=c.clone;a.fromValues=c.fromValues;a.copy=c.copy;a.set=c.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=c.add;a.multiply=function(a,b,c){var d=a[0],e=a[1],g=a[2];a=a[3];var h=b[0],l=b[1],q=b[2];b=b[3];c[0]=d*b+a*h+e*q-g*l;c[1]=e*b+a*l+g*h-d*q;c[2]=g*b+a*q+d*l-e*h;c[3]=a*b-d*h-e*l-g*q;return c};a.mul=a.multiply;a.scale=c.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],e=a[1],g=a[2];a=a[3];var h=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*h;c[1]=e*b+g*h;c[2]=g*b-e*h;c[3]=a*b-d*h;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],e=a[1],g=a[2];a=a[3];var h=Math.sin(b);b=Math.cos(b);c[0]=d*
b-g*h;c[1]=e*b+a*h;c[2]=g*b+d*h;c[3]=a*b-e*h;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],e=a[1],g=a[2];a=a[3];var h=Math.sin(b);b=Math.cos(b);c[0]=d*b+e*h;c[1]=e*b-d*h;c[2]=g*b+a*h;c[3]=a*b-g*h;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];b[0]=c;b[1]=d;b[2]=e;b[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};a.dot=c.dot;a.lerp=c.lerp;a.slerp=function(a,b,c,d){var e=a[0],g=a[1],h=a[2];a=a[3];var l=b[0],q=b[1],C=b[2];b=b[3];var B,H,u;H=e*l+g*q+h*C+a*b;0>H&&(H=-H,l=-l,q=-q,
C=-C,b=-b);1E-6<1-H?(B=Math.acos(H),u=Math.sin(B),H=Math.sin((1-c)*B)/u,c=Math.sin(c*B)/u):H=1-c;d[0]=H*e+c*l;d[1]=H*g+c*q;d[2]=H*h+c*C;d[3]=H*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],e=a[2],g=a[3],h=c*c+d*d+e*e+g*g,h=h?1/h:0;b[0]=-c*h;b[1]=-d*h;b[2]=-e*h;b[3]=g*h;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=c.length;a.len=a.length;a.squaredLength=c.squaredLength;a.sqrLen=a.squaredLength;a.normalize=c.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var e=(d+1)%3,g=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*e+e]-a[3*g+g]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*e+g]-a[3*g+e])*c;b[e]=(a[3*e+d]+a[3*d+e])*c;b[g]=(a[3*g+d]+a[3*d+g])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};b4w.module.quat=b4w.module.__quat;
b4w.module.__mat3=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new q(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[4];c[4]=a[5];c[5]=a[6];c[6]=a[8];c[7]=a[9];c[8]=a[10];return c};a.clone=function(a){var c=new q(9);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=
a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,c){if(c===a){var b=a[1],l=a[2],f=a[5];c[1]=a[3];c[2]=a[6];c[3]=b;c[5]=a[7];c[6]=l;c[7]=f}else c[0]=a[0],c[1]=a[3],c[2]=a[6],c[3]=a[1],c[4]=a[4],c[5]=a[7],c[6]=a[2],c[7]=a[5],c[8]=a[8];return c};a.invert=function(a,c){var b=a[0],l=a[1],f=a[2],k=a[3],n=a[4],r=a[5],e=a[6],g=a[7],h=a[8],p=h*n-r*g,q=-h*k+r*e,C=
g*k-n*e,B=b*p+l*q+f*C;if(!B)return null;B=1/B;c[0]=p*B;c[1]=(-h*l+f*g)*B;c[2]=(r*l-f*n)*B;c[3]=q*B;c[4]=(h*b-f*e)*B;c[5]=(-r*b+f*k)*B;c[6]=C*B;c[7]=(-g*b+l*e)*B;c[8]=(n*b-l*k)*B;return c};a.adjoint=function(a,c){var b=a[0],l=a[1],f=a[2],k=a[3],n=a[4],r=a[5],e=a[6],g=a[7],h=a[8];c[0]=n*h-r*g;c[1]=f*g-l*h;c[2]=l*r-f*n;c[3]=r*e-k*h;c[4]=b*h-f*e;c[5]=f*k-b*r;c[6]=k*g-n*e;c[7]=l*e-b*g;c[8]=b*n-l*k;return c};a.determinant=function(a){var c=a[3],b=a[4],l=a[5],f=a[6],k=a[7],n=a[8];return a[0]*(n*b-l*k)+a[1]*
(-n*c+l*f)+a[2]*(k*c-b*f)};a.multiply=function(a,c,b){var l=a[0],f=a[1],k=a[2],n=a[3],r=a[4],e=a[5],g=a[6],h=a[7];a=a[8];var p=c[0],q=c[1],C=c[2],B=c[3],H=c[4],u=c[5],D=c[6],G=c[7];c=c[8];b[0]=p*l+q*n+C*g;b[1]=p*f+q*r+C*h;b[2]=p*k+q*e+C*a;b[3]=B*l+H*n+u*g;b[4]=B*f+H*r+u*h;b[5]=B*k+H*e+u*a;b[6]=D*l+G*n+c*g;b[7]=D*f+G*r+c*h;b[8]=D*k+G*e+c*a;return b};a.mul=a.multiply;a.translate=function(a,c,b){var l=a[0],f=a[1],k=a[2],n=a[3],r=a[4],e=a[5],g=a[6],h=a[7];a=a[8];var p=c[0];c=c[1];b[0]=l;b[1]=f;b[2]=k;
b[3]=n;b[4]=r;b[5]=e;b[6]=p*l+c*n+g;b[7]=p*f+c*r+h;b[8]=p*k+c*e+a;return b};a.rotate=function(a,c,b){var l=a[0],f=a[1],k=a[2],n=a[3],r=a[4],e=a[5],g=a[6],h=a[7];a=a[8];var p=Math.sin(c);c=Math.cos(c);b[0]=c*l+p*n;b[1]=c*f+p*r;b[2]=c*k+p*e;b[3]=c*n-p*l;b[4]=c*r-p*f;b[5]=c*e-p*k;b[6]=g;b[7]=h;b[8]=a;return b};a.scale=function(a,c,b){var l=c[0];c=c[1];b[0]=l*a[0];b[1]=l*a[1];b[2]=l*a[2];b[3]=c*a[3];b[4]=c*a[4];b[5]=c*a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.Gz=function(a,c){c[0]=1;c[1]=0;c[2]=
0;c[3]=0;c[4]=1;c[5]=0;c[6]=a[0];c[7]=a[1];c[8]=1;return c};a.Ez=function(a,c){var b=Math.sin(a),l=Math.cos(a);c[0]=l;c[1]=b;c[2]=0;c[3]=-b;c[4]=l;c[5]=0;c[6]=0;c[7]=0;c[8]=1;return c};a.Fz=function(a,c){c[0]=a[0];c[1]=0;c[2]=0;c[3]=0;c[4]=a[1];c[5]=0;c[6]=0;c[7]=0;c[8]=1;return c};a.fromMat2d=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=0;c[3]=a[2];c[4]=a[3];c[5]=0;c[6]=a[4];c[7]=a[5];c[8]=1;return c};a.fromQuat=function(a,c){var b=a[0],l=a[1],f=a[2],k=a[3],n=b+b,r=l+l,e=f+f,b=b*n,g=l*n,l=l*r,h=f*n,p=
f*r,f=f*e,n=k*n,r=k*r,k=k*e;c[0]=1-l-f;c[3]=g-k;c[6]=h+r;c[1]=g+k;c[4]=1-b-f;c[7]=p-n;c[2]=h-r;c[5]=p+n;c[8]=1-b-l;return c};a.normalFromMat4=function(a,c){var b=a[0],l=a[1],f=a[2],k=a[3],n=a[4],r=a[5],e=a[6],g=a[7],h=a[8],p=a[9],q=a[10],C=a[11],B=a[12],H=a[13],u=a[14],D=a[15],G=b*r-l*n,v=b*e-f*n,m=b*g-k*n,t=l*e-f*r,z=l*g-k*r,L=f*g-k*e,A=h*H-p*B,J=h*u-q*B,h=h*D-C*B,N=p*u-q*H,p=p*D-C*H,q=q*D-C*u,C=G*q-v*p+m*N+t*h-z*J+L*A;if(!C)return null;C=1/C;c[0]=(r*q-e*p+g*N)*C;c[1]=(e*h-n*q-g*J)*C;c[2]=(n*p-r*
h+g*A)*C;c[3]=(f*p-l*q-k*N)*C;c[4]=(b*q-f*h+k*J)*C;c[5]=(l*h-b*p-k*A)*C;c[6]=(H*L-u*z+D*t)*C;c[7]=(u*m-B*L-D*v)*C;c[8]=(B*z-H*m+D*G)*C;return c};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.Dz=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat3=b4w.module.__mat3;
b4w.module.__mat4=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new q(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var c=new q(16);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.copy=function(a,c){c[0]=a[0];
c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,c){if(c===a){var b=a[1],l=a[2],f=a[3],k=a[6],n=a[7],r=a[11];c[1]=a[4];c[2]=a[8];c[3]=a[12];c[4]=b;c[6]=a[9];c[7]=a[13];c[8]=l;c[9]=k;c[11]=a[14];c[12]=f;c[13]=
n;c[14]=r}else c[0]=a[0],c[1]=a[4],c[2]=a[8],c[3]=a[12],c[4]=a[1],c[5]=a[5],c[6]=a[9],c[7]=a[13],c[8]=a[2],c[9]=a[6],c[10]=a[10],c[11]=a[14],c[12]=a[3],c[13]=a[7],c[14]=a[11],c[15]=a[15];return c};a.invert=function(a,c){var b=a[0],l=a[1],f=a[2],k=a[3],n=a[4],r=a[5],e=a[6],g=a[7],h=a[8],p=a[9],q=a[10],C=a[11],B=a[12],H=a[13],u=a[14],D=a[15],G=b*r-l*n,v=b*e-f*n,m=b*g-k*n,t=l*e-f*r,z=l*g-k*r,L=f*g-k*e,A=h*H-p*B,J=h*u-q*B,N=h*D-C*B,M=p*u-q*H,y=p*D-C*H,K=q*D-C*u,x=G*K-v*y+m*M+t*N-z*J+L*A;if(!x)return null;
x=1/x;c[0]=(r*K-e*y+g*M)*x;c[1]=(f*y-l*K-k*M)*x;c[2]=(H*L-u*z+D*t)*x;c[3]=(q*z-p*L-C*t)*x;c[4]=(e*N-n*K-g*J)*x;c[5]=(b*K-f*N+k*J)*x;c[6]=(u*m-B*L-D*v)*x;c[7]=(h*L-q*m+C*v)*x;c[8]=(n*y-r*N+g*A)*x;c[9]=(l*N-b*y-k*A)*x;c[10]=(B*z-H*m+D*G)*x;c[11]=(p*m-h*z-C*G)*x;c[12]=(r*J-n*M-e*A)*x;c[13]=(b*M-l*J+f*A)*x;c[14]=(H*v-B*t-u*G)*x;c[15]=(h*t-p*v+q*G)*x;return c};a.adjoint=function(a,c){var b=a[0],l=a[1],f=a[2],k=a[3],n=a[4],r=a[5],e=a[6],g=a[7],h=a[8],p=a[9],q=a[10],C=a[11],B=a[12],H=a[13],u=a[14],D=a[15];
c[0]=r*(q*D-C*u)-p*(e*D-g*u)+H*(e*C-g*q);c[1]=-(l*(q*D-C*u)-p*(f*D-k*u)+H*(f*C-k*q));c[2]=l*(e*D-g*u)-r*(f*D-k*u)+H*(f*g-k*e);c[3]=-(l*(e*C-g*q)-r*(f*C-k*q)+p*(f*g-k*e));c[4]=-(n*(q*D-C*u)-h*(e*D-g*u)+B*(e*C-g*q));c[5]=b*(q*D-C*u)-h*(f*D-k*u)+B*(f*C-k*q);c[6]=-(b*(e*D-g*u)-n*(f*D-k*u)+B*(f*g-k*e));c[7]=b*(e*C-g*q)-n*(f*C-k*q)+h*(f*g-k*e);c[8]=n*(p*D-C*H)-h*(r*D-g*H)+B*(r*C-g*p);c[9]=-(b*(p*D-C*H)-h*(l*D-k*H)+B*(l*C-k*p));c[10]=b*(r*D-g*H)-n*(l*D-k*H)+B*(l*g-k*r);c[11]=-(b*(r*C-g*p)-n*(l*C-k*p)+h*
(l*g-k*r));c[12]=-(n*(p*u-q*H)-h*(r*u-e*H)+B*(r*q-e*p));c[13]=b*(p*u-q*H)-h*(l*u-f*H)+B*(l*q-f*p);c[14]=-(b*(r*u-e*H)-n*(l*u-f*H)+B*(l*e-f*r));c[15]=b*(r*q-e*p)-n*(l*q-f*p)+h*(l*e-f*r);return c};a.determinant=function(a){var c=a[0],b=a[1],l=a[2],f=a[3],k=a[4],n=a[5],r=a[6],e=a[7],g=a[8],h=a[9],p=a[10],q=a[11],C=a[12],B=a[13],H=a[14];a=a[15];return(c*n-b*k)*(p*a-q*H)-(c*r-l*k)*(h*a-q*B)+(c*e-f*k)*(h*H-p*B)+(b*r-l*n)*(g*a-q*C)-(b*e-f*n)*(g*H-p*C)+(l*e-f*r)*(g*B-h*C)};a.multiply=function(a,c,b){var l=
a[0],f=a[1],k=a[2],n=a[3],r=a[4],e=a[5],g=a[6],h=a[7],p=a[8],q=a[9],C=a[10],B=a[11],H=a[12],u=a[13],D=a[14];a=a[15];var G=c[0],v=c[1],m=c[2],t=c[3];b[0]=G*l+v*r+m*p+t*H;b[1]=G*f+v*e+m*q+t*u;b[2]=G*k+v*g+m*C+t*D;b[3]=G*n+v*h+m*B+t*a;G=c[4];v=c[5];m=c[6];t=c[7];b[4]=G*l+v*r+m*p+t*H;b[5]=G*f+v*e+m*q+t*u;b[6]=G*k+v*g+m*C+t*D;b[7]=G*n+v*h+m*B+t*a;G=c[8];v=c[9];m=c[10];t=c[11];b[8]=G*l+v*r+m*p+t*H;b[9]=G*f+v*e+m*q+t*u;b[10]=G*k+v*g+m*C+t*D;b[11]=G*n+v*h+m*B+t*a;G=c[12];v=c[13];m=c[14];t=c[15];b[12]=G*l+
v*r+m*p+t*H;b[13]=G*f+v*e+m*q+t*u;b[14]=G*k+v*g+m*C+t*D;b[15]=G*n+v*h+m*B+t*a;return b};a.mul=a.multiply;a.translate=function(a,c,b){var l=c[0],f=c[1];c=c[2];var k,n,r,e,g,h,p,q,C,B,H,u;a===b?(b[12]=a[0]*l+a[4]*f+a[8]*c+a[12],b[13]=a[1]*l+a[5]*f+a[9]*c+a[13],b[14]=a[2]*l+a[6]*f+a[10]*c+a[14],b[15]=a[3]*l+a[7]*f+a[11]*c+a[15]):(k=a[0],n=a[1],r=a[2],e=a[3],g=a[4],h=a[5],p=a[6],q=a[7],C=a[8],B=a[9],H=a[10],u=a[11],b[0]=k,b[1]=n,b[2]=r,b[3]=e,b[4]=g,b[5]=h,b[6]=p,b[7]=q,b[8]=C,b[9]=B,b[10]=H,b[11]=u,
b[12]=k*l+g*f+C*c+a[12],b[13]=n*l+h*f+B*c+a[13],b[14]=r*l+p*f+H*c+a[14],b[15]=e*l+q*f+u*c+a[15]);return b};a.scale=function(a,c,b){var l=c[0],f=c[1];c=c[2];b[0]=a[0]*l;b[1]=a[1]*l;b[2]=a[2]*l;b[3]=a[3]*l;b[4]=a[4]*f;b[5]=a[5]*f;b[6]=a[6]*f;b[7]=a[7]*f;b[8]=a[8]*c;b[9]=a[9]*c;b[10]=a[10]*c;b[11]=a[11]*c;b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.rotate=function(a,c,b,l){var f=b[0],k=b[1];b=b[2];var n=Math.sqrt(f*f+k*k+b*b),r,e,g,h,p,q,C,B,H,u,D,G,v,m,t,z,L,A,J,N;if(1E-7>Math.abs(n))return null;
n=1/n;f*=n;k*=n;b*=n;r=Math.sin(c);e=Math.cos(c);g=1-e;c=a[0];n=a[1];h=a[2];p=a[3];q=a[4];C=a[5];B=a[6];H=a[7];u=a[8];D=a[9];G=a[10];v=a[11];m=f*f*g+e;t=k*f*g+b*r;z=b*f*g-k*r;L=f*k*g-b*r;A=k*k*g+e;J=b*k*g+f*r;N=f*b*g+k*r;f=k*b*g-f*r;k=b*b*g+e;l[0]=c*m+q*t+u*z;l[1]=n*m+C*t+D*z;l[2]=h*m+B*t+G*z;l[3]=p*m+H*t+v*z;l[4]=c*L+q*A+u*J;l[5]=n*L+C*A+D*J;l[6]=h*L+B*A+G*J;l[7]=p*L+H*A+v*J;l[8]=c*N+q*f+u*k;l[9]=n*N+C*f+D*k;l[10]=h*N+B*f+G*k;l[11]=p*N+H*f+v*k;a!==l&&(l[12]=a[12],l[13]=a[13],l[14]=a[14],l[15]=a[15]);
return l};a.rotateX=function(a,c,b){var l=Math.sin(c);c=Math.cos(c);var f=a[4],k=a[5],n=a[6],r=a[7],e=a[8],g=a[9],h=a[10],p=a[11];a!==b&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[4]=f*c+e*l;b[5]=k*c+g*l;b[6]=n*c+h*l;b[7]=r*c+p*l;b[8]=e*c-f*l;b[9]=g*c-k*l;b[10]=h*c-n*l;b[11]=p*c-r*l;return b};a.rotateY=function(a,c,b){var l=Math.sin(c);c=Math.cos(c);var f=a[0],k=a[1],n=a[2],r=a[3],e=a[8],g=a[9],h=a[10],p=a[11];a!==b&&(b[4]=a[4],b[5]=a[5],b[6]=a[6],
b[7]=a[7],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[0]=f*c-e*l;b[1]=k*c-g*l;b[2]=n*c-h*l;b[3]=r*c-p*l;b[8]=f*l+e*c;b[9]=k*l+g*c;b[10]=n*l+h*c;b[11]=r*l+p*c;return b};a.rotateZ=function(a,c,b){var l=Math.sin(c);c=Math.cos(c);var f=a[0],k=a[1],n=a[2],r=a[3],e=a[4],g=a[5],h=a[6],p=a[7];a!==b&&(b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[0]=f*c+e*l;b[1]=k*c+g*l;b[2]=n*c+h*l;b[3]=r*c+p*l;b[4]=e*c-f*l;b[5]=g*c-k*l;b[6]=h*c-n*l;b[7]=p*c-r*l;return b};
a.Gz=function(a,c){c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=a[0];c[13]=a[1];c[14]=a[2];c[15]=1;return c};a.Fz=function(a,c){c[0]=a[0];c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=a[1];c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=a[2];c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.Ez=function(a,c,b){var l=c[0],f=c[1];c=c[2];var k=Math.sqrt(l*l+f*f+c*c),n;if(1E-7>Math.abs(k))return null;k=1/k;l*=k;f*=k;c*=k;k=Math.sin(a);a=Math.cos(a);n=1-a;b[0]=l*l*n+a;b[1]=f*l*n+c*
k;b[2]=c*l*n-f*k;b[3]=0;b[4]=l*f*n-c*k;b[5]=f*f*n+a;b[6]=c*f*n+l*k;b[7]=0;b[8]=l*c*n+f*k;b[9]=f*c*n-l*k;b[10]=c*c*n+a;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.lG=function(a,c){var b=Math.sin(a),l=Math.cos(a);c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=l;c[6]=b;c[7]=0;c[8]=0;c[9]=-b;c[10]=l;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.mG=function(a,c){var b=Math.sin(a),l=Math.cos(a);c[0]=l;c[1]=0;c[2]=-b;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=b;c[9]=0;c[10]=l;c[11]=0;c[12]=0;c[13]=0;
c[14]=0;c[15]=1;return c};a.nG=function(a,c){var b=Math.sin(a),l=Math.cos(a);c[0]=l;c[1]=b;c[2]=0;c[3]=0;c[4]=-b;c[5]=l;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.fromRotationTranslation=function(a,c,b){var l=a[0],f=a[1],k=a[2],n=a[3],r=l+l,e=f+f,g=k+k;a=l*r;var h=l*e,l=l*g,p=f*e,f=f*g,k=k*g,r=n*r,e=n*e,n=n*g;b[0]=1-(p+k);b[1]=h+n;b[2]=l-e;b[3]=0;b[4]=h-n;b[5]=1-(a+k);b[6]=f+r;b[7]=0;b[8]=l+e;b[9]=f-r;b[10]=1-(a+p);b[11]=0;b[12]=c[0];b[13]=c[1];b[14]=c[2];
b[15]=1;return b};a.fromQuat=function(a,c){var b=a[0],l=a[1],f=a[2],k=a[3],n=b+b,r=l+l,e=f+f,b=b*n,g=l*n,l=l*r,h=f*n,p=f*r,f=f*e,n=k*n,r=k*r,k=k*e;c[0]=1-l-f;c[1]=g+k;c[2]=h-r;c[3]=0;c[4]=g-k;c[5]=1-b-f;c[6]=p+n;c[7]=0;c[8]=h+r;c[9]=p-n;c[10]=1-b-l;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.frustum=function(a,c,b,l,f,k,n){var r=1/(c-a),e=1/(l-b),g=1/(f-k);n[0]=2*f*r;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=2*f*e;n[6]=0;n[7]=0;n[8]=(c+a)*r;n[9]=(l+b)*e;n[10]=(k+f)*g;n[11]=-1;n[12]=0;n[13]=0;n[14]=
k*f*2*g;n[15]=0;return n};a.perspective=function(a,c,b,l,f){a=1/Math.tan(a/2);var k=1/(b-l);f[0]=a/c;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=(l+b)*k;f[11]=-1;f[12]=0;f[13]=0;f[14]=2*l*b*k;f[15]=0;return f};a.fH=function(a,c,b,l){var f=Math.tan(a.wH*Math.PI/180),k=Math.tan(a.bG*Math.PI/180),n=Math.tan(a.UG*Math.PI/180);a=Math.tan(a.iH*Math.PI/180);var r=2/(n+a),e=2/(f+k);l[0]=r;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=e;l[6]=0;l[7]=0;l[8]=-((n-a)*r*.5);l[9]=(f-k)*e*.5;l[10]=b/
(c-b);l[11]=-1;l[12]=0;l[13]=0;l[14]=b*c/(c-b);l[15]=0;return l};a.ortho=function(a,c,b,l,f,k,n){var r=1/(a-c),e=1/(b-l),g=1/(f-k);n[0]=-2*r;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=-2*e;n[6]=0;n[7]=0;n[8]=0;n[9]=0;n[10]=2*g;n[11]=0;n[12]=(a+c)*r;n[13]=(l+b)*e;n[14]=(k+f)*g;n[15]=1;return n};a.lookAt=function(d,c,b,l){var f,k,n,r,e,g,h,p,q=d[0],C=d[1];d=d[2];n=b[0];r=b[1];k=b[2];h=c[0];b=c[1];f=c[2];if(1E-7>Math.abs(q-h)&&1E-7>Math.abs(C-b)&&1E-7>Math.abs(d-f))return a.identity(l);c=q-h;b=C-b;h=d-f;p=1/Math.sqrt(c*
c+b*b+h*h);c*=p;b*=p;h*=p;f=r*h-k*b;k=k*c-n*h;n=n*b-r*c;(p=Math.sqrt(f*f+k*k+n*n))?(p=1/p,f*=p,k*=p,n*=p):n=k=f=0;r=b*n-h*k;e=h*f-c*n;g=c*k-b*f;(p=Math.sqrt(r*r+e*e+g*g))?(p=1/p,r*=p,e*=p,g*=p):g=e=r=0;l[0]=f;l[1]=r;l[2]=c;l[3]=0;l[4]=k;l[5]=e;l[6]=b;l[7]=0;l[8]=n;l[9]=g;l[10]=h;l[11]=0;l[12]=-(f*q+k*C+n*d);l[13]=-(r*q+e*C+g*d);l[14]=-(c*q+b*C+h*d);l[15]=1;return l};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+
a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.Dz=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.mat4=b4w.module.__mat4;b4w.module.__md5=function(a){function q(a,f){var r=a[0],e=a[1],g=a[2],h=a[3],r=c(r,e,g,h,f[0],7,-680876936),h=c(h,r,e,g,f[1],12,-389564586),g=c(g,h,r,e,f[2],17,606105819),e=c(e,g,h,r,f[3],22,-1044525330),r=c(r,e,g,h,f[4],7,-176418897),h=c(h,r,e,g,f[5],12,1200080426),g=c(g,h,r,e,f[6],17,-1473231341),e=c(e,g,h,r,f[7],22,-45705983),r=c(r,e,g,h,f[8],7,1770035416),h=c(h,r,e,g,f[9],12,-1958414417),g=c(g,h,r,e,f[10],17,-42063),e=c(e,g,h,r,f[11],22,-1990404162),r=c(r,e,g,h,f[12],7,1804603682),h=c(h,r,e,g,
f[13],12,-40341101),g=c(g,h,r,e,f[14],17,-1502002290),e=c(e,g,h,r,f[15],22,1236535329),r=b(r,e,g,h,f[1],5,-165796510),h=b(h,r,e,g,f[6],9,-1069501632),g=b(g,h,r,e,f[11],14,643717713),e=b(e,g,h,r,f[0],20,-373897302),r=b(r,e,g,h,f[5],5,-701558691),h=b(h,r,e,g,f[10],9,38016083),g=b(g,h,r,e,f[15],14,-660478335),e=b(e,g,h,r,f[4],20,-405537848),r=b(r,e,g,h,f[9],5,568446438),h=b(h,r,e,g,f[14],9,-1019803690),g=b(g,h,r,e,f[3],14,-187363961),e=b(e,g,h,r,f[8],20,1163531501),r=b(r,e,g,h,f[13],5,-1444681467),h=
b(h,r,e,g,f[2],9,-51403784),g=b(g,h,r,e,f[7],14,1735328473),e=b(e,g,h,r,f[12],20,-1926607734),r=d(e^g^h,r,e,f[5],4,-378558),h=d(r^e^g,h,r,f[8],11,-2022574463),g=d(h^r^e,g,h,f[11],16,1839030562),e=d(g^h^r,e,g,f[14],23,-35309556),r=d(e^g^h,r,e,f[1],4,-1530992060),h=d(r^e^g,h,r,f[4],11,1272893353),g=d(h^r^e,g,h,f[7],16,-155497632),e=d(g^h^r,e,g,f[10],23,-1094730640),r=d(e^g^h,r,e,f[13],4,681279174),h=d(r^e^g,h,r,f[0],11,-358537222),g=d(h^r^e,g,h,f[3],16,-722521979),e=d(g^h^r,e,g,f[6],23,76029189),r=
d(e^g^h,r,e,f[9],4,-640364487),h=d(r^e^g,h,r,f[12],11,-421815835),g=d(h^r^e,g,h,f[15],16,530742520),e=d(g^h^r,e,g,f[2],23,-995338651),r=l(r,e,g,h,f[0],6,-198630844),h=l(h,r,e,g,f[7],10,1126891415),g=l(g,h,r,e,f[14],15,-1416354905),e=l(e,g,h,r,f[5],21,-57434055),r=l(r,e,g,h,f[12],6,1700485571),h=l(h,r,e,g,f[3],10,-1894986606),g=l(g,h,r,e,f[10],15,-1051523),e=l(e,g,h,r,f[1],21,-2054922799),r=l(r,e,g,h,f[8],6,1873313359),h=l(h,r,e,g,f[15],10,-30611744),g=l(g,h,r,e,f[6],15,-1560198380),e=l(e,g,h,r,f[13],
21,1309151649),r=l(r,e,g,h,f[4],6,-145523070),h=l(h,r,e,g,f[11],10,-1120210379),g=l(g,h,r,e,f[2],15,718787259),e=l(e,g,h,r,f[9],21,-343485551);a[0]=r+a[0]&4294967295;a[1]=e+a[1]&4294967295;a[2]=g+a[2]&4294967295;a[3]=h+a[3]&4294967295}function d(a,b,c,d,f,h){b=(b+a&4294967295)+(d+h&4294967295)&4294967295;return(b<<f|b>>>32-f)+c&4294967295}function c(a,b,c,e,f,h,l){return d(b&c|~b&e,a,b,f,h,l)}function b(a,b,c,e,f,h,l){return d(b&e|c&~e,a,b,f,h,l)}function l(a,b,c,e,f,h,l){return d(c^(b|~e),a,b,f,
h,l)}var f="0123456789abcdef".split("");a.As=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var g=b.substring(d-64,d),h=[],l=void 0,l=0;64>l;l+=4)h[l>>2]=g.charCodeAt(l)+(g.charCodeAt(l+1)<<8)+(g.charCodeAt(l+2)<<16)+(g.charCodeAt(l+3)<<24);q(a,h)}b=b.substring(d-64);g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)g[d>>2]|=b.charCodeAt(d)<<(d%4<<3);g[d>>2]|=128<<(d%4<<3);if(55<d)for(q(a,g),d=0;16>d;d++)g[d]=0;g[14]=8*
c;q(a,g);for(b=0;b<a.length;b++){c=a[b];d="";for(g=0;4>g;g++)d+=f[c>>8*g+4&15]+f[c>>8*g&15];a[b]=d}return a.join("")}};b4w.module.shader_texts=function(a){a["anchors.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",a:[{type:"var",name:"ANCHOR_NUM",b:["0"]},{type:"textline",b:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec4 a ; a = u_view_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_Position = u_proj_matrix * a ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",
name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",
b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"pack.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},
{type:"include",file:"math.glslv"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]}]}}]},{type:"textline",b:["uniform","vec3","u_color_id",";"]},{type:"condition",
a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",
"ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bu ; varying vec4 bv ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"uniform float u_perspective_cast_far_bound ; varying vec4 bA ; varying vec4 bB ; varying vec4 bC ; varying vec4 bD ; uniform float u_perspective_cast_far_bound ; uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ; uniform sampler2D u_shadow_map1 ; uniform sampler2D u_shadow_map2 ; uniform sampler2D u_shadow_map3 ; uniform sampler2D u_shadow_mask ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},
{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { float qP , qQ ; vec3 qR , qS , qT , qU ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"qR = u_camera_eye_frag - bu ; qR = normalize ( qR ) ; qO ( qR , qS , qT , qU , qP , qQ ) ; qQ = qQ ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:"qQ = ( texture2D ( u_sampler , bE ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"qQ = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( qQ < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",
a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute",
"vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION",
"float","u_view_max_depth",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bu ; varying vec4 bv ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 tx ; float ty , tz , tA ; mat4 tB ; vec3 tC , tD , tE , tF , tG , tH ; tC = a_position ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["tD","=","a_normal",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"tE = vec3 ( a_tangent ) ; tF = a_tangent [ 3 ] * cross ( tD , tE ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"tE = vec3 ( 0.0 ) ; tF = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tD = vec3 ( 0.0 ) ; tE = vec3 ( 0.0 ) ; tF = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"tC = mix ( tC , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"tD = mix ( tD , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"tG = vec3 ( a_tangent ) ; tH = a_tangent_next [ 3 ] * cross ( a_normal_next , tG ) ; tE = mix ( tE , tG , u_va_frame_factor ) ; tF = mix ( tF , tH , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"sD ( tC , tE , tF , tD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["tF","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tF = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"tE = ( u_model_matrix * vec4 ( tF , 1.0 ) ) . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tB = rw ( u_camera_eye , tE , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tB = rq ( u_camera_eye , tE , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"tH = ( u_model_matrix * vec4 ( tF , 1.0 ) ) . xyz ; tB = tB * ri ( u_wind , u_time , u_jitter_amp , u_jitter_freq , tH ) ;".split(" ")}]}}]},{type:"textline",b:"aM tI = rD ( tC - tF , tF , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tB ) ; tI . b = tE ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"aM tI = rD ( tC , tF , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tr ( tI . a , tI . b , tD ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["tD","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tD = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",
b:"tr ( tI . a , tI . b , tD ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"bE = rG ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bu = tI . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"bw = tI . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"ty = ( dot ( cross ( tI . e , tI . c ) , tI . d ) < 0.0 ) ? - 1.0 : 1.0 ; bx = vec4 ( tI . c , ty ) ;".split(" ")}]}}]},
{type:"textline",b:"bv = u_view_matrix * vec4 ( tI . a , 1.0 ) ; tx = u_proj_matrix * bv ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"tx . xy += u_subpixel_jitter * tx . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ty = tx . x ; tz = tx . y ; tA = tx . w ; by . x = ( ty + tA ) / 2.0 ; by . y = ( tz + tA ) / 2.0 ; by . z = tA ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bz = - bv . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["tw","(",")",";"]}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( tI . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",
b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",
b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},
{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1},"NODES","ALPHA",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"pack.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",
file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bu",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bv",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",
d:1},"NODES","ALPHA",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { float tx , ty ; vec3 tz , tA , tB , tC ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"tz = u_camera_eye_frag - bu ; tz = normalize ( tz ) ; qO ( tz , tA , tB , tC , tx , ty ) ; ty = ty ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"ty = ( texture2D ( u_colormap0 , bE ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ty = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( ty < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","NO_SHADOWS",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2},{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( du ( bv . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor . a += 0.00001 * bx . r ;".split(" ")}]}}]}]}}]},
{type:"textline",b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute",
"vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",d:3}],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",
d:4}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1},"TEXTURE_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS",
"BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD","SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",
d:2},{type:"logic_negative_expr",d:1},"TEXTURE_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION",
"float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bu",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4",
"bv",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["varying","float","bz",";"]}]}}]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec2 um ; vec4 un , uo ; float up ; mat4 uq , ur ; vec3 us , ut , uu , uv , uw , ux ; us = a_position ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["ut","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ut = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE",
{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"uu = vec3 ( a_tangent ) ; uv = a_tangent [ 3 ] * cross ( ut , uu ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uu = vec3 ( 0.0 ) ; uv = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"us = mix ( us , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"ut = mix ( ut , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"uw = vec3 ( a_tangent ) ; ux = a_tangent_next [ 3 ] * cross ( a_normal_next , uw ) ; uu = mix ( uu , uw , u_va_frame_factor ) ; uv = mix ( uv , ux , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"sD ( us , uu , uv , ut ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uv","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uv = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",
b:"aM uy = ub ( us , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ut , uv , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"uu = ( u_model_matrix * vec4 ( uv , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD",{type:"logic_negative_expr",d:1},"SHADOW_USAGE","SHADOW_CASTING",
{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uq","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uq","=","u_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ur = rw ( u_camera_eye , uu , uq , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ur = rq ( u_camera_eye , uu , uq ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ux = ( u_model_matrix * vec4 ( uv , 1.0 ) ) . xyz ; ur = ur * ri ( u_wind , u_time , u_jitter_amp , u_jitter_freq , ux ) ;".split(" ")}]}}]},{type:"textline",b:"aM uy = rD ( us - uv , uv , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ut , ur ) ; uy . b = uu ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"aM uy = rD ( us , uv , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ut , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["ut","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ut = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",
b:"tr ( uy . a , uy . b , ut ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bu = uy . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"bw = uy . e ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"up = ( dot ( cross ( uy . e , uy . c ) , uy . d ) < 0.0 ) ? - 1.0 : 1.0 ; bx = vec4 ( uy . c , up ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"un = u_view_matrix * vec4 ( uy . a , 1.0 ) ; uo = u_proj_matrix * un ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"uo . xy += u_subpixel_jitter * uo . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES",
"ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"by = bt ( uo ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bz = - bv . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",
b:["tw","(",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"bE = rG ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ul ( uy . a , uy . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",
d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["bv","=","un",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"um = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; up = SHADOW_TEX_RES / 2.0 ; um = floor ( um * up + 0.5 ) / up - um ; uo . xy += um ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","uo",";","}"]}]};a["grass_map.glslf"]=
{type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","um",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","um",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",
b:["varying","vec3","um",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","um",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( um , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , um ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute",
"float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","um",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","um",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","um",";"]}]}}]}]}}]},{type:"textline",b:"void main ( ) { vec4 un ; mat4 uo ; vec3 up ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",
a:[{type:"textline",b:"up = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; uo = rq ( u_camera_eye , up , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uo = uo * ri ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"aM uq = rD ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , uo ) ; uq . b = up ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"aM uq = rD ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"un = u_proj_matrix * u_view_matrix * vec4 ( uq . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"um = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["um","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["um","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","un",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",
b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",
d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 un ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 bE ; varying float uo ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS","NUM_LINES",{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const int up = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"const int up = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float ur ( float uq ) { return uq - floor ( uq * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void uA ( inout float us , in float ut [ up ] , in float uu ) { float uv , uw , ux , uy ; for ( int uz = 0 ; uz < NUM_RINGS ; uz ++ ) { uv = 40.0 * ut [ uz ] ; uw = 300.0 * ( ur ( uv ) - 0.005 ) ; ux = uv ; uy = abs ( ux * ( u_halo_size * uw - uu ) ) ; us += 1.0 - min ( uy , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void uJ ( inout float uB , in float uC [ up ] , in float uD ) { float uE , uF , uG , uH ; for ( int uI = 0 ; uI < NUM_LINES ; uI ++ ) { uE = uC [ uI ] ; uF = uE ; uG = 1000.0 * ( ur ( uE ) - 0.005 ) ; uH = 20.0 * abs ( uF * bE . x + uG * bE . y ) ; uB += 1.0 - min ( uH , 1.0 ) ; } uB *= uD ; }".split(" ")}]}}]},{type:"textline",b:"void uQ ( inout float uK , in vec2 uL ) { float uM , uN , uO , uP ; uN = atan ( uL . y , uL . x ) ; uN *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; uO = cos ( uN ) ; uP = sin ( uN ) ; uN = ( uO * uL . x + uP * uL . y ) * ( uO * uL . y - uP * uL . x ) ; uM = abs ( uN ) ; if ( uM < 1.0 ) { uM = ( 0.01 * u_halo_size ) / ( uM ) ; uK *= sqrt ( min ( uM , 1.0 ) ) ; } } void main ( ) { vec3 uR ; float uS , uT , uU , uV ; uS = ( bE . x * bE . x + bE . y * bE . y ) ; uT = sqrt ( uS ) ; uS = max ( 1.0 - uS , 0.0 ) ; uS = pow ( uS , u_halo_hardness ) ; uU = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","NUM_LINES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float uW [ up ] ; for ( int uX = 0 ; uX < up ; uX ++ ) { uW [ uX ] = fract ( uo / ( float ( uX ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"uV = 0.0 ; uA ( uV , uW , uT ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"uT = 0.0 ; uJ ( uT , uW , uS ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"uQ ( uS , bE ) ;".split(" ")}]}}]},{type:"textline",b:"uS *= uU ; uR = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"uV *= uS ; uR += u_halo_rings_color * uV ; uS += uV ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"uT *= uU ; uR += u_halo_lines_color * uT ; uS += uT ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"uS *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uT = u_halo_stars_blend * ( un . y - u_halo_stars_height ) ; uS *= clamp ( uT , 0.0 , 1.0 ) ; uS *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"aG ( uR ) ; aJ ( uR , uS ) ; gl_FragColor = vec4 ( uR , uS ) ; }".split(" ")}]};a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 bE ; varying float uo ;".split(" ")},{type:"condition",a:[{type:"if",
c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","un",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 up , uq ; mat4 ur , us ; vec3 ut ; ut = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; bE = a_halo_bb_vertex * 2.0 ; uo = fract ( ut . x + ut . y + ut . z ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"ur = qV ( ut , u_view_matrix ) ; us = u_view_matrix ; us [ 3 ] [ 0 ] = 0.0 ; us [ 3 ] [ 1 ] = 0.0 ; us [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ur = qV ( ut , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"up = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; up = ur * up ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",
a:[{type:"textline",b:"uq = u_proj_matrix * us * up ; uq . z = 0.99999 * uq . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["un","=","up",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uq = u_proj_matrix * u_view_matrix * up ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","uq",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",
file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 up ; up = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( up , 1.0 ) ; }".split(" ")}]};
a["main.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",
name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},
{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_VECTOR_VIEW",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3",
"u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",
b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",
a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION","REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D",
"u_scene_depth",";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","bu",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",
{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"textline",b:["varying","vec4","bv",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",
a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"nodes.glslf"},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",
b:"void main ( ) { vec2 vd ; vec3 ve , vf , vg , vh , vi ; float vj , vk , vl , vm ; vj = length ( bv ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"vk = bu . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["ve","=","u_sun_intensity",
";"]}]}}]},{type:"textline",b:"vf = normalize ( u_camera_eye_frag - bu ) ; qO ( vf , vg , vh , vi , vl , vm ) ; vg = vg ; vm = vm ; vi = vi ; vl = vl ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"vg = max ( vg - sqrt ( 0.01 * - min ( vk , 0.0 ) ) , 0.5 * vg ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"aC ( vg , vk , u_time , vl , vi , u_sun_direction , ve , u_sun_quaternion , bu , vj ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( vm <= 0.5 ) discard ; vm = 1.0 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES_GLOW",
{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["vm","=","1.0",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"vc ( vg , length ( bv ) , vf , vk ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vc ( vg , length ( bv ) , vf , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vd = texture2DProj ( u_shadow_mask , by ) . rg ; vk = vd . g ; vg = vec3 ( vk ) ;".split(" ")}]}}]},{type:"textline",b:["aG","(","vg",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2},"NODES_GLOW",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"aJ ( vg , vm ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( vg , vm ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3",
"a_position",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",
d:1},"BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},
{type:"textline",b:["varying","vec3","bu",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO",
"PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bv",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["varying",
"vec3","vd",";"]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ve",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bA",";"]},{type:"condition",
a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",
d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},
{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 vf , vg ; float vh ; mat4 vi ; vec3 vj , vk , vl , vm , vn , vo , vp ; vj = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"NODES",{type:"logic_negative_expr",
d:1},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["vk","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vk = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vl = vec3 ( a_tangent ) ; vm = a_tangent [ 3 ] * cross ( vk , vl ) ;".split(" ")}]}},
{type:"elif",c:["NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vn = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vo = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vn = vn - u_camera_eye ; vm = cross ( vn , vo ) ; vl = cross ( vo , vm ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vl = vec3 ( 0.0 ) ; vm = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"vj = mix ( vj , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"vk = mix ( vk , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vo = vec3 ( a_tangent ) ; vn = a_tangent_next [ 3 ] * cross ( a_normal_next , vo ) ; vl = mix ( vl , vo , u_va_frame_factor ) ; vm = mix ( vm , vn , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"sD ( vj , vl , vm , vk ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",
a:[{type:"textline",b:["vn","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vn = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"aM vq = ub ( vj , vl , vm , vk , vn , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:"vo = ( u_model_matrix * vec4 ( vn , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vi = rw ( u_camera_eye , vo , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vi = rq ( u_camera_eye , vo , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vp = ( u_model_matrix * vec4 ( vn , 1.0 ) ) . xyz ; vi = vi * ri ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vp ) ;".split(" ")}]}}]},{type:"textline",b:"aM vq = rD ( vj - vn , vn , vl , vm , vk , vi ) ; vq . b = vo ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"aM vq = rD ( vj , vn , vl , vm , vk , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vh = ( dot ( cross ( vq . e , vq . c ) , vq . d ) < 0.0 ) ? - 1.0 : 1.0 ; bx = vec4 ( vq . c , vh ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"tr ( vq . a , vq . b , vk ) ;".split(" ")}]}}]},{type:"textline",b:"bu = vq . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",
d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"bw = vq . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vd = u_camera_eye - vq . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",
b:"bE = rG ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"ve = vq . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["ve","=","a_color",";"]}]}}]}]}}]},{type:"textline",b:"vf = u_view_matrix * vec4 ( vq . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",
d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["bv","=","vf",";"]}]}}]},{type:"textline",b:"vg = u_proj_matrix * vf ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"vg . xy += u_subpixel_jitter * vg . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",
d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"by = bt ( vg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ul ( vq . a , vq . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"bz = - vf . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:["tw","(",")",";"]}]}}]},{type:"textline",b:["gl_Position","=","vg",";","}"]}]};a["main_stack.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",
b:["0"]},{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",
name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"gamma.glslf"},
{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",
b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4",
"u_fog_params",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","ALPHA_AS_SPEC",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",
b:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",
";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","PARALLAX",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 bu ; varying vec3 bw ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",
d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bv",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]},{type:"textline",b:["varying","vec3","vd",";"]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR",
"DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ve",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","bC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",
a:[{type:"textline",b:["varying","float","bz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",b:"void main ( ) { vec4 xn , xo , xp , xq ; mat3 xr ; vec2 xs , xt , xu , xv ; vec3 xw , xx , xy , xz , xA , xB , xC , xD , xE ; float xF , xG , xH , xI , xJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",
d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"xF = length ( bv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"xG = bu . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",
a:[{type:"textline",b:["xw","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["xs","=","bE",";"]}]}}]},{type:"textline",b:["xx","=","bw",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) xx = xx ; else xx = - xx ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"xy = cross ( xx , bx . xyz ) * bx . w ; xr = mat3 ( bx . xyz , xy , xx ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xt = normalize ( u_view_matrix_frag * vec4 ( bw , 0.0 ) ) . st ; xt = xt * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( xF < PARALLAX_LOD_DIST ) { xH = clamp ( 0.5 * ( PARALLAX_LOD_DIST - xF ) , 0.0 , 1.0 ) ; xH = u_parallax_scale * xH ; xy = normalize ( vd * xr ) ; xI = 1.0 / PARALLAX_STEPS ; xu = xy . xy * xH / ( PARALLAX_STEPS * xy . z ) ; xH = 1.0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["xv","=","xt",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["xv","=","xs",";"]}]}}]},{type:"textline",b:"xJ = texture2D ( u_normalmap0 , xv ) . a ; for ( float xK = 1.0 ; xK <= PARALLAX_STEPS ; xK ++ ) { if ( xJ < xH ) { xH -= xI ; xv -= xu ; xJ = texture2D ( u_normalmap0 , xv ) . a ; } } xu = xv + xu ; xI = texture2D ( u_normalmap0 , xu ) . a - ( xH + xI ) ; xH = xJ - xH ; xI = xH / ( xH - xI ) ; xv = xI * xu + ( 1.0 - xI ) * xv ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xs += xv - xt ;".split(" ")}]}}]},{type:"textline",b:["xt","=","xv",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xt += xv - xs ;".split(" ")}]}}]},{type:"textline",b:["xs","=","xv",";"]}]}}]},
{type:"textline",b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xn = texture2D ( u_normalmap0 , xt ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xn = texture2D ( u_normalmap0 , xs ) ;".split(" ")}]}}]},{type:"textline",b:"xy = xn . rgb - 0.5 ; xy = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , xy , u_normal_factor ) ; xy = xr * xy ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["xy","=","xx",";"]}]}}]},{type:"textline",b:"xy = normalize ( xy ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xt = normalize ( u_view_matrix_frag * vec4 ( xy , 0.0 ) ) . st ; xt = xt * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"xx = normalize ( vd ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"xz = ve ; aE ( xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xn = vec4 ( xz , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["xn","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["xI","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"xo = texture2D ( u_colormap0 , xt ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xo = texture2D ( u_colormap0 , xs ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"aE ( xo . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xp = texture2D ( u_colormap1 , xt ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xp = texture2D ( u_colormap1 , xs ) ;".split(" ")}]}}]},{type:"textline",b:"aE ( xp . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"xq = texture2D ( u_stencil0 , xt ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xq = texture2D ( u_stencil0 , xs ) ;".split(" ")}]}}]},{type:"textline",b:"xo = mix ( xo , xp , xq . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xn . rgb = mix ( xn . rgb , xo . rgb , u_diffuse_color_factor ) ; xH = u_alpha_factor * xo . a ; xH += ( 1.0 - step ( 0.0 , xH ) ) ; xn . a = mix ( xH , 1.0 , u_diffuse_color . a ) ; xI = xo . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xn . rgb *= mix ( vec3 ( 1.0 ) , xo . rgb , u_diffuse_color_factor ) ; xn . a = xo . a ; xI = xo . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"xz = u_diffuse_intensity * xn . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["xA","=","xz",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xB = u_environment_energy * dW ( xy ) ; xB = u_ambient * xB ; xH = dz ( xz ) ; xC = u_emit * xn . rgb ; xD = u_specular_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"xE = vec3 ( xI ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xE = texture2D ( u_specmap0 , xt ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xE = texture2D ( u_specmap0 , xs ) . rgb ;".split(" ")}]}}]},
{type:"textline",b:"aE ( xE . rgb ) ; xD = mix ( xD , xE , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"xI = u_specular_params [ 0 ] ; xs = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; xD = xI * xD ; xm ( xC , xB , xz , xD , bu , xy , xx , xs , u_diffuse_params , xH , 0.0 , vec4 ( 0.0 ) , xA , xE ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},
{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dT ( xA , xx , xy , u_reflect_factor ) ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dT ( xA , xx , xy , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["xA","+=","xE",";"]}]}}]},{type:"textline",b:"xI = xn . a ;".split(" ")},{type:"condition",
a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"xA = max ( xA - sqrt ( 0.01 * - min ( xG , 0.0 ) ) , 0.5 * xA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"aC ( xA , xG , u_time , xH , xy , u_sun_direction , xw , u_sun_quaternion , bu , xF ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( xI <= 0.5 ) discard ; xI = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"xH = max ( max ( xE . r , xE . g ) , xE . b ) * u_specular_alpha ; xI = xn . a * ( 1.0 - xH ) + xH ;".split(" ")}]}}]}]}}]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["xI","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"xA = mix ( ej ( by , xy . xz * u_refr_bump ) , xA , xI ) ; xI = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"vc ( xA , xF , xx , xG ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"vc ( xA , xF , xx , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["aG","(","xA",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"aJ ( xA , xI ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( xA , xI ) ; }".split(" ")}]};a["main_stack.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",
name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",
"WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4",
"a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",
a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],
group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",
a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform",
"vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:["varying","vec3","bu",";"]},{type:"condition",
a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS",
"CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bv",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","vd",";"]},{type:"condition",a:[{type:"if",
c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ve",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",
{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 xn , xo ; float xp ; mat4 xq ; vec3 xr , xs , xt , xu , xv , xw , xx ; xr = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"NODES",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:6}],
group:{type:"group",a:[{type:"textline",b:["xs","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xs = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xt = vec3 ( a_tangent ) ; xu = a_tangent [ 3 ] * cross ( xs , xt ) ;".split(" ")}]}},
{type:"elif",c:["NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xv = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; xw = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; xv = xv - u_camera_eye ; xu = cross ( xv , xw ) ; xt = cross ( xw , xu ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xt = vec3 ( 0.0 ) ; xu = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"xr = mix ( xr , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"xs = mix ( xs , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"xw = vec3 ( a_tangent ) ; xv = a_tangent_next [ 3 ] * cross ( a_normal_next , xw ) ; xt = mix ( xt , xw , u_va_frame_factor ) ; xu = mix ( xu , xv , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"sD ( xr , xt , xu , xs ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",
a:[{type:"textline",b:["xv","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xv = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"aM xy = ub ( xr , xt , xu , xs , xv , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:"xw = ( u_model_matrix * vec4 ( xv , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xq = rw ( u_camera_eye , xw , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xq = rq ( u_camera_eye , xw , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xx = ( u_model_matrix * vec4 ( xv , 1.0 ) ) . xyz ; xq = xq * ri ( u_wind , u_time , u_jitter_amp , u_jitter_freq , xx ) ;".split(" ")}]}}]},{type:"textline",b:"aM xy = rD ( xr - xv , xv , xt , xu , xs , xq ) ; xy . b = xw ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"aM xy = rD ( xr , xv , xt , xu , xs , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xp = ( dot ( cross ( xy . e , xy . c ) , xy . d ) < 0.0 ) ? - 1.0 : 1.0 ; bx = vec4 ( xy . c , xp ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"tr ( xy . a , xy . b , xs ) ;".split(" ")}]}}]},{type:"textline",b:"bu = xy . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",
d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"bw = xy . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vd = u_camera_eye - xy . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",
b:"bE = rG ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"ve = xy . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["ve","=","a_color",";"]}]}}]}]}}]},{type:"textline",b:"xn = u_view_matrix * vec4 ( xy . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",
d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["bv","=","xn",";"]}]}}]},{type:"textline",b:"xo = u_proj_matrix * xn ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"xo . xy += u_subpixel_jitter * xo . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",
d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"by = bt ( xo ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ul ( xy . a , xy . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"bz = - xn . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:["tw","(",")",";"]}]}}]},{type:"textline",b:["gl_Position","=","xo",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"include",file:"pack.glslf"}]}}]},
{type:"var",name:"SOFT_STRENGTH",b:["1.0"]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec2 u_texel_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:"varying float xn ; varying vec3 ve ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],
group:{type:"group",a:[{type:"textline",b:"varying vec4 bv ; varying vec3 by ; varying float xo ;".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec4 xp ; vec3 xq ; float xr , xs , xt ; vec2 xu , xv ; xu = gl_PointCoord - 0.5 ; xr = 2.0 * length ( xu ) ; xr = smoothstep ( u_p_alpha_start , u_p_alpha_end , xr ) ; xr = u_diffuse_color . a * xn * ( 1.0 - xr ) ; xq = ve * u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",
b:"xv = by . xy / by . z ; xu = vec2 ( xu . x , - xu . y ) * xo * u_texel_size ; xu = vec2 ( xv + xu ) ; xp = texture2D ( u_scene_depth , xu ) ; xs = k ( xp ) ; xt = - bv . z / u_view_max_depth ; xt = xs - xt ; xt = u_view_max_depth / SOFT_STRENGTH * xt ; xr = xr * min ( xt , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["aG","(","xq",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"aJ ( xq , xr ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( xq , xr ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_wind ; uniform float u_height ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float xn ; varying vec3 ve ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"varying vec4 bv ; varying vec3 by ; varying float xo ;".split(" ")}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { float yb , yc , yd , ye ; vec4 yf , yg ; xp yh ; yh = ya ( ) ; yf = u_view_matrix * vec4 ( yh . b , 1.0 ) ; yg = u_proj_matrix * yf ; gl_Position = yg ; xn = yh . c ; ve = yh . d ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["bv","=","yf",";"]}]}}]},{type:"textline",b:"yb = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; yb = yh . a * yb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"yc = yg . x ; yd = yg . y ; ye = yg . w ; by . x = ( yc + ye ) / 2.0 ; by . y = ( yd + ye ) / 2.0 ; by . z = ye ; xo = yb ;".split(" ")}]}}]},{type:"textline",
b:["gl_PointSize","=","yb",";","}"]}]};a["particles_texture.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},
{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"var",name:"SOFT_STRENGTH",b:["1.0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float xn ; varying vec3 ve ; varying vec2 bE ; varying vec3 bu ;".split(" ")},{type:"condition",
a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1},"DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","vd",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bv",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { vec2 yb ; float yc , yd , ye ; vec3 yf , yg , yh , yi , yj , yk , yl , ym ; vec4 yn , yo ; yn = u_diffuse_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"yo = texture2D ( u_sampler , bE ) ; aE ( yo . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"yn . rgb = mix ( yn . rgb , yo . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"yn . rgb *= mix ( vec3 ( 1.0 ) , yo . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"yn . a = yo . a ;".split(" ")}]}}]},{type:"textline",b:"yn . rgb *= ve ; yf = u_diffuse_intensity * yn . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1},"DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"yg = normalize ( vd ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"yh = u_emit * yn . rgb ; yi = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logic_negative_expr",d:1},"SKY_COLOR",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"yj = u_environment_energy * dW ( vec3 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"yj = u_environment_energy * dW ( yi ) ;".split(" ")}]}}]},{type:"textline",b:"yj = u_ambient * yj ; yc = u_specular_params [ 0 ] ; yb = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; yk = yc * u_specular_color ; xm ( yh , yj , yf , yk , bu , yi , yg , yb , u_diffuse_params , 1.0 , 0.0 , vec4 ( 0.0 ) , yl , ym ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["yl","=","yf",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:"vc ( yl , length ( bv ) , yg , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"yc = yn . a * xn ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"yd = - bv . z / u_view_max_depth ; yn = texture2DProj ( u_scene_depth , by ) ; ye = k ( yn ) ; yd = ye - yd ; yd = u_view_max_depth / SOFT_STRENGTH * yd ; yc = yc * min ( yd , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["aG","(","yl",")",";"]},{type:"condition",
a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"aJ ( yl , yc ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( yl , yc ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform vec3 u_wind ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float xn ; varying vec3 ve ; varying vec2 bE ; varying vec3 vd ; varying vec3 bu ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bv",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float yd ( vec2 yb , vec2 yc ) { return ( atan ( yc . y , yc . x ) - atan ( yb . y , yb . x ) ) ; } void main ( ) { vec4 ye , yf , yg ; mat4 yh ; float yi , yj , yk ; xp yl ; yl = ya ( ) ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { yi = yl . e ; yh = qV ( yl . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { yi = yl . e ; yh = bf ( ) ; yh [ 3 ] = vec4 ( yl . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { yi = yl . e ; yh = bj ( radians ( 90.0 ) ) ; yh [ 3 ] = vec4 ( yl . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { yi = yd ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + yl . e ; yh = bh ( radians ( - 90.0 ) ) ; yh [ 3 ] = vec4 ( yl . b , 1.0 ) ; } ye = vec4 ( a_p_bb_vertex * 2.0 * yl . a * u_p_size , 0.0 , 1.0 ) ; ye = yh * bl ( yi ) * ye ; yf = u_view_matrix * ye ; yg = u_proj_matrix * yf ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"yi = yg . x ; yj = yg . y ; yk = yg . w ; by . x = ( yi + yk ) / 2.0 ; by . y = ( yj + yk ) / 2.0 ; by . z = yk ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = yg ; xn = yl . c ; ve = yl . d ; bE = a_p_bb_vertex + 0.5 ; bu = ye . xyz ; vd = u_camera_eye - ye . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["bv","=","yf",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 yb ; const float yc = 0.99 ; const float yd = 1.8 ; const int ye = 8 ; float yk ( vec3 yf , vec3 yg ) { float yh , yi , yj ; yh = dot ( yg , yg ) ; yi = 2.0 * dot ( yg , yf ) ; yj = dot ( yf , yf ) - 1.0 ; yh = yi * yi - 4.0 * yh * yj ; yh = sqrt ( yh ) ; yh = ( - yi - yh ) / 2.0 ; yh = yj / yh ; return yh ; } float yr ( float yl , float ym ) { float yn , yo , yp , yq ; yn = 3.0 * ( 1.0 - ym * ym ) ; yo = 2.0 * ( 2.0 + ym * ym ) ; yp = 1.0 + yl * yl ; yq = pow ( 1.0 + ym * ym - 2.0 * ym * yl , 1.5 ) ; yq = max ( yq , 0.00001 ) ; return ( yn / yo ) * ( yp / yq ) ; } float yx ( vec3 ys , vec3 yt , float yu ) { vec3 yv ; float yw ; yw = dot ( yt , - ys ) ; if ( yw < 0.0 ) { return 1.0 ; } yv = ys + yw * yt ; if ( length ( yv ) < yu ) { return 0.0 ; } else if ( length ( yv ) >= yu ) { yv = normalize ( yv ) * yu - ys ; yw = acos ( dot ( normalize ( yv ) , yt ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( yw * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 yB ( float yy , vec3 yz , float yA ) { return yz - yz * pow ( u_sky_color , vec3 ( yA / yy ) ) ; } void main ( ) { float yC , yD , yE , yF , yG , yH , yI , yJ , yK ; vec3 yL , yM , yN , yO , yP , yQ , yR ; yL = normalize ( yb ) ; yM = u_sun_direction ; yC = dot ( yL , yM ) ; yD = yr ( yC , - 0.01 ) * u_rayleigh_brightness * yM . y ; yE = yr ( yC - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - yM . y ) ; yC = smoothstep ( 0.0 , 100.0 , yr ( yC , 0.9995 ) ) * u_spot_brightness ; yN = vec3 ( 0.0 , yc , 0.0 ) ; yF = yk ( yN , yL ) ; yG = yF / float ( ye ) ; yH = yx ( yN , yL , yc - 0.3 ) ; yO = vec3 ( 0.0 , 0.0 , 0.0 ) ; yP = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int yS = 0 ; yS < ye ; yS ++ ) { yI = yG * float ( yS ) ; yQ = yN + yL * yI ; yJ = yx ( yQ , yM , yc - 0.2 ) ; yK = yk ( yQ , yM ) ; yR = yB ( yK , vec3 ( yd ) , u_scatter_strength ) * yJ ; yO += yB ( sqrt ( yI ) , u_sky_color * yR , u_rayleigh_strength ) ; yP += yB ( yI , yR , u_mie_strength ) ; } yO = yO * yH * pow ( yF , u_rayleigh_collection_power ) / float ( ye ) ; yP = ( yP * yH * pow ( yF , u_mie_collection_power ) ) / float ( ye ) ; yO = vec3 ( yC * yP + yE * yP + yD * yO ) ; aG ( yO ) ; gl_FragColor = vec4 ( yO , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 yb ; void main ( ) { vec4 yc , yd ; yc = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; yd = u_cube_view_matrix * yc ; yb = yd . xyz ; gl_Position = yc ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 bE ; void main ( ) { vec4 yc ; yc = texture2D ( u_sampler , bE ) ; aG ( yc . rgb ) ; aJ ( yc . rgb , yc . a ) ; gl_FragColor = yc ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 bE ; void main ( ) { vec2 yc ; float yd ; vec4 ye ; vec3 yf ; bE = a_texcoord ; yf = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; ye = u_proj_matrix * u_view_matrix * vec4 ( yf , 0.0 ) ; ye . x /= ye . w ; ye . y /= ye . w ; ye += 99999.0 * step ( ye . z , 0.0 ) ; ye += 100.0 * ( step ( 1.0 , abs ( ye . x ) ) + step ( 1.0 , abs ( ye . y ) ) ) ; ye . x = - a_lf_dist * ye . x ; ye . y = - a_lf_dist * ye . y ; yd = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; yc = vec2 ( a_lf_bb_vertex . x / yd , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float yg = 1.9 ; yc *= ( 1.0 + yg * length ( ye . xy ) ) ; } gl_Position = vec4 ( ye . xy + yc , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"define",name:"INV_PI",b:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["WO_SKYTEX","PROCEDURAL_SKYDOME",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky",";"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"blending.glslf"},{type:"textline",b:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ; vec3 Ai ( vec3 Ad , vec3 Ae , float Af , float Ag ) { float Ah ; Ah = Af * Ag ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ys ( Ae , Ad , Ah ) ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","ADD",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yw ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SUBTRACT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yA ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yF ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SCREEN",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"return yK ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","OVERLAY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yP ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yT ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIVIDE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"return yX ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DARKEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return za ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LIGHTEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ze ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","HUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zk ( Ae , Ad , Ah ) ;".split(" ")}]}},{type:"elif",
c:["BLENDTYPE","SATURATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zq ( Ae , Ad , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","VALUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zw ( Ae , Ad , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","COLOR",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zC ( Ae , Ad , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"return zH ( Ae , Ad , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zL ( Ae , Ad , Ah ) ;".split(" ")}]}}]},{type:"textline",b:"return vec3 ( 1.0 , 0.0 , 1.0 ) ; } float Aq ( float Aj , float Ak , float Al , float Am ) { float An ; vec3 Ao , Ap ; Ao = vec3 ( Aj ) , Ap = vec3 ( Ak ) ; An = Al * Am ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","MIX",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ys ( Ap , Ao , An ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","ADD",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yw ( Ao , Ap , An ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SUBTRACT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yA ( Ao , Ap , An ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"return zR ( Aj , Ak , An , Am ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SCREEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zX ( Aj , Ak , An , Am ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","OVERLAY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return Ac ( Aj , Ak , An , Am ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yT ( Ao , Ap , An ) . x ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","DIVIDE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yX ( Ao , Ap , An ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DARKEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return za ( Ao , Ap , An ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LIGHTEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ze ( Ao , Ap , An ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SOFT_LIGHT",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zH ( Ap , Ao , An ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zL ( Ap , Ao , An ) . x ;".split(" ")}]}}]},{type:"textline",b:["return","0.0",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"REFLECTION_PASS",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","yb",";"]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",
d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 Ar ; float As , At , Au ; vec3 Av , Aw , Ax , Ay , Az ; Aw = normalize ( yb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME"],group:{type:"group",a:[{type:"textline",b:"Av = textureCube ( u_sky , Aw ) . rgb ;".split(" ")}]}},{type:"elif",c:["WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",
d:2},{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"Av = u_horizon_color ; aG ( Av ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"textline",b:"Ax = vec3 ( bE , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ax = vec3 ( yb . xy , 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:["As","=","0.0",";"]},{type:"condition",a:[{type:"if",
c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"As = abs ( bE . y ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"As = ( bE . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"At = acos ( Aw . y ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",
a:[{type:"textline",b:"As = abs ( At * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"As = 1.0 - At * INV_PI ;".split(" ")}]}}]}]}}]}]}}]},{type:"textline",b:"Ay = u_horizon_color ; Az = u_zenith_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYTEX"],group:{type:"group",a:[{type:"textline",b:"At = 1.0 ; Ar = textureCube ( u_sky , Aw ) ; aE ( Ar . rgb ) ; At = Ar . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",
a:[{type:"textline",b:"At = dot ( Ar . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MTEX_NEGATIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"Ar = vec4 ( vec3 ( 1.0 ) - Ar . rgb , Ar . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"At = 1.0 - At ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ",
"WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"Ar = vec4 ( u_sky_tex_color , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"At = Ar . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ"],group:{type:"group",a:[{type:"textline",b:"Ay = Ai ( Ar . rgb , Ay , At , u_sky_tex_fac [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["Au","=","0.0",";"]},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( Ax , vec3 ( 0.0 , 1.0 , 0.0 ) ) >= 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"Au = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",b:"else Au = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"Au = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"elif",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",b:"Au = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( Au != 0.0 ) Az = Ai ( Ar . rgb , Az , At , Au ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WOMAP_BLEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"At = dot ( Ar . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},{type:"textline",b:"As = Aq ( u_sky_tex_dvar , As , At , u_sky_tex_fac [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"Av = mix ( Ay , Az , As ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["Av","=","Ay",";"]}]}}]},{type:"textline",b:["aG","(","Av",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"aG ( Ay ) ; aG ( Az ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"Av = mix ( Ay , Az , As ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["Av","=","Ay",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",
{type:"logic_negative_expr",d:1},"REFLECTION_PASS",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"aE ( Av ) ; As = u_camera_eye_frag . y - WATER_LEVEL ; As = min ( - As * 0.03 , 0.8 ) ; At = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; Ay = vec3 ( 0.0 ) ; Ar = u_underwater_fog_color_density ; Ar . rgb = mix ( Ar . rgb , Ay , min ( - Aw . y + As , 1.0 ) ) * At ; As = clamp ( sign ( Aw . y - 0.05 * As ) , 0.0 , 1.0 ) ; Av = mix ( Ar . rgb , Av , As ) ; aG ( Av ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( Av , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 yb ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 Ad , Ae ; Ad = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; Ae = u_sky_vp_inverse * Ad ; yb = Ae . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bE = a_position . xy ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","Ad",";","}"]}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",
b:["0.0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},
{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT",
"SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHORE_SMOOTHING","WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],
group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_params",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2",
"u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float Ad = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 vd ; varying vec3 bu ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH",
{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bx ; varying vec3 Ae ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Af",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Ag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",
d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Ah",";"]}]}}]},{type:"include",
file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE","SHORE_SMOOTHING","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",b:"vec3 At ( in vec2 Ai , in vec3 Aj , in vec3 Ak , in vec3 Al , out float Am ) { float An , Ao , Ap ; vec2 Aq ; vec3 Ar , As ; Am = 0.0 ; Ar = reflect ( - Ak , Aj ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Aq = Ai . xy + Aj . xz * REFL_BUMP / bz ; Am = u_reflect_factor ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"As = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"As = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"} else { As = texture2D ( u_plane_reflection , Aq ) . rgb ; aE ( As ) ; }".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Am = u_mirror_factor ; As = Al * textureCube ( u_mirrormap , Ar ) . rgb ; aE ( As ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Am = u_reflect_factor ; As = Al * vec3 ( 0.3 , 0.5 , 1.0 ) ; aE ( As ) ;".split(" ")}]}}]},
{type:"textline",b:"Ar = normalize ( Ar + Ak ) ; An = 1.0 - dot ( Ak , Ar ) ; Ao = u_fresnel_params [ 3 ] ; Ap = u_fresnel_params [ 2 ] ; Ap = Ao + ( 1.0 - Ao ) * pow ( An , Ap ) ; Am = min ( Am * Ap , 1.0 ) ; return As ; }".split(" ")},{type:"include",file:"lighting_nodes.glslf"},{type:"textline",b:"void main ( ) { vec4 Au ; vec2 Av , Aw , Ax ; float Ay , Az , AA , AB , AC , AD ; vec3 AE , AF , AG , AH , AI , AJ , AK , AL , AM ; mat3 AN ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AN = mat3 ( bx , Ae , bw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"AE = normalize ( bw ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AE = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","FOAM",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ay = bu . y - WATER_LEVEL ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"Av = vec2 ( Af . x , - Af . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Av = vec2 ( bu . x , - bu . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["Av","=","bE",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AF = vec3 ( 0.0 ) ; AG = texture2D ( u_normalmap0 , Av * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AF += AG ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"AH = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],
group:{type:"group",a:[{type:"textline",b:["AH","+=","AG",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AG = texture2D ( u_normalmap0 , Av * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AF += AG ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",
b:["AH","+=","AG",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AG = texture2D ( u_normalmap0 , Av * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AF += AG ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["AH","+=","AG",";"]}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AG = texture2D ( u_normalmap0 , Av * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AF += AG ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["AH","+=","AG",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"AH = AN * AH ; if ( ! aP ( AH , vec3 ( 0.0 ) ) ) AH = normalize ( AH ) ; AH = mix ( AE , AH , 0.2 ) ; AH = normalize ( AH ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"AE = mix ( AE , normalize ( AN * AF ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"AE = mix ( AE , normalize ( AN * AF ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"AE = normalize ( AE ) ;".split(" ")}]}}]},{type:"textline",b:"AF = normalize ( vd ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Aw = by . xy / by . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",
d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Az = bz * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"AA = u_diffuse_color . a ; Au = texture2DProj ( u_scene_depth , by ) ; AB = k ( Au ) ; AC = max ( AB - bz , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"Ax = Aw + AE . xz * u_refr_bump / bz ; AB = eb ( AB , Ax , Aw ) ; AB = max ( AB - bz , 0.0 ) ; AB = u_view_max_depth / ABSORB * AB ; if ( u_cam_water_depth < 0.0 ) AD = 0.0 ; else AD = min ( AA * AB , 1.0 ) ; AB = u_view_max_depth / ABSORB * AC ; AA = min ( 15.0 * AA * u_view_max_depth * AC , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"AB = u_view_max_depth / ABSORB * AC ; if ( u_cam_water_depth > 0.0 ) AA = min ( AA * AB , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"AA *= min ( 5.0 * Az , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AA = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"AD = 1.0 - AA ; Ax = Aw + AE . xz * u_refr_bump / bz ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"AG = texture2D ( u_refractmap , Ax ) . rgb ; aE ( AG ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"AB = pow ( min ( Ag . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; AI = mix ( u_shallow_water_col , u_diffuse_color . rgb , AB ) ; AB = pow ( min ( Ag . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; AI = mix ( u_shore_water_col , AI , AB ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"AI = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"AC = max ( 1.0 - u_view_max_depth * AC , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AC = 1.0 - AA ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",
b:"Ay = max ( Ay / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"AJ = normalize ( vec3 ( Ag . r , 0.0 , Ag . g ) ) ; AJ = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , AJ , 0.8 ) ) ; AB = 1.25 * max ( dot ( AH , AJ ) - 0.2 , 0.0 ) ; AB += max ( dot ( AH , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; AC += AB * ( 1.0 - Ag . b ) ; Ay *= ( 1.0 - 0.95 * pow ( Ag . b , 0.1 ) ) ;".split(" ")}]}}]},{type:"textline",b:"AC += Ay ; AC = min ( u_foam_factor * AC , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"Au = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + Av * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"Ay = u_specular_params [ 0 ] ; Av = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; AH = Ay * u_specular_color ; AJ = u_environment_energy * dW ( AE ) ; AJ = u_ambient * AJ ; AJ = AJ + u_sun_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"AK = At ( Aw , AE , AF , AJ , Ay ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AK = At ( vec2 ( 0.0 ) , AE , AF , AJ , Ay ) ;".split(" ")}]}}]},{type:"textline",b:"AI = u_diffuse_intensity * AI ; xm ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , AI , AH , bu , AE , AF , Av , u_diffuse_params , 1.0 , 0.0 , vec4 ( 0.0 ) , AL , AM ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"AB = max ( dot ( u_sun_direction , - bw ) + SSS_WIDTH , 0.0 ) * max ( dot ( - AF , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; AB = clamp ( SSS_STRENGTH * AB , 0.0 , 1.0 ) ; AL = mix ( AL , u_shallow_water_col , AB ) ; AL = mix ( AL , u_shore_water_col , AB ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"AL = mix ( AG , AL , AD ) ;".split(" ")}]}}]},{type:"textline",b:"AL = mix ( AL , AK , Ay ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"Ay = mix ( Au . g , Au . r , max ( 4.0 * ( AC - 0.75 ) , 0.0 ) ) ; Ay = mix ( Au . b , Ay , max ( 2.0 * AC - 1.0 , 0.0 ) ) ; Ay = mix ( 0.0 , Ay , AC ) ; AL = mix ( AL , AJ , Ay ) ;".split(" ")}]}}]},{type:"textline",
b:["AL","+=","AM",";"]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { uW ( AL , Az , u_cam_water_depth ) ; } else { vc ( AL , Az , AF , 1.0 ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vc ( AL , Az , AF , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["aG","(","AL",")",";"]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"AA = max ( AA , AM . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["AA","+=","Ay",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"aJ ( AL , AA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",
":","enable"]},{type:"textline",b:"AM = fwidth ( Ah ) ; AM = smoothstep ( vec3 ( 0.0 ) , AM * Ad , Ah ) ; Ay = min ( min ( AM . x , AM . y ) , AM . z ) ; Ay = clamp ( Ay , 0.0 , 1.0 ) ; AL = mix ( u_wireframe_edge_color , AL , Ay ) ; AA = mix ( 1.0 , AA , Ay ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( AL , AA ) ; }".split(" ")}]};a["special_water.glslv"]={type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",
b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",
b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"DYNAMIC",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_normal ; attribute vec3 a_tangent ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH",{type:"logic_negative_expr",d:1},"NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 vd ; varying vec3 bu ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"varying vec3 bx ; varying vec3 Ae ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying",
"vec3","Af",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Ag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",
{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Ah",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 Am ( in vec2 Ad ) { float Ai ; vec4 Aj ; vec2 Ak ; Ak = 0.5 + vec2 ( ( Ad . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( Ad . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; Aj = texture2D ( u_shore_dist_map , Ak ) ; const vec2 Al = vec2 ( 1.0 / 255.0 , 1.0 ) ; Ai = dot ( Aj . ba , Al ) ; Ak = normalize ( Aj . rg * 2.0 - 1.0 ) ; return vec3 ( Ak , Ai ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void Ay ( inout vec3 An , in float Ao , in vec3 Ap ) { vec2 Aq , Ar , As ; float At , Au , Av , Aw , Ax ; At = ag ( DST_NOISE_SCALE_0 * ( An . xz + DST_NOISE_FREQ_0 * Ao ) ) * ag ( DST_NOISE_SCALE_1 * ( An . zx - DST_NOISE_FREQ_1 * Ao ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"Au = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; Av = Ap . b ; Aw = sqrt ( Av ) ; Au = max ( Av , DIR_MIN_SHR_FAC ) * sin ( Aw / Au + DIR_FREQ * Ao ) ; Ax = max ( ag ( DIR_NOISE_SCALE * ( An . xz + DIR_NOISE_FREQ * Ao ) ) , DIR_MIN_NOISE_FAC ) ; Au *= Ax ; Aw = WAVES_HEIGHT * mix ( Au , At , max ( Aw , DST_MIN_FAC ) ) ; Aq = Ap . rg ; Au = WAVES_HOR_FAC * Au * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - Av ) , 0.0 ) ; Aq = Au * Aq ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"Aw = WAVES_HEIGHT * At ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"Ar = 2.0 * ( An . xz - 0.1 * Ao ) ; As = 1.3 * ( An . zx + 0.03 * Ao ) ; At = L ( 0.5 * Ar ) . x + L ( 0.5 * As ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"An . xz += Aq ; At *= Av ;".split(" ")}]}}]},{type:"textline",b:"Aw += SMALL_WAVES_FAC * At ;".split(" ")}]}}]},{type:"textline",
b:"An . y += Aw ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec4 Az , AA ; vec2 AB ; float AC , AD , AE ; vec3 AF , AG , AH , AI ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) Ah = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Ah = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Ah = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["AF","=","a_position",";"]},
{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"AC = abs ( AF . y ) ; AB = u_camera_eye . xz - mod ( u_camera_eye . xz , AC ) ; AF . y = WATER_LEVEL ; AF . xz += AB ;".split(" ")}]}},{type:"elif",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["bE","=","a_texcoord",";"]}]}}]},{type:"textline",b:"aM AJ = rD ( AF , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"Ag = Am ( AJ . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"AD = length ( u_wind ) ; AE = u_time ; AE *= AD ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"AC = AC ; AF = AJ . a + vec3 ( AC , 0.0 , 0.0 ) ; AG = AJ . a + vec3 ( 0.0 , 0.0 , AC ) ; if ( a_position . y < 0.0 ) { AJ . a . y = WATER_LEVEL - 1.0 ; AF . y = AJ . a . y ; AG . y = AJ . a . y ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Af = AJ . a ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AF = AJ . a + vec3 ( 0.05 , 0.0 , 0.0 ) ; AG = AJ . a + vec3 ( 0.0 , 0.0 , 0.05 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"AH = Am ( AF . xz ) ; AI = Am ( AG . xz ) ; Ay ( AF , AE , AH ) ; Ay ( AG , AE , AI ) ; Ay ( AJ . a , AE , Ag ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"Ay ( AF , AE , vec3 ( 0.0 ) ) ; Ay ( AG , AE , vec3 ( 0.0 ) ) ; Ay ( AJ . a , AE , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"AF = normalize ( AF - AJ . a ) ; AG = normalize ( AG - AJ . a ) ; bw = normalize ( cross ( AG , AF ) ) ; AE = dot ( bw , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; AE = clamp ( 0.8 - AE , 0.0 , 1.0 ) ; bw = mix ( bw , vec3 ( 0.0 , 1.0 , 0.0 ) , AE ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"AG = a_tangent ; bw = a_normal ;".split(" ")}]}}]},{type:"textline",b:"bx = AG ; Ae = cross ( bw , bx ) ;".split(" ")}]}}]},{type:"textline",b:"bu = AJ . a ; vd = u_camera_eye - AJ . a ; Az = u_view_matrix * vec4 ( AJ . a , 1.0 ) ; AA = u_proj_matrix * Az ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"AE = AA . x ; AC = AA . y ; AD = AA . w ; by . x = ( AE + AD ) / 2.0 ; by . y = ( AC + AD ) / 2.0 ; by . z = AD ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"bz = - Az . z / u_view_max_depth ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","AA",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 Ah ; const float Ad = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 Ai = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 Ai = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 Aj = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 Ak = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 Al = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float Am , An ; vec3 Ao , Ap ; Ao = vec3 ( 0.0 ) ; Am = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"Ap = sign ( Ah - vec3 ( 0.02 * Ad ) ) ; if ( Ap . x < 0.0 || Ap . y < 0.0 || Ap . z < 0.0 ) { Ao = Ai ; Am = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY",0,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ap = sign ( Ah - vec3 ( 0.02 * Ad ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( Ap . x < 0.0 || Ap . y < 0.0 || Ap . z < 0.0 ) Ao = u_wireframe_edge_color ; else Ao = Al ; Am = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( Ap . x < 0.0 || Ap . y < 0.0 || Ap . z < 0.0 ) Am = 1.0 ; else Am = 0.0 ; Ao = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( Ap . x < 0.0 || Ap . y < 0.0 || Ap . z < 0.0 ) Ao = u_wireframe_edge_color ; else if ( gl_FrontFacing ) Ao = Aj ; else Ao = Ak ; Am = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY",1,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"Ap = fwidth ( Ah ) ; Ap = smoothstep ( vec3 ( 0.0 ) , Ap * Ad , Ah ) ; An = min ( min ( Ap . x , Ap . y ) , Ap . z ) ; An = clamp ( An , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { Ao = vec3 ( mix ( u_wireframe_edge_color , Al , An ) ) ; Am = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { Ao = u_wireframe_edge_color ; Am = mix ( 1.0 , 0.0 , An ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) Ao = mix ( u_wireframe_edge_color , Aj , An ) ; else Ao = mix ( u_wireframe_edge_color , Ak , An ) ; Am = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["aG","(","Ao",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"aJ ( Ao , Am ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( Ao , Am ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},
{type:"textline",b:["varying","vec3","Ah",";"]},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 Ad ; mat4 Ai ; vec3 Aj , Ak , Al , Am , An ; if ( a_polyindex == 0.0 ) Ah = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Ah = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Ah = vec3 ( 0.0 , 0.0 , 1.0 ) ; Aj = a_position ; Ak = a_normal ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"aM Ao = rD ( Aj , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"Aj = mix ( Aj , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"Al = vec3 ( 0.0 ) ; Am = vec3 ( 0.0 ) ; sD ( Aj , Al , Am , Ak ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["Am","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Am = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"aM Ao = ub ( Aj , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Am , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"Al = ( u_model_matrix * vec4 ( Am , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ai = rw ( u_camera_eye , Al , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"Ai = rq ( u_camera_eye , Al , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"An = ( u_model_matrix * vec4 ( Am , 1.0 ) ) . xyz ; Ai = Ai * ri ( u_wind , u_time , u_jitter_amp , u_jitter_freq , An ) ;".split(" ")}]}}]},{type:"textline",b:"aM Ao = rD ( Aj - Am , Am , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ai ) ; Ao . b = Al ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"aM Ao = rD ( Aj , Am , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"tr ( Ao . a , Ao . b , Ak ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"Ad = u_view_matrix * vec4 ( Ao . a , 1.0 ) ; gl_Position = u_proj_matrix * Ad ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",
b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 bE ; void main ( ) { vec4 Ad , Ai ; Ad = texture2D ( u_sampler_left , bE ) ; Ai = texture2D ( u_sampler_right , bE ) ; gl_FragColor = vec4 ( Ad [ 0 ] , Ai [ 1 ] , Ai [ 2 ] , Ad [ 3 ] + Ai [ 3 ] ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},
{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 bE ; vec4 Ak ( float Ad , float Ai ) { vec2 Aj ; Aj = bE + vec2 ( Ad , Ai ) * u_texel_size ; return texture2D ( u_color , Aj ) ; } float Ao ( vec4 Al ) { float Am ; vec3 An ; An = vec3 ( 0.299 , 0.587 , 0.114 ) ; Am = dot ( Al . rgb , An ) ; return Am ; } vec4 AB ( ) { vec2 Ap ; float Aq , Ar , As , At , Au , Av ; vec4 Aw , Ax , Ay , Az , AA ; Aw = Ak ( - 1.0 , - 1.0 ) ; Ax = Ak ( 1.0 , - 1.0 ) ; Ay = Ak ( - 1.0 , 1.0 ) ; Az = Ak ( 1.0 , 1.0 ) ; AA = Ak ( 0.0 , 0.0 ) ; Aq = Ao ( Aw ) ; Ar = Ao ( Ax ) ; As = Ao ( Ay ) ; At = Ao ( Az ) ; Au = Ao ( AA ) ; Av = min ( Au , min ( min ( Aq , Ar ) , min ( As , At ) ) ) ; Au = max ( Au , max ( max ( Aq , Ar ) , max ( As , At ) ) ) ; Ap . x = - ( ( Aq + Ar ) - ( As + At ) ) ; Ap . y = ( ( Aq + As ) - ( Ar + At ) ) ; At = max ( ( Aq + Ar + As + At ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; At = 1.0 / ( min ( abs ( Ap . x ) , abs ( Ap . y ) ) + At ) ; Ap = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , Ap * At ) ) * u_texel_size ; AA = 0.5 * ( texture2D ( u_color , bE + Ap * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , bE + Ap * ( 2.0 / 3.0 - 0.5 ) ) ) ; Az = AA * 0.5 + 0.25 * ( texture2D ( u_color , bE + Ap * - 0.5 ) + texture2D ( u_color , bE + Ap * 0.5 ) ) ; At = Ao ( Az ) ; if ( ( At < Av ) || ( At > Au ) ) return AA ; else return Az ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 Bf ( ) { bool AC , AD , AE , AF , AG ; float AH , AI , AJ , AK , AL , AM , AN , AO , AP , AQ , AR , AS , AT , AU , AV ; vec4 AW , AX , AY , AZ , A_ ; vec2 Ba , Bb , Bc , Bd , Be ; Ba . x = bE . x ; Ba . y = bE . y ; AW = texture2D ( u_color , Ba ) ; AX = Ak ( 0.0 , 1.0 ) ; AY = Ak ( 1.0 , 0.0 ) ; AZ = Ak ( 0.0 , - 1.0 ) ; A_ = Ak ( - 1.0 , 0.0 ) ; AH = Ao ( AX ) ; AI = Ao ( AY ) ; AJ = Ao ( AZ ) ; AK = Ao ( A_ ) ; AL = Ao ( AW ) ; AM = max ( AH , AL ) ; AN = min ( AH , AL ) ; AM = max ( AI , AM ) ; AN = min ( AI , AN ) ; AO = max ( AJ , AK ) ; AP = min ( AJ , AK ) ; AM = max ( AO , AM ) ; AN = min ( AP , AN ) ; AP = AM * FXAA_QUALITY_EDGE_THRESHOLD ; AN = AM - AN ; AP = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , AP ) ; AC = AN < AP ; if ( AC ) return AW ; AW = Ak ( - 1.0 , - 1.0 ) ; A_ = Ak ( 1.0 , 1.0 ) ; AZ = Ak ( 1.0 , - 1.0 ) ; AY = Ak ( - 1.0 , 1.0 ) ; AP = Ao ( AW ) ; AM = Ao ( A_ ) ; AO = Ao ( AZ ) ; AQ = Ao ( AY ) ; AR = AJ + AH ; AS = AK + AI ; AN = 1.0 / AN ; AT = AR + AS ; AR = ( - 2.0 * AL ) + AR ; AS = ( - 2.0 * AL ) + AS ; AU = AO + AM ; AO = AP + AO ; AV = ( - 2.0 * AI ) + AU ; AO = ( - 2.0 * AJ ) + AO ; AP = AP + AQ ; AM = AQ + AM ; AV = ( abs ( AR ) * 2.0 ) + abs ( AV ) ; AO = ( abs ( AS ) * 2.0 ) + abs ( AO ) ; AS = ( - 2.0 * AK ) + AP ; AM = ( - 2.0 * AH ) + AM ; AV = abs ( AS ) + AV ; AO = abs ( AM ) + AO ; AU = AP + AU ; AP = u_texel_size . x ; AC = AV >= AO ; AU = AT * 2.0 + AU ; if ( ! AC ) AJ = AK ; if ( ! AC ) AH = AI ; if ( AC ) AP = u_texel_size . y ; AU = ( AU * ( 1.0 / 12.0 ) ) - AL ; AI = AJ - AL ; AK = AH - AL ; AJ = AJ + AL ; AH = AH + AL ; AD = abs ( AI ) >= abs ( AK ) ; AK = max ( abs ( AI ) , abs ( AK ) ) ; if ( AD ) AP = - AP ; AN = clamp ( abs ( AU ) * AN , 0.0 , 1.0 ) ; Bb . x = Ba . x ; Bb . y = Ba . y ; Bc . x = ( ! AC ) ? 0.0 : u_texel_size . x ; Bc . y = ( AC ) ? 0.0 : u_texel_size . y ; if ( ! AC ) Bb . x += AP * 0.5 ; if ( AC ) Bb . y += AP * 0.5 ; Bd . x = Bb . x - Bc . x ; Bd . y = Bb . y - Bc . y ; Be . x = Bb . x + Bc . x ; Be . y = Bb . y + Bc . y ; AU = ( ( - 2.0 ) * AN ) + 3.0 ; AI = Ao ( texture2D ( u_color , Bd ) ) ; AN = AN * AN ; AT = Ao ( texture2D ( u_color , Be ) ) ; if ( ! AD ) AJ = AH ; AK = AK * 1.0 / 4.0 ; AL = AL - AJ * 0.5 ; AN = AU * AN ; AD = AL < 0.0 ; AI -= AJ * 0.5 ; AT -= AJ * 0.5 ; AE = abs ( AI ) >= AK ; AF = abs ( AT ) >= AK ; if ( ! AE ) Bd . x -= Bc . x * 1.5 ; if ( ! AE ) Bd . y -= Bc . y * 1.5 ; AG = ( ! AE ) || ( ! AF ) ; if ( ! AF ) Be . x += Bc . x * 1.5 ; if ( ! AF ) Be . y += Bc . y * 1.5 ; if ( AG ) { if ( ! AE ) AI = Ao ( texture2D ( u_color , Bd . xy ) ) ; if ( ! AF ) AT = Ao ( texture2D ( u_color , Be . xy ) ) ; if ( ! AE ) AI = AI - AJ * 0.5 ; if ( ! AF ) AT = AT - AJ * 0.5 ; AE = abs ( AI ) >= AK ; AF = abs ( AT ) >= AK ; if ( ! AE ) Bd . x -= Bc . x * 2.0 ; if ( ! AE ) Bd . y -= Bc . y * 2.0 ; AG = ( ! AE ) || ( ! AF ) ; if ( ! AF ) Be . x += Bc . x * 2.0 ; if ( ! AF ) Be . y += Bc . y * 2.0 ; if ( AG ) { if ( ! AE ) AI = Ao ( texture2D ( u_color , Bd . xy ) ) ; if ( ! AF ) AT = Ao ( texture2D ( u_color , Be . xy ) ) ; if ( ! AE ) AI = AI - AJ * 0.5 ; if ( ! AF ) AT = AT - AJ * 0.5 ; AE = abs ( AI ) >= AK ; AF = abs ( AT ) >= AK ; if ( ! AE ) Bd . x -= Bc . x * 2.0 ; if ( ! AE ) Bd . y -= Bc . y * 2.0 ; AG = ( ! AE ) || ( ! AF ) ; if ( ! AF ) Be . x += Bc . x * 2.0 ; if ( ! AF ) Be . y += Bc . y * 2.0 ; if ( AG ) { if ( ! AE ) AI = Ao ( texture2D ( u_color , Bd . xy ) ) ; if ( ! AF ) AT = Ao ( texture2D ( u_color , Be . xy ) ) ; if ( ! AE ) AI = AI - AJ * 0.5 ; if ( ! AF ) AT = AT - AJ * 0.5 ; AE = abs ( AI ) >= AK ; AF = abs ( AT ) >= AK ; if ( ! AE ) Bd . x -= Bc . x * 4.0 ; if ( ! AE ) Bd . y -= Bc . y * 4.0 ; AG = ( ! AE ) || ( ! AF ) ; if ( ! AF ) Be . x += Bc . x * 4.0 ; if ( ! AF ) Be . y += Bc . y * 4.0 ; if ( AG ) { if ( ! AE ) AI = Ao ( texture2D ( u_color , Bd . xy ) ) ; if ( ! AF ) AT = Ao ( texture2D ( u_color , Be . xy ) ) ; if ( ! AE ) AI = AI - AJ * 0.5 ; if ( ! AF ) AT = AT - AJ * 0.5 ; AE = abs ( AI ) >= AK ; AF = abs ( AT ) >= AK ; if ( ! AE ) Bd . x -= Bc . x * 2.0 ; if ( ! AE ) Bd . y -= Bc . y * 2.0 ; if ( ! AF ) Be . x += Bc . x * 2.0 ; if ( ! AF ) Be . y += Bc . y * 2.0 ; } } } } AK = Ba . x - Bd . x ; AJ = Be . x - Ba . x ; if ( ! AC ) AK = Ba . y - Bd . y ; if ( ! AC ) AJ = Be . y - Ba . y ; AF = ( AI < 0.0 ) != AD ; AI = ( AJ + AK ) ; AD = ( AT < 0.0 ) != AD ; AI = 1.0 / AI ; AE = AK < AJ ; AJ = min ( AK , AJ ) ; AD = AE ? AF : AD ; AN = AN * AN ; AI = ( AJ * ( - AI ) ) + 0.5 ; AN = AN * FXAA_QUALITY_SUBPIX ; AI = AD ? AI : 0.0 ; AN = max ( AI , AN ) ; if ( ! AC ) Ba . x += AN * AP ; if ( AC ) Ba . y += AN * AP ; return texture2D ( u_color , Ba ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_PASS",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , bE ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{type:"equal_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"gl_FragColor = AB ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = Bf ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , bE ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 bE ; void main ( ) { vec4 Ad ; vec2 Ai , Aj ; Ai = vec2 ( 0.0 , 0.0 ) ; Aj = u_texel_size ; Ad = texture2D ( u_color , bE ) ; gl_FragColor = Ad * 0.0875447373698 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0858112354248 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0808139781061 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0731235112908 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0635705267419 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0530985673112 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0426125984122 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0328565115809 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * Ad , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 bE ; void main ( ) { vec4 Ad , Ai ; Ad = texture2D ( u_main , bE ) ; Ai = texture2D ( u_bloom , bE ) ; Ad = Ad ; Ad += Ai ; gl_FragColor = vec4 ( Ad . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 bE ; void main ( ) { float Ad ; vec3 Ai , Aj ; vec4 Ak ; Ak = texture2D ( u_color , bE ) ; Ai = Ak . rgb ; if ( u_brightness < 0.0 ) Ai = Ai * ( 1.0 + u_brightness ) ; else Ai = Ai + ( ( 1.0 - Ai ) * u_brightness ) ; Ai = ( Ai - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; Ai *= u_exposure ; Aj = vec3 ( 0.299 , 0.587 , 0.114 ) ; Ad = dot ( Ai , Aj ) ; Ai = mix ( vec3 ( Ad ) , Ai , u_saturation ) ; gl_FragColor = vec4 ( Ai , Ak . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 bE ; void main ( ) { gl_FragColor = g ( clamp ( Ao ( u_depth , bE , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]=
{type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 bE ; void main ( ) { float Ad , Ap ; vec4 Aq , Ar ; Aq = texture2D ( u_sharp , bE ) ; if ( u_dof_dist > 0.0 ) { Ad = Ao ( u_depth , bE , u_camera_range ) ; Ad *= u_view_max_depth ; if ( Ad < u_dof_dist ) Ap = ( u_dof_dist - Ad ) / u_dof_front ; else Ap = ( Ad - u_dof_dist ) / u_dof_rear ; Ap = clamp ( Ap , 0.0 , 1.0 ) ; Ar = texture2D ( u_blurred , bE ) ; gl_FragColor = mix ( Aq , Ar , Ap ) ; } else gl_FragColor = Aq ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_src_color ; uniform sampler2D u_glow_mask_small ; uniform sampler2D u_glow_mask_large ; uniform float u_glow_mask_small_coeff ; uniform float u_glow_mask_large_coeff ; varying vec2 bE ; void main ( ) { float Ad ; vec4 Ap , Aq , Ar ; Ap = texture2D ( u_src_color , bE ) ; Aq = texture2D ( u_glow_mask_small , bE ) ; Ar = texture2D ( u_glow_mask_large , bE ) ; gl_FragColor = Ap ; if ( Ar . a != 0.0 ) { Ad = u_glow_mask_large_coeff * Ar . a ; Ad = clamp ( Ad , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , Ar . rgb / Ar . a , Ad ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , Ad ) ; } if ( Aq . a != 0.0 ) { Ad = u_glow_mask_small_coeff * Aq . a ; Ad = clamp ( Ad , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , Aq . rgb / Aq . a , Ad ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , Ad ) ; } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float Ap ; varying vec2 Aq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 bE ; varying vec4 Ar ; void main ( ) { vec4 As ; float At , Au , Av , Aw , Ax ; vec2 Ay , Az , AA ; Ay = ( Ar . xy - bE ) ; At = length ( Ay ) ; Ay = u_radial_blur_step * Ay / At ; Au = At / u_radial_blur_step ; Ay *= min ( Au , STEPS_PER_PASS ) / STEPS_PER_PASS ; Au = max ( Au , STEPS_PER_PASS ) ; Az = bE ; Av = 0.0 ; for ( float AB = 0.0 ; AB < STEPS_PER_PASS ; AB += 1.0 ) { if ( AB <= Au ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"Aw = Ao ( u_input , Az , u_camera_range ) ; Av += max ( ( 1.0 - pow ( At , 0.3 ) ) * step ( 0.9 , Aw ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"As = texture2D ( u_input , Az ) ; Av += k ( As ) ;".split(" ")}]}}]},{type:"textline",b:"} Az += Ay ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"AA = bE + Aq ; Ax = L ( vec2 ( 2.5 * ( AA . x ) , 2.5 * ( AA . y ) + 1.0 * u_time ) ) . x + 0.75 * L ( vec2 ( 5.0 * ( AA . x ) - 0.66 * u_time , 5.0 * ( AA . y ) + 0.66 * u_time ) ) . x + 0.5 * ag ( vec2 ( 7.5 * ( AA . x ) + 0.33 * u_time , 7.5 * ( AA . y ) - 0.33 * u_time ) ) ; Ax *= clamp ( 1.2 - sqrt ( 0.2 * At ) , 0.0 , 1.0 ) * Ap ; Av = max ( Ax , Av ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = g ( Av / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"include",file:"math.glslv"},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float Ap ; varying vec2 Aq ;".split(" ")}]}}]}]}}]},{type:"textline",
b:"varying vec2 bE ; varying vec4 Ar ; void main ( ) { float Ad , As ; vec3 At ; bE = a_bb_vertex + 0.5 ; At = normalize ( u_sun_direction ) ; Ar = u_proj_matrix * u_view_matrix * vec4 ( At , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { Ap = 1.0 ; At = vec3 ( 0.0 , 1.0 , 0.0 ) ; At = aS ( u_camera_quat , At ) ; At = normalize ( At ) ; Ad = dot ( At , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; As = atan ( At . x , At . z ) ; Aq = vec2 ( - As , acos ( Ad ) ) ; } else { Ap = 0.0 ; }".split(" ")}]}}]},
{type:"textline",b:"Ar . xy = 0.5 * ( Ar . xy / Ar . w + 1.0 ) ; Ar += 99999.0 * step ( Ar . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 bE ; void main ( ) { float Ad ; vec3 As ; vec4 At ; At = texture2D ( u_main , bE ) ; As = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; aE ( At . rgb ) ; Ad = k ( texture2D ( u_god_rays , bE ) ) ; As = At . rgb + u_god_rays_intensity * vec3 ( Ad ) * As ; aG ( As ) ; gl_FragColor . rgb = As ; gl_FragColor . a = At . a ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 bE ; void main ( ) { float Ad ; vec4 As ; As = texture2D ( u_input , bE ) ; Ad = dot ( As . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( Ad ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float Ad , As ; As = 0.0 ; for ( float At = 0.025 ; At < 1.0 ; At += 0.05 ) for ( float Au = 0.025 ; Au < 1.0 ; Au += 0.05 ) { Ad = max ( texture2D ( u_input , vec2 ( At , Au ) ) . r , 0.01 ) ; As += log ( Ad ) ; } As = exp ( As / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( As ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 bE ; varying float As ; void main ( ) { vec4 At ; float Au , Av ; Au = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; Av = texture2D ( u_luminance , bE ) . r ; At = texture2D ( u_main , bE ) ; Au = Av / Au ; Av = u_bloom_edge_lum ; gl_FragColor = At * max ( Au - Av , 0.0 ) * As ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 bE ; varying float As ; const vec3 Ad = vec3 ( 0.0 , 1.0 , 0.0 ) ; void AA ( in vec4 At , in vec3 Au , out vec3 Av ) { float Aw , Ax , Ay , Az ; Aw = At . w * Au . x + At . y * Au . z - At . z * Au . y ; Ax = At . w * Au . y + At . z * Au . x - At . x * Au . z ; Ay = At . w * Au . z + At . x * Au . y - At . y * Au . x ; Az = - At . x * Au . x - At . y * Au . y - At . z * Au . z ; Av . x = Aw * At . w - Az * At . x - Ax * At . z + Ay * At . y ; Av . y = Ax * At . w - Az * At . y - Ay * At . x + Aw * At . z ; Av . z = Ay * At . w - Az * At . z - Aw * At . y + Ax * At . x ; } void main ( ) { vec3 AB ; bE = 2.0 * a_position ; AA ( u_camera_quat , Ad , AB ) ; As = dot ( - AB , u_sun_direction ) * u_bloom_key ; As *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; uniform float u_motion_blur_decay_threshold ; varying vec2 bE ; float Ad = 0.0042 ; void main ( ) { vec4 At , Au , Av , Aw ; At = texture2D ( u_mb_tex_curr , bE ) ; Au = texture2D ( u_mb_tex_accum , bE ) ; if ( length ( At - Au ) > u_motion_blur_decay_threshold ) { Av = ( 1.0 - u_motion_blur_exp ) * At + u_motion_blur_exp * Au ; Av = Av - Au ; Aw = At - Au ; Av = min ( max ( abs ( Av ) , vec4 ( Ad ) ) , abs ( Aw ) ) * sign ( Av ) ; gl_FragColor = Au + Av ; } else { gl_FragColor = At ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 bE ; void main ( ) { vec3 Ad ; float At ; vec4 Au , Av , Aw ; Au = texture2D ( u_outline_src , bE ) ; gl_FragColor = Au ; if ( u_draw_outline != 0.0 ) { Av = texture2D ( u_outline_mask , bE ) ; Aw = texture2D ( u_outline_mask_blurred , bE ) ; At = Aw . a - Av . a ; if ( At != 0.0 ) { At = smoothstep ( 0.0 , 1.0 , Aw . a ) ; if ( Av . a == 0.0 ) { Ad = u_outline_color ; aG ( Ad ) ; Av = vec4 ( clamp ( Ad , 0.0 , 1.0 ) , 1.0 ) ; gl_FragColor = mix ( Au , Av , At ) ; } } } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 bE ; void main ( ) { vec2 Ad , At ; vec4 Au ;".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","POST_EFFECT_NONE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , bE ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","POST_EFFECT_GRAYSCALE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Au = texture2D ( u_color , bE ) ; gl_FragColor . rgb = vec3 ( ( Au . r + Au . g + Au . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_BLUR",
{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_BLUR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ad = vec2 ( 0.0 , 0.0 ) ; At = u_texel_size ; Au = texture2D ( u_color , bE ) ; gl_FragColor = Au * 0.2270270270 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * 0.1945945946 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * 0.1945945946 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * 0.1216216216 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * 0.1216216216 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * 0.0540540541 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * 0.0540540541 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * 0.0162162162 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_GLOW_BLUR",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ad = vec2 ( 0.0 , 0.0 ) ; At = u_texel_size ; Au = texture2D ( u_color , bE ) ; gl_FragColor = Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.152507 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.141763 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.141763 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.113861 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.113861 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.079019 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.079019 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.047383 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.047383 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.024549 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.024549 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.01099 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.01099 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.00425 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.00425 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.00142 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.00142 ; gl_FragColor = clamp ( gl_FragColor , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_EXTEND",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_EXTEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"At = u_texel_size ; Au = texture2D ( u_color , bE ) ; gl_FragColor = Au ; if ( Au . a == 0.0 ) { Au = texture2D ( u_color , bE + At ) ; if ( Au . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Au . a ) ; else { Au = texture2D ( u_color , bE - At ) ; if ( Au . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Au . a ) ; } }".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; varying vec2 bE ; void main ( ) { bE = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",
name:"SMAA_EDGE_DETECTION",b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",d:2},"SMAA_PREDICATION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 bE ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","At",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 Au ; varying vec4 Av ; varying vec4 Aw ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","Ax",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",
b:["1"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",
name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},
{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},
{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 AD ( vec2 Ay , sampler2D Az ) { float AA , AB , AC ; AA = texture2D ( Az , Ay ) . r ; AB = texture2D ( Az , Au . xy ) . r ; AC = texture2D ( Az , Au . zw ) . r ; return vec3 ( AA , AB , AC ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 AI ( vec2 AE , sampler2D AF ) { vec2 AG ; vec3 AH ; AH = AD ( AE , AF ) ; AG = abs ( AH . xx - AH . yz ) ; AG = step ( SMAA_PREDICATION_THRESHOLD , AG ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * AG ) ; }".split(" ")}]}}]},
{type:"textline",b:"void AM ( bvec2 AJ , inout vec2 AK , vec2 AL ) { if ( AJ . x ) AK . x = AL . x ; if ( AJ . y ) AK . y = AL . y ; } void AM ( bvec4 AN , inout vec4 AO , vec4 AP ) { AM ( AN . xy , AO . xy , AP . xy ) ; AM ( AN . zw , AO . zw , AP . zw ) ; } vec2 AR ( vec2 AQ ) { return sign ( AQ ) * floor ( abs ( AQ ) + .5 ) ; } vec4 AR ( vec4 AS ) { return sign ( AS ) * floor ( abs ( AS ) + .5 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 Be ( vec2 AT , sampler2D AU".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","AV"]}]}}]},{type:"textline",b:") { vec4 AW ; float AX , AY , AZ , A_ , Ba ; vec3 Bb ; vec2 Bc , Bd ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"Bc = AI ( AT , AV ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"Bc = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"Bb = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; AX = dot ( texture2D ( AU , AT ) . rgb , Bb ) ; AY = dot ( texture2D ( AU , Au . xy ) . rgb , Bb ) ; AZ = dot ( texture2D ( AU , Au . zw ) . rgb , Bb ) ; AW . xy = abs ( AX - vec2 ( AY , AZ ) ) ; Bc = step ( Bc , AW . xy ) ; if ( dot ( Bc , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; A_ = dot ( texture2D ( AU , Av . xy ) . rgb , Bb ) ; Ba = dot ( texture2D ( AU , Av . zw ) . rgb , Bb ) ; AW . zw = abs ( AX - vec2 ( A_ , Ba ) ) ; Bd = max ( AW . xy , AW . zw ) ; Ba = dot ( texture2D ( AU , Aw . xy ) . rgb , Bb ) ; A_ = dot ( texture2D ( AU , Aw . zw ) . rgb , Bb ) ; AW . zw = abs ( vec2 ( AY , AZ ) - vec2 ( Ba , A_ ) ) ; Bd = max ( Bd . xy , AW . zw ) ; A_ = max ( Bd . x , Bd . y ) ; Bc . xy *= step ( A_ , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * AW . xy ) ; return Bc ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vec2 Bg ( vec2 Bf ) { Bf . r = Bf . r * abs ( 5.0 * Bf . r - 5.0 * 0.75 ) ; return AR ( Bf ) ; } vec4 Bg ( vec4 Bh ) { Bh . rb = Bh . rb * abs ( 5.0 * Bh . rb - 5.0 * 0.75 ) ; return AR ( Bh ) ; } vec2 Bp ( sampler2D Bi , vec2 Bj , vec2 Bk , out vec2 Bl ) { vec3 Bm ; vec4 Bn ; Bn = vec4 ( Bj , - 1.0 , 1.0 ) ; Bm = vec3 ( u_texel_size , 1.0 ) ; for ( int Bo = 0 ; Bo < SMAA_MAX_SEARCH_STEPS_DIAG ; Bo ++ ) { if ( Bn . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Bn . w > 0.9 ) { Bn . xyz += Bm * vec3 ( Bk , 1.0 ) ; Bl = texture2D ( Bi , Bn . xy , 0.0 ) . rg ; Bn . w = dot ( Bl , vec2 ( 0.5 , 0.5 ) ) ; } } return Bn . zw ; } vec2 Bx ( sampler2D Bq , vec2 Br , vec2 Bs , out vec2 Bt ) { vec3 Bu ; vec4 Bv ; Bv = vec4 ( Br , - 1.0 , 1.0 ) ; Bv . x += 0.25 * u_texel_size . x ; Bu = vec3 ( u_texel_size , 1.0 ) ; for ( int Bw = 0 ; Bw < SMAA_MAX_SEARCH_STEPS_DIAG ; Bw ++ ) { if ( Bv . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Bv . w > 0.9 ) { Bv . xyz = Bu * vec3 ( Bs , 1.0 ) + Bv . xyz ; Bt = texture2D ( Bq , Bv . xy , 0.0 ) . rg ; Bt = Bg ( Bt ) ; Bv . w = dot ( Bt , vec2 ( 0.5 , 0.5 ) ) ; } } return Bv . zw ; } vec2 BD ( sampler2D By , vec2 Bz , vec2 BA , float BB ) { vec2 BC ; BC = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * BA + Bz ; BC = SMAA_AREATEX_PIXEL_SIZE * BC + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; BC . x += 0.5 ; BC . y += SMAA_AREATEX_SUBTEX_SIZE * BB ; return texture2D ( By , BC , 0.0 ) . rg ; } vec2 BP ( sampler2D BE , sampler2D BF , vec2 BG , vec2 BH , vec4 BI ) { vec4 BJ , BK , BL ; vec2 BM , BN , BO ; BM = vec2 ( 0.0 , 0.0 ) ; if ( BH . r > 0.0 ) { BJ . xz = Bp ( BE , BG , vec2 ( - 1.0 , 1.0 ) , BN ) ; BJ . x += float ( BN . y > 0.9 ) ; } else BJ . xz = vec2 ( 0.0 , 0.0 ) ; BJ . yw = Bp ( BE , BG , vec2 ( 1.0 , - 1.0 ) , BN ) ; if ( BJ . x + BJ . y > 2.0 ) { BK = vec4 ( - BJ . x + 0.25 , BJ . x , BJ . y , - BJ . y - 0.25 ) * u_texel_size . xyxy + BG . xyxy ; BL . xy = texture2D ( BE , BK . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; BL . zw = texture2D ( BE , BK . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; BL . yxwz = Bg ( BL . xyzw ) ; BO = vec2 ( 2.0 , 2.0 ) * BL . xz + BL . yw ; AM ( bvec2 ( step ( 0.9 , BJ . zw ) ) , BO , vec2 ( 0.0 , 0.0 ) ) ; BM += BD ( BF , BJ . xy , BO , BI . z ) ; } BJ . xz = Bx ( BE , BG , vec2 ( - 1 , - 1 ) , BN ) ; if ( texture2D ( BE , BG + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { BJ . yw = Bx ( BE , BG , vec2 ( 1 , 1 ) , BN ) ; BJ . y += float ( BN . y > 0.9 ) ; } else BJ . yw = vec2 ( 0.0 , 0.0 ) ; if ( BJ . x + BJ . y > 2.0 ) { BL = vec4 ( - BJ . x , - BJ . x , BJ . y , BJ . y ) * u_texel_size . xyxy + BG . xyxy ; BK . x = texture2D ( BE , BL . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; BK . y = texture2D ( BE , BL . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; BK . zw = texture2D ( BE , BL . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; BN = vec2 ( 2.0 , 2.0 ) * BK . xz + BK . yw ; AM ( bvec2 ( step ( 0.9 , BJ . zw ) ) , BN , vec2 ( 0 , 0 ) ) ; BM += BD ( BF , BJ . xy , BN , BI . w ) . gr ; } return BM ; }".split(" ")}]}}]},
{type:"textline",b:"float BV ( sampler2D BQ , vec2 BR , float BS ) { vec2 BT , BU ; BT = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; BU = SMAA_SEARCHTEX_SIZE * vec2 ( BS , 1.0 ) ; BT += vec2 ( - 1.0 , 1.0 ) ; BU += vec2 ( 0.5 , - 0.5 ) ; BT *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; BU *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( BQ , BT * BR + BU , 0.0 ) . r ; } float Cc ( sampler2D BW , sampler2D BX , vec2 BY , float BZ ) { float B_ ; vec2 Ca ; Ca = vec2 ( 0.0 , 1.0 ) ; for ( int Cb = 0 ; Cb < SMAA_MAX_SEARCH_STEPS ; Cb ++ ) { if ( BY . x > BZ && Ca . g > 0.8281 && Ca . r == 0.0 ) { Ca = texture2D ( BW , BY , 0.0 ) . rg ; BY = - vec2 ( 2.0 , 0.0 ) * u_texel_size + BY ; } } B_ = - ( 255.0 / 127.0 ) * BV ( BX , Ca , 0.0 ) + 3.25 ; return u_texel_size . x * B_ + BY . x ; } float Ck ( sampler2D Cd , sampler2D Ce , vec2 Cf , float Cg ) { float Ch ; vec2 Ci ; Ci = vec2 ( 0.0 , 1.0 ) ; for ( int Cj = 0 ; Cj < SMAA_MAX_SEARCH_STEPS ; Cj ++ ) { if ( Cf . x < Cg && Ci . g > 0.8281 && Ci . r == 0.0 ) { Ci = texture2D ( Cd , Cf , 0.0 ) . rg ; Cf = vec2 ( 2.0 , 0.0 ) * u_texel_size + Cf ; } } Ch = - ( 255.0 / 127.0 ) * BV ( Ce , Ci , 0.5 ) + 3.25 ; return - u_texel_size . x * Ch + Cf . x ; } float Cs ( sampler2D Cl , sampler2D Cm , vec2 Cn , float Co ) { float Cp ; vec2 Cq ; Cq = vec2 ( 1.0 , 0.0 ) ; for ( int Cr = 0 ; Cr < SMAA_MAX_SEARCH_STEPS ; Cr ++ ) { if ( Cn . y > Co && Cq . r > 0.8281 && Cq . g == 0.0 ) { Cq = texture2D ( Cl , Cn , 0.0 ) . rg ; Cn = - vec2 ( 0.0 , 2.0 ) * u_texel_size + Cn ; } } Cp = - ( 255.0 / 127.0 ) * BV ( Cm , Cq . gr , 0.0 ) + 3.25 ; return u_texel_size . y * Cp + Cn . y ; } float CA ( sampler2D Ct , sampler2D Cu , vec2 Cv , float Cw ) { float Cx ; vec2 Cy ; Cy = vec2 ( 1.0 , 0.0 ) ; for ( int Cz = 0 ; Cz < SMAA_MAX_SEARCH_STEPS ; Cz ++ ) { if ( Cv . y < Cw && Cy . r > 0.8281 && Cy . g == 0.0 ) { Cy = texture2D ( Ct , Cv , 0.0 ) . rg ; Cv = vec2 ( 0.0 , 2.0 ) * u_texel_size + Cv ; } } Cx = - ( 255.0 / 127.0 ) * BV ( Cu , Cy . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * Cx + Cv . y ; } vec2 CH ( sampler2D CB , vec2 CC , float CD , float CE , float CF ) { vec2 CG ; CG = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * AR ( 4.0 * vec2 ( CD , CE ) ) + CC ; CG = SMAA_AREATEX_PIXEL_SIZE * CG + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; CG . y = SMAA_AREATEX_SUBTEX_SIZE * CF + CG . y ; return texture2D ( CB , CG , 0.0 ) . rg ; } void CO ( sampler2D CI , inout vec2 CJ , vec4 CK , vec2 CL ) { vec2 CM , CN ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"CM = step ( CL . xy , CL . yx ) ; CN = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * CM ; CN /= CM . x + CM . y ; CM = vec2 ( 1.0 , 1.0 ) ; CM . x -= CN . x * texture2D ( CI , CK . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; CM . x -= CN . y * texture2D ( CI , CK . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; CM . y -= CN . x * texture2D ( CI , CK . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; CM . y -= CN . y * texture2D ( CI , CK . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; CJ *= clamp ( CM , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void CV ( sampler2D CP , inout vec2 CQ , vec4 CR , vec2 CS ) { vec2 CT , CU ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"CT = step ( CS . xy , CS . yx ) ; CU = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * CT ; CU /= CT . x + CT . y ; CT = vec2 ( 1.0 , 1.0 ) ; CT . x -= CU . x * texture2D ( CP , CR . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; CT . x -= CU . y * texture2D ( CP , CR . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; CT . y -= CU . x * texture2D ( CP , CR . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; CT . y -= CU . y * texture2D ( CP , CR . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; CQ *= clamp ( CT , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 Di ( vec2 CW , vec2 CX , sampler2D CY , sampler2D CZ , sampler2D C_ , vec4 Da ) { float Db , Dc ; vec3 Dd ; vec2 De , Df , Dg ; vec4 Dh ; Dh = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; De = texture2D ( CY , CW ) . rg ; if ( De . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:"Dh . rg = BP ( CY , CZ , CW , De , Da ) ; if ( Dh . r == - Dh . g ) {".split(" ")}]}}]},{type:"textline",b:"; Dd . x = Cc ( CY , C_ , Au . xy , Aw . x ) ; Dd . y = Av . y ; Df . x = Dd . x ; Db = texture2D ( CY , Dd . xy , 0.0 ) . r ; Dd . z = Ck ( CY , C_ , Au . zw , Aw . y ) ; Df . y = Dd . z ; Df = abs ( AR ( Df / u_texel_size . xx - CX . xx ) ) ; Dg = sqrt ( Df ) ; Dc = texture2D ( CY , Dd . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; Dh . rg = CH ( CZ , Dg , Db , Dc , Da . y ) ; Dd . y = CW . y ; CO ( CY , Dh . rg , Dd . xyzy , Df ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"} else De . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( De . r > 0.0 ) { ; Dd . y = Cs ( CY , C_ , Av . xy , Aw . z ) ; Dd . x = Au . x ; De . x = Dd . y ; Dc = texture2D ( CY , Dd . xy , 0.0 ) . g ; Dd . z = CA ( CY , C_ , Av . zw , Aw . w ) ; De . y = Dd . z ; De = abs ( AR ( De / u_texel_size . yy - CX . yy ) ) ; Df = sqrt ( De ) ; Db = texture2D ( CY , Dd . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; Dh . ba = CH ( CZ , Df , Dc , Db , Da . x ) ; Dd . x = CW . x ; CV ( CY , Dh . ba , Dd . xyxz , De ) ; } return Dh ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 Du ( vec2 Dj , sampler2D Dk , sampler2D Dl".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","Dm"]}]}}]},{type:"textline",b:") { bool Dn ; vec2 Do , Dp , Dq ; vec4 Dr , Ds , Dt ; Dr . x = texture2D ( Dl , At . xy ) . a ; Dr . y = texture2D ( Dl , At . zw ) . g ; Dr . wz = texture2D ( Dl , Dj ) . xz ; if ( dot ( Dr , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { Ds = texture2D ( Dk , Dj , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"Dt = texture2D ( Dm , bE ) ; Do = 2.0 * s ( Dt ) - 1.0 ; Ds . a = sqrt ( 2.0 * length ( Do ) ) ;".split(" ")}]}}]},{type:"textline",b:"return Ds ; } else { Dn = max ( Dr . x , Dr . z ) > max ( Dr . y , Dr . w ) ; Ds = vec4 ( 0.0 , Dr . y , 0.0 , Dr . w ) ; Do = Dr . yw ; AM ( bvec4 ( Dn , Dn , Dn , Dn ) , Ds , vec4 ( Dr . x , 0.0 , Dr . z , 0.0 ) ) ; AM ( bvec2 ( Dn , Dn ) , Do , Dr . xz ) ; Do /= dot ( Do , vec2 ( 1.0 , 1.0 ) ) ; Ds = Ds * vec4 ( u_texel_size , - u_texel_size ) + Dj . xyxy ; Dr = Do . x * texture2D ( Dk , Ds . xy , 0.0 ) ; Dr += Do . y * texture2D ( Dk , Ds . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"Dt = texture2D ( Dm , Ds . xy ) ; Dp = 2.0 * s ( Dt ) - 1.0 ; Dq = Do . x * Dp ; Dt = texture2D ( Dm , Ds . zw ) ; Dp = 2.0 * s ( Dt ) - 1.0 ; Dq += Do . y * Dp ; Dr . a = sqrt ( 2.0 * length ( Dq ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","Dr",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 DE ( vec2 Dv , sampler2D Dw , sampler2D Dx".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","Dy"]}]}}]},{type:"textline",b:") { float Dz ; vec2 DA ; vec4 DB , DC , DD ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"DB = texture2D ( Dy , bE ) ; DA = 2.0 * s ( DB ) - 1.0 ; DB = texture2D ( Dw , Dv ) ; DC = texture2D ( Dx , Dv - DA ) ; Dz = abs ( DB . a * DB . a - DC . a * DC . a ) / 2.0 ; Dz = 0.5 * clamp ( 1.0 - sqrt ( Dz ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; DD = mix ( DB , DC , Dz ) ; DD . a = 1.0 ; return DD ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"DB = texture2D ( Dw , Dv ) ; DC = texture2D ( Dx , Dv ) ; return mix ( DB , DC , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:"void main ( ) { vec4 DF ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"DF = vec4 ( Be ( bE , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",
a:[{type:"textline",b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"DF = Di ( bE , Ax , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"DF = Du ( bE , u_color , u_blend".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"DF = vec4 ( DE ( bE , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"DF = texture2D ( u_color , bE ) ;".split(" ")}]}}]},{type:"textline",b:["gl_FragColor","=","DF",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",
b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 bE ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","At",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 Au ; varying vec4 Av ; varying vec4 Aw ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","Ax",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD",
"AA_METHOD_SMAA_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void Ay ( vec2 Ad ) { Au = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + Ad . xyxy ; Av = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + Ad . xyxy ; Aw = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + Ad . xyxy ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void AB ( vec2 Az , out vec2 AA ) { AA = Az / u_texel_size ; Au = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + Az . xyxy ; Av = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + Az . xyxy ; Aw = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( Au . xz , Av . yw ) ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void AD ( vec2 AC ) { At = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + AC . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { bE = 2.0 * a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["Ay","(","bE",")",";"]}]}},{type:"elif",c:["SMAA_PASS",
"SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AB ( bE , Ax ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["AD","(","bE",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",
b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},{type:"define",name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 bE ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float Ay ( in vec2 Ad ) { return Ao ( u_depth , Ad , u_camera_range ) ; } void main ( ) { vec3 Az , AA , AB ; float AC , AD , AE , AF , AG , AH , AI ; AC = texture2D ( u_color , bE ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( AC , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"Az = normalize ( 2.0 * texture2D ( u_ssao_special_tex , bE * 0.25 / u_texel_size ) . rgb - 1.0 ) ; AD = Ay ( bE ) ; AE = AD * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","SSAO_QUALITY_8",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"const float AJ = 8.0 ; const int AK = 1 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_16",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float AJ = 16.0 ; const int AK = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_24",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float AJ = 24.0 ; const int AK = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_32",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"const float AJ = 32.0 ; const int AK = 4 ;".split(" ")}]}}]},{type:"textline",b:"AF = u_ssao_radius_increase * 0.001 ; const float AL = 1.0 + 2.4 / AJ ; AG = 0.0 ; for ( int AM = 0 ; AM < AK ; AM ++ ) for ( int AN = - 1 ; AN <= 1 ; AN += 2 ) for ( int AO = - 1 ; AO <= 1 ; AO += 2 ) for ( int AP = - 1 ; AP <= 1 ; AP += 2 ) { AA = reflect ( normalize ( vec3 ( AN , AO , AP ) ) , Az ) * ( AF *= AL ) ; AB = vec3 ( bE , AE ) ; AB += vec3 ( AA . xy , AA . z * AE * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"AB . z -= 1.4 * ( AB . z - AE ) * step ( AE , AB . z ) ;".split(" ")}]}}]},{type:"textline",b:"AH = Ay ( AB . xy ) * ( u_camera_range . y - u_camera_range . x ) ; AI = clamp ( ( AE - AH ) / AH , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"AG += mix ( 1.0 , AI , step ( AH , AB . z ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"AG += mix ( step ( AB . z , AH ) , 0.5 , AI ) ;".split(" ")}]}}]},{type:"textline",b:"} AG = AG / AJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"AG = clamp ( AG * AG + 0.6 * AG , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AG = clamp ( AG * AG + AG , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"AD = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * AD ) ; AG = mix ( 1.0 , AG , AD ) ; gl_FragColor = vec4 ( AC , AG , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 bE ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float Ay ( in vec2 Ad ) { return Ao ( u_depth , Ad , u_camera_range ) ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec2 Az , AA ; float AB , AC , AD , AE , AF , AG , AH ; AB = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"AC = Ay ( bE ) ; AD = 0.0 ; AE = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},
{type:"textline",b:"Az = vec2 ( - 2.0 ) ; for ( int AI = 0 ; AI < 4 ; ++ AI ) { for ( int AJ = 0 ; AJ < 4 ; ++ AJ ) { AA = ( Az + vec2 ( float ( AI ) , float ( AJ ) ) ) * u_texel_size ; AF = texture2D ( u_ssao_mask , bE + AA ) . g ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"AG = Ay ( bE + AA ) ; AH = 1.0 - clamp ( abs ( AG - AC ) * AE , 0.0 , 1.0 ) ; AB += AF * AH ; AD += AH ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["AB","+=","AF",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bE ) . r , AB / AD , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bE ) . r , AB / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",
file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 bE ; void main ( ) { vec2 Ad ; vec4 Ay , Az ; float AA ; AA = texture2D ( u_depth , bE ) . x ; Ay = vec4 ( bE * 2.0 - 1.0 , 2.0 * AA - 1.0 , 1.0 ) ; Az = u_view_proj_inverse * Ay ; Az = Az / Az . w ; Az = u_view_proj_prev * Az ; Az /= Az . w ; Ad = ( Ay . xy - Az . xy ) / 4.0 + 0.5 ; Ad = clamp ( Ad , 0.0 , 1.0 ) ; gl_FragColor = g ( Ad ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",
b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"NO_SHADOWS",b:["1"]},{type:"define",name:"SHADOW_CASTING",b:["2"]},{type:"define",name:"SHADOW_MASK_GENERATION",b:["3"]},{type:"define",name:"SHADOW_MAPPING_OPAQUE",b:["4"]},{type:"define",name:"SHADOW_MAPPING_BLEND",b:["5"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",
name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"SPECULAR_BLINN",b:["4"]},{type:"define",name:"SPECULAR_TOON",b:["5"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"DIFFUSE_MINNAERT",b:["4"]},{type:"define",name:"DIFFUSE_TOON",b:["5"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",
b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]},{type:"define",name:"MIX",b:["0"]},{type:"define",name:"ADD",b:["1"]},{type:"define",name:"SUBTRACT",b:["2"]},{type:"define",name:"MULTIPLY",b:["3"]},{type:"define",name:"SCREEN",b:["4"]},{type:"define",name:"OVERLAY",b:["5"]},{type:"define",name:"DIFFERENCE",b:["6"]},{type:"define",name:"DIVIDE",b:["7"]},{type:"define",name:"DARKEN",b:["8"]},{type:"define",name:"LIGHTEN",b:["9"]},
{type:"define",name:"HUE",b:["10"]},{type:"define",name:"SATURATION",b:["11"]},{type:"define",name:"VALUE",b:["12"]},{type:"define",name:"COLOR",b:["13"]},{type:"define",name:"SOFT_LIGHT",b:["14"]},{type:"define",name:"LINEAR_LIGHT",b:["15"]},{type:"define",name:"REFL_NONE",b:["0"]},{type:"define",name:"REFL_MIRRORMAP",b:["1"]},{type:"define",name:"REFL_PLANE",b:["2"]},{type:"define",name:"REFL_CUBE",b:["3"]},{type:"define",name:"INVERSE_QUADRATIC",b:["0"]},{type:"define",name:"LINEAR",b:["1"]},{type:"define",
name:"QUADRATIC",b:["2"]},{type:"define",name:"HEMI",b:["1"]},{type:"define",name:"SPOT",b:["2"]},{type:"define",name:"POINT",b:["3"]},{type:"define",name:"SUN",b:["4"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float a = 255.0 ; float b = 0.0 ; float c = 1.0 ; vec4 g ( const in float d ) { vec4 e , f ; e = vec4 ( a * a * a , a * a , a , c ) ; f = vec4 ( b , c / a , c / a , c / a ) ; e = fract ( d * e ) ; e -= e . xxyz * f ; return e ; } float k ( const in vec4 h ) { vec4 i ; float j ; i = vec4 ( c / ( a * a * a ) , c / ( a * a ) , c / a , c ) ; j = dot ( h , i ) ; return j ; } vec4 g ( const in vec2 l ) { vec4 m ; vec2 n , o ; n = vec2 ( a , c ) ; o = vec2 ( b , c / a ) ; m = fract ( l . xxyy * n . xyxy ) ; m -= m . xxzz * o . xyxy ; if ( l . r == c ) m . rg = vec2 ( b , c ) ; if ( l . g == c ) m . ba = vec2 ( b , c ) ; return m ; } vec2 s ( const in vec4 p ) { vec2 q , r ; r = vec2 ( c / a , c ) ; q . r = dot ( p . rg , r ) ; q . g = dot ( p . ba , r ) ; return q ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float t = 0.0 ; float u = 1.0 ; vec4 w ( vec4 v ) { return v - floor ( v * ( u / 289.0 ) ) * 289.0 ; } vec3 w ( vec3 x ) { return x - floor ( x * ( u / 289.0 ) ) * 289.0 ; } vec2 w ( vec2 y ) { return y - floor ( y * ( u / 289.0 ) ) * 289.0 ; } vec4 A ( vec4 z ) { return z - floor ( z * ( u / 7.0 ) ) * 7.0 ; } vec4 C ( vec4 B ) { return w ( ( 34.0 * B + 5.0 ) * B ) ; }".split(" ")},{type:"define",name:"K",b:["0.142857142857"]},{type:"define",
name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 L ( vec2 D ) { vec4 E , F , G , H ; vec2 I , J ; I = w ( floor ( D ) ) ; J = fract ( D ) ; E = J . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; F = J . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; G = C ( I . x + vec4 ( t , u , t , u ) ) ; G = C ( G + I . y + vec4 ( t , t , u , u ) ) ; H = A ( G ) * K + K2 ; G = A ( floor ( G * K ) ) * K + K2 ; H = E + JITTER * H ; G = F + JITTER * G ; G = H * H + G * G ;".split(" ")},
{type:"condition",a:[{type:"if",c:[1],group:{type:"group",a:[{type:"textline",b:"G . xy = min ( G . xy , G . zw ) ; G . x = min ( G . x , G . y ) ; return G . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"G . xy = ( G . x < G . y ) ? G . xy : G . yx ; G . xz = ( G . x < G . z ) ? G . xz : G . zx ; G . xw = ( G . x < G . w ) ? G . xw : G . wx ; G . y = min ( G . y , G . z ) ; G . y = min ( G . y , G . w ) ; return sqrt ( G . xy ) ;".split(" ")}]}}]},{type:"textline",
b:"} vec3 U ( vec2 M , float N ) { vec4 O , P , Q , R ; vec2 S , T ; S = w ( floor ( M ) ) ; T = fract ( M ) ; O = T . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; P = T . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; Q = C ( S . x + vec4 ( t , u , t , u ) ) ; Q = C ( Q + S . y + vec4 ( t , t , u , u ) ) ; R = A ( Q ) * K + K2 ; Q = A ( floor ( Q * K ) ) * K + K2 ; R = O + JITTER * R ; Q = P + JITTER * Q ; P = R * R + Q * Q ; R += N ; Q += N ; O = R * R + Q * Q ; R += N ; Q += N ; Q = R * R + Q * Q ; P . xy = min ( P . xy , P . zw ) ; P . x = min ( P . x , P . y ) ; O . xy = min ( O . xy , O . zw ) ; O . x = min ( O . x , O . y ) ; Q . xy = min ( Q . xy , Q . zw ) ; Q . x = min ( Q . x , Q . y ) ; return vec3 ( P . x , O . x , Q . x ) ; } vec3 W ( vec3 V ) { return w ( ( ( V * 34.0 ) + u ) * V ) ; } float ag ( vec2 X ) { vec3 Y , Z , _ , aa ; vec4 ab ; vec2 ac , ad , ae ; const vec4 af = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; ac = floor ( X + dot ( X , af . yy ) ) ; ad = X - ac + dot ( ac , af . xx ) ; ae = ( ad . x > ad . y ) ? vec2 ( u , t ) : vec2 ( t , u ) ; ab = ad . xyxy + af . xxzz ; ab . xy -= ae ; ac = w ( ac ) ; Y = W ( W ( ac . y + vec3 ( t , ae . y , u ) ) + ac . x + vec3 ( t , ae . x , u ) ) ; Z = max ( 0.5 - vec3 ( dot ( ad , ad ) , dot ( ab . xy , ab . xy ) , dot ( ab . zw , ab . zw ) ) , t ) ; Z = Z * Z ; Z = Z * Z ; Y = 2.0 * fract ( Y * af . www ) - u ; _ = abs ( Y ) - 0.5 ; aa = floor ( Y + 0.5 ) ; aa = Y - aa ; Z *= 1.79284291400159 - 0.85373472095314 * ( aa * aa + _ * _ ) ; Y . x = aa . x * ad . x + _ . x * ad . y ; Y . yz = aa . yz * ab . xz + _ . yz * ab . yw ; return 130.0 * dot ( Z , Y ) ; } vec2 ak ( vec2 ah ) { float ai , aj ; ai = dot ( ah , vec2 ( 12.9898 , 78.233 ) ) ; aj = dot ( ah , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; ai = fract ( sin ( ai ) * 43758.5453 ) * 2.0 - u ; aj = fract ( sin ( aj ) * 43758.5453 ) * 2.0 - u ; return vec2 ( ai , aj ) ; }".split(" ")}]};
a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void aC ( inout vec3 al , float am , float an , float ao , vec3 ap , vec3 aq , vec3 ar , vec4 as , vec3 at , float au ) { float av , aw , ax ; vec2 ay , az ; vec3 aA ; vec4 aB ; if ( au > CAUSTICS_VIEW_DISTANCE ) return ; aB = as ; aA = at + ap ; aA . xz = 10.0 * sin ( 0.1 * aA . xz ) ; aA = aA + 2.0 * cross ( - aB . xyz , cross ( - aB . xyz , aA ) + aB . w * aA ) ; ay = aA . xz ; aA = aq ; av = max ( dot ( ap , aA ) , 0.0 ) ; aw = 0.025 ; az = CAUST_SPEED * an ; ay . s += 0.25 * sin ( dot ( at + an , vec3 ( 1.0 ) ) ) ; ay . t += 0.35 * ( - sin ( dot ( at - an , vec3 ( - 0.7 ) ) ) ) ; ay . st += 0.15 * cos ( 4.0 * am - az . x ) + 1.5 * sin ( am - 0.3 * az . y ) ; ax = CAUST_SCALE * ( 1.0 + max ( 0.1 * am , 0.0 ) ) ; aA = U ( ( ay / ax ) , aw ) ; aA *= CAUST_BRIGHT ; aA *= aA ; aw = min ( 0.25 * am , - am ) + 1.0 ; aw = max ( aw , 0.0 ) ; av = ao * av ; ax = max ( sign ( am ) , 0.0 ) ; av = av + max ( 0.5 * sign ( - ap . y ) * ax , 0.0 ) ; av = min ( av , 1.0 ) ; al += ar * aA * aw * av ; }".split(" ")}]};
a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void aE ( inout vec3 aD ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"aD = max ( vec3 ( 0.0 ) , aD ) ; aD = pow ( aD , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void aG ( inout vec3 aF ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"aF = max ( vec3 ( 0.0 ) , aF ) ; aF = pow ( aF , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void aJ ( inout vec3 aH , in float aI ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"aH = aH * aI ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float aK = 0.0 ; float aL = 1.0 ; struct aM { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool aP ( vec3 aN , vec3 aO ) { return any ( lessThan ( abs ( aN - aO ) , vec3 ( EPSILON ) ) ) ; } vec3 aS ( in vec4 aQ , in vec3 aR ) { return aR + 2.0 * cross ( aQ . xyz , cross ( aQ . xyz , aR ) + aQ . w * aR ) ; } vec4 aU ( in vec4 aT ) { return vec4 ( - aT . xyz , aT . w ) / dot ( aT , aT ) ; } vec3 aZ ( vec4 aV , vec4 aW , vec4 aX ) { vec3 aY ; aY = aX . xyz * aV . w ; aY = aS ( aW , aY ) ; aY += aV . xyz * aX . w ; return aY ; } vec3 be ( vec4 a_ , vec4 ba , vec4 bb ) { vec4 bc ; vec3 bd ; bd = bb . xyz - a_ . xyz * bb . w ; bc = aU ( ba ) ; bd = aS ( bc , bd ) ; bd /= a_ . w ; return bd ; } mat4 bf ( ) { return mat4 ( aL , aK , aK , aK , aK , aL , aK , aK , aK , aK , aL , aK , aK , aK , aK , aL ) ; } mat4 bh ( float bg ) { return mat4 ( aL , aK , aK , aK , aK , cos ( bg ) , sin ( bg ) , aK , aK , - sin ( bg ) , cos ( bg ) , aK , aK , aK , aK , aL ) ; } mat4 bj ( float bi ) { return mat4 ( cos ( bi ) , aK , - sin ( bi ) , aK , aK , aL , aK , aK , sin ( bi ) , aK , cos ( bi ) , aK , aK , aK , aK , aL ) ; } mat4 bl ( float bk ) { return mat4 ( cos ( bk ) , sin ( bk ) , aK , aK , - sin ( bk ) , cos ( bk ) , aK , aK , aK , aK , aL , aK , aK , aK , aK , aL ) ; } aM bn ( in aM bm ) { return aM ( bm . a , bm . b , normalize ( bm . c ) , normalize ( bm . d ) , normalize ( bm . e ) , bm . f ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"vec3 bt ( vec4 bo ) { vec3 bp ; float bq , br , bs ; bq = bo . x ; br = bo . y ; bs = bo . w ; bp . x = ( bq + bs ) / 2.0 ; bp . y = ( br + bs ) / 2.0 ; bp . z = bs ; return bp ; }".split(" ")}]}}]}]};a["include/shadow.glslf"]={type:"group",
a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["vec4","bF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",
d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float bG = 0.1 ; const float bH = 0.1 ; const float bI = - 0.01 ; const float bJ = 0.05 ; vec4 bK = vec4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 ) ; vec4 bL = vec4 ( 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 ) ; vec4 bM = vec4 ( - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 ) ; vec4 bN = vec4 ( - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; vec4 bO = vec4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 ) ; vec4 bP = vec4 ( - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 ) ; vec4 bQ = vec4 ( - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 ) ; vec4 bR = vec4 ( - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ; bool bU ( vec2 bS , float bT ) { return all ( lessThanEqual ( bS , vec2 ( 1.0 + bT ) ) ) && all ( greaterThanEqual ( bS , vec2 ( 0.0 - bT ) ) ) ; } float cc ( float bV , float bW , mat2 bX , vec3 bY , float bZ , PRECISION sampler2D b_ ) { vec2 ca , cb ; cb . x = bV ; cb . y = bW ; cb = bX * cb ; ca = bY . xy + cb * bZ / SHADOW_TEX_RES ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"if ( ! bU ( ca , bI ) ) return 1.0 ; else".split(" ")}]}}]},{type:"textline",b:"return step ( bY . z , texture2D ( b_ , ca ) . r ) ; } void cq ( inout float cd , inout float ce , float cf , float cg , mat2 ch , vec3 ci , vec3 cj , float ck , float cl , PRECISION sampler2D cm , PRECISION sampler2D cn ) { vec2 co , cp ; cp . x = cf ; cp . y = cg ; cp = ch * cp ; co = ci . xy + cp * ck / SHADOW_TEX_RES ; cd += step ( ci . z , texture2D ( cm , co ) . r ) ; co = cj . xy + cp * cl / SHADOW_TEX_RES ; ce += step ( cj . z , texture2D ( cn , co ) . r ) ; } float cz ( vec3 cr , PRECISION sampler2D cs , float ct ) { mat2 cu ; float cv , cw , cx ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:"if ( cr . z > u_perspective_cast_far_bound ) return 1.0 ; else {".split(" ")}]}}]},{type:"textline",b:"cr . z = clamp ( cr . z , 0.0 , 1.0 ) ; cv = 0.0 ; cw = ak ( cr . xy ) . x * M_PI ; cx = cos ( cw ) ; cw = sin ( cw ) ; cu = mat2 ( cx , cw , - cw , cx ) ; for ( int cy = 0 ; cy < 4 ; cy ++ ) { cv += cc ( bK [ cy ] , bO [ cy ] , cu , cr , ct , cs ) ; cv += cc ( bL [ cy ] , bP [ cy ] , cu , cr , ct , cs ) ; cv += cc ( bM [ cy ] , bQ [ cy ] , cu , cr , ct , cs ) ; cv += cc ( bN [ cy ] , bR [ cy ] , cu , cr , ct , cs ) ; } cv /= 16.0 ; return clamp ( cv , 0.0 , 1.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["}"]}]}}]},{type:"textline",b:"return 1.0 ; } float cN ( vec3 cA , PRECISION sampler2D cB , vec3 cC , PRECISION sampler2D cD , float cE , float cF , float cG ) { mat2 cH ; float cI , cJ , cK , cL ; cA . z = clamp ( cA . z , 0.0 , 1.0 ) ; cC . z = clamp ( cC . z , 0.0 , 1.0 ) ; cI = 0.0 ; cJ = 0.0 ; cK = ak ( cA . xy ) . x * M_PI ; cL = cos ( cK ) ; cK = sin ( cK ) ; cH = mat2 ( cL , cK , - cK , cL ) ; for ( int cM = 0 ; cM < 4 ; cM ++ ) { cq ( cI , cJ , bK [ cM ] , bO [ cM ] , cH , cA , cC , cE , cF , cB , cD ) ; cq ( cI , cJ , bL [ cM ] , bP [ cM ] , cH , cA , cC , cE , cF , cB , cD ) ; cq ( cI , cJ , bM [ cM ] , bQ [ cM ] , cH , cA , cC , cE , cF , cB , cD ) ; cq ( cI , cJ , bN [ cM ] , bR [ cM ] , cH , cA , cC , cE , cF , cB , cD ) ; } cI = mix ( cI , cJ , cG ) ; cI /= 16.0 ; return clamp ( cI , 0.0 , 1.0 ) ; } float cR ( vec2 cO ) { float cP , cQ ; cP = min ( cO . x , cO . y ) ; cQ = min ( 1.0 - cO . x , 1.0 - cO . y ) ; return min ( cP , cQ ) ; } float cU ( float cS , float cT ) { if ( cT >= 0.0 && cT <= bH ) cS = ( cS - 1.0 ) / bH * cT + 1.0 ; return cS ; } float de ( vec3 cV , vec3 cW , PRECISION sampler2D cX , PRECISION sampler2D cY , float cZ , float c_ , float da , float db ) { float dc , dd ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"dd = cR ( cV . xy ) ; if ( - db > da && dd >= 0.0 && dd <= bG && bU ( cW . xy , 0.0 ) ) { dd = 1.0 - dd / bG ; dc = cN ( cV , cX , cW , cY , cZ , c_ , dd ) ; } else".split(" ")}]}}]},{type:"textline",b:"dc = cz ( cV , cX , cZ ) ; return dc ; } float dm ( vec3 df , PRECISION sampler2D dg , float dh , float di , float dj ) { float dk , dl ; dk = cz ( df , dg , dh ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - dj > di ) { dl = cR ( df . xy ) ; dk = cU ( dk , dl ) ; }".split(" ")}]}}]},{type:"textline",b:"return dk ; } float du ( float dn ) { vec3 dp , dq , dr , ds ; float dt ; dt = 1.0 ; dp = bA . xyz / bA . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"dq = bB . xyz / bB . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:"dr = bC . xyz / bC . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"ds = bD . xyz / bD . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( bU ( dp . xy , 0.0 ) ) { dt = de ( dp , dq , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , dn ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( bU ( dp . xy , bJ ) ) { dt = dm ( dp , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , dn ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( bU ( dq . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"dt = de ( dq , dr , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , dn ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"dt = dm ( dq , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , dn ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( bU ( dr . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"dt = de ( dr , ds , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , dn ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"dt = dm ( dr , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , dn ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( bU ( ds . xy , 0.0 ) ) dt = dm ( ds , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , dn ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","dt",";","}"]}]}}]},{type:"textline",b:"float dz ( inout vec3 dv ) { float dw ; vec3 dx ; vec2 dy ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dy = texture2DProj ( u_shadow_mask , by ) . rg ; dx = vec3 ( dy . r ) ; dw = dy . g ; bF = vec4 ( dx , dw ) ; dv *= bF . a ; return bF . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},
"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return du ( bv . z ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_MIRRORMAP",
{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float dG ( in vec3 dA , vec3 dB , float dC , float dD ) { float dE ; vec3 dF ; dF = normalize ( dB + dA ) ; dE = 1.0 - dot ( dA , dF ) ; dE = dD + ( 1.0 - dD ) * pow ( dE , dC ) ; return dE ; } void dT ( inout vec3 dH , vec3 dI , vec3 dJ , float dK ) { vec2 dL , dM ; float dN , dO , dP ; vec3 dQ , dR , dS ; dQ = reflect ( - dI , dJ ) ; dN = u_fresnel_params [ 2 ] ; dO = u_fresnel_params [ 3 ] ; dP = 1.0 ; if ( dN != 0.0 ) dP = dG ( dI , dQ , dN , dO ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dR = textureCube ( u_cube_reflection , dQ ) . xyz ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dS = u_refl_plane . xyz * dot ( dJ , u_refl_plane . xyz ) ; dS = dJ - dS ; dL = ( u_view_matrix_frag * vec4 ( dS , 0.0 ) ) . xy ; dM = by . xy / by . z ; dM += dL * REFL_BUMP ; dR = texture2D ( u_plane_reflection , dM ) . rgb ;".split(" ")}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dR = textureCube ( u_mirrormap , dQ ) . xyz ; dK = u_mirror_factor ;".split(" ")}]}}]},{type:"textline",b:"aE ( dR . rgb ) ; dH = mix ( dH , dR , dK * dP ) ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",a:[{type:"textline",b:"vec3 dW ( vec3 dU ) { float dV ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , dU ) . rgb ;".split(" ")}]}},{type:"elif",c:["SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"dV = 0.5 * dU . y + 0.5 ; return mix ( u_horizon_color , u_zenith_color , dV ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"float eb ( in float dX , inout vec2 dY , in vec2 dZ ) { float d_ ; vec4 ea ; ea = texture2D ( u_scene_depth , dY ) ; d_ = k ( ea ) ; if ( d_ < bz ) { dY = dZ ; return dX ; } else { return d_ ; } return dX ; }".split(" ")}]}}]},{type:"textline",b:"vec3 ej ( in vec3 ec , in vec2 ed ) { vec3 ee ; float ef ; vec4 eg ; vec2 eh , ei ; eh = ec . xy / ec . z ; ei = eh + ed ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"eg = texture2DProj ( u_scene_depth , ec ) ; ef = k ( eg ) ; eb ( ef , ei , eh ) ;".split(" ")}]}}]},{type:"textline",b:"ee = texture2D ( u_refractmap , ei ) . rgb ; aE ( ee ) ; return ee ; }".split(" ")}]}}]}]};a["include/nodes.glslf"]={type:"group",a:[{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",
b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",
b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ek",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float el = 0.5 ; vec3 em = vec3 ( ZERO_VALUE_NODES ) ; vec3 en = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"vec3 er ( in vec3 eo , in float ep ) { vec3 eq ; eq = em ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"eq = ej ( by , eo . xz * ep ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"eq = texture2D ( u_refractmap , by . xy / by . z ) . rgb ; aE ( eq ) ;".split(" ")}]}}]},{type:"textline",b:["return","eq",";",
"}"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"vec3 ew ( vec3 es ) { float et , eu ; vec4 ev ; ev = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; ev = mix ( vec4 ( es . bg , ev . wz ) , vec4 ( es . gb , ev . xy ) , step ( es . b , es . g ) ) ; ev = mix ( vec4 ( ev . xyw , es . r ) , vec4 ( es . r , ev . yzx ) , step ( ev . x , es . r ) ) ; et = ev . x - min ( ev . w , ev . y ) ; eu = 1.0e-10 ; return vec3 ( abs ( ev . z + ( ev . w - ev . y ) / ( 6.0 * et + eu ) ) , et / ( ev . x + eu ) , ev . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"vec3 eA ( vec3 ex ) { vec3 ey ; vec4 ez ; ez = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; ey = abs ( fract ( vec3 ( ex . r , ex . r , ex . r ) + ez . xyz ) * 6.0 - ez . www ) ; return ex . b * mix ( ez . xxx , clamp ( ey - ez . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , ex . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"vec3 eC ( vec2 eB ) { return vec3 ( eB * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"vec2 eE ( vec3 eD ) { return vec2 ( eD . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},
{type:"node",name:"CAMERA",h:[{type:"node_out",name:"fq",qualifier:["vec3"],e:!0},{type:"node_out",name:"fr",qualifier:["float"],e:!0},{type:"node_out",name:"fs",qualifier:["float"],e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_fq"],g:[{type:"textline",b:"fq = normalize ( fi . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_fr"],g:[{type:"textline",b:"fr = abs ( fi . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_fs"],
g:[{type:"textline",b:"fs = length ( fi . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",h:[{type:"node_in",name:"ft",qualifier:["float"],e:!1},{type:"node_in",name:"fu",qualifier:["float"],e:!1},{type:"node_in",name:"fv",qualifier:["float"],e:!1},{type:"node_out",name:"fw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fw = vec3 ( ft , fu , fv ) ;".split(" ")}]},{type:"node",name:"COMBHSV",h:[{type:"node_in",name:"fx",qualifier:["float"],e:!1},{type:"node_in",name:"fy",qualifier:["float"],
e:!1},{type:"node_in",name:"fz",qualifier:["float"],e:!1},{type:"node_out",name:"fA",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fA = eA ( vec3 ( fx , fy , fz ) ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",h:[{type:"node_out",name:"fB",qualifier:["vec3"],e:!1},{type:"node_param",name:"eF",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"fB = eC ( eF ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_OR",h:[{type:"node_out",name:"fC",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fC = 2.0 * clamp ( ek , 0.0 , 1.0 ) - en ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC",h:[{type:"node_out",name:"fD",qualifier:["vec3"],e:!1},{type:"node_param",name:"eG",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["fD","=","eG",";"]}]},{type:"node",name:"GEOMETRY_VC1",h:[{type:"node_out",name:"fE",qualifier:["float"],e:!1},{type:"node_param",name:"eH",qualifier:["varying","float"]}],g:[{type:"textline",b:["fE","=","eH",";"]}]},{type:"node",name:"GEOMETRY_VC2",h:[{type:"node_out",name:"fF",qualifier:["float"],e:!1},{type:"node_out",name:"fG",
qualifier:["float"],e:!1},{type:"node_param",name:"eI",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"fF = eI [ 0 ] ; fG = eI [ 1 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",h:[{type:"node_out",name:"fH",qualifier:["float"],e:!1},{type:"node_out",name:"fI",qualifier:["float"],e:!1},{type:"node_out",name:"fJ",qualifier:["float"],e:!1},{type:"node_param",name:"eJ",qualifier:["varying","vec3"]}],g:[{type:"textline",b:"fH = eJ [ 0 ] ; fI = eJ [ 1 ] ; fJ = eJ [ 2 ] ;".split(" ")}]},{type:"node",
name:"GEOMETRY_NO",h:[{type:"node_out",name:"fK",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["fK","=","fm",";"]}]},{type:"node",name:"GEOMETRY_FB",h:[{type:"node_out",name:"fL",qualifier:["float"],e:!1}],g:[{type:"textline",b:"fL = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VW",h:[{type:"node_out",name:"fM",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["fM","=","eS",";"]}]},{type:"node",name:"GEOMETRY_LO",h:[{type:"node_out",name:"fN",
qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fN [ 0 ] = fi [ 0 ] ; fN [ 1 ] = fi [ 1 ] ; fN [ 2 ] = fi [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_GL",h:[{type:"node_out",name:"fO",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fO = vec3 ( fl . r , - fl . b , fl . g ) ;".split(" ")}]},{type:"node",name:"NEW_GEOMETRY",h:[{type:"node_out",name:"fP",qualifier:["vec3"],e:!1},{type:"node_out",name:"fQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"fR",qualifier:["vec3"],e:!1},{type:"node_out",
name:"fS",qualifier:["vec3"],e:!1},{type:"node_out",name:"fT",qualifier:["vec3"],e:!1},{type:"node_out",name:"fU",qualifier:["vec3"],e:!1},{type:"node_out",name:"fV",qualifier:["float"],e:!1},{type:"node_out",name:"fW",qualifier:["float"],e:!1}],g:[{type:"textline",b:"fP = em ; fQ = em ; fR = em ; fS = em ; fT = em ; fU = em ; fV = ZERO_VALUE_NODES ; fW = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"HUE_SAT",h:[{type:"node_in",name:"fX",qualifier:["float"],e:!1},{type:"node_in",name:"fY",
qualifier:["float"],e:!1},{type:"node_in",name:"fZ",qualifier:["float"],e:!1},{type:"node_in",name:"f_",qualifier:["float"],e:!1},{type:"node_in",name:"ga",qualifier:["vec3"],e:!1},{type:"node_out",name:"gb",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fn = ew ( ga ) ; fn [ 0 ] += ( fX - 0.5 ) ; if ( fn [ 0 ] > UNITY_VALUE_NODES ) fn [ 0 ] -= UNITY_VALUE_NODES ; else if ( fn [ 0 ] < ZERO_VALUE_NODES ) fn [ 0 ] += UNITY_VALUE_NODES ; fn *= vec3 ( UNITY_VALUE_NODES , fY , fZ ) ; fn = mix ( en , mix ( em , fn , step ( em , fn ) ) , step ( fn , en ) ) ; gb = mix ( ga , eA ( fn ) , f_ ) ;".split(" ")}]},
{type:"node",name:"INVERT",h:[{type:"node_in",name:"gc",qualifier:["float"],e:!1},{type:"node_in",name:"gd",qualifier:["vec3"],e:!1},{type:"node_out",name:"ge",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ge = mix ( gd , en - gd , gc ) ;".split(" ")}]},{type:"node",name:"LAMP",h:[{type:"node_out",name:"gf",qualifier:["vec3"],e:!0},{type:"node_out",name:"gg",qualifier:["vec3"],e:!1},{type:"node_out",name:"gh",qualifier:["float"],e:!1},{type:"node_out",name:"gi",qualifier:["float"],e:!0}],g:[{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_gf"],g:[{type:"textline",b:"gf = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",b:"fj = u_lamp_light_factors [ LAMP_INDEX ] ; fn = u_lamp_light_directions [ LAMP_INDEX ] ; fo = u_lamp_light_positions [ LAMP_INDEX ] ; fb = fj . z ; if ( fb != - UNITY_VALUE_NODES ) {".split(" ")},{type:"textline",b:"gg = fo - bu ; gh = length ( gg ) ; gg = normalize ( gg ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gi"],g:[{type:"textline",
b:"gi = fb / ( fb + gh * gh ) ; fb = fj . x ; fc = fj . y ; if ( fb > - UNITY_VALUE_NODES ) { fd = dot ( gg , fn ) ; fd *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( fd - fb ) / fc ) ; gi *= fd ; }".split(" ")}]}]},{type:"textline",b:["}","else","{"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gg"],g:[{type:"textline",b:["gg","=","fn",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gh"],g:[{type:"textline",b:"gh = length ( fo - bu ) ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_gi"],g:[{type:"textline",b:["gi","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"NORMAL",h:[{type:"node_in",name:"gj",qualifier:["vec3"],e:!1},{type:"node_out",name:"gk",qualifier:["vec3"],e:!0},{type:"node_out",name:"gl",qualifier:["float"],e:!0},{type:"node_param",name:"eK",qualifier:["vec3"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gk"],g:[{type:"textline",b:["gk","=","eK",";"]}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_gl"],g:[{type:"textline",b:"gl = - dot ( gj , eK ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",h:[{type:"node_in",name:"gm",qualifier:["vec3"],e:!1},{type:"node_out",name:"gn",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"gn = - ( u_view_matrix_frag * vec4 ( gm , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"BSDF_ANISOTROPIC",h:[{type:"node_in",name:"go",qualifier:["vec3"],e:!1},{type:"node_in",name:"gp",qualifier:["float"],e:!1},{type:"node_in",name:"gq",
qualifier:["float"],e:!1},{type:"node_in",name:"gr",qualifier:["float"],e:!1},{type:"node_in",name:"gs",qualifier:["vec3"],e:!1},{type:"node_in",name:"gt",qualifier:["vec3"],e:!1},{type:"node_out",name:"gu",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gu","=","go",";"]},{type:"textline",b:"gp ; gq ; gr ; gs ; gt ;".split(" ")}]},{type:"node",name:"BSDF_DIFFUSE",h:[{type:"node_in",name:"gv",qualifier:["vec3"],e:!1},{type:"node_in",name:"gw",qualifier:["float"],e:!1},{type:"node_in",name:"gx",
qualifier:["vec3"],e:!1},{type:"node_out",name:"gy",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gy","=","gv",";"]},{type:"textline",b:["gw",";","gx",";"]}]},{type:"node",name:"BSDF_GLASS",h:[{type:"node_in",name:"gz",qualifier:["vec3"],e:!1},{type:"node_in",name:"gA",qualifier:["float"],e:!1},{type:"node_in",name:"gB",qualifier:["float"],e:!1},{type:"node_in",name:"gC",qualifier:["vec3"],e:!1},{type:"node_out",name:"gD",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gD","=","gz",";"]},{type:"textline",
b:"gA ; gB ; gC ;".split(" ")}]},{type:"node",name:"BSDF_GLOSSY",h:[{type:"node_in",name:"gE",qualifier:["vec3"],e:!1},{type:"node_in",name:"gF",qualifier:["float"],e:!1},{type:"node_in",name:"gG",qualifier:["vec3"],e:!1},{type:"node_out",name:"gH",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gH","=","gE",";"]},{type:"textline",b:["gF",";","gG",";"]}]},{type:"node",name:"BSDF_HAIR",h:[{type:"node_in",name:"gI",qualifier:["vec3"],e:!1},{type:"node_in",name:"gJ",qualifier:["float"],e:!1},{type:"node_in",
name:"gK",qualifier:["float"],e:!1},{type:"node_in",name:"gL",qualifier:["float"],e:!1},{type:"node_out",name:"gM",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gM","=","gI",";"]},{type:"textline",b:"gJ ; gK ; gL ;".split(" ")}]},{type:"node",name:"BSDF_TRANSPARENT",h:[{type:"node_in",name:"gN",qualifier:["vec3"],e:!1},{type:"node_out",name:"gO",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gO","=","gN",";"]}]},{type:"node",name:"BSDF_TRANSLUCENT",h:[{type:"node_in",name:"gP",qualifier:["vec3"],
e:!1},{type:"node_in",name:"gQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"gR",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gR","=","gP",";"]},{type:"textline",b:["gQ",";"]}]},{type:"node",name:"BSDF_REFRACTION",h:[{type:"node_in",name:"gS",qualifier:["vec3"],e:!1},{type:"node_in",name:"gT",qualifier:["float"],e:!1},{type:"node_in",name:"gU",qualifier:["float"],e:!1},{type:"node_in",name:"gV",qualifier:["vec3"],e:!1},{type:"node_out",name:"gW",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"gW [ 0 ] = gW [ 1 ] = gW [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"gS ; gT ; gU ; gV ;".split(" ")}]},{type:"node",name:"BSDF_TOON",h:[{type:"node_in",name:"gX",qualifier:["vec3"],e:!1},{type:"node_in",name:"gY",qualifier:["float"],e:!1},{type:"node_in",name:"gZ",qualifier:["float"],e:!1},{type:"node_in",name:"g_",qualifier:["vec3"],e:!1},{type:"node_out",name:"ha",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["ha","=","gX",";"]},{type:"textline",b:"gY ; gZ ; g_ ;".split(" ")}]},
{type:"node",name:"BSDF_VELVET",h:[{type:"node_in",name:"hb",qualifier:["vec3"],e:!1},{type:"node_in",name:"hc",qualifier:["float"],e:!1},{type:"node_in",name:"hd",qualifier:["vec3"],e:!1},{type:"node_out",name:"he",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["he","=","hb",";"]},{type:"textline",b:["hc",";","hd",";"]}]},{type:"node",name:"SUBSURFACE_SCATTERING",h:[{type:"node_in",name:"hf",qualifier:["vec3"],e:!1},{type:"node_in",name:"hg",qualifier:["float"],e:!1},{type:"node_in",name:"hh",
qualifier:["vec3"],e:!1},{type:"node_in",name:"hi",qualifier:["float"],e:!1},{type:"node_in",name:"hj",qualifier:["float"],e:!1},{type:"node_in",name:"hk",qualifier:["vec3"],e:!1},{type:"node_out",name:"hl",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hl [ 0 ] = hl [ 1 ] = hl [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"hf ; hh ; hi ; hj ; hk ; hg ;".split(" ")}]},{type:"node",name:"EMISSION",h:[{type:"node_in",name:"hm",qualifier:["vec3"],e:!1},{type:"node_in",name:"hn",qualifier:["float"],
e:!1},{type:"node_out",name:"ho",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["ho","=","hm",";"]},{type:"textline",b:["hn",";"]}]},{type:"node",name:"AMBIENT_OCCLUSION",h:[{type:"node_in",name:"hp",qualifier:["vec3"],e:!1},{type:"node_out",name:"hq",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hq [ 0 ] = hq [ 1 ] = hq [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hp",";"]}]},{type:"node",name:"HOLDOUT",h:[{type:"node_out",name:"hr",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"hr [ 0 ] = hr [ 1 ] = hr [ 2 ] = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"VOLUME_ABSORPTION",h:[{type:"node_in",name:"hs",qualifier:["vec3"],e:!1},{type:"node_in",name:"ht",qualifier:["float"],e:!1},{type:"node_out",name:"hu",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hu [ 0 ] = hu [ 1 ] = hu [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hs",";","ht",";"]}]},{type:"node",name:"VOLUME_SCATTER",h:[{type:"node_in",name:"hv",qualifier:["vec3"],e:!1},{type:"node_in",
name:"hw",qualifier:["float"],e:!1},{type:"node_in",name:"hx",qualifier:["float"],e:!1},{type:"node_out",name:"hy",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hy [ 0 ] = hy [ 1 ] = hy [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"hv ; hw ; hx ;".split(" ")}]},{type:"node",name:"BUMP",h:[{type:"node_in",name:"hz",qualifier:["float"],e:!1},{type:"node_in",name:"hA",qualifier:["float"],e:!1},{type:"node_in",name:"hB",qualifier:["float"],e:!1},{type:"node_in",name:"hC",qualifier:["vec3"],
e:!1},{type:"node_out",name:"hD",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hD","=","hC",";"]},{type:"textline",b:"hz ; hA ; hB ;".split(" ")}]},{type:"node",name:"NORMAL_MAP",h:[{type:"node_in",name:"hE",qualifier:["float"],e:!1},{type:"node_in",name:"hF",qualifier:["vec3"],e:!1},{type:"node_out",name:"hG",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hG","=","hF",";"]},{type:"textline",b:["hE",";"]}]},{type:"node",name:"VECT_TRANSFORM",h:[{type:"node_in",name:"hH",qualifier:["vec3"],
e:!1},{type:"node_out",name:"hI",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hI [ 0 ] = hI [ 1 ] = hI [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hH",";"]}]},{type:"node",name:"BLACKBODY",h:[{type:"node_in",name:"hJ",qualifier:["float"],e:!1},{type:"node_out",name:"hK",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hK [ 0 ] = hK [ 1 ] = hK [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hJ",";"]}]},{type:"node",name:"WAVELENGTH",h:[{type:"node_in",name:"hL",qualifier:["float"],
e:!1},{type:"node_out",name:"hM",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hM [ 0 ] = hM [ 1 ] = hM [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hL",";"]}]},{type:"node",name:"SEPXYZ",h:[{type:"node_in",name:"hN",qualifier:["vec3"],e:!1},{type:"node_out",name:"hO",qualifier:["float"],e:!1},{type:"node_out",name:"hP",qualifier:["float"],e:!1},{type:"node_out",name:"hQ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"hO = hN [ 0 ] ; hP = hN [ 1 ] ; hQ = hN [ 2 ] ;".split(" ")}]},
{type:"node",name:"COMBXYZ",h:[{type:"node_in",name:"hR",qualifier:["float"],e:!1},{type:"node_in",name:"hS",qualifier:["float"],e:!1},{type:"node_in",name:"hT",qualifier:["float"],e:!1},{type:"node_out",name:"hU",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hU [ 0 ] = hR ; hU [ 1 ] = hS ; hU [ 2 ] = hT ;".split(" ")}]},{type:"node",name:"BRIGHTCONTRAST",h:[{type:"node_in",name:"hV",qualifier:["vec3"],e:!1},{type:"node_in",name:"hW",qualifier:["float"],e:!1},{type:"node_in",name:"hX",qualifier:["float"],
e:!1},{type:"node_out",name:"hY",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = hW - hX * 0.5 ; hY = max ( ( UNITY_VALUE_NODES + hX ) * hV + fd , em ) ;".split(" ")}]},{type:"node",name:"LIGHT_FALLOFF",h:[{type:"node_in",name:"hZ",qualifier:["float"],e:!1},{type:"node_in",name:"h_",qualifier:["float"],e:!1},{type:"node_out",name:"ia",qualifier:["float"],e:!1},{type:"node_out",name:"ib",qualifier:["float"],e:!1},{type:"node_out",name:"ic",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ia = ib = ic = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",b:["hZ",";","h_",";"]}]},{type:"node",name:"TEX_IMAGE",h:[{type:"node_in",name:"id",qualifier:["vec3"],e:!1},{type:"node_out",name:"ie",qualifier:["vec3"],e:!1},{type:"node_out",name:"ig",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ie [ 0 ] = ie [ 1 ] = ie [ 2 ] = ZERO_VALUE_NODES ; ig = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["id",";"]}]},{type:"node",name:"TEX_ENVIRONMENT",h:[{type:"node_in",name:"ih",qualifier:["vec3"],e:!1},{type:"node_out",name:"ii",qualifier:["vec3"],
e:!1}],g:[{type:"textline",b:"ii [ 0 ] = ii [ 1 ] = ii [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["ih",";"]}]},{type:"node",name:"TEX_SKY",h:[{type:"node_in",name:"ij",qualifier:["vec3"],e:!1},{type:"node_out",name:"ik",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ik [ 0 ] = ik [ 1 ] = ik [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["ij",";"]}]},{type:"node",name:"TEX_NOISE",h:[{type:"node_in",name:"il",qualifier:["vec3"],e:!1},{type:"node_in",name:"im",qualifier:["float"],
e:!1},{type:"node_in",name:"io",qualifier:["float"],e:!1},{type:"node_in",name:"ip",qualifier:["float"],e:!1},{type:"node_out",name:"iq",qualifier:["vec3"],e:!1},{type:"node_out",name:"ir",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iq [ 0 ] = iq [ 1 ] = iq [ 2 ] = ZERO_VALUE_NODES ; ir = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"il ; im ; io ; ip ;".split(" ")}]},{type:"node",name:"TEX_WAVE",h:[{type:"node_in",name:"is",qualifier:["vec3"],e:!1},{type:"node_in",name:"it",qualifier:["float"],
e:!1},{type:"node_in",name:"iu",qualifier:["float"],e:!1},{type:"node_in",name:"iv",qualifier:["float"],e:!1},{type:"node_in",name:"iw",qualifier:["float"],e:!1},{type:"node_out",name:"ix",qualifier:["vec3"],e:!1},{type:"node_out",name:"iy",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ix [ 0 ] = ix [ 1 ] = ix [ 2 ] = ZERO_VALUE_NODES ; iy = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"is ; it ; iu ; iv ; iw ;".split(" ")}]},{type:"node",name:"TEX_VORONOI",h:[{type:"node_in",name:"iz",
qualifier:["vec3"],e:!1},{type:"node_in",name:"iA",qualifier:["float"],e:!1},{type:"node_out",name:"iB",qualifier:["vec3"],e:!1},{type:"node_out",name:"iC",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iB [ 0 ] = iB [ 1 ] = iB [ 2 ] = ZERO_VALUE_NODES ; iC = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["iz",";","iA",";"]}]},{type:"node",name:"TEX_MUSGRAVE",h:[{type:"node_in",name:"iD",qualifier:["vec3"],e:!1},{type:"node_in",name:"iE",qualifier:["float"],e:!1},{type:"node_in",name:"iF",
qualifier:["float"],e:!1},{type:"node_in",name:"iG",qualifier:["float"],e:!1},{type:"node_in",name:"iH",qualifier:["float"],e:!1},{type:"node_in",name:"iI",qualifier:["float"],e:!1},{type:"node_in",name:"iJ",qualifier:["float"],e:!1},{type:"node_out",name:"iK",qualifier:["vec3"],e:!1},{type:"node_out",name:"iL",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iK [ 0 ] = iK [ 1 ] = iK [ 2 ] = ZERO_VALUE_NODES ; iL = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"iD ; iE ; iF ; iG ; iH ; iI ; iJ ;".split(" ")}]},
{type:"node",name:"TEX_GRADIENT",h:[{type:"node_in",name:"iM",qualifier:["vec3"],e:!1},{type:"node_out",name:"iN",qualifier:["vec3"],e:!1},{type:"node_out",name:"iO",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iN [ 0 ] = iN [ 1 ] = iN [ 2 ] = ZERO_VALUE_NODES ; iO = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["iM",";"]}]},{type:"node",name:"TEX_MAGIC",h:[{type:"node_in",name:"iP",qualifier:["vec3"],e:!1},{type:"node_in",name:"iQ",qualifier:["float"],e:!1},{type:"node_in",name:"iR",
qualifier:["float"],e:!1},{type:"node_out",name:"iS",qualifier:["vec3"],e:!1},{type:"node_out",name:"iT",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iS [ 0 ] = iS [ 1 ] = iS [ 2 ] = ZERO_VALUE_NODES ; iT = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"iP ; iQ ; iR ;".split(" ")}]},{type:"node",name:"TEX_CHECKER",h:[{type:"node_in",name:"iU",qualifier:["vec3"],e:!1},{type:"node_in",name:"iV",qualifier:["vec3"],e:!1},{type:"node_in",name:"iW",qualifier:["vec3"],e:!1},{type:"node_in",name:"iX",
qualifier:["float"],e:!1},{type:"node_out",name:"iY",qualifier:["vec3"],e:!1},{type:"node_out",name:"iZ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iY [ 0 ] = iY [ 1 ] = iY [ 2 ] = ZERO_VALUE_NODES ; iZ = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"iU ; iV ; iW ; iX ;".split(" ")}]},{type:"node",name:"TEX_BRICK",h:[{type:"node_in",name:"i_",qualifier:["vec3"],e:!1},{type:"node_in",name:"ja",qualifier:["vec3"],e:!1},{type:"node_in",name:"jb",qualifier:["vec3"],e:!1},{type:"node_in",
name:"jc",qualifier:["vec3"],e:!1},{type:"node_in",name:"jd",qualifier:["float"],e:!1},{type:"node_in",name:"je",qualifier:["float"],e:!1},{type:"node_in",name:"jf",qualifier:["float"],e:!1},{type:"node_in",name:"jg",qualifier:["float"],e:!1},{type:"node_in",name:"jh",qualifier:["float"],e:!1},{type:"node_out",name:"ji",qualifier:["vec3"],e:!1},{type:"node_out",name:"jj",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ji [ 0 ] = ji [ 1 ] = ji [ 2 ] = ZERO_VALUE_NODES ; jj = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",b:"i_ ; ja ; jb ; jc ; jd ; je ; jf ; jg ; jh ;".split(" ")}]},{type:"node",name:"ADD_SHADER",h:[{type:"node_in",name:"jk",qualifier:["vec3"],e:!1},{type:"node_in",name:"jl",qualifier:["vec3"],e:!1},{type:"node_out",name:"jm",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jm = clamp ( jk + jl , em , en ) ;".split(" ")}]},{type:"node",name:"MIX_SHADER",h:[{type:"node_in",name:"jn",qualifier:["float"],e:!1},{type:"node_in",name:"jo",qualifier:["vec3"],e:!1},{type:"node_in",name:"jp",
qualifier:["vec3"],e:!1},{type:"node_out",name:"jq",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( jn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; jq = fd * jo + ( UNITY_VALUE_NODES - fd ) * jp ;".split(" ")}]},{type:"node",name:"UV_MERGED",h:[{type:"node_out",name:"jr",qualifier:["vec3"],e:!1},{type:"node_out",name:"js",qualifier:["vec3"],e:!1},{type:"node_param",name:"eL",qualifier:["varying","vec2"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jr"],g:[{type:"textline",
b:"jr = eC ( eL ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_js"],g:[{type:"textline",b:"js = vec3 ( eL , ZERO_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"TEX_COORD_UV",h:[{type:"node_out",name:"jt",qualifier:["vec3"],e:!1},{type:"node_param",name:"eM",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"jt = vec3 ( eM , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_NO",h:[{type:"node_out",name:"ju",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:["ju","=","fm",";"]}]},{type:"node",name:"TEX_COORD_GE",h:[{type:"node_out",name:"jv",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jv = abs ( ek ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_OB",h:[{type:"node_out",name:"jw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jw [ 0 ] = jw [ 1 ] = jw [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_CA",h:[{type:"node_out",name:"jx",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jx [ 0 ] = fi [ 0 ] ; jx [ 1 ] = fi [ 1 ] ; jx [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"TEX_COORD_WI",h:[{type:"node_out",name:"jy",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jy [ 0 ] = jy [ 1 ] = jy [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_RE",h:[{type:"node_out",name:"jz",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jz [ 0 ] = jz [ 1 ] = jz [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"UVMAP",h:[{type:"node_out",name:"jA",qualifier:["vec3"],e:!1},{type:"node_param",name:"eN",qualifier:["varying","vec2"]}],
g:[{type:"textline",b:"jA = vec3 ( eN , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"PARTICLE_INFO",h:[{type:"node_out",name:"jB",qualifier:["float"],e:!1},{type:"node_out",name:"jC",qualifier:["float"],e:!1},{type:"node_out",name:"jD",qualifier:["float"],e:!1},{type:"node_out",name:"jE",qualifier:["vec3"],e:!1},{type:"node_out",name:"jF",qualifier:["float"],e:!1},{type:"node_out",name:"jG",qualifier:["vec3"],e:!1},{type:"node_out",name:"jH",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"jB = ZERO_VALUE_NODES ; jC = ZERO_VALUE_NODES ; jD = ZERO_VALUE_NODES ; jE = vec3 ( ZERO_VALUE_NODES ) ; jF = ZERO_VALUE_NODES ; jG = jE ; jH = jE ;".split(" ")}]},{type:"node",name:"HAIR_INFO",h:[{type:"node_out",name:"jI",qualifier:["float"],e:!1},{type:"node_out",name:"jJ",qualifier:["float"],e:!1},{type:"node_out",name:"jK",qualifier:["float"],e:!1},{type:"node_out",name:"jL",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jI = ZERO_VALUE_NODES ; jJ = ZERO_VALUE_NODES ; jK = ZERO_VALUE_NODES ; jL = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"OBJECT_INFO",h:[{type:"node_out",name:"jM",qualifier:["vec3"],e:!1},{type:"node_out",name:"jN",qualifier:["float"],e:!1},{type:"node_out",name:"jO",qualifier:["float"],e:!1},{type:"node_out",name:"jP",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jN = ZERO_VALUE_NODES ; jO = ZERO_VALUE_NODES ; jP = ZERO_VALUE_NODES ; jM = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"WIREFRAME",h:[{type:"node_in",name:"jQ",qualifier:["float"],e:!1},{type:"node_out",name:"jR",
qualifier:["float"],e:!1}],g:[{type:"textline",b:["jR","=","jQ",";"]}]},{type:"node",name:"TANGENT",h:[{type:"node_out",name:"jS",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jS = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LAYER_WEIGHT",h:[{type:"node_in",name:"jT",qualifier:["float"],e:!1},{type:"node_in",name:"jU",qualifier:["vec3"],e:!1},{type:"node_out",name:"jV",qualifier:["float"],e:!1},{type:"node_out",name:"jW",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jV = jW = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",b:["jU",";","jT",";"]}]},{type:"node",name:"LIGHT_PATH",h:[{type:"node_out",name:"jX",qualifier:["float"],e:!1},{type:"node_out",name:"jY",qualifier:["float"],e:!1},{type:"node_out",name:"jZ",qualifier:["float"],e:!1},{type:"node_out",name:"j_",qualifier:["float"],e:!1},{type:"node_out",name:"ka",qualifier:["float"],e:!1},{type:"node_out",name:"kb",qualifier:["float"],e:!1},{type:"node_out",name:"kc",qualifier:["float"],e:!1},{type:"node_out",name:"kd",qualifier:["float"],e:!1},{type:"node_out",
name:"ke",qualifier:["float"],e:!1},{type:"node_out",name:"kf",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jX = jY = jZ = ZERO_VALUE_NODES ; j_ = ka = kb = ZERO_VALUE_NODES ; kc = kc = ke = kf = ZERO_VALUE_NODES ; kd = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"ATTRIBUTE",h:[{type:"node_out",name:"kg",qualifier:["vec3"],e:!1},{type:"node_out",name:"kh",qualifier:["vec3"],e:!1},{type:"node_out",name:"ki",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kg = kh = vec3 ( ZERO_VALUE_NODES ) ; ki = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"SCRIPT",h:[],g:[]},{type:"node",name:"CURVE_VEC",h:[{type:"node_in",name:"kj",qualifier:["float"],e:!1},{type:"node_in",name:"kk",qualifier:["vec3"],e:!1},{type:"node_out",name:"kl",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["kl","=","kk",";"]},{type:"textline",b:["kj",";"]}]},{type:"node",name:"CURVE_RGB",h:[{type:"node_in",name:"km",qualifier:["float"],e:!1},{type:"node_in",name:"kn",qualifier:["vec3"],e:!1},{type:"node_out",name:"ko",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:["ko","=","kn",";"]},{type:"textline",b:["km",";"]}]},{type:"node",name:"VALTORGB",h:[{type:"node_in",name:"kp",qualifier:["float"],e:!1},{type:"node_out",name:"kq",qualifier:["vec3"],e:!1},{type:"node_out",name:"kr",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kq [ 0 ] = kq [ 1 ] = kq [ 2 ] = clamp ( kp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; kr = kq [ 0 ] ;".split(" ")}]},{type:"node",name:"MAPPING",h:[{type:"node_in",name:"ks",qualifier:["vec3"],e:!1},{type:"node_out",name:"kt",qualifier:["vec3"],
e:!1}],g:[{type:"textline",b:["kt","=","ks",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",g:[{type:"textline",b:"kt = ( MAPPING_TRS_MATRIX * vec4 ( kt , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_SCALE",g:[{type:"textline",b:"kt = kt * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",g:[{type:"textline",b:"kt = kt + MAPPING_TRANSLATION ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",g:[{type:"textline",b:"kt = max ( kt , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",g:[{type:"textline",b:"kt = min ( kt , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],g:[{type:"textline",b:"kt = normalize ( kt ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",h:[{type:"node_in",name:"ku",qualifier:["float"],
e:!1},{type:"node_in",name:"kv",qualifier:["float"],e:!1},{type:"node_out",name:"kw",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kw = ku + kv ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kw = clamp ( kw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",h:[{type:"node_in",name:"kx",qualifier:["float"],e:!1},{type:"node_in",name:"ky",qualifier:["float"],e:!1},{type:"node_out",name:"kz",qualifier:["float"],
e:!1}],g:[{type:"textline",b:"kz = kx - ky ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kz = clamp ( kz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MULTIPLY",h:[{type:"node_in",name:"kA",qualifier:["float"],e:!1},{type:"node_in",name:"kB",qualifier:["float"],e:!1},{type:"node_out",name:"kC",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kC = kA * kB ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kC = clamp ( kC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",h:[{type:"node_in",name:"kD",qualifier:["float"],e:!1},{type:"node_in",name:"kE",qualifier:["float"],e:!1},{type:"node_out",name:"kF",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kF = ( kE != ZERO_VALUE_NODES ) ? kD / kE : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kF = clamp ( kF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_SINE",h:[{type:"node_in",name:"kG",qualifier:["float"],e:!1},{type:"node_in",name:"kH",qualifier:["float"],e:!1},{type:"node_out",name:"kI",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kI = sin ( kG ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kI = clamp ( kI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kH",";"]}]},{type:"node",name:"MATH_COSINE",h:[{type:"node_in",name:"kJ",
qualifier:["float"],e:!1},{type:"node_in",name:"kK",qualifier:["float"],e:!1},{type:"node_out",name:"kL",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kL = cos ( kJ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kL = clamp ( kL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kK",";"]}]},{type:"node",name:"MATH_TANGENT",h:[{type:"node_in",name:"kM",qualifier:["float"],e:!1},{type:"node_in",name:"kN",qualifier:["float"],
e:!1},{type:"node_out",name:"kO",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kO = tan ( kM ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kO = clamp ( kO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kN",";"]}]},{type:"node",name:"MATH_ARCSINE",h:[{type:"node_in",name:"kP",qualifier:["float"],e:!1},{type:"node_in",name:"kQ",qualifier:["float"],e:!1},{type:"node_out",name:"kR",qualifier:["float"],e:!1}],
g:[{type:"textline",b:"kR = ( kP <= UNITY_VALUE_NODES && kP >= - UNITY_VALUE_NODES ) ? asin ( kP ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kR = clamp ( kR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kQ",";"]}]},{type:"node",name:"MATH_ARCCOSINE",h:[{type:"node_in",name:"kS",qualifier:["float"],e:!1},{type:"node_in",name:"kT",qualifier:["float"],e:!1},{type:"node_out",name:"kU",qualifier:["float"],
e:!1}],g:[{type:"textline",b:"kU = ( kS <= UNITY_VALUE_NODES && kS >= - UNITY_VALUE_NODES ) ? acos ( kS ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kU = clamp ( kU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kT",";"]}]},{type:"node",name:"MATH_ARCTANGENT",h:[{type:"node_in",name:"kV",qualifier:["float"],e:!1},{type:"node_in",name:"kW",qualifier:["float"],e:!1},{type:"node_out",name:"kX",
qualifier:["float"],e:!1}],g:[{type:"textline",b:"kX = atan ( kV ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kX = clamp ( kX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kW",";"]}]},{type:"node",name:"MATH_POWER",h:[{type:"node_in",name:"kY",qualifier:["float"],e:!1},{type:"node_in",name:"kZ",qualifier:["float"],e:!1},{type:"node_out",name:"k_",qualifier:["float"],e:!1}],g:[{type:"textline",b:"if ( kY < ZERO_VALUE_NODES || kY == ZERO_VALUE_NODES && kZ == ZERO_VALUE_NODES ) k_ = ZERO_VALUE_NODES ; else k_ = pow ( kY , kZ ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"k_ = clamp ( k_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",h:[{type:"node_in",name:"la",qualifier:["float"],e:!1},{type:"node_in",name:"lb",qualifier:["float"],e:!1},{type:"node_out",name:"lc",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lc = ( la > ZERO_VALUE_NODES && lb > ZERO_VALUE_NODES ) ? log2 ( la ) / log2 ( lb ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lc = clamp ( lc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MINIMUM",h:[{type:"node_in",name:"ld",qualifier:["float"],e:!1},{type:"node_in",name:"le",qualifier:["float"],e:!1},{type:"node_out",name:"lf",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lf = min ( ld , le ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lf = clamp ( lf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MAXIMUM",h:[{type:"node_in",name:"lg",qualifier:["float"],e:!1},{type:"node_in",name:"lh",qualifier:["float"],e:!1},{type:"node_out",name:"li",qualifier:["float"],e:!1}],g:[{type:"textline",b:"li = max ( lg , lh ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"li = clamp ( li , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",h:[{type:"node_in",name:"lj",qualifier:["float"],e:!1},
{type:"node_in",name:"lk",qualifier:["float"],e:!1},{type:"node_out",name:"ll",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ll = floor ( lj + 0.5 ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ll = clamp ( ll , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["lk",";"]}]},{type:"node",name:"MATH_LESS_THAN",h:[{type:"node_in",name:"lm",qualifier:["float"],e:!1},{type:"node_in",name:"ln",qualifier:["float"],e:!1},
{type:"node_out",name:"lo",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lo = ( lm < ln ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lo = clamp ( lo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",h:[{type:"node_in",name:"lp",qualifier:["float"],e:!1},{type:"node_in",name:"lq",qualifier:["float"],e:!1},{type:"node_out",name:"lr",qualifier:["float"],
e:!1}],g:[{type:"textline",b:"lr = ( lp > lq ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lr = clamp ( lr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",h:[{type:"node_in",name:"ls",qualifier:["float"],e:!1},{type:"node_in",name:"lt",qualifier:["float"],e:!1},{type:"node_out",name:"lu",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lu = abs ( lt ) > 0.000001 ? mod ( ls , lt ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lu = clamp ( lu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ABSOLUTE",h:[{type:"node_in",name:"lv",qualifier:["float"],e:!1},{type:"node_in",name:"lw",qualifier:["float"],e:!1},{type:"node_out",name:"lx",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lx = abs ( lv ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lx = clamp ( lx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["lw",";"]}]},{type:"node",name:"MIX_RGB_MIX",h:[{type:"node_in",name:"ly",qualifier:["float"],e:!1},{type:"node_in",name:"lz",qualifier:["vec3"],e:!1},{type:"node_in",name:"lA",qualifier:["vec3"],e:!1},{type:"node_out",name:"lB",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( ly , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lB = mix ( lz , lA , fd ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lB = clamp ( lB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_ADD",h:[{type:"node_in",name:"lC",qualifier:["float"],e:!1},{type:"node_in",name:"lD",qualifier:["vec3"],e:!1},{type:"node_in",name:"lE",qualifier:["vec3"],e:!1},{type:"node_out",name:"lF",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( lC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lF = mix ( lD , lD + lE , fd ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lF = clamp ( lF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_MULTIPLY",h:[{type:"node_in",name:"lG",qualifier:["float"],e:!1},{type:"node_in",name:"lH",qualifier:["vec3"],e:!1},{type:"node_in",name:"lI",qualifier:["vec3"],e:!1},{type:"node_out",name:"lJ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( lG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lJ = mix ( lH , lH * lI , fd ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lJ = clamp ( lJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SUBTRACT",h:[{type:"node_in",name:"lK",qualifier:["float"],e:!1},{type:"node_in",name:"lL",qualifier:["vec3"],e:!1},{type:"node_in",name:"lM",qualifier:["vec3"],e:!1},{type:"node_out",name:"lN",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( lK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lN = mix ( lL , lL - lM , fd ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lN = clamp ( lN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SCREEN",h:[{type:"node_in",name:"lO",qualifier:["float"],e:!1},{type:"node_in",name:"lP",qualifier:["vec3"],e:!1},{type:"node_in",name:"lQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"lR",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( lO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fc = UNITY_VALUE_NODES - fd ; lR = en - ( vec3 ( fc ) + fd * ( en - lQ ) ) * ( en - lP ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",
b:"lR = clamp ( lR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",h:[{type:"node_in",name:"lS",qualifier:["float"],e:!1},{type:"node_in",name:"lT",qualifier:["vec3"],e:!1},{type:"node_in",name:"lU",qualifier:["vec3"],e:!1},{type:"node_out",name:"lV",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( lS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fc = UNITY_VALUE_NODES - fd ; lU += step ( lU , em ) ; lV = fc * lT + fd * lT / lU ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lV = clamp ( lV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",h:[{type:"node_in",name:"lW",qualifier:["float"],e:!1},{type:"node_in",name:"lX",qualifier:["vec3"],e:!1},{type:"node_in",name:"lY",qualifier:["vec3"],e:!1},{type:"node_out",name:"lZ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( lW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lZ = mix ( lX , abs ( lX - lY ) , fd ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lZ = clamp ( lZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",h:[{type:"node_in",name:"l_",qualifier:["float"],e:!1},{type:"node_in",name:"ma",qualifier:["vec3"],e:!1},{type:"node_in",name:"mb",qualifier:["vec3"],e:!1},{type:"node_out",name:"mc",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( l_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mc = min ( ma . rgb , mb . rgb * fd ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mc = clamp ( mc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",h:[{type:"node_in",name:"md",qualifier:["float"],e:!1},{type:"node_in",name:"me",qualifier:["vec3"],e:!1},{type:"node_in",name:"mf",qualifier:["vec3"],e:!1},{type:"node_out",name:"mg",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( md , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mg = max ( me . rgb , mf . rgb * fd ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mg = clamp ( mg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_OVERLAY",h:[{type:"node_in",name:"mh",qualifier:["float"],e:!1},{type:"node_in",name:"mi",qualifier:["vec3"],e:!1},{type:"node_in",name:"mj",qualifier:["vec3"],e:!1},{type:"node_out",name:"mk",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fo = vec3 ( UNITY_VALUE_NODES - fd ) ; mk = mix ( mi * ( fo + 2.0 * fd * mj ) , en - ( fo + 2.0 * fd * ( en - mj ) ) * ( en - mi ) , step ( 0.5 , mi ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mk = clamp ( mk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",h:[{type:"node_in",name:"ml",qualifier:["float"],e:!1},{type:"node_in",name:"mm",qualifier:["vec3"],e:!1},{type:"node_in",name:"mn",qualifier:["vec3"],e:!1},{type:"node_out",name:"mo",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( ml , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fo = en - fd * mn ; fn = clamp ( mm / fo , 0.0 , 1.0 ) ; mo = mix ( mix ( fn , en , step ( fo , em ) ) , mm , step ( mm , em ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mo = clamp ( mo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_BURN",h:[{type:"node_in",name:"mp",qualifier:["float"],e:!1},{type:"node_in",name:"mq",qualifier:["vec3"],e:!1},{type:"node_in",name:"mr",qualifier:["vec3"],e:!1},{type:"node_out",name:"ms",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mp , 0.0 , 1.0 ) ; fo = vec3 ( 1.0 - fd ) ; fo = fo + fd * mr ; fn = clamp ( en - ( en - mq ) / fo , 0.0 , 1.0 ) ; ms = mix ( fn , em , step ( fo , em ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"ms = clamp ( ms , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",h:[{type:"node_in",name:"mt",qualifier:["float"],e:!1},{type:"node_in",name:"mu",qualifier:["vec3"],e:!1},{type:"node_in",name:"mv",qualifier:["vec3"],e:!1},{type:"node_out",name:"mw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mt , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mw = mu ; fn = ew ( mv ) ; if ( fn . y != ZERO_VALUE_NODES ) { fo = ew ( mw ) ; fo . x = fn . x ; fp = eA ( fo ) ; mw = mix ( mw , fp , fd ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mw = clamp ( mw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",h:[{type:"node_in",name:"mx",qualifier:["float"],e:!1},{type:"node_in",name:"my",qualifier:["vec3"],e:!1},{type:"node_in",name:"mz",qualifier:["vec3"],e:!1},{type:"node_out",name:"mA",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fc = UNITY_VALUE_NODES - fd ; mA = my ; fp = ew ( mA ) ; if ( fp . y != ZERO_VALUE_NODES ) { fo = ew ( mz ) ; fp . y = fc * fp . y + fd * fo . y ; mA = eA ( fp ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mA = clamp ( mA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",h:[{type:"node_in",name:"mB",qualifier:["float"],e:!1},{type:"node_in",name:"mC",qualifier:["vec3"],e:!1},{type:"node_in",name:"mD",qualifier:["vec3"],e:!1},{type:"node_out",name:"mE",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fc = UNITY_VALUE_NODES - fd ; fp = ew ( mC ) ; fo = ew ( mD ) ; fp . z = fc * fp . z + fd * fo . z ; mE = eA ( fp ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mE = clamp ( mE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",h:[{type:"node_in",name:"mF",qualifier:["float"],e:!1},{type:"node_in",name:"mG",qualifier:["vec3"],e:!1},{type:"node_in",name:"mH",qualifier:["vec3"],e:!1},{type:"node_out",name:"mI",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mI = mG ; fo = ew ( mH ) ; if ( fo . y != ZERO_VALUE_NODES ) { fp = ew ( mI ) ; fp . x = fo . x ; fp . y = fo . y ; fn = eA ( fp ) ; mI = mix ( mI , fn , fd ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mI = clamp ( mI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",h:[{type:"node_in",name:"mJ",qualifier:["float"],e:!1},{type:"node_in",name:"mK",qualifier:["vec3"],e:!1},{type:"node_in",name:"mL",qualifier:["vec3"],e:!1},{type:"node_out",name:"mM",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fc = UNITY_VALUE_NODES - fd ; fn = mL + mK - mL * mK ; mM = mK * ( vec3 ( fc ) + vec3 ( fd ) * ( ( en - mK ) * mL + fn ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mM = clamp ( mM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",h:[{type:"node_in",name:"mN",qualifier:["float"],e:!1},{type:"node_in",name:"mO",qualifier:["vec3"],e:!1},{type:"node_in",name:"mP",qualifier:["vec3"],e:!1},{type:"node_out",name:"mQ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mQ = mO + fd * ( 2.0 * mP - en ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mQ = clamp ( mQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",h:[{type:"node_in",name:"mR",qualifier:["vec3"],e:!1},{type:"node_in",name:"mS",qualifier:["float"],e:!1}],g:[{type:"textline",b:"eT = mR ; eX = mS ;".split(" ")}]},{type:"node",name:"MATERIAL_BEGIN",h:[{type:"node_in",name:"mT",qualifier:["vec3"],e:!1},{type:"node_in",name:"mU",qualifier:["vec3"],e:!1},{type:"node_in",
name:"mV",qualifier:["float"],e:!1},{type:"node_in",name:"mW",qualifier:["vec3"],e:!0},{type:"node_in",name:"mX",qualifier:["float"],e:!0},{type:"node_out",name:"mY",qualifier:["vec3"],e:!1},{type:"node_out",name:"mZ",qualifier:["vec3"],e:!1},{type:"node_out",name:"m_",qualifier:["vec3"],e:!1},{type:"node_out",name:"na",qualifier:["vec3"],e:!1},{type:"node_out",name:"nb",qualifier:["vec3"],e:!1},{type:"node_out",name:"nc",qualifier:["vec2"],e:!1},{type:"node_out",name:"nd",qualifier:["vec2"],e:!1},
{type:"node_out",name:"ne",qualifier:["float"],e:!1},{type:"node_param",name:"eO",qualifier:["const","vec2"]},{type:"node_param",name:"eP",qualifier:["const","vec3"]}],g:[{type:"textline",b:"m_ = clamp ( mT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",b:"na = eP [ 0 ] * clamp ( mU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATERIAL_EXT"],g:[{type:"textline",b:"mY = mX * m_ ;".split(" ")}]},{type:"node_else",g:[{type:"textline",
b:"mY = e_ * m_ ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:["m_","*=","mV",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],g:[{type:"textline",b:"nb = normalize ( mW ) ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["nb","=","fm",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["SHADELESS_MAT",{type:"logic_negative_expr",d:1},"NODES_GLOW",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",
d:2}],g:[{type:"textline",b:"mZ = fa * u_environment_energy * dW ( nb ) ; ne = dz ( m_ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],g:[{type:"textline",b:"nc = vec2 ( eO [ 0 ] , eO [ 1 ] ) ;".split(" ")},{type:"textline",b:"nd = vec2 ( eP [ 1 ] , eP [ 2 ] ) ;".split(" ")}]}]},{type:"textline",b:["eW","=","ne",";"]}]}]}]},{type:"node",name:"MATERIAL_END",h:[{type:"node_in",name:"nf",qualifier:["vec4"],e:!1},{type:"node_in",name:"ng",qualifier:["vec3"],
e:!1},{type:"node_in",name:"nh",qualifier:["vec3"],e:!1},{type:"node_in",name:"ni",qualifier:["float"],e:!0},{type:"node_in",name:"nj",qualifier:["float"],e:!0},{type:"node_in",name:"nk",qualifier:["float"],e:!0},{type:"node_out",name:"nl",qualifier:["vec3"],e:!0},{type:"node_out",name:"nm",qualifier:["float"],e:!0},{type:"node_out",name:"nn",qualifier:["vec3"],e:!0},{type:"node_out",name:"no",qualifier:["vec3"],e:!0},{type:"node_out",name:"np",qualifier:["vec3"],e:!0},{type:"node_param",name:"eQ",
qualifier:["float"]},{type:"node_param",name:"eR",qualifier:["float"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nl"],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:"nl = nf . rgb ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["nl","=","em",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["MATERIAL_EXT","REFLECTION_TYPE","REFL_NONE",{type:"non_equal_expr",d:2},{type:"logical_and_expr",d:2}],g:[{type:"textline",b:"dT ( nl , eS , nh , ni ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:["nl","+=","ng",";"]}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nn"],g:[{type:"textline",b:["nn","=","nh",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["MATERIAL_EXT"],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_no"],g:[{type:"textline",b:"no = nf . rgb ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_np"],g:[{type:"textline",b:["np","=","ng",
";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nm"],g:[{type:"textline",b:"nm = clamp ( nk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"fd = max ( max ( ng . r , ng . g ) , ng . b ) * nj ; nm = clamp ( nk * ( UNITY_VALUE_NODES - fd ) + fd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]}]},{type:"node_else",g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nm"],
g:[{type:"textline",b:"nm = clamp ( eQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"fd = max ( max ( ng . r , ng . g ) , ng . b ) * eR ; nm = eQ * ( UNITY_VALUE_NODES - fd ) + fd ;".split(" ")}]}]}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:["eU","=","ng",";"]}]},{type:"node_else",g:[{type:"textline",b:["eU","=","em",";"]}]}]},{type:"textline",
b:["eV","=","nh",";"]}]},{type:"node",name:"LIGHTING_AMBIENT",h:[{type:"node_in",name:"nq",qualifier:["vec3"],e:!1},{type:"node_in",name:"nr",qualifier:["vec3"],e:!1},{type:"node_in",name:"ns",qualifier:["vec3"],e:!1},{type:"node_out",name:"nt",qualifier:["vec4"],e:!1},{type:"node_out",name:"nu",qualifier:["vec3"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["SHADELESS_MAT",{type:"logic_negative_expr",d:1},"NODES_GLOW",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],g:[{type:"textline",
b:"nt = vec4 ( nq + ns * nr , ZERO_VALUE_NODES ) ; nu = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"nt = vec4 ( ns , ZERO_VALUE_NODES ) ; nu = em ;".split(" ")}]}]}]},{type:"node",name:"LIGHTING_LAMP",h:[{type:"node_in",name:"nv",qualifier:["float"],e:!1},{type:"node_out",name:"nw",qualifier:["vec3"],e:!1},{type:"node_out",name:"nx",qualifier:["vec2"],e:!1},{type:"node_out",name:"ny",qualifier:["vec3"],e:!1},{type:"node_out",name:"nz",qualifier:["float"],e:!1}],
g:[{type:"node_condition",a:[{type:"node_if",c:["NODES_GLOW",{type:"logic_negative_expr",d:1},"NUM_LIGHTS",0,{type:"g_expr",d:2},{type:"logical_and_expr",d:2}],g:[{type:"textline",b:"nx = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","HEMI",{type:"equal_expr",d:2}],g:[{type:"textline",b:["nz","=","el",";"]}]},{type:"node_else",g:[{type:"textline",b:["nz","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",b:"ny = u_light_color_intensities [ LAMP_IND ] ; if ( LAMP_SHADOW_MAP_IND != - 1 ) ny *= nv ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2},"LAMP_TYPE","POINT",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],g:[{type:"textline",b:"fn = u_light_positions [ LAMP_IND ] ; nw = fn - fl ;".split(" ")},{type:"textline",b:"fd = length ( nw ) ; ny *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + fd * fd ) ; nw = normalize ( nw ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2}],g:[{type:"textline",b:"fn = u_light_directions [ LAMP_IND ] ; fd = dot ( nw , fn ) ; fd *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( fd - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; ny *= fd ;".split(" ")}]}]}]},
{type:"node_else",g:[{type:"textline",b:"nw = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",h:[{type:"node_in",name:"nA",qualifier:["vec3"],e:!1},{type:"node_in",name:"nB",qualifier:["vec2"],e:!1},{type:"node_in",name:"nC",qualifier:["vec3"],e:!1},{type:"node_in",name:"nD",qualifier:["float"],e:!1},{type:"node_in",name:"nE",qualifier:["vec2"],e:!1},{type:"node_out",name:"nF",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nF = ZERO_VALUE_NODES ; if ( nB . r != ZERO_VALUE_NODES ) { fd = ( UNITY_VALUE_NODES - nD ) * dot ( nC , nA ) + nD ; if ( nE [ 0 ] == ZERO_VALUE_NODES ) { nF = UNITY_VALUE_NODES ; } else { fd = UNITY_VALUE_NODES + abs ( fd ) ; fd = nE [ 1 ] + ( UNITY_VALUE_NODES - nE [ 1 ] ) * pow ( fd , nE [ 0 ] ) ; nF = clamp ( fd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } nF = max ( nF , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_LAMBERT",h:[{type:"node_in",name:"nG",qualifier:["vec3"],e:!1},{type:"node_in",name:"nH",qualifier:["vec2"],e:!1},{type:"node_in",name:"nI",qualifier:["vec3"],e:!1},{type:"node_in",name:"nJ",qualifier:["float"],e:!1},{type:"node_out",name:"nK",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nK = ZERO_VALUE_NODES ; if ( nH . r != ZERO_VALUE_NODES ) { fd = ( UNITY_VALUE_NODES - nJ ) * dot ( nI , nG ) + nJ ; nK = max ( fd , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",
name:"DIFFUSE_OREN_NAYAR",h:[{type:"node_in",name:"nL",qualifier:["vec3"],e:!1},{type:"node_in",name:"nM",qualifier:["vec2"],e:!1},{type:"node_in",name:"nN",qualifier:["vec3"],e:!1},{type:"node_in",name:"nO",qualifier:["float"],e:!1},{type:"node_in",name:"nP",qualifier:["vec2"],e:!1},{type:"node_out",name:"nQ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nQ = ZERO_VALUE_NODES ; if ( nM . r != ZERO_VALUE_NODES ) { fd = ( UNITY_VALUE_NODES - nO ) * dot ( nN , nL ) + nO ; if ( nP [ 0 ] > ZERO_VALUE_NODES ) { fc = max ( dot ( nN , eS ) , ZERO_VALUE_NODES ) ; fb = nP [ 0 ] * nP [ 0 ] ; fe = UNITY_VALUE_NODES - el * ( fb / ( fb + 0.33 ) ) ; fn = nL - fd * nN ; fp = eS - fc * nN ;".split(" ")},
{type:"textline",b:"if ( length ( fn ) == ZERO_VALUE_NODES || length ( fp ) == ZERO_VALUE_NODES || abs ( fd ) > UNITY_VALUE_NODES || abs ( fc ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",b:"nQ = fd * fe ; else { ff = acos ( fd ) ; fc = acos ( fc ) ; fn = normalize ( fn ) ; fp = normalize ( fp ) ; fg = max ( ff , fc ) ; fh = min ( ff , fc ) ; fh *= 0.95 ; fc = max ( dot ( fn , fp ) , ZERO_VALUE_NODES ) ; fb = 0.45 * ( fb / ( fb + 0.09 ) ) ; nQ = fd * ( fe + ( fb * fc * sin ( fg ) * tan ( fh ) ) ) ; } } else nQ = fd ; nQ = max ( nQ , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",h:[{type:"node_in",name:"nR",qualifier:["vec3"],e:!1},{type:"node_in",name:"nS",qualifier:["vec2"],e:!1},{type:"node_in",name:"nT",qualifier:["vec3"],e:!1},{type:"node_in",name:"nU",qualifier:["float"],e:!1},{type:"node_in",name:"nV",qualifier:["vec2"],e:!1},{type:"node_out",name:"nW",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nW = ZERO_VALUE_NODES ; if ( nS . r != ZERO_VALUE_NODES ) { fd = ( UNITY_VALUE_NODES - nU ) * dot ( nT , nR ) + nU ; fh = max ( dot ( nT , eS ) , ZERO_VALUE_NODES ) ; if ( nV [ 0 ] <= UNITY_VALUE_NODES ) nW = fd * pow ( max ( fh * fd , 0.1 ) , nV [ 0 ] - UNITY_VALUE_NODES ) ; else nW = fd * pow ( 1.0001 - fh , nV [ 0 ] - UNITY_VALUE_NODES ) ; nW = max ( nW , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",h:[{type:"node_in",name:"nX",qualifier:["vec3"],e:!1},{type:"node_in",name:"nY",qualifier:["vec2"],e:!1},{type:"node_in",name:"nZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"n_",qualifier:["float"],e:!1},{type:"node_in",name:"oa",qualifier:["vec2"],e:!1},{type:"node_out",name:"ob",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ob = ZERO_VALUE_NODES ; if ( nY . r != ZERO_VALUE_NODES ) { fh = ( UNITY_VALUE_NODES - n_ ) * dot ( nZ , nX ) + n_ ; fh = acos ( fh ) ; if ( fh < oa [ 0 ] ) ob = UNITY_VALUE_NODES ; else if ( fh > ( oa [ 0 ] + oa [ 1 ] ) || oa [ 1 ] == ZERO_VALUE_NODES ) ob = ZERO_VALUE_NODES ; else ob = UNITY_VALUE_NODES - ( ( fh - oa [ 0 ] ) / oa [ 1 ] ) ; ob = max ( ob , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",h:[{type:"node_in",name:"oc",qualifier:["vec3"],e:!1},{type:"node_in",name:"od",qualifier:["vec2"],e:!1},{type:"node_in",name:"oe",qualifier:["vec3"],e:!1},{type:"node_in",name:"of",qualifier:["float"],e:!1},{type:"node_in",name:"og",qualifier:["vec2"],e:!1},{type:"node_out",name:"oh",qualifier:["float"],e:!1}],g:[{type:"textline",b:"oh = ZERO_VALUE_NODES ; if ( od . g == UNITY_VALUE_NODES ) { fp = normalize ( oc + eS ) ; oh = ( UNITY_VALUE_NODES - of ) * max ( dot ( oe , fp ) , ZERO_VALUE_NODES ) + of ; oh = pow ( oh , og [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",h:[{type:"node_in",name:"oi",qualifier:["vec3"],e:!1},{type:"node_in",name:"oj",qualifier:["vec2"],e:!1},{type:"node_in",name:"ok",qualifier:["vec3"],e:!1},{type:"node_in",name:"ol",qualifier:["vec2"],e:!1},{type:"node_out",name:"om",qualifier:["float"],e:!1}],g:[{type:"textline",b:"om = ZERO_VALUE_NODES ; if ( oj . g == UNITY_VALUE_NODES ) { fp = normalize ( oi + eS ) ; fh = max ( dot ( ok , fp ) , 0.001 ) ;".split(" ")},{type:"textline",b:"fd = max ( dot ( ok , eS ) , 0.01 ) ; fg = max ( dot ( ok , oi ) , 0.01 ) ; fh = tan ( acos ( fh ) ) ; fc = max ( ol [ 0 ] , 0.001 ) ; om = fg * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * fc * fc ) ) * ( exp ( - ( fh * fh ) / ( fc * fc ) ) / ( sqrt ( fd * fg ) ) ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_TOON",h:[{type:"node_in",name:"on",qualifier:["vec3"],e:!1},{type:"node_in",name:"oo",qualifier:["vec2"],e:!1},{type:"node_in",name:"op",qualifier:["vec3"],e:!1},{type:"node_in",name:"oq",qualifier:["vec2"],e:!1},{type:"node_out",name:"or",qualifier:["float"],e:!1}],g:[{type:"textline",b:"or = ZERO_VALUE_NODES ; if ( oo . g == UNITY_VALUE_NODES ) { fp = normalize ( on + eS ) ; fg = acos ( dot ( fp , op ) ) ; if ( fg < oq [ 0 ] ) or = UNITY_VALUE_NODES ; else if ( fg >= oq [ 0 ] + oq [ 1 ] || oq [ 1 ] == ZERO_VALUE_NODES ) or = ZERO_VALUE_NODES ; else or = UNITY_VALUE_NODES - ( fg - oq [ 0 ] ) / oq [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",h:[{type:"node_in",name:"os",qualifier:["vec3"],e:!1},{type:"node_in",name:"ot",qualifier:["vec2"],e:!1},{type:"node_in",name:"ou",qualifier:["vec3"],e:!1},{type:"node_in",name:"ov",qualifier:["float"],e:!1},{type:"node_in",name:"ow",qualifier:["vec2"],e:!1},{type:"node_out",name:"ox",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ox = ZERO_VALUE_NODES ; if ( ot . g == UNITY_VALUE_NODES ) { if ( ow [ 0 ] < 1.0 || ow [ 1 ] == ZERO_VALUE_NODES ) ox = ZERO_VALUE_NODES ; else { if ( ow [ 1 ] < 100.0 ) ow [ 1 ] = sqrt ( 1.0 / ow [ 1 ] ) ; else ow [ 1 ] = 10.0 / ow [ 1 ] ; fp = normalize ( eS + os ) ; fg = ( UNITY_VALUE_NODES - ov ) * max ( dot ( ou , fp ) , ZERO_VALUE_NODES ) + ov ; if ( fg < ZERO_VALUE_NODES ) ox = ZERO_VALUE_NODES ; else { fd = max ( dot ( ou , eS ) , 0.01 ) ; fc = dot ( ou , os ) ; if ( fc <= 0.01 ) ox = ZERO_VALUE_NODES ; else { fh = max ( dot ( eS , fp ) , 0.01 ) ; fb = UNITY_VALUE_NODES ; fd = ( 2.0 * fg * fd ) / fh ; fc = ( 2.0 * fg * fc ) / fh ; fc = min ( min ( fb , fd ) , fc ) ; fd = sqrt ( pow ( ow [ 0 ] , 2.0 ) + pow ( fh , 2.0 ) - UNITY_VALUE_NODES ) ; fh = pow ( fd - fh , 2.0 ) / pow ( fd + fh , 2.0 ) * ( UNITY_VALUE_NODES + pow ( fh * ( fd + fh ) - UNITY_VALUE_NODES , 2.0 ) / pow ( fh * ( fd - fh ) + UNITY_VALUE_NODES , 2.0 ) ) ; fg = acos ( fg ) ; ox = max ( fh * fc * exp ( - pow ( fg , 2.0 ) / ( 2.0 * pow ( ow [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",h:[{type:"node_in",name:"oy",qualifier:["vec4"],e:!1},{type:"node_in",name:"oz",qualifier:["vec3"],e:!1},{type:"node_in",name:"oA",qualifier:["float"],e:!1},{type:"node_in",name:"oB",qualifier:["float"],e:!1},{type:"node_in",name:"oC",qualifier:["vec3"],e:!1},{type:"node_in",name:"oD",qualifier:["vec3"],e:!1},{type:"node_in",name:"oE",qualifier:["vec4"],e:!1},{type:"node_in",name:"oF",qualifier:["vec3"],e:!1},{type:"node_in",name:"oG",qualifier:["vec3"],e:!1},{type:"node_in",
name:"oH",qualifier:["vec3"],e:!1},{type:"node_in",name:"oI",qualifier:["float"],e:!1},{type:"node_out",name:"oJ",qualifier:["vec4"],e:!1},{type:"node_out",name:"oK",qualifier:["vec3"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_NODE_B4W_TRANSLUCENCY"],g:[{type:"textline",b:"if ( dot ( oC , oD ) * dot ( eS , oD ) < ZERO_VALUE_NODES ) { fg = oE . x ; fc = oE . y ; fh = oE . z ; fd = oE . w ;".split(" ")},{type:"textline",b:"fb = clamp ( abs ( dot ( oC , oD ) ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fe = clamp ( dot ( eS , - oC ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fc = pow ( fe , fc ) ;".split(" ")},
{type:"textline",b:"oJ = oy + oI * vec4 ( oH * fb * pow ( oF , vec3 ( fg ) ) , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",b:"oJ += fh * mix ( vec4 ( oF , UNITY_VALUE_NODES ) , vec4 ( UNITY_VALUE_NODES ) , fd ) * oI * vec4 ( oH * fb * vec3 ( fc ) , UNITY_VALUE_NODES ) ; oK = oz ; } else {".split(" ")},{type:"textline",b:"oK = oz + oH * oG * oB ; oJ = oy + vec4 ( oH * oF * oA , oB ) ; }".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"oK = oz + oH * oG * oB ; oJ = oy + vec4 ( oH * oF * oA , oB ) ;".split(" ")}]}]}]},
{type:"node",name:"RGB",h:[{type:"node_out",name:"oL",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"oL = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",h:[{type:"node_in",name:"oM",qualifier:["vec3"],e:!1},{type:"node_out",name:"oN",qualifier:["float"],e:!1}],g:[{type:"textline",b:"oN = dot ( oM , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{type:"node",name:"SEPRGB",h:[{type:"node_in",name:"oO",qualifier:["vec3"],e:!1},{type:"node_out",name:"oP",qualifier:["float"],e:!0},
{type:"node_out",name:"oQ",qualifier:["float"],e:!0},{type:"node_out",name:"oR",qualifier:["float"],e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oP"],g:[{type:"textline",b:"oP = oO . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oQ"],g:[{type:"textline",b:"oQ = oO . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oR"],g:[{type:"textline",b:"oR = oO . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",h:[{type:"node_in",name:"oS",
qualifier:["vec3"],e:!1},{type:"node_out",name:"oT",qualifier:["float"],e:!0},{type:"node_out",name:"oU",qualifier:["float"],e:!0},{type:"node_out",name:"oV",qualifier:["float"],e:!0}],g:[{type:"textline",b:"fp = ew ( oS ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oT"],g:[{type:"textline",b:"oT = fp . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oU"],g:[{type:"textline",b:"oU = fp . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_oV"],g:[{type:"textline",b:"oV = fp . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",h:[{type:"node_in",name:"oW",qualifier:["float"],e:!1},{type:"node_in",name:"oX",qualifier:["float"],e:!1},{type:"node_in",name:"oY",qualifier:["float"],e:!1},{type:"node_out",name:"oZ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"oZ = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( oW - oY ) * oX ) ) ) ;".split(" ")}]},{type:"node",name:"GAMMA",h:[{type:"node_in",name:"o_",
qualifier:["vec3"],e:!1},{type:"node_in",name:"pa",qualifier:["float"],e:!1},{type:"node_out",name:"pb",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"pb = max ( em , o_ ) ; pb = pow ( pb , vec3 ( pa ) ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",h:[{type:"node_in",name:"pc",qualifier:["vec3"],e:!1},{type:"node_out",name:"pd",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"pd = max ( em , pc ) ; pd = pow ( pd , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",
h:[{type:"node_in",name:"pe",qualifier:["vec3"],e:!1},{type:"node_out",name:"pf",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"pf = max ( em , pe ) ; pf = pow ( pf , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_EMPTY",h:[{type:"node_out",name:"pg",qualifier:["vec3"],e:!1},{type:"node_out",name:"ph",qualifier:["vec3"],e:!1},{type:"node_out",name:"pi",qualifier:["float"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pi"],g:[{type:"textline",b:"pg [ 2 ] = pg [ 1 ] = pg [ 0 ] = 0.0 ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pi"],g:[{type:"textline",b:"ph [ 2 ] = ph [ 1 ] = ph [ 0 ] = 0.0 ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pi"],g:[{type:"textline",b:["pi","=","0.0",";"]}]}]}]},{type:"node",name:"TEXTURE_ENVIRONMENT",h:[{type:"node_in",name:"pj",qualifier:["vec3"],e:!1},{type:"node_out",name:"pk",qualifier:["vec3"],e:!0},{type:"node_out",name:"pl",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",
qualifier:["uniform","samplerCube"]}],g:[{type:"textline",b:"fj = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , pj ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pk"],g:[{type:"textline",b:"pk = fj . xyz ; aE ( pk ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pl"],g:[{type:"textline",b:"pl = fj . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",h:[{type:"node_in",name:"pm",qualifier:["vec3"],e:!0},{type:"node_in",name:"pn",qualifier:["vec3"],
e:!0},{type:"node_in",name:"po",qualifier:["vec3"],e:!0},{type:"node_in",name:"pp",qualifier:["vec3"],e:!0},{type:"node_out",name:"pq",qualifier:["vec3"],e:!0},{type:"node_out",name:"pr",qualifier:["float"],e:!0},{type:"node_out",name:"ps",qualifier:["vec3"],e:!0},{type:"node_out",name:"pt",qualifier:["float"],e:!0},{type:"node_out",name:"pu",qualifier:["vec3"],e:!0},{type:"node_out",name:"pv",qualifier:["float"],e:!0},{type:"node_out",name:"pw",qualifier:["vec3"],e:!0},{type:"node_out",name:"px",
qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_COLOR_var_texture , eE ( pm ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pq"],g:[{type:"textline",b:"pq = fj . xyz ; aE ( pq ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pr"],g:[{type:"textline",b:"pr = fj . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_uv2"],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_COLOR_var_texture , eE ( pn ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ps"],g:[{type:"textline",b:"ps = fj . xyz ; aE ( ps ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pt"],g:[{type:"textline",b:"pt = fj . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_COLOR_var_texture , eE ( po ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pu"],g:[{type:"textline",b:"pu = fj . xyz ; aE ( pu ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pv"],g:[{type:"textline",b:"pv = fj . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_COLOR_var_texture , eE ( pp ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pw"],g:[{type:"textline",b:"pw = fj . xyz ; aE ( pw ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_px"],g:[{type:"textline",b:"px = fj . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",h:[{type:"node_in",name:"py",qualifier:["vec3"],e:!0},{type:"node_in",name:"pz",qualifier:["vec3"],e:!0},{type:"node_in",name:"pA",qualifier:["vec3"],e:!0},{type:"node_in",name:"pB",qualifier:["vec3"],e:!0},{type:"node_out",name:"pC",qualifier:["vec3"],e:!0},{type:"node_out",name:"pD",qualifier:["float"],e:!0},{type:"node_out",name:"pE",qualifier:["vec3"],
e:!0},{type:"node_out",name:"pF",qualifier:["float"],e:!0},{type:"node_out",name:"pG",qualifier:["vec3"],e:!0},{type:"node_out",name:"pH",qualifier:["float"],e:!0},{type:"node_out",name:"pI",qualifier:["vec3"],e:!0},{type:"node_out",name:"pJ",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_NORMAL_var_texture , eE ( py ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_pC"],g:[{type:"textline",b:"pC = normalize ( fk * ( fj . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pD"],g:[{type:"textline",b:"pD = fj . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv2"],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_NORMAL_var_texture , eE ( pz ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pE"],g:[{type:"textline",b:"pE = normalize ( fk * ( fj . xyz - 0.5 ) ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pF"],g:[{type:"textline",b:"pF = fj . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_NORMAL_var_texture , eE ( pA ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pG"],g:[{type:"textline",b:"pG = normalize ( fk * ( fj . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pH"],g:[{type:"textline",b:"pH = fj . w ;".split(" ")}]}]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_NORMAL_var_texture , eE ( pB ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pI"],g:[{type:"textline",b:"pI = normalize ( fk * ( fj . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pJ"],g:[{type:"textline",b:"pJ = fj . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",h:[{type:"node_out",name:"pK",qualifier:["float"],e:!1}],
g:[{type:"textline",b:"pK = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",h:[{type:"node_in",name:"pL",qualifier:["vec3"],e:!1},{type:"node_in",name:"pM",qualifier:["vec3"],e:!1},{type:"node_out",name:"pN",qualifier:["vec3"],e:!1},{type:"node_out",name:"pO",qualifier:["float"],e:!0}],g:[{type:"textline",b:"pN = pL + pM ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pO"],g:[{type:"textline",b:"pO = ( abs ( pN [ 0 ] ) + abs ( pN [ 1 ] ) + abs ( pN [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_SUBTRACT",h:[{type:"node_in",name:"pP",qualifier:["vec3"],e:!1},{type:"node_in",name:"pQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"pR",qualifier:["vec3"],e:!1},{type:"node_out",name:"pS",qualifier:["float"],e:!0}],g:[{type:"textline",b:"pR = pP - pQ ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pS"],g:[{type:"textline",b:"pS = ( abs ( pR [ 0 ] ) + abs ( pR [ 1 ] ) + abs ( pR [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",
h:[{type:"node_in",name:"pT",qualifier:["vec3"],e:!1},{type:"node_in",name:"pU",qualifier:["vec3"],e:!1},{type:"node_out",name:"pV",qualifier:["vec3"],e:!1},{type:"node_out",name:"pW",qualifier:["float"],e:!0}],g:[{type:"textline",b:"pV = pT + pU ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pW"],g:[{type:"textline",b:"pW = length ( pV ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pV"],g:[{type:"textline",b:"pV = normalize ( pV ) ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_DOT_PRODUCT",h:[{type:"node_in",name:"pX",qualifier:["vec3"],e:!1},{type:"node_in",name:"pY",qualifier:["vec3"],e:!1},{type:"node_out",name:"pZ",qualifier:["vec3"],e:!1},{type:"node_out",name:"p_",qualifier:["float"],e:!0}],g:[{type:"textline",b:["pZ","=","em",";"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_p_"],g:[{type:"textline",b:"p_ = dot ( pX , pY ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",h:[{type:"node_in",name:"qa",qualifier:["vec3"],
e:!1},{type:"node_in",name:"qb",qualifier:["vec3"],e:!1},{type:"node_out",name:"qc",qualifier:["vec3"],e:!1},{type:"node_out",name:"qd",qualifier:["float"],e:!0}],g:[{type:"textline",b:"qc = cross ( qa , qb ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qd"],g:[{type:"textline",b:"qd = length ( qc ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",h:[{type:"node_in",name:"qe",qualifier:["vec3"],e:!1},{type:"node_in",name:"qf",qualifier:["vec3"],e:!1},{type:"node_out",
name:"qg",qualifier:["vec3"],e:!1},{type:"node_out",name:"qh",qualifier:["float"],e:!0}],g:[{type:"textline",b:"qg = normalize ( qe ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qh"],g:[{type:"textline",b:"qh = length ( qe ) ;".split(" ")}]}]},{type:"textline",b:["qf",";"]}]},{type:"node",name:"B4W_REFLECT",h:[{type:"node_in",name:"qi",qualifier:["vec3"],e:!1},{type:"node_in",name:"qj",qualifier:["vec3"],e:!1},{type:"node_out",name:"qk",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"qk = reflect ( - qi , qj ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",h:[{type:"node_in",name:"ql",qualifier:["vec3"],e:!1},{type:"node_in",name:"qm",qualifier:["float"],e:!1},{type:"node_in",name:"qn",qualifier:["const","float"],e:!1},{type:"node_in",name:"qo",qualifier:["const","float"],e:!1},{type:"node_out",name:"qp",qualifier:["vec3"],e:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"fc = length ( fi ) ; if ( fc < qo ) { eY = eE ( ql ) ; fc = clamp ( 0.5 * ( qo - fc ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fc = qm * fc ;".split(" ")},
{type:"textline",b:"fp = normalize ( eS * fk ) ;".split(" ")},{type:"textline",b:"fb = UNITY_VALUE_NODES / qn ;".split(" ")},{type:"textline",b:"eZ = fp . xy * fc / ( qn * fp . z ) ; fc = UNITY_VALUE_NODES ; fd = texture2D ( node_B4W_PARALLAX_var_texture , eY ) . a ;".split(" ")},{type:"textline",b:"for ( float qq = 1.0 ; qq <= qn ; qq ++ ) { if ( fd < fc ) { fc -= fb ; eY -= eZ ; fd = texture2D ( node_B4W_PARALLAX_var_texture , eY ) . a ; } }".split(" ")},{type:"textline",b:"eZ = eY + eZ ; fb = texture2D ( node_B4W_PARALLAX_var_texture , eZ ) . a - ( fc + fb ) ; fc = fd - fc ; fb = fc / ( fc - fb ) ;".split(" ")},
{type:"textline",b:"eY = fb * eZ + ( UNITY_VALUE_NODES - fb ) * eY ; qp = eC ( eY ) ; } else qp = ql ;".split(" ")}]},{type:"node",name:"B4W_CLAMP",h:[{type:"node_in",name:"qr",qualifier:["vec3"],e:!1},{type:"node_out",name:"qs",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"qs = clamp ( qr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",h:[{type:"node_in",name:"qt",qualifier:["vec3"],e:!1},{type:"node_in",name:"qu",qualifier:["float"],e:!1},{type:"node_out",
name:"qv",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"qv = er ( qt , qu ) ;".split(" ")}]},{type:"node",name:"B4W_TRANSLUCENCY",h:[{type:"node_in",name:"qw",qualifier:["float"],e:!1},{type:"node_in",name:"qx",qualifier:["float"],e:!1},{type:"node_in",name:"qy",qualifier:["float"],e:!1},{type:"node_in",name:"qz",qualifier:["float"],e:!1},{type:"node_in",name:"qA",qualifier:["float"],e:!1},{type:"node_out",name:"qB",qualifier:["float"],e:!0},{type:"node_out",name:"qC",qualifier:["vec4"],e:!0}],
g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qB"],g:[{type:"textline",b:["qB","=","qw",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qC"],g:[{type:"textline",b:"qC = vec4 ( qx , qy , qz , qA ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",h:[{type:"node_out",name:"qD",qualifier:["float"],e:!1}],g:[{type:"textline",b:["qD","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",h:[{type:"node_in",name:"qE",qualifier:["float"],e:!1},{type:"node_in",name:"qF",qualifier:["float"],
e:!1},{type:"node_in",name:"qG",qualifier:["float"],e:!1},{type:"node_out",name:"qH",qualifier:["float"],e:!1}],g:[{type:"textline",b:"qH = smoothstep ( qF , qG , qE ) ;".split(" ")}]},{type:"node",name:"B4W_GLOW_OUTPUT",h:[{type:"node_in",name:"qI",qualifier:["vec3"],e:!1},{type:"node_in",name:"qJ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"eT = qI ; eX = qJ ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",h:[{type:"node_in",name:"qK",qualifier:["vec3"],e:!1},{type:"node_out",name:"qL",
qualifier:["float"],e:!1}],g:[{type:"textline",b:"qL = ( qK . r + qK . g + qK . b ) / 3.0 ;".split(" ")}]},{type:"node",name:"B4W_SCALTOVEC",h:[{type:"node_in",name:"qM",qualifier:["float"],e:!1},{type:"node_out",name:"qN",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"qN [ 0 ] = qM ; qN [ 1 ] = qM ; qN [ 2 ] = qM ;".split(" ")}]},{type:"nodes_global"},{type:"textline",b:"void qO ( in vec3 eS , out vec3 eT , out vec3 eU , out vec3 eV , out float eW , out float eX ) { vec2 eY , eZ ; float e_ , fa , fb , fc , fd , fe , ff , fg , fh ; vec4 fi , fj ; mat3 fk ; vec3 fl , fm , fn , fo , fp ; eT = em ; eU = em ; eV = em ; eW = ZERO_VALUE_NODES ; eX = ZERO_VALUE_NODES ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["fl","=","bw",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) fl = fl ; else fl = - fl ;".split(" ")}]}}]},{type:"textline",b:"fm = normalize ( fl ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],
group:{type:"group",a:[{type:"textline",b:"fn = cross ( fl , bx . xyz ) * bx . w ; fk = mat3 ( bx . xyz , fn , fl ) ; fk = fk ;".split(" ")}]}}]},{type:"textline",b:"fl = bu ; fi = bv ; e_ = u_emit ; fa = u_ambient ;".split(" ")},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 qP = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",d:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 qV ( vec3 qQ , mat4 qR ) { vec3 qS , qT , qU ; qS = vec3 ( qR [ 0 ] [ 0 ] , qR [ 1 ] [ 0 ] , qR [ 2 ] [ 0 ] ) ; qT = vec3 ( qR [ 0 ] [ 1 ] , qR [ 1 ] [ 1 ] , qR [ 2 ] [ 1 ] ) ; qU = vec3 ( qR [ 0 ] [ 2 ] , qR [ 1 ] [ 2 ] , qR [ 2 ] [ 2 ] ) ; qT = cross ( qU , qS ) ; qS = normalize ( qS ) ; qT = normalize ( qT ) ; qU = normalize ( qU ) ; return mat4 ( vec4 ( qS , 0.0 ) , vec4 ( qT , 0.0 ) , vec4 ( qU , 0.0 ) , vec4 ( qQ , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 ra ( vec3 qW , vec3 qX ) { vec3 qY , qZ , q_ ; qY = qW - qX ; qY . y = 0.0 ; qZ = cross ( qP , qY ) ; q_ = cross ( qY , qZ ) ; qZ = normalize ( qZ ) ; q_ = normalize ( q_ ) ; qY = normalize ( qY ) ; return mat4 ( vec4 ( qZ , 0.0 ) , vec4 ( q_ , 0.0 ) , vec4 ( qY , 0.0 ) , vec4 ( qX , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 ri ( in vec3 rb , float rc , float rd , float re , vec3 rf ) { float rg , rh ; rg = fract ( length ( rf ) / 0.17 ) ; rh = re + rg / 10.0 ; rg = rg ; if ( re != 0.0 ) rg /= re ; rb *= 1.0 + 0.5 * sin ( rc ) ; rg = length ( rb ) * rd * sin ( 2.0 * 3.14 * rc * rh + rg ) ; return bl ( rg ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 rq ( in vec3 rj , in vec3 rk , in mat4 rl ) { vec3 rm ; float rn , ro ; mat4 rp ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",d:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"rp = qV ( rk , rl ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",
b:"rn = fract ( ( rk . x * 1.43 + rk . y * 0.123 + rk . z * 6.1 ) ) ; rn = 2.0 * M_PI * rn ; rm = normalize ( vec3 ( rl [ 0 ] [ 2 ] , 0.0 , rl [ 2 ] [ 2 ] ) ) ; ro = acos ( rm [ 2 ] ) ; if ( rm [ 0 ] < 0.0 ) ro = 2.0 * M_PI - ro ; ro = ro - rn ; if ( ro < 0.0 ) ro = 2.0 * M_PI + ro ; rn = rn ; if ( ro <= MAX_BILLBOARD_ANGLE ) rn += ro ; else if ( ro <= M_PI - MAX_BILLBOARD_ANGLE ) rn += MAX_BILLBOARD_ANGLE * ( 2.0 * ro - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( ro <= M_PI + MAX_BILLBOARD_ANGLE ) rn += ro - M_PI ; else if ( ro <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) rn += MAX_BILLBOARD_ANGLE * ( 2.0 * ro - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else rn += ro - 2.0 * M_PI ; rp = bj ( rn ) ; rp [ 3 ] = vec4 ( rk , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"rp = ra ( rj , rk ) ;".split(" ")}]}}]},{type:"textline",b:["return","rp",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 rw ( in vec3 rr , in vec3 rs , in mat4 rt , mat4 ru ) { mat4 rv ; rv = rq ( rr , rs , rt ) ; ru [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; rv = rv * ru ; return rv ; }".split(" ")}]}}]},
{type:"textline",b:"aM rD ( in vec3 rx , in vec3 ry , in vec3 rz , in vec3 rA , in vec3 rB , in mat4 rC ) { rx = ( rC * vec4 ( rx , 1.0 ) ) . xyz ; ry = ( rC * vec4 ( ry , 1.0 ) ) . xyz ; rz = ( rC * vec4 ( rz , 0.0 ) ) . xyz ; rA = ( rC * vec4 ( rA , 0.0 ) ) . xyz ; rB = ( rC * vec4 ( rB , 0.0 ) ) . xyz ; return bn ( aM ( rx , ry , rz , rA , rB , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 rG ( vec2 rE , vec3 rF ) { return ( rE + 0.5 ) * rF . xy - 0.5 ; }".split(" ")}]};
a["include/skin.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 rN ( in vec4 rH , in vec4 rI , in float rJ ) { float rK , rL , rM ; rK = rH [ 0 ] * rI [ 0 ] + rH [ 1 ] * rI [ 1 ] + rH [ 2 ] * rI [ 2 ] + rH [ 3 ] * rI [ 3 ] ; if ( rK < 0.0 ) { rI *= - 1.0 ; rK = - rK ; } if ( abs ( rK ) >= 1.0 ) return rH ; rL = acos ( rK ) ; rK = sqrt ( 1.0 - rK * rK ) ; if ( abs ( rK ) < 0.001 ) return vec4 ( rH * 0.5 + rI * 0.5 ) ; rM = sin ( ( 1.0 - rJ ) * rL ) / rK ; rK = sin ( rJ * rL ) / rK ; return rH * rM + rI * rK ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 rZ ( in vec3 rO , in vec4 rP , in vec4 rQ , in vec4 rR , in vec4 rS , in float rT ) { vec4 rU , rV ; vec3 rW , rX , rY ; rW = aZ ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rO , 1.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"rU = rN ( rP , rQ , rT ) ; rV = mix ( rR , rS , rT ) ; rX = aS ( rU , rW ) ; rX = rX * rV . w + rV . xyz ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"rY = aS ( rP , rW ) ; rW = aS ( rQ , rW ) ; rY = rY * rR . w + rR . xyz ; rW = rW * rS . w + rS . xyz ; rX = mix ( rY , rW , rT ) ;".split(" ")}]}}]},{type:"textline",b:"return be ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rX , 1.0 ) ) ; } vec3 sh ( in vec3 r_ , in vec4 sa , in vec4 sb , in float sc ) { vec4 sd ; vec3 se , sf , sg ; se = aZ ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( r_ , 0.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"sd = rN ( sa , sb , sc ) ; sf = aS ( sd , se ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"sg = aS ( sa , se ) ; se = aS ( sb , se ) ; sf = mix ( sg , se , sc ) ;".split(" ")}]}}]},{type:"textline",b:"return be ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sf , 0.0 ) ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 rZ ( in vec3 si , in vec4 sj , in vec4 sk ) { vec3 sl ; sl = aZ ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( si , 1.0 ) ) ; sl = aS ( sj , sl ) ; sl = sl * sk . w + sk . xyz ; return be ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sl , 1.0 ) ) ; } vec3 sh ( in vec3 sm , in vec4 sn ) { vec3 so ; so = aZ ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sm , 0.0 ) ) ; so = aS ( sn , so ) ; return be ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( so , 0.0 ) ) ; }".split(" ")}]}}]},
{type:"textline",b:"void sD ( inout vec3 sp , inout vec3 sq , inout vec3 sr , inout vec3 ss ) { int st , su ; vec4 sv ; vec3 sw , sx , sy , sz ; float sA , sB ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["sA","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { sw = vec3 ( 0.0 , 0.0 , 0.0 ) ; sx = vec3 ( 0.0 , 0.0 , 0.0 ) ; sy = vec3 ( 0.0 , 0.0 , 0.0 ) ; sz = vec3 ( 0.0 , 0.0 , 0.0 ) ; sv = a_influence ; for ( int sC = 0 ; sC < 4 ; sC ++ ) { st = int ( sv [ sC ] ) ; sB = fract ( sv [ sC ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"sw += sB * rZ ( sp , u_quatsb [ st ] , u_quatsa [ st ] , u_transb [ st ] , u_transa [ st ] , sA ) ; sx += sB * sh ( sq , u_quatsb [ st ] , u_quatsa [ st ] , sA ) ; sy += sB * sh ( sr , u_quatsb [ st ] , u_quatsa [ st ] , sA ) ; sz += sB * sh ( ss , u_quatsb [ st ] , u_quatsa [ st ] , sA ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"sw += sB * rZ ( sp , u_quatsb [ st ] , u_transb [ st ] ) ; sx += sB * sh ( sq , u_quatsb [ st ] ) ; sy += sB * sh ( sr , u_quatsb [ st ] ) ; sz += sB * sh ( ss , u_quatsb [ st ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} sp = sw ; sq = sx ; sr = sy ; ss = sz ; } if ( ! ( a_influence . y > 0.0 ) ) { su = int ( a_influence [ 0 ] - 1.0 ) ; if ( su > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"sp = rZ ( sp , u_quatsb [ su ] , u_quatsa [ su ] , u_transb [ su ] , u_transa [ su ] , sA ) ; sq = sh ( sq , u_quatsb [ su ] , u_quatsa [ su ] , sA ) ; sr = sh ( sr , u_quatsb [ su ] , u_quatsa [ su ] , sA ) ; ss = sh ( ss , u_quatsb [ su ] , u_quatsa [ su ] , sA ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"sp = rZ ( sp , u_quatsb [ su ] , u_transb [ su ] ) ; sq = sh ( sq , u_quatsb [ su ] ) ; sr = sh ( sr , u_quatsb [ su ] ) ; ss = sh ( ss , u_quatsb [ su ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void sO ( inout vec3 sE , in vec3 sF , in float sG , in float sH , in float sI , in vec3 sJ , in float sK ) { vec3 sL ; float sM , sN ; sM = length ( sF ) ; sN = sH * ( 1.0 + 0.1 * fract ( sM ) ) ; sM = sG * sK * ( 1.0 + sin ( 2.0 * 3.14 * sI * sN + sM ) ) ; sN = ( sE . y - sF . y ) * abs ( sM ) ; sN += 1.0 ; sN *= sN ; sN = sN * sN - sN ; sL = sE ; sL . xz += sJ . xz * sN * sign ( sM ) ; sL = sL - sF ; if ( all ( equal ( sL , vec3 ( 0.0 ) ) ) ) sE = sF ; else { sM = length ( sE - sF ) ; sE = sF + normalize ( sL ) * sM ; } }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 sQ ( vec4 sP ) { return sP * sP * ( 3.0 - 2.0 * sP ) ; } vec4 sS ( vec4 sR ) { return abs ( fract ( sR + 0.5 ) * 2.0 - 1.0 ) ; } vec4 sU ( vec4 sT ) { return sQ ( sS ( sT ) ) ; } void tk ( inout vec3 sV , in float sW , in vec3 sX , in vec3 sY , in vec3 sZ , in float s_ , in float ta , in float tb , in vec3 tc ) { vec3 td ; vec4 te ; vec2 tf , tg ; float th , ti , tj ; th = dot ( sZ , vec3 ( 1.0 ) ) ; ti = th + tc . g ; tj = dot ( sV , vec3 ( tc . g ) ) ; tf = ( sW + vec2 ( tj , ti ) ) ; te = ( ( fract ( ( tf . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( sY ) * s_ ; te = sU ( te ) ; tg = te . xz + te . yw ; tg . y = 0.5 - tg . y ; td = tg . xyx * tc . rbr * vec3 ( ta * sX . x , tb , ta * sX . z ) ; sV += td ; }".split(" ")}]}}]},
{type:"textline",b:"void tr ( inout vec3 tl , inout vec3 tm , in vec3 tn ) { vec3 to , tp , tq ; to = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"tp = tm ; tq = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tp = tl ; tq = tm ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"tk ( tp , u_time , tn , to , tq , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"sO ( tp , tq , au_wind_bending_amp , au_wind_bending_freq , u_time , to , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"sO ( tp , tq , au_wind_bending_amp , au_wind_bending_freq , u_time , to , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"tl += tp - tm ; tm = tp ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tl = tp ; tm = tq ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/nodes.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_orco_tex_coord ; varying vec3 ek ;".split(" ")}]}}]},
{type:"node",name:"TEX_COORD_UV",h:[{type:"node_param",name:"node_TEX_COORD_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eM",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["eM","=","node_TEX_COORD_UV_var_a_uv",";"]}]},{type:"node",name:"UV_MERGED",h:[{type:"node_param",name:"node_UV_MERGED_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eL",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["eL","=","node_UV_MERGED_var_a_uv",";"]}]},{type:"node",
name:"UVMAP",h:[{type:"node_param",name:"node_UVMAP_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eN",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["eN","=","node_UVMAP_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_UV",h:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eF",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["eF","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",h:[{type:"node_param",
name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"ts",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["ts","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",h:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"tt",qualifier:["varying","float"]}],g:[{type:"textline",b:["tt","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",
h:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"tu",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["tu","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",h:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"tv",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["tv","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},
{type:"nodes_global"},{type:"textline",b:["void","tw","(",")","{"]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["ek","=","a_orco_tex_coord",";"]}]}}]},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 tB ( vec3 tx , float ty , vec2 tz ) { vec2 tA ; tA = vec2 ( ( tx . x - tz . x ) / ty , - ( tx . z - tz . y ) / ty ) ; return fract ( tA ) ; } vec2 tF ( vec2 tC , float tD , vec2 tE ) { return vec2 ( tC . x * tD , - tC . y * tD ) + tE ; } aM tG ( ) { return aM ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } aM ub ( vec3 tH , vec3 tI , vec3 tJ , vec3 tK , vec3 tL , PRECISION sampler2D tM , sampler2D tN , vec3 tO , float tP , vec3 tQ , vec4 tR , mat4 tS ) { mat4 tT ; vec4 tU ; vec2 tV , tW , tX ; float tY , tZ ; vec3 t_ ; t_ = aS ( tR , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; tY = - t_ . x ; tZ = - t_ . z ; tV = vec2 ( tQ . x + tP * ( - 1.0 - tY ) / 2.0 , tQ . z + tP * ( 1.0 - tZ ) / 2.0 ) ; tW = tB ( tL , tP , tV ) ; tZ = tP / 2.0 ; tX = abs ( tF ( tW - vec2 ( 0.5 ) , tP , vec2 ( 0.0 ) ) ) ; tZ = tZ * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( tX ) > tZ ) return tG ( ) ; tZ = tP / tO . z ; tX = ( tW - vec2 ( 0.5 ) ) * tZ + vec2 ( 0.5 ) ; t_ = t_ * ( tP / tO . z - 1.0 ) / 2.0 ; tX . x += t_ . x ; tX . y -= t_ . z ; tU = texture2D ( tN , tX ) ; tZ = tU . r ; if ( tZ < u_scale_threshold ) return tG ( ) ; tY = tO . y - tO . x ; tY = tO . y - texture2D ( tM , tX ) . r * tY ; tX = tH . xz - tL . xz ; tL . xz = tF ( tW , tP , tV ) ; tL . y = tY ; tH . xz = tL . xz + tX ; tH . y *= tZ ; tH . y += tY ; t_ = tU . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"tH -= tL ; tT = rq ( tQ , tL , tS ) ; aM ua = rD ( tH , tL , tI , tJ , tK , tT ) ; ua . b = tL ; ua . f = t_ ; return bn ( ua ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return bn ( aM ( tH , tL , tI , tJ , tK , t_ ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",
a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 uh ( mat4 uc , vec4 ud ) { vec4 ue ; float uf ; vec2 ug ; ug = ( uc * u_v_light_matrix [ 3 ] ) . xy ; uf = SHADOW_TEX_RES / 2.0 ; ug = floor ( ug * uf + 0.5 ) / uf - ug ; ue = uc * ud ; ue . xy += ug ; ue = u_b_light_matrix * ue ; return ue ; } void ul ( vec3 ui , vec3 uj ) { vec4 uk ; uk = u_v_light_matrix * vec4 ( ui + u_normal_offset * uj , 1.0 ) ; bA = uh ( u_p_light_matrix0 , uk ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"bB = uh ( u_p_light_matrix1 , uk ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"bC = uh ( u_p_light_matrix2 , uk ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"bD = uh ( u_p_light_matrix3 , uk ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/fog.glslf"]=
{type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void uv ( inout vec3 up , in float uq , in float ur , in vec4 us ) { float ut , uu ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:"ut = clamp ( ( uq - u_fog_params . z ) / u_fog_params . y , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOG_TYPE","QUADRATIC",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["ut","*=","ut",";"]}]}},
{type:"elif",c:["FOG_TYPE","LINEAR",{type:"equal_expr",d:2}],group:{type:"group",a:[]}},{type:"elif",c:["FOG_TYPE","INVERSE_QUADRATIC",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ut = sqrt ( ut ) ;".split(" ")}]}}]},{type:"textline",b:"if ( u_fog_params . w > 0.0 ) { if ( ur > u_fog_params . w ) ut = 0.0 ; else if ( ur > 0.0 ) { uu = ( u_fog_params . w - ur ) / u_fog_params . w ; ut *= uu * uu ; } } ut = 1.0 - ( 1.0 - ut ) * ( 1.0 - u_fog_params . x ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["ut","=","0.0",";"]}]}}]},{type:"textline",b:"up = mix ( up , us . rgb , ut ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 uB ( in mat4 uw , in vec3 ux ) { vec3 uy , uz , uA ; uy = mix ( uw [ 0 ] . rgb , uw [ 1 ] . rgb , max ( sign ( ux . x ) , 0.0 ) ) ; uz = mix ( uw [ 2 ] . rgb , uw [ 3 ] . rgb , max ( sign ( ux . z ) , 0.0 ) ) ; uA = vec3 ( uw [ 0 ] . a , uw [ 1 ] . a , uw [ 2 ] . a ) ; uz = mix ( uy , uz , abs ( ux . z ) ) ; uz = mix ( uz , uA , abs ( ux . y ) ) ; aE ( uz ) ; return uz ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void uD ( inout float uC ) { uC -= 0.5 ; uC = 4.0 * ( uC * uC * uC ) + 0.5 ; } void uQ ( inout vec3 uE , in float uF , in vec3 uG , in float uH , in vec4 uI , in vec4 uJ , in float uK ) { vec3 uL , uM ; float uN , uO , uP ; uN = uJ . w * uF ; uN = exp ( - uN * uN ) ; uN = clamp ( uN , 0.0 , 1.0 ) ; uO = max ( uG . y , 0.0 ) ; uF = max ( uF - max ( uH / uO , 0.0 ) , 0.0 ) ; uP = uI . w * uF ; uP = 1.0 - uP ; uP = max ( uP , 0.0 ) ; uD ( uP ) ; uP += max ( uK - 0.5 , 0.0 ) ; if ( uP < uN ) { uL = vec3 ( 0.0 , 0.02 , 0.05 ) ; uM = uI . rgb ; uH = clamp ( - uH * 0.03 , 0.0 , 0.8 ) ; uL = mix ( uM , uL , min ( uO , 1.0 ) ) ; uL = mix ( uL , vec3 ( 0.0 ) , uH ) ; uE = mix ( uL , uE , uP ) ; } if ( uP >= uN ) { uE = mix ( uJ . rgb , uE , uN ) ; } } void uW ( inout vec3 uR , in float uS , in float uT ) { vec3 uU ; float uV ; uV = u_underwater_fog_color_density . w * uS ; uV = 1.0 - uV ; uV = clamp ( uV , 0.0 , 1.0 ) ; uD ( uV ) ; uT = clamp ( - uT * 0.03 , 0.0 , 0.8 ) ; uU = mix ( u_underwater_fog_color_density . rgb , vec3 ( 0.0 ) , uT ) ; uR = mix ( uU , uR , uV ) ; }".split(" ")}]}}]},
{type:"textline",b:"void vc ( inout vec3 uX , float uY , vec3 uZ , float u_ ) { vec4 va ; vec3 vb ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vb = uB ( u_cube_fog , uZ ) ; va = vec4 ( vb , u_fog_color_density . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["va","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uQ ( uX , uY , uZ , u_cam_water_depth , u_underwater_fog_color_density , va , u_ ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"uv ( uX , uY , bu . y , va ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/lighting_nodes.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",
b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"float vf = 0.0 ; float vg = 1.0 ; float vh = 0.5 ; vec3 vi = vec3 ( vf ) ;".split(" ")},{type:"node",name:"LIGHTING_BEGIN",h:[{type:"node_out",name:"vG",qualifier:["vec3"],e:!1},{type:"node_out",name:"vH",qualifier:["vec3"],e:!1},{type:"node_out",name:"vI",qualifier:["vec3"],e:!1},{type:"node_out",name:"vJ",qualifier:["vec3"],e:!0},{type:"node_out",name:"vK",qualifier:["vec3"],e:!0},
{type:"node_out",name:"vL",qualifier:["vec2"],e:!0},{type:"node_out",name:"vM",qualifier:["vec2"],e:!0},{type:"node_out",name:"vN",qualifier:["float"],e:!0},{type:"node_out",name:"vO",qualifier:["float"],e:!0},{type:"node_out",name:"vP",qualifier:["vec4"],e:!0}],g:[{type:"textline",b:"vG = vj ; vH = vk ; vI = vl ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vJ"],g:[{type:"textline",b:["vJ","=","vm",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vK"],g:[{type:"textline",
b:["vK","=","vo",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vM"],g:[{type:"textline",b:["vM","=","vq",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vL"],g:[{type:"textline",b:["vL","=","vr",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vN"],g:[{type:"textline",b:["vN","=","vs",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vO"],g:[{type:"textline",b:["vO","=","vt",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vP"],
g:[{type:"textline",b:["vP","=","vu",";"]}]}]}]},{type:"node",name:"LIGHTING_AMBIENT",h:[{type:"node_in",name:"vQ",qualifier:["vec3"],e:!1},{type:"node_in",name:"vR",qualifier:["vec3"],e:!1},{type:"node_in",name:"vS",qualifier:["vec3"],e:!1},{type:"node_out",name:"vT",qualifier:["vec4"],e:!1},{type:"node_out",name:"vU",qualifier:["vec3"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["SHADELESS_MAT",{type:"logic_negative_expr",d:1},"NODES_GLOW",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",
d:2}],g:[{type:"textline",b:"vT = vec4 ( vQ + vS * vR , vf ) ; vU = vec3 ( vf ) ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"vT = vec4 ( vS , vf ) ; vU = vi ;".split(" ")}]}]}]},{type:"node",name:"LIGHTING_LAMP",h:[{type:"node_in",name:"vV",qualifier:["float"],e:!1},{type:"node_out",name:"vW",qualifier:["vec3"],e:!1},{type:"node_out",name:"vX",qualifier:["vec2"],e:!1},{type:"node_out",name:"vY",qualifier:["vec3"],e:!1},{type:"node_out",name:"vZ",qualifier:["float"],e:!1}],g:[{type:"node_condition",
a:[{type:"node_if",c:["NODES_GLOW",{type:"logic_negative_expr",d:1},"NUM_LIGHTS",0,{type:"g_expr",d:2},{type:"logical_and_expr",d:2}],g:[{type:"textline",b:"vX = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","HEMI",{type:"equal_expr",d:2}],g:[{type:"textline",b:["vZ","=","vh",";"]}]},{type:"node_else",g:[{type:"textline",b:["vZ","=","vf",";"]}]}]},{type:"textline",b:"vY = u_light_color_intensities [ LAMP_IND ] ; if ( LAMP_SHADOW_MAP_IND != - 1 ) vY *= vV ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2},"LAMP_TYPE","POINT",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],g:[{type:"textline",b:"vE = u_light_positions [ LAMP_IND ] ; vW = vE - vn ;".split(" ")},{type:"textline",b:"vx = length ( vW ) ; vY *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + vx * vx ) ; vW = normalize ( vW ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2}],g:[{type:"textline",b:"vE = u_light_directions [ LAMP_IND ] ; vx = dot ( vW , vE ) ; vx *= smoothstep ( vf , vg , ( vx - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; vY *= vx ;".split(" ")}]}]}]},
{type:"node_else",g:[{type:"textline",b:"vW = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",h:[{type:"node_in",name:"v_",qualifier:["vec3"],e:!1},{type:"node_in",name:"wa",qualifier:["vec2"],e:!1},{type:"node_in",name:"wb",qualifier:["vec3"],e:!1},{type:"node_in",name:"wc",qualifier:["float"],e:!1},{type:"node_in",name:"wd",qualifier:["vec2"],e:!1},{type:"node_out",name:"we",qualifier:["float"],e:!1}],g:[{type:"textline",b:"we = vf ; if ( wa . r != vf ) { vx = ( vg - wc ) * dot ( wb , v_ ) + wc ; if ( wd [ 0 ] == vf ) { we = vg ; } else { vx = vg + abs ( vx ) ; vx = wd [ 1 ] + ( vg - wd [ 1 ] ) * pow ( vx , wd [ 0 ] ) ; we = clamp ( vx , vf , vg ) ; } we = max ( we , vf ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_LAMBERT",h:[{type:"node_in",name:"wf",qualifier:["vec3"],e:!1},{type:"node_in",name:"wg",qualifier:["vec2"],e:!1},{type:"node_in",name:"wh",qualifier:["vec3"],e:!1},{type:"node_in",name:"wi",qualifier:["float"],e:!1},{type:"node_out",name:"wj",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wj = vf ; if ( wg . r != vf ) { vx = ( vg - wi ) * dot ( wh , wf ) + wi ; wj = max ( vx , vf ) ; }".split(" ")}]},{type:"node",name:"DIFFUSE_OREN_NAYAR",h:[{type:"node_in",name:"wk",
qualifier:["vec3"],e:!1},{type:"node_in",name:"wl",qualifier:["vec2"],e:!1},{type:"node_in",name:"wm",qualifier:["vec3"],e:!1},{type:"node_in",name:"wn",qualifier:["float"],e:!1},{type:"node_in",name:"wo",qualifier:["vec2"],e:!1},{type:"node_out",name:"wp",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wp = vf ; if ( wl . r != vf ) { vx = ( vg - wn ) * dot ( wm , wk ) + wn ; if ( wo [ 0 ] > vf ) { vy = max ( dot ( wm , vp ) , vf ) ; vz = wo [ 0 ] * wo [ 0 ] ; vA = vg - vh * ( vz / ( vz + 0.33 ) ) ; vE = wk - vx * wm ; vF = vp - vy * wm ;".split(" ")},
{type:"textline",b:"if ( length ( vE ) == vf || length ( vF ) == vf || abs ( vx ) > vg || abs ( vy ) > vg )".split(" ")},{type:"textline",b:"wp = vx * vA ; else { vB = acos ( vx ) ; vy = acos ( vy ) ; vE = normalize ( vE ) ; vF = normalize ( vF ) ; vC = max ( vB , vy ) ; vD = min ( vB , vy ) ; vD *= 0.95 ; vy = max ( dot ( vE , vF ) , vf ) ; vz = 0.45 * ( vz / ( vz + 0.09 ) ) ; wp = vx * ( vA + ( vz * vy * sin ( vC ) * tan ( vD ) ) ) ; } } else wp = vx ; wp = max ( wp , vf ) ; }".split(" ")}]},{type:"node",
name:"DIFFUSE_MINNAERT",h:[{type:"node_in",name:"wq",qualifier:["vec3"],e:!1},{type:"node_in",name:"wr",qualifier:["vec2"],e:!1},{type:"node_in",name:"ws",qualifier:["vec3"],e:!1},{type:"node_in",name:"wt",qualifier:["float"],e:!1},{type:"node_in",name:"wu",qualifier:["vec2"],e:!1},{type:"node_out",name:"wv",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wv = vf ; if ( wr . r != vf ) { vx = ( vg - wt ) * dot ( ws , wq ) + wt ; vD = max ( dot ( ws , vp ) , vf ) ; if ( wu [ 0 ] <= vg ) wv = vx * pow ( max ( vD * vx , 0.1 ) , wu [ 0 ] - vg ) ; else wv = vx * pow ( 1.0001 - vD , wu [ 0 ] - vg ) ; wv = max ( wv , vf ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",h:[{type:"node_in",name:"ww",qualifier:["vec3"],e:!1},{type:"node_in",name:"wx",qualifier:["vec2"],e:!1},{type:"node_in",name:"wy",qualifier:["vec3"],e:!1},{type:"node_in",name:"wz",qualifier:["float"],e:!1},{type:"node_in",name:"wA",qualifier:["vec2"],e:!1},{type:"node_out",name:"wB",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wB = vf ; if ( wx . r != vf ) { vD = ( vg - wz ) * dot ( wy , ww ) + wz ; vD = acos ( vD ) ; if ( vD < wA [ 0 ] ) wB = vg ; else if ( vD > ( wA [ 0 ] + wA [ 1 ] ) || wA [ 1 ] == vf ) wB = vf ; else wB = vg - ( ( vD - wA [ 0 ] ) / wA [ 1 ] ) ; wB = max ( wB , vf ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",h:[{type:"node_in",name:"wC",qualifier:["vec3"],e:!1},{type:"node_in",name:"wD",qualifier:["vec2"],e:!1},{type:"node_in",name:"wE",qualifier:["vec3"],e:!1},{type:"node_in",name:"wF",qualifier:["float"],e:!1},{type:"node_in",name:"wG",qualifier:["vec2"],e:!1},{type:"node_out",name:"wH",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wH = vf ; if ( wD . g != vf ) { vF = normalize ( wC + vp ) ; wH = ( vg - wF ) * max ( dot ( wE , vF ) , vf ) + wF ; wH = pow ( wH , wG [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",h:[{type:"node_in",name:"wI",qualifier:["vec3"],e:!1},{type:"node_in",name:"wJ",qualifier:["vec2"],e:!1},{type:"node_in",name:"wK",qualifier:["vec3"],e:!1},{type:"node_in",name:"wL",qualifier:["vec2"],e:!1},{type:"node_out",name:"wM",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wM = vf ; if ( wJ . g != vf ) { vF = normalize ( wI + vp ) ; vD = max ( dot ( wK , vF ) , 0.001 ) ;".split(" ")},{type:"textline",b:"vx = max ( dot ( wK , vp ) , 0.01 ) ; vC = max ( dot ( wK , wI ) , 0.01 ) ; vD = tan ( acos ( vD ) ) ; vy = max ( wL [ 0 ] , 0.001 ) ; wM = vC * ( vg / ( 4.0 * M_PI * vy * vy ) ) * ( exp ( - ( vD * vD ) / ( vy * vy ) ) / ( sqrt ( vx * vC ) ) ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_TOON",h:[{type:"node_in",name:"wN",qualifier:["vec3"],e:!1},{type:"node_in",name:"wO",qualifier:["vec2"],e:!1},{type:"node_in",name:"wP",qualifier:["vec3"],e:!1},{type:"node_in",name:"wQ",qualifier:["vec2"],e:!1},{type:"node_out",name:"wR",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wR = vf ; if ( wO . g != vf ) { vF = normalize ( wN + vp ) ; vC = acos ( dot ( vF , wP ) ) ; if ( vC < wQ [ 0 ] ) wR = vg ; else if ( vC >= wQ [ 0 ] + wQ [ 1 ] || wQ [ 1 ] == vf ) wR = vf ; else wR = vg - ( vC - wQ [ 0 ] ) / wQ [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",h:[{type:"node_in",name:"wS",qualifier:["vec3"],e:!1},{type:"node_in",name:"wT",qualifier:["vec2"],e:!1},{type:"node_in",name:"wU",qualifier:["vec3"],e:!1},{type:"node_in",name:"wV",qualifier:["float"],e:!1},{type:"node_in",name:"wW",qualifier:["vec2"],e:!1},{type:"node_out",name:"wX",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wX = vf ; if ( wT . g != vf ) { if ( wW [ 0 ] < 1.0 || wW [ 1 ] == vf ) wX = vf ; else { if ( wW [ 1 ] < 100.0 ) wW [ 1 ] = sqrt ( 1.0 / wW [ 1 ] ) ; else wW [ 1 ] = 10.0 / wW [ 1 ] ; vF = normalize ( vp + wS ) ; vC = ( vg - wV ) * max ( dot ( wU , vF ) , vf ) + wV ; if ( vC < vf ) wX = vf ; else { vx = max ( dot ( wU , vp ) , 0.01 ) ; vy = dot ( wU , wS ) ; if ( vy <= 0.01 ) wX = vf ; else { vD = max ( dot ( vp , vF ) , 0.01 ) ; vz = vg ; vx = ( 2.0 * vC * vx ) / vD ; vy = ( 2.0 * vC * vy ) / vD ; vy = min ( min ( vz , vx ) , vy ) ; vx = sqrt ( pow ( wW [ 0 ] , 2.0 ) + pow ( vD , 2.0 ) - vg ) ; vD = pow ( vx - vD , 2.0 ) / pow ( vx + vD , 2.0 ) * ( vg + pow ( vD * ( vx + vD ) - vg , 2.0 ) / pow ( vD * ( vx - vD ) + vg , 2.0 ) ) ; vC = acos ( vC ) ; wX = max ( vD * vy * exp ( - pow ( vC , 2.0 ) / ( 2.0 * pow ( wW [ 1 ] , 2.0 ) ) ) , vf ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",h:[{type:"node_in",name:"wY",qualifier:["vec4"],e:!1},{type:"node_in",name:"wZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"w_",qualifier:["float"],e:!1},{type:"node_in",name:"xa",qualifier:["float"],e:!1},{type:"node_in",name:"xb",qualifier:["vec3"],e:!1},{type:"node_in",name:"xc",qualifier:["vec3"],e:!1},{type:"node_in",name:"xd",qualifier:["vec4"],e:!1},{type:"node_in",name:"xe",qualifier:["vec3"],e:!1},{type:"node_in",name:"xf",qualifier:["vec3"],e:!1},{type:"node_in",
name:"xg",qualifier:["vec3"],e:!1},{type:"node_in",name:"xh",qualifier:["float"],e:!1},{type:"node_out",name:"xi",qualifier:["vec4"],e:!1},{type:"node_out",name:"xj",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"xj = wZ + xg * xf * xa ; xi = wY + vec4 ( xg * xe * w_ , xa ) ;".split(" ")}]},{type:"node",name:"LIGHTING_END",h:[{type:"node_in",name:"xk",qualifier:["vec4"],e:!1},{type:"node_in",name:"xl",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"vv = xk . rgb ; vw = xl ;".split(" ")}]},{type:"nodes_global"},
{type:"textline",b:"void xm ( vec3 vj , vec3 vk , vec3 vl , vec3 vm , vec3 vn , vec3 vo , vec3 vp , vec2 vq , vec2 vr , float vs , float vt , vec4 vu , out vec3 vv , out vec3 vw ) { float vx , vy , vz , vA , vB , vC , vD ; vec3 vE , vF ;".split(" ")},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct xp { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",
a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void xv ( inout float xq , float xr , vec2 xs , vec2 xt ) { float xu ; xu = xt . x - xs . x ; xu = ( xr - xs . x ) / xu ; xq = mix ( xq , xt . y , clamp ( xu , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void xB ( inout vec3 xw , float xx , vec4 xy , vec4 xz ) { float xA ; xA = xz . x - xy . x ; xA = ( xx - xy . x ) / xA ; xw = mix ( xw , xz . yzw , clamp ( xA , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float xH ( float xC , float xD , vec2 xE [ SIZE_RAMP_LENGTH ] ) { float xF , xG ; xF = xC / xD ; xG = xE [ 0 ] . y ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xv ( xG , xF , xE [ 0 ] , xE [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",2,{type:"g_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"xv ( xG , xF , xE [ 1 ] , xE [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xv ( xG , xF , xE [ 2 ] , xE [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","xG",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 xN ( float xI , float xJ , vec4 xK [ COLOR_RAMP_LENGTH ] ) { vec3 xL ; float xM ; xM = xI / xJ ; xL = xK [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xB ( xL , xM , xK [ 0 ] , xK [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xB ( xL , xM , xK [ 1 ] , xK [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xB ( xL , xM , xK [ 2 ] , xK [ 3 ] ) ;".split(" ")}]}}]},
{type:"textline",b:["return","xL",";","}"]}]}}]},{type:"textline",b:"float xV ( float xO , float xP , float xQ , float xR ) { float xS , xT , xU ; xS = max ( 0.01 , min ( xP , xQ ) ) ; xT = max ( 0.01 , min ( xP , xR ) ) ; xU = xP - xT ; xT = clamp ( xO / xS , 0.0 , 1.0 ) - step ( xU , xO ) * ( xO - xU ) / xT ; return xT ; } xp ya ( ) { vec3 xW , xX ; float xY , xZ ; xp x_ ; if ( u_p_cyclic == 1 ) { xY = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( xY < 0.0 ) xY += u_p_length ; } if ( u_p_cyclic != 1 ) { xY = u_p_time - a_p_delay ; } if ( xY < 0.0 || xY >= a_p_lifetime ) { x_ . a = 0.0001 ; x_ . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( xY < 0.0 || xY >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"xW = a_position ; xX = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xW = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; xX = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"xW += u_p_nfactor * xY * xX ; xW += a_p_vels . xyz * xY ; xW . y -= u_p_gravity * xY * xY / 2.0 ; xZ = max ( u_p_mass , EPSILON ) ; xW += ( u_p_wind_fac * u_wind / xZ ) * xY * xY / 2.0 ; x_ . b = xW ; x_ . e = a_p_vels . w * xY ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"x_ . a = xH ( xY , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"x_ . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"x_ . d = xN ( xY , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"x_ . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"x_ . c = xV ( xY , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return x_ ; }".split(" ")}]};a["include/blending.glslf"]={type:"group",a:[{type:"textline",b:"float yc = 0.0 ; float yd = 1.0 ; vec3 ye = vec3 ( yc ) ; vec3 yf = vec3 ( yd ) ; vec3 yk ( vec3 yg ) { float yh , yi ; vec4 yj ; yj = vec4 ( yc , - yd / 3.0 , 2.0 / 3.0 , - yd ) ; yj = mix ( vec4 ( yg . bg , yj . wz ) , vec4 ( yg . gb , yj . xy ) , step ( yg . b , yg . g ) ) ; yj = mix ( vec4 ( yj . xyw , yg . r ) , vec4 ( yg . r , yj . yzx ) , step ( yj . x , yg . r ) ) ; yh = yj . x - min ( yj . w , yj . y ) ; yi = 1.0e-10 ; return vec3 ( abs ( yj . z + ( yj . w - yj . y ) / ( 6.0 * yh + yi ) ) , yh / ( yj . x + yi ) , yj . x ) ; } vec3 yo ( vec3 yl ) { vec3 ym ; vec4 yn ; yn = vec4 ( yd , 2.0 / 3.0 , yd / 3.0 , 3.0 ) ; ym = abs ( fract ( vec3 ( yl . r , yl . r , yl . r ) + yn . xyz ) * 6.0 - yn . www ) ; return yl . b * mix ( yn . xxx , clamp ( ym - yn . xxx , yc , yd ) , yl . g ) ; } vec3 ys ( vec3 yp , vec3 yq , float yr ) { return mix ( yp , yq , yr ) ; } vec3 yw ( vec3 yt , vec3 yu , float yv ) { return yv * yt + yu ; } vec3 yA ( vec3 yx , vec3 yy , float yz ) { return yy - yz * yx ; } vec3 yF ( vec3 yB , vec3 yC , float yD ) { float yE ; yE = yd - yD ; return ( vec3 ( yE ) + yD * yB ) * yC ; } vec3 yK ( vec3 yG , vec3 yH , float yI ) { vec3 yJ ; yJ = vec3 ( yd - yI ) ; return yf - ( yJ + yI * ( yf - yG ) ) * ( yf - yH ) ; } vec3 yP ( vec3 yL , vec3 yM , float yN ) { vec3 yO ; yO = vec3 ( yd - yN ) ; return mix ( yM * ( yO + 2.0 * yN * yL ) , yf - ( yO + 2.0 * yN * ( yf - yL ) ) * ( yf - yM ) , step ( 0.5 , yM ) ) ; } vec3 yT ( vec3 yQ , vec3 yR , float yS ) { return mix ( yR , abs ( yQ - yR ) , yS ) ; } vec3 yX ( vec3 yU , vec3 yV , float yW ) { return mix ( yV , yV / ( yU + step ( yU , ye ) ) , yW ) ; } vec3 za ( vec3 yY , vec3 yZ , float y_ ) { return mix ( yZ , min ( yY , yZ ) , y_ ) ; } vec3 ze ( vec3 zb , vec3 zc , float zd ) { return max ( zd * zb , zc ) ; } vec3 zk ( vec3 zf , vec3 zg , float zh ) { vec3 zi , zj ; zi = yk ( zg ) ; if ( zi . y != yc ) { zj = yk ( zf ) ; zj = yo ( vec3 ( zi . x , zj . yz ) ) ; return mix ( zf , zj , zh ) ; } return zf ; } vec3 zq ( vec3 zl , vec3 zm , float zn ) { vec3 zo , zp ; zo = yk ( zl ) ; if ( zo . y != yc ) { zp = yk ( zm ) ; return yo ( vec3 ( zo . x , mix ( zo . y , zp . y , zn ) , zo . z ) ) ; } return zl ; } vec3 zw ( vec3 zr , vec3 zs , float zt ) { vec3 zu , zv ; zu = yk ( zr ) ; zv = yk ( zs ) ; return yo ( vec3 ( zu . xy , mix ( zu . z , zv . z , zt ) ) ) ; } vec3 zC ( vec3 zx , vec3 zy , float zz ) { vec3 zA , zB ; zA = yk ( zy ) ; if ( zA . y != yc ) { zB = yk ( zx ) ; zB = yo ( vec3 ( zA . xy , zB . z ) ) ; return mix ( zx , zB , zz ) ; } return zx ; } vec3 zH ( vec3 zD , vec3 zE , float zF ) { vec3 zG ; zG = yf - ( yf - zE ) * ( yf - zD ) ; return mix ( zD , ( ( yf - zD ) * zE * zD ) + zD * zG , zF ) ; } vec3 zL ( vec3 zI , vec3 zJ , float zK ) { return zI + zK * ( 2.0 * zJ - yd ) ; } float zR ( float zM , float zN , float zO , float zP ) { float zQ ; zQ = yd - zP ; return ( zQ + zO * zM ) * zN ; } float zX ( float zS , float zT , float zU , float zV ) { float zW ; zW = yd - zV ; return yd - ( zW + zU * ( yd - zS ) ) * ( yd - zT ) ; } float Ac ( float zY , float zZ , float z_ , float Aa ) { float Ab ; Ab = yd - Aa ; return mix ( zZ * ( Ab + 2.0 * z_ * zY ) , yd - ( Ab + 2.0 * z_ * ( yd - zY ) ) * ( yd - zZ ) , step ( 0.5 , zZ ) ) ; }".split(" ")}]};
a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float Ao ( in sampler2D Ai , in vec2 Aj , in vec2 Ak ) { float Al , Am , An ; Al = texture2D ( Ai , Aj ) . r ; Am = Ak . x ; An = Ak . y ; Am = 2.0 * Am / ( Am + An - ( 2.0 * Al - 1.0 ) * ( An - Am ) ) ; return Am ; }".split(" ")}]}};b4w.module.animation=function(a,q){var d=q("__animation"),c=q("__constraints");q("__physics");var b=q("__print"),l=q("__util");a.SLOT_0=d.SLOT_0;a.SLOT_1=d.SLOT_1;a.SLOT_2=d.SLOT_2;a.SLOT_3=d.SLOT_3;a.SLOT_4=d.SLOT_4;a.SLOT_5=d.SLOT_5;a.SLOT_6=d.SLOT_6;a.SLOT_7=d.SLOT_7;a.SLOT_ALL=d.SLOT_ALL;a.OBJ_ANIM_TYPE_NONE=d.OBJ_ANIM_TYPE_NONE;a.OBJ_ANIM_TYPE_ARMATURE=d.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=d.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=d.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=d.OBJ_ANIM_TYPE_SOUND;
a.OBJ_ANIM_TYPE_PARTICLES=d.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=d.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=d.AB_CYCLIC;a.AB_FINISH_RESET=d.AB_FINISH_RESET;a.AB_FINISH_STOP=d.AB_FINISH_STOP;var f=new Float32Array(4);a.is_animated=function(a){return d.is_animated(a)};a.get_actions=function(){b.error("get_actions() deprecated, use get_anim_names() instead");for(var a=[],c=d.Yr(),f=0;f<c.length;f++)a.push(d.BD(c[f].name));return a};a.get_current_action=function(c,d){b.error("get_current_action() deprecated, use get_current_anim_name() instead");
return a.get_current_anim_name(c,d)};a.get_anim_names=function(a){return d.pt(a)?d.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!d.is_animated(a))return null;b=b||d.SLOT_0;return d.Wz(a,b)};a.apply=function(a,c,f){if(f>d.SLOT_7)b.error("Can't apply animation to slot "+f+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{f=f||d.SLOT_0;if(d.is_animated(a)){var e=d.get_slot_num_by_anim(a,c);if(-1!=e&&e!=f){b.error('Animation "'+c+'" is already applied to object "'+
a.name+'" (slot "'+e+'").');return}}d.KE(a,c)?d.apply(a,c,f):b.error('No fcurves in action "'+c+'"')}};a.remove=function(a){d.remove(a)};a.remove_slot_animation=function(a,b){d.is_animated(a)&&(b=b||d.SLOT_0,d.remove_slot_animation(a,b))};a.apply_def=function(a){d.apply_def(a)};a.play=function(a,c,f){d.is_animated(a)?(f=f||d.SLOT_0,d.play(a,c,f),d.update_object_animation(a,0,f,!0)):b.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){d.is_animated(a)&&(b=b||d.SLOT_0,d.stop(a,
b))};a.is_play=function(a,b){if(!d.is_animated(a))return!1;b=b||d.SLOT_0;return d.is_play(a,b)};a.set_current_frame_float=function(c,d,f){b.error("set_current_frame_float() deprecated, use set_frame() instead");a.set_frame(c,d,f)};a.get_current_frame_float=function(c,d){b.error("get_current_frame_float() deprecated, use get_frame() instead");return a.get_frame(c,d)};a.set_frame=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_frame(a,b,c))};a.set_first_frame=function(a,b){if(d.is_animated(a)){b=
b||d.SLOT_0;var c=d.get_anim_start_frame(a,b);d.set_frame(a,c,b)}};a.set_last_frame=function(a,b){if(d.is_animated(a)){b=b||d.SLOT_0;var c=d.get_anim_start_frame(a,b),e=d.get_anim_length(a,b);d.set_frame(a,c+e-d.Gv,b)}};a.get_frame=function(a,b){if(!d.is_animated(a))return 0;b=b||d.SLOT_0;return d.get_current_frame_float(a,b)};a.set_speed=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_speed(a,b||1,c))};a.get_speed=function(a,b){if(!d.is_animated(a))return 0;b=b||d.SLOT_0;return a.H[b]?d.get_speed(a,
b):0};a.get_frame_range=function(a,c){b.error("get_frame_range() deprecated, use get_anim_start_frame() and get_anim_length() instead");if(d.is_animated(a)){c=c||d.SLOT_0;var f=a.H[c];if(f)return[f.start,f.start+f.length]}return null};a.get_anim_start_frame=function(a,b){return d.is_animated(a)&&(b=b||d.SLOT_0,a.H[b])?d.get_anim_start_frame(a,b):-1};a.get_anim_length=function(a,b){return d.is_animated(a)&&(b=b||d.SLOT_0,a.H[b])?d.get_anim_length(a,b):-1};a.cyclic=function(c,f,l){b.error("cyclic() deprecated, use set_behavior() instead");
a.set_behavior(c,f?d.AB_CYCLIC:d.AB_FINISH_RESET,l)};a.is_cyclic=function(a,c){b.error("is_cyclic() deprecated, use get_behavior() instead");if(!d.is_animated(a))return!1;c=c||d.SLOT_0;return d.is_cyclic(a,c)};a.set_behavior=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_behavior(a,b,c))};a.get_behavior=function(a,b){if(!d.is_animated(a))return null;b=b||d.SLOT_0;return d.get_behavior(a,b)};a.apply_smoothing=function(a,b,c,e){e=e||d.SLOT_0;d.is_animated(a)&&d.apply_smoothing(a,b,c,e)};a.update_object_animation=
function(a,b,c,e){d.is_animated(a)&&(c=c||d.SLOT_0,d.update_object_animation(a,b||0,c,e||!1))};a.frame_to_sec=function(a){return d.frame_to_sec(a)};a.get_bone_translation=function(a,b,d){if(!l.is_armature(a))return null;d||(d=new Float32Array(3));c.$z(a,b,!1,f,null);d[0]=f[0];d[1]=f[1];d[2]=f[2];return d};a.get_first_armature_object=function(){b.error("get_first_armature_object() deprecated");return null};a.get_slot_num_by_anim=function(a,b){return d.is_animated(a)&&b?d.get_slot_num_by_anim(a,b):
null};a.get_anim_type=function(a,b){return d.is_animated(a)?d.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return d.apply_to_first_empty_slot(a,b)};a.get_skel_mix_factor=function(a){return a.f.cf};a.set_skel_mix_factor=function(a,c,f){l.is_armature(a)?(c=Math.min(Math.max(c,0),1),a.f.cf!=c&&d.set_skel_mix_factor(a,c,f||0)):b.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,q){var d=q("__anchors");q("__print");a.attach_move_cb=d.attach_move_cb;a.detach_move_cb=d.detach_move_cb;a.is_anchor=d.is_anchor;a.get_element_id=d.get_element_id};b4w.module.assets=function(a,q){var d=q("__assets");a.AT_ARRAYBUFFER=d.AT_ARRAYBUFFER;a.AT_JSON=d.AT_JSON;a.AT_TEXT=d.AT_TEXT;a.AT_AUDIOBUFFER=d.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=d.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=d.AT_AUDIO_ELEMENT;a.enqueue=function(a,b,l){d.enqueue(a,b,l)}};b4w.module.camera=function(a,q){function d(a,c){if(b.is_camera(a))return c||(c=new Float32Array(3)),p.copy(a.f.i,c),c;e.error("get_eye(): Wrong object")}function c(a,c){b.is_target_camera(a)?(p.copy(c,a.f.Vb),g.p(a),r.sync_transform(a)):e.error("set_pivot(): Wrong object or camera move style")}var b=q("__camera");q("__config");var l=q("__constraints"),f=q("__container"),k=q("__mat3"),n=q("__mat4"),r=q("__physics"),e=q("__print"),g=q("__transform"),h=q("__util"),p=q("__vec3"),w=q("__vec4"),C=new Float32Array(2),
B=new Float32Array(3),H=new Float32Array(3),u=new Float32Array(4),D=new Float32Array(9);a.MS_STATIC=b.MS_STATIC;a.MS_ANIMATION=b.MS_STATIC;a.MS_TARGET_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=b.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=b.MS_HOVER_CONTROLS;a.is_camera=b.is_camera;a.is_target_camera=b.is_target_camera;a.is_eye_camera=b.is_eye_camera;a.is_hover_camera=b.is_hover_camera;a.set_move_style=function(a,c){if(!b.is_camera(a))return e.error("set_move_style(): Wrong object"),!1;if(c!=b.MS_STATIC&&
c!=b.MS_EYE_CONTROLS&&c!=b.MS_HOVER_CONTROLS&&c!=b.MS_TARGET_CONTROLS)return e.error("set_move_style(): Wrong camera move style"),!1;a.f.Ca=c;a.f.dc=null;a.f.jc=null;a.f.Gb=null;a.f.jb=!1;b.IA(a);switch(c){case b.MS_TARGET_CONTROLS:var f=d(a,B),k=h.quat_to_dir(a.f.quat,h.AXIS_MY,H),f=p.scaleAndAdd(f,k,10,k);p.copy(f,a.f.Vb)}g.p(a);r.sync_transform(a);return!0};a.get_move_style=function(a){return b.is_camera(a)?b.get_move_style(a):(e.error("get_move_style(): Wrong object"),null)};a.set_velocity_params=
function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return e.error("set_velocity_params(): Wrong object or camera move style"),null;var d=a.f;d.Wp=h.clamp(c[0],0,Infinity);d.Vp=h.clamp(c[1],0,Infinity);d.Xp=h.clamp(c[2],0,1)};a.get_velocity_params=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return e.error("get_velocity_params(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));var d=a.f;c[0]=d.Wp;c[1]=d.Vp;
c[2]=d.Xp;return c};a.set_look_at=function(a,c,d,e){var f=a.f;b.wz(c,d,e,f.i,f.quat);g.p(a);r.sync_transform(a)};a.get_eye=d;a.set_pivot=c;a.set_trans_pivot=function(a,c,d){b.is_target_camera(a)?(p.copy(c,a.f.i),p.copy(d,a.f.Vb),g.p(a),r.sync_transform(a)):e.error("set_trans_pivot(): Wrong object or camera move style")};a.get_pivot=function(a,c){if(b.is_target_camera(a))return c||(c=new Float32Array(3)),p.copy(a.f.Vb,c),c;e.error("get_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(b,
c,d){e.error("rotate_pivot() deprecated, use rotate_camera() or rotate_target_camera() instead");a.rotate_target_camera(b,c,d)};a.move_pivot=function(a,c,d){if(b.is_target_camera(a)){var f=a.f;if(f.Uu){var h=k.fromMat4(f.Z,D),l=p.subtract(f.i,f.Vb,H);B[0]=c;B[1]=0;B[2]=d;p.scale(B,p.len(l),B);p.transformMat3(B,h,B);p.add(f.Vb,B,f.Vb);p.add(f.i,B,f.i);g.p(a);r.sync_transform(a)}}else e.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(b,c){e.error("rotate_hover_cam() deprecated, use rotate_camera() or rotate_hover_camera() instead");
a.rotate_hover_camera(b,c,0)};a.get_hover_cam_angle=function(a){e.error("get_hover_cam_angle() deprecated, use get_camera_angles() instead");return b.is_hover_camera(a)?-b.get_camera_angles(a,C)[1]:(e.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.set_hover_cam_angle=function(a,c){e.error("set_hover_cam_angle() deprecated, use rotate_camera() or rotate_hover_camera() instead");if(b.is_hover_camera(a))if(a.f.jb){var d=b.get_camera_angles(a,C);(d=-c-d[1])&&b.rotate_hover_camera(a,
0,d);g.p(a);r.sync_transform(a)}else e.error("set_hover_cam_angle(): distance/hover_angle limits are not defined or disabled");else e.error("set_hover_cam_angle(): wrong object or camera move style")};a.get_hover_angle_limits=function(a,c){if(b.is_hover_camera(a))return a.f.Gb?(c||(c=new Float32Array(2)),c[0]=a.f.Gb.Va,c[1]=a.f.Gb.ib):e.error("get_hover_angle_limits(): camera hasn't angle limits"),c;e.error("get_hover_angle_limits(): wrong object")};a.get_cam_dist_limits=function(a,c){if(b.is_hover_camera(a)||
b.is_target_camera(a))return a.f.jb?(c||(c=new Float32Array(2)),c[0]=a.f.ug,c[1]=a.f.ve):e.error("get_cam_dist_limits(): camera hasn't distance limits"),c;e.error("get_cam_dist_limits(): wrong object")};a.translate_hover_cam_v=function(b,c){e.error("translate_hover_cam_v() deprecated, use hover_cam_set_translation() instead");a.hover_cam_set_translation(b,c)};a.hover_cam_set_translation=function(a,c){if(b.is_hover_camera(a)){var d=a.f;if(d.jb){var f=p.subtract(c,d.i,B);p.add(f,d.ec,d.ec)}g.set_translation(a,
c);g.p(a);r.sync_transform(a)}else e.error("hover_cam_set_translation(): wrong object")};a.set_hover_pivot=function(a,c){if(b.is_hover_camera(a)){var d=a.f;if(d.jb&&d.Gb){var f=p.subtract(c,d.ec,B),f=p.add(f,d.i,f);g.set_translation(a,f)}p.copy(c,d.ec);g.p(a);r.sync_transform(a)}else e.error("set_hover_pivot(): Wrong object or camera move style")};a.get_hover_cam_pivot=function(a,c){if(!b.is_hover_camera(a))return e.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));p.copy(a.f.ec,
c);return c};a.has_distance_limits=function(a){return b.is_target_camera(a)||b.is_hover_camera(a)?a.f.jb:(e.error("has_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,c,d,f){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:f|=g.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>d){e.error("apply_vertical_limits(): wrong vertical limits");return}break;default:e.error("apply_vertical_limits(): wrong object");return}a.f.jc={Va:c,ib:d};b.jC(a,f==g.SPACE_LOCAL);
g.p(a);r.sync_transform(a)};a.clear_vertical_limits=function(a){a.f.jc=null};a.get_vertical_limits=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return e.error("get_vertical_limits(): wrong object"),null;var d=a.f;c=c||new Float32Array(2);return d.jc?(c[0]=d.jc.Va,c[1]=d.jc.ib,c):null};a.has_vertical_limits=function(a){if(b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a))return Boolean(a.f.jc);e.error("has_vertical_limits(): wrong object")};a.apply_horizontal_limits=
function(a,c,d,f){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:f|=g.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>d){e.error("apply_horizontal_limits(): wrong horizontal limits");return}break;default:e.error("apply_horizontal_limits(): wrong object");return}a.f.dc={left:c,right:d};b.fC(a,f==g.SPACE_LOCAL);g.p(a);r.sync_transform(a)};a.clear_horizontal_limits=function(a){a.f.dc=null};a.get_horizontal_limits=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&
!b.is_hover_camera(a))return e.error("get_horizontal_limits(): wrong object"),null;var d=a.f;c=c||new Float32Array(2);return d.dc?(c[0]=d.dc.left,c[1]=d.dc.right,c):null};a.has_horizontal_limits=function(a){if(b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a))return Boolean(a.f.dc);e.error("has_horizontal_limits(): wrong object")};a.apply_hover_angle_limits=function(a,c,d){b.is_hover_camera(a)?c<d?e.error("apply_hover_angle_limits(): wrong hover angle limits"):(c=h.angle_wrap_periodic(c,
-Math.PI,Math.PI),d=h.angle_wrap_periodic(d,-Math.PI,Math.PI),c=h.clamp(c,-Math.PI/2,0),d=h.clamp(d,-Math.PI/2,0),a.f.Gb={Va:c,ib:d},b.HA(a),g.p(a),r.sync_transform(a)):e.error("apply_hover_angle_limits(): wrong object")};a.clear_hover_angle_limits=function(a){b.is_hover_camera(a)?a.f.Gb=null:e.error("clear_hover_angle_limits(): wrong object")};a.apply_distance_limits=function(a,c,d){if(b.is_target_camera(a)||b.is_hover_camera(a))if(c>d)e.error("apply_distance_limits(): wrong distance limits");else{var f=
a.f;f.jb=!0;f.ve=c;f.ug=d;g.p(a);r.sync_transform(a)}else e.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){b.is_target_camera(a)||b.is_hover_camera(a)?a.f.jb=!1:e.error("clear_distance_limits(): wrong object")};a.set_eye_params=function(b,c,d){e.error("set_eye_params() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,Math.PI/2-d)};a.is_look_up=function(a){h.quat_to_dir(a.f.quat,h.AXIS_MY,B);return 0<=B[1]?!0:!1};a.rotate_camera=
function(c,d,f,h,k){switch(a.get_move_style(c)){case b.MS_STATIC:break;case b.MS_TARGET_CONTROLS:b.rotate_target_camera(c,d,f,h,k);break;case b.MS_EYE_CONTROLS:b.rotate_eye_camera(c,d,f,h,k);break;case b.MS_HOVER_CONTROLS:b.rotate_hover_camera(c,d,f,h,k);break;default:e.error("rotate_camera(): Wrong object")}g.p(c);r.sync_transform(c)};a.rotate_target_camera=function(a,c,d,f,h){b.is_target_camera(a)?(b.rotate_target_camera(a,c,d,f,h),g.p(a),r.sync_transform(a)):e.error("rotate_target_camera(): wrong object")};
a.rotate_eye_camera=function(a,c,d,f,h){b.is_eye_camera(a)?(b.rotate_eye_camera(a,c,d,f,h),g.p(a),r.sync_transform(a)):e.error("rotate_eye_camera(): wrong object")};a.rotate_hover_camera=function(a,c,d,f,h){b.is_hover_camera(a)?(b.rotate_hover_camera(a,c,d,f,h),g.p(a),r.sync_transform(a)):e.error("rotate_hover_camera(): wrong object")};a.rotate=function(b,c,d){e.error("rotate() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,-d)};a.get_camera_angles=function(a,
c){c||(c=new Float32Array(2));b.get_camera_angles(a,c);return c};a.get_camera_angles_char=function(a,c){c||(c=new Float32Array(2));b.get_camera_angles_char(a,c);return c};a.get_angles=function(a,c){e.error("get_angles() deprecated, use get_camera_angles() instead");c||(c=new Float32Array(2));b.get_angles(a,c);return c};a.set_stereo_distance=function(a,c){for(var d=a.f.L,e=0;e<d.length;e++){var f=d[e];f.type!=b.Cb&&f.type!=b.Hb||b.XC(f,c,f.be)}};a.get_stereo_distance=function(a){a=a.f.L;for(var c=
0;c<a.length;c++){var d=a[c];if(d.type==b.Cb||d.type==b.Hb)return d.lk}return 0};a.is_underwater=function(a){e.error("is_underwater() deprecated, always returns false");return a.f.Lu};a.translate_view=function(a,c,d,e){a=a.f.L;for(var f=0;f<a.length;f++){var g=a[f];g.gc||b.Kf(g,g.Ea);var h=B;h[0]=-c;h[1]=-d;h[2]=0;n.translate(g.Aa,h,g.Aa);n.rotateZ(g.Aa,e,g.Aa);n.multiply(g.Aa,g.za,g.Gd);b.Tq(g);b.hn(g)}};a.get_fov=function(a){return h.gm(a.f.L[0].Jc)};a.set_fov=function(a,c){for(var d=a.f.L,e=0;e<
d.length;e++){var f=d[e];f.Jc=h.cz(c);f.gc||b.Kf(f,f.Ea);n.multiply(f.Aa,f.za,f.Gd);b.Tq(f);b.hn(f)}};a.correct_up=function(a,b){b||(b=h.AXIS_Y);l.correct_up(a,b)};a.zoom_object=function(a,d){if(b.is_target_camera(a)){g.get_object_center(d,!1,B);c(a,B);g.p(a);var f=g.get_object_size(d),h=b.Vz(a)/2,f=f/Math.sin(h),h=g.RB(a,B);g.move_local(a,0,f-h,0);g.p(a);r.sync_transform(a)}else e.error("zoom_object(): wrong object")};a.set_ortho_scale=function(c,d){if(b.is_camera(c)&&a.is_ortho_camera(c)){var f=
c.f;if(b.is_target_camera(c)){var g=p.dist(f.i,f.Vb);f.Wh=d/2*f.Vh/g}else b.is_hover_camera(c)&&a.has_distance_limits(c)?(g=p.distance(f.i,f.ec),f.Wh=d/2*f.Vh/g):c.f.L[0].top=d/2;b.kE(c)}else e.error("set_ortho_scale(): wrong object")};a.get_ortho_scale=function(c){if(b.is_camera(c)&&a.is_ortho_camera(c))return 2*c.f.L[0].top;e.error("get_ortho_scale(): wrong object")};a.is_ortho_camera=function(a){if(b.is_camera(a))return a.f.L[0].type==b.$c;e.error("is_ortho_camera(): wrong object")};a.calc_ray=
function(a,c,d,g){g||(g=new Float32Array(3));var h=a.f.L[0];switch(h.type){case b.Qb:case b.ie:case b.Cb:case b.Hb:var k=Math.tan(h.Jc*Math.PI/360),l=k*h.Ea;c=f.kn(c,d,C,h);u[0]=(2*c[0]/h.width-1)*l;u[1]=-1;u[2]=(2*c[1]/h.height-1)*k;u[3]=0;w.transformMat4(u,a.f.Z,u);g[0]=u[0];g[1]=u[1];g[2]=u[2];p.normalize(g,g);return g;default:return e.error("Non-compatible camera"),g}};a.project_point=function(a,c,d){d||(d=new Float32Array(2));return b.project_point(a,c,d)}};b4w.module.config=function(a,q){var d=q("__config");a.P_LOW=d.P_LOW;a.P_HIGH=d.P_HIGH;a.P_ULTRA=d.P_ULTRA;a.P_CUSTOM=d.P_CUSTOM;a.set=d.set;a.get=d.get;a.reset=d.reset;a.get_std_assets_path=d.get_std_assets_path};b4w.module.controls=function(a,q){var d=q("__controls"),c=q("__print");a.CT_CONTINUOUS=d.CT_CONTINUOUS;a.CT_TRIGGER=d.CT_TRIGGER;a.CT_SHOT=d.CT_SHOT;a.CT_LEVEL=d.CT_LEVEL;a.CT_CHANGE=d.CT_CHANGE;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_A=
65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;
a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=d.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=d.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=d.PL_MULTITOUCH_MOVE_PAN;a.create_custom_sensor=d.create_custom_sensor;a.create_keyboard_sensor=d.create_keyboard_sensor;a.create_collision_sensor=function(a,c,f){return d.create_collision_sensor(a,c||"ANY",
f||!1)};a.create_collision_impulse_sensor=d.create_collision_impulse_sensor;a.create_ray_sensor=function(a,c,f,k,n,r,e){return d.create_ray_sensor(a,c,f,k||"ANY",n||!1,r||!1,e||!1)};a.create_mouse_click_sensor=d.create_mouse_click_sensor;a.create_mouse_wheel_sensor=d.create_mouse_wheel_sensor;a.create_mouse_move_sensor=d.create_mouse_move_sensor;a.create_touch_move_sensor=d.create_touch_move_sensor;a.create_touch_zoom_sensor=d.create_touch_zoom_sensor;a.create_motion_sensor=d.create_motion_sensor;
a.create_vertical_velocity_sensor=d.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=d.create_gyro_angles_sensor;a.create_gyro_delta_sensor=d.create_gyro_delta_sensor;a.create_timer_sensor=function(a,c){return d.create_timer_sensor(a,c||!1)};a.reset_timer_sensor=d.reset_timer_sensor;a.create_elapsed_sensor=d.create_elapsed_sensor;a.create_timeline_sensor=d.create_timeline_sensor;a.create_selection_sensor=function(a,c){return d.create_selection_sensor(a,c||!1)};a.set_custom_sensor=function(a,
c){d.JC(a,c)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=d.get_sensor_value;a.get_sensor_payload=d.get_sensor_payload;a.create_sensor_manifold=function(a,c,f,k,n,r,e){n=n||d.zr;d.create_sensor_manifold(a,c,f,k,n,r,void 0===e?null:e)};a.create_kb_sensor_manifold=function(a,c,f,k,n,r){k=d.create_keyboard_sensor(k);d.create_sensor_manifold(a,c,f,[k],d.zr,n,void 0===r?null:r)};a.check_sensor_manifolds=function(a){return d.check_sensor_manifold(a,null)};a.check_sensor_manifold=
d.check_sensor_manifold;a.remove_sensor_manifolds=function(a){c.error("remove_sensor_manifolds() deprecated, use remove_sensor_manifold() instead");d.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=d.remove_sensor_manifold;a.reset=d.reset;a.register_keyboard_events=d.register_keyboard_events;a.register_mouse_events=function(a,c,f){d.register_mouse_events(a,c,!!f)};a.register_wheel_events=d.register_wheel_events;a.register_touch_events=d.register_touch_events;a.register_device_orientation=
d.register_device_orientation;a.unregister_keyboard_events=d.unregister_keyboard_events;a.unregister_mouse_events=d.unregister_mouse_events;a.unregister_wheel_events=d.unregister_wheel_events;a.unregister_touch_events=d.unregister_touch_events;a.unregister_device_orientation=d.unregister_device_orientation};b4w.module.constraints=function(a,q){var d=q("__camera"),c=q("__constraints"),b=q("__objects"),l=q("__physics"),f=q("__print"),k=q("__transform");a.append_stiff=function(a,b,d,f,h){h=h||1;b instanceof Array&&2==b.length?c.dx(a,b[0],b[1],d,f,h):c.zq(a,b,d,f,h);k.p(a);l.sync_transform(a)};a.append_semi_stiff=function(a,b,d,f){c.cx(a,b,d,f);k.p(a);l.sync_transform(a)};a.append_semi_stiff_cam=function(a,b,e,g,h,p,q,C){if(!d.is_eye_camera(a))return f.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented."),
null;c.bx(a,b,e,g,h,p,q,C);k.p(a);l.sync_transform(a)};a.append_semi_soft_cam=function(a,b,e,g){if(!d.is_eye_camera(a))return f.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented."),null;if(!g||0>g)g=.25;c.ax(a,b,e,g);k.p(a);l.sync_transform(a)};a.append_stiff_trans=function(a,b,d){c.ex(a,b,d);k.p(a);l.sync_transform(a)};a.append_copy_trans=function(a,b,d){c.Ww(a,b,d);k.p(a);l.sync_transform(a)};a.append_stiff_trans_rot=function(a,b,d,f){c.fx(a,b,d,f);k.p(a);
l.sync_transform(a)};a.append_track=function(a,b){3==b.length?c.hx(a,b):c.gx(a,b);k.p(a);l.sync_transform(a)};a.append_follow=function(a,b,d,f){3==b.length?c.Yw(a,b,d,f):c.Xw(a,b,d,f);k.p(a);l.sync_transform(a)};a.append_stiff_viewport=function(a,b,d){c.append_stiff_viewport(a,b,d);k.p(a);l.sync_transform(a)};a.remove=function(a){a.qb&&c.remove(a)};a.get_parent=function(a){f.error("constraints.get_parent() deprecated, use objects.get_parent() instead");return b.get_parent(a)}};b4w.module.container=function(a,q){var d=q("__container"),c=q("__print");a.get_canvas=d.get_canvas;a.get_container=d.get_container;a.insert_to_container=function(a,l){2!=arguments.length?c.error("insert_to_container(): two arguments required"):a&&l&&d.insert_to_container(a,l)};a.set_canvas_offsets=d.set_canvas_offsets;a.update_canvas_offsets=d.update_canvas_offsets;a.client_to_canvas_coords=d.client_to_canvas_coords;a.force_offsets_updating=d.force_offsets_updating};b4w.module.data=function(a,q){var d=q("__data");q("__print");q("__util");a.load=d.load;a.unload=function(a){d.unload(a|0)};a.set_debug_resources_root=d.set_debug_resources_root;a.is_primary_loaded=d.is_primary_loaded;a.load_and_add_new=d.load;a.cleanup=a.unload};b4w.module.debug=function(a,q){function d(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function c(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);c.send(b);
if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function b(a){a.sort(function(a,b){return b.Tn.ALU_OPS-a.Tn.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.Tn,e=c.QE,f=l(c.Sy),f=f?"\t\t("+f.join(", ")+")":"\t\t(NA)";h.groupCollapsed("FRAG --\x3e","ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",e.ALU_OPS,"TEX",e.TEX_OPS,f);h.groupCollapsed("directives");for(var f=c.Xa.mf,g=0;g<f.length;g++){var k=f[g];h.log(k[0],k[1])}h.groupEnd();h.groupCollapsed("vert src");
h.log(c.PE);h.groupEnd();h.groupCollapsed("vert stats");for(var n in e)"ALU_OPS"!=n&&"TEX_OPS"!=n&&h.log(n,e[n]);h.groupEnd();h.groupCollapsed("frag src");h.log(c.Hz);h.groupEnd();h.groupCollapsed("frag stats");for(n in d)"ALU_OPS"!=n&&"TEX_OPS"!=n&&h.log(n,d[n]);h.groupEnd();h.groupEnd()}}function l(a){for(var b=p.Qh(),c=0;c<b.length;c++)for(var d=b[c],f=r.na(d,"MESH",r.DATA_ID_ALL),g=0;g<f.length;g++){var h=e.Ja(f[g],d);if(h&&h.T.length)for(var h=h.T,k=0;k<h.length;k++){var l=h[k];if(l.ic==a&&l.Kc.length)return l.Kc}}return null}
q("__batch");q("__config");var f=q("__controls"),k=q("__debug"),n=q("__extensions"),r=q("__objects"),e=q("__obj_util"),g=q("__physics"),h=q("__print"),p=q("__scenes"),w=q("__scenegraph"),C=q("__sfx"),B=q("__shaders"),H=q("__textures"),u=q("__util"),D=q("vec3");a.physics_stats=function(){g.Zy()};a.physics_id=function(a){h.log("O",g.zz(a));for(var b=g.Uz().Za.o,c=0;c<b.length;c++){var d=b[c];d.m.v==a&&h.log("B",d)}};a.visible_objects=function(){for(var a=p.get_active(),b=r.na(a,"MESH",r.DATA_ID_ALL),
a=[p.ea(a,"MAIN_OPAQUE"),p.ea(a,"MAIN_BLEND")],c=0;c<a.length;c++){var d=a[c],e=d.o;if(e.length){h.group(d.type,"DYNAMIC");for(var f=0;f<b.length;f++){var g=b[f],k=g.f;if("DYNAMIC"==k.type)for(var l=0;l<e.length;l++){var n=e[l];if(n.cb&&n.zd==k){h.Eo(g.name,g);break}}}h.groupEnd();h.groupCollapsed(d.type,"STATIC");for(f=0;f<b.length;f++)if(g=b[f],k=g.f,"DYNAMIC"!=k.type)for(l=0;l<e.length;l++)if(n=e[l],n.cb&&n.zd==k){h.Eo(g.name,g);break}h.groupEnd()}}};a.object_info=function(a){for(var b=p.get_active(),
c=r.na(b,"MESH",r.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];if(e.name==a){h.log("Object",e);for(var f=p.Xn(b),g=0;g<f.length;g++){for(var k=f[g],l=k.o,n=[],q=0;q<l.length;q++)l[q].zd==e.f&&n.push(l[q]);h.log("Subscene "+k.type,n)}}}};a.objects_stat=function(){var a=p.get_active();console.log("Armatures: "+r.na(a,"ARMATURE",r.DATA_ID_ALL).length);console.log("Cameras: "+r.na(a,"CAMERA",r.DATA_ID_ALL).length);console.log("Curves: "+r.na(a,"CURVE",r.DATA_ID_ALL).length);console.log("Empties: "+r.na(a,
"EMPTY",r.DATA_ID_ALL).length);console.log("Lamps: "+r.na(a,"LAMP",r.DATA_ID_ALL).length);console.log("Meshes: "+r.na(a,"MESH",r.DATA_ID_ALL).length);console.log("Speakers: "+r.na(a,"SPEAKER",r.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=p.get_active(),b=[p.ea(b,"MAIN_OPAQUE"),p.ea(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.o,e=0;e<d.length;e++){var f=d[e].D;f&&(a+=f.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=p.get_active(),b=[p.ea(b,
"MAIN_OPAQUE"),p.ea(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.o,e=0;e<d.length;e++){var f=d[e].D;f&&(a+=f.num_triangles)}}return a};a.num_draw_calls=function(){for(var a=p.get_active(),b=[p.ea(a,"MAIN_OPAQUE"),p.ea(a,"MAIN_BLEND")],b=b[0].o.length+b[1].o.length,a=p.Bu(a,["MAIN_PLANE_REFLECT","MAIN_CUBE_REFLECT"]),c=0;c<a.length;c++)var d=a[c],b="MAIN_PLANE_REFLECT"==d.type?b+d.o.length:b+6*d.o.length;return b};a.num_shaders=function(){return u.Td(B.bs())};a.geometry_stats=function(){for(var a=
p.get_active(),b=p.Xn(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.o,f=0;f<e.length;f++){var g=e[f].D,h=e[f].zd;g&&("COLOR_PICKING"!=d.type&&"OUTLINE_MASK"!=d.type||h.Vl||h.Ul)&&(a[g.id]=g)}}var e=d=c=b=0,k;for(k in a)g=a[k],g=g.R,g.il&&(d++,e+=g.il/1048576),b++,c+=g.yr/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=p.get_active(),c=[p.ea(c,"MAIN_OPAQUE"),p.ea(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=
c[d];if(e)for(var e=e.o,f=0;f<e.length;f++){var g=e[f].D;if(g)for(var g=g.S,h=0;h<g.length;h++){var k=g[h];if("IMAGE"===k.source||"ENVIRONMENT_MAP"===k.source){var l=k.kb;-1===a.indexOf(l)&&(a.push(l),k=k.width*k.height*4/1048576/k.rn,k*=1.3333,b+=k)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=p.get_active(),c=p.Xn(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var f=e.j,g=[f.pb,f.dd];g.push.apply(g,e.ce);for(e=0;e<g.length;e++){var h=g[e];H.Nj(h)&&
-1==a.indexOf(h)&&(a.push(h),b+=f.width*f.height*H.tA(h))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=p.get_active();(a=p.ea(a,"MAIN_OPAQUE"))&&p.Ys(a.j,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=p.get_active(),b=p.ea(a,"MAIN_OPAQUE"),a=p.Bu(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}p.Ys(d.j,b,e)}};a.scenegraph_to_dot=function(){for(var a=
p.Qh(),b=0;b<a.length;b++)h.log("\n"+w.Xy(p.fs(a[b])))};a.scenes_to_dot=function(){};a.controls_info=f.debug;a.object_distance=function(a,b){return D.dist(a.f.i,b.f.i)};a.msg=k.msg;a.fbmsg=k.fbmsg;a.print_telemetry=k.print_telemetry;a.plot_telemetry=k.plot_telemetry;a.fbres=function(a,b){function c(){k.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,
0,1]),f=new Float32Array([-1,0,0]),g=new Float32Array([0,-1,0]),h=new Float32Array([0,0,-1]);if(!u.hf(a,u.Fw))throw"Wrong VEC3_IDENT";if(!u.hf(b,u.zw))throw"Wrong QUAT4_IDENT";if(!u.hf(c,u.AXIS_X))throw"Wrong AXIS_X";if(!u.hf(d,u.AXIS_Y))throw"Wrong AXIS_Y";if(!u.hf(e,u.AXIS_Z))throw"Wrong AXIS_Z";if(!u.hf(f,u.AXIS_MX))throw"Wrong AXIS_MX";if(!u.hf(g,u.AXIS_MY))throw"Wrong AXIS_MY";if(!u.hf(h,u.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=C.get_speaker_objects(),b=0;b<a.length;b++){var c=
a[b];"BACKGROUND_MUSIC"==C.ao(c)&&C.mute(c,!0)}};a.check_finite=function(a){k.check_finite(a)};a.set_debug_params=function(a){var b=p.get_active();if(b=p.ea(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&p.bD(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&p.aD(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return h.gA()};a.get_warning_quantity=function(){return h.yA()};a.clear_errors_warnings=function(){return h.clear_errors_warnings()};
a.analyze_shaders=function(a){var e=B.bs(),f=0,g;for(g in e)a&&-1===g.indexOf(a)||f++;var f="of "+f+" analyzing...",k={};for(g in e)if(!a||-1!==g.indexOf(a)){var l=e[g],p;var r=l.Zp;p=l.Tr;var q=n.cs();if(q){r=q.getTranslatedShaderSource(r);p=q.getTranslatedShaderSource(p);var q=c("/nvidia_vert",r),w=d(q),y=c("/nvidia_frag",p),u=d(y);p={PE:r,xH:q,QE:w,Hz:p,kG:y,Tn:u}}else h.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),p=void 0;q=l.Xa;r=q.Ni+" + "+q.Nh;
p.Sy=l;p.Xa=q;l=k[r]=k[r]||[];l.push(p);h.log(f)}for(r in k)h.group("%c"+r,"color: #800"),l=k[r],b(l),h.groupEnd()}};b4w.module.geometry=function(a,q){var d=q("__batch"),c=q("__geometry"),b=q("__print"),l=q("__renderer");a.extract_vertex_array=function(a,k,l){if(!c.Sh(a))return b.error("Wrong object:",a.name),null;if(a=d.va(a,k,"MAIN")){if((k=a.R)&&k.Nb&&k.Nb[l])return c.sz(k,l);b.error("Attribute not found:"+l);return null}b.error("Wrong material:",k);return null};a.extract_index_array=function(a,k){if(!c.Sh(a))return b.error("Wrong object:",a.name),null;var l=d.va(a,k,"MAIN");if(l){if((l=l.R)&&l.Nb)return l.uf;
b.error("Buffer data not found");return null}b.error("Wrong material:",k);return null};a.update_vertex_array=function(a,k,l,r){var e=["MAIN","DEPTH","COLOR_ID"];if(c.Sh(a))for(var g=0;g<e.length;g++){var h=d.va(a,k,e[g]);h&&(h=h.R)&&h.Nb&&h.Nb[l]&&c.ym(h,l,0,r)}else b.error("Wrong object:",a.name)};a.override_geometry=function(a,k,n,r,e){var g=["MAIN","DEPTH","COLOR_ID"];if(c.Sh(a))if(n instanceof Uint16Array||n instanceof Uint32Array)if(r instanceof Float32Array)for(var h=0;h<g.length;h++){var p=
d.va(a,k,g[h]);if(p){var q=p.R;if(q){c.$D(q,p.xe,n);var C=0,B;for(B in q.Nb)var H=q.Nb[B],C=C+r.length/3*H.Wd;q.Yc=new Float32Array(C);var C=q.Yc,u=0;for(B in q.Nb)switch(H=q.Nb[B],B){case "a_position":C.set(r,u);H.offset=u;H.length=r.length;u+=H.length;break;case "a_normal":var D;e&&(D=c.Sq(n,r,r));var G=c.Qq(n,r,D);C.set(G,u);H.offset=u;H.length=r.length;u+=H.length;break;case "a_tangent":H.offset=u;H.length=r.length/3*H.Wd;for(var G=new Float32Array(H.length),v=0;v<G.length;v+=4)G[v]=1,G[v+3]=
1;C.set(G,u);u+=H.length;break;default:H.offset=u,H.length=r.length/3*H.Wd,G=new Float32Array(H.length),C.set(G,u),u+=H.length}c.Pu(q);l.Aq(p);(p=d.Ic(a,p))&&p.R&&(p.R=q)}}}else b.error("Wrong positions_array type");else b.error("Wrong ibo_array type");else b.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,d,l){if(!c.check_shape_keys(a))return b.error("Wrong object:",a.name),null;if(!c.zs(a,d))return b.error("Wrong key name:",d),null;c.nx(a,d,parseFloat(l))};a.check_shape_keys=function(a){return c.check_shape_keys(a)};
a.get_shape_keys_names=function(a){return c.check_shape_keys(a)?c.get_shape_keys_names(a):(b.error("Wrong object:",a.name),null)};a.get_shape_key_value=function(a,d){return c.check_shape_keys(a)?c.zs(a,d)?c.get_shape_key_value(a,d):(b.error("Wrong key name:",d),null):(b.error("Wrong object:",a.name),null)}};b4w.module.hud=function(a,q){var d=q("__hud");q("__print");a.draw_mixer_strip=d.draw_mixer_strip;a.plot_array=d.plot_array};b4w.module.lights=function(a,q){function d(a){for(var c=k.get_active(),d=l.na(c,"LAMP",l.DATA_ID_ALL),h=0;h<d.length;h++){var p=d[h];if("SUN"==p.Ka.type){var q=p;break}}if(!q)return f.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(d=(90-a.vert_position)/180*Math.PI,h=q.f,n.set_rotation_euler(q,[d,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),r.quat_to_dir(h.quat,r.AXIS_Y,a),h=e.length(h.i),e.copy(a,g),e.scale(g,h,g),n.set_translation(q,
g),n.p(q),a=q.Ka,a.Fr&&(h=c.world.light_settings.environment_energy,p=Math.cos(Math.abs(d)),d=Math.max(Math.min(3*p,1),0)*a.Ar,h*=Math.max(p,.1),b.Yt(a,d),k.set_environment_colors(c,h,null,null)),k.Uf(q,c))}function c(a){if(b.Hl(a))return a.Ka.type;f.error("get_light_type(): Wrong object");return!1}var b=q("__lights"),l=q("__objects"),f=q("__print"),k=q("__scenes"),n=q("__transform"),r=q("__util"),e=q("__vec3"),g=new Float32Array(3),h,p=60;a.get_lamps=function(a){var b=k.get_active(),b=l.na(b,"LAMP",
l.DATA_ID_ALL);if(!a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.Ka.type===a&&c.push(e)}return c};a.get_sun_params=function(){for(var a=k.get_active(),a=l.na(a,"LAMP",l.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.Ka.type){b=d;break}}return b?(b=b.Ka.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=d;a.set_day_time=function(a){for(var b=
k.get_active(),b=l.na(b,"LAMP",l.DATA_ID_ALL),c=0;c<b.length;c++){var e=b[c];if("SUN"==e.Ka.type){var g=e;break}}if(!g)return f.error("There is no sun on the scene"),null;g=-Math.cos(a/12*Math.PI)*p;b={};b.hor_position=12>a?15*a:15*(a-24);b.vert_position=g;d(b)};a.set_date=function(a){(h=a.getDate())?1582==h&&10==a.ZG&&4<a.Wy&&15>a.Wy&&f.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):f.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){p=
Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(b.Hl(a))var d=a.Ka;else return f.error("get_light_params(): Wrong object"),!1;if(a=c(a))switch(a){case "SPOT":var e={light_type:a,light_color:d.color,light_energy:d.Ih,light_spot_blend:d.jk,light_spot_size:d.Qe,light_distance:d.distance};break;case "POINT":e={light_type:a,light_color:d.color,light_energy:d.Ih,light_distance:d.distance};break;default:e={light_type:a,light_color:d.color,light_energy:d.Ih}}return e?e:!1};a.get_light_type=
c;a.set_light_params=function(a,c){if(b.Hl(a))var d=a.Ka;else return f.error("set_light_params(): Wrong object"),!1;var e=k.get_active();"number"==typeof c.light_energy&&(b.Yt(d,c.light_energy),k.Uf(a,e));"object"==typeof c.light_color&&(b.QC(d,c.light_color),k.Uf(a,e));"number"==typeof c.light_spot_blend&&(b.SC(d,c.light_spot_blend),k.Uf(a,e));"number"==typeof c.light_spot_size&&(b.TC(d,c.light_spot_size),k.Uf(a,e));"number"==typeof c.light_distance&&(b.RC(d,c.light_distance),k.Uf(a,e));l.SD(e)}};b4w.module.material=function(a,q){function d(a,b){for(var c=a.aa[0].T,d=0;d<c.length;d++){var e=c[d];if(-1<e.Kc.indexOf(b))return"MAIN"==e.type}return!1}function c(a,b){var c=l.va(a,b,"MAIN");return Boolean(c&&c.xc[0])}function b(a,b){var c=l.va(a,b,"MAIN");return Boolean(c&&c.xc[1])}var l=q("__batch"),f=q("__config"),k=q("__obj_util"),n=q("__print"),r=q("__shaders"),e=f.q,g="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.inherit_material=function(a,b,c,d){if(k.Jj(c)&&
k.Jj(a)){for(var e=["MAIN","DEPTH","COLOR_ID"],f=!1,r=0;r<e.length;r++){var q=e[r],G=l.va(a,b,q),v=l.va(c,d,q);if(G&&v){var f=!0,m=l.Ic(c,d,q);"MAIN"==q&&(l.Zt(v,G),m&&l.Zt(m,G));for(q=0;q<v.Ob.length;q++){var t=v.Ob[q];if(-1!==g.indexOf(t)){var z=G.Ob.indexOf(t);-1!==z&&(v.S[q]=G.S[z],m&&(t=m.Ob.indexOf(t),-1!==t&&(m.S[t]=G.S[z])))}}}}f||n.error("Wrong objects for inheriting material!")}else n.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.aa;for(var c=0;c<a.length;c++)for(var d=
a[c].T,e=0;e<d.length;e++)for(var f=0;f<d[e].Kc.length;f++)-1==b.indexOf(d[e].Kc[f])&&b.push(d[e].Kc[f]);return b};a.set_diffuse_color=function(a,b,c){var d=l.va(a,b,"MAIN");d?(d.ed.set(c),(a=l.Ic(a,b,"MAIN"))&&a.ed.set(c)):n.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=l.va(a,b,"MAIN");if(c){var d=new Float32Array(4);d.set(c.ed);return d}n.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,c){var d=l.va(a,b,"MAIN");
if(d){if(d.lf=c,a=l.Ic(a,b,"MAIN"))a.lf=c}else n.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=l.va(a,b,"MAIN");if(c)return c.lf;n.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var d=l.va(a,b,"MAIN");d?(d.$d.set(c),(a=l.Ic(a,b,"MAIN"))&&a.$d.set(c)):n.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=l.va(a,b,"MAIN");if(c){var d=Array(3);d[0]=c.$d[0];d[1]=c.$d[1];
d[2]=c.$d[2];return d}n.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,b,d){c(a,b)||n.error('Property "specular_intensity" is missing!');l.va(a,b,"MAIN").xc[0]=d;(a=l.Ic(a,b,"MAIN"))&&(a.xc[0]=d)};a.get_specular_intensity=function(a,b){c(a,b)||n.error('Property "specular_intensity" is missing!');return l.va(a,b,"MAIN").xc[0]};a.check_specular_intensity=c;a.set_specular_hardness=function(a,c,d){b(a,c)||n.error('Property "specular_hardness" is missing!');l.va(a,
c,"MAIN").xc[1]=d;(a=l.Ic(a,c,"MAIN"))&&(a.xc[1]=d)};a.get_specular_hardness=function(a,c){b(a,c)||n.error('Property "specular_hardness" is missing!');return l.va(a,c,"MAIN").xc[1]};a.check_specular_hardness=b;a.set_emit_factor=function(a,b,c){var d=l.va(a,b,"MAIN");if(d){if(d.ye=c,a=l.Ic(a,b,"MAIN"))a.ye=c}else n.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=l.va(a,b,"MAIN");if(c)return c.ye;n.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=
function(a,b,c){var d=l.va(a,b,"MAIN");if(d){if(d.le=c,a=l.Ic(a,b,"MAIN"))a.le=c}else n.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=l.va(a,b,"MAIN");if(c)return c.le;n.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){var d=l.va(a,b,"MAIN");if(d){if(d.kf=c,a=l.Ic(a,b,"MAIN"))a.kf=c}else n.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=l.va(a,b,"MAIN");
if(c)return c.kf;n.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var d=l.va(a,b,"MAIN");if(d){if(d.bf=c,a=l.Ic(a,b,"MAIN"))a.bf=c}else n.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=l.va(a,b,"MAIN");if(c)return c.bf;n.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return n.error("missing arguments in get_material_params"),null;if(!d(a,b))return null;var c=
l.va(a,b,"MAIN");if(!c)return null;var e={};"MAIN"==c.type&&(e.reflect_factor=c.reflect_factor,e.fresnel=c.xd[2],e.fresnel_factor=5*(1-c.xd[3]),e.parallax_scale=c.parallax_scale,e.parallax_steps=l.Fb(c,"PARALLAX_STEPS")[1]);return e};a.get_water_material_params=function(a,b){if(!a||!b)return n.error("missing arguments in get_water_material_params"),null;if(!d(a,b))return null;var c=l.va(a,b,"MAIN");if(!c||!c.Zf)return null;if(!c)return n.error("material not found"),null;var f={};if("MAIN"==c.type){if(e.qi){var g=
f.shallow_water_col=Array(3);g[0]=c.shallow_water_col[0];g[1]=c.shallow_water_col[1];g[2]=c.shallow_water_col[2];g=f.shore_water_col=Array(3);g[0]=c.shore_water_col[0];g[1]=c.shore_water_col[1];g[2]=c.shore_water_col[2];f.shallow_water_col_fac=c.shallow_water_col_fac;f.shore_water_col_fac=c.shore_water_col_fac}f.foam_factor=c.foam_factor;f.norm_uv_velocity=c.Pi;f.absorb_factor=l.Fb(c,"ABSORB")[1];f.sss_strength=l.Fb(c,"SSS_STRENGTH")[1];f.sss_width=l.Fb(c,"SSS_WIDTH")[1];f.dst_noise_scale0=l.Fb(c,
"DST_NOISE_SCALE_0")[1];f.dst_noise_scale1=l.Fb(c,"DST_NOISE_SCALE_1")[1];f.dst_noise_freq0=l.Fb(c,"DST_NOISE_FREQ_0")[1];f.dst_noise_freq1=l.Fb(c,"DST_NOISE_FREQ_1")[1];f.dir_min_shore_fac=l.Fb(c,"DIR_MIN_SHR_FAC")[1];f.dir_freq=l.Fb(c,"DIR_FREQ")[1];f.dir_noise_scale=l.Fb(c,"DIR_NOISE_SCALE")[1];f.dir_noise_freq=l.Fb(c,"DIR_NOISE_FREQ")[1];f.dir_min_noise_fac=l.Fb(c,"DIR_MIN_NOISE_FAC")[1];f.dst_min_fac=l.Fb(c,"DST_MIN_FAC")[1];f.waves_hor_fac=l.Fb(c,"WAVES_HOR_FAC")[1]}return f};a.set_material_extended_params=
function(a,b,c){if(a&&b&&c){if(!d(a,b))return n.error("setting material params is not possible"),null;var e=l.va(a,b,"MAIN");if(e){var f=[e];(e=l.Ic(a,b,"MAIN"))&&f.push(e);for(a=0;a<f.length;a++)e=f[a],"number"==typeof c.material_reflectivity&&(e.reflect_factor=c.material_reflectivity),"number"==typeof c.material_fresnel&&(e.xd[2]=c.material_fresnel),"number"==typeof c.material_fresnel_factor&&(e.xd[3]=1-c.material_fresnel_factor/5),"number"==typeof c.material_parallax_scale&&(e.parallax_scale=c.material_parallax_scale),
"number"==typeof c.material_parallax_steps&&(b=r.r(parseFloat(c.material_parallax_steps)),l.xa(e,"PARALLAX_STEPS",b),l.sb(e,!0))}else n.error("material not found")}else n.error("missing arguments in set_material_params")};a.set_water_material_params=function(a,b,c){if(!a||!b||!c)return n.error("missing arguments in set_water_material_params"),null;if(!d(a,b))return n.error("setting water material params is not possible"),null;var f=l.va(a,b,"MAIN");if(!f)return n.error("material not found"),null;
var g=[f];(f=l.Ic(a,b,"MAIN"))&&g.push(f);for(a=0;a<g.length;a++)f=g[a],e.qi&&("object"==typeof c.shallow_water_col&&f.shallow_water_col.set(c.shallow_water_col),"number"==typeof c.shallow_water_col_fac&&(f.shallow_water_col_fac=c.shallow_water_col_fac),"object"==typeof c.shore_water_col&&f.shore_water_col.set(c.shore_water_col),"number"==typeof c.shore_water_col_fac&&(f.shore_water_col_fac=c.shore_water_col_fac)),e.shore_smoothing&&f.Dm&&("boolean"==typeof c.shore_smoothing&&(c.shore_smoothing?l.xa(f,
"SHORE_SMOOTHING",1):l.xa(f,"SHORE_SMOOTHING",0)),"number"==typeof c.absorb_factor&&(b=r.r(parseFloat(c.absorb_factor)),l.xa(f,"ABSORB",b))),"number"==typeof c.foam_factor&&e.Mh&&(f.foam_factor=c.foam_factor),"number"==typeof c.norm_uv_velocity&&(f.Pi=c.norm_uv_velocity),e.water_dynamic&&f.water_dynamic&&("boolean"==typeof c.water_dynamic&&(c.water_dynamic?l.xa(f,"DYNAMIC",1):l.xa(f,"DYNAMIC",0)),"number"==typeof c.waves_height&&(b=r.r(parseFloat(c.waves_height)),l.xa(f,"WAVES_HEIGHT",b)),"number"==
typeof c.waves_length&&(b=r.r(parseFloat(c.waves_length)),l.xa(f,"WAVES_LENGTH",b)),"number"==typeof c.sss_strength&&(b=r.r(parseFloat(c.sss_strength)),l.xa(f,"SSS_STRENGTH",b)),"number"==typeof c.sss_width&&(b=r.r(parseFloat(c.sss_width)),l.xa(f,"SSS_WIDTH",b)),"number"==typeof c.dst_noise_scale0&&(b=r.r(parseFloat(c.dst_noise_scale0)),l.xa(f,"DST_NOISE_SCALE_0",b)),"number"==typeof c.dst_noise_scale1&&(b=r.r(parseFloat(c.dst_noise_scale1)),l.xa(f,"DST_NOISE_SCALE_1",b)),"number"==typeof c.dst_noise_freq0&&
(b=r.r(parseFloat(c.dst_noise_freq0)),l.xa(f,"DST_NOISE_FREQ_0",b)),"number"==typeof c.dst_noise_freq1&&(b=r.r(parseFloat(c.dst_noise_freq1)),l.xa(f,"DST_NOISE_FREQ_1",b)),"number"==typeof c.dir_min_shore_fac&&(b=r.r(parseFloat(c.dir_min_shore_fac)),l.xa(f,"DIR_MIN_SHR_FAC",b)),"number"==typeof c.dir_freq&&(b=r.r(parseFloat(c.dir_freq)),l.xa(f,"DIR_FREQ",b)),"number"==typeof c.dir_noise_scale&&(b=r.r(parseFloat(c.dir_noise_scale)),l.xa(f,"DIR_NOISE_SCALE",b)),"number"==typeof c.dir_noise_freq&&(b=
r.r(parseFloat(c.dir_noise_freq)),l.xa(f,"DIR_NOISE_FREQ",b)),"number"==typeof c.dir_min_noise_fac&&(b=r.r(parseFloat(c.dir_min_noise_fac)),l.xa(f,"DIR_MIN_NOISE_FAC",b)),"number"==typeof c.dst_min_fac&&(b=r.r(parseFloat(c.dst_min_fac)),l.xa(f,"DST_MIN_FAC",b)),"number"==typeof c.waves_hor_fac&&(b=r.r(parseFloat(c.waves_hor_fac)),l.xa(f,"WAVES_HOR_FAC",b))),l.sb(f,!0);return!0}};b4w.module.particles=function(a,q){var d=q("__particles"),c=q("__print");a.set_size=function(a,l,f){d.gi(a)?d.set_size(a,l,f):c.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,l,f){d.gi(a)?d.set_normal_factor(a,l,f):c.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,l,f){d.gi(a)?(f=Math.min(f,1),f=Math.max(f,0),d.set_factor(a,l,f)):c.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,q){q("__config");var d=q("__ipc"),c=q("__physics"),b=q("__print"),l=q("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){c.K(a)?c.enable_simulation(a):b.error("No physics for object "+a.name)};a.disable_simulation=function(a){c.K(a)?c.disable_simulation(a):b.error("No physics for object "+a.name)};a.has_physics=function(a){return c.K(a)};a.has_simulated_physics=function(a){return c.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return c.has_dynamic_physics(a)};a.set_gravity=function(a,d){c.K(a)?c.set_gravity(a,d):b.error("No physics for object "+a.name)};a.set_damping=function(a,d,l){c.K(a)?c.A("set_damping",a.m.v,d,l):b.error("No physics for object "+a.name)};a.reset_damping=function(a){if(c.K(a)){var d=a.Bd;c.A("set_damping",a.m.v,d.An,d.hp)}else b.error("No physics for object "+a.name)};a.set_transform=function(a,d,l){c.K(a)?c.set_transform.apply(this,arguments):b.error("No physics for object "+a.name)};a.sync_transform=
function(a){c.K(a)?c.sync_transform(a):b.error("No physics for object "+a.name)};a.apply_velocity=function(a){c.K(a)?c.apply_velocity.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){c.K(a)?c.apply_velocity_world.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_force=function(a,d,l,r){c.K(a)?c.apply_force.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_torque=function(a,d,l,r){c.K(a)?c.apply_torque.apply(this,
arguments):b.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,d){c.K(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_throttle(a,l.clamp(d,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,d,n){if(c.K(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");d=l.clamp(d,0,1);var r=a.l.Jh;-1==n||1==n?r=Math.max(-1,Math.min(r+n*d,1)):0==n&&0<=r?(r-=d,r=Math.max(0,r)):0==n&&0>r?(r+=d,r=Math.min(0,
r)):b.error("Wrong steering direction");c.vehicle_throttle(a,l.clamp(r,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_steer=function(a,d){c.K(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_steer(a,l.clamp(d,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,d,n){if(c.K(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");d=l.clamp(d,0,1);var r=a.l.yi;-1==n||1==n?r=Math.max(-1,Math.min(r+n*d,
1)):0==n&&0<=r?(r-=d,r=Math.max(0,r)):0==n&&0>r?(r+=d,r=Math.min(0,r)):b.error("Wrong steering direction");c.vehicle_steer(a,l.clamp(r,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_brake=function(a,d){c.K(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_brake(a,l.clamp(d,0,1))):b.error("No physics for object "+a.name)};a.vehicle_brake_inc=function(a,d){if(c.K(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");d=l.clamp(d,
-1,1);var n=a.l.aj;c.vehicle_brake(a,l.clamp(n+n*d,0,1))}else b.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return c.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return c.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!c.K(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.yc.name;b.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!c.K(a))return b.error("No physics for object "+
a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.l.Jh;b.error("Wrong object")};a.get_vehicle_steering=function(a){if(!c.K(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.l.yi;b.error("Wrong object")};a.get_vehicle_brake=function(a){if(!c.K(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.l.aj;b.error("Wrong object")};a.get_vehicle_speed=function(a){if(!c.K(a))return b.error("No physics for object "+
a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return c.get_vehicle_speed(a);b.error("Wrong object")};a.is_character=function(a){return c.is_character(a)};a.set_character_move_dir=function(a,d,l){c.K(a)?c.set_character_move_dir(a,d,l):b.error("No physics for object "+a.name)};a.set_character_move_type=function(a,d){c.K(a)?c.set_character_move_type(a,d):b.error("No physics for object "+a.name)};a.set_character_walk_velocity=function(a,d){c.K(a)?c.set_character_walk_velocity(a,d):b.error("No physics for object "+
a.name)};a.set_character_run_velocity=function(a,d){c.K(a)?c.set_character_run_velocity(a,d):b.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,d){c.K(a)?c.set_character_fly_velocity(a,d):b.error("No physics for object "+a.name)};a.character_jump=function(a){c.K(a)?c.character_jump(a):b.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,d,l){c.K(a)?c.character_rotation_inc(a,d,l):b.error("No physics for object "+a.name)};a.set_character_rotation_quat=
function(a,d){c.K(a)?c.set_character_rotation_quat(a,d):b.error("No physics for object "+a.name)};a.set_character_rotation=function(a,d,l){c.K(a)?c.set_character_rotation(a,d,l):b.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,d){c.K(a)?c.set_character_rotation_v(a,d):b.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,d){c.K(a)?c.set_character_rotation_h(a,d):b.error("No physics for object "+a.name)};a.append_collision_test=function(a,d,
l,r){c.K(a)?c.append_collision_test(a,d,l,r||!1):b.error("No physics for object "+a.name)};a.remove_collision_test=function(a,d,l){c.K(a)?c.remove_collision_test(a,d||"ANY",l):b.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,d){c.K(a)?c.apply_collision_impulse_test(a,d):b.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){c.K(a)?c.clear_collision_impulse_test(a):b.error("No physics for object "+a.name)};a.append_ray_test=function(a,
b,d,l,e,g){return c.append_ray_test(a,b,d,l,e,g||!1,!1,!1,!1)};a.append_ray_test_ext=function(a,b,d,l,e,g,h,p,q){return c.append_ray_test(a,b,d,l,e,g||!1,h||!1,p||!1,q||!1)};a.remove_ray_test=function(a){c.Is(a)?c.remove_ray_test(a):b.error("Wrong ray test ID")};a.change_ray_test_from_to=function(a,d,l){c.Is(a)?c.change_ray_test_from_to(a,d,l):b.error("Wrong ray test ID")};a.apply_constraint=function(a,d,l,r,e,g,h,p,q,C){c.K(d)&&c.K(e)?c.apply_constraint(a,d,l,r,e,g,h,p,q,C):b.error("Wrong objects")};
a.clear_constraint=function(a){c.K(a)&&c.DA(a)?c.clear_constraint(a):b.error("Wrong object")};a.pull_to_constraint_pivot=function(a,d,l,r,e,g){c.K(a)&&c.K(r)?c.pull_to_constraint_pivot(a,d,l,r,e,g):b.error("Wrong objects")};a.get_worker_listeners=d.get_worker_listeners};b4w.module.rgb=function(a,q){q("__print");var d=q("__util"),c=new Float32Array(3);a.create=function(){return new Float32Array(3)};a.from_values=function(a,c,d){var k=new Float32Array(3);k[0]=a;k[1]=c;k[2]=d;return k};a.set=function(a,c,d,k){k[0]=a;k[1]=c;k[2]=d;return k};a.css_to_rgb=function(a,c,f,k){k=k||new Float32Array(3);k[0]=a/255;k[1]=c/255;k[2]=f/255;d.tu(k,k);return k};a.rgb_to_css=function(a){a=d.Bo(a,c);return[Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])]};a.rgb_to_css_hex=
function(a){function l(a){a=Math.round(255*a).toString(16);return 1==a.length?"0"+a:a}a=d.Bo(a,c);return"#"+l(a[0])+l(a[1])+l(a[2])}};
b4w.module.rgba=function(a,q){q("__print");var d=q("__util"),c=new Float32Array(3);a.create=function(){var a=new Float32Array(4);a[3]=1;return a};a.from_values=function(a,c,d,k){var n=new Float32Array(4);n[0]=a;n[1]=c;n[2]=d;n[3]=k;return n};a.set=function(a,c,d,k,n){n[0]=a;n[1]=c;n[2]=d;n[3]=k;return n};a.css_to_rgba=function(a,c,f,k,n){n=n||new Float32Array(4);n[0]=a/255;n[1]=c/255;n[2]=f/255;n[3]=k;d.tu(n,n);return n};a.rgba_to_css=function(a){var l=d.Bo(a,c);return[Math.round(255*l[0]),Math.round(255*
l[1]),Math.round(255*l[2]),a[3]]}};b4w.module.scenes=function(a,q){var d=q("__batch"),c=q("__camera"),b=q("__data"),l=q("__graph"),f=q("__objects"),k=q("__obj_util"),n=q("__physics"),r=q("__print"),e=q("__scenes"),g=q("__util");a.DATA_ID_ALL=f.DATA_ID_ALL;a.set_active=function(a){var b=e.Qh();e.set_active(g.keysearch("name",a,b))};a.get_active=function(){return e.ia()?e.get_active().name:""};a.get_scenes=function(){for(var a=e.Qh(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(e.ia())return e.Fj(e.get_active());
r.error("No active scene");return!1};a.get_object_by_name=function(a,b){var c=f.pf(f.Hm,a,b|0);if(c)return c;r.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,c){if(a=f.pf(f.Gm,a,b,c|0))return a;r.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var c=f.pf(f.Si,a,b|0);if(c)return c;r.error("get object "+a+": not found")};a.get_object_data_id=function(a){return e.get_object_data_id(a)};a.pick_object=f.pick_object;a.outlining_is_enabled=
function(a){return a&&a.f&&a.f.Mb};a.set_outline_intensity=function(a,b){a&&a.f&&a.f.Mb?a.f.Ad=b:r.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=function(a){if(a&&a.f&&a.f.Mb)return a.f.Ad;r.error("get_outline_intensity(): wrong object")};a.apply_outline_anim=function(a,b,c,d){a&&a.f&&a.f.Mb?f.apply_outline_anim(a,b,c,d):r.error("apply_outline_anim(): wrong object")};a.apply_outline_anim_def=function(a){if(a&&a.f&&a.f.Mb){var b=a.f.Tj;f.apply_outline_anim(a,b.Wl,b.Xl,b.Yl)}else r.error("apply_outline_anim_def(): wrong object")};
a.clear_outline_anim=function(a){a&&a.f&&a.f.Mb?f.clear_outline_anim(a):r.error("clear_outline_anim(): wrong object")};a.set_outline_color=e.set_outline_color;a.get_outline_color=function(a){var b=e.get_active();if(b=e.ea(b,"OUTLINE"))return a=a||new Float32Array(3),a.set(b.Ef),a};a.set_glow_intensity=function(b,c){r.error("set_glow_intensity() deprecated, use set_outline_intensity() instead");a.set_outline_intensity(b,c)};a.get_glow_intensity=function(b){r.error("get_glow_intensity() deprecated, use get_outline_intensity() instead");
a.get_outline_intensity(b)};a.apply_glow_anim=function(b,c,d,e){r.error("apply_glow_anim() deprecated, use apply_outline_anim() instead");a.apply_outline_anim(b,c,d,e)};a.apply_glow_anim_def=function(b){r.error("apply_glow_anim_def() deprecated, use apply_outline_anim_def() instead");a.apply_outline_anim_def(b)};a.clear_glow_anim=function(b){r.error("clear_glow_anim() deprecated, use clear_outline_anim() instead");a.clear_outline_anim(b)};a.set_glow_color=function(b){r.error("set_glow_color() deprecated, use set_outline_color() instead");
a.set_outline_color(b)};a.get_glow_color=function(b){r.error("get_glow_color() deprecated, use get_outline_color() instead");a.get_outline_color(b)};a.get_shadow_params=function(){if(!e.ia())return r.error("No active scene"),!1;var a=e.get_active(),b=e.ea(a,"SHADOW_CAST");if(!b)return null;var c=a.k.Zb,d=e.ea(a,"MAIN_OPAQUE"),g=e.ea(a,"DEPTH"),f={};f.csm_resolution=c.csm_resolution;f.self_shadow_polygon_offset=b.self_shadow_polygon_offset;g&&(f.self_shadow_normal_offset=g.self_shadow_normal_offset);
f.enable_csm=c.enable_csm;f.csm_num=c.csm_num;f.csm_first_cascade_border=c.csm_first_cascade_border;f.first_cascade_blur_radius=c.first_cascade_blur_radius;f.csm_last_cascade_border=c.csm_last_cascade_border;f.last_cascade_blur_radius=c.last_cascade_blur_radius;f.fade_last_cascade=c.fade_last_cascade;f.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(f.csm_borders=e.dA(a,d.j),f.blur_radii=new Float32Array(c.csm_num),f.blur_radii.set(d.j.bm.subarray(0,c.csm_num))):(f.csm_borders=null,
f.blur_radii=null);return f};a.set_shadow_params=function(a){if(!e.ia())return r.error("No active scene"),!1;var b=e.get_active();"number"==typeof a.self_shadow_polygon_offset&&l.W(b.k.nb,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var g=e.ea(b,"DEPTH");g&&("number"==typeof a.self_shadow_normal_offset&&(g.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(g.pcf_blur_radius=a.pcf_blur_radius));var f=e.ea(b,
"MAIN_BLEND");f&&("number"==typeof a.self_shadow_normal_offset&&(f.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(f.pcf_blur_radius=a.pcf_blur_radius),f.wa=!0);f=b.k.Zb;"number"==typeof a.csm_first_cascade_border&&(f.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(f.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(f.csm_last_cascade_border=a.csm_last_cascade_border);
"number"==typeof a.last_cascade_blur_radius&&(f.last_cascade_blur_radius=a.last_cascade_blur_radius);if(g){for(var k=g.o,n=0;n<k.length;n++){var q=k[n];q.zd.wc&&(q=q.D,d.Bq(q,f),d.sb(q))}g.wa=!0}g=b.eg.f.L;for(n=0;n<g.length;n++)c.Np(g[n],f);e.kp(b)};a.get_environment_colors=function(){if(!e.ia())return r.error("No active scene"),!1;var a=e.get_active();return e.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(!e.ia())return r.error("No active scene"),!1;var d=e.get_active();
e.set_environment_colors(d,parseFloat(a),b,c)};a.get_fog_color_density=function(a){if(!e.ia())return r.error("No active scene"),!1;var b=e.get_active();return e.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(!e.ia())return r.error("No active scene"),!1;var b=e.get_active();e.set_fog_color_density(b,a)};a.get_ssao_params=function(){if(!e.ia())return r.error("No active scene"),!1;var a=e.get_active();return e.get_ssao_params(a)};a.set_ssao_params=function(a){if(!e.ia())return r.error("No active scene"),
!1;var b=e.get_active();e.set_ssao_params(b,a)};a.get_color_correction_params=function(){if(!e.ia())return r.error("No active scene"),null;var a=e.get_active(),a=e.ea(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(!e.ia())return r.error("No active scene"),null;var b=e.get_active(),b=e.ea(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&
(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.wa=!0};a.get_sky_params=function(){if(!e.ia())return r.error("No active scene"),!1;var a=e.get_active();return e.get_sky_params(a)};a.set_sky_params=function(a){if(!e.ia())return r.error("No active scene"),!1;var b=e.get_active();e.set_sky_params(b,a)};a.get_dof_params=function(){if(!e.ia())return r.error("No active scene"),
!1;var a=e.get_active();return e.ea(a,"DOF")?e.get_dof_params(a):null};a.set_dof_params=function(a){if(!e.ia())return r.error("No active scene"),!1;var b=e.get_active();e.set_dof_params(b,a)};a.get_god_rays_params=function(){if(!e.ia())return r.error("No active scene"),!1;var a=e.get_active();return e.ea(a,"GOD_RAYS")?e.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!e.ia())return r.error("No active scene"),!1;var b=e.get_active();e.set_god_rays_params(b,a)};a.get_bloom_params=
function(){if(!e.ia())return r.error("No active scene"),!1;var a=e.get_active();return e.ea(a,"BLOOM")?e.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!e.ia())return r.error("No active scene"),!1;var b=e.get_active();e.set_bloom_params(b,a)};a.get_glow_material_params=function(){if(!e.ia())return r.error("No active scene"),!1;var a=e.get_active();return e.ea(a,"GLOW_COMBINE")?e.get_glow_material_params(a):null};a.set_glow_material_params=function(a){if(!e.ia())return r.error("No active scene"),
!1;var b=e.get_active();e.set_glow_material_params(b,a)};a.get_wind_params=function(){if(!e.ia())return r.error("No active scene"),!1;var a=e.get_active();return e.get_wind_params(a)};a.set_wind_params=function(a){if(!e.ia())return r.error("No active scene"),!1;var b=e.get_active();f.set_wind_params(b,a)};a.get_water_surface_level=e.get_water_surface_level;a.set_water_params=function(a){if(!e.ia())return r.error("No active scene"),!1;var b=e.get_active();e.set_water_params(b,a)};a.get_water_mat_params=
function(a){if(!e.ia())return r.error("No active scene"),!1;var b=e.get_active();e.get_water_mat_params(b,a)};a.update_scene_materials_params=function(){if(!e.ia())return r.error("No active scene"),!1;var a=e.get_active();e.Qp(a)};a.hide_object=function(a){k.Jj(a)||g.El(a)?e.hide_object(a):r.error("show/hide is only supported for dynamic meshes/empties")};a.show_object=function(a){k.Jj(a)||g.El(a)?e.show_object(a):r.error("show/hide is only supported for dynamic meshes/empties")};a.is_hidden=function(a){if(k.Jj(a)||
g.El(a))return e.is_hidden(a);r.error("show/hide is only supported for dynamic meshes/empties");return!1};a.is_visible=function(a){return a.f.is_visible};a.check_object=function(a){return e.ia()?f.check_object(a,e.get_active()):(r.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return f.pf(f.Hm,a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,c){return f.pf(f.Gm,a,b,c|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return f.pf(f.Si,a,b|0)?!0:!1};a.get_all_objects=
function(a,b){var c=e.get_active();a||(a="ALL");b||0===b||(b=f.DATA_ID_ALL);return f.na(c,a,b)};a.get_object_name=function(a){return a?a.name:(r.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(r.error("Wrong object"),"UNDEFINED")};a.get_object_dg_parent=function(a){r.error("scenes.get_object_dg_parent() deprecated, use objects.get_dg_parent() instead");return f.get_dg_parent(a)};a.get_object_children=function(a){return a.td.slice(0)};a.get_first_character=function(){for(var a=
f.na(e.get_active(),"MESH",f.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(n.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return e.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return e.get_cam_water_depth()};a.get_type_mesh_object=function(a){return g.is_mesh(a)?a.f.type:null};a.get_meta_tags=function(){if(!e.ia())return r.error("No active scene"),!1;var a=e.get_active();return e.get_meta_tags(a)};a.append_object=function(a,b){if(!a.f.ro)return r.error('object "'+
a.name+'" has been created not by coping.'),!1;if(b)var c=e.Qh(),c=g.keysearch("name",b,c);else c=e.get_active();e.append_object(c,a,!0)};a.remove_object=function(a){if(!a.f.ro)return r.error("Can't remove object \""+a.name+'". It was not copied.'),!1;var c=e.get_active();b.hC(c,a,!1);f.remove_object(a)};a.marker_frame=function(a){var b=e.get_active();if(b.timeline_markers&&a in b.timeline_markers)return e.marker_frame(b,a);r.error('"'+a+'" marker not found.');return 0};a.get_mb_params=function(){var a=
e.get_active();return(a=e.ea(a,"MOTION_BLUR"))?{mb_factor:a.mb_factor,mb_decay_threshold:a.mb_decay_threshold}:null};a.set_mb_params=function(a){var b=e.get_active();(b=e.ea(b,"MOTION_BLUR"))?("number"==typeof a.mb_decay_threshold&&(b.mb_decay_threshold=a.mb_decay_threshold),"number"==typeof a.mb_factor&&(b.mb_factor=a.mb_factor)):r.error("The motion blur subscene doesn't exist.")}};b4w.module.sfx=function(a,q){var d=q("__scenes"),c=q("__sfx"),b=q("__print");a.play=function(a,b,d){c.play(a,b,d)};a.play_def=function(a){c.play_def(a)};a.is_play=function(a){return c.is_play(a)};a.speaker_play=function(a,d,k,n){b.error("speaker_play() deprecated, use play() or play_def() instead");c.cyclic(a,d);n&&c.playrate(a,n);c.play(a,0,k)};a.speaker_stop=function(a){b.error("speaker_stop() deprecated, use stop() instead");c.stop(a)};a.stop=function(a){c.stop(a)};a.pause=function(a){c.oD(a)};
a.resume=function(a){c.qD(a)};a.speaker_playback_rate=function(a,d){b.error("speaker_playback_rate() deprecated, use playrate() instead");c.playrate(a,d)};a.playrate=function(a,b){c.playrate(a,b)};a.get_playrate=function(a){return c.get_playrate(a)};a.cyclic=function(a,b){c.cyclic(a,b)};a.is_cyclic=function(a){return c.is_cyclic(a)};a.listener_reset_speed=function(a,b){c.listener_reset_speed(a,b)};a.speaker_reset_speed=function(a,b,d){c.speaker_reset_speed(a,b,d)};a.get_volume=function(a){return a&&
"object"===typeof a?c.get_volume(a):c.lA()};a.set_volume=function(a,b){a&&"object"===typeof a?c.set_volume(a,b):c.VC(b)};a.mute=function(a,b){a&&"object"===typeof a?c.mute(a,b):c.MB(b)};a.is_muted=function(a){return a&&"object"===typeof a?c.is_muted(a):c.TA()};a.get_speaker_objects=function(){return c.get_speaker_objects().slice(0)};a.get_speakers=function(){b.error("get_speakers() deprecated, use get_speaker_objects() instead");return a.get_speaker_objects()};a.check_active_speakers=c.check_active_speakers;
a.set_compressor_params=function(a){c.set_compressor_params(d.get_active(),a)};a.get_compressor_params=function(){return c.get_compressor_params(d.get_active())};a.duck=function(a,b,d){a&&"object"===typeof a?c.duck(a,b,d):c.iz(b,d)};a.unduck=function(a){a&&"object"===typeof a?c.unduck(a):c.RD()};a.apply_playlist=c.apply_playlist;a.clear_playlist=c.clear_playlist;a.detect_audio_container=c.detect_audio_container;a.detect_video_container=c.detect_video_container;a.set_positional_params=c.set_positional_params;
a.get_positional_params=c.get_positional_params;a.set_filter_params=c.set_filter_params;a.get_filter_params=c.get_filter_params;a.get_filter_freq_response=c.get_filter_freq_response;a.get_duration=function(a){if(a&&c.Ee(a))return c.get_duration(a);b.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.textures=function(a,q){var d=q("__print"),c=q("__textures");a.get_canvas_texture_context=function(a,l){l||(l=0);var f=c.aA(a,l);if(f)return f;d.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a,l){l||(l=0);c.cE(a,l)||d.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a,l){l||(l=0);c.play_video(a,l)||d.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a,l){l||(l=0);c.pause_video(a,l)||d.error('Texture with name "'+
a+'" not found!')};a.reset_video=function(a,l){l||(l=0);c.reset_video(a,l)||d.error('Texture with name "'+a+'" not found!')}};b4w.module.time=function(a,q){var d=q("__time");a.set_timeout=d.set_timeout;a.clear_timeout=d.clear_timeout;a.get_timeline=d.get_timeline;a.animate=d.animate;a.clear_animation=d.clear_animation};b4w.module.transform=function(a,q){var d=q("__obj_util"),c=q("__physics"),b=q("__print"),l=q("__quat"),f=q("__transform"),k=q("__util"),n=new Float32Array(3),r=new Float32Array(4);a.SPACE_LOCAL=f.SPACE_LOCAL;a.SPACE_WORLD=f.SPACE_WORLD;a.set_translation=function(a,g,h,k){d.pa(a)?(n[0]=g,n[1]=h,n[2]=k,f.set_translation(a,n),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel=function(a,g,h,k){d.pa(a)?(n[0]=g,n[1]=h,n[2]=k,f.set_translation_rel(a,
n),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,g){d.pa(a)?(f.set_translation(a,g),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel_v=function(a,g){d.pa(a)?(f.set_translation_rel(a,g),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_obj_rel=function(a,g,h,l,r){d.pa(a)?(n[0]=g,n[1]=h,n[2]=l,k.transform_vec3(n,1,r.f.quat,r.f.i,
n),f.set_translation(a,n),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,b){b||(b=new Float32Array(3));f.get_translation(a,b);return b};a.get_translation_rel=function(a,b){b||(b=new Float32Array(3));f.get_translation_rel(a,b);return b};a.set_rotation=function(a,g,h,k,l){d.pa(a)?(r[0]=g,r[1]=h,r[2]=k,r[3]=l,f.set_rotation(a,r),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel=function(a,
g,h,k,l){d.pa(a)?(r[0]=g,r[1]=h,r[2]=k,r[3]=l,f.set_rotation_rel(a,r),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat=function(){b.error("set_rotation_quat() deprecated, use set_rotation() instead");return a.set_rotation};a.set_rotation_v=function(a,g){d.pa(a)?(f.set_rotation(a,g),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel_v=function(a,g){d.pa(a)?(f.set_rotation_rel(a,g),f.p(a),c.sync_transform(a)):
b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat_v=function(){b.error("set_rotation_quat_v() deprecated, use set_rotation_v() instead");return a.set_rotation_v};a.get_rotation=function(a,b){b||(b=new Float32Array(4));f.get_rotation(a,b);return b};a.get_rotation_rel=function(a,b){b||(b=new Float32Array(4));f.get_rotation_rel(a,b);return b};a.get_rotation_quat=function(){b.error("get_rotation_quat() deprecated, use get_rotation() instead");return a.get_rotation};a.set_rotation_euler=
function(a,g,h,k){d.pa(a)?(n[0]=g,n[1]=h,n[2]=k,f.set_rotation_euler(a,n),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel=function(a,g,h,k){d.pa(a)?(n[0]=g,n[1]=h,n[2]=k,f.set_rotation_euler_rel(a,n),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,g){d.pa(a)?(f.set_rotation_euler(a,g),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel_v=
function(a,g){d.pa(a)?(f.set_rotation_euler_rel(a,g),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,c){d.pa(a)?(f.set_scale(a,c),f.p(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale_rel=function(a,c){d.pa(a)?(f.set_scale_rel(a,c),f.p(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_scale=function(a){return f.get_scale(a)};a.get_scale_rel=function(a){return f.get_scale_rel(a)};a.empty_reset_transform=function(a){if("EMPTY"!=
a.type)return b.error("Wrong object: "+a.name),!1;for(var g=0;g<a.td.length;g++)if(!d.pa(a.td[g])){b.error('Wrong object: "'+a.td[g].name+'" is not dynamic.');return}f.set_translation(a,[0,0,0]);f.set_rotation(a,[0,0,0,1]);f.set_scale(a,1);f.p(a);c.sync_transform(a)};a.get_object_size=function(a){return k.is_mesh(a)?f.get_object_size(a):(b.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,c,d){return k.is_mesh(a)?f.get_object_center(a,c,d):(b.error("Wrong object: "+a.name),null)};
a.move_local=function(a,g,h,k){d.pa(a)?(f.move_local(a,g,h,k),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_x_local=function(a,g){if(d.pa(a)){var h=l.setAxisAngle(k.AXIS_X,g,r);f.gp(a,h);f.p(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_y_local=function(a,g){if(d.pa(a)){var h=l.setAxisAngle(k.AXIS_Y,g,r);f.gp(a,h);f.p(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_z_local=
function(a,g){if(d.pa(a)){var h=l.setAxisAngle(k.AXIS_Z,g,r);f.gp(a,h);f.p(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return f.get_object_bounding_box(a)};a.set_tsr=function(a,g){d.pa(a)?(f.set_tsr(a,g),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr_rel=function(a,g){d.pa(a)?(f.set_tsr_rel(a,g),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.get_tsr=function(a,b){b||(b=new Float32Array(8));f.get_tsr(a,b);return b};a.get_tsr_rel=function(a,b){b||(b=new Float32Array(8));f.get_tsr_rel(a,b);return b};a.distance=function(a,b){return f.distance(a,b)}};b4w.module.tsr=function(a,q){q("__print");var d=q("__tsr");a.create=d.create;a.from_values=d.from_values;a.copy=d.copy;a.identity=d.identity;a.create_sep=d.create_sep;a.set_sep=d.set_sep;a.set_trans=d.set_trans;a.set_scale=d.set_scale;a.set_transcale=d.set_transcale;a.set_quat=d.set_quat;a.get_trans_view=d.get_trans_view;a.get_scale=d.get_scale;a.get_quat_view=d.get_quat_view;a.invert=d.invert;a.to_mat4=function(a,b){b||(b=new Float32Array(16));d.to_mat4(a,b);return b};a.from_mat4=d.from_mat4;a.multiply=
d.multiply;a.transform_vec3=d.transform_vec3;a.transform_vec3_inv=d.transform_vec3_inv;a.transform_vectors=d.transform_vectors;a.transform_dir_vectors=d.transform_dir_vectors;a.transform_dir_vec3=d.transform_dir_vec3;a.transform_tangents=d.transform_tangents;a.translate=d.translate;a.interpolate=d.interpolate};b4w.module.util=function(a,q){var d=q("__print"),c=q("__util"),b=q("__vec3");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.f32=function(a){return new Float32Array(a||0)};a.assert=c.assert;a.keyfind=c.keyfind;a.keysearch=c.keysearch;a.matrix_to_quat=function(a){return c.matrix_to_quat(a)};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));
return c.euler_to_quat(a,b)};a.quat_to_euler=function(a,b){b||(b=new Float32Array(3));return c.quat_to_euler(a,b)};a.sign=c.sign;a.clamp=c.clamp;a.quat_to_dir=c.quat_to_dir;a.ground_project_quat=function(a,b){return c.quat_project(a,c.AXIS_MY,c.AXIS_Y,c.AXIS_MZ,b)};a.cam_quat_to_mesh_quat=function(a,b){return c.cam_quat_to_mesh_quat(a,b)};a.quat_project=function(a,f,k,n,r){return 0!=b.dot(k,n)?(d.error("Wrong in-plane direction"),null):c.quat_project(a,f,k,n,r)};a.hash_code=c.hash_code;a.smooth=c.smooth;
a.smooth_v=c.smooth_v;a.is_vector=c.is_vector;a.correct_cam_quat_up=c.correct_cam_quat_up;a.quat_to_angle_axis=c.quat_to_angle_axis;a.random_from_array=c.random_from_array;a.xz_direction=c.xz_direction;a.line_plane_intersect=c.line_plane_intersect;a.is_mesh=c.is_mesh;a.is_armature=c.is_armature;a.angle_wrap_0_2pi=c.angle_wrap_0_2pi;a.angle_wrap_periodic=c.angle_wrap_periodic;a.smooth_step=c.smooth_step;a.lerp=c.lerp};"object"==typeof module&&module.Ln&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,q){q("__print");var d=q("__version");a.version=d.version;a.version_str=d.version_str;a.type=d.type;a.date=d.date;a.date_str=d.date_str};"object"==typeof module&&module.Ln&&b4w.module.version(exports);b4w.module.objects=function(a,q){var d=q("__geometry"),c=q("__objects"),b=q("__obj_util"),l=q("__print"),f=q("__scenes"),k=q("__util");a.get_meta_tags=function(a){if(a)return c.get_meta_tags(a)};a.copy=function(a,r,e){return k.is_mesh(a)?b.pa(a)?d.Sh(a)||d.check_shape_keys(a)||!e?-1==c.na(f.get_active(),"MESH",c.DATA_ID_ALL).indexOf(a)?(l.error('object "'+a.name+'" does not belong to the active scene.'),!1):c.copy(a,r||"",e):(l.error('object "'+a.name+'" has not dynamic geometry for deep copying.'),
!1):(l.error('object "'+a.name+'" is not dynamic.'),!1):(l.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,b,d){if(!k.is_mesh(a))return l.error('The type of the object "'+a.name+'" is not "MESH".'),null;b=b.join("%join%");var g=c.uA(a,b);null!=g?a.f.He[g]=d:l.error('The Value node "'+b+'" was not found in the object "'+a.name+'".')};a.set_nodemat_rgb=function(a,b,d,g,f){if(!k.is_mesh(a))return l.error('The type of the object "'+a.name+'" is not "MESH".'),null;
b=b.join("%join%");var p=c.oA(a,b);null!=p?(a.f.Lc[3*p]=d,a.f.Lc[3*p+1]=g,a.f.Lc[3*p+2]=f):l.error('The RGB node "'+b+'" was not found in the object "'+a.name+'".')};a.update_boundings=function(a){if(!k.is_mesh(a))return l.error('The type of the object "'+a.name+'" is not "MESH".'),!1;if(!d.Sh(a)&&!d.check_shape_keys(a))return l.error('object "'+a.name+'" has not dynamic geometry.'),!1;c.update_boundings(a)};a.get_parent=c.get_parent;a.get_dg_parent=c.get_dg_parent};b4w.module.main=function(a,q){function d(){}function c(){}function b(){}function l(){window.performance||(N.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(N.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});T.$t(0)}function f(a,b){a.addEventListener("webglcontextlost",function(a){a.preventDefault();N.error("WebGL context lost");n()},!1);m.Ed(b);var d=m.js();d&&N.log("%cRENDERER INFO:","color: #00a",
b.getParameter(d.UNMASKED_VENDOR_WEBGL)+", "+b.getParameter(d.UNMASKED_RENDERER_WEBGL));M.Ed(b);t.Ed(b);S.Ed(b);x.Ed(b);v.Ed(b);G.cD(a);u.init(a);y.bu(a.width,a.height,1);K.init();c=h();e()}function k(){d=function(){}}function n(){r()||(ca=performance.now()/1E3,K.pause(),J.pause(),S.pause(),p.pause())}function r(){return ka<ca}function e(){I(e);var a=performance.now()/1E3;oa||(oa=a);var b=a-oa;if(!(b<1/aa.yd)){for(var d=T.get_timeline(),f=0;f<la.length;f++)la[f](d,b);r()||(ka>oa&&(b-=ka-Math.max(ca,
oa)),d+=b,T.$t(d),v.update(),C.update(),G.update(),g(d,b),c(b));oa=a}}function g(a,b){G.is_primary_loaded()&&(z.reset(),U.update(b),L.update(a,b),K.update(a,b),b&&w.update(b),G.is_primary_loaded()&&(J.update(a,b),G.is_primary_loaded()&&(d(b,a),G.is_primary_loaded()&&(D.update(a,b),G.is_primary_loaded()&&(p.update(),A.update(a,b),y.update(a,b),p.rE(),ba&&(ba(Q.toDataURL()),ba=null))))))}function h(){var a=60,c=0,d=aa.Rr,e=aa.Bz;return function(f){f<1/aa.yd||(a=fa.smooth(1/f,a,f,d),f=J.iA(),c=(c+1)%
e,0==c&&b(Math.round(a),f))}}var p=q("__anchors"),w=q("__animation"),C=q("__assets"),B=q("__config"),H=q("__compat"),u=q("__container"),D=q("__controls"),G=q("__data"),v=q("__debug"),m=q("__extensions"),t=q("__geometry"),z=q("__hud"),L=q("__nla"),A=q("__objects"),J=q("__physics"),N=q("__print"),M=q("__renderer"),y=q("__scenes"),K=q("__sfx"),x=q("__shaders"),S=q("__textures"),T=q("__time"),U=q("__transform"),fa=q("__util"),R=q("__version"),W=B.context,aa=B.q,Q=null,V=null,oa=0,ca=0,ka=0,la=[],ba=null,
ea=["webgl","experimental-webgl"],F=null,I=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/aa.yd)}}();a.init=function(a,b){B.WC();N.ZC(aa.console_verbose);var c=R.version_str()+" "+R.type()+" ("+R.date_str()+")";N.log("%cINIT ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;l();Q=a;H.kx();for(var c=null,
d=0;d<ea.length;d++){var e=ea[d];try{c=a.getContext(e,W)}catch(g){}if(c)break}c&&H.fz(c);if(!c)return null;F=c;f(Q,c);B.mx();H.OC(c);x.oB();aa.lo&&(a.style["touch-action"]="none");N.log("%cSET PRECISION:","color: #00a",aa.precision);b?(z.init(b),V=b):(B.q.show_hud_debug_info=!1,B.w.Nl=!1);return c};a.set_check_gl_errors=function(a){v.set_check_gl_errors(a)};a.resize=function(a,b,c){!1!==c&&(Q.style.width=a+"px",Q.style.height=b+"px",V&&(V.style.width=a+"px",V.style.height=b+"px"));V&&(V.width=a,V.height=
b,z.Ji());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))aa.canvas_resolution_factor=1;c=Math.floor(a*aa.canvas_resolution_factor);b=Math.floor(b*aa.canvas_resolution_factor);aa.allow_hidpi&&1<window.devicePixelRatio&&(c*=window.devicePixelRatio,b*=window.devicePixelRatio);Q.width=c;Q.height=b;if(c>F.drawingBufferWidth||b>F.drawingBufferHeight){N.warn("Canvas size exceeds platform limits, downscaling");var d=Math.min(F.drawingBufferWidth/
c,F.drawingBufferHeight/b);c*=d;b*=d;Q.width=c;Q.height=b}y.bu(c,b,c/a);y.ia()&&U.p(y.get_active().eg);g(T.get_timeline(),0);G.hE(Q.width,Q.height)};a.set_fps_callback=function(a){b=a};a.clear_fps_callback=function(){b=function(){}};a.set_render_callback=function(a){d=a};a.clear_render_callback=function(){k()};a.global_timeline=function(){return T.get_timeline()};a.redraw=function(){N.error("redraw() deprecated");g(T.get_timeline(),0)};a.pause=n;a.resume=function(){r()&&(ka=performance.now()/1E3,
K.resume(),J.resume(),S.play(!0),p.resume())};a.is_paused=r;a.reset=function(){G.unload(0);V=Q=null;ka=ca=oa=0;b=function(){};c=function(){};d=function(){};la.length=0;F=null;T.reset()};a.canvas_data_url=function(a){ba=a};a.get_canvas_elem=function(){return Q};a.detect_mobile=function(){return H.detect_mobile()};a.append_loop_cb=function(a){for(var b=0;b<la.length;b++)if(la[b]==a)return;la.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<la.length;b++)if(la[b]==a){la.splice(b,1);break}}};b4w.module.nla=function(a,q){var d=q("__nla"),c=q("__time"),b=q("__print"),l=q("__util");a.set_frame=function(a){a=l.clamp(a,d.get_frame_start(),d.get_frame_end());d.check_logic_nodes()?b.error("The active scene is using NLA script."):d.set_frame(a,c.get_timeline())};a.get_frame=function(){return d.get_frame(c.get_timeline())};a.stop=function(){d.check_logic_nodes()?b.error("The active scene is using NLA script."):d.AD()};a.play=function(a){d.check_logic_nodes()?b.error("The active scene is using NLA script."):
d.dC(a)};a.is_play=function(){return d.is_play()};a.get_frame_start=function(){return d.get_frame_start()};a.get_frame_end=function(){return d.get_frame_end()};a.check_nla=function(){return d.check_nla()};a.check_nla_scripts=function(){return d.check_logic_nodes()};a.check_logic_nodes=function(){return d.check_logic_nodes()};a.set_range=function(a,c){d.check_logic_nodes()?b.error("The active scene is using NLA script."):(c=parseFloat(c)||d.get_frame_end(),a=parseFloat(a)||d.get_frame_end(),c=l.clamp(c,
d.get_frame_start(),d.get_frame_end()),a=l.clamp(a,d.get_frame_start(),c),d.set_range(a,c))};a.reset_range=function(){d.check_logic_nodes()?b.error("The active scene is using NLA script."):d.reset_range()};a.set_cyclic=function(a){d.check_logic_nodes()?b.error("The active scene is using NLA script."):d.set_cyclic(a)};a.clear_callback=function(){d.check_logic_nodes()?b.error("The active scene is using NLA script."):d.clear_callback()}};b4w.module.app=function(a,q){function d(){var a=L.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=L.is_paused(),L.pause()):a||L.resume()},!1)}function c(a,b,c,d){var e=document.createElement("canvas"),g=document.getElementById(a);e.style.position="absolute";e.style.left=0;e.style.top=0;e.style.width=g.offsetWidth+"px";e.style.height=g.offsetHeight+"px";e.width=g.offsetWidth*window.devicePixelRatio;e.height=g.offsetHeight*window.devicePixelRatio;b?(b=document.createElement("canvas"),
b.style.position="absolute",e.style.left=0,e.style.top=0,b.style.pointerEvents="none"):b=null;g||(J.error('Warning: canvas container "'+a+'" not found, appending to body'),g=document.body);g.appendChild(e);if(!L.init(e,b))return c&&B("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",d),!1;b&&v.insert_to_container(b,"LAST");return!0}function b(a,b){a?(b&&(document.getElementById(b).style.display="block"),S=document.getElementById(a)):(S=document.createElement("div"),
S.innerHTML=0,S.style.cssText="position:absolute;top: 23px;right: 20px;font-size: 45px;line-height: 50px;font-weight: bold;color: #000;",v.insert_to_container(S,"JUST_AFTER_CANVAS"))}function l(a,b){var c=String(a);b&&(c+="/"+String(b));S.innerHTML=c}function f(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function k(){var a=v.get_container();L.resize(a.clientWidth,a.clientHeight,!0)}function n(a,b,c){if(u.has_distance_limits(a))var d=M.get_translation(a,
aa),e=u.get_hover_cam_pivot(a,Q),d=K.subtract(d,e,aa),d=Math.max(K.len(d),1);else d=10;e=M.get_rotation(a,oa);b=y.quat_to_dir(e,b,aa);b[1]=0;K.normalize(b,b);K.scale(b,d*c,b);d=M.get_translation(a,Q);K.add(d,b,d);u.hover_cam_set_translation(a,d)}function r(a,b){if(u.has_distance_limits(a)){var c=u.get_hover_angle_limits(a,R);if(0>c[1]-c[0]){var d=u.get_camera_angles(a,W)[1],c=(c[0]-d)/(c[0]-c[1]),d=u.get_cam_dist_limits(a),c=Math.max(c,2/d[0]);u.rotate_hover_camera(a,0,c*b)}}else c=M.get_translation(a,
aa),d=K.scale(y.AXIS_Y,-b,Q),K.add(c,d,c),u.hover_cam_set_translation(a,c)}function e(a,b,c,d){M.move_local(a,5*b,5*c,5*d)}function g(a,b,c){var d=M.get_translation(a,aa),e=u.get_pivot(a,Q),d=K.dist(d,e),e=Math.abs(b);c=Math.pow(e*c,1-Math.pow(e*c,.15));M.move_local(a,0,0>b?.001<d?-d*c:0:c/(1-c)*d,0)}function h(a,b,c,d){for(var e=c*b;0<a;--a)c+=e,d+=e,e=c*b;return d}function p(a,b,c,d,e){e?(e=u.get_pivot(a,aa),a=u.get_eye(a),a=K.dist(e,a)+d,d=0<b?h(b,-c,a,d):h(-b,c/(1-c),a,d)):d-=2*b*c;return d}function w(a,
b){function c(a,b,d,e){if(1==d){var f=t?.003*v[0]:.003*v[1];d=m.get_sensor_value(a,b,0);m.get_sensor_payload(a,b,0)===m.PL_SINGLE_TOUCH_MOVE?(Qa+="X"==e?-d*f:0,vb+="Y"==e?-d*f:0):m.get_sensor_payload(a,b,0)===m.PL_MULTITOUCH_MOVE_PAN&&(a=t?.003*v[1]:7.5E-4*v[0],ja+="X"==e?-d*a:0,wb+="Y"==e?-d*a:0)}}function d(a,b,c,e){if(1==c){c=m.get_sensor_value(a,b,1);u.get_velocity_params(a,v);if(t)f=.003*v[0],g=7.5E-4*v[1];else var f=.003*v[1],g=7.5E-4*v[0];if(1===m.get_sensor_payload(a,b,0))ra+="X"==e?-c*f:
0,ub+="Y"==e?-c*f:0;else if(2===m.get_sensor_payload(a,b,0)||3===m.get_sensor_payload(a,b,0))Ea+="X"==e?-c*g:0,Wb+="Y"==e?-c*g:0}}function f(a){return a[0]&&(a[1]||a[2])}function h(a,b,c){if(1==c)switch(c=m.get_sensor_value(a,b,0),u.get_velocity_params(a,v),b){case "FORWARD":q?C[0]=1:t?(b=u.get_camera_angles(a,W)[1],b=Math.abs(b)>=Math.PI/4?y.AXIS_MZ:y.AXIS_MY,n(a,b,.5*v[0]*c)):l?g(a,-v[2],c):e(a,0,-v[0]*c,0);break;case "BACKWARD":q?C[0]=-1:t?(b=u.get_camera_angles(a,W)[1],b=Math.abs(b)>=Math.PI/
4?y.AXIS_Z:y.AXIS_Y,n(a,b,.5*v[0]*c)):l?g(a,v[2],c):e(a,0,v[0]*c,0);break;case "UP":t?r(a,30*-v[2]*c):q||e(a,0,0,-v[0]*c);break;case "DOWN":t?r(a,30*v[2]*c):q||e(a,0,0,v[0]*c);break;case "LEFT":q?C[1]=1:t?n(a,y.AXIS_MX,.5*v[0]*c):e(a,-v[0]*c,0,0);break;case "RIGHT":q?C[1]=-1:t?n(a,y.AXIS_X,.5*v[0]*c):e(a,v[0]*c,0,0);break;case "ROT_LEFT":l?u.rotate_target_camera(a,2*-v[1]*c,0):u.rotate_eye_camera(a,2*v[1]*c,0);break;case "ROT_RIGHT":l?u.rotate_target_camera(a,2*v[1]*c,0):u.rotate_eye_camera(a,2*-v[1]*
c,0);break;case "ROT_UP":l?u.rotate_target_camera(a,0,2*-v[1]*c):u.rotate_eye_camera(a,0,2*v[1]*c);break;case "ROT_DOWN":l?u.rotate_target_camera(a,0,2*v[1]*c):u.rotate_eye_camera(a,0,2*-v[1]*c)}else switch(b){case "FORWARD":case "BACKWARD":q&&(C[0]=0);break;case "LEFT":case "RIGHT":q&&(C[1]=0)}q&&(A.set_character_move_dir(q,C[0],C[1]),a=u.get_camera_angles_char(a,R),A.set_character_rotation(q,a[0],a[1]))}T=!0;U=a;fa=b;var k=N.get_active_camera(),l=!1,q=null,t=!1;switch(u.get_move_style(k)){case u.MS_TARGET_CONTROLS:l=
!a;break;case u.MS_EYE_CONTROLS:q=N.get_first_character();break;case u.MS_STATIC:return;case u.MS_HOVER_CONTROLS:t=!0}var v=u.get_velocity_params(k,ca),w=m.create_elapsed_sensor();if(A.has_simulated_physics(k)){var z=m.create_collision_sensor(k,null,!0);m.create_sensor_manifold(k,"CAMERA_COLLISION",m.CT_CONTINUOUS,[z],null,function(a,b,c){if(1==c&&(c=m.get_sensor_payload(a,b,0).coll_dist,0>c)){var d=m.get_sensor_payload(a,b,0).coll_norm;b=aa;K.scale(d,-.25*c,b);c=M.get_translation(a,Q);K.add(c,b,
c);M.set_translation_v(a,c)}})}if(q){var z=M.get_translation(k),B=M.get_rotation(k),B=y.cam_quat_to_mesh_quat(B);z[1]-=.5;A.set_transform(q,z,B);G.append_stiff_trans(k,q,[0,.5,0]);var C=new Float32Array(2),E=!0;A.set_character_move_type(q,A.CM_FLY);m.create_kb_sensor_manifold(k,"TOGGLE_CHAR_MOVE_TYPE",m.CT_SHOT,m.KEY_C,function(){E=!E;A.set_character_move_type(q,E?A.CM_FLY:A.CM_WALK)})}if(b)z=B=D=H=J=L=m.create_custom_sensor(0);else var z=m.create_keyboard_sensor(m.KEY_W),B=m.create_keyboard_sensor(m.KEY_S),
D=m.create_keyboard_sensor(m.KEY_A),H=m.create_keyboard_sensor(m.KEY_D),J=m.create_keyboard_sensor(m.KEY_R),L=m.create_keyboard_sensor(m.KEY_F);var S=m.create_keyboard_sensor(m.KEY_UP),oa=m.create_keyboard_sensor(m.KEY_DOWN),pa=m.create_keyboard_sensor(m.KEY_LEFT),yc=m.create_keyboard_sensor(m.KEY_RIGHT);t||(m.create_sensor_manifold(k,"FORWARD",m.CT_CONTINUOUS,[w,z],null,h),m.create_sensor_manifold(k,"BACKWARD",m.CT_CONTINUOUS,[w,B],null,h));l?(m.create_sensor_manifold(k,"ROT_UP",m.CT_CONTINUOUS,
[w,S,J],f,h),m.create_sensor_manifold(k,"ROT_DOWN",m.CT_CONTINUOUS,[w,oa,L],f,h),m.create_sensor_manifold(k,"ROT_LEFT",m.CT_CONTINUOUS,[w,pa,D],f,h),m.create_sensor_manifold(k,"ROT_RIGHT",m.CT_CONTINUOUS,[w,yc,H],f,h)):t?(m.create_sensor_manifold(k,"LEFT",m.CT_CONTINUOUS,[w,pa,D],f,h),m.create_sensor_manifold(k,"RIGHT",m.CT_CONTINUOUS,[w,yc,H],f,h),m.create_sensor_manifold(k,"FORWARD",m.CT_CONTINUOUS,[w,S,z],f,h),m.create_sensor_manifold(k,"BACKWARD",m.CT_CONTINUOUS,[w,oa,B],f,h),m.create_sensor_manifold(k,
"UP",m.CT_CONTINUOUS,[w,L],f,h),m.create_sensor_manifold(k,"DOWN",m.CT_CONTINUOUS,[w,J],f,h)):(m.create_sensor_manifold(k,"UP",m.CT_CONTINUOUS,[w,J],f,h),m.create_sensor_manifold(k,"DOWN",m.CT_CONTINUOUS,[w,L],f,h),m.create_sensor_manifold(k,"LEFT",m.CT_CONTINUOUS,[w,D],f,h),m.create_sensor_manifold(k,"RIGHT",m.CT_CONTINUOUS,[w,H],f,h),m.create_sensor_manifold(k,"ROT_UP",m.CT_CONTINUOUS,[w,S],f,h),m.create_sensor_manifold(k,"ROT_DOWN",m.CT_CONTINUOUS,[w,oa],f,h),m.create_sensor_manifold(k,"ROT_LEFT",
m.CT_CONTINUOUS,[w,pa],f,h),m.create_sensor_manifold(k,"ROT_RIGHT",m.CT_CONTINUOUS,[w,yc],f,h));var La=0,z=m.create_mouse_wheel_sensor(),Ub=0,B=m.create_touch_zoom_sensor();m.create_sensor_manifold(k,"MOUSE_WHEEL",m.CT_LEVEL,[z],null,function(a,b,c){1==c&&(b=m.get_sensor_value(a,b,0),u.get_velocity_params(a,v),l||t?La=p(a,b,v[2],La,l):(v[0]*=1+b*v[2],u.set_velocity_params(a,v)))});m.create_sensor_manifold(k,"TOUCH_ZOOM",m.CT_LEVEL,[B],null,function(a,b,c){1==c&&(c=m.get_sensor_value(a,b,0),u.get_velocity_params(a,
v),m.get_sensor_payload(a,b,0)===m.PL_MULTITOUCH_MOVE_ZOOM&&(Ub=p(a,c,.03*v[2],Ub,l)))});m.create_sensor_manifold(k,"ZOOM_INTERPOL",m.CT_CONTINUOUS,[w],null,function(a,b,c){if(1==c&&(l||t))if(1E-5<Math.abs(La)||1E-5<Math.abs(Ub)){b=m.get_sensor_value(a,b,0);c=y.smooth(La,0,b,.1*x);La-=c;var d=y.smooth(Ub,0,b,.15*x);Ub-=d;if(t)r(a,-(c+d));else{b=u.get_pivot(a,aa);var e=u.get_eye(a,Q);.001<K.dist(b,e)+c+d?M.move_local(a,0,c+d,0):(c=K.subtract(e,b,Q),d=K.normalize(c,V),K.scale(d,.001,d),K.add(b,d,c),
M.set_translation_v(a,c),Ub=La=0)}}else Ub=La=0});var ra=0,ub=0,Ea=0,Wb=0,z=m.create_mouse_move_sensor("X"),B=m.create_mouse_move_sensor("Y"),D=m.create_mouse_click_sensor();m.create_sensor_manifold(k,"MOUSE_X",m.CT_LEVEL,[D,z],null,d,"X");m.create_sensor_manifold(k,"MOUSE_Y",m.CT_LEVEL,[D,B],null,d,"Y");var Qa=0,vb=0,ja=0,wb=0,z=m.create_touch_move_sensor("X"),B=m.create_touch_move_sensor("Y");m.create_sensor_manifold(k,"TOUCH_X",m.CT_LEVEL,[z],null,c,"X");m.create_sensor_manifold(k,"TOUCH_Y",m.CT_LEVEL,
[B],null,c,"Y");m.create_sensor_manifold(k,"ROT_TRANS_INTERPOL",m.CT_CONTINUOUS,[w],null,function(a,b,c){if(1==c&&(1E-5<Math.abs(ra)||1E-5<Math.abs(ub)||1E-5<Math.abs(Qa)||1E-5<Math.abs(vb)||1E-5<Math.abs(Ea)||1E-5<Math.abs(Wb)||1E-5<Math.abs(ja)||1E-5<Math.abs(wb))){var d=m.get_sensor_value(a,b,0),e=y.smooth(ra,0,d,.08*x);b=y.smooth(ub,0,d,.08*x);ra-=e;ub-=b;var f=y.smooth(Qa,0,d,.12*x);c=y.smooth(vb,0,d,.12*x);Qa-=f;vb-=c;var g=y.smooth(Ea,0,d,.08*x),h=y.smooth(Wb,0,d,.08*x);Ea-=g;Wb-=h;var k=y.smooth(ja,
0,d,.12*x),d=y.smooth(wb,0,d,.12*x);ja-=k;wb-=d;l?(u.rotate_target_camera(a,e+f,b+c),u.move_pivot(a,g+k,h+d)):t?(e+f&&n(a,y.AXIS_X,.2*(e+f)),b+c&&(e=u.get_camera_angles(a,W)[1],n(a,Math.abs(e)>Math.PI/4?y.AXIS_Z:y.AXIS_Y,.2*(b+c))),u.rotate_hover_camera(a,g+k,0)):(u.rotate_eye_camera(a,.5*(e+f),.5*(b+c)),q&&(a=u.get_camera_angles_char(a,R),A.set_character_rotation(q,a[0],a[1])))}});m.create_kb_sensor_manifold(k,"DEC_STEREO_DIST",m.CT_SHOT,m.KEY_LEFT_SQ_BRACKET,function(a){var b=u.get_stereo_distance(a);
u.set_stereo_distance(a,.9*b)});m.create_kb_sensor_manifold(k,"INC_STEREO_DIST",m.CT_SHOT,m.KEY_RIGHT_SQ_BRACKET,function(a){var b=u.get_stereo_distance(a);u.set_stereo_distance(a,1.1*b)})}function C(){var a=N.get_active_camera();T=!1;for(var b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL".split(" "),c=0;c<b.length;c++)m.remove_sensor_manifold(a,b[c]);u.get_move_style(a)==u.MS_EYE_CONTROLS&&
N.get_first_character()&&G.remove(a)}function B(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div");if(d)for(var h=0;h<d.length;h++){var k=document.getElementById(d[h]);k&&k.parentNode.removeChild(k)}e.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";f.style.cssText="color:#fff;font-size:24px;";g.style.cssText="color:#fff;font-size:20px;";f.innerHTML=a;g.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+
c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(f);e.appendChild(g);document.body.appendChild(e)}function H(a,b,c,d,e){function f(){var h=performance.now()-g;e(b+h*(c-b)/d);(h>=d||!a.parentNode)&&L.remove_loop_cb(f)}var g=performance.now();L.append_loop_cb(f)}q("animation");var u=q("camera"),D=q("config"),G=q("constraints"),v=q("container"),m=q("controls"),t=q("data"),z=q("debug"),L=q("main"),A=q("physics"),J=q("print"),N=q("scenes"),M=q("transform"),y=q("util"),K=q("vec3"),x=1,S=null,T=
!1,U=!1,fa=!1,R=new Float32Array(2),W=new Float32Array(2),aa=new Float32Array(3),Q=new Float32Array(3),V=new Float32Array(3),oa=new Float32Array(4),ca=new Float32Array(3);a.init=function(a){function e(){var a=c(n,J,z,p),f=v.get_canvas();if(a){var m=v.get_container();k();L.set_check_gl_errors(y);B&&(b(q,x),L.set_fps_callback(l));w&&d();r&&L.append_loop_cb(function(){m.style.height=m.clientWidth/r+"px"});h&&L.append_loop_cb(function(){var a=m.clientWidth,b=m.clientHeight;a==f.clientWidth&&b==f.clientHeight||
L.resize(a,b,!0)});H&&L.append_loop_cb(function(){v.force_offsets_updating()});g(f,!0)}else g(f,!1)}function f(a){a.keyCode==m.KEY_P&&(L.is_paused()?L.resume():L.pause())}function g(){}a=a||{};var h=!1,n=null,p=null,q=null,r=0,x=null,y=!1,u=!0,w=!0,z=!0,A=!1,B=!1,C=!1,H=!1,N;for(N in a)switch(N){case "canvas_container_id":n=a.canvas_container_id;break;case "callback":g=a.callback;break;case "autoresize":h=a.autoresize;break;case "do_not_use_onload":break;case "gl_debug":y=a.gl_debug;break;case "show_hud_debug_info":C=
a.show_hud_debug_info;break;case "sfx_mix_mode":A=a.sfx_mix_mode;break;case "show_fps":B=a.show_fps;break;case "track_container_position":H=a.track_container_position;break;case "fps_wrapper_id":x=a.fps_wrapper_id;break;case "fps_elem_id":q=a.fps_elem_id;break;case "error_purge_elements":p=a.error_purge_elements;break;case "report_init_failure":z=a.report_init_failure;break;case "pause_invisible":w=a.pause_invisible;break;case "key_pause_enabled":u=a.key_pause_enabled;break;case "force_container_ratio":r=
a.force_container_ratio;break;default:D.set(N,a[N])}u&&document.addEventListener("keydown",f,!1);D.set("show_hud_debug_info",C);D.set("sfx_mix_mode",A);var J=C||A||null;"complete"==document.readyState?window.setTimeout(e,0):window.addEventListener("load",e,!1);window.addEventListener("unload",function(){t.cleanup()},!1)};a.resize_to_container=k;a.set_onclick=function(a,b){var c=f(a);c.addEventListener("mouseup",function(){b(c.value)},!1)};a.set_onchange=function(a,b){var c=f(a);c.addEventListener("change",
function(){var a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,b){var c=f(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.enable_camera_controls=w;a.disable_camera_controls=C;a.set_camera_move_style=function(a){var b=T;b&&C();var c=N.get_active_camera();u.set_move_style(c,a);b&&w(U,fa)};a.enable_object_controls=function(a){function b(a){return a[0]&&(a[1]||a[2])}function c(a,b,e){if(1==e)switch(e=m.get_sensor_value(a,b,0),b){case "FORWARD":d?A.vehicle_throttle(a,
1):M.move_local(a,0,0,1*e);break;case "BACKWARD":d?A.vehicle_throttle(a,-1):M.move_local(a,0,0,-1*e);break;case "LEFT":d?A.vehicle_steer(a,-1):M.move_local(a,1*e,0,0);break;case "RIGHT":d?A.vehicle_steer(a,1):M.move_local(a,-1*e,0,0)}else switch(b){case "FORWARD":case "BACKWARD":d&&A.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":d&&A.vehicle_steer(a,0)}}var d=A.is_vehicle_chassis(a)||A.is_vehicle_hull(a),e=m.create_elapsed_sensor(),f=m.create_keyboard_sensor(m.KEY_W),g=m.create_keyboard_sensor(m.KEY_S),
h=m.create_keyboard_sensor(m.KEY_A),k=m.create_keyboard_sensor(m.KEY_D),l=m.create_keyboard_sensor(m.KEY_UP),n=m.create_keyboard_sensor(m.KEY_DOWN),p=m.create_keyboard_sensor(m.KEY_LEFT),q=m.create_keyboard_sensor(m.KEY_RIGHT);m.create_sensor_manifold(a,"FORWARD",m.CT_CONTINUOUS,[e,f,l],b,c);m.create_sensor_manifold(a,"BACKWARD",m.CT_CONTINUOUS,[e,g,n],b,c);m.create_sensor_manifold(a,"LEFT",m.CT_CONTINUOUS,[e,h,p],b,c);m.create_sensor_manifold(a,"RIGHT",m.CT_CONTINUOUS,[e,k,q],b,c)};a.disable_object_controls=
function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)m.remove_sensor_manifold(a,b[c])};a.enable_controls=function(a){var b=v.get_container();a=a||!1;m.register_keyboard_events(document,!1);m.register_mouse_events(b,!0,a);m.register_wheel_events(b,!0);m.register_touch_events(b,!0);m.register_device_orientation()};a.disable_controls=function(){var a=v.get_container();m.unregister_keyboard_events(document);m.unregister_mouse_events(a);m.unregister_wheel_events(a);m.unregister_touch_events(a);
m.unregister_device_orientation()};a.enable_debug_controls=function(){m.create_kb_sensor_manifold(null,"CAMERA_SHOT",m.CT_SHOT,m.KEY_K,function(){z.make_camera_frustum_shot()});m.create_kb_sensor_manifold(null,"LIGHT_SHOT",m.CT_SHOT,m.KEY_L,function(){z.make_light_frustum_shot()});m.create_kb_sensor_manifold(null,"TELEMETRY",m.CT_SHOT,m.KEY_T,function(){z.plot_telemetry()})};a.request_fullscreen=function(a,b,c){function d(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===
a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",
d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.requestFullScreen==a.webkitRequestFullScreen?a.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen()};a.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.check_fullscreen=
function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?!0:!1};a.report_app_error=B;a.get_url_params=function(a){a=!!a;var b=location.href.toString();if(-1==b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("="),f=e[0];1<e.length?(e=e[1],a?f in c?c[f].push(e):c[f]=[e]:c[f]=e):a?f in c||(c[f]=[]):c[f]=""}return c};a.css_animate=function(a,
b,c,d,e,f,g,h){function k(e){a&&(l[b]=f+e+g,c>d&&e<=d||c<d&&e>=d)&&(l[b]=f+d+g,h())}if(a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)){f=f||"";g=g||"";h=h||function(){};var l=a.style,m=b.charAt(0).toUpperCase()+b.slice(1);if(void 0==l[b])if(void 0!=l["webkit"+m])b="webkit"+m;else if(void 0!=l["ms"+m])b="ms"+m;else if(void 0!=l["moz"+m])b="moz"+m;else return;H(a,c,d,e,k)}};a.attr_animate=function(a,b,c,d,e,f){function g(e){a&&(0<=e&&a.setAttribute(b,e),c>d&&e<=d||c<d&&e>=d)&&(a.setAttribute(b,d),f())}
a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)&&(f=f||function(){},H(a,c,d,e,g))};a.set_camera_smooth_factor=function(a){x=a};a.get_camera_smooth_factor=function(){return x}};b4w.module.camera_anim=function(a,q){function d(a,b,c,d){b=e.angle_wrap_0_2pi(a-b);a=e.angle_wrap_0_2pi(c-a);if(1E-6>Math.abs(b)||1E-6>2*Math.PI-Math.abs(b))b=0;if(1E-6>Math.abs(a)||1E-6>2*Math.PI-Math.abs(a))a=0;d[0]=b;d[1]=a;return d}var c=q("camera"),b=q("controls"),l=q("print"),f=q("scenes"),k=q("time"),n=q("transform"),r=q("tsr"),e=q("util"),g=q("vec3"),h=q("quat"),p=new Float32Array(2),w=new Float32Array(2),C=new Float32Array(3),B=new Float32Array(3),H=new Float32Array(3),u=new Float32Array(4),
D=new Float32Array(2),G=new Float32Array(2),v=new Float32Array(8),m=new Float32Array(8),t=new Float32Array(8),z=!1,L=!1,A=!1,J=!1;a.track_to_target=function(a,d,f,k,m,q,r,t){if(!c.is_eye_camera(a))l.error("track_to_target(): wrong object");else if(a&&d){if(e.is_vector(d))var v=d;else v=H,n.get_object_center(d,!1,v);d=f||1;f=k||2;var w=m||1;m=q||1;B[0]=0;B[1]=-1;B[2]=0;var z=n.get_rotation(a);q=e.quat_to_dir(z,B);k=c.get_camera_angles(a,p);var A=n.get_translation(a);g.subtract(v,A,C);g.normalize(C,
C);var D=h.rotationTo(q,C,h.create());h.multiply(D,z,u);e.correct_cam_quat_up(u,!1);g.subtract(v,A,B);var J=g.length(B)*(1-1/f),v=Math.asin(C[1]);f=Math.acos(-C[2]/Math.abs(Math.cos(v)));0<C[0]&&(f=2*Math.PI-f);var G=f-k[0],L=v-k[1];H[0]=0;H[1]=0;H[2]=-1;f=n.get_rotation(a);0>e.quat_to_dir(f,H)[1]?(L=0<q[1]?v-Math.PI+k[1]:v+Math.PI+k[1],G=0<G?-Math.PI+G:Math.PI+G):Math.abs(G)>Math.PI&&(G=0<G?G-2*Math.PI:G+2*Math.PI);var ka=0,v=b.create_elapsed_sensor();q=Math.abs(G/d);d=Math.abs(L/d);var la=q>d?q:
d,ba=la+w,ea=ba+m,F=ea+w,I=G,da=L,P=J,ua=function(){b.remove_sensor_manifold(a,"TRACK_TO_TARGET");r&&r()};b.create_sensor_manifold(a,"TRACK_TO_TARGET",b.CT_CONTINUOUS,[v],null,function(a,d,e){if(e)if(c.is_eye_camera(a))if(e=b.get_sensor_value(a,d,0),ka+=e,ka<la){var f=G/la*e;e*=L/la;d=ka/la;d=6*d*(1-d);f*=d;e*=d;I-=f;da-=e;c.rotate_eye_camera(a,f,e)}else ka<ba?(I&&(c.rotate_eye_camera(a,I,da),I=0,t&&t()),d=(ka-la)/w,e=-J*e/w,P-=f,n.move_local(a,0,6*e*d*(1-d),0)):ka<ea?P&&(n.move_local(a,0,P,0),P=
0):ka<F?(d=(ka-ea)/w,e=J*e/w,e=6*e*d*(1-d),n.move_local(a,0,e,0)):(n.set_translation_v(a,A),ua());else ua()})}};a.auto_rotate=function(a,g){function h(f,g,l){if(1==l)if(l=c.get_move_style(f),l==c.MS_STATIC)k();else if(l!=c.MS_HOVER_CONTROLS&&c.has_horizontal_limits(f)){l=c.get_horizontal_limits(f,G);if(null===n||l[0]!=n[0]||l[1]!=n[1]){n=n||D;n.set(l);q=Math.min(.2,e.angle_wrap_0_2pi(n[1]-n[0])/2);l=n;var t=c.get_camera_angles(m,p)[0];l=d(t,l[0],l[1],w);r=a*Math.min(1,l[0]/.2,l[1]/.2)}g=b.get_sensor_value(f,
g,0);l=c.get_camera_angles(f,p)[0];l=d(l,n[0],n[1],w);l[1]>q&&l[0]>q?r=e.sign(r)*a:l[1]<q?r-=Math.pow(a,2)/.4*g:l[0]<q&&(r+=Math.pow(a,2)/.4*g);c.rotate_camera(f,g*r,0)}else n=null,g=b.get_sensor_value(f,g,0),c.rotate_camera(f,g*a,0)}function k(){b.remove_sensor_manifold(m,"AUTO_ROTATE");b.remove_sensor_manifold(m,"DISABLE_AUTO_ROTATE");g()}g=g||function(){};var m=f.get_active_camera();if(c.get_move_style(m)==c.MS_STATIC)l.error("auto_rotate(): wrong camera type");else{var n=null,q=0,r=0;if(b.check_sensor_manifold(m,
"AUTO_ROTATE"))k();else{var t=b.create_mouse_move_sensor("X"),v=b.create_mouse_move_sensor("Y"),u=b.create_mouse_click_sensor(),z=b.create_touch_move_sensor(),A=b.create_touch_zoom_sensor(),B=b.create_elapsed_sensor();b.create_sensor_manifold(m,"DISABLE_AUTO_ROTATE",b.CT_LEVEL,[t,v,u,z,A],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]},k);b.create_sensor_manifold(m,"AUTO_ROTATE",b.CT_CONTINUOUS,[B],function(a){return a[0]},h)}}};a.is_auto_rotate=function(){var a=f.get_active_camera();return b.check_sensor_manifold(a,
"AUTO_ROTATE")};a.check_auto_rotate=function(){var a=f.get_active_camera();return c.get_move_style(a)==c.MS_STATIC?!1:!0};a.move_camera_to_point=function(a,b,d,f,h){if(c.get_move_style(a)!=c.MS_STATIC)l.error("move_camera_to_point(): wrong camera type");else if(!z)if(a)if(b){d=d||1;f=f||.01;var p=e.is_vector(a)?a:n.get_tsr(a,v),q=e.is_vector(b)?b:n.get_tsr(b,m);b=g.distance(r.get_trans_view(p),r.get_trans_view(q))/d;d=e.quat_to_dir(r.get_quat_view(p),e.AXIS_MY,C);var u=e.quat_to_dir(r.get_quat_view(q),
e.AXIS_MY,B);d=Math.min(Math.abs(g.dot(d,u)),1);f=1E3*Math.max(b,Math.acos(d)/f);z=!0;var w=k.animate(0,1,f,function(b){var c=r.interpolate(p,q,e.smooth_step(b),t);A?(k.clear_animation(w),z=A=!1):(n.set_tsr(a,c),1==b&&(z=!1,h&&h()))})}else l.error("move_camera_to_point(): you must specify the point object");else l.error("move_camera_to_point(): you must specify the camera object")};a.rotate_camera=function(a,b,d,e,f){if(!L)if(a)if(b||d){L=!0;var g=0,h=0,m=0!=b?b:d,n=k.animate(0,m,e||1E3,function(e){J?
(k.clear_animation(n),L=J=!1):(g-=e,h-=e,d&&b?c.rotate_camera(a,g,h):d?c.rotate_camera(a,0,h):b&&c.rotate_camera(a,g,0),h=g=e,e==m&&(L=!1,f&&f()))})}else l.error("rotate_camera(): you must specify the rotation angle");else l.error("rotate_camera(): you must specify the camera object")};a.stop_cam_moving=function(){A=!0};a.stop_cam_rotating=function(){J=!0};a.is_moving=function(){return z};a.is_rotating=function(){return L}};b4w.module.gyroscope=function(a,q){function d(a){var b=c.create_gyro_angles_sensor(),d=!0;c.create_sensor_manifold(a,"CAMERA_ROTATE_GYRO",c.CT_CONTINUOUS,[b],null,function(a,b,h){if(0<h){k=c.get_sensor_payload(a,b,0);d&&(f[0]=k[0],f[1]=k[1],f[2]=k[2],d=!1);h=b=0;0==window.orientation&&(b=k[1]-f[1],h=k[0]-f[0],k[1]>r&&k[1]<n&&(h=0));if(180==window.orientation){b=k[1]-f[1];0>k[1]&&(b=-b);h=f[0]-k[0];if(b>Math.PI/2||b<-Math.PI/2)b=0;k[1]>-n&&k[1]<-r&&(h=0)}if(-90==window.orientation){b=k[0]-f[0];if(b>
Math.PI/2||b<-Math.PI/2)b=0;h=f[1]-k[1];if(k[0]>e||k[0]<g)h=0}if(90==window.orientation){b=f[0]-k[0];if(b>Math.PI/2||b<-Math.PI/2)b=0;h=k[1]-f[1];if(k[0]>e||k[0]<g)h=0}l.rotate_camera(a,h,b);f[0]=k[0];f[1]=k[1];f[2]=k[2]}})}var c=q("controls"),b=q("scenes"),l=q("camera"),f=new Float32Array(3),k=new Float32Array(3),n=110*Math.PI/180,r=70*Math.PI/180,e=70*Math.PI/180,g=70*-Math.PI/180;a.enable_camera_rotation=function(){var a=b.get_active_camera();d(a)}};b4w.module.mixer=function(a,q){function d(){H=B.length=0;u=c();D=new Float32Array(u.length);G=new Float32Array(u.length);var a=w.get_speaker_objects();if(a.length){B.push(b());for(var d=0;d<a.length;d++)B.push(f(a[d]));B.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function c(){for(var a=new Float32Array(100),b=0,c=0;100>c;c++)a[c]=20*Math.pow(1E3,b),b+=1/
99;return a}function b(){var a=l("MASTER");a.O.push(["VOLUME",w.get_volume(null),0,1,50,!1]);var b=w.get_compressor_params();b&&(a.O.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.O.push(["KNEE",b.knee,0,40,40,!1]),a.O.push(["RATIO",b.ratio,1,20,20,!1]),a.O.push(["ATTACK",b.attack,0,1,1E3,!1]),a.O.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=w.is_muted(null)?1:0;a.od=-1;return a}function l(a){return{id:a,O:[],fg:0,mute:-1,od:-1,Da:null}}function f(a){var b=l(p.get_object_name(a));b.mute=w.is_muted(a)?
1:0;b.od=0;b.Da=a;return b}function k(a){if(a.Da){a.O.length=0;a.O.push(["VOLUME",w.get_volume(a.Da),0,1,50,!1]);var b=w.get_positional_params(a.Da);b&&(a.O.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.O.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.O.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=w.get_filter_params(a.Da))a.O.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.O.push(["EQ_Q",b.Q,0,10,100,!1]),a.O.push(["EQ_GAIN",b.gain,-70,30,100,!1]);C.clamp(a.fg,0,a.O.length-1)}}function n(a){for(var b=
0;b<B.length;b++){var c=B[b];if(c!=a&&1==c.od)return!0}return!1}function r(a){for(var b=0;b<B.length;b++){var c=B[b];c!=a&&0==c.mute&&0==c.od&&w.mute(c.Da,!1)}}function e(){if(0==B.length)return[0,-1];var a=8*Math.floor(H/8),b=a+7,a=C.clamp(a,0,B.length-1),b=C.clamp(b,0,B.length-1);return[a,b]}var g=q("controls");q("debug");var h=q("hud"),p=q("scenes"),w=q("sfx"),C=q("util"),B=[],H=0,u=null,D=null,G=null;a.enable_mixer_controls=function(){function a(b,c,d){if(1==d){var e=Boolean(g.get_sensor_value(b,
c,2))?-1:1,f=B[H];if(f)switch(d=f.O[f.fg],d[1]=d[5]?d[1]*Math.pow(d[3]/d[2],e/d[4]):d[1]+(d[3]-d[2])/d[4]*e,d[1]=C.clamp(d[1],d[2],d[3]),d[0]){case "VOLUME":"MASTER"!=f.id?w.set_volume(f.Da,d[1]):w.set_volume(null,d[1]);break;case "DIST_REF":e=w.get_positional_params(f.Da);e.dist_ref=d[1];w.set_positional_params(f.Da,e);break;case "ATTENUATION":e=w.get_positional_params(f.Da);e.attenuation=d[1];w.set_positional_params(f.Da,e);break;case "DIST_MAX":e=w.get_positional_params(f.Da);e.dist_max=d[1];w.set_positional_params(f.Da,
e);break;case "EQ_FREQ":e=w.get_filter_params(f.Da);e.freq=d[1];w.set_filter_params(f.Da,e);break;case "EQ_Q":e=w.get_filter_params(f.Da);e.Q=d[1];w.set_filter_params(f.Da,e);break;case "EQ_GAIN":e=w.get_filter_params(f.Da);e.gain=d[1];w.set_filter_params(f.Da,e);break;case "THRESHOLD":f=w.get_compressor_params();f.threshold=d[1];w.set_compressor_params(f);break;case "KNEE":f=w.get_compressor_params();f.knee=d[1];w.set_compressor_params(f);break;case "RATIO":f=w.get_compressor_params();f.ratio=d[1];
w.set_compressor_params(f);break;case "ATTACK":f=w.get_compressor_params();f.attack=d[1];w.set_compressor_params(f);break;case "RELEASE":f=w.get_compressor_params();f.release=d[1];w.set_compressor_params(f);break;default:throw"Unknown strip param";}"INC_DEC"==c?g.reset_timer_sensor(b,c,6,.35):g.reset_timer_sensor(b,c,6,.05)}else g.reset_timer_sensor(b,c,6,10)}function b(a,c,d){if(1==d){d=Boolean(g.get_sensor_value(a,c,0))?-1:1;if(B.length){1==d&&H<B.length-1?H++:-1==d&&0<H&&H--;d=e();for(var f=d[0];f<=
d[1];f++)k(B[f])}"SWITCH_STRIP"==c?g.reset_timer_sensor(a,c,5,.15+.3):g.reset_timer_sensor(a,c,5,.15)}else g.reset_timer_sensor(a,c,5,10)}d();var c=g.create_keyboard_sensor(g.KEY_LEFT_SQ_BRACKET),f=g.create_keyboard_sensor(g.KEY_RIGHT_SQ_BRACKET),l=g.create_keyboard_sensor(g.KEY_SEMI_COLON),p=g.create_keyboard_sensor(g.KEY_SINGLE_QUOTE),q=g.create_keyboard_sensor(g.KEY_SHIFT),N=g.create_timer_sensor(.15,!0),M=g.create_timer_sensor(.05,!0),c=[c,f,l,p,q,N,M];g.create_sensor_manifold(null,"SWITCH_STRIP",
g.CT_TRIGGER,c,function(a){return(a[0]||a[1])&&!a[4]},b);g.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",g.CT_SHOT,c,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},b);g.create_sensor_manifold(null,"SWITCH_PARAM",g.CT_SHOT,c,function(a){return(a[0]||a[1])&&a[4]},function(a,b){var c=Boolean(g.get_sensor_value(a,b,0))?-1:1,d=B[H];d&&(1==c&&d.fg<d.O.length-1?d.fg++:-1==c&&0<d.fg&&d.fg--)});g.create_sensor_manifold(null,"INC_DEC",g.CT_TRIGGER,c,function(a){return(a[2]||a[3])&&!a[4]},a);g.create_sensor_manifold(null,
"INC_DEC_HOLD",g.CT_SHOT,c,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},a);g.create_sensor_manifold(null,"MUTE_SOLO",g.CT_SHOT,c,function(a){return(a[2]||a[3])&&a[4]},function(a,b){if(Boolean(g.get_sensor_value(a,b,2))){var c=B[H];c&&0<=c.mute&&("MASTER"!=c.id?0==c.mute?(c.mute=1,w.mute(c.Da,!0),1==c.od&&(c.od=0,n(c)||r(c))):(c.mute=0,n(c)||w.mute(c.Da,!1)):0==c.mute?(c.mute=1,w.mute(null,!0)):(c.mute=0,w.mute(null,!1)))}else if((c=B[H])&&0<=c.od)if(0==c.od){c.od=1;w.mute(c.Da,!1);1==c.mute&&(c.mute=
0);for(var d=0;d<B.length;d++){var e=B[d];e!=c&&0==e.mute&&0==e.od&&w.mute(e.Da,!0)}}else c.od=0,n(c)?w.mute(c.Da,!0):r(c)});c=g.create_elapsed_sensor();g.create_sensor_manifold(null,"MIXER_DRAW",g.CT_CONTINUOUS,[c],null,function(){if(B[H])for(var a=e(),b=a[0];b<=a[1];b++){var c=B[b];h.draw_mixer_strip(c.id,b==H,b%8,c.O,c.fg,c.mute,c.od);if(c.Da&&w.get_filter_params(c.Da)){w.get_filter_freq_response(c.Da,u,D,G);for(c=0;c<D.length;c++)D[c]=20*Math.log(D[c])/Math.LN10;h.plot_array("EQ",b%8,D,20,2E4,
-10,10)}}});c=g.create_timer_sensor(1,!0);g.create_sensor_manifold(null,"MIXER_UPDATE",g.CT_TRIGGER,[c],null,function(){for(var a=e(),b=a[0];b<=a[1];b++)k(B[b])})}};b4w.module.npc_ai=function(a,q){function d(a,b){var c=b.destination,d=H;p.get_translation(b.empty,d);var e=u;p.get_translation(b.collider,e);var f=0;b.Qi?f=b.Qi:b.Ye&&(f=b.Ye,b.type==z&&(f*=.5),b.type==A&&(f*=a));switch(b.type){case z:if(b.random&&b.Jf){c[0]=(12*Math.random()-6)*b.speed+d[0];c[2]=(12*Math.random()-6)*b.speed+d[2];var h=m,d=D,l=b.speed,q=b.rot_speed;p.get_rotation(b.collider,h);C.transformQuat(w.AXIS_Z,h,d);d[1]=0;C.normalize(d,d);h=.5*l/Math.sin(q/2);l=C.dist(c,e);l<2*h&&C.scaleAndAdd(c,
d,2*h-l,c);b.Jf=!1}c[1]=e[1];f&&(c[1]+=f);break;case L:case A:b.random&&b.Jf&&(b.type==A?(b.speed=Math.random()+.1,h=b.EB-b.KB):h=b.max_height-b.min_height,c[0]=10*Math.random()-5+d[0],c[1]=e[1]+(Math.random()*h-.5*h),c[2]=10*Math.random()-5+d[2],b.Jf=!1),f&&(c[1]=e[1]+f)}var c=H,d=u,l=D,e=t,r=b.rig,h=b.collider,f=b.destination,B=b.speed,W=b.actions,aa=n.get_current_anim_name(r);if(!n.is_play(r)||!W.Hj||-1==W.Hj.indexOf(aa)){p.get_translation(h,c);var q=f[0]-c[0],Q=f[2]-c[2],q=Math.sqrt(q*q+Q*Q);
if(q>2*B*a)b.state=20,w.xz_direction(f,c,l),W=b.rig,n.is_animated(W)&&(r=b.speed,B=n.get_frame(W),W=n.get_anim_length(W),r*=W/24*(1-B/W),.9>q/r&&C.scaleAndAdd(f,l,r-q,f)),q=m,r=G,p.get_rotation(b.collider,q),C.transformQuat(w.AXIS_Z,q,d),r[0]=d[0],r[1]=0,r[2]=d[2],C.normalize(r,r),B=C.dot(r,l),W=a/(Math.abs(Math.acos(B))/Math.PI)*b.rot_speed*b.ip,g.rotationTo(r,l,e),g.rotationTo(w.AXIS_Z,r,q),1<=Math.abs(B)?g.copy(q,e):(g.multiply(e,q,e),g.slerp(q,e,Math.min(W,1),e)),l=a,b.type!=L&&(l=Math.max(l,
1/60),q=v,r=m,g.setAxisAngle(w.AXIS_X,-Math.asin(d[1]),r),g.setAxisAngle(w.AXIS_X,-Math.atan(b.Ye/(b.speed*l)),q),g.slerp(r,q,l,q),g.multiply(e,q,e)),p.set_rotation_v(h,e),d=D,h=G,w.quat_to_dir(e,w.AXIS_Z,d),C.scale(d,b.speed*a,h),C.add(h,c,h),h[1]=b.type!=z?(f[1]-c[1])*a*.1+c[1]:f[1],p.set_translation_v(b.collider,h);else if(b.type==z)W.move?aa&&-1!=W.move.indexOf(aa)&&n.is_play(r)?b.state=20:(b.state=10,b.Jf=!0):(b.state=10,b.Jf=!0);else if(b.type==A||b.type==L)b.Jf=!0;if(k(b)&&(c=b.rig,!n.is_play(c))){e=
null;switch(b.state){case 10:e=b.actions;e=e.Hj?w.random_from_array(e.Hj):null;break;case 20:e=n.get_current_anim_name(b.rig),d=f=b.actions,d.Je&&-1==d.Je.indexOf(e)&&d.move&&-1!=d.move.indexOf(e)&&.33<Math.random()?(f=b.actions,e=f.Je[f.move.indexOf(e)]):(d=b.actions,d.move&&(-1!=d.move.indexOf(e)||!d.Je&&!d.yf||!d.yf&&!e||d.Je&&-1!=d.Je.indexOf(e)||d.yf&&-1!=d.yf.indexOf(e))?(f=b.actions,f.Je?(d=f.Je.indexOf(e),-1!=d?(e=d+1,e=e<f.move.length?e:0,e=f.move[e]):e=-1!=f.move.indexOf(e)?e:w.random_from_array(f.move)):
e=w.random_from_array(f.move)):(d=b.actions,e=d.yf&&-1==d.yf.indexOf(e)&&d.move&&-1==d.move.indexOf(e)?w.random_from_array(f.yf):null))}e&&(n.apply(c,e),n.set_behavior(c,n.AB_FINISH_RESET),n.set_frame(c,0),n.play(c))}}}function c(a,b,c,d){if(d)if(1==c)switch(d.type){case L:a:{for(c=0;3>c;c++){var e=r.get_sensor_payload(a,b,c).hit_fract;if(e){b=e;break a}}b=void 0}a=100*b;d.Ye=a<d.min_height?10:a>d.max_height?-10:0;break;case z:a=r.get_sensor_payload(a,b,0).hit_fract;d.Ye=d.Ct==a?0:1-100*a;d.Ct=a;
break;case A:a=r.get_sensor_payload(a,b,0).hit_fract,"CLOSE_GROUND"==b?(d.Ye=100*a-1,d.Ye=.1>d.Ye?.05:0):"CLOSE_WATER"==b&&(d.Qi=100*a,d.Qi=d.Qi<d.KB?-.02:d.Qi>d.EB?.02:0)}else d.Ye=0}function b(){for(var a=0;a<B.length;a++){var b=B[a];l(b);f(b);b.rig&&n.get_current_anim_name(b.rig)&&n.play(b.rig)}}function l(a){var b=C.create(),d=a.collider;switch(a.type){case L:var e=r.create_ray_sensor(d,b,[0,-100,0],"TERRAIN",!0),f=r.create_ray_sensor(d,b,[0,-100,0],"STONE",!0),b=r.create_ray_sensor(d,b,[0,-100,
0],"WATER",!0),e=[e,f,b];r.create_sensor_manifold(d,"CLOSE_GROUND",r.CT_CONTINUOUS,e,function(a){return a[0]||a[1]||a[2]},c,a);break;case z:e=r.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0);e=[e];r.create_sensor_manifold(d,"CLOSE_GROUND",r.CT_CONTINUOUS,e,null,c,a);break;case A:e=r.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0),b=r.create_ray_sensor(d,b,[0,100,0],"WATER",!0),e=[e],r.create_sensor_manifold(d,"CLOSE_WATER",r.CT_CONTINUOUS,[b],null,c,a),r.create_sensor_manifold(d,"CLOSE_GROUND",
r.CT_CONTINUOUS,e,null,c,a)}}function f(a){function b(c,d,e){1==e?(p.get_translation(a.empty,a.destination),a.ip=4):a.ip=1}var c=a.collider;if(a.type==z){var d=r.create_collision_sensor(c,"CONSTRUCTION",!1);r.create_sensor_manifold(c,"CONSTRUCTION_COLL",r.CT_CONTINUOUS,[d],null,b)}}function k(a){var b=a.rig;if(!n.is_play(b))return!0;b=n.get_current_anim_name(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.Hj)return!1;if(-1==c.Hj.indexOf(b))break;break;case 20:if(!c.move||-1!=c.move.indexOf(b)||
c.yf&&-1!=c.yf.indexOf(b)||c.Je&&-1!=c.Je.indexOf(b))return!1;break;default:return!1}return!0}var n=q("animation"),r=q("controls"),e=q("main"),g=q("quat"),h=q("scenes"),p=q("transform"),w=q("util"),C=q("vec3"),B=[];new Float32Array(9);var H=new Float32Array(3),u=new Float32Array(3),D=new Float32Array(3),G=new Float32Array(3),v=new Float32Array(4),m=new Float32Array(4),t=new Float32Array(4),z=a.NT_WALKING=10,L=a.NT_FLYING=20,A=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=new Float32Array(3);
a.start=[];a.ended=[];a.rl=[];a.Ye=null;a.Ct=null;a.Qi=null;a.Jf=!0;a.ip=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.rl[b]=!1;B.push(a)};a.enable_animation=function(){if(B.length){b();var a=r.create_elapsed_sensor();r.create_sensor_manifold(B[0].collider,"ELAPSED",r.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,b,c){if(1==c)for(a=r.get_sensor_value(a,b,0),b=0;b<B.length;b++){c=B[b];var f=a;if(h.is_visible(c.obj))if(c.random)d(f,c);else{for(var g=e.global_timeline(),
k=0;k<c.path.length;k++)if(!c.ended[k]){c.rl[k]||(c.rl[k]=!0,c.destination[0]=c.path[k][0],c.destination[1]=c.path[k][1],c.destination[2]=c.path[k][2],c.start[k]=g+c.delay[k]);if(g<c.start[k])break;d(f,c);c.ended[k]=c.Jf;break}a:{for(f=0;f<c.path.length;f++)if(0==c.ended[f]){f=!1;break a}f=!0}if(f)for(f=0;f<c.path.length;f++)c.rl[f]=!1,c.ended[f]=!1}}})}};a.disable_animation=function(){if(!(0>=B.length))for(var a=0;a<B.length;a++){var b=B[a];r.check_sensor_manifolds(b.collider)&&r.remove_sensor_manifold(b.collider);
n.is_play(b.rig)&&n.stop(b.rig)}}};b4w.module.mouse=function(a,q){function d(){1==A&&(A=0);var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document);p.remove_sensor_manifold(B.get_active_camera(),"SMOOTH_PL")}function c(a){2==A&&(A=0);a.removeEventListener("mousedown",l,!1);a.removeEventListener("mouseup",f,!1);a.removeEventListener("mousemove",b,!1);p.remove_sensor_manifold(B.get_active_camera(),"SMOOTH_DRAG")}function b(a){z()&&(m[0]+=2*(a.clientX-G),m[1]+=
2*(a.clientY-v),G=a.clientX,v=a.clientY);a.preventDefault()}function l(a){G=a.clientX;v=a.clientY;a.currentTarget.addEventListener("mousemove",b,!1);a.preventDefault()}function f(a){a.currentTarget.removeEventListener("mousemove",b,!1);a.preventDefault()}function k(a,b){if(.01<Math.abs(m[0])||.01<Math.abs(m[1])){var c=p.get_sensor_value(a,b,0),d=H.smooth(m[0],0,c,.1*D),e=H.smooth(m[1],0,c,.1*D),c=B.get_first_character(),f=B.get_active_camera();g.rotate_eye_camera(f,4E-4*-d,4E-4*-e);m[0]-=d;m[1]-=
e;c&&(d=g.get_camera_angles_char(f,t),w.set_character_rotation(c,d[0],d[1]))}}function n(){u.detect_mobile()||u.get_canvas_elem().addEventListener("mousemove",e)}function r(){u.detect_mobile()||(u.get_canvas_elem().removeEventListener("mousemove",e),L&&B.set_outline_intensity(L,0))}function e(a){a=h.client_to_canvas_coords(a.clientX,a.clientY,t);(a=B.pick_object(a[0],a[1]))?(B.outlining_is_enabled(a)&&B.set_outline_intensity(a,1),B.outlining_is_enabled(L)&&a!=L&&B.set_outline_intensity(L,0)):B.outlining_is_enabled(L)&&
B.set_outline_intensity(L,0);L=a}var g=q("camera"),h=q("container"),p=q("controls"),w=q("physics"),C=q("print"),B=q("scenes"),H=q("util"),u=q("main"),D=1,G=0,v=0,m=new Float32Array(2),t=new Float32Array(2),z=null,L=null,A=0;a.request_pointerlock=function(a,b,d,e,f){function g(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){c(a);a.addEventListener("mousemove",e,!1);var f=B.get_active_camera();if(!p.check_sensor_manifold(f,"SMOOTH_PL")){var h=
p.create_elapsed_sensor();p.create_sensor_manifold(f,"SMOOTH_PL",p.CT_CONTINUOUS,[h],null,k)}b()}else a.removeEventListener("mousemove",e,!1),A=0,document.removeEventListener("pointerlockchange",g,!1),document.removeEventListener("webkitpointerlockchange",g,!1),document.removeEventListener("mozpointerlockchange",g,!1),d()}if(1!=A){A=1;b=b||function(){};d=d||function(){};f=f||function(){return!0};e=e||function(a){if(f()){if("number"==typeof a.movementX){var b=a.movementX;a=a.movementY}else"number"==
typeof a.webkitMovementX?(b=a.webkitMovementX,a=a.webkitMovementY):"number"==typeof a.mozMovementX?(b=a.mozMovementX,a=a.mozMovementY):a=b=0;m[0]+=b;m[1]+=a}};document.addEventListener("pointerlockchange",g,!1);document.addEventListener("webkitpointerlockchange",g,!1);document.addEventListener("mozpointerlockchange",g,!1);var h=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof h?h.apply(a):C.error("Pointer lock is not available")}};a.exit_pointerlock=d;
a.check_pointerlock=function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,b){if(2!=A){A=2;d();z=b||function(){return!0};a.addEventListener("mousedown",l,!1);a.addEventListener("mouseup",f,!1);var c=B.get_active_camera();if(!p.check_sensor_manifold(c,"SMOOTH_DRAG")){var e=p.create_elapsed_sensor();p.create_sensor_manifold(c,"SMOOTH_DRAG",p.CT_CONTINUOUS,[e],null,k)}}};a.exit_mouse_drag=c;a.enable_mouse_hover_outline=
n;a.enable_mouse_hover_glow=function(){C.error("enable_mouse_hover_glow() deprecated, use enable_mouse_hover_outline() instead");n()};a.disable_mouse_hover_outline=r;a.disable_mouse_hover_glow=function(){C.error("disable_mouse_hover_glow() deprecated, use disable_mouse_hover_outline() instead");r()};a.get_coords_x=function(a){return"clientX"in a?a.clientX:a.touches&&"clientX"in a.touches[0]?a.touches[0].clientX:-1};a.get_coords_y=function(a){return"clientY"in a?a.clientY:a.touches&&"clientY"in a.touches[0]?
a.touches[0].clientY:-1};a.set_plock_smooth_factor=function(a){D=a};a.get_plock_smooth_factor=function(){return D}};b4w.module.preloader=function(a,q){var d=q("app"),c,b,l,f,k,n,r,e,g,h=null;a.create_simple_preloader=function(a){var d=null,e=null,g="#bf9221",q="#000",r;for(r in a)switch(r){case "canvas_container_id":d=a.canvas_container_id;break;case "background_container_id":e=a.background_container_id;break;case "bg_color":q=a.bg_color;break;case "bar_color":g=a.bar_color;break;case "preloader_fadeout":c=a.preloader_fadeout}a=document.createElement("div");r=document.createElement("div");a.id="simple_preloader_container";
var D=document.createElement("div"),G=document.createElement("div"),e=document.getElementById(e);h=document.getElementById(d);a.style.cssText="z-index: 4;background-color: "+q+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";r.style.cssText="position: absolute;left: 50%;top: 82%;width: 300px;height: 20px;margin-left: -150px;margin-top: -10px;border-style:solid;border-width:4px;border-color: #000;border-radius: 0px;";D.style.cssText="position: absolute;left: 0px;top: 1px;width: 0px;height: 18px;background-color: "+
g+";border-radius: 0px;";G.style.cssText="position: absolute;left: 50%;top: 50%;width: 100%;height: 100%;margin-left: -150px;margin-top: -10px;text-align: center;font-size: 17px;font-weight: bold;color: #000;font-family: Verdana;"+r.appendChild(D);r.appendChild(G);a.appendChild(r);document.body.appendChild(a);b="SIMPLE";l=a;f=D;k=G;n=e};a.create_rotation_preloader=function(a){var c=null,d=null,e="rgba(0,0,0,0)",f="",g="",q="rgba(0,0,0,0)",G;for(G in a)switch(G){case "canvas_container_id":c=a.canvas_container_id;
break;case "background_container_id":d=a.background_container_id;break;case "frame_bg_color":e=a.frame_bg_color;break;case "bg_color":q=a.bg_color;break;case "frame_class":f=a.frame_class;break;case "anim_elem_class":g=a.anim_elem_class}a=document.createElement("div");G=document.createElement("div");var v=document.createElement("div"),m=document.createElement("div"),d=document.getElementById(d);h=document.getElementById(c);a.style.cssText="z-index: 4;background-color: "+q+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";
G.style.cssText="position: absolute;left: 50%;top: 50%;width: 117px;height: 117px;margin-left: -58px;margin-top: -58px;background-color: "+e+";";v.style.cssText="position: absolute;left: 0px;top: 0px;width: 100%;height: 100%;background-position: center;background-repeat: no-repeat;";m.style.cssText="position: absolute;width: 100%;height: 100%;text-align: center;margin-top: 38px;font-size: 36px;color: #ffffff;font-family: Arial;font-weight: bold;";v.className=g;G.appendChild(v);G.className=f;G.appendChild(m);
a.appendChild(G);h.appendChild(a);b="ROTATION";l=a;r=v;k=m;n=d};a.create_advanced_preloader=function(a){var c=a.preloader_width,c=c/(c-a.img_width),d=document.getElementById(a.preloader_bar_id),q=document.getElementById(a.fill_band_id),r=document.getElementById(a.preloader_caption_id),u=document.getElementById(a.preloader_container_id),D=document.getElementById(a.background_container_id);h=document.getElementById(a.canvas_container_id);b="ADVANCED";f=d;e=q;g=c;k=r;l=u;n=D};a.update_preloader=function(a){k.innerHTML=
a+"%";"SIMPLE"==b&&(f.style.width=a+"%");"ADVANCED"==b&&(f.style.width=a/g+"%",e.style.width=100-a+"%");"ROTATION"==b&&(r.style.transform="rotate("+a+"deg)");100==a&&(c?(d.css_animate(n,"opacity",1,0,1500,null,null,function(){n.parentNode.removeChild(n)}),d.css_animate(l,"opacity",1,0,1E3,null,null,function(){l.parentNode.removeChild(l)})):(l.parentNode.removeChild(l),n&&n.parentNode.removeChild(n)))}};b4w.module.storage=function(a,q){function d(a){l=a;try{f=window.localStorage}catch(c){b.warn("Applying chrome localStorage bug workaround"),f=null}f||(b.warn("localStorage is not available, initializing temporary storage"),f={})}function c(){return f[l]?JSON.parse(f[l]):{}}var b=q("__print"),l="",f=null;a.init=d;a.set=function(a,b){var d=c();d[a]=String(b);f[l]=JSON.stringify(d)};a.cleanup=function(){delete f[l]};a.get=function(a){var b=c();return b[a]?b[a]:""};a.debug=function(){b.log(c())};d("b4w")};b4w.module.screenshooter=function(a,q){var d=q("main");a.shot=function(){d.canvas_data_url(function(a){var b=window.document.createElement("a");document.body.appendChild(b);b.style.display="none";b.href=a;b.download="screenshot.png";b.click();document.body.removeChild(b)})}};
