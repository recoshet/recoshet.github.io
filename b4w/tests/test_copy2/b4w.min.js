var b4w="object"===typeof b4w?b4w:function(a){var r={};a.module=r;var d={};a.register=function(a,b){r[a]||(r[a]=b)};a.require=function(a,b){if(!r[a])throw Error('Module "'+a+'" not found');b=b||"__b4w_default";d[b]||(d[b]=function(a){return function(b){var c=r[b];if(!c)throw Error('Module "'+b+'" not found');c.Mi||(c.Mi={});c.Mi[a]||(c.Mi[a]={},c(c.Mi[a],d[a]));return c.Mi[a]}}(b));return d[b](a)};a.module_check=function(a){return r[a]?!0:!1};a.get_namespace=function(a){for(var b in d)if(d[b]==a)return b;
return""};a.worker_listeners=[];a.worker_namespaces=[];return a}({});"object"==typeof module&&module.Bn&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a){function r(){var a=d,c=a.getDate(),c=10>c?"0"+String(c):String(c),f=a.getMonth()+1,f=10>f?"0"+String(f):String(f),m=String(a.getFullYear()),k=a.getHours(),k=10>k?"0"+String(k):String(k),p=a.getMinutes(),p=10>p?"0"+String(p):String(p),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return c+"."+f+"."+m+" "+k+":"+p+":"+a}var d=new Date(2015,7,31,12,36,30),c=[15,8];a.version=function(){return c};a.version_str=function(){for(var a="",d=0;d<c.length;d++)a=1==d?a+(10>c[d]?
"0"+c[d]:c[d]):a+c[d],d!=c.length-1&&(a+=".");return a};a.type=function(){return"RELEASE"};a.date=function(){return d};a.date_str=r;a.timestamp=function(){var a=r(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.Bn&&b4w.module.__version(exports);b4w.module.__config=function(a,r){function d(){return b4w.module_check(a.ec.Lk)}function c(){for(var c=a.ec,d=null,k=document.getElementsByTagName("script"),l=0;l<k.length;l++){for(var e=k[l].src,g=0;g<c.Es.length;g++)if(0<=e.indexOf(c.Es[g])){d=e;break}if(null!==d)break}d||(b.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),d=document.location.href);c=d.indexOf("?");0<=c&&(d=d.substring(0,c));return d.substring(0,d.lastIndexOf("/")+1)}var b=r("__print"),
l=r("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.$x=l.la(a.context);a.q={alpha_sort:!0,alpha_sort_threshold:.1,Em:!1,Ng:[5,5],wd:1E4,console_verbose:!1,do_not_load_resources:!1,pm:!1,Gr:1.5,pz:10,background_color:[0,0,0,0],Jg:.01,render_resolution_factor:1,canvas_resolution_factor:1,lm:3,allow_cors:!1,Gn:!1,yk:!0,show_hud_debug_info:!1,MF:!0,Yj:!0,anaglyph_use:!1,$l:!0,sc:!0,Oe:!0,Ah:!0,Kh:!0,Hk:!0,Og:!0,wh:!0,antialiasing:!0,smaa:!1,
wireframe_debug:!1,Xu:!1,Fh:!0,Oj:!0,Db:!0,Vl:!0,water_dynamic:!0,shore_smoothing:!0,ji:!0,Tb:1024,Mg:512,Gu:!0,precision:"highp",quality:a.P_HIGH,Dm:!0,zB:!1,Rt:!1,rr:!1,Ru:!1,Bg:!1,un:!1,br:!1,rs:!1,bn:!1,aH:!1,md:!1,allow_hidpi:!1,gyro_use:!1,Dr:!1,Ao:!1,eo:!1,enable_selectable:!0,enable_outlining:!0,nf:!0,Ps:128,$n:!1,ts:!1,kB:!1,to:[0,0],mj:!1};a.Qy=l.la(a.q);a.ke={Na:-1,Hr:!1,ug:1};a.controls={xB:1/120};a.Id={dir:"ASSETS=../../assets/",sB:15,Oo:!0,yo:!1,rn:!1};a.fx=l.la(a.Id);a.ec={shaders_dir:"",
SC:"include/",YG:"postprocessing/",Lk:"built_in_data",Es:["b4w.min.js","b4w.full.min.js","src/b4w.js","USER_DEFINED_MODULE"],Ft:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.m={enabled:!0,wd:60,fk:"",Xm:!1,ping:!1,rm:!0};a.GB=l.la(a.m);a.gi={ll:1024,Yk:384,jr:32,Jy:128,Iy:256,nt:.25,OB:.5,NB:1};a.tC=l.la(a.gi);a.w={Pp:!0,Dl:!1,uq:!1,Sq:!1,sr:!1};a.RC=l.la(a.w);a.Lb={outlining_overview_mode:!1,zf:[1,.4,.05],yd:1,Ml:.2,Nl:3.8,Ol:1};a.sn={enabled:!1,tD:"MAIN_OPAQUE",sD:0,VC:"DEPTH"};
a.My=l.la(a.sn);a.ax=function(){var b=a.q,c=a.m,d=a.gi;switch(b.quality){case a.P_ULTRA:b.Yj=!0;b.shore_smoothing=!0;b.Oe=!0;b.Ah=!0;b.Kh=!0;b.Hk=!0;b.$l=!0;b.sc=!0;b.Fh=!0;b.Oj=!0;b.Db=!0;b.Vl=!0;b.render_resolution_factor=1.75;d.ll=2048;b.lm=3;b.yk=!0;b.pm=!1;b.precision="highp";b.water_dynamic=!0;b.ji=!0;b.antialiasing=!0;b.smaa=!0;b.wh=!0;b.Og=!0;b.allow_hidpi=!0;b.enable_outlining=!0;b.nf=!0;c.wd=120;break;case a.P_HIGH:b.Yj=!0;b.shore_smoothing=!0;b.Oe=!0;b.Ah=!0;b.Kh=!0;b.Hk=!0;b.$l=!0;b.sc=
!0;b.Fh=!0;b.Oj=!0;b.Db=!0;b.Vl=!0;b.render_resolution_factor=1;d.ll=1024;b.lm=3;b.yk=!0;b.pm=!1;b.precision="highp";b.water_dynamic=!0;b.ji=!0;b.antialiasing=!0;b.smaa=!1;b.wh=!0;b.Og=!0;b.allow_hidpi=!1;b.enable_outlining=!0;b.nf=!0;c.wd=60;break;case a.P_LOW:b.Yj=!1,b.shore_smoothing=!1,b.Oe=!1,b.Ah=!1,b.Kh=!1,b.Hk=!1,b.$l=!1,b.sc=!1,b.Fh=!1,b.Oj=!1,b.Db=!1,b.Vl=!1,b.render_resolution_factor=1,d.ll=512,b.lm=2,b.yk=!1,b.pm=!0,b.precision="mediump",b.water_dynamic=!1,b.ji=!1,b.antialiasing=!1,b.smaa=
!1,b.wh=!1,b.Og=!1,b.allow_hidpi=!1,b.enable_outlining=!1,b.nf=!1,c.wd=60}};a.set=function(c,d){switch(c){case "allow_cors":a.q.allow_cors=d;break;case "allow_hidpi":a.q.allow_hidpi=d;break;case "alpha":a.context.alpha=d;break;case "alpha_sort":a.q.alpha_sort=d;break;case "alpha_sort_threshold":a.q.alpha_sort_threshold=d;break;case "anaglyph_use":a.q.anaglyph_use=d;break;case "animation_framerate":a.ke.Na=d;break;case "antialiasing":a.q.antialiasing=d;break;case "assets_dds_available":a.Id.rn=d;break;
case "assets_min50_available":a.Id.yo=d;break;case "audio":a.w.Pp=d;break;case "background_color":a.q.background_color=d;break;case "built_in_module_name":a.ec.Lk=d;break;case "canvas_resolution_factor":a.q.canvas_resolution_factor=d;break;case "console_verbose":a.q.console_verbose=d;break;case "do_not_load_resources":a.q.do_not_load_resources=d;break;case "gyro_use":a.q.gyro_use=d;break;case "physics_enabled":a.m.enabled=d;break;case "physics_uranium_path":a.m.fk=d;break;case "physics_calc_fps":a.m.Xm=
d;break;case "physics_use_workers":a.m.rm=d;break;case "precision":a.q.precision=d;break;case "quality":a.q.quality=d;break;case "render_resolution_factor":a.q.render_resolution_factor=d;break;case "sfx_mix_mode":a.w.Dl=d;break;case "shaders_dir":a.ec.shaders_dir=d;break;case "show_hud_debug_info":a.q.show_hud_debug_info=d;break;case "smaa":a.q.smaa=d;break;case "smaa_search_texture_path":a.ec.smaa_search_texture_path=d;break;case "smaa_area_texture_path":a.ec.smaa_area_texture_path=d;break;case "wireframe_debug":a.q.wireframe_debug=
d;break;case "enable_selectable":a.q.enable_selectable=d;break;case "enable_outlining":a.q.enable_outlining=d;break;case "outlining_overview_mode":a.Lb.outlining_overview_mode=d;break;case "glow_materials":a.q.nf=d;break;default:b.error("Unknown config property: "+c)}};a.get=function(c){switch(c){case "allow_cors":return a.q.allow_cors;case "allow_hidpi":return a.q.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.q.alpha_sort;case "alpha_sort_threshold":return a.q.alpha_sort_threshold;
case "anaglyph_use":return a.q.anaglyph_use;case "animation_framerate":return a.ke.Na;case "antialiasing":return a.q.antialiasing;case "assets_dds_available":return a.Id.rn;case "assets_min50_available":return a.Id.yo;case "audio":return a.w.Pp;case "background_color":return a.q.background_color;case "built_in_module_name":return a.ec.Lk;case "canvas_resolution_factor":return a.q.canvas_resolution_factor;case "console_verbose":return a.q.console_verbose;case "do_not_load_resources":return a.q.do_not_load_resources;
case "gyro_use":return a.q.gyro_use;case "physics_enabled":return a.m.enabled;case "physics_uranium_path":return a.m.fk;case "physics_calc_fps":return a.m.Xm;case "physics_use_workers":return a.m.rm;case "precision":return a.q.precision;case "quality":return a.q.quality;case "render_resolution_factor":return a.q.render_resolution_factor;case "sfx_mix_mode":return a.w.Dl;case "shaders_dir":return a.ec.shaders_dir;case "show_hud_debug_info":return a.q.show_hud_debug_info;case "smaa":return a.q.smaa;
case "smaa_search_texture_path":return a.ec.smaa_search_texture_path;case "smaa_area_texture_path":return a.ec.smaa_area_texture_path;case "wireframe_debug":return a.q.wireframe_debug;case "enable_selectable":return a.q.enable_selectable;case "enable_outlining":return a.q.enable_outlining;case "outlining_overview_mode":return a.Lb.outlining_overview_mode;case "glow_materials":return a.q.nf;default:b.error("Unknown config property: "+c)}};a.reset=function(){a.context=l.la(a.$x);a.q=l.la(a.Qy);a.Id=
l.la(a.fx);a.m=l.la(a.GB);a.gi=l.la(a.tC);a.w=l.la(a.RC);a.sn=l.la(a.My)};a.BA=d;a.IC=function(){var b=a.ec,m=a.m;d()||""!=b.shaders_dir||(b.shaders_dir=c()+"../shaders/");if(d())b.smaa_search_texture_path="smaa_search_texture.png",b.smaa_area_texture_path="smaa_area_texture.png";else if(""==b.smaa_search_texture_path||""==b.smaa_area_texture_path){var k=c()+b.Ft;b.smaa_search_texture_path=b.smaa_search_texture_path||k+"smaa_search_texture.png";b.smaa_area_texture_path=b.smaa_area_texture_path||k+
"smaa_area_texture.png"}m.enabled&&""==m.fk&&(k=c()+b.Ft,m.fk=k+"uranium.js")};a.get_std_assets_path=function(){return a.Id.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,r){function d(a,d){var h=document.createElement("div"),n=h.style;n.position="absolute";n.backgroundColor="black";n.borderRadius="20px 20px 20px 0px";n.boxShadow="0px 0px 10px rgb(180, 180, 200)";n.opacity=1;n.padding="8px 12px";n.lineHeight="15px";n.visibility="hidden";n.fontSize="12px";var f=p.get_container();f.appendChild(h);var g=e.get_meta_tags(a),k=document.createElement("span"),m=k.style;k.innerHTML=g.title||a.name;m.fontWeight="bold";m.fontSize="12px";m.lineHeight=
"15px";m.color="#fff";m.fontFamily="Arial";l(k);h.appendChild(k);var M=g.description;if(M){var g=document.createElement("div"),I=g.style;I.position="absolute";I.bottom="0px";I.left="0px";I.backgroundColor="#000";I.borderRadius="20px 20px 20px 0px";I.boxShadow="0px 0px 10px rgb(180, 180, 200)";I.visibility="hidden";I.padding="8px 12px";I.overflow="hidden";I.lineHeight="15px";I.fontSize="12px";I.zIndex="2";h.appendChild(g);var L=document.createElement("span"),v=L.style;L.innerHTML=M;v.fontSize="12px";
v.fontFamily="Arial";v.fontWeight="bold";v.lineHeight="15px";v.color="#fff";v.visibility="hidden";g.appendChild(L);var N=!1,u=!1;f.addEventListener("click",function(a){if(!(N||u||G))if(a.target!=k&&a.target!=h||"hidden"!=I.visibility||1!=n.opacity)"visible"==I.visibility&&(n.visibility="visible",m.visibility="visible",I.visibility="hidden",v.visibility="hidden");else{n.visibility="hidden";m.visibility="hidden";I.visibility="visible";N=u=!0;a=h.offsetWidth-24;var e=h.offsetHeight-16,f=Math.min(d,c(M)),
L=b(M,f);L==e&&(I.height=L+"px");f!=a?C.animate(a,f,200,function(a){a==f&&("visible"==I.visibility&&(v.visibility="visible"),N=!1);I.width=a+"px"}):N=!1;L!=e?C.animate(e,L,200,function(a){a==L&&("visible"==I.visibility&&(v.visibility="visible"),u=!1);I.height=a+"px"}):u=!1;u||N||(v.visibility="visible")}},!1)}return h}function c(a){var b=document.createElement("div"),c=document.createElement("span"),h=b.style;c.innerHTML=a;c.style.fontSize="12px";c.style.fontFamily="Arial";c.style.fontWeight="bold";
c.style.color="#fff";c.style.visibility="hidden";h.lineHeight="15px";b.appendChild(c);h.position="absolute";h.visibility="hidden";h.fontSize="12px";h.display="inline-block";h.lineHeight="15px";document.body.appendChild(b);a=b.offsetWidth+1;document.body.removeChild(b);return a}function b(a,b){var c=document.createElement("div"),h=document.createElement("span"),d=c.style;h.innerHTML=a;h.style.fontSize="12px";h.style.fontFamily="Arial";h.style.fontWeight="bold";h.style.color="#fff";h.style.visibility=
"hidden";d.lineHeight="15px";c.appendChild(h);d.position="absolute";d.visibility="hidden";d.fontSize="12px";d.display="inline-block";d.width=b+"px";d.lineHeight="15px";document.body.appendChild(c);h=c.offsetHeight;document.body.removeChild(c);return h}function l(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]="none";a.style.cursor="default"}
function f(){for(var a=0,b=0;b<F.length;b++)F[b].yh&&a++;E=new Float32Array(3*a)}var m=r("__batch"),k=r("__camera"),p=r("__container"),e=r("__objects"),g=r("__print"),h=r("__renderer"),n=r("__scenes"),C=r("__time");r("__util");r("__config");var G=!1,F=[],E=new Float32Array(0),u=new Uint8Array(16),B=new Float32Array(2),A=new Float32Array(3);a.append=function(a){var b;a:{for(b=0;b<F.length;b++)if(F[b].obj==a){b=!0;break a}b=!1}if(!b){b=a.anchor.yh&&Boolean(n.da(n.wg(),"ANCHOR_VISIBILITY"));b={type:a.anchor.type,
obj:a,x:0,y:0,depth:0,qh:"out",yh:b,element:null,Yh:null,Gw:a.anchor.tB,nq:0,el:a.anchor.el};switch(b.type){case "ANNOTATION":b.element=d(a,b.Gw);b.nq=b.element.offsetHeight;break;case "ELEMENT":b.element=document.getElementById(a.anchor.el),b.element||(g.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}F.push(b);f()}};a.remove=function(a){for(var b=0;b<F.length;b++){var c=F[b];if(c.obj==a){"ANNOTATION"==c.type&&(a=c,p.get_container().removeChild(a.element));F.splice(b,
1);f();break}}};a.update=function(){for(var a=0,b=F.length;b--;){var c=F[b];c.yh&&(E.set(c.obj.f.i,3*a),a++);var h,d=c,e=A;h=n.xj(n.wg());h=e=k.project_point(h,d.obj.f.i,e);d=h[0];e=h[1];h=h[2];if(d!=c.x||e!=c.y||h!=c.depth){switch(c.type){case "ANNOTATION":var f=c.element;f.style.left=Math.floor(d)+"px";f.style.top=Math.floor(e-c.nq)+"px";break;case "ELEMENT":var f=c.element,C=f.getBoundingClientRect();f.style.cssText+="left:"+Math.floor(d-C.width/2)+"px;top:"+Math.floor(e-C.height/2)+"px;"}c.x=
d;c.y=e;c.depth=h;c.Yh&&c.Yh(d,e,c.qh,c.obj,f)}}0<a&&(a=n.da(n.wg(),"ANCHOR_VISIBILITY").o[0].D,m.FD(a,E))};a.dE=function(){for(var a=p.get_container(),b=F.length;b--;){var c=F[b],d=c.obj,e=c.x,f=c.y,C=c.depth,C=0>e||0>f||0>C||1<C||n.is_hidden(d)||e>=a.clientWidth||f>=a.clientHeight?"out":"visible";if(c.yh&&"out"!=C){var C=c,g=n.da(n.wg(),"ANCHOR_VISIBILITY").j,M=p.$m(C.x,C.y,B,g);h.zt(g.ye,M[0],g.height-M[1],2,2,u);C=1020==u[0]+u[4]+u[8]+u[12]?"visible":"out"==C.qh||0==u[0]+u[4]+u[8]+u[12]?"covered":
C.qh}if(C!=c.qh){switch(c.type){case "ANNOTATION":case "ELEMENT":var I=c.element;if(!I)break;"out"==C?(I.style.visibility="hidden",I.children.length&&(I.children[0].style.visibility="hidden"),"ANNOTATION"==c.type&&1<I.children.length&&(g=I.children[1],g.style.visibility="hidden",g.children.length&&(g.children[0].style.visibility="hidden"))):"visible"==C?(I.style.visibility="visible",I.children.length&&(I.children[0].style.visibility="visible"),I.style.opacity=1):(I.style.visibility="visible",I.style.opacity=
.1,I.children.length&&(I.children[0].style.visibility="visible"),"ANNOTATION"==c.type&&1<I.children.length&&(g=I.children[1],g.style.visibility="hidden",g.children.length&&(g.children[0].style.visibility="hidden")))}c.qh=C;c.Yh&&c.Yh(e,f,c.qh,d,I)}}};a.attach_move_cb=function(a,b){for(var c=0;c<F.length;c++)F[c].obj==a&&(F[c].Yh=b)};a.detach_move_cb=function(a){for(var b=0;b<F.length;b++)F[b].obj==a&&(F[b].Yh=null)};a.cleanup=function(){for(var a=0;a<F.length;a++){var b=F[a];"ANNOTATION"==b.type&&
p.get_container().removeChild(b.element)}F.length=0};a.is_anchor=function(a){for(var b=0;b<F.length;b++)if(F[b].obj==a)return!0;return!1};a.get_element_id=function(a){for(var b=0;b<F.length;b++)if(F[b].obj==a)return F[b].el;return!1};a.pause=function(){G=!0};a.resume=function(){G=!1}};b4w.module.__boundings=function(a,r){function d(a,b){for(var c=a[0],d=a[1],e=a[2],f=a[0],g=a[1],k=a[2],m=3;m<a.length;m+=3)var t=a[m],l=a[m+1],q=a[m+2],c=Math.max(c,t),d=Math.max(d,l),e=Math.max(e,q),f=Math.min(f,t),g=Math.min(g,l),k=Math.min(k,q);b.max_x=c;b.max_y=d;b.max_z=e;b.min_x=f;b.min_y=g;b.min_z=k;return b}function c(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,e=a.max_z,f=a.min_x,g=a.min_y,k=a.min_z;b[0]=f;b[1]=g;b[2]=k;b[3]=c;b[4]=g;b[5]=k;b[6]=c;b[7]=d;b[8]=k;b[9]=f;b[10]=
d;b[11]=k;b[12]=f;b[13]=g;b[14]=e;b[15]=c;b[16]=g;b[17]=e;b[18]=c;b[19]=d;b[20]=e;b[21]=f;b[22]=d;b[23]=e;return b}function b(a,b,c){m.add(b,c,a.F);m.scale(a.F,.5,a.F);a.Ja=m.distance(a.F,b);return a}var l=r("__tsr"),f=r("__util"),m=r("__vec3"),k=new Float32Array(24),p=new Float32Array(3),e=new Float32Array(3),g=new Float32Array(3);a.Uk=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.sF=function(){return{max_x:1E12,min_x:-1E12,max_y:1E12,
min_y:-1E12,max_z:1E12,min_z:-1E12}};a.nd=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.wr=function(a,b){var c=a.max_y,d=a.max_z,e=a.min_x,f=a.min_y,g=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,e);a.min_y=Math.min(b.min_y,f);a.min_z=Math.min(b.min_z,g)};a.nx=d;a.Tm=function(b,e,C){C||(C=a.nd());b=c(b,k);f.Cf(b,e,b);return d(b,C)};a.hz=c;a.$G=function(b,c,d){d||(d=a.nd());
var e=c.min_x,f=c.max_x,g=c.min_y,k=c.max_y,m=c.min_z;c=c.max_z;if(e>=b.max_x||f<=b.min_x||g>=b.max_y||k<=b.min_y||m>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,e);d.max_x=Math.min(b.max_x,f);d.min_y=Math.max(b.min_y,g);d.max_y=Math.min(b.max_y,k);d.min_z=Math.max(b.min_z,m);d.max_z=Math.min(b.max_z,c);return d};a.dH=function(b,c,d){d||(d=a.nd());var e=b.max_x-b.min_x,f=b.max_y-b.min_y,g=b.max_z-b.min_z;d.min_x=b.min_x-
.5*(c-1)*e;d.max_x=b.max_x+.5*(c-1)*e;d.min_y=b.min_y-.5*(c-1)*f;d.max_y=b.max_y+.5*(c-1)*f;d.min_z=b.min_z-.5*(c-1)*g;d.max_z=b.max_z+.5*(c-1)*g;return d};a.Vm=function(b,c,d){d||(d=a.mk());m.transformMat4(b.F,c,d.F);d.Ja=b.Ja*f.wo(c);return d};a.Um=function(a,b,c){c||(c={Jd:new Float32Array(3),Kd:new Float32Array(3),Ld:new Float32Array(3),F:new Float32Array([0,0,0])});l.transform_vec3(a.F,b,c.F);m.copy(a.Jd,c.Jd);m.copy(a.Kd,c.Kd);m.copy(a.Ld,c.Ld);l.transform_dir_vec3(c.Jd,b,c.Jd);l.transform_dir_vec3(c.Kd,
b,c.Kd);l.transform_dir_vec3(c.Ld,b,c.Ld);return c};a.Wk=function(a,b){return{Ja:a,F:new Float32Array(b)}};a.mk=function(){return{F:new Float32Array([0,0,0]),Ja:0}};a.Vk=function(a,b,c,d){return{Jd:new Float32Array(a),Kd:new Float32Array(b),Ld:new Float32Array(c),F:new Float32Array([d[0],d[1],d[2]])}};a.px=function(){return{F:new Float32Array([0,0,0]),Ja:1E12}};a.dz=function(a,b){var c=m.subtract(b.F,a.F,m.create());0==m.length(c)&&m.set(1,0,0,c);var d=m.normalize(c,m.create()),c=m.scale(d,a.Ja,m.create());
m.add(c,a.F,c);var e=m.scale(d,-a.Ja,m.create());m.add(e,a.F,e);var f=m.scale(d,b.Ja,m.create());m.add(f,b.F,f);var g=m.scale(d,-b.Ja,m.create());m.add(g,b.F,g);c=[c,e,f,g];d=m.normalize(d,m.create());e=c[0];f=c[0];for(g=1;g<c.length;g++){var k=m.dot(c[g],d);k<m.dot(e,d)&&(e=c[g]);k>m.dot(f,d)&&(f=c[g])}d=[e,f];c=d[0];d=d[1];a.F=m.scale(m.add(c,d,m.create()),.5,m.create());a.Ja=m.length(m.subtract(d,c,m.create()))/2};a.cr=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d-2*a);return{Ja:a,height:e,
F:new Float32Array([0,(c+d)/2,0])}};a.er=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d);return{Ja:a,height:e,F:new Float32Array([0,(c+d)/2,0])}};a.dr=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d);return{Ja:a,height:e,F:new Float32Array([0,(c+d)/2,0])}};a.wF=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.$B=function(a){for(var b=0,c=0,d=0,e=0,f=0,g=0,k=0,m=0,t=0;t<a.submeshes.length;t++){var l=
a.submeshes[t];if(l.position.length){b=e=l.position[0];c=f=l.position[1];d=g=l.position[2];break}}for(t=0;t<a.submeshes.length;t++)for(var l=a.submeshes[t],l=l.position,q=0;q<l.length/3;q++)var w=l[3*q],p=l[3*q+1],z=l[3*q+2],b=Math.max(w,b),c=Math.max(p,c),d=Math.max(z,d),e=Math.min(w,e),f=Math.min(p,f),g=Math.min(z,g),k=Math.max(Math.sqrt(w*w+p*p+z*z),k),m=Math.max(Math.sqrt(w*w+z*z),m);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=e;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=f;a.b4w_bounding_box.max_z=
d;a.b4w_bounding_box.min_z=g;a.b4w_bounding_box_source.max_x=b;a.b4w_bounding_box_source.min_x=e;a.b4w_bounding_box_source.max_y=c;a.b4w_bounding_box_source.min_y=f;a.b4w_bounding_box_source.max_z=d;a.b4w_bounding_box_source.min_z=g;a.b4w_bounding_sphere_radius=k;a.b4w_bounding_cylinder_radius=m};a.Yz=function(c){var d=c.subarray(0,3),k=c.subarray(6,9),l=c.subarray(12,15),F=c.subarray(18,21);c=m.subtract(k,d,p);m.normalize(c,c);var E=f.aA(d,k,l,e),E=m.cross(E,c,E);m.normalize(E,E);var u=m.create(),
B=m.create();m.subtract(k,d,g);B[0]=m.dot(g,c);B[1]=m.dot(g,E);k=m.create();m.subtract(l,d,g);k[0]=m.dot(g,c);k[1]=m.dot(g,E);l=m.create();m.subtract(F,d,g);l[0]=m.dot(g,c);l[1]=m.dot(g,E);F=a.mk();l=[u,B,k,l];u=b(F,l[0],l[1]);for(F=2;F<l.length;F++)if(m.distance(u.F,l[F])>u.Ja){for(var A=u,u=l,B=l[F],k=F-1,A=b(A,B,u[0]),t=1;t<=k;t++)if(m.distance(A.F,u[t])>A.Ja){for(var y=A,A=u,q=B,w=u[t],H=t-1,y=b(y,q,w),z=0;z<=H;z++)if(m.distance(y.F,A[z])>y.Ja){var Q=q,P=w,M=A[z],I=m.subtract(P,M,g),I=m.squaredLength(I),
L=m.subtract(Q,M,g),v=m.squaredLength(L),L=m.subtract(Q,P,g),N=m.squaredLength(L),L=I*(v+N-I),T=v*(N+I-v),I=N*(I+v-N),v=L+T+I;m.copy(Q,y.F);m.scale(y.F,L/v,y.F);m.scaleAndAdd(y.F,P,T/v,y.F);m.scaleAndAdd(y.F,M,I/v,y.F);y.Ja=m.distance(y.F,Q)}A=y}u=A}F=u;c=m.scale(c,F.F[0],g);m.scaleAndAdd(c,E,F.F[1],c);m.add(c,d,F.F);return F}};b4w.module.__compat=function(a,r){function d(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function c(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function b(){return!window.ActiveXObject&&"ActiveXObject"in window}var l=r("__config"),f=r("__extensions"),m=r("__print");
r("__util");a.Uy=function(a){a.getError()==a.INVALID_ENUM&&m.warn("Possible Tegra invalid enum issue detected, ignoring")};a.AC=function(a){var p=l.ke,e=l.q,g=l.context,h=l.gi,n=l.w;e.Ps=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);e.Tb=a.getParameter(a.MAX_TEXTURE_SIZE);e.Mg=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var C=Boolean(f.Tz());d("Firefox/28.0")&&(d("Linux")||d("Macintosh"))&&(m.warn("Firefox 28 detected, applying depth hack"),C=!1);d("iPad")||d("iPhone")?(m.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack, applying ios depth hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
g.alpha||(e.background_color[3]=1),e.Ru=!0,e.smaa=!1,e.Oe=!1,e.precision="highp",e.rs=!0,e.ts=!0):d("Mac OS X")&&d("Safari")&&!d("Chrome")&&(m.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),n.uq=!0,n.Sq=!0);d("Windows")&&(d("Chrome/40")||d("Firefox/33")||d("Firefox/34")||d("Firefox/35")||d("Firefox/36"))&&(m.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),e.bn=!0);c()&&(m.warn("Mobile detected, applying various hacks for video textures."),
e.Bg=!0,d("iPad")||d("iPhone")||(m.warn("Mobile (not iOS) detected, disable playback rate for video textures."),n.sr=!0));(d("Firefox/35.0")||d("Firefox/36.0"))&&d("Windows")&&(m.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),e.Dr=!0);if(d("iPhone")||b()||d("Edge"))m.warn("iPhone, IE11 or Edge detected. Enable sequential video fallback for video textures."),e.md=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(m.warn("Not enough varyings, disable shadows on blend objects"),e.rr=
!0);if(g=f.Yr())d("Macintosh")&&-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(m.warn("OS X / Intel HD 3000 detected, applying depth hack"),C=!1),d("Windows")&&d("Chrome")&&!d("Edge")&&-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("Intel")&&(m.warn("Chrome / Windows / Intel GPU detected, applying cubemap mipmap/rgb hack"),e.eo=!0),-1<a.getParameter(g.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(m.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),
C=!1,p.Hr=!0),-1<a.getParameter(g.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(m.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),e.precision="highp",e.Yj=!1),-1<a.getParameter(g.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T760")&&(m.warn('ARM Mali-T760 detected, set "highp" precision and disable SSAO.'),e.precision="highp",e.Oe=!1),-1<a.getParameter(g.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&
-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(m.warn("Qualcomm Adreno detected, applying shader constants hack."),e.Rt=!0,-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(m.warn('Qualcomm Adreno305 detected, set "highp" precision.'),e.precision="highp"),-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(m.warn('Qualcomm Adreno330 detected, set "highp" precision.'),e.precision="highp")),-1<a.getParameter(g.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(g.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&
(m.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),e.Gn=!0),d("Windows")&&d("Chrome")&&!d("Edge")&&a.getParameter(g.UNMASKED_RENDERER_WEBGL).match(/NVIDIA GeForce 8..0/)&&(m.warn("Chrome / Windows / NVIDIA GeForce 8000 series detected, setting max cubemap size to 256."),e.Mg=256);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(m.warn("Vertex textures are not allowed. Disabling vertex textures"),e.Dm=!1);e.allow_hidpi&&1<window.devicePixelRatio&&(m.log("%cENABLE HIDPI MODE",
"color: #00a"),e.render_resolution_factor=1,e.smaa=!1);C||(e.Fh=!1,e.Oj=!1,e.Db=!1,e.water_dynamic=!1,e.shore_smoothing=!1,e.ji=!1,e.smaa=!1);e.Gu=Boolean(f.Zr());e.hj=C;0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(e.precision="mediump");b()&&(m.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),h.Yk=512);if(b()&&d("Touch")||d("Edge"))m.warn("IE11 and touchscreen or Edge detected. Behaviour of the mouse move sensor will be changed."),e.$n=!0;128>=
a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(m.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),e.Gn=!0);d("Chrome")&&!d("Edge")&&(m.log("Chrome detected. Some of deprecated functions related to the Doppler effect won't be called."),e.br=!0);if(d("Chrome")&&!d("Edge")||d("Firefox"))e.un=!0;if(b()||d("iPad"))m.warn("iPad or Internet Explorer detected. Applying alpha clip hack."),e.Em=!0;c()&&d("Firefox")&&(m.log("Mobile firefox detected. Applying autoplay media hack."),
e.Ao=!0);d("Edge")&&(m.warn("Microsoft Edge detected, set up new minimal texture size."),e.mj=!0)};a.detect_mobile=c;a.Zw=function(){d("Firefox/35.0")&&d("Windows")&&(m.warn("Windows/Firefox 35 detected, forcing context's alpha"),l.context.alpha=!0)};a.jo=b};b4w.module.__constraints=function(a,r){function d(a){var b={};b.type=a;return b}function c(a,c){a.pb&&a.pb.T&&b(a.pb.T,a);if(c.T){var I=c.T;if(-1==I.rd.indexOf(a))I.rd.push(a);else throw"Descendant object override is forbidden";}a.pb=c}function b(a,b){var c=a.rd.indexOf(b);if(-1!=c)a.rd.splice(c,1);else throw"No descendant object";}function l(a,b,c){switch(b.type){case 1:var d=a.f.quat,v=b.T.f.Y;c=b.T.f.quat;b.tc?(g.copy(b.tc,d),g.multiply(c,d,d)):g.copy(c,d);C.transformMat4(b.offset,v,a.f.i);a.f.scale=
b.bm*b.T.f.scale;break;case 9:var N=a.f.i,d=a.f.quat,v=b.T.f.Y;c=b.T.f.quat;g.multiply(g.invert(b.Vg,b.Vg),d,d);g.multiply(c,d,d);C.transformMat4(b.offset,v,N);g.copy(c,b.Vg);break;case 10:N=a.f.i;d=a.f.quat;v=b.T.f.Y;c=b.T.f.quat;g.multiply(g.invert(b.Vg,b.Vg),d,d);g.multiply(c,d,d);C.transformMat4(b.offset,v,N);g.copy(c,b.Vg);N=a.f.quat;d=g.multiply(b.T.f.quat,b.tc,t);d=p.Qr(d,G);N=p.Qr(N,F);p.rotate_eye_camera(a,n.bf(N[0],d[0]+b.Ux,d[0]+b.Tx),n.bf(N[1],d[1]+b.Sx,d[1]+b.Vx));break;case 13:var N=
a.f.i,d=a.f.quat,v=b.T.f.Y,l=b.T.f.i,w=b.XC,y=E,u=t;C.transformMat4(b.offset,v,y);n.smooth_v(y,N,c,w,N);v=E;C.sub(l,N,v);C.normalize(v,v);var B=d,N=H,l=N.subarray(0,3),y=N.subarray(3,6),r=N.subarray(6,9);C.copy(v,y);C.negate(y,y);C.normalize(y,y);Boolean(.999999<Math.abs(C.dot(v,n.AXIS_Y)))?(v=e.fromQuat(g.normalize(B,u),z),C.copy(v.subarray(0,3),l)):C.cross(n.AXIS_Y,y,l);C.normalize(l,l);C.cross(l,y,r);C.normalize(r,r);g.fromMat3(N,u);g.normalize(u,u);n.bu(u,d,c,.16*w,d);break;case 2:d=a.f.quat;
N=A;c=t;k(b.T,b.Jk,!0,N,c);b.tc?(g.copy(b.tc,d),g.multiply(c,d,d)):g.copy(c,d);a.f.scale=b.bm*N[3];n.transform_vec3(b.offset,N[3],c,N,a.f.i);break;case 3:N=a.f.i;d=a.f.quat;c=b.T.f.i;f(N,d,c);break;case 4:N=a.f.i;d=a.f.quat;c=b.target;f(N,d,c);break;case 5:N=a.f.i;d=a.f.quat;c=b.T.f.i;f(N,d,c);d=C.dist(N,c);if(d=d>b.dist_max?d-b.dist_max:d<b.jj?d-b.jj:0)C.sub(c,N,E),C.normalize(E,E),C.scale(E,d,E),C.add(N,E,N);break;case 6:N=a.f.i;d=a.f.quat;c=b.target;f(N,d,c);d=C.dist(N,c);if(d=d>b.dist_max?d-b.dist_max:
d<b.jj?d-b.jj:0)C.sub(c,N,E),C.normalize(E,E),C.scale(E,d,E),C.add(N,E,N);break;case 7:v=b.T.f.Y;C.transformMat4(b.offset,v,a.f.i);break;case 8:l=b.T.f.i;N=a.f.i;C.add(l,b.offset,N);break;case 14:d=a.f.quat;v=b.T.f.Y;c=b.T.f.quat;b.tc?(g.copy(b.tc,d),g.multiply(c,d,d)):g.copy(c,d);C.transformMat4(b.offset,v,a.f.i);break;case 11:N=b.T.f;c=h.create_sep(N.i,N.scale,N.quat,q);N=b.mm;h.multiply(c,N,c);N=a.f.i;N[0]=c[0];N[1]=c[1];N[2]=c[2];a.f.scale=c[3];d=a.f.quat;d[0]=c[4];d[1]=c[5];d[2]=c[6];d[3]=c[7];
break;case 12:N=b.mm;d=A;c=t;k(b.T,b.Jk,!0,d,c);w=q;h.set_transcale(d,w);h.set_quat(c,w);h.multiply(w,N,w);N=a.f.i;N[0]=w[0];N[1]=w[1];N[2]=w[2];a.f.scale=w[3];d=a.f.quat;d[0]=w[4];d[1]=w[5];d[2]=w[6];d[3]=w[7];break;case 15:c=b.T,d=p.Wz(c),N=a.f.i,w=p.kl(d,"TOP"),u=p.kl(d,"BOTTOM"),v=w-u,b.Is?(l=p.kl(d,"LEFT"),N[0]=l+v*b.po):(l=p.kl(d,"RIGHT"),N[0]=l-v*b.po),N[2]=b.xu?-(w-v*b.xp):-(u+v*b.xp),p.JA(d)?N[1]=-b.distance:(N[1]=-1,C.normalize(N,N),C.scale(N,b.distance/Math.abs(N[1]),N)),h.transform_dir_vec3(N,
c.f.Ka,N),C.add(c.f.i,N,N),d=a.f.quat,b.tc?(g.copy(b.tc,d),g.multiply(c.f.quat,d,d)):g.copy(c.f.quat,d)}"CAMERA"==a.f.type&&(N=n.AXIS_Y,10==b.type&&(c=b.T.f.quat,N=C.transformQuat(N,c,Q)),p.Dp(a),m(a,N))}function f(a,b,c){var d=E;n.quat_to_dir(b,n.AXIS_MY,d);C.normalize(d,d);var v=u;C.subtract(c,a,v);C.normalize(v,v);a=n.pC(d,v,A);g.multiply(a,b,b);g.normalize(b,b)}function m(a,b){var c=a.f,d=c.quat,v=n.quat_to_dir(c.quat,n.AXIS_Y,E);C.normalize(v,v);if(.999999<Math.abs(C.dot(b,v)))v=g.identity(t);
else{var e=C.cross(b,v,u);C.normalize(e,e);if(c.Ba==p.MS_TARGET_CONTROLS)c.tp&&C.negate(e,e);else{var f=n.quat_to_dir(c.quat,n.AXIS_Z,B);0<C.dot(f,b)&&C.negate(e,e)}c=n.quat_to_dir(c.quat,n.AXIS_X,B);C.normalize(c,c);var f=n.clamp(C.dot(c,e),-1,1),h=Math.acos(f),v=-.999999>=f?g.setAxisAngle(v,h,t):g.rotationTo(c,e,t);g.normalize(v,v)}g.multiply(v,d,d);p.Dp(a)}function k(a,b,c,d,v){var e=a.f,f=e.tg,n=e.$c[b];b=n.fj;a=a.J.pose.bones[n.Mo];var n=a.gq,k=A,l=e.Wc,m=e.Vc,C=e.Pc,z=e.Oc,u=l[4*b+1],p=l[4*
b+2],B=l[4*b+3],E=m[4*b+1],G=m[4*b+2],Q=m[4*b+3];k[0]=(1-f)*l[4*b]+f*m[4*b];k[1]=(1-f)*u+f*E;k[2]=(1-f)*p+f*G;k[3]=(1-f)*B+f*Q;l=t;m=y;l[0]=C[4*b];l[1]=C[4*b+1];l[2]=C[4*b+2];l[3]=C[4*b+3];m[0]=z[4*b];m[1]=z[4*b+1];m[2]=z[4*b+2];m[3]=z[4*b+3];g.slerp(l,m,f,l);f=q;h.set_transcale(k,f);h.set_quat(l,f);c?(c=w,h.translate(n,a.Cw,c),h.multiply(f,c,f)):h.multiply(f,n,f);h.multiply(e.Ka,f,f);d[0]=f[0];d[1]=f[1];d[2]=f[2];d[3]=f[3];v&&(v[0]=f[4],v[1]=f[5],v[2]=f[6],v[3]=f[7])}var p=r("__camera"),e=r("__mat3"),
g=r("__quat"),h=r("__tsr"),n=r("__util"),C=r("__vec3");a.TE=1;a.SE=2;a.XE=3;a.YE=4;a.NE=5;a.OE=6;a.UE=7;a.ME=8;a.RE=9;a.QE=10;a.KE=11;a.LE=12;a.PE=13;a.VE=14;a.WE=15;var G=new Float32Array(2),F=new Float32Array(2),E=new Float32Array(3),u=new Float32Array(3),B=new Float32Array(3),A=new Float32Array(4),t=new Float32Array(4),y=new Float32Array(4),q=new Float32Array(16),w=new Float32Array(16),H=new Float32Array(9),z=new Float32Array(9),q=new Float32Array(8),Q=new Float32Array(3);a.oq=function(a,b,I,e,
v){var f=d(1);f.T=b;f.offset=new Float32Array(I);f.tc=e?new Float32Array(e):null;f.bm=v;c(a,f);l(a,f,0)};a.Sw=function(a,b,I,e,v,f){var h=d(2);h.T=b;h.Jk=I;h.offset=new Float32Array(e);h.tc=v?new Float32Array(v):null;h.bm=f;c(a,h);l(a,h,0)};a.Rw=function(a,b,I,e){var v=d(9),f=a.f.quat,h=b.f.quat;v.T=b;v.offset=new Float32Array(I);v.Vg=new Float32Array(h);e&&(g.copy(e,f),g.multiply(h,f,f));c(a,v);l(a,v,0)};a.Qw=function(a,b,I,e,v,f,h,q){var t=d(10),k=a.f.quat,m=b.f.quat;t.T=b;t.offset=new Float32Array(I);
t.Vg=new Float32Array(m);t.Tx=n.angle_wrap_0_2pi(v);t.Ux=n.angle_wrap_0_2pi(f);t.Vx=n.angle_wrap_periodic(h,-Math.PI,Math.PI);t.Sx=n.angle_wrap_periodic(q,-Math.PI,Math.PI);e?(t.tc=new Float32Array(e),g.copy(e,k),g.multiply(m,k,k)):t.tc=g.create();c(a,t);l(a,t,0)};a.Pw=function(a,b,I,e){var v=d(13);v.T=b;v.offset=new Float32Array(I);v.XC=e;c(a,v);l(a,v,0)};a.Uw=function(a,b,e,f){var v=d(14);v.T=b;v.offset=new Float32Array(e);v.bm=1;v.tc=f?new Float32Array(f):null;c(a,v);l(a,v,0)};a.TG=b;a.Vw=function(a,
b){var e=d(3);e.T=b;c(a,e);l(a,e,0)};a.Ww=function(a,b){var e=d(4);e.target=new Float32Array(b);c(a,e);l(a,e,0)};a.Lw=function(a,b,e,f){var v=d(5);v.T=b;v.jj=e;v.dist_max=f;c(a,v);l(a,v,0)};a.Mw=function(a,b,e,f){var v=d(6);v.target=new Float32Array(b);v.jj=e;v.dist_max=f;c(a,v);l(a,v,0)};a.Tw=function(a,b,e){var f=d(7);f.T=b;f.offset=new Float32Array(e);c(a,f);l(a,f,0)};a.Kw=function(a,b,e){var f=d(8);f.T=b;f.offset=new Float32Array(e);c(a,f);l(a,f,0)};a.Iw=function(a,b,e){var f=d(11);f.T=b;f.mm=
new Float32Array(e);c(a,f);l(a,f,0)};a.Jw=function(a,b,e,f){var v=d(12);v.T=b;v.Jk=e;v.mm=new Float32Array(f);c(a,v);l(a,v,0)};a.append_stiff_viewport=function(a,b,e){var f=d(15);f.T=b;if("left"in e)f.Is=!0,f.po=e.left;else if("right"in e)f.Is=!1,f.po=e.right;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}if("top"in e)f.xu=!0,f.xp=e.top;else if("bottom"in e)f.xu=!1,f.xp=e.bottom;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}"distance"in
e?(f.distance=e.distance,f.tc="rotation"in e?new Float32Array(e.rotation):null,c(a,f),l(a,f,0)):m_print.error("append_stiff_viewport: Wrong positioning params")};a.QD=function(a,b){a.pb&&l(a,a.pb,b)};a.oC=f;a.correct_up=m;a.Kx=function(a){return a.pb?!0:!1};a.remove=function(a){a.pb.T&&b(a.pb.T,a);a.pb=null};a.lG=function(a){return a.pb?a.pb.type:null};a.hd=function(a){a=a.pb;return!a||11!=a.type&&12!=a.type?!1:!0};a.jl=function(a){var b=a.pb;if(b&&11==b.type)return b.T.f.Ka;if(b&&12==b.type){a=A;
var c=t;k(b.T,b.Jk,!0,a,c);b=q;h.set_transcale(a,b);h.set_quat(c,b);return b}return null};a.gd=function(a){a=a.pb;return!a||11!=a.type&&12!=a.type?null:a.mm};a.Oz=k};b4w.module.__container=function(a,r){var d,c,b,l,f;function m(a,b){d=a;c=b}function k(){var a=g.getBoundingClientRect();m(a.left,a.top)}var p=r("__print"),e=r("__util"),g=null,h=null,n=!1;l=b=0;f=1;d=c=0;a.get_canvas=function(){return g};a.get_container=function(){return h};a.init=function(a){a&&a.parentNode?(g=a,h=a.parentNode):e.ja("canvas container is not available")};a.insert_to_container=function(a,b){b=b||"LAST";switch(b){case "FIRST":h.insertBefore(a,h.firstElementChild);break;case "JUST_BEFORE_CANVAS":h.insertBefore(a,
g);break;case "JUST_AFTER_CANVAS":g.nextElementSibling?h.insertBefore(a,g.nextElementSibling):h.appendChild(a,g);break;case "LAST":h.appendChild(a,g);break;default:p.error(b+" invalid stack order")}};a.lA=function(){return b};a.kA=function(){return l};a.set_canvas_offsets=m;a.update_canvas_offsets=k;a.QC=function(a,c,d){b=a;l=c;f=d;k()};a.force_offsets_updating=function(){n=!0};a.client_to_canvas_coords=function(a,b,e){e||(e=new Float32Array(2));var f=e;n&&(k(),n=!1);f[0]=a-d;a=e;n&&(k(),n=!1);a[1]=
b-c;return e};a.$m=function(a,c,d,e){d||(d=new Float32Array(2));d[0]=a*f;d[1]=c*f;e&&(a=e.width/b,d[0]*=a,d[1]*=a);return d};a.AE=function(a,c,d,e){d||(d=new Float32Array(2));d[0]=a/f;d[1]=c/f;e&&(a=e.width/b,d[0]/=a,d[1]/=a)};a.vs=function(b){return b&&b.parentNode?b.parentNode==h?!0:a.vs(b.parentNode):!1};a.Cr=function(a){var b=document.getElementsByTagName("script");a=e.Ij(a);for(var c=0;c<b.length;c++)if(b[c].src==a)return b[c];return null}};b4w.module.__controls=function(a,r){function d(a){return{type:a,value:0,ga:null,td:!1,key:0,ab:"",Nd:!1,en:null,dn:function(){},cn:null,Uq:function(){},Le:null,W:new Float32Array(3),xa:new Float32Array(3),us:!1,pl:!1,yt:0,xt:function(){},axis:"",Uc:0,Ai:new Float32Array(3),Wl:new Float32Array(4),threshold:0,ut:new Float32Array(4),Dk:0,Ck:0,Ht:0,Ek:0,kd:0,repeat:!1,vq:!1,ol:0,nl:0,ml:0,Wn:0,Vn:0,Un:0}}function c(a,x){a.value=Number(x)}function b(a){for(var x=a.Bd,b=a.wC,c=0;c<x.length;c++)b[c]=x[c].value;
return a.jB(b)}function l(a){a=I.indexOf(a);-1<a?I.splice(a,1):y.error("Wrong object")}function f(a,x){for(var b=0,c=0;c<x.length;c++)for(var d=x[c].Xe,e=0;e<d.length;e++)for(var v=d[e].Bd,I=0;I<v.length;I++)v[I]===a&&b++;return b}function m(a,x){switch(a.type){case 80:q.remove_collision_test(a.en,a.ab,a.dn);a.td=!0;break;case 90:q.clear_collision_impulse_test(a.cn);a.td=!0;break;case 100:q.remove_ray_test(a.yt);a.td=!0;break;case 130:a.td=!0}var b=x.indexOf(a);-1<b&&x.splice(b,1)}function k(a){for(var x=
0;x<L.length;x++){var b=L[x];20==b.type&&a.keyCode==b.key&&c(b,1)}O&&a.preventDefault();ia&&ia(a)}function p(a){for(var x=0;x<L.length;x++){var b=L[x];20==b.type&&0==a.keyCode&&16==b.key&&c(b,0);20==b.type&&a.keyCode==b.key&&c(b,0)}O&&a.preventDefault();ia&&ia(a)}function e(a){var x=!1,b=null;Y=!0;ga=a.clientX;S=a.clientY;T=a.clientX;U=a.clientY;for(var d=0;d<L.length;d++){var e=L[d];50==e.type&&(c(e,1),e.ga=a.which);160==e.type&&(x||(x=A.client_to_canvas_coords(a.clientX,a.clientY,ha),b=t.pick_object(x[0],
x[1]),x=!0),e.value=b==e.Le?1:0)}ba&&a.preventDefault();ea&&ea(a)}function g(a){for(var x=0;x<L.length;x++){var b=L[x];50==b.type&&c(b,0);160==b.type&&b.vq&&(b.value=0)}Y=!1;ba&&!na&&a.preventDefault();ea&&ea(a)}function h(a){var x=a.clientX,b=a.clientY;T=x;U=b;if(!M.$n||Y)for(var d=x-ga,e=b-S,v=Math.sqrt(d*d+e*e),I=0;I<L.length;I++){var f=L[I];if(40===f.type)switch(f.axis){case "X":c(f,d);f.ga=x;break;case "Y":c(f,e);f.ga=b;break;case "XY":c(f,v),f.ga[0]=x,f.ga[1]=b}}ba&&!na&&a.preventDefault();
ea&&ea(a)}function n(a){A.vs(a.relatedTarget)||g(a)}function C(a){var x=a.wheelDelta||-40*a.detail,x=x*P.xB;N+=x;for(x=0;x<L.length;x++){var b=L[x];30===b.type&&c(b,N)}J&&a.preventDefault();Z&&Z(a)}function G(a){var x=a.targetTouches;if(1==x.length){for(var b=x[0],x=b.clientX,b=b.clientY,c=!1,d=null,e=0;e<L.length;e++){var v=L[e];160==v.type&&(c||(c=A.client_to_canvas_coords(x,b,ha),d=t.pick_object(c[0],c[1]),c=!0),v.value=d==v.Le)}V[0]=x;V[1]=-1;pa[0]=b;pa[1]=-1}else 1<x.length&&(ma=aa=u(x),V[0]=
x[0].clientX,V[1]=x[1].clientX,pa[0]=x[0].clientY,pa[1]=x[1].clientY);ca.set(V);R.set(pa);la&&la(a)}function F(b){var x=b.targetTouches;if(0!==x.length){if(1===x.length){ca[0]=x[0].clientX;ca[1]=-1;R[0]=x[0].clientY;R[1]=-1;var x=ca[0]-V[0],d=R[0]-pa[0],e=Math.sqrt(x*x+d*d);if(-1!=V[1]&&-1!=pa[1]){var v=ca[0]-V[1],I=R[0]-pa[1],f=Math.sqrt(v*v+I*I);f<e&&(x=v,d=I,e=f)}for(f=0;f<L.length;f++){var h=L[f];if(60===h.type)switch(h.ga=a.PL_SINGLE_TOUCH_MOVE,h.axis){case "X":c(h,x);break;case "Y":c(h,d);break;
case "XY":c(h,e)}}}else if(1<x.length){ca[0]=x[0].clientX;ca[1]=x[1].clientX;R[0]=x[0].clientY;R[1]=x[1].clientY;ma=u(x);e=ma-aa;v=ha;v[0]=(ca[0]+ca[1])/2;v[1]=(R[0]+R[1])/2;I=qa;I[0]=(V[0]+V[1])/2;I[1]=(pa[0]+pa[1])/2;var g,x=v[0],d=v[1],f=I[0],h=I[1];g=Math.sqrt((x-f)*(x-f)+(d-h)*(d-h));for(f=0;f<L.length;f++)if(h=L[f],70===h.type&&Math.abs(g)<Math.abs(e)&&(h.ga=a.PL_MULTITOUCH_MOVE_ZOOM,c(h,e)),60===h.type&&Math.abs(g)>Math.abs(e))switch(h.ga=a.PL_MULTITOUCH_MOVE_PAN,h.axis){case "X":x=v[0]-I[0];
c(h,x);break;case "Y":d=v[1]-I[1];c(h,d);break;case "XY":c(h,g)}}va&&b.preventDefault();la&&la(b)}}function E(a){for(var x=0;x<L.length;x++){var b=L[x];if(170==b.type||180==b.type)b.nl=a.beta,b.ol=a.gamma,b.ml=a.alpha,b.value||(b.Wn=a.gamma,b.Vn=a.beta,b.Un=a.alpha,c(b,1))}}function u(a){var b=a[0],c=a[1];a=b.clientX;var b=b.clientY,d=c.clientX,c=c.clientY;return Math.sqrt((a-d)*(a-d)+(b-c)*(b-c))}var B=r("__config"),A=r("__container"),t=r("__objects"),y=r("__print"),q=r("__physics"),w=r("__quat"),
H=r("__time"),z=r("__util"),Q=r("__vec3"),P=B.controls,M=B.q,I=[],L=[],v={},N=0,T=0,U=0,ga=0,S=0,Y=!1,ca=new Float32Array(2),R=new Float32Array(2),V=new Float32Array(2),pa=new Float32Array(2),ha=new Float32Array(2),qa=new Float32Array(2),ma=0,aa=0,fa=!1,D=0,O=!1,ba=!1,J=!1,va=!1,na=!1,ia=null,ea=null,Z=null,la=null;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.CT_CHANGE=50;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.update=function(K,x){for(var d=
0;d<L.length;d++){var e=L[d],f=K,h=x;if(h)switch(e.type){case 110:var g=e.Le,n=g.f.i,g=g.f.quat,t=Q.dist(e.Ai,n),q=e.ut;w.invert(e.Wl,q);w.multiply(g,q,q);w.normalize(q,q);q=Math.abs(2*Math.acos(q[3]));t/=h;e.Dk=z.smooth(t,e.Dk,h,.3);e.ga[0]=t;t=q/h;e.Ck=z.smooth(t,e.Ck,h,.3);e.ga[1]=t;e.Dk>=e.threshold||e.Ck>=e.Ht?c(e,1):c(e,0);Q.copy(n,e.Ai);w.copy(g,e.Wl);e.Uc=f;break;case 120:g=e.Le;n=g.f.i;g=Math.abs(n[1]-e.Ai[1])/h;e.Ek=z.smooth(g,e.Ek,h,.3);e.ga=g;e.Ek>=e.threshold?c(e,1):c(e,0);Q.copy(n,e.Ai);
e.Uc=f;break;case 130:!e.td&&0<=e.kd&&f-e.Uc>=e.kd&&(c(e,1),e.repeat?e.Uc=f:e.kd=-e.kd);break;case 140:e.Uc||(e.Uc=f);c(e,f-e.Uc);e.Uc=f;break;case 150:c(e,f);break;case 170:e.ga[0]=Math.PI*(e.ol-e.Wn)/180;e.ga[1]=Math.PI*(e.nl-e.Vn)/180;e.ga[2]=Math.PI*(e.ml-e.Un)/180;e.Wn=e.ol;e.Vn=e.nl;e.Un=e.ml;break;case 180:e.ga[0]=Math.PI*e.ol/180,e.ga[1]=Math.PI*e.nl/180,e.ga[2]=Math.PI*e.ml/180}}for(d=0;d<I.length;d++)for(h=I[d],e=h.Xe,f=0;f<e.length;f++)if(n=e[f],n.Au!=D){n.Au=D;q=n;g=0;switch(q.type){case a.CT_CONTINUOUS:g=
q.De;(t=b(q))?(g=1,q.De=1):1==g?(g=-1,q.De=-1):g=0;break;case a.CT_TRIGGER:g=q.De;(t=b(q))&&-1==g?(g=1,q.De=1):t||1!=g?g=0:(g=-1,q.De=-1);break;case a.CT_SHOT:g=q.De;(t=b(q))&&-1==g?(g=1,q.De=1):t||1!=g?g=0:(g=0,q.De=-1);break;case a.CT_LEVEL:t=b(q);q.Fs!=t?(g=1,q.Fs=t):g=0;break;case a.CT_CHANGE:for(var t=q.Bd,q=q.PA,k=0;k<t.length;k++){var l=t[k].value;g||l==q[k]||(g=1);q[k]=l}break;default:z.ja("Wrong sensor manifold type: "+q.type)}if(g&&(t=h==v?null:h,fa=!1,n.callback(t,n.id,g,n.zx),fa)){d=-1;
break}}for(d=0;d<I.length;d++)for(h=I[d],e=h.Xe,f=0;f<e.length;f++)for(n=e[f],h=n.Bd,n=0;n<h.length;n++)switch(g=h[n],g.type){case 30:c(g,0);break;case 40:c(g,0);break;case 60:c(g,0);break;case 70:c(g,0);break;case 130:c(g,0)}N=0;ga=T;S=U;V.set(ca);pa.set(R);aa=ma;D++};a.create_custom_sensor=function(a){var b=d(10);c(b,a);return b};a.create_keyboard_sensor=function(a){var b=d(20);b.key=a;return b};a.create_collision_sensor=function(a,b,e){if(!a||!q.K(a))return y.error("Wrong collision object"),null;
var v=d(80);v.en=a;v.ab=b;v.Nd=e;v.ga={coll_obj:null,coll_pos:e?new Float32Array(3):null,coll_norm:e?new Float32Array(3):null,coll_dist:0};v.dn=function(a,b,x,K,d){c(v,a);a=v.ga;a.coll_obj=b;v.Nd&&(a.coll_pos.set(x),a.coll_norm.set(K),a.coll_dist=d)};v.td=!0;return v};a.create_collision_impulse_sensor=function(a){if(!a||!a.m)return y.error("Wrong collision impulse object"),null;var b=d(90);b.cn=a;b.Uq=function(a){c(b,a)};b.td=!0;return b};a.create_ray_sensor=function(a,b,e,v,I,f,h){var g=d(100);g.Le=
a;g.W=b;g.xa=e;g.ab=v;g.us=I;g.Nd=f;g.pl=h;g.ga={hit_fract:0,obj_hit:null,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3)};g.xt=function(a,b,x,K,d,e){g.us?c(g,-1==b?0:1):c(g,b);g.ga.hit_fract=b;g.ga.obj_hit=x;g.ga.hit_time=K;g.Nd&&(g.ga.hit_pos.set(d),g.ga.hit_norm.set(e))};g.td=!0;return g};a.create_mouse_click_sensor=function(){return d(50)};a.create_mouse_wheel_sensor=function(){return d(30)};a.create_mouse_move_sensor=function(a){var b=d(40);b.axis=a||"XY";b.ga="XY"==b.axis?
new Float32Array(2):0;return b};a.create_touch_move_sensor=function(a){var b=d(60);b.axis=a||"XY";b.ga=0;return b};a.create_touch_zoom_sensor=function(){var a=d(70);a.ga=0;return a};a.create_motion_sensor=function(a,b,c){if(!a)return y.error("Wrong collision object"),null;var e=d(110);e.Le=a;var v=a.f.i;a=a.f.quat;e.ut=new Float32Array(4);e.Ai=new Float32Array(v);e.Wl=new Float32Array(a);e.Dk=0;e.Ck=0;e.threshold=b||.1;e.Ht=c||.1;e.Uc=0;e.ga=new Float32Array([0,0]);return e};a.create_vertical_velocity_sensor=
function(a,b){if(!a)return y.error("Wrong collision object"),null;var c=d(120);c.Le=a;var e=a.f.quat;c.Ai=new Float32Array(a.f.i);c.Wl=new Float32Array(e);c.Ek=0;c.threshold=b||1;c.Uc=0;c.ga=0;return c};a.create_timer_sensor=function(a,b){var c=d(130);c.kd=a;c.repeat=b;c.td=!0;return c};a.reset_timer_sensor=function(a,b,c,d){a=a||v;a=a.pd;if(!a||!a[b])return y.error("reset_timer_sensor(): wrong object"),null;b=a[b].Bd[c];if(!b)return y.error("reset_timer_sensor(): sensor not found"),null;b.Uc=H.get_timeline();
b.kd=d};a.create_elapsed_sensor=function(){var a=d(140);a.Uc=0;return a};a.create_gyro_delta_sensor=function(){var a=d(170);a.ga=new Float32Array(3);return a};a.create_gyro_angles_sensor=function(){var a=d(180);a.ga=new Float32Array(3);return a};a.create_timeline_sensor=function(){return d(150)};a.create_selection_sensor=function(a,b){var c=d(160);c.Le=a;c.vq=b;return c};a.vC=c;a.get_sensor_value=function(a,b,c){a=a||v;a=a.pd;if(!a||!a[b])return y.error("get_sensor_value(): wrong object"),null;b=
a[b].Bd[c];return b?b.value:(y.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=function(a,b,c){a=a||v;a=a.pd;if(!a||!a[b])return y.error("get_sensor_payload(): wrong object"),null;b=a[b].Bd[c];return b?b.ga:(y.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){I=[];L=[];v={}};a.check_sensor_manifold=function(a,b){a=a||v;if(!a.pd)return!1;if(b&&a.pd[b])return!0;if(!b)for(var c in a.pd)return!0;return!1};a.remove_sensor_manifold=function(a,b){a=a||
v;var c=a.pd;if(c){var d=a.Xe;if(b){var e=c[b];if(e){for(var h=e.Bd,g=0;g<h.length;g++)1===f(h[g],I)&&m(h[g],L);delete c[b];e=d.indexOf(e);-1<e?d.splice(e,1):z.ja("Incorrect manifolds array");Object.getOwnPropertyNames(c).length||l(a)}}else{for(b in c){e=c[b];h=e.Bd;for(g=0;g<h.length;g++)1===f(h[g],I)&&m(h[g],L);delete c[b];e=d.indexOf(e);-1<e?d.splice(e,1):z.ja("Incorrect manifolds array")}l(a);fa=!0}}};a.create_sensor_manifold=function(a,b,c,d,e,h,g){a=a||v;a.pd=a.pd||{};a.Xe=a.Xe||[];var t=a.pd,
n=a.Xe,D=t[b];if(D){d=D.Bd;for(var k=0;k<d.length;k++)1===f(d[k],I)&&m(d[k],L);D=n.indexOf(D);-1<D?n.splice(D,1):z.ja("Incorrect manifolds array")}c={id:b,type:c,Bd:d.slice(0),jB:e,wC:Array(d.length),callback:h,zx:g,De:-1,Fs:0,PA:Array(d.length),Au:-1};t[b]=c;n.push(c);-1==I.indexOf(a)&&I.push(a);a=c.Bd;for(b=0;b<a.length;b++){t=a[b];if(t.td){switch(t.type){case 80:q.append_collision_test(t.en,t.ab,t.dn,t.Nd);break;case 90:q.apply_collision_impulse_test(t.cn,t.Uq);break;case 100:t.yt=q.append_ray_test(t.Le,
t.W,t.xa,t.ab,t.xt,!1,!1,t.Nd,t.pl);break;case 130:t.Uc=H.get_timeline(),0>t.kd&&(t.kd=-t.kd)}t.td=!1}-1==L.indexOf(t)&&L.push(t)}fa=!0};a.or=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.Py=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<I.length;a++){var b=I[a],c=b.pd,b=b.Xe,d;for(d in c)delete c[d];b.splice(0,b.length)}for(a=0;a<L.length;a++)m(L[a],L),a--;I.splice(0,I.length)};a.debug=function(){y.log(String(I.length)+
" objects with manifolds",I);y.log(String(L.length)+" sensors",L);for(var a=[],b=[],c=0;c<L.length;c++){var d=L[c];80==d.type&&a.push(d);100==d.type&&b.push(d)}y.log(String(a.length)+" collision sensors",a);y.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",k,!1);a.addEventListener("keyup",p,!1);O=b};a.register_mouse_events=function(a,b,c){if(c)var d=window;else d=a,d.addEventListener("mouseout",n,!1);a.addEventListener("mousedown",e,!1);
d.addEventListener("mousemove",h,!1);d.addEventListener("mouseup",g,!1);ba=b;na=c};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",C,!1);a.addEventListener("DOMMouseScroll",C,!1);J=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",G,!1);a.addEventListener("touchmove",F,!1);document.addEventListener("touchstart",function(){});va=b};a.register_device_orientation=function(){window.DeviceOrientationEvent&&M.gyro_use&&window.addEventListener("deviceorientation",
E,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",k,!1);a.removeEventListener("keyup",p,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",e,!1);a.removeEventListener("mousemove",h,!1);a.removeEventListener("mouseout",n,!1);a.removeEventListener("mouseup",g,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",C,!1);a.removeEventListener("DOMMouseScroll",C,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",
G,!1);a.removeEventListener("touchmove",F,!1);document.removeEventListener("touchstart",function(){})};a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&M.gyro_use&&window.removeEventListener("deviceorientation",E,!1)};a.lF=function(a){ia=a};a.mF=function(a){ea=a};a.oF=function(a){Z=a};a.nF=function(a){la=a}};b4w.module.__curve=function(a,r){function d(a,b,c,d,e){var g=d.length;e||(e=new Float32Array(g));for(var h=g+a,n=new Float32Array(h),l=1;l<=h-1;l++)n[l-1]=b>=c[l-1]&&b<c[l+1-1]?1:0;for(var G=2;G<=a;G++)for(l=1;l<=h-G;l++)n[l-1]=(0!=n[l-1]?(b-c[l-1])*n[l-1]/(c[l+G-1-1]-c[l-1]):0)+(0!=n[l+1-1]?(c[l+G-1]-b)*n[l+1-1]/(c[l+G-1]-c[l+1-1]):0);b==c[h-1]&&(n[g-1]=1);a=0;for(l=1;l<=g;l++)a+=n[l-1]*d[l-1];for(l=1;l<=g;l++)e[l-1]=0!=a?n[l-1]*d[l-1]/a:0;return e}function c(a){a=a.zl;return a[a.length-1]}function b(a){a=
a.kr;return a[a.length-1]}r("__print");var l=r("__util");a.zy=function(a){var b={},c=a.data;a=c.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var l=a.order_u;b.xf=l;a=a.points;var e=a.length/5,g=[],h=e+l,e=e+2;g[0]=0;for(var n=2;n<=h;n++)g[n-1]=n>l&&n<e?g[n-2]+1:g[n-2];b.zl=g;if("2D"==c.dimensions)b.rf=!1;else if("3D"==c.dimensions)b.rf=!0;else throw"Wrong curve dimensions";l=[];g=[];for(c=0;c<a.length;c+=5)l.push(a[c]),l.push(a[c+1]),l.push(a[c+2]),b.rf&&l.push(a[c+3]),g.push(a[c+
4]);b.hn=l;b.Qp=g;a=[];for(var c=b.hn,l=b.rf?4:3,g=b.Qp,h=b.zl,e=b.xf,n=c.length/l,C=n+e,G=0,F=h[C-1]/999,E=0;1E3>E;E++){5E-6>h[C-1]-G&&(G=h[C-1]);for(var u=d(e,G,h,g),B=0;B<l;B++)for(var A=a[l*E+B]=0;A<n;A++)a[l*E+B]+=u[A]*c[l*A+B];G+=F}l=b.rf?4:3;g=new Float32Array(1E3);g[0]=0;for(c=1;1E3>c;c+=1)h=a[(c-1)*l],e=a[(c-1)*l+1],n=a[(c-1)*l+2],C=a[c*l],G=a[c*l+1],F=a[c*l+2],g[c]=g[c-1]+Math.sqrt((C-h)*(C-h)+(G-e)*(G-e)+(F-n)*(F-n));b.kr=g;return b};a.iD=function(a,b,l){l||(l=[]);var p=b,e=Math.max(p,
0);b=e=Math.min(p,c(a));var p=a.hn,e=a.rf?4:3,g=a.Qp,h=a.zl,n=a.xf;a=p.length/e;var C=a+n;5E-6>h[C-1]-b&&(b=h[C-1]);C=new Float32Array(a);d(n,b,h,g,C);for(b=0;b<e;b++)for(g=l[b]=0;g<a;g++)l[b]+=C[g]*p[e*g+b]};a.fD=function(a,b,c){c||(c=[]);var d=a.hn,e=a.rf?4:3,g=a.Qp,h=a.zl,l=a.xf;a=d.length/e;var C=a+l;5E-6>h[C-1]-b&&(b=h[C-1]);var C=new Float32Array(a),G=b;b=C;var F=g.length;b||(b=new Float32Array(F));var E=new Float32Array(F),u=new Float32Array(F),B=E,A=u;B||(B=new Float32Array(F));A||(A=new Float32Array(F));
for(var t=F+l,y=new Float32Array(t),q=new Float32Array(t),w=1;w<=t-1;w++)y[w-1]=G>=h[w-1]&&G<h[w+1-1]?1:0;G==h[t-1]&&(y[F-1]=1);for(var H=2;H<=l;H++)for(w=1;w<=t-H;w++){var z=0!=y[w-1]?y[w-1]/(h[w+H-1-1]-h[w-1]):0,Q=0!=y[w+1-1]?-y[w+1-1]/(h[w+H-1]-h[w+1-1]):0,P=0!=q[w-1]?(G-h[w-1])*q[w-1]/(h[w+H-1-1]-h[w-1]):0,M=0!=q[w+1-1]?(h[w+H-1]-G)*q[w+1-1]/(h[w+H-1]-h[w+1-1]):0;y[w-1]=(0!=y[w-1]?(G-h[w-1])*y[w-1]/(h[w+H-1-1]-h[w-1]):0)+(0!=y[w+1-1]?(h[w+H-1]-G)*y[w+1-1]/(h[w+H-1]-h[w+1-1]):0);q[w-1]=z+Q+P+M}for(w=
1;w<=F;w++)B[w-1]=y[w-1],A[w-1]=q[w-1];h=0;for(l=1;l<=F;l++)h+=E[l-1]*g[l-1];G=0;for(l=1;l<=F;l++)G+=u[l-1]*g[l-1];for(l=1;l<=F;l++)b[l-1]=0!=h?u[l-1]*g[l-1]/h+E[l-1]*g[l-1]*G/(h*h):0;for(g=0;g<e;g++)for(h=c[g]=0;h<a;h++)c[g]+=C[h]*d[e*h+g]};a.bH=c;a.hD=b;a.gD=function(a,d){if(0>=d)return 0;var k=c(a);if(d>=b(a))return k;var p=a.kr,e=l.Gk(p,d,0,p.length-1);return k*(e+(d-p[e])/(p[e+1]-p[e]))/1E3}};b4w.module.__dds=function(a,r){function d(a,b,c,d){var e=new Uint16Array(4),f=new Uint16Array(c*d),l=0,k=0,m=0,A=k=l=0,t=0,y=0,q=0,w=c/4;d/=4;for(var p=0;p<d;p++)for(var z=0;z<w;z++)m=b+4*(p*w+z),e[0]=a[m],e[1]=a[m+1],l=e[0]&31,k=e[0]&2016,A=e[0]&63488,t=e[1]&31,y=e[1]&2016,q=e[1]&63488,e[2]=5*l+3*t>>3|5*k+3*y>>3&2016|5*A+3*q>>3&63488,e[3]=5*t+3*l>>3|5*y+3*k>>3&2016|5*q+3*A>>3&63488,l=a[m+2],k=4*p*c+4*z,f[k]=e[l&3],f[k+1]=e[l>>2&3],f[k+2]=e[l>>4&3],f[k+3]=e[l>>6&3],k+=c,f[k]=e[l>>8&3],f[k+1]=e[l>>
10&3],f[k+2]=e[l>>12&3],f[k+3]=e[l>>14],l=a[m+3],k+=c,f[k]=e[l&3],f[k+1]=e[l>>2&3],f[k+2]=e[l>>4&3],f[k+3]=e[l>>6&3],k+=c,f[k]=e[l>>8&3],f[k+1]=e[l>>10&3],f[k+2]=e[l>>12&3],f[k+3]=e[l>>14];return f}function c(a,b,c,l){var G=new Int32Array(c,0,31),F,E,u,B,A,t;if(542327876!=G[0])return m.error("Invalid magic number in DDS header"),0;if(!G[20]&4)return m.error("Unsupported format, must contain a FourCC code"),0;F=G[21];switch(F){case k:E=8;u=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case p:E=16;u=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case e:E=16;u=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return m.error("Unsupported FourCC code:",f(F)),null}t=1;G[2]&131072&&!1!==l&&(t=Math.max(1,G[7]));B=G[4];A=G[3];G=G[1]+4;if(b)for(F=0;F<t;++F)l=Math.max(4,B)/4*Math.max(4,A)/4*E,b=new Uint8Array(c,G,l),a.compressedTexImage2D(a.TEXTURE_2D,F,u,B,A,0,b),G+=l,B=Math.max(.5*B,1),A=Math.max(.5*A,1);else if(F==k)Math.max(4,B),Math.max(4,A),b=new Uint16Array(c),c=d(b,G/2,B,A),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,B,A,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,c),l&&a.generateMipmap(a.TEXTURE_2D);else return m.error("No manual decoder for",f(F),"and no native support"),0;return t}function b(a,b,d,e,f,l){var k=new XMLHttpRequest;k.open("GET",d,!0);k.responseType="arraybuffer";k.onload=function(){if(200==k.status){a.bindTexture(a.TEXTURE_2D,e);var d=c(a,b,k.response,f);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}l&&
l(e)};k.send(null);return e}function l(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function f(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var m=r("__print"),k=l("DXT1"),p=l("DXT3"),e=l("DXT5");a.PF=d;a.eE=c;a.bs=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.Rz=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case k:b=6;break;case p:case e:b=4;break;default:m.error("Unsupported FourCC code:",f(a))}return b};
a.JG=b;a.IG=function(a,c,d,e){var f=a.createTexture();b(a,c,d,f,!0,e);return f}};b4w.module.__debug=function(a,r){function d(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function c(a,b){typeof a!=typeof b&&m.ja("Structure assertion failed: incompatible types");if(null!==a&&null!==b&&"object"==typeof a){for(var c in a)c in b||m.ja("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||m.ja("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&m.ja("Structure assertion failed: incompatible types for key "+
c)}}var b=r("__extensions"),l=r("__print"),f=r("__textures"),m=r("__util"),k=null,p={},e=!1,g={},h=[],n=-1,C=null,G=!1;a.cq={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.Cd=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(p[a[d]]=d)}k=a};a.Mx=function(a){if(e){var b=k.getError();b!=k.NO_ERROR&&(b in p?m.ja("GL Error: "+b+", gl."+
p[b]+" ("+a+")"):m.ja("Unknown GL error: "+b+" ("+a+")"))}};a.Hx=function(){if(e)switch(k.checkFramebufferStatus(k.FRAMEBUFFER)){case k.FRAMEBUFFER_COMPLETE:break;case k.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:l.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case k.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:l.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case k.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:l.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case k.FRAMEBUFFER_UNSUPPORTED:l.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:l.error("FRAMEBUFFER CHECK FAILED")}};a.Oq=function(){if(-1!=n)return n;k.bindFramebuffer(k.FRAMEBUFFER,k.createFramebuffer());var a=f.Xk("DEBUG",f.Li);f.resize(a,1,1);k.framebufferTexture2D(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,a.$b,a.jb,0);k.checkFramebufferStatus(k.FRAMEBUFFER)!=k.FRAMEBUFFER_COMPLETE?(n=!0,l.warn("depth-only issue was found")):n=!1;k.bindFramebuffer(k.FRAMEBUFFER,null);return n};
a.Nx=function(a,b,c){if(e&&!k.getShaderParameter(a,k.COMPILE_STATUS))throw c=d(c),l.error("shader compilation failed:\n"+c+"\n"+k.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.Ox=function(a,c,f,h,g,n){if(e&&!k.getProgramParameter(a,k.LINK_STATUS)){var q=b.Sr();q&&(g=q.getTranslatedShaderSource(f),n=q.getTranslatedShaderSource(h));g=d(g);n=d(n);l.error("shader linking failed:\n"+g+"\n\n\n"+n+"\n"+k.getProgramInfoLog(a)+" ("+c+")");throw"Engine failed: see above for error messages";
}};a.set_check_gl_errors=function(a){e=a};a.QF=function(a){g[a]=a in g?g[a]+1:1};a.update=function(){for(var a in g)l.log(a,g[a]),g[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(m.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}h.push(a)};a.msg=function(){for(var a=1,b=0;b<h.length;b++){var c=h[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],m.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);
else c.push(arguments[b]);h.push(c)};var F=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},d=Math.max(0,performance.now()-1E3*a),e=0;e<h.length;e++){var f=h[e];a=f[0];if(!(a<d)){var g=String(f[1]);c[g]||(c[g]=F[b++%F.length]);a=["%c"+(a/1E3).toFixed(6),c[g],g];for(g=2;g<f.length;g++)a.push(f[g]);l.log.apply(this,a)}}h.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-
1E3*a),d=0;d<h.length;d++){var e=h[d];a=e[0];if(!(a<c))for(var f=2;f<e.length;f++){var g=String(e[1]);3<e.length&&(g+="_"+String(f-2));b[g]||(b[g]=g+"\n");b[g]+=String(a)+" "+e[f]+"\n"}}a="";for(g in b)a+=b[g]+"\n\n";l.log(a);h.splice(0)};a.xF=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&b("firefox");case "msie":return b("mozilla")&&
b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(m.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.iF=function(a,b){a.constructor!=b&&m.ja("Type assertion failed: value <"+a+"> has type <"+a.constructor+">, required <"+b+">")};a.jF=c;a.kF=function(a){G?c(a,C):G=!0;C=a}};b4w.module.__extensions=function(a,r){function d(a){if(a in l)return l[a];var d=b.getExtension(a)||null;l[a]=d;c.log("%cGET EXTENSION","color: #"+(d?"0a0":"a00"),a);return d}var c=r("__print"),b=null,l={};a.Cd=function(a){b=a};a.Zr=function(){return d("WEBGL_compressed_texture_s3tc")||d("WEBKIT_WEBGL_compressed_texture_s3tc")||d("MOZ_WEBGL_compressed_texture_s3tc")};a.Tz=function(){return d("WEBGL_depth_texture")||d("WEBKIT_WEBGL_depth_texture")||d("MOZ_WEBGL_depth_texture")};a.Lz=function(){return d("EXT_texture_filter_anisotropic")||
d("WEBKIT_EXT_texture_filter_anisotropic")||d("MOZ_EXT_texture_filter_anisotropic")};a.Sr=function(){return d("WEBGL_debug_shaders")};a.Yr=function(){return d("WEBGL_debug_renderer_info")};a.Tr=function(){return d("OES_element_index_uint")};a.gA=function(){return d("OES_standard_derivatives")};a.cleanup=function(){l={}}};b4w.module.__graph=function(a,r){function d(a,b,d){d||(d=null);if(c(a,b))throw"Graph already has node with given ID";a.U.push(b,d)}function c(a,b){for(var c=a.U,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function b(a,b,d,e){e||(e=null);if(c(a,b)&&c(a,d))a.X.push(b,d,e);else throw"Wrong node IDs";}function l(a,b){if(!c(a,b))throw"Node not found";for(var d=a.U,e=0;e<d.length;e+=2)d[e]==b&&(d.splice(e,2),e-=2)}function f(a,b,c,d){if(!w(a,b,c))throw"Edge not found";a=a.X;for(var e=0,f=0;f<a.length;f+=
3)if(a[f]==b&&a[f+1]==c){if(-1==d)a.splice(f,3);else{if(d==e){a.splice(f,3);break}e++}f-=3}}function m(a){a=a.U;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}function k(a,b){for(var c=a.U,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function p(a){var b=[],c={};e(a,c);for(var d=a.U,f=0;f<d.length;f+=2)0==t(a,d[f])&&g(a,d[f],c,b);return{U:b,X:a.X.slice(0)}}function e(a,b){for(var c=a.U,d=0;d<c.length;d+=2)b[c[d]]=!1}function g(a,b,c,d){if(!c[b]){c[b]=!0;for(var e=0;e<A(a,b);e++)g(a,
y(a,b,e),c,d);d.unshift(b,B(a,b))}}function h(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var e=0;e<A(a,b);e++){var f=y(a,b,e);h(a,f,c,d)}if(20==d||30==d)for(e=0;e<t(a,b);e++)f=q(a,b,e),h(a,f,c,d)}}function n(a){for(var b=[],c=a.U,d=0;d<c.length;d+=2){var e=c[d];A(a,e)||b.push(e)}return b}function C(a){var b=a.U;a=a.X;for(var c=[],d=[],e=[],f=0;f<b.length;f++)e[b[2*f]]=f,c.push(f,b[2*f+1]);for(f=0;f<a.length;f+=3)d.push(e[a[f]],e[a[f+1]],a[f+2]);return{U:c,X:d}}function G(a,b,c){if(c.Od==c.uf){for(var d=
0,e=0;d<c.uf;d++)-1!=c.qe[d]&&(a[e]=d,b[e]=c.qe[d],e++);return!0}if(c.uf>c.Zh||c.Kf>c.Lf||c.xi>c.zi||c.wi>c.yi)return!1;for(var e=d=-1,f=!1;!f&&F(c,M,d,e);)if(d=M[0],e=M[1],E(c,d,e)){var h;h=c;f={};f.uj=h.uj;f.vj=h.vj;f.Fo=h.Fo;f.dl=h.dl;f.uf=h.uf;f.Zh=h.Zh;f.xf=h.xf;f.Od=f.Jl=h.Od;f.wi=h.wi;f.xi=h.xi;f.Kf=h.Kf;f.yi=h.yi;f.zi=h.zi;f.Lf=h.Lf;f.Pi=-1;f.qe=h.qe;f.jg=h.jg;f.yg=h.yg;f.zg=h.zg;f.Sg=h.Sg;f.Tg=h.Tg;f.fm=h.fm;h.fm[0]+=1;var f=h=f,l=d,g=e,n=f.uj,k=f.vj,w=f.uf,m=f.Zh,z=f.qe,C=f.jg,p=f.yg,P=
f.zg,B=f.Sg,D=f.Tg;u(l<w);u(g<m);u(f.Od<w);u(f.Od<m);w=++f.Od;f.Pi=l;p[l]||(p[l]=w,f.wi++,B[l]&&f.Kf++);B[l]||(B[l]=w,f.xi++,p[l]&&f.Kf++);P[g]||(P[g]=w,f.yi++,D[g]&&f.Lf++);D[g]||(D[g]=w,f.zi++,P[g]&&f.Lf++);z[l]=g;C[g]=l;for(z=0;z<t(n,l);z++)C=q(n,l,z),p[C]||(p[C]=w,f.wi++,B[C]&&f.Kf++);for(z=0;z<A(n,l);z++)C=y(n,l,z),B[C]||(B[C]=w,f.xi++,p[C]&&f.Kf++);for(z=0;z<t(k,g);z++)C=q(k,g,z),P[C]||(P[C]=w,f.yi++,D[C]&&f.Lf++);for(z=0;z<A(k,g);z++)C=y(k,g,z),D[C]||(D[C]=w,f.zi++,P[C]&&f.Lf++);f=G(a,b,h);
u(1>=h.Od-h.Jl);u(-1!=h.Pi);C=h.uj;l=h.vj;g=h.Od;n=h.Pi;k=h.qe;p=h.jg;w=h.yg;P=h.zg;m=h.Sg;B=h.Tg;if(h.Jl<g){w[n]==g&&(w[n]=0);for(D=0;D<t(C,n);D++)z=q(C,n,D),w[z]==g&&(w[z]=0);m[n]==g&&(m[n]=0);for(D=0;D<A(C,n);D++)z=y(C,n,D),m[z]==g&&(m[z]=0);C=k[n];P[C]==g&&(P[C]=0);for(D=0;D<t(l,C);D++)z=q(l,C,D),P[z]==g&&(P[z]=0);B[C]==g&&(B[C]=0);for(D=0;D<A(l,C);D++)z=y(l,C,D),B[z]==g&&(B[z]=0);k[n]=-1;p[C]=-1;h.Od=h.Jl;h.Pi=-1}}return f}function F(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var e=a.Kf,f=a.Lf,h=a.xi,
g=a.zi,l=a.wi,t=a.yi,n=a.Od,q=a.uf,k=a.Zh,w=a.qe,m=a.jg,z=a.yg,C=a.zg,y=a.Sg,D=a.Tg;if(e>n&&f>n)for(;c<q&&(-1!=w[c]||0==y[c]||0==z[c]);)c++,d=0;else if(h>n&&g>n)for(;c<q&&(-1!=w[c]||0==y[c]);)c++,d=0;else if(l>n&&t>n)for(;c<q&&(-1!=w[c]||0==z[c]);)c++,d=0;else if(0==c&&0!=a.xf){for(z=0;z<q&&-1!=w[c=a.xf[z]];)z++;z==q&&(c=q)}else for(;c<q&&-1!=w[c];)c++,d=0;if(e>n&&f>n)for(;d<k&&(-1!=m[d]||0==D[d]||0==C[d]);)d++;else if(h>n&&g>n)for(;d<k&&(-1!=m[d]||0==D[d]);)d++;else if(l>n&&t>n)for(;d<k&&(-1!=m[d]||
0==C[d]);)d++;else for(;d<k&&-1!=m[d];)d++;return c<q&&d<k?(b[0]=c,b[1]=d,!0):!1}function E(a,b,c){var d=a.uj,e=a.vj,f=a.Zh,h=a.qe,g=a.jg,l=a.yg,n=a.zg,k=a.Sg,m=a.Tg;u(b<a.uf);u(c<f);u(-1==h[b]);u(-1==g[c]);if(!(0,a.Fo)(B(d,b),B(e,c)))return!1;for(var z=f=0,C=0,M=0,p=0,P=0,Q=0;Q<A(d,b);Q++){var D=y(d,b,Q);if(-1!=h[D]){var O=h[D];if(!w(e,c,O)||!H(a.dl,d,b,D,e,c,O))return!1}else l[D]&&C++,k[D]&&f++,l[D]||k[D]||p++}for(Q=0;Q<t(d,b);Q++)if(D=q(d,b,Q),-1!=h[D]){if(O=h[D],!w(e,O,c)||!H(a.dl,d,D,b,e,O,c))return!1}else l[D]&&
C++,k[D]&&f++,l[D]||k[D]||p++;for(Q=0;Q<A(e,c);Q++)if(O=y(e,c,Q),-1!=g[O]){if(D=g[O],!w(d,b,D))return!1}else n[O]&&M++,m[O]&&z++,n[O]||m[O]||P++;for(Q=0;Q<t(e,c);Q++)if(O=q(e,c,Q),-1!=g[O]){if(D=g[O],!w(d,D,b))return!1}else n[O]&&M++,m[O]&&z++,n[O]||m[O]||P++;return C<=M&&f<=z&&p<=P}function u(a){if(!a)throw"Assertion failed";}function B(a,b){for(var c=a.U,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function A(a,b){for(var c=a.X,d=0,e=0;e<c.length;e+=3)c[e]==b&&d++;return d}function t(a,
b){for(var c=a.X,d=0,e=0;e<c.length;e+=3)c[e+1]==b&&d++;return d}function y(a,b,c){a=a.X;for(var d=0,e=0;e<a.length;e+=3)if(a[e]==b){if(d==c)return a[e+1];d++}return-1}function q(a,b,c){a=a.X;for(var d=0,e=0;e<a.length;e+=3)if(a[e+1]==b){if(d==c)return a[e];d++}return-1}function w(a,b,c){a=a.X;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function H(a,b,c,d,e,f,h){for(var g=z(b,c,d),l=z(e,f,h),t=0;t<g;t++){for(var n=!1,q=0;q<l;q++)if(a(Q(b,c,d,t),Q(e,f,h,q))){n=!0;break}if(!n)return!1}return!0}
function z(a,b,c){var d=0;a=a.X;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&d++;return d}function Q(a,b,c,d){a=a.X;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(e==d)return a[f+2];e++}return null}r("__print");var P=r("__util"),M=[-1,-1];a.Yp=-1;a.$E=10;a.vm=20;a.cF=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var e=a[d];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:c.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";}}return{U:b,
X:c}};a.clone=function(a,b,c){if(b)for(var d=Array(a.U.length),e=0;e<a.U.length;e+=2)d[e]=a.U[e],d[e+1]=b(a.U[e+1]);else d=P.la(a.U);if(c)for(b=Array(a.X.length),e=0;e<a.X.length;e+=3)b[e]=a.X[e],b[e+1]=a.X[e+1],b[e+2]=c(a.X[e+2]);else b=P.la(a.X);return a={U:d,X:b}};a.FF=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c.push(a[e][0],a[e][1]);for(e=0;e<b.length;e++)d.push(b[e][0],b[e][1],b[e][2]);return{U:c,X:d}};a.rh=d;a.qG=c;a.Rb=b;a.$g=l;a.Zg=f;a.am=function(a,b,c,d){if(!w(a,b,c))throw"Edge not found";
a=a.X;for(var e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==c&&a[e+2][0]==d[0]&&a[e+2][1]==d[1]){a.splice(e,3);break}};a.u=function(a,b){if(-1==k(a,b)){var c=m(a);d(a,c,b);return c}throw"Non-unique attribute";};a.iC=function(a,b,c,d,e){a=a.X;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&a[f+2]==d&&(a[f+2]=e)};a.wj=m;a.Pg=k;a.n=function(a,c,d,e){c=k(a,c);d=k(a,d);if(-1!=c&&-1!=d)b(a,c,d,e);else throw"Attributes not found";};a.V=function(a,b){for(var c=a.U,d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};a.ce=function(a,
b){for(var c=a.X,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.Re=function(a,b,c){for(var d=a.X,e=0;e<d.length;e+=3)if(d[e+1]==b){var f=d[e];if(c(f,B(a,f),d[e+2]))break}};a.Nf=function(a,b,c){for(var d=a.X,e=0;e<d.length;e+=3)if(d[e]==b){var f=d[e+1];if(c(f,B(a,f),d[e+2]))break}};a.yp=p;a.xD=function(a){a=p(a).U;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.zG=function(){};a.mp=function(a,b,d){if(!c(a,b))throw"No such node";var f={};e(a,f);h(a,b,f,d);b=[];for(var g in f)f[g]&&(g=
Number(g),b.push(g,B(a,g)));a={U:b,X:a.X.slice(0)};f=a.X;for(g=0;g<f.length;g+=3)b=f[g+1],c(a,f[g])&&c(a,b)||(f.splice(g,3),g-=3);return a};a.fA=function(a){for(var b=[],c=a.U,d=0;d<c.length;d+=2){var e=c[d];t(a,e)||b.push(e)}return b};a.as=n;a.match=function(a,b,c,d){var e={};e.uj=C(a);e.vj=C(b);e.Fo=c||function(a,b){return a==b};e.dl=d||function(a,b){return a==b};d=a.U.length/2;var f=b.U.length/2;e.uf=d;e.Zh=f;e.xf=0;e.Od=e.Jl=0;e.Kf=e.wi=e.xi=0;e.Lf=e.yi=e.zi=0;e.Pi=-1;e.qe=Array(d);e.jg=Array(f);
e.yg=Array(d);e.zg=Array(f);e.Sg=Array(d);e.Tg=Array(f);e.fm=[1];for(c=0;c<d;c++)e.qe[c]=-1,e.yg[c]=0,e.Sg[c]=0;for(c=0;c<f;c++)e.jg[c]=-1,e.zg[c]=0,e.Tg[c]=0;f=Array(d);d=Array(d);if(G(f,d,e)){for(c=0;c<f.length;c++)f[c]=a.U[2*f[c]],d[c]=b.U[2*d[c]];return[f,d]}return null};a.Oa=B;a.yf=A;a.ao=t;a.mf=y;a.yj=q;a.gG=z;a.ze=Q;a.replace=function(a,b,c){for(var e=a.X,f=m(a),h=0;h<b.length;h++){var g=b[h];l(a,g);for(var t=0;t<e.length;t+=3)e[t]==g&&(e[t]=f),e[t+1]==g&&(e[t+1]=f),e[t]==e[t+1]&&(e.splice(t,
3),t-=3)}d(a,f,c)};a.aC=function(a,b,c,d,e){if(!w(a,b,c))throw"Edge not found";a=a.X;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&(a[f]=d,a[f+1]=e)};a.bz=function(a,b){function c(a,b){if(-1!=l.indexOf(a)){var d=l.slice(l.indexOf(a));if(-1!=e[d[d.length-1]].indexOf(d[0])){t.push([a,d[d.length-1]]);return}}l.push(a);for(d=0;d<b.length;d++)b[d]in e&&c(b[d],e[b[d]])}b||(b=n(a)[0]);var d=a.X;if(d.length){for(var e={},h=0,g=0;g<d.length;g+=3)d[g+1]in e?e[d[g+1]].push(d[g]):e[d[g+1]]=[d[g]],h++;var l=
[],t=[];c(b,e[b]);for(g=0;g<t.length;g++)for(var q=h=0;q<d.length;q+=3)t[g][1]==d[q+1]&&t[g][0]==d[q]&&f(a,d[q],d[q+1],h),h++}};a.IF=function(a,b,c){var d=a.U;a=a.X;var e;e="digraph debug {\n    node [shape=box];\n";for(var f=0;f<d.length;f+=2){var h=d[f],g=d[f+1],g=b?b(h,g):String(h);e+="    ";e+=String(h)+' [label="'+g.replace(/\"/g,'\\"')+'"];\n'}for(f=0;f<a.length;f+=3)b=a[f],d=a[f+1],g=a[f+2],e+="    ",e+=String(b)+" -> "+String(d),c&&(e+=' [label="'+c(b,d,g)+'"]'),e+=";\n";return e+="}"}};b4w.module.__ipc=function(a,r){function d(a,b,c){for(var d=0;d<h.length;d+=2)h[d+1]==a&&(g[d+Number(!b)]=c)}function c(a){for(var b=0;b<a.length;b++){var c=a[b],d=0,e;for(e in c){var f=c[e];switch(f.constructor){case Float32Array:d+=f.length;break;case Number:d+=1}}--d;c.len=d}}a.mv=0;var b=a.ev=1,l=a.gv=2;a.fv=3;a.iv=4;a.jv=5;a.kv=6;a.nv=7;var f=a.pv=8,m=a.Xp=9,k=a.qv=10;a.rv=11;var p=a.sv=12;a.tv=13;a.ov=14;a.lv=15;a.hv=16;a.Uv=100;a.vv=101;a.wv=102;a.xv=103;a.yv=104;a.Av=105;a.zv=106;a.Bv=107;
a.Cv=108;a.Dv=109;a.Ev=110;a.Fv=111;a.Gv=112;a.Iv=113;a.Jv=114;a.Xv=115;a.Kv=116;a.Lv=117;a.Mv=118;a.Ov=119;a.Pv=120;a.Qv=121;a.Sv=122;a.Tv=123;a.Vv=124;a.Hv=125;a.Zv=126;a.Nv=127;a.$p=128;a.Yv=129;a.$v=130;a.aw=131;a.bw=132;a.cw=133;a.dw=134;a.ew=135;a.fw=136;a.gw=137;a.hw=138;a.iw=139;a.aq=140;var e=a.rk=141;a.jw=142;a.Zp=143;a.kw=144;a.lw=145;a.Wv=146;a.Rv=147;a.mw=148;var g=b4w.worker_listeners,h=b4w.worker_namespaces,n={Lc:p,v:0,time:0,i:new Float32Array(3),quat:new Float32Array(4),Sd:new Float32Array(3),
Hd:new Float32Array(3),len:0},C={Lc:f,an:0,Po:0,i:new Float32Array(3),quat:new Float32Array(4),len:0},G={Lc:m,id:0,uh:0,hit_fract:0,hit_time:0,len:0},F={Lc:k,id:0,uh:0,hit_fract:0,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),len:0},E={Lc:b,cg:0,dg:0,result:0,len:0},u={Lc:l,cg:0,dg:0,result:0,hg:new Float32Array(3),coll_norm:new Float32Array(3),coll_dist:0,len:0},B={Lc:e,v:0,i:new Float32Array(3),quat:new Float32Array(4),len:0},A=[n,C,G,F,E,u,B];a.Fy=function(a,b){var c={yl:a?
!0:!1,Wf:null,Md:[],xe:""};if(b)if(c.Wf={addEventListener:function(a,b){"message"!=a&&panic("Wrong web worker event");d(c.xe,c.yl,b)},removeEventListener:function(a){"message"!=a&&panic("Wrong web worker event");d(c.xe,c.yl,null)},postMessage:function(a){var b;a:{for(b=0;b<h.length;b+=2)if(h[b+1]==c.xe){b=g[b+Number(!!c.yl)];break a}b=null}b({data:a})},terminate:function(){for(var a=0;a<h.length;a+=2)if(h[a+1]==c.xe){g.splice(a,2);h.splice(a,2);break}}},c.yl){var e=r("__util"),f=r("__container"),
l=b4w.get_namespace(r),e=e.Bi(l+"_worker");h.push(l);h.push(e);g.push(null);g.push(null);c.xe=e;f.Cr(a)?(f=f.Cr(a),f.addEventListener("load",function(){b4w.require("__bindings",c.xe)},!1)):(f=document.createElement("script"),f.src=a,f.defer="defer",f.async="async",f.addEventListener("load",function(){b4w.require("__bindings",c.xe)},!1),document.head.appendChild(f))}else c.xe=b4w.get_namespace(r);else c.Wf=a?new Worker(a):self;return c};a.kx=function(a,d){function h(c){if(c.constructor==ArrayBuffer)c=
new Float32Array(c);else if(c[0].constructor==ArrayBuffer){for(var g=0;g<c.length;g++)h(c[g]);return}g=c[0]|0;switch(g){case p:var z=n;z.v=c[1]|0;z.time=c[2];z.i[0]=c[3];z.i[1]=c[4];z.i[2]=c[5];z.quat[0]=c[6];z.quat[1]=c[7];z.quat[2]=c[8];z.quat[3]=c[9];z.Sd[0]=c[10];z.Sd[1]=c[11];z.Sd[2]=c[12];z.Hd[0]=c[13];z.Hd[1]=c[14];z.Hd[2]=c[15];break;case f:z=C;z.an=c[1]|0;z.Po=c[2]|0;z.i[0]=c[3];z.i[1]=c[4];z.i[2]=c[5];z.quat[0]=c[6];z.quat[1]=c[7];z.quat[2]=c[8];z.quat[3]=c[9];break;case m:z=G;z.id=c[1]|
0;z.uh=c[2]|0;z.hit_fract=c[3];z.hit_time=c[4];break;case k:z=F;z.id=c[1]|0;z.uh=c[2]|0;z.hit_fract=c[3];z.hit_time=c[4];z.hit_pos[0]=c[5];z.hit_pos[1]=c[6];z.hit_pos[2]=c[7];z.hit_norm[0]=c[8];z.hit_norm[1]=c[9];z.hit_norm[2]=c[10];break;case b:z=E;z.cg=c[1]|0;z.dg=c[2]|0;z.result=!!c[3];break;case l:z=u;z.cg=c[1]|0;z.dg=c[2]|0;z.result=!!c[3];z.hg[0]=c[4];z.hg[1]=c[5];z.hg[2]=c[6];z.coll_norm[0]=c[7];z.coll_norm[1]=c[8];z.coll_norm[2]=c[9];z.coll_dist=c[10];break;case e:z=B;z.v=c[1]|0;z.i[0]=c[2];
z.i[1]=c[3];z.i[2]=c[4];z.quat[0]=c[5];z.quat[1]=c[6];z.quat[2]=c[7];z.quat[3]=c[8];break;default:z=c}d(a,g,z)}c(A);a.Wf.addEventListener("message",function(a){h(a.data)},!1)};a.cleanup=function(){};a.A=function(a,c){if(a)switch(c){case p:var d=n,h=new Float32Array(d.len);h[0]=d.Lc;h[1]=d.v;h[2]=d.time;h[3]=d.i[0];h[4]=d.i[1];h[5]=d.i[2];h[6]=d.quat[0];h[7]=d.quat[1];h[8]=d.quat[2];h[9]=d.quat[3];h[10]=d.Sd[0];h[11]=d.Sd[1];h[12]=d.Sd[2];h[13]=d.Hd[0];h[14]=d.Hd[1];h[15]=d.Hd[2];a.Md.push(h.buffer);
break;case f:d=C;h=new Float32Array(d.len);h[0]=d.Lc;h[1]=d.an;h[2]=d.Po;h[3]=d.i[0];h[4]=d.i[1];h[5]=d.i[2];h[6]=d.quat[0];h[7]=d.quat[1];h[8]=d.quat[2];h[9]=d.quat[3];a.Md.push(h.buffer);break;case m:d=G;h=new Float32Array(d.len);h[0]=d.Lc;h[1]=d.id;h[2]=d.uh;h[3]=d.hit_fract;h[4]=d.hit_time;a.Md.push(h.buffer);break;case k:d=F;h=new Float32Array(d.len);h[0]=d.Lc;h[1]=d.id;h[2]=d.uh;h[3]=d.hit_fract;h[4]=d.hit_time;h[5]=d.hit_pos[0];h[6]=d.hit_pos[1];h[7]=d.hit_pos[2];h[8]=d.hit_norm[0];h[9]=d.hit_norm[1];
h[10]=d.hit_norm[2];a.Md.push(h.buffer);break;case b:d=E;h=new Float32Array(d.len);h[0]=d.Lc;h[1]=d.cg;h[2]=d.dg;h[3]=d.result;a.Md.push(h.buffer);break;case l:d=u;h=new Float32Array(d.len);h[0]=d.Lc;h[1]=d.cg;h[2]=d.dg;h[3]=d.result;h[4]=d.hg[0];h[5]=d.hg[1];h[6]=d.hg[2];h[7]=d.coll_norm[0];h[8]=d.coll_norm[1];h[9]=d.coll_norm[2];h[10]=d.coll_dist;a.Md.push(h.buffer);break;case e:d=B;h=new Float32Array(d.len);h[0]=d.Lc;h[1]=d.v;h[2]=d.i[0];h[3]=d.i[1];h[4]=d.i[2];h[5]=d.quat[0];h[6]=d.quat[1];h[7]=
d.quat[2];h[8]=d.quat[3];a.Md.push(h.buffer);break;default:h=[];for(d=1;d<arguments.length;d++)h.push(arguments[d]);a.Wf.postMessage(h)}};a.RB=function(a){a&&a.Md.length&&(a.Wf.postMessage(a.Md),a.Md.length=0)};a.Xr=function(a){switch(a){case p:return n;case f:return C;case m:return G;case k:return F;case b:return E;case l:return u;case e:return B;default:return null}};a.terminate=function(a){a.Wf.terminate();a.Wf=null};a.tl=function(a){return!!a.Wf};a.ws=function(a){return!!a.xe}};b4w.module.__hud=function(a,r){function d(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function c(a){b(' SCENE "'+a.name+'"');if(a.k){var c=0,d=0;k.V(a.k.mb,function(a,e){if("SINK"==e.type)b(" (F)",e.type);else{var f=e.type,h=Math.round(e.j.width)+"x"+Math.round(e.j.height),g=e.o.length,l=e.ej;"MAIN_CUBE_REFLECT"==e.type&&(g*=6);var t=e.enqueue&&e.bb;t?b(" (A)",f,e.wf,h,l,"of",g):b(" (P)",f,e.wf,h,l,"of",g);e.ej=0;t&&(c+=g,d+=l)}});return[c,d]}b("No INFO")}
function b(){for(var a=80+20*g[0],b=arguments[0],c=1;c<arguments.length;c++){for(var d="",f=0;f<p[c]-String(arguments[c]).length;f++)d+=" ";b+=d+arguments[c]}g[0]++;e.fillText(b,30,a)}function l(a,b,c){b*=a.La;c.x=a.x+b;c.y=a.y;c.La=a.La-2*b;c.Da=a.Da}function f(a){return a.x+a.La/2}function m(a){var b=e,c={x:0,y:0,La:0,Da:0},d=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.La=d;c.Da=b;l(c,.01,c);d=.02*c.Da;c.x=c.x;c.y+=d;c.La=c.La;c.Da-=2*d;d=c.La/8;c.x+=d*a;c.y=c.y;c.La=d;c.Da=c.Da;l(c,.02,c);return c}
var k=r("__graph");r("__print");var p=[5,19,3,10,4,3,5],e=null,g=[0,0];a.init=function(a){a=a.getContext("2d");d(a);return e=a};a.Ci=function(){e&&d(e)};a.reset=function(){var a=e;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),g[0]=0,g[1]=0)};a.UC=function(a,d){var f=e;if(f){f.textAlign="left";f.fillStyle="rgba(0,255,0,255)";b(" FPS",(1/d).toFixed(2));g[0]++;for(var l=f=0,k=0;k<a.length;k++){var m=c(a[k]),f=f+m[0],l=
l+m[1];g[0]++}b(" -----------------------------------------------");b("    ","TOTAL ACTIVE","","",l,"of",f)}};a.print=function(){var a=e;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",b.apply(Math,arguments))};a.plot_array=function(a,b,c,d,g,l,k){var p=e;if(p){b=m(b);var A=b.Da/5;b.x=b.x;b.y+=4*A;b.La=b.La;b.Da=A;p.textAlign="center";p.fillStyle="#00FF00";e.fillText(a,f(b),b.y-10);p.strokeStyle="#00FF00";p.lineWidth=.5;p.beginPath();p.moveTo(b.x,b.y);p.lineTo(b.x+b.La,b.y);p.lineTo(b.x+b.La,
b.y+b.Da);p.lineTo(b.x,b.y+b.Da);p.closePath();p.stroke();if(!l&&!k)for(l=1E6,k=-1E6,a=0;a<c.length;a++)l=Math.min(l,c[a]),k=Math.max(k,c[a]);p.textAlign="right";e.fillText(String(l),b.x-10,b.y+b.Da);e.fillText(String(k),b.x-10,b.y);p.textAlign="center";e.fillText(String(d),b.x,b.y+b.Da+15);e.fillText(String(g),b.x+b.La,b.y+b.Da+15);p.strokeStyle="#FF0000";p.lineWidth=1.5;p.beginPath();d=b.La/(c.length-1);k=b.Da/(k-l);for(a=0;a<c.length;a++)g=b.x+d*a,A=b.y+b.Da-(c[a]-l)*k,0==a?p.moveTo(g,A):p.lineTo(g,
A);p.stroke()}};a.draw_mixer_strip=function(a,b,c,d,g,l,k){var p=e;if(p)for(p.textAlign="center",p.fillStyle="#00FF00",p.font="bold 12px Courier",c=m(c),e.fillText(b?"["+a+"]":a,f(c),c.y),0<=l&&e.fillText(l?"[M]":"[ ]",f(c)-15,c.y+30),0<=k&&e.fillText(k?"[S]":"[ ]",f(c)+15,c.y+30),a={x:0,y:0,La:0,Da:0},b=0;b<d.length;b++){l=d[b];var A="VOLUME"==l[0];if(A){k=c.y+350;var t=c.La,y=a;y.x=c.x;y.y=k;y.La=t;y.Da=250}else{k=c.y+10+50*b;var t=c.La,y=c.Da,q=a;q.x=c.x;q.y=k;q.La=t;q.Da=y}k=p;var t=a,q=b==g,
w=l[0],y=l[1],H=l[2],z=l[3],Q=(z-H)/l[4],Q=1>Q?Math.floor(1/Q-1E-5).toFixed(0).length:0;l=l[5]?Math.log(y/H)/Math.log(z/H):(y-H)/(z-H);k.textAlign="center";q?k.fillText("["+w+"]",f(t),t.y):k.fillText(w,f(t),t.y);k.strokeStyle="#00FF00";k.lineWidth=A?3:1;A?(k.textAlign="right",k.fillText(z.toFixed(Q),f(t)-10,t.y+15),k.textAlign="right",k.fillText(H.toFixed(Q),f(t)-10,t.y+t.Da-15)):(k.textAlign="right",k.fillText(H.toFixed(Q),t.x+28,t.y+15),k.textAlign="left",k.fillText(z.toFixed(Q),t.x+t.La-28,t.y+
15));k.beginPath();if(A){var P=t.y+15+(t.Da-30)*(1-l);k.moveTo(f(t),t.y+15);k.lineTo(f(t),t.y+t.Da-15);k.moveTo(f(t)-5,t.y+15);k.lineTo(f(t)+5,t.y+15);k.moveTo(f(t)-5,t.y+t.Da-15);k.lineTo(f(t)+5,t.y+t.Da-15);k.moveTo(f(t)-5,P);k.lineTo(f(t)+5,P)}else{var M=t.x+30+(t.La-60)*l;k.moveTo(t.x+30,t.y+15);k.lineTo(t.x+t.La-30,t.y+15);k.moveTo(t.x+30,t.y+15-5);k.lineTo(t.x+30,t.y+15+5);k.moveTo(t.x+t.La-30,t.y+15-5);k.lineTo(t.x+t.La-30,t.y+15+5);k.moveTo(M,t.y+15-5);k.lineTo(M,t.y+15+5)}k.stroke();"EQ_Q"==
w?(l=Math.log(1+1/(2*y*y)+Math.sqrt((2+1/(y*y))*(2+1/(y*y))/4-1))/Math.log(2),A?(k.textAlign="left",k.fillText(y.toFixed(Q),f(t)+10,P),k.textAlign="left",k.fillText("("+l.toFixed(Q+1)+")",f(t)+10,P+10)):(k.textAlign="right",k.fillText(y.toFixed(Q),M,t.y+30),k.textAlign="left",k.fillText("("+l.toFixed(Q+1)+")",M,t.y+30))):A?(k.textAlign="left",k.fillText(y.toFixed(Q),f(t)+10,P)):(k.textAlign="center",k.fillText(y.toFixed(Q),M,t.y+30))}}};b4w.module.__renderer=function(a,r){function d(a){for(var c=a.j,d=a.o,e=0;e<d.length;e++){var f=d[e];if(f.bb){var g=a,k=c,n=f.xd,m=f.D,M=m.hc;u.useProgram(M.Sj);for(var f=m.P,I=m.tq,C=M.yu,v=C.length;v--;){var p=C[v];p.Kn(u,p.Ig,g,n,m,k)}k=m.Vq;u.colorMask(k,k,k,k);u.depthMask(m.ba);m.Ta?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE);k=m.R;for(m=0;m<k.length;m++)C=k[m],u.activeTexture(u.TEXTURE0+m),u.bindTexture(C.$b,C.jb);if("SKY"==g.type){k=g;M=M.dk;m=k.j.ob.jb;C=k.dj;for(v=0;6>v;v++)if(p=l(v),h.bn?
(u.bindTexture(u.TEXTURE_CUBE_MAP,m),u.texImage2D(p,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,E)):(u.uniformMatrix4fv(M.u_cube_view_matrix,!1,C[v]),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,p,m,0),b(f,I,n.Jp)),k.El&&3!=v){var p=k,T=v,G=B;h.bn?G.set(E):(u.readPixels(191,191,1,1,u.RGBA,u.UNSIGNED_BYTE,G),255!=G[0]&&255!=G[1]&&255!=G[2]||u.readPixels(191,220,1,1,u.RGBA,u.UNSIGNED_BYTE,G));var r=G[0],F=G[1],G=G[2],r=r/255,F=F/255,G=G/255;2===T?(p.Dc[3]=r,p.Dc[7]=F,p.Dc[11]=G):2>T?(p.Dc[4*T]=
r,p.Dc[4*T+1]=F,p.Dc[4*T+2]=G):(p.Dc[4*(T-2)]=r,p.Dc[4*(T-2)+1]=F,p.Dc[4*(T-2)+2]=G)}g.ej+=6}else b(f,I,n.Jp),g.ej++}}}function c(a){if(a){var b=(a.ka?u.COLOR_BUFFER_BIT:0)|(a.ta?u.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "MAIN_GLOW":a=F;break;case "SHADOW_CAST":a=n;break;case "DEPTH":a=C;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=G;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=F;break;default:a=h.background_color}}else b=
u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT,a=h.background_color;u.colorMask(!0,!0,!0,!0);u.depthMask(!0);u.clearColor(a[0],a[1],a[2],a[3]);u.clear(b)}function b(a,b,c){u.bindBuffer(u.ARRAY_BUFFER,a.Pf);for(var d=0;d<b.length;d++){var e=b[d];u.enableVertexAttribArray(e.Ig);u.vertexAttribPointer(e.Ig,e.Ud,u.FLOAT,!1,0,e.lx+e.qz*c)}a.Ae?(u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a.Ae),u.drawElements(a.mode,a.count,a.Zn,0)):u.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)e=b[d],u.disableVertexAttribArray(e.Ig)}
function l(a){switch(a){case 0:return u.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return u.TEXTURE_CUBE_MAP_NEGATIVE_X;case 2:return u.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return u.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return u.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return u.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function f(a){var b=a.dk,c=[],d=[],e={},f;for(f in b){var h=!1;switch(f){case "u_proj_matrix":var g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.za)},h=!0;break;case "u_view_matrix":case "u_view_matrix_frag":g=
function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.ya)};h=!0;break;case "u_shadow_cast_billboard_view_matrix":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.St)};h=!0;break;case "u_view_proj_prev":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.XB)};h=!0;break;case "u_view_proj_inverse":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Hi)};h=!0;break;case "u_sky_vp_inverse":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Xd)};h=!0;break;case "u_camera_eye":case "u_camera_eye_frag":g=function(a,
b,c,d,e,f){a.uniform3fv(b,f.kf)};h=!0;break;case "u_camera_eye_last":g=function(a,b,c,d,e,f){a.uniform3fv(b,f.Br)};h=!0;break;case "u_camera_quat":g=function(a,b,c,d,e,f){a.uniform4fv(b,f.quat)};h=!0;break;case "u_view_max_depth":g=function(a,b,c,d,e,f){a.uniform1f(b,f.cb)};h=!0;break;case "u_camera_range":g=function(a,b,c,d,e,f){a.uniform2f(b,f.fb,f.cb)};break;case "u_csm_center_dists":g=function(a,b,c,d,e,f){a.uniform4fv(b,f.ir)};break;case "u_cam_water_depth":g=function(a,b,c){a.uniform1f(b,c.Zm)};
h=!0;break;case "u_waves_height":g=function(a,b,c){a.uniform1f(b,c.Vf)};break;case "u_waves_length":g=function(a,b,c){a.uniform1f(b,c.nh)};break;case "u_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.ac)};break;case "u_fog_params":g=function(a,b,c){a.uniform4fv(b,c.il)};break;case "u_underwater_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.Fd)};break;case "u_bloom_key":g=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":g=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};
break;case "u_time":g=function(a,b,c){a.uniform1f(b,c.time)};h=!0;break;case "u_wind":g=function(a,b,c){a.uniform3fv(b,c.Se)};break;case "u_sky_tex_dvar":g=function(a,b,c){a.uniform1f(b,c.Zt)};break;case "u_sky_tex_fac":g=function(a,b,c){a.uniform4fv(b,c.$t)};break;case "u_sky_tex_color":g=function(a,b,c){a.uniform3fv(b,c.Yt)};break;case "u_horizon_color":g=function(a,b,c){a.uniform3fv(b,c.pf)};break;case "u_zenith_color":g=function(a,b,c){a.uniform3fv(b,c.Xf)};break;case "u_environment_energy":g=
function(a,b,c){a.uniform1f(b,c.jf)};break;case "u_sky_color":g=function(a,b,c){a.uniform3fv(b,c.li)};break;case "u_rayleigh_brightness":g=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":g=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":g=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":g=function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":g=function(a,b,c){a.uniform1f(b,
c.rayleigh_strength)};break;case "u_mie_strength":g=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":g=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":g=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":g=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;case "u_light_positions":g=function(a,b,c){a.uniform3fv(b,c.sf)};break;case "u_light_directions":g=function(a,b,c){a.uniform3fv(b,
c.Fg)};break;case "u_light_color_intensities":g=function(a,b,c){a.uniform3fv(b,c.Eg)};break;case "u_light_factors":g=function(a,b,c){a.uniform4fv(b,c.Gg)};break;case "u_sun_quaternion":g=function(a,b,c){a.uniform4fv(b,c.ru)};break;case "u_sun_intensity":g=function(a,b,c){a.uniform3fv(b,c.qu)};break;case "u_sun_direction":g=function(a,b,c){a.uniform3fv(b,c.op)};break;case "u_height":g=function(a,b,c,d,e,f){a.uniform1f(b,f.height)};h=!0;break;case "u_model_matrix":g=function(a,b,c,d){a.uniformMatrix4fv(b,
!1,d.Y)};h=!0;break;case "u_transb":g=function(a,b,c,d){a.uniform4fv(b,d.Wc)};h=!0;break;case "u_transa":g=function(a,b,c,d){a.uniform4fv(b,d.Vc)};h=!0;break;case "u_arm_rel_trans":g=function(a,b,c,d){a.uniform4fv(b,d.Im)};h=!0;break;case "u_arm_rel_quat":g=function(a,b,c,d){a.uniform4fv(b,d.Hm)};h=!0;break;case "u_quat":g=function(a,b,c,d){a.uniform4fv(b,d.quat)};h=!0;break;case "u_quatsb":g=function(a,b,c,d){a.uniform4fv(b,d.Pc)};h=!0;break;case "u_quatsa":g=function(a,b,c,d){a.uniform4fv(b,d.Oc)};
h=!0;break;case "u_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.tg)};h=!0;break;case "au_center_pos":g=function(){};h=!0;break;case "au_wind_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.ee)};h=!0;break;case "au_wind_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.Te)};h=!0;break;case "au_detail_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.se)};h=!0;break;case "au_detail_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.re)};h=!0;break;case "au_branch_bending_amp":g=function(a,b,c,d){a.uniform1f(b,
d.me)};h=!0;break;case "u_node_values":g=function(a,b,c,d){a.uniform1fv(b,d.Fe)};h=!0;break;case "u_node_rgbs":g=function(a,b,c,d){a.uniform3fv(b,d.Kc)};h=!0;break;case "u_diffuse_color":g=function(a,b,c,d,e){a.uniform4fv(b,e.dd)};h=!0;break;case "u_diffuse_intensity":g=function(a,b,c,d,e){a.uniform1f(b,e.gf)};h=!0;break;case "u_diffuse_params":g=function(a,b,c,d,e){a.uniform2fv(b,e.Fc)};h=!0;break;case "u_emit":g=function(a,b,c,d,e){a.uniform1f(b,e.we)};h=!0;break;case "u_ambient":g=function(a,b,
c,d,e){a.uniform1f(b,e.je)};h=!0;break;case "u_specular_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.Yd)};h=!0;break;case "u_specular_alpha":g=function(a,b,c,d,e){a.uniform1f(b,e.gp)};h=!0;break;case "u_specular_params":g=function(a,b,c,d,e){a.uniform3fv(b,e.wc)};h=!0;break;case "u_reflect_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.reflect_factor)};h=!0;break;case "u_mirror_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.zo)};h=!0;break;case "u_grass_map_dim":g=function(a,b,c,d,e){a.uniform3fv(b,
e.mc)};h=!0;break;case "u_grass_size":g=function(a,b,c,d,e){a.uniform1f(b,e.Tn)};h=!0;break;case "u_scale_threshold":g=function(a,b,c,d,e){a.uniform1f(b,e.cs)};h=!0;break;case "u_cube_fog":g=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.Dc)};break;case "u_jitter_amp":g=function(a,b,c,d,e){a.uniform1f(b,e.Cs)};h=!0;break;case "u_jitter_freq":g=function(a,b,c,d,e){a.uniform1f(b,e.Ds)};h=!0;break;case "u_wireframe_mode":g=function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":g=
function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":g=function(a,b,c){a.uniform2fv(b,c.KA)};h=!0;break;case "u_subsample_indices":g=function(a,b,c){a.uniform4fv(b,c.LA)};h=!0;break;case "u_refr_bump":g=function(a,b,c,d,e){a.uniform1f(b,e.Bt)};h=!0;break;case "u_lamp_light_positions":g=function(a,b,c,d,e){a.uniform3fv(b,e.no)};break;case "u_lamp_light_directions":g=function(a,b,c,d,e){a.uniform3fv(b,e.lo)};break;case "u_lamp_light_color_intensities":g=function(a,
b,c,d,e){a.uniform3fv(b,e.ko)};break;case "u_lamp_light_factors":g=function(a,b,c,d,e){a.uniform4fv(b,e.mo)};break;case "u_halo_size":g=function(a,b,c,d,e){a.uniform1f(b,e.js)};h=!0;break;case "u_halo_hardness":g=function(a,b,c,d,e){a.uniform1f(b,e.fs)};h=!0;break;case "u_halo_rings_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.hs)};h=!0;break;case "u_halo_lines_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.gs)};h=!0;break;case "u_halo_stars_blend":g=function(a,b,c,d,e){a.uniform1f(b,e.ks)};h=!0;
break;case "u_halo_stars_height":g=function(a,b,c,d,e){a.uniform1f(b,e.ls)};h=!0;break;case "u_fresnel_params":g=function(a,b,c,d,e){a.uniform4fv(b,e.vd)};h=!0;break;case "u_texture_scale":g=function(a,b,c,d,e){a.uniform3fv(b,e.Mf)};h=!0;break;case "u_parallax_scale":g=function(a,b,c,d,e){a.uniform1f(b,e.parallax_scale)};h=!0;break;case "u_color_id":g=function(a,b,c,d){a.uniform3fv(b,d.Qk)};h=!0;break;case "u_line_points":g=function(a,b,c,d,e){a.uniform3fv(b,e.HG)};h=!0;break;case "u_diffuse_color_factor":g=
function(a,b,c,d,e){a.uniform1f(b,e.ff)};h=!0;break;case "u_alpha_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Ye)};h=!0;break;case "u_specular_color_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.eu)};h=!0;break;case "u_normal_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Ys)};h=!0;break;case "u_normalmap0_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Qg[0])};h=!0;break;case "u_normalmap1_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Qg[1])};h=!0;break;case "u_normalmap2_scale":g=function(a,b,c,
d,e){a.uniform2fv(b,e.Qg[2])};h=!0;break;case "u_normalmap3_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Qg[3])};h=!0;break;case "u_foam_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.foam_factor)};h=!0;break;case "u_foam_uv_freq":g=function(a,b,c,d,e){a.uniform2fv(b,e.Fr)};h=!0;break;case "u_foam_mag":g=function(a,b,c,d,e){a.uniform2fv(b,e.Er)};h=!0;break;case "u_foam_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Fn)};h=!0;break;case "u_water_norm_uv_velocity":g=function(a,b,c,d,e){a.uniform1f(b,
e.Ii)};h=!0;break;case "u_shallow_water_col":g=function(a,b,c,d,e){a.uniform3fv(b,e.shallow_water_col)};h=!0;break;case "u_shore_water_col":g=function(a,b,c,d,e){a.uniform3fv(b,e.shore_water_col)};h=!0;break;case "u_water_shallow_col_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.shallow_water_col_fac)};h=!0;break;case "u_water_shore_col_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.shore_water_col_fac)};h=!0;break;case "u_p_length":g=function(a,b,c,d,e){a.uniform1f(b,e.qa.vu)};h=!0;break;case "u_p_cyclic":g=
function(a,b,c,d,e){a.uniform1i(b,e.qa.cyclic)};h=!0;break;case "u_p_max_lifetime":g=function(a,b,c,d,e){a.uniform1f(b,e.qa.Js)};h=!0;break;case "u_p_fade_in":g=function(a,b,c,d,e){a.uniform1f(b,e.qa.qg)};h=!0;break;case "u_p_fade_out":g=function(a,b,c,d,e){a.uniform1f(b,e.qa.Gc)};h=!0;break;case "u_p_size":g=function(a,b,c,d,e){a.uniform1f(b,e.qa.size)};h=!0;break;case "u_p_alpha_start":g=function(a,b,c,d,e){a.uniform1f(b,e.qa.mq)};h=!0;break;case "u_p_alpha_end":g=function(a,b,c,d,e){a.uniform1f(b,
e.qa.lq)};h=!0;break;case "u_p_nfactor":g=function(a,b,c,d,e){a.uniform1f(b,e.qa.Eo)};h=!0;break;case "u_p_gravity":g=function(a,b,c,d,e){a.uniform1f(b,e.qa.ds)};h=!0;break;case "u_p_mass":g=function(a,b,c,d,e){a.uniform1f(b,e.qa.Td)};h=!0;break;case "u_p_size_ramp":g=function(a,b,c,d,e){a.uniform2fv(b,e.qa.Ut)};h=!0;break;case "u_p_color_ramp":g=function(a,b,c,d,e){a.uniform4fv(b,e.qa.Wq)};h=!0;break;case "u_p_wind_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.qa.Yu)};h=!0;break;case "u_texel_size":g=
function(a,b,c){a.uniform2fv(b,c.vp)};h=!0;break;case "u_p_time":g=function(a,b,c,d,e){a.uniform1f(b,e.qa.time)};h=!0;break;case "u_position":g=function(a,b,c,d,e){a.uniform3fv(b,e.ci)};h=!0;break;case "u_va_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.Mu)};h=!0;break;case "u_perspective_cast_far_bound":g=function(a,b,c){a.uniform1f(b,c.FB)};break;case "u_normal_offset":g=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":g=function(a,b,c,d,e,f){a.uniform4fv(b,
f.Sl)};break;case "u_v_light_matrix":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Lu)};h=!0;break;case "u_b_light_matrix":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.yq)};break;case "u_p_light_matrix0":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Ug[0])};h=!0;break;case "u_p_light_matrix1":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Ug[1])};h=!0;break;case "u_p_light_matrix2":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Ug[2])};h=!0;break;case "u_p_light_matrix3":g=function(a,b,c){a.uniformMatrix4fv(b,
!1,c.Ug[3])};h=!0;break;case "u_motion_blur_exp":g=function(a,b,c){a.uniform1f(b,c.Ss)};h=!0;break;case "u_motion_blur_decay_threshold":g=function(a,b,c){a.uniform1f(b,c.mb_decay_threshold)};h=!0;break;case "u_refl_plane":g=function(a,b,c,d){a.uniform4fv(b,d.fc)};h=!0;break;case "u_radial_blur_step":g=function(a,b,c){a.uniform1f(b,c.Yl)};break;case "u_god_rays_intensity":g=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":g=function(a,b,c){a.uniform1f(b,c.qi)};
break;case "u_ssao_blur_discard_value":g=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};h=!0;break;case "u_ssao_influence":g=function(a,b,c){a.uniform1f(b,c.pi)};break;case "u_ssao_dist_factor":g=function(a,b,c){a.uniform1f(b,c.oi)};break;case "u_dof_dist":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_distance)};h=!0;break;case "u_dof_front":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_front)};h=!0;break;case "u_dof_rear":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_rear)};h=!0;break;case "u_outline_intensity":g=
function(a,b,c,d){a.uniform1f(b,d.yd)};h=!0;break;case "u_outline_color":g=function(a,b,c){a.uniform3fv(b,c.zf)};break;case "u_draw_outline":g=function(a,b,c){a.uniform1f(b,c.wn)};h=!0;break;case "u_glow_mask_small_coeff":g=function(a,b,c){a.uniform1f(b,c.small_glow_mask_coeff)};h=!0;break;case "u_glow_mask_large_coeff":g=function(a,b,c){a.uniform1f(b,c.large_glow_mask_coeff)};h=!0;break;case "u_brightness":g=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":g=function(a,b,c){a.uniform1f(b,
c.contrast)};break;case "u_exposure":g=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":g=function(a,b,c){a.uniform1f(b,c.saturation)};break;default:g=null}g&&(g={name:f,Kn:g,Ig:b[f]},h?c.push(g):(d.push(g),e[f]=g))}a.yu=c;a.Qj=d;a.Ko=e}var m=r("__camera"),k=r("__config"),p=r("__debug"),e=r("__textures"),g=r("__util"),h=k.q,n=[1,1,1,1],C=[1,1,1,1],G=[0,0,0,1],F=[0,0,0,0],E=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,
1,1,0]);new Float32Array([2,2,2,0]);var u=null,B=new Uint8Array(4);a.Cd=function(a){var b=h.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);u=a};a.kj=function(a){if(a.bb){var b=a.j;u.bindFramebuffer(u.FRAMEBUFFER,b.ye);if(a.Jm){var e=b.ob;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,e.$b,e.jb,0)}u.viewport(0,
0,b.width,b.height);"MAIN_CUBE_REFLECT"!=a.type&&c(a);a.Fa?u.enable(u.BLEND):u.disable(u.BLEND);a.Kb?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST);if(a.va){for(var b=a.j,e=a.o,g=0;g<e.length;g++){var k=e[g],n=k.D,C=n.hc;u.useProgram(C.Sj);k=k.xd;C.Qj.length||f(C);for(var C=C.Qj,B=C.length;B--;){var G=C[B];G.Kn(u,G.Ig,a,k,n,b)}}a.va=!1}switch(a.type){case "DEPTH":h.ts?(u.enable(u.POLYGON_OFFSET_FILL),u.polygonOffset(5,5)):u.disable(u.POLYGON_OFFSET_FILL);u.cullFace(u.BACK);break;case "SHADOW_CAST":u.enable(u.POLYGON_OFFSET_FILL);
u.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);u.cullFace(u.BACK);break;case "MAIN_PLANE_REFLECT":u.disable(u.POLYGON_OFFSET_FILL);u.cullFace(u.FRONT);break;default:u.disable(u.POLYGON_OFFSET_FILL),u.cullFace(u.BACK)}if("MAIN_CUBE_REFLECT"==a.type)for(b=a.j,e=b.ob.jb,g=0;6>g;g++){n=l(g);b.ya=a.dj[g];m.Ym(b);u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,n,e,0);c(a);n=a.o;for(k=0;k<n.length;k++)n[k].bb=n[k].vn[g];d(a)}else d(a);p.Mx("draw subscene: "+a.type);u.bindFramebuffer(u.FRAMEBUFFER,
null)}};a.clear=function(a){u.bindFramebuffer(u.FRAMEBUFFER,a.j.ye);c(a)};a.pq=function(a){var b=a.tq;b.length=0;var c=a.P;a=a.hc;c&&a||g.ja("Incomplete batch");c=c.Mb;a=a.attributes;for(var d in a){var e=c[d];b.push({Ig:a[d],lx:4*e.offset,qz:1<e.frames?4*e.length:0,Ud:e.Ud})}};a.jx=f;a.rq=function(a){var b=a.hc,c=a.R;a=a.Nb;u.useProgram(b.Sj);for(var d=0;d<c.length;d++)u.uniform1i(b.dk[a[d]],d)};a.zt=function(a,b,c,d,e,f){d||(d=1);e||(e=1);f||(f=new Uint8Array(4*d*e));f.length!=4*d*e&&g.ja("read_pixels(): Wrong storage");
u.bindFramebuffer(u.FRAMEBUFFER,a);u.readPixels(b,c,d,e,u.RGBA,u.UNSIGNED_BYTE,f);u.bindFramebuffer(u.FRAMEBUFFER,null);return f};a.KD=function(a){var b=a.hc;u.useProgram(b.Sj);b.Qj.length||f(b);b=b.Ko.u_cube_fog;b.Kn(u,b.Ig,null,null,a,null)};a.hC=function(a,b){var c=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,c);if(a){var d=a,f=d.jb,d=d.$b==u.TEXTURE_CUBE_MAP?u.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.$b;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,d,f,0)}e.ys(b)?u.framebufferRenderbuffer(u.FRAMEBUFFER,
u.DEPTH_ATTACHMENT,u.RENDERBUFFER,b.Sf):e.Ej(b)&&(d=b,f=d.jb,d=d.$b,u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,d,f,0));p.Hx();u.bindFramebuffer(u.FRAMEBUFFER,null);return c};a.gC=function(a,b,c,d,f){null==a?(u.bindFramebuffer(u.FRAMEBUFFER,a),u.viewport(0,0,d,f),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT)):(e.Ej(b)&&u.deleteTexture(b.jb),e.ys(c)?u.deleteRenderbuffer(c.Sf):e.Ej(c)&&u.deleteTexture(c.jb),u.deleteFramebuffer(a))};a.tG=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,r){function d(a,b,d){var e=a.hf;"string"==typeof d&&(a=c(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==b){e[a][1]=d;return}e.push([b,d])}function c(a,b){for(var c=a.hf,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function b(a,b){var c=a+b;if(u[c])return u[c];if(B){var d=B[b];if(!d)return null;d=r("__gpp_parser").QG.parse(d)}else if(d=r("shader_texts")[b],!d)return null;return u[c]=d}function l(a,c,d){function e(c){c=c.a;for(var d=0;d<c.length;d++){var n=
c[d];switch(n.type){case "condition":a:for(var n=n.a,y=0;y<n.length;y++){var z=n[y];switch(z.type){case "if":case "elif":if(h(z.c)){e(z.group);break a}break;case "else":e(z.group);break a;case "ifdef":z.name in v&&e(z.group);break;case "ifndef":z.name in v||e(z.group)}}break;case "include":n=b(F.shaders_dir,F.SC+n.file);e(n);break;case "var":case "export":case "import":break;case "define":y=n.name;v[y]=n.b;n.Pa&&(m[y]=n.Pa);break;case "error":throw"Shader error: #error "+n.b.join(" ");case "line":break;
case "pragma":k.push("#pragma "+n.name+" "+n.b.join(" "));break;case "undef":n=n.name;delete v[n];delete m[n];break;case "warning":C.warn("Shader warning: #warning "+n.b.join(" "));break;case "extension":n=f(n.b,v,m,!1);k.push("#extension "+n.join(" "));break;case "#":break;case "node":t[n.name]=n;break;case "nodes_global":n=l;for(y=0;y<n.length;y++){var z=n[y],N=t[z.id];if(N)for(var B=0,D=0;D<N.h.length;D++){var O=N.h[D];"node_param"==O.type&&(O=O.qualifier.join(" ")+" ","vert"==a?O+=z.Rf[B]:"frag"==
a&&(O+=z.Pa[B],null!==z.Pl[B]&&(O+=" = "+z.Pl[B])),O+=";",k.push(O),B++)}}break;case "nodes_main":n=l;for(y=0;y<n.length;y++)if(z=n[y],N=t[z.id]){B={};D={};for(O=0;O<z.ed.length;O++)D[z.ed[O][0]]=[z.ed[O][1]];u=A=p=0;for(var O=z,ba=N.h,J=B,G=D,E=0;E<ba.length;E++){var H=ba[E];switch(H.type){case "node_in":var r=O.C[p];if(null!==O.co[p]){if(("MATERIAL_BEGIN"==O.id&&3===p||!G.MATERIAL_EXT&&("MATERIAL_BEGIN"==O.id&&4===p||"MATERIAL_END"==O.id&&3===p||"MATERIAL_END"==O.id&&4===p||"MATERIAL_END"==O.id&&
5===p)||"TEXTURE_COLOR"==O.id||"TEXTURE_NORMAL"==O.id)&&H.e){J[H.name]=O.co[p];p++;continue}var Z=H.qualifier.join(" ")+" ",Z=Z+r,Z=Z+(" = "+O.co[p]),Z=Z+";";k.push(Z)}J[H.name]=r;p++;break;case "node_out":r=O.pa[A];if(!H.e||-1<q.indexOf(r))Z=H.qualifier.join(" ")+" ",Z+=r,Z+=";",k.push(Z),J[H.name]=r;-1<q.indexOf(r)&&(G["USE_OUT_"+H.name]=[1]);A++;break;case "node_param":"vert"==a?r=O.Rf[u]:"frag"==a&&(r=O.Pa[u]),J[H.name]=r,u++}}k.push("{");g(z,N.g,B,D);k.push("}")}break;case "textline":n=f(n.b,
v,m,!1);k.push(n.join(" "));break;default:throw"Unknown element type: "+n.type;}}}function h(a,b){var c;c=f(a,v,m,!0,b);for(var d=[],e=0;e<c.length;e++)if(c[e]instanceof Object)switch(c[e].type){case "conditional_expr":var g=d.pop(),l=d.pop();d.pop()?d.push(l):d.push(g);break;case "logical_or_expr":g=d.pop();for(l=0;l<c[e].d-1;l++)k=d.pop(),g=g||k;d.push(g);break;case "logical_and_expr":g=d.pop();for(l=0;l<c[e].d-1;l++)k=d.pop(),g=g&&k;d.push(g);break;case "logical_bitor_expr":g=d.pop();for(l=0;l<
c[e].d-1;l++)g|=d.pop();d.push(g);break;case "logical_bitxor_expr":g=d.pop();for(l=0;l<c[e].d-1;l++)g^=d.pop();d.push(g);break;case "logical_bitand_expr":g=d.pop();for(l=0;l<c[e].d-1;l++)g&=d.pop();d.push(g);break;case "equal_expr":g=d.pop();l=d.pop();d.push(l==g);break;case "non_equal_expr":g=d.pop();l=d.pop();d.push(l!=g);break;case "le_expr":g=d.pop();l=d.pop();d.push(l<=g);break;case "ge_expr":g=d.pop();l=d.pop();d.push(l>=g);break;case "l_expr":g=d.pop();l=d.pop();d.push(l<g);break;case "g_expr":g=
d.pop();l=d.pop();d.push(l>g);break;case "left_shift_expr":l=d.pop();g=d.pop();d.push(l<<g);break;case "right_shift_expr":l=d.pop();g=d.pop();d.push(l>>g);break;case "add_expr":l=d.pop();g=d.pop();d.push(l+g);break;case "sub_expr":l=d.pop();g=d.pop();d.push(l-g);break;case "mul_expr":l=d.pop();g=d.pop();d.push(l*g);break;case "div_expr":l=d.pop();g=d.pop();d.push(l/g);break;case "mod_expr":l=d.pop();g=d.pop();d.push(l%g);break;case "pre_inc_expr":case "post_inc_expr":k=d.pop();d.push(++k);break;case "pre_dec_expr":case "post_dec_expr":k=
d.pop();d.push(--k);break;case "positive_expr":k=d.pop();d.push(+k);break;case "negative_expr":k=d.pop();d.push(-k);break;case "one_compl_expr":k=d.pop();d.push(~k);break;case "logic_negative_expr":k=d.pop();d.push(!k);break;default:G.ja("Unknown operation type: "+c[e].type)}else{var k=c[e];/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(k)?d.push(0):d.push(parseFloat(c[e]))}1==d.length?c=d[0]:(G.ja("Incorrect expression: "+c.join(" ")),c=void 0);return c}function g(a,b,c,d){for(var e=0;e<b.length;e++){var l=b[e];
switch(l.type){case "node_condition":a:for(var n=a,l=l.a,D=c,t=d,y=0;y<l.length;y++){var q=l[y];switch(q.type){case "node_if":case "node_elif":if(h(q.c,t)){g(n,q.g,D,t);break a}break;case "node_else":g(n,q.g,D,t);break a;case "node_ifdef":(q.name in v||q.name in t)&&g(n,q.g,D,t);break;case "node_ifndef":q.name in v||q.name in t||g(n,q.g,D,t)}}break;case "textline":n=[];for(D=0;D<l.b.length;D++)t=l.b[D],t in c?n.push(c[t]):n.push(t);n=f(n,v,m,!0,d);k.push(n.join(" "))}}}var l=d.vf;d=d.hf||[];for(var k=
[],v={},n=0;n<d.length;n++)v[d[n][0]]=[d[n][1]];for(n=0;n<l.length;n++)v["USE_NODE_"+l[n].id]=[1];var m={},t={},q=[];for(n in l)for(var y in l[n].C)q.push(l[n].C[y]);e(c);var p=0,A=0,u=0;return k.join("\n")}function f(a,b,c,d,e){var f=[];m(a,b,c,d,f,e);return f}function m(a,b,c,d,e,f){for(var g=0;g<a.length;g++){var h=a[g];h in b||f&&h in f?(h=f&&f[h]||b[h],0==h.length&&d?e.push(0):m(h,b,c,d,e,f)):e.push(h)}}function k(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);n.Nx(d,b,c);
return d}function p(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return e(a);case 2:return"vec2("+e(a[0])+","+e(a[1])+")";case 3:return"vec3("+e(a[0])+","+e(a[1])+","+e(a[2])+")";case 4:return"vec4("+e(a[0])+","+e(a[1])+","+e(a[2])+","+e(a[3])+")";case 9:return"mat3("+e(a[0])+","+e(a[1])+","+e(a[2])+","+e(a[3])+","+e(a[4])+","+e(a[5])+","+e(a[6])+","+e(a[7])+","+e(a[8])+")";case 16:return"mat4("+e(a[0])+","+e(a[1])+","+e(a[2])+","+e(a[3])+","+e(a[4])+","+e(a[5])+","+e(a[6])+","+e(a[7])+
","+e(a[8])+","+e(a[9])+","+e(a[10])+","+e(a[11])+","+e(a[12])+","+e(a[13])+","+e(a[14])+","+e(a[15])+")";default:throw"Wrong glsl value dimension";}}function e(a){return a%1?String(a):String(a)+".0"}var g=r("__assets"),h=r("__config"),n=r("__debug"),C=r("__print"),G=r("__util"),F=h.ec,E={},u={},B=null,A="anchors.glslf anchors.glslv color_id.glslf color_id.glslv depth.glslf depth.glslv grass_map.glslf grass_map.glslv halo.glslf halo.glslv main.glslf main.glslv main_stack.glslf main_stack.glslv particles_color.glslf particles_color.glslv particles_texture.glslf particles_texture.glslv procedural_skydome.glslf procedural_skydome.glslv special_lens_flares.glslf special_lens_flares.glslv special_skydome.glslf special_skydome.glslv special_water.glslf special_water.glslv wireframe.glslf wireframe.glslv postprocessing/anaglyph.glslf postprocessing/antialiasing.glslf postprocessing/bloom_combine.glslf postprocessing/compositing.glslf postprocessing/depth_pack.glslf postprocessing/dof.glslf postprocessing/glow.glslf postprocessing/bloom_blur.glslf postprocessing/god_rays.glslf postprocessing/god_rays.glslv postprocessing/god_rays_combine.glslf postprocessing/luminance.glslf postprocessing/luminance_av.glslf postprocessing/luminance_trunced.glslf postprocessing/luminance_trunced.glslv postprocessing/motion_blur.glslf postprocessing/outline.glslf postprocessing/postprocessing.glslf postprocessing/postprocessing.glslv postprocessing/smaa.glslf postprocessing/smaa.glslv postprocessing/ssao.glslf postprocessing/ssao_blur.glslf include/blending.glslf include/caustics.glslf include/depth_fetch.glslf include/dynamic_grass.glslv include/environment.glslf include/fog.glslf include/gamma.glslf include/lighting_nodes.glslf include/math.glslv include/mirror.glslf include/nodes.glslf include/nodes.glslv include/pack.glslf include/particles.glslv include/precision_statement.glslf include/procedural.glslf include/refraction.glslf include/scale_texcoord.glslv include/shadow.glslf include/shadow.glslv include/skin.glslv include/std_enums.glsl include/to_world.glslv include/wind_bending.glslv".split(" "),
t=[],y=null,q=!1;a.Cd=function(a){y=a};a.I=d;a.Uz=c;a.AG=function(a,b){for(var c=a.hf,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.yC=function(a){a.hf=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NODES_GLOW NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PERSPECTIVE_SHADOW_CAST PROCEDURAL_FOG PROCEDURAL_SKYDOME REFLECTION REFLECTION_PASS REFLECTION_TYPE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA MTEX_NEGATIVE MTEX_RGBTOINT NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_USAGE POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT USE_FOG WO_SKYBLEND WO_SKYPAPER WO_SKYREAL WO_SKYTEX WOMAP_BLEND WOMAP_HORIZ WOMAP_ZENUP WOMAP_ZENDOWN WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
c=0;c<b.length;c++){var e=b[c],f;switch(e){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "MTEX_NEGATIVE":case "MTEX_RGBTOINT":case "NODES_GLOW":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PERSPECTIVE_SHADOW_CAST":case "PROCEDURAL_FOG":case "PROCEDURAL_SKYDOME":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTION_TYPE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "USE_FOG":case "WO_SKYBLEND":case "WO_SKYPAPER":case "WO_SKYREAL":case "WO_SKYTEX":case "WOMAP_BLEND":case "WOMAP_HORIZ":case "WOMAP_ZENUP":case "WOMAP_ZENDOWN":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":f=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":f=1;break;case "SHADOW_TEX_RES":f=p(2048);break;case "AA_METHOD":f="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":f="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":f="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":f="POST_EFFECT_NONE";break;case "SHADOW_USAGE":f="NO_SHADOWS";break;case "SSAO_QUALITY":f=
"SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":f="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":f="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":f=h.q.precision;break;case "EPSILON":f="highp"==h.q.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":f="u_va_frame_factor";break;default:C.error("Unknown directive ("+a.Gi+", "+a.Gh+"): "+e)}d(a,e,f)}};a.mG=function(a){return a.Gi};a.Ur=function(a){return a.Gh};a.uG=function(a,b){for(var e=b.hf,f=0;f<e.length;f++){var g=e[f][0],h=
e[f][1];c(a,g)&&d(a,g,h)}};a.Qz=function(a){var c=JSON.stringify(a),d=E[c];if(d)return d;var e=a.Gh,d=b(F.shaders_dir,a.Gi),e=b(F.shaders_dir,e);if(!d||!e)return null;var f=l("vert",d,a),g=l("frag",e,a),d=y,h=k(d,c,f,d.VERTEX_SHADER),t=k(d,c,g,d.FRAGMENT_SHADER),e=d.createProgram();d.attachShader(e,h);d.attachShader(e,t);d.linkProgram(e);d.validateProgram(e);d.getProgramParameter(e,d.VALIDATE_STATUS)==d.ZE&&C.error("shader program is not valid",c);n.Ox(e,c,h,t,f,g);a={Op:h,Ir:t,Sj:e,attributes:{},
dk:{},Qj:[],Ko:{},yu:[],Wa:a};g=d.getProgramParameter(e,d.ACTIVE_ATTRIBUTES);for(f=0;f<g;f++)h=d.getActiveAttrib(e,f).name,a.attributes[h]=d.getAttribLocation(e,h);g=d.getProgramParameter(e,d.ACTIVE_UNIFORMS);for(f=0;f<g;f++)h=d.getActiveUniform(e,f).name.split("[0]").join(""),a.dk[h]=d.getUniformLocation(e,h);return E[c]=d=a};a.cB=function(){q=!1;if(b4w.module_check("shader_texts"))q=!0;else{for(var a=[],b=g.AT_TEXT,c=0;c<A.length;c++){var d=G.Ij(F.shaders_dir+A[c]);a.push([A[c],b,d])}b=function(a,
b){B||(B={});B[b]=a};a.length?g.enqueue(a,b,function(){q=!0}):C.error("Shaders have not been found.")}};a.Px=function(){return q};a.JF=function(){return t};a.Rr=function(){return E};a.cleanup=function(){for(var a in E){var b=E[a];y.deleteProgram(b.Sj);y.deleteShader(b.Op);y.deleteShader(b.Ir);delete E[a]}for(var c in u)delete u[c];for(var d in t)delete t[d]};a.KF=function(a){var b=a.hf;C.log("Shader: "+a.Gi+" "+a.Gh+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)C.log("  "+b[a][0],
b[a][1])};a.r=p;a.Rq=function(a,b){return b in a.dk?!0:!1};a.jA=function(a){return(y.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,r){function d(a){return 65536<a.O?t.Tr()?!1:!0:!1}function c(a){return 0<a.na.length?!0:!1}function b(a,b,d){if(!c(a))return a;d||y.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.O*(b||1)+", will use drawArrays","color: #aa0");b=a.na;d=a.O;var e=a.M,f=a.B,g;for(g in e){var h=e[g],k=C(h,d);e[g]=l(b,h,k)}for(e=0;e<f.length;e++){var n=f[e];for(g in n)h=n[g],k=C(h,d),n[g]=l(b,h,k)}for(e=0;e<a.aa.length;e++){g=a.aa[e].bc;for(var t in g)h=g[t],
k=C(h,d),g[t]=l(b,h,k)}a.O=b.length;a.na=new Uint16Array(0);return a}function l(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var f=a[e],g=0;g<c;g++)d[c*e+g]=b[c*f+g];return d}function f(a,b){var c=a.Xc,d=a.Mb[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function m(b,c){var d,e;switch(c){case a.Ji:case a.qk:d=M.TRIANGLES;e=M.STATIC_DRAW;break;case a.Wp:d=M.POINTS;e=M.STATIC_DRAW;
break;case a.pk:d=M.TRIANGLES;e=M.DYNAMIC_DRAW;break;case a.Vp:d=M.POINTS;e=M.DYNAMIC_DRAW;break;case a.bv:d=M.LINES;e=M.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.gk=e}function k(a){a.qf?(a.Ae||(a.Ae=M.createBuffer()),M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,a.Ae),M.bufferData(M.ELEMENT_ARRAY_BUFFER,a.qf,a.gk),a.$k=a.qf.byteLength):a.$k=0;a.Pf||(a.Pf=M.createBuffer());M.bindBuffer(M.ARRAY_BUFFER,a.Pf);M.bufferData(M.ARRAY_BUFFER,a.Xc,a.gk);a.nr=a.Xc.byteLength}function p(a){for(var b=
w.ub("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].na.length;b.na=new Uint32Array(c);var e=c=0,f=0;if(0<a[0].aa.length)for(var g=0;g<a[0].aa.length;g++){for(d=0;d<a.length;d++)c+=a[d].aa[g].bc.a_position.length,e+=a[d].aa[g].bc.a_normal.length,f+=a[d].aa[g].bc.a_tangent.length;d={a_position:new Float32Array(c),a_normal:new Float32Array(e),a_tangent:new Float32Array(f)};b.aa.push({sl:a[0].aa[g].sl,bc:d})}for(d=c=0;d<a.length;d++)c+=a[d].O;b.O=c;var e=a[0],h;for(h in e.M){for(d=c=0;d<
a.length;d++)c+=a[d].M[h].length;b.M[h]=new Float32Array(c)}for(h in e.B[0]){for(d=c=0;d<a.length;d++)c+=a[d].B[0][h].length;for(d=0;d<e.B.length;d++)b.B[d]=b.B[d]||{},b.B[d][h]=new Float32Array(c)}for(h=e=c=0;h<a.length;h++){for(var f=a[h],l=f.na,g=f.O,k=f.M,d=0;d<l.length;d++)b.na[c+d]=l[d]+e;var c=c+l.length,n;for(n in k){var l=k[n],t=e*C(l,g);b.M[n].set(l,t)}for(d=0;d<f.B.length;d++){var k=f.B[d],m=b.B[d];for(n in k)l=k[n],t=e*C(l,g),m[n].set(l,t)}e+=g}if(0<b.aa.length)for(h=0;h<b.aa.length;h++)for(n=
b.aa[h].bc,d=f=e=c=0;d<a.length;d++)g=a[d].aa[h].bc,n.a_position.set(g.a_position,c),n.a_normal.set(g.a_normal,e),n.a_tangent.set(g.a_tangent,f),c+=g.a_position.length,e+=g.a_normal.length,f+=g.a_tangent.length;return b}function e(a,c,d,e,f,l){var k=w.ub("SUBMESH_"+a.name+"_"+c),t=a.submeshes[c],m=t.base_length,q=a.materials[c];k.O=m;var C=!1;if(h(d,"a_texcoord")){var p=null,z=a.materials[c];c=a.submeshes[c];if(z.texture_slots.length)switch(z=z.texture_slots[0],z.texture_coords){case "UV":z=a.uv_textures.indexOf(z.uv_layer);
0==z||-1==z?p=new Float32Array(c.texcoord):1==z&&(p=new Float32Array(c.texcoord2));break;case "ORCO":for(var A=a.b4w_bounding_box_source,p=new Float32Array(2*c.base_length),z=(A.max_x+A.min_x)/2,B=(A.max_z+A.min_z)/2,G=A.max_x-A.min_x,A=A.max_z-A.min_z,E=0,M=0;M<c.position.length;M+=3)p[E++]=(c.position[M]-z)/G+.5,p[E++]=(B-c.position[M+2])/A+.5}null===p&&(p=new Float32Array(c.texcoord));c=p}else c=new Float32Array(0);if(h(d,"a_orco_tex_coord")){p=a.b4w_bounding_box_source;z=new Float32Array(3*t.base_length);
B=p.max_x-p.min_x;G=p.max_z-p.min_z;A=p.max_y-p.min_y;for(M=E=0;M<t.position.length;M+=3)0==B?z[E++]=-1:z[E++]=parseFloat(((t.position[M]-p.min_x)/B).toFixed(3)),0==G?z[E++]=-1:z[E++]=parseFloat(((-p.min_z-t.position[M+2])/G).toFixed(3)),0==A?z[E++]=-1:z[E++]=parseFloat(((t.position[M+1]-p.min_y)/A).toFixed(3));p=z}else p=new Float32Array(0);var D,z=t.group;if(h(d,"a_influence")&&e){B=new Float32Array(4*m);G=z.length/m;A=new Float32Array(G);for(E=0;E<G;E++)for(D in A[E]=-1,e)if(M=e[D],M.Su===E){A[E]=
M.fj;break}var O=3<G?G:4;e=new Float32Array(O);D=new Uint32Array(O);for(var E=new Float32Array(4),M=new Float32Array(O),O=new Uint32Array(O),ba=new Float32Array(4),J=0;J<m;J++)e.set(M),D.set(O),E.set(ba),B.set(n(z,G,J,m,A,e,D,E),4*J)}else B=new Float32Array(0);D=B;e=f?w.la(f):{};e.a_color={vg:!0};e.a_color.src=h(d,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,jd:7}]:[];f={a_texcoord:c,a_influence:D,a_orco_tex_coord:p};D=t.vertex_colors;c=t.color;p=a.name;z=[];for(B=0;B<D.length;B++)z.push(D[B].name);
for(var H in e)if(B=e[H].src,B.length){for(A=G=0;A<B.length;A++)G+=w.ah(B[A].jd);f[H]=new Float32Array(G*m);for(A=E=0;A<B.length;A++){var r=B[A].name,M=B[A].jd,O=w.Gt(M),F=z.indexOf(r);-1==F&&w.ja('vertex color "'+r+'" for mesh "'+p+'" not found.');ba=D[F].mask;J=w.ah(ba);(M&ba)!==M&&y.error("Wrong color extraction from "+r+" to "+H+".");for(var Q=r=0;Q<F;Q++)r+=w.ah(D[Q].mask);F=r*m;for(r=0;r<m;r++)for(Q=0;3>Q;Q++)O[Q]&&(f[H][r*G+(E+w.Wj(M,Q))]=c[F+r*J+w.Wj(ba,Q)]);E+=J}}else f[H]=new Float32Array(0);
H=a.uv_textures;e=t.texcoord;D=t.texcoord2;c=a.name;if(l)for(var Z in l){p=H.indexOf(Z);-1==p&&w.ja('uv map "'+Z+'" for mesh "'+c+'" not found');if(0==p)var P=new Float32Array(e);else 1==p&&(P=new Float32Array(D));f[l[Z]]=P}k.M=f;k.na=new Uint32Array(t.indices);l=t.position.length/m/3;P=(Z=h(d,"a_normal")&&t.normal.length?!0:!1)&&h(d,"a_tangent")&&t.tangent.length?!0:!1;H=q.texture_slots[0];H=Z&&q.texture_slots.length&&h(d,"a_tangent")&&"ORCO"==H.texture_coords&&H.use_map_normal?!0:!1;0<a.b4w_shape_keys.length&&
(C=!0);for(f=0;f<l;f++){q=g(t,d,m,Z,P,H,f,a.name);if(C)if(e={},e.name=a.b4w_shape_keys[f].name,k.aa.push(e),0!=f){e.bc=q;e.sl=a.b4w_shape_keys[f].value;continue}else e.bc=g(t,d,m,Z,P,H,f,a.name),e.sl=1;k.B.push(q)}if(1<l&&!C){a=k.B[0];var q={},K;for(K in a)q[K]=new Float32Array(a[K]);k.B.push(q)}h(d,"a_polyindex")&&(b(k,1,!0),k.M.a_polyindex=u(k));return k}function g(a,b,c,d,e,f,g,l){var k={},n=new Float32Array(3*c),t=new Float32Array(d?3*c:0),m=new Float32Array(e||f?4*c:0),q=g*c*3;n.set(a.position.subarray(q,
q+3*c),0);d&&(q=g*c*3,t.set(a.normal.subarray(q,q+3*c),0));if(e)q=g*c*4,m.set(a.tangent.subarray(q,q+4*c),0);else if(f)for(a=m,y.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+l+'". Please add a UV-map.'),l=0;l<c;l++)b=z,d=Q,b[0]=t[3*l],b[1]=t[3*l+1],b[2]=t[3*l+2],H.cross(b,w.AXIS_Z,d),0==H.length(d)&&H.cross(b,w.AXIS_X,d),H.normalize(d,d),a[4*l]=d[0],a[4*l+1]=d[1],a[4*l+2]=d[2],a[4*l+3]=1;else if(d&&h(b,"a_tangent"))for(m=new Float32Array(4*c),
c=0;c<m.length;c++)m[c]=1;k.a_position=n;k.a_normal=t;k.a_tangent=m;return k}function h(a,b){return-1<a.indexOf(b)?!0:!1}function n(b,c,d,e,f,g,h,l){for(var k=!0,n=0;n<c;n++){var t=b[n*e+d];if(-1!==t){var m=f[n];-1!==m&&(g[n]=t,h[n]=m,k=!1)}}if(k)return l;G(g,h,a.ym,!1);for(n=b=0;4>n;n++)b+=g[n];if(.01>b)return l;for(n=0;4>n;n++)g[n]/=b;if(.01>Math.abs(g[0]-1))l[0]=h[0]+1;else for(n=0;4>n;n++)l[n]=h[n]+g[n];return l}function C(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+
c+", base length="+b;return d}function G(b,c,d,e){for(var f=b.length,g=f,h=!1,l=e?-1:1;1<g||h;){1<g&&(g=Math.floor(g/1.247330950103979));for(var h=!1,k=0;g+k<f;k++)if(d==a.ym?0>l*(b[k]-b[k+g]):b[k]<b[k+g]&&e)h=b[k],b[k]=b[k+g],b[k+g]=h,h=c[k],c[k]=c[k+g],c[k+g]=h,h=!0}}function F(a,b,c){var d=[],e=[];H.subtract(b,a,d);H.subtract(c,a,e);H.normalize(d,d);H.normalize(e,e);return Math.acos(H.dot(d,e))}function E(a,b,d){b||(b=[]);d=d?a.B[0].a_normal:a.B[0].a_position;if(c(a)){a=a.na;for(var e=a.length/
3,f=0;f<e;f++){var g=new Float32Array(9),h=a[3*f];g[0]=d[3*h];g[1]=d[3*h+1];g[2]=d[3*h+2];h=a[3*f+1];g[3]=d[3*h];g[4]=d[3*h+1];g[5]=d[3*h+2];h=a[3*f+2];g[6]=d[3*h];g[7]=d[3*h+1];g[8]=d[3*h+2];b[f]=g}}else for(f=0;f<d.length;f++)g=new Float32Array(9),g[0]=d[9*f],g[1]=d[9*f+1],g[2]=d[9*f+2],g[3]=d[9*f+3],g[4]=d[9*f+4],g[5]=d[9*f+5],g[6]=d[9*f+6],g[7]=d[9*f+7],g[8]=d[9*f+8],b[f]=g;return b}function u(a){for(var b=new Float32Array(a.O),c=0;c<a.O;c++)b[c]=c%3;return b}function B(a,b,c){var d=H.dist(a,
b);a=H.dist(a,c);b=H.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}function A(a,b,c,d,e){c-=b;for(var f=0;f<c;f+=d)f%d==e&&vec3.normalize(a.subarray(f+b-e,f+b+1),a.subarray(f+b-e,f+b+1))}var t=r("__extensions"),y=r("__print"),q=r("__tsr"),w=r("__util"),H=r("__vec3"),z=new Float32Array(3),Q=new Float32Array(3),P=new Float32Array(3);a.he=10;a.dq=20;a.dF=30;a.qk=10;a.Wp=20;a.pk=30;a.Vp=40;a.bv=50;a.ym=0;a.ow=1;a.Ji=a.qk;var M=null;a.Cd=function(a){M=a};a.LF=function(a){var b=_buffers[a];M.deleteBuffer(b.Ae);
M.deleteBuffer(b.Pf);delete _buffers[a]};a.rD=function(e,f,g,h){d(e)&&b(e);var l=e.na,n=e.O,t=e.B,q={},y;for(y in e.M)y in h&&!h[y].vg||(q[y]=e.M[y]);h={qf:null,Xc:null,Zn:0,count:0,Mb:{},mode:0,gk:0,$k:0,nr:0,Pf:null,Ae:null,ql:null,aa:null};if(0<e.aa.length){y=t[0];for(var p=1;p<e.aa.length;p++){for(var z=e.aa[p].bc,A=z.a_position,u=z.a_normal,B=y.a_position,w=y.a_normal,G=A.length,E=e.aa[p].sl,H=0;H<G;H++)B[H]+=E*A[H],w[H]+=E*u[H];z=z.a_tangent;A=y.a_tangent;u=z.length;for(H=0;H<u;H++)A[H]+=E*
z[H]}}if(l.length)if(y=l.length,65536>=n)var p=new Uint16Array(l),D=M.UNSIGNED_SHORT;else p=new Uint32Array(l),D=M.UNSIGNED_INT;else y=n,p=null;var E=0,H=t.length,O;for(O in t[0])z=t[0][O],E+=z.length*H;for(O in q)z=q[O],E+=z.length;O=new Float32Array(E);var E=0,H={},ba;for(ba in q)if(A=q[ba],z=A.length)O.set(A,E),H[ba]={pF:ba,Ud:C(A,n),offset:E,frames:1,length:z},E+=z;q=t.length;for(ba in t[0])if(A=t[0][ba],z=A.length,A=C(A,n),z)for(H[ba]={Ud:A,offset:E,frames:q,length:z},1<q&&(H[ba+"_next"]={Ud:A,
offset:E+z,frames:q,length:z}),u=0;u<q;u++)A=t[u][ba],O.set(A,E),E+=z;h.count=y;h.qf=p;h.Xc=O;h.Zn=D;h.Mb=H;m(h,g);k(h);f!=a.he&&c(e)&&(h.ql={vB:new Float32Array(l.length),wB:new Float32Array(l.length),Wy:new Float32Array(l.length/3),type:f});h.aa=e.aa;return h};a.GA=d;a.FA=c;a.km=b;a.MD=function(a,b,c){m(a,b);a.count=c.length;a.qf=c;a.Zn=c instanceof Uint16Array?M.UNSIGNED_SHORT:M.UNSIGNED_INT};a.om=function(a,b,c,d){var e=a.Xc,f=a.Mb,g=f[b];g?(c&&g.Ud!=c&&w.ja('invalid num_comp for "'+b+'"'),e.set(d,
g.offset)):(e=e.length,g=new Float32Array(e+d.length),g.set(a.Xc),g.set(d,e),a.Xc=g,f[b]={Ud:c,offset:e});k(a)};a.gz=f;a.MG=function(a){a.gk=M.STATIC_DRAW};a.nB=function(a){a.gk=M.DYNAMIC_DRAW};a.Du=k;a.Tq=function(a){a.Ae&&M.deleteBuffer(a.Ae);a.Pf&&M.deleteBuffer(a.Pf)};a.ms=function(a,b){return a.submeshes[b].base_length?!1:!0};a.ou=function(a,b){for(var c=0;c<a.B.length;c++){var d=a.B[c].a_position;q.transform_vectors(d,b,d,0);d=a.B[c].a_normal;0<d.length&&q.transform_dir_vectors(d,b,d,0);d=a.B[c].a_tangent;
0<d.length&&q.transform_tangents(d,b,d,0)}(c=a.M.au_center_pos)&&c.length&&q.transform_vectors(c,b,c,0);return a};a.pD=function(a,b){var c=a.M.au_center_pos;if(c&&c.length){var d=new Float32Array(c);q.transform_vectors(d,b,d,0);for(var e=0;e<a.B.length;e++)for(var f=0;f<d.length;f++)a.B[e].a_position[f]+=d[f]-c[f];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.oD=function(a,b){var c=a.O,d;for(d in b){var e=b[d].length;a.M[d]=new Float32Array(e*c);for(var f=0;f<c;f++)for(var g=
0;g<e;g++)a.M[d][f*e+g]=b[d][g]}};a.qD=p;a.mB=function(a,c,d){if(!a.O)return w.ub("EMPTY");var e=d.length;65536<a.O*e&&!t.Tr()&&b(a,e);var f=a.na,g=a.O,h=a.M;a=a.B;for(var l in c){var k=c[l].length,n=k*g;h[l]=new Float32Array(n);for(var m=0;m<g;m++)for(n=0;n<k;n++)h[l][m*k+n]=c[l][n]}c=w.ub("CLONE_"+e+"_SUBMESHES");c.O=g*e;c.na=new Uint32Array(f.length*e);for(m=0;m<e;m++)for(k=f.length*m,l=g*m,n=0;n<f.length;n++)c.na[k+n]=f[n]+l;for(var y in h)for(f=h[y],n=f.length*e,k=C(f,g),c.M[y]=new Float32Array(n),
m=0;m<e;m++)l=g*k*m,c.M[y].set(f,l);for(y in a[0])for(m=0;m<a.length;m++)for(f=a[m][y],n=f.length*e,k=C(f,g),c.B[m]=c.B[m]||{},c.B[m][y]=new Float32Array(n),n=0;n<e;n++)switch(h=d[n],l=g*k*n,y){case "a_position":q.transform_vectors(f,h,c.B[m][y],l);break;case "a_normal":q.transform_dir_vectors(f,h,c.B[m][y],l);break;case "a_tangent":q.transform_tangents(f,h,c.B[m][y],l);break;default:throw"Wrong attribute name: "+y;}return c};a.zr=e;a.jz=function(a){var b=a.O,c=a.B[0].a_position,d=new Float32Array(12*
b),e=new Float32Array(8*b);a=new Uint16Array(4*a.na.length);for(var f=0;f<b;f++)d[12*f]=c[3*f],d[12*f+1]=c[3*f+1],d[12*f+2]=c[3*f+2],d[12*f+3]=c[3*f],d[12*f+4]=c[3*f+1],d[12*f+5]=c[3*f+2],d[12*f+6]=c[3*f],d[12*f+7]=c[3*f+1],d[12*f+8]=c[3*f+2],d[12*f+9]=c[3*f],d[12*f+10]=c[3*f+1],d[12*f+11]=c[3*f+2],e[8*f]=-.5,e[8*f+1]=-.5,e[8*f+2]=-.5,e[8*f+3]=.5,e[8*f+4]=.5,e[8*f+5]=.5,e[8*f+6]=.5,e[8*f+7]=-.5,a[6*f]=4*f+2,a[6*f+1]=4*f+1,a[6*f+2]=4*f,a[6*f+3]=4*f+2,a[6*f+4]=4*f,a[6*f+5]=4*f+3;c=w.ub("HALO");c.B=
[];c.B[0]={};c.O=4*b;c.B[0].a_position=d;c.M.a_halo_bb_vertex=e;c.na=a;return c};a.qA=h;a.Ar=function(a,b,c){for(var d=[],f=0;f<a.submeshes.length;f++){var g=e(a,f,b,null,c,null);g.O&&d.push(g)}return 0==d.length?w.ub("EMPTY"):1==d.length?d[0]:p(d)};a.LD=function(a,b,c){for(var d=a.qf,e=f(a,"a_position"),g=a.ql,h=g.vB,l=g.wB,g=g.Wy,k=d,n=k.length/3,t=0;t<n;t++){var m=k[3*t],q=k[3*t+1],y=k[3*t+2],C=e[3*m+1],p=e[3*m+2],z=e[3*q+1],A=e[3*q+2],D=e[3*y+1],O=e[3*y+2];h[3*t]=(e[3*m]+e[3*q]+e[3*y])/3;h[3*
t+1]=(C+z+D)/3;h[3*t+2]=(p+A+O)/3}w.Cf(h,b,l);b=l.length/3;for(e=0;e<b;e++)h=l[3*e]-c[0],k=l[3*e+1]-c[1],n=l[3*e+2]-c[2],g[e]=h*h+k*k+n*n;c=d;d=g.length;if(!(2>d))for(l=d,e=!1;1<l||e;)for(1<l&&(l=Math.floor(l/1.247330950103979)),e=!1,b=0;l+b<d;b++)0>g[b]-g[b+l]&&(e=g[b],g[b]=g[b+l],g[b+l]=e,e=c,h=b,k=b+l,n=e[3*h],t=e[3*h+1],m=e[3*h+2],e[3*h]=e[3*k],e[3*h+1]=e[3*k+1],e[3*h+2]=e[3*k+2],e[3*k]=n,e[3*k+1]=t,e[3*k+2]=m,e=!0);d=c;M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,a.Ae);M.bufferData(M.ELEMENT_ARRAY_BUFFER,
d,M.DYNAMIC_DRAW)};a.cu=G;a.Fq=function(a,b,c){for(var d=b.length/3,e=a.length/3,f=[],g=Array(3),h=Array(3),l=Array(3),k=0;k<e;k++){for(var n=a[3*k],t=a[3*k+1],m=a[3*k+2],q=0;3>q;q++)g[q]=b[3*n+q],h[q]=b[3*t+q],l[q]=b[3*m+q];if(c)var q=F(g,h,l),y=F(h,l,g),C=Math.PI-q-y;else C=y=q=1;var p=f,z;z=g;var D=l,O=[],A=[],u=[];H.subtract(h,z,O);H.subtract(D,z,A);H.cross(O,A,u);H.normalize(u,u);z=u;for(D=0;3>D;D++)O=3*t+D,A=3*m+D,p[3*n+D]=q*z[D],p[O]=y*z[D],p[A]=C*z[D]}if(c)for(var B in c)for(k=c[B],a=0;3>
a;a++){b=3*k[0]+a;for(e=1;e<k.length;e++)g=3*k[e]+a,f[b]+=f[g];for(e=1;e<k.length;e++)g=3*k[e]+a,f[g]=f[b]}for(k=0;k<d;k++){c=k;B=f;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=B[e];H.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,B[e]=a[b]}return f};a.Hq=function(a,b,c){for(var d={},e=b.length/3,f=0;f<e;f++){var g=String(b[3*f])+String(b[3*f+1])+String(b[3*f+2]);d[g]=[]}e=a.length;for(f=0;f<e;f++)b=a[f],g=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),g in d&&d[g].push(b);return d};a.Mn=function(a,
b,c,d){var e=E(a,null,!1);if(c)var f=E(a,null,!0);var g=e.length,h=new Float32Array(g),l=z,k=Q;for(a=0;a<g;a++){var n=e[a];l.set(n.subarray(0,3));k.set(n.subarray(3,6));P.set(n.subarray(6));h[a]=Math.sqrt(B(l,k,P))}l=new Float32Array(g);l[0]=h[0];for(a=1;a<g;a++)l[a]=l[a-1]+h[a];g=l[h.length-1];h=[];for(a=0;a<b;a++){var k=g*w.ld(d),k=w.Gk(l,k,0,l.length-1),n=c?f[k]:e[k],k=a,t=n,m=d,n=void 0,n=new Float32Array(3),q=t[0],y=t[1],C=t[2],p=t[3],A=t[4],D=t[5],O=t[6],u=t[7],J=t[8],t=w.ld(m),m=w.ld(m);1<
t+m&&(t=1-t,m=1-m);var G=1-t-m,y=G*y+t*A+m*u,C=G*C+t*D+m*J;n[0]=G*q+t*p+m*O;n[1]=y;n[2]=C;h[k]=n}return h};a.RF=E;a.Dn=u;a.gH=B;a.It=function(a,b,c){a=a.B[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]};a.bx=function(a,b,c){var d=a.Z[0].S;a=a.f.Ff;for(var e=1;e<a.length;e++)a[e].name==b&&(a[e].value=c);for(e=0;e<d.length;e++)if(!d[e].sg&&d[e].de&&!d[e].lg){c=d[e].P.Mb;b=d[e].P.Xc;M.bindBuffer(M.ARRAY_BUFFER,d[e].P.Pf);
var f=c.a_position,g=d[e],h=b,l=a;if(f){for(var k=f.offset,f=f.length+k,n=g.P.aa[0].bc.a_position,t=k;t<f;t++)h[t]=n[t-k];for(t=1;t<g.P.aa.length;t++){var n=g.P.aa[t].bc.a_position,m=l[t].value;if(m)for(var q=k;q<f;q++)h[q]+=m*n[q-k]}M.bufferSubData(M.ARRAY_BUFFER,4*k,h.subarray(k))}f=c.a_normal;g=d[e];h=b;l=a;if(f){k=f.offset;f=f.length+k;n=g.P.aa[0].bc.a_normal;for(t=k;t<f;t++)h[t]=n[t-k];for(t=1;t<g.P.aa.length;t++)if(n=g.P.aa[t].bc.a_normal,m=l[t].value)for(q=k;q<f;q++)h[q]+=m*n[q-k];A(h,k,f,
3,2);M.bufferSubData(M.ARRAY_BUFFER,4*k,h.subarray(k))}l=c.a_tangent;c=d[e];g=a;if(l){h=l.offset;l=l.length+h;f=c.P.aa[0].bc.a_tangent;for(k=h;k<l;k++)b[k]=f[k-h];for(k=1;k<c.P.aa.length;k++)if(f=c.P.aa[k].bc.a_tangent,t=g[k].value)for(n=h;n<l;n++)b[n]+=t*f[n-h];A(b,h,l,4,3);M.bufferSubData(M.ARRAY_BUFFER,4*h,b.subarray(h))}}};a.check_shape_keys=function(a){return a.f.de};a.get_shape_keys_names=function(a){var b=[];if(a.f)for(var c=1;c<a.f.Ff.length;c++)b.push(a.f.Ff[c].name);return b};a.get_shape_key_value=
function(a,b){if(a.f)for(var c=1;c<a.f.Ff.length;c++)if(b==a.f.Ff[c].name)return a.f.Ff[c].value;return 0};a.os=function(a,b){var c=a.f.Ff;if(c)for(var d=1;d<c.length;d++)if(c[d].name==b)return!0;return!1};a.Lh=function(a){return a&&a.f&&a.f.Pd?!0:!1}};b4w.module.__objects=function(a,r){function d(a){a.f.yd=0;a=qa.indexOf(a);-1!=a&&qa.splice(a,1)}function c(a){if(a.Dh)for(var b=a.Z,c=0;c<b.length;c++)v.SD(b[c].Wb,a)}function b(a,b){for(var c=a.Z,d=b.Z,e=0;e<c.length;e++){for(var f=!1,g=0;g<d.length;g++)if(c[e].Wb==d[g].Wb){f=!0;break}f||l(b,c[e].Wb)&&z.Ak(b,c[e].Wb)}}function l(a,b){return!b.xw&&"SPEAKER"==a.type||!b.yw&&("LAMP"==a.type||"CAMERA"==a.type)?!1:!0}function f(a,b){if(a.dg_parent&&a.dg_parent.eq||a.parent&&a.parent.eq)return!0;switch(a.type){case "MESH":var c=
F.Eq(a),d=a.b4w_do_not_batch,e=a.b4w_collision,f=a.b4w_vehicle,g=a.b4w_floating,h=a.b4w_character,l=Q.sA(a),k=H.ns(b),n=0<a.data.b4w_shape_keys.length,K=a.b4w_dynamic_geometry;if(!(c=c||d||e||f||n||g))a:{c=a.data;for(d=0;d<c.materials.length;d++)if("LENS_FLARES"===c.materials[d].name){c=!0;break a}c=!1}return c||l||h||k||K;case "EMPTY":return h=F.Eq(a),l=H.ns(b),k=a.b4w_do_not_batch,h||l||k;default:return!0}}function m(a,b,c,d,e,f,g,h,l){for(var n=0;n<a.nodes.length;n++){var t=a.nodes[n];if("VALUE"==
t.type){var K=p(b,t.name);d.push(t.outputs[0].default_value);e.push(K,e.length/2)}else"RGB"==t.type?(K=p(b,t.name),t=t.outputs[0].default_value.slice(0,3),g.push(t[0],t[1],t[2]),h.push(K,h.length/2)):"GROUP"==t.type&&(K=t.node_group.node_tree,m(K,p(b,t.name),K.animation_data,d,e,f,g,h,l))}if(c)for((a=c.action)&&k(a,b,f,e,l,h),c=c.nla_tracks,d=0;d<c.length;d++)for(g=c[d].strips,n=0;n<c[d].strips.length;n++)(a=g[n].action)&&k(a,b,f,e,l,h)}function k(a,b,c,d,f,g){var h=a.k.Pa,l;for(l in h){var k=p(b,
l.match(/"(.*?)"/)[1]),h=e(d,k);null!=h?(k=p(a.name,l),c.push(k,h)):(h=e(g,k),null!=h&&(k=p(a.name,l),f.push(k,h)))}}function p(a,b){return a+"%join%"+b}function e(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function g(a){return a instanceof Array?a.slice():a}function h(a){R.ALL.push(a);R[a.type]||(R[a.type]=[]);R[a.type].push(a);var b=a.f.Nc;if(null!=b)for(var c=0;c<ha.length;c++){var d=ha[c];d.f.Nc==b&&d.Vj.push(a)}}function n(a,b,c){b=R[b]||[];for(var d=[],e=0;e<b.length;e++){var f=
b[e];if(f.f.kc==c||-1==c)for(var g=f.Z,h=0;h<g.length;h++)g[h].Wb==a&&d.push(f)}return d}function C(a,b,c,d){for(var e=null,f=0;f<b.length;f++){var g=b[f];if((c?g.Ho:g.name)==a&&g.f.kc==d){e=g;break}}return e}function G(a){return a.Mc?a.parent:a.parent?G(a.parent):null}var F=r("__animation"),E=r("__batch"),u=r("__boundings"),B=r("__camera"),A=r("__config"),t=r("__constraints"),y=r("__geometry"),q=r("__lights"),w=r("__mat4"),H=r("__nla"),z=r("__obj_util"),Q=r("__particles"),P=r("__physics"),M=r("__print"),
I=r("__primitives"),L=r("__quat"),v=r("__scenes"),N=r("__sfx"),T=r("__transform"),U=r("__tsr"),ga=r("__util"),S=r("__vec3"),Y=A.q,ca=A.Lb,R={ALL:[]},V=0,pa=0,ha=[],qa=[],ma=new Float32Array(3),aa=new Float32Array(4);a.xm=0;a.wm=1;a.Ki=2;a.DATA_ID_ALL=-1;a.update=function(a){for(var b=R.ALL,c=0;c<b.length;c++)for(var e=b[c],f=e.Z,g=0;g<f.length;g++){var h=f[g].Wb;if(h.k.outline){if(-1!=qa.indexOf(e)){var l=e,k=a,n=0,t=l.Aw;0==t.wp&&(t.wp=k);k-=t.wp;if(t.Dt&&k/t.kd>=t.Dt)d(l);else{k%=t.kd;if(k<t.ht)switch(t=
k/(t.ht/5),k=Math.floor(t),k){case 0:n=(t-k)/2;break;case 1:n=(t-k)/2+.5;break;case 2:n=1;break;case 3:n=1-(t-k)/2;break;case 4:n=.5-(t-k)/2}l.f.yd=n}}e.f.yd&&v.kC(h)}}};a.apply_outline_anim=function(a,b,c,d){a.Aw={wp:0,ht:b,kd:c,Dt:d};-1==qa.indexOf(a)&&qa.push(a)};a.clear_outline_anim=d;a.Ep=function(a,b){R[b.type]||(R[b.type]=[]);R.ALL.push(b);R[b.type].push(b);a.eq=b.oa=f(a,b);a.eF=!0;b.nc=a.b4w_vehicle;b.is_character=a.b4w_character;b.Ag=a.b4w_floating;b.Ei=a.b4w_collision;var c=a.game;b.zd=
{Tl:c.physics_type,ik:c.use_ghost,Ku:c.use_sleep,Td:c.mass,Pu:c.velocity_min,Ou:c.velocity_max,qn:c.damping,Yo:c.rotation_damping,dB:c.lock_location_x,eB:c.lock_location_y,fB:c.lock_location_z,gB:c.lock_rotation_x,hB:c.lock_rotation_y,iB:c.lock_rotation_z,Zi:c.collision_margin,Xi:c.collision_group,$i:c.collision_mask,Gp:c.use_collision_bounds,Pk:c.collision_bounds_type,hk:c.use_collision_compound};if(c=a.b4w_vehicle_settings)b.xc={name:c.name,pc:c.part,uD:c.suspension_rest_length,pp:c.suspension_compression,
rp:c.suspension_stiffness,qp:c.suspension_damping,Rp:c.wheel_friction,Wo:c.roll_influence,xo:c.max_suspension_travel_cm,qj:c.force_max,Ui:c.brake_max,si:c.steering_max,Wh:c.max_speed_angle,gj:c.delta_tach_angle,Zj:c.speed_ratio,bk:c.steering_ratio,zj:c.inverse_control,rg:c.floating_factor,lh:c.water_lin_damp,mh:c.water_rot_damp,su:c.synchronize_position};if(c=a.b4w_floating_settings)b.Eh={name:c.name,pc:c.part,rg:c.floating_factor,lh:c.water_lin_damp,mh:c.water_rot_damp,su:c.synchronize_position};
if(c=a.b4w_character_settings)b.Nq={DE:c.walk_speed,qC:c.run_speed,lD:c.step_height,MA:c.jump_strength,FE:c.waterline};for(c=0;c<a.constraints.length;c++){var d=a.constraints[c];"RIGID_BODY_JOINT"==d.type&&b.Lo.push({target:d.target.Cb,JB:d.pivot_type,KB:d.pivot_x,LB:d.pivot_y,MB:d.pivot_z,Jd:d.axis_x,Kd:d.axis_y,Ld:d.axis_z,kE:d.use_limit_x,lE:d.use_limit_y,mE:d.use_limit_z,fE:d.use_angular_limit_x,gE:d.use_angular_limit_y,hE:d.use_angular_limit_z,WA:d.limit_max_x,XA:d.limit_max_y,YA:d.limit_max_z,
ZA:d.limit_min_x,$A:d.limit_min_y,aB:d.limit_min_z,QA:d.limit_angle_max_x,RA:d.limit_angle_max_y,SA:d.limit_angle_max_z,TA:d.limit_angle_min_x,UA:d.limit_angle_min_y,VA:d.limit_angle_min_z})}c=b.f=z.xh("MESH"===b.type?b.oa?"DYNAMIC":"STATIC":b.type);a.parent?(b.parent=a.parent.Cb,"BONE"==a.parent_type&&"ARMATURE"==a.parent.type&&(b.Pj=a.parent_bone)):a.dg_parent&&(b.parent=a.dg_parent.Cb,b.Mc=!0);var d=a.location,e=a.scale[0];ga.Qo(a.rotation_quaternion,aa);T.set_translation(b,d);T.set_rotation(b,
aa);T.set_scale(b,e);b.Hu=a.b4w_use_default_animation;a.b4w_object_tags&&(b.Rs={title:a.b4w_object_tags.title,description:a.b4w_object_tags.description,category:a.b4w_object_tags.category});switch(a.type){case "ARMATURE":e=a.pose.bones;for(d=0;d<e.length;d++){var g=e[d],h=g.bone,l=new Float32Array(h.matrix_local),k=new Float32Array(16);w.invert(l,k);var n=new Float32Array(g.matrix_basis),t=new Float32Array(3);S.subtract(h.tail_local,h.head_local,t);ga.xE(t,k,t);g.Cw=t;g.vw=[g].concat(g.parent_recursive);
g.gq=U.from_mat4(l,U.create());g.fq=U.from_mat4(n,U.create());g.Am=U.create();g.vk=!1}g=F.yx(b);c.$c=g;e=F.Gq(b,g);a.b4w_animation_mixing?(c.Pc=new Float32Array(e.Ea),c.Oc=new Float32Array(e.Ea),c.Wc=new Float32Array(e.i),c.Vc=new Float32Array(e.i)):(c.Pc=e.Ea,c.Oc=e.Ea,c.Wc=e.i,c.Vc=e.i);c.ot=e;c.tg=0;c.$e=a.b4w_animation_mixing;break;case "MESH":c.th=E.mx(a.data.b4w_bounding_box);c.bh=ca.outlining_overview_mode||a.b4w_selectable;c.Ll=a.b4w_selectable;c.Lb=ca.outlining_overview_mode||a.b4w_outlining;
c.Kl=a.b4w_outlining;c.gt=ca.outlining_overview_mode||a.b4w_outline_on_select;c.qd=a.b4w_billboard;c.Qm=a.b4w_pres_glob_orientation;c.Si="BASIC";c.Ri="SPHERICAL"==a.b4w_billboard_geometry;c.Kj={Ml:a.b4w_outline_settings.outline_duration,Nl:a.b4w_outline_settings.outline_period,Ol:a.b4w_outline_settings.outline_relapses};c.bh&&(c.Qk=ga.Jr(V),V++);for(d=0;d<a.data.b4w_vertex_anim.length;d++)e=a.data.b4w_vertex_anim[d],b.Ob.push({name:e.name,G:e.frame_start,N:e.frame_end,qF:e.averaging,rF:e.averaging_interval,
Ew:e.allow_nla});b.f.Ob=b.Ob.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;d=b.f;if(a.data.b4w_shape_keys.length)for(d.de=!0,e=0;e<a.data.b4w_shape_keys.length;e++)g={},g.value=a.data.b4w_shape_keys[e].value,g.name=a.data.b4w_shape_keys[e].name,d.Ff.push(g);else d.de=!1;if(d=F.Pr(a)){e=d.Cb;k=e.J;g=b.f;h=a.data;b.Bk=e;h=h.vertex_groups;if(h.length){for(var l=k.data.bones,n=k.pose.bones,t=0,k={},K=0;K<l.length;K++){var x=l[K].name,da=ga.keysearch("name",x,h);if(da){var y=ga.Qn(n,
"name",x);k[x]={Dq:K,fj:t++,Mo:y,Su:da.index}}}h=t;g.$c=k;l=F.Wr();g.Ge=h;h>2*l?(g.Rh=!1,M.error('too many bones for "'+a.name+'" / '+g.Ge+" bones (max "+l+" with blending, "+2*l+" without blending). Skinning will be disabled.")):g.Rh=!0}g=c.$c;e=F.Gq(e,g);d.b4w_animation_mixing?(c.Pc=new Float32Array(e.Ea),c.Oc=new Float32Array(e.Ea),c.Wc=new Float32Array(e.i),c.Vc=new Float32Array(e.i)):(c.Pc=e.Ea,c.Oc=e.Ea,c.Wc=e.i,c.Vc=e.i);c.Im=new Float32Array(4);c.Hm=L.create();c.ot=e;c.tg=0}d=b.f;e=a.data.materials;
g=[];h=[];l=[];k=[];n=[];t=[];for(K=0;K<e.length;K++)x=e[K],(da=x.node_tree)&&m(da,x.name,da.animation_data,g,h,l,k,n,t);d.Fe=g;d.Lg=h;d.Bl=l;d.Kc=k;d.Kg=n;d.Cl=t;c.Rc=a.b4w_shadow_cast;c.vc=a.b4w_shadow_receive;c.uc=a.b4w_shadow_cast_only&&c.Rc;c.gc=a.b4w_reflexible;c.Vb=a.b4w_reflexible_only&&c.gc;c.rc=a.b4w_reflective;c.Vd=a.b4w_reflection_type;c.oe=a.b4w_caustics;c.Yc=a.b4w_wind_bending;c.lk=a.b4w_wind_bending_angle;d=E.GE(a.b4w_wind_bending_angle,c.th,a.scale[0]);c.ee=d;c.Te=a.b4w_wind_bending_freq;
c.se=a.b4w_detail_bending_freq;c.re=a.b4w_detail_bending_amp;c.me=a.b4w_branch_bending_amp;c.Nh=!1;c.Ee=a.b4w_main_bend_stiffness_col;d=a.b4w_detail_bend_colors;c.Sb={};c.Sb.Hs=d.leaves_stiffness_col;c.Sb.Gs=d.leaves_phase_col;c.Sb.it=d.overall_stiffness_col;c.zh=a.b4w_do_not_cull;c.bl=a.b4w_disable_fogging;c.Pd=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";d=a.data.materials[0];c.sj=d.physics.friction;c.nj=d.physics.elasticity;c.Hj=0;c.tf=1E4;c.Jg=a.b4w_lod_transition;c.Al=!0;break;
case "CAMERA":B.Ax(a,b);B.gx(b);break;case "LAMP":q.NA(a,b);break;case "SPEAKER":b.w=N.wy();e=!1;for(d=0;d<b.Z.length;d++)if(b.Z[d].Wb.b4w_enable_audio){e=!0;break}e&&N.Ep(a,b);break;case "EMPTY":c.Hb=u.nd(),d=u.mk(),c.ad=d,a.field&&(b.Dh={type:a.field.type,mu:a.field.strength}),a.b4w_anchor&&(b.anchor={type:a.b4w_anchor.type,yh:a.b4w_anchor.detect_visibility,el:a.b4w_anchor.element_id,tB:a.b4w_anchor.max_width})}a.field&&(c.WF=a.field.strength)};a.VD=function(a){var c=a.f;if(a.parent){var d=c.i,
e=c.quat,f=c.scale;!a.Mc&&a.zd.hk&&a.parent.zd.hk&&(a.Ei=!1);var g=a.zd;a.nc||a.Ag||P.is_character(a)||a.Ei&&!g.ik&&0<g.Td&&("DYNAMIC"==g.Tl||"RIGID_BODY"==g.Tl)?(d=a.Mc?U.create_sep(d,f,e):c.Ka,U.multiply(a.parent.f.Ka,d,c.Ka),T.set_translation(a,U.get_trans_view(c.Ka)),T.set_scale(a,U.get_scale(c.Ka)),T.set_rotation(a,U.get_quat_view(c.Ka))):a.Mc||!a.Pj?(d=U.create_sep(d,f,e),t.Iw(a,a.parent,d)):(d=U.create_sep(d,f,e),t.Jw(a,a.parent,a.Pj,d))}if("MESH"==a.type&&c.rc)if(c=a.f,"CUBE"==c.Vd)c.bd=pa++;
else if("PLANE"==c.Vd){a:{d=a.J.constraints;for(e=0;e<d.length;e++)if(f=d[e],"LOCKED_TRACK"==f.type&&"REFLECTION PLANE"==f.name){d=f.target.Cb;break a}d=null}d||(d=ga.Bi("%reflection%"),d=z.kn(d,"EMPTY"),e=z.xh("EMPTY"),d.f=e,b(a,d),t.oq(d,a,[0,0,0],null,1),R.EMPTY||(R.EMPTY=[]),R.EMPTY.push(d),R.ALL.push(d));e=null;for(f=0;f<ha.length;f++)if(ha[f]==d){e=f;break}null==e&&(e=ha.length,ha.push(d));d.f.Nc=e;c.Nc=e;d.Vj.push(a)}};a.Cu=c;a.CF=b;a.Jx=l;a.WD=function(a){for(var b=0;b<a.length;b++){var c=
a[b];!c.f||"DYNAMIC"!=c.f.type&&"CAMERA"!=c.f.type||T.p(c);c.Hu&&F.et(c)&&(F.apply_def(c),c.H.length&&F.play(c,null,F.SLOT_ALL))}};a.get_meta_tags=function(a){return ga.la(a.Rs)};a.cleanup=function(){pa=V=0;ha=[];qa.length=0;R={ALL:[]}};a.copy=function(a,c,d){c=z.kn(c,a.type);c.f=z.ig(a.f);c.oa=a.oa;c.parent=a.parent;c.Mc=a.Mc;c.Pj=a.Pj;a.ie&&(c.ie=g(a.ie));c.zd=z.ig(a.zd);!a.m||a.nc||a.is_character||a.Ag||(c.m=z.ig(a.m));c.Ei=a.Ei;c.b4w_collision_id=a.b4w_collision_id;c.b4w_correct_bounding_offset=
a.b4w_correct_bounding_offset;c.data=a.data;b(a,c);for(var e=[],f=0;f<a.Z.length;f++){var l=c.Z[f],k=a.Z[f].S;if(d){for(var l=l.S,n=0;n<k.length;n++)k[n].sg||(l.push(z.ig(k[n])),e.push(k[n].P));for(n=0;n<k.length;n++)if(k[n].sg){var t=z.ig(k[n]);l.push(t);for(var m=0;m<e.length;m++)e[m]==k[n].P&&(t.P=l[m].P)}for(n=0;n<l.length;n++)l[n].P&&y.Du(l[n].P),l[n].ai=c.uuid,E.HD(l[n],ga.vh(c.f,0))}else l.S=g(k)}z.Zo(c,!1);if(C(a.name,R.ALL,!1,-1))for(f=1;;){d=a.name+(3>String(f).length?"."+("000"+String(f)).slice(-3):
"."+String(f));if(!C(a.name,R.ALL,!1,-1)){a.name=d;M.error('object "'+a.name+'" already exists. Name was replaced by "'+d+'".');break}f++}h(c);c.uuid=ga.Kr();c.f.ho=!0;c.f.Qk=ga.Jr(V);V++;return c};a.iA=function(a,b){for(var c=a.f.Lg,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null};a.cA=function(a,b){for(var c=a.f.Kg,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null};a.update_boundings=function(a){for(var b=a.f,c=a.Z[0].S,d,e,f,g,h,l,k=0;k<c.length;k++){var n=c[k];if("MAIN"==n.type){var n=
n.P.Xc,K=c[k].P.Mb,x=K.a_position.offset,K=K.a_position.length+x;d=g=n[x];e=h=n[x+1];f=l=n[x+2];for(var t=x;t<K;t+=3){var x=n[t],m=n[t+1],q=n[t+2];d=Math.max(x,d);e=Math.max(m,e);f=Math.max(q,f);g=Math.min(x,g);h=Math.min(m,h);l=Math.min(q,l)}}}var C={max_x:parseFloat(d.toFixed(3)),max_y:parseFloat(e.toFixed(3)),max_z:parseFloat(f.toFixed(3)),min_x:parseFloat(g.toFixed(3)),min_y:parseFloat(h.toFixed(3)),min_z:parseFloat(l.toFixed(3))},p=d-g,v=e-h,z=f-l;g=.5*(d+g);var A=.5*(e+h),B=.5*(f+l),w=g,G=B;
h=Math.max(p,Math.max(v,z))/2;l=Math.max(p,z)/2;var M=[g/(p?p:1),A/(v?v:1),B/(z?z:1)],H=.5;if(b.qd)x=Math.max(Math.abs(C.max_x),Math.abs(C.min_x)),m=Math.max(Math.abs(C.max_y),Math.abs(C.min_y)),q=Math.max(Math.abs(C.max_z),Math.abs(C.min_z)),h=Math.sqrt(x*x+m*m+q*q),l=Math.sqrt(x*x+m*m),C.max_x=C.max_y=C.max_z=h,C.min_x=C.min_y=C.min_z=-h,g=new Float32Array([0,0,0]),z=new Float32Array([h,h,h]),v=new Float32Array([0,0,0]);else{for(k=0;k<c.length;k++)if(n=c[k],"MAIN"==n.type)for(n=n.P.Xc,K=c[k].P.Mb,
x=K.a_position.offset,K=K.a_position.length+x,t=x;t<K;t+=3){var x=n[t],m=n[t+1],q=n[t+2],r=Math.sqrt((g-x)*(g-x)+(A-m)*(A-m)+(B-q)*(B-q));if(r>h){var F=g-h*(x-g)/r,N=A-h*(m-A)/r,r=B-h*(q-B)/r;g=(F+x)/2;A=(N+m)/2;B=(r+q)/2;h=Math.sqrt((g-x)*(g-x)+(A-m)*(A-m)+(B-q)*(B-q))}N=Math.sqrt((w-x)*(w-x)+(G-q)*(G-q));N>l&&(F=w-l*(x-w)/N,r=G-l*(q-G)/N,w=(F+x)/2,G=(r+q)/2,l=Math.sqrt((w-x)*(w-x)+(G-q)*(G-q)));x/=p?p:1;m/=v?v:1;q/=z?z:1;r=Math.sqrt((M[0]-x)*(M[0]-x)+(M[1]-m)*(M[1]-m)+(M[2]-q)*(M[2]-q));r>H&&(F=
M[0]-H*(x-M[0])/r,N=M[1]-H*(m-M[1])/r,r=M[2]-H*(q-M[2])/r,M[0]=(F+x)/2,M[1]=(N+m)/2,M[2]=(r+q)/2,H=Math.sqrt((M[0]-x)*(M[0]-x)+(M[1]-m)*(M[1]-m)+(M[2]-q)*(M[2]-q)))}k=p?p*M[0]:d;e=v?v*M[1]:e;f=z?z*M[2]:f;p*=H;v*=H;z*=H;g=new Float32Array([g,A,B]);z=new Float32Array([p,v,z]);v=new Float32Array([k,e,f]);l=parseFloat(l.toFixed(3))}b.Hb=C;E.GC(b,l,l,C);C=u.Wk(h,g);b.ad=C;C=u.Vk([z[0],0,0],[0,z[1],0],[0,0,z[2]],v);b.af=C;T.p(a);if(Y.wireframe_debug)for(k=0;k<c.length;k++)if("WIREFRAME"===c[k].type&&c[k].lg){a=
I.Ln(1,C.F);y.It(a,[C.Jd[0],C.Kd[1],C.Ld[2]],C.F);y.km(a,1,!0);a.M.a_polyindex=y.Dn(a);E.GD(c[k],a);break}};a.Dw=h;a.ma=n;a.dA=function(a,b){for(var c=R.ALL||[],d=[],e=0;e<c.length;e++){var f=c[e];if((f.f.kc==b||-1==b)&&f.J)for(var g=f.Z,h=0;h<g.length;h++)g[h].Wb==a&&d.push(f)}return d};a.get_all_objects=function(a){var b=R.ALL;if(-1==a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.f.kc==a&&c.push(e)}return c};a.ZC=function(a){var b=n(a,"LAMP",-1);if(b.length==a.k.PG){for(var c=[],d=0;d<
b.length;d++){var e=b[d],e=z.Ha(e,a);c[e.Gj]=d}for(d=0;d<c.length-1;d++)for(e=d+1;e<c.length;e++){var f=b[c[d]].Ia,g=b[c[e]].Ia;if(g.Di&&g.hh&&(!f.Di||!f.hh)||!f.Di&&(g.Di||!f.hh&&g.hh))f=c[d],c[d]=c[e],c[e]=f}for(d=0;d<c.length;d++)e=b[c[d]],z.Ha(e,a).Gj=d,v.Of(b[c[d]],a)}};a.ED=function(a){for(var b=n(a,"LAMP",-1),c=n(a,"MESH",-1),d=0;d<c.length;d++)for(var e=z.Ha(c[d],a).S,f=0;f<e.length;f++){var g=e[f];"MAIN"==g.type&&(E.ID(g,b,a),E.rb(g))}};a.eA=function(){for(var a=[],b=R.MESH,c=0;c<b.length;c++){var d=
b[c];d.f.bh&&a.push(d)}return a};a.lf=function(b,c,d,e){var f=null,g=R.ALL;switch(b){case a.xm:f=C(c,g,!1,d);break;case a.wm:b=null;if((c=C(c,g,!1,e))&&c.J.dupli_group){c=c.J.dupli_group.objects;g=[];for(b=0;b<c.length;b++)g.push(c[b].Cb);b=C(d,g,!0,e)}f=b;break;case a.Ki:b=g;e=null;for(g=0;g<c.length;g++)if((e=C(c[g],b,0!=g,d))&&e.J.dupli_group){b=e.J.dupli_group.objects;for(var f=[],h=0;h<b.length;h++)f.push(b[h].Cb);b=f}else break;f=e}return f};a.check_object=function(a){return R[a.type]&&-1<R[a.type].indexOf(a)?
!0:!1};a.pick_object=function(b,c){var d=v.wg();if(!d)return M.error("No active scene"),null;var e=v.HB(d,b,c);if(!e)return null;for(var f=n(d,"MESH",-1),g=0;g<f.length;g++){var h=f[g].f,l=h.Qk;if(l&&3>Math.abs(255*l[0]-e[0])&&3>Math.abs(255*l[1]-e[1])&&3>Math.abs(255*l[2]-e[2]))return h.Lb&&h.gt&&(ca.outlining_overview_mode?(v.set_outline_color(ca.zf),h.yd=ca.yd,a.apply_outline_anim(f[g],ca.Ml,ca.Nl,ca.Ol)):(v.set_outline_color(d.b4w_outline_color),h.yd=d.b4w_outline_factor,d=h.Kj,a.apply_outline_anim(f[g],
d.Ml,d.Nl,d.Ol))),f[g]}return null};a.set_wind_params=function(a,b){for(var d=n(a,"EMPTY",-1),e=0;e<d.length;e++){var f=d[e];if(f.Dh&&"WIND"===f.Dh.type)var g=f}if(!g)return M.error("There is no wind on the scene"),0;"number"==typeof b.wind_dir&&(S.set(-Math.PI/2,b.wind_dir/180*Math.PI,0,ma),ga.euler_to_quat(ma,aa),T.set_rotation(g,aa),c(g));"number"==typeof b.wind_strength&&(g.Dh.mu=b.wind_strength,c(g));v.Fp(a)};a.get_parent=function(a){return a.Mc?null:a.parent};a.get_dg_parent=G;a.remove_object=
function(a){t.Kx(a)&&t.remove(a);if(a.Mc&&a.parent&&a.parent.J.dupli_group.objects){var b=a.parent.J.dupli_group.objects.indexOf(a);-1!=b&&a.parent.J.dupli_group.objects.splice(b,1)}var b=R.ALL,c=R[a.type],d=b.indexOf(a);a=c.indexOf(a);-1!=d&&b.splice(d,1);-1!=a&&c.splice(a,1)}};b4w.module.__obj_util=function(a,r){function d(a,b,c){c||(c=a);return{data:null,Xe:[],ie:[],pd:null,name:a,Ho:c,type:b,IA:!1,oa:!1,io:!1,Hu:!1,f:null,pb:null,w:null,Ia:null,Bk:null,anchor:null,Dh:null,Rs:null,Z:[],Ob:[],rd:[],H:[],Vj:[],Gl:[],parent:null,Mc:!1,Pj:"",Ei:!1,nc:!1,is_character:!1,Ag:!1,m:null,l:null,fd:null,xc:null,Eh:null,Nq:null,Lo:[],zd:{Tl:"NO_COLLISION",ik:!1,Ku:!1,Td:0,Pu:0,Ou:0,qn:0,Yo:0,dB:!1,eB:!1,fB:!1,gB:!1,hB:!1,iB:!1,Zi:0,Xi:0,$i:0,Gp:!1,Pk:"BOX",hk:!1},J:null}}function c(a){if(!(a instanceof
Object))return a;var b=null,d=null,f=null;a.R&&(b=a.R,a.R=null);a.Nb&&(d=a.Nb,a.Nb=null);a.aa&&(f=a.aa,a.aa=null);var l;l=a.constructor;switch(l){case Float32Array:case Uint32Array:case Uint16Array:l=new l(a);break;case Array:l=new l(a.length);for(var k=0;k<a.length;k++)l[k]=c(a[k]);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:l=a;break;case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:l=null;break;case Function:l=a;break;default:for(k in l=new l,a)l[k]=c(a[k])}b&&(l.R=
b,a.R=b);d&&(l.Nb=d,a.Nb=d);f&&(l.aa=f,a.aa=f);return l}function b(a,b){for(var c=a.Z,d=0;d<c.length;d++){var f=c[d];if(f.Wb==b)return f}return null}var l=r("__camera"),f=r("__mat4");r("__print");var m=r("__quat"),k=r("__tsr"),p=r("__vec4");a.xh=function(a){a={type:a,kc:0,oA:[0,0],i:new Float32Array(3),quat:new Float32Array(4),Ka:new Float32Array(8),Y:new Float32Array(16),ss:new Float32Array(16),Ub:new Float32Array(3),dc:new Float32Array(3),Oh:0,Ph:0,ho:!1,Qk:null,yd:0,tp:!1,Iu:!1,Ba:l.MS_STATIC,
Lp:1,Kp:1,Mp:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,ue:null,zu:!1,te:0,ng:0,ib:!1,cc:null,ic:null,Fb:null,xn:!0,L:null,Kj:null,bd:null,Nc:null,fc:new Float32Array(4),sj:0,nj:0,Hj:0,Jg:0,Rc:!1,vc:!1,uc:!1,gc:!1,Vb:!1,rc:!1,Vd:"",oe:!1,Yc:!1,bl:!1,Pd:!1,Db:!1,zh:!1,Nh:!1,Al:!1,bh:!1,Ll:!1,Lb:!1,Kl:!1,gt:!1,wl:!1,is_visible:!1,In:!1,lk:0,ee:0,Te:0,se:0,re:0,me:0,Ee:"",Sb:null,Fk:!1,qd:!1,Qm:!1,Si:"",Ri:!1,tg:0,time:0,Jp:0,Mu:0,Ge:0,rj:!1,Ob:!1,de:!1,Ff:[],Rh:!1,$e:!1,Ze:1,Gm:0,Fm:1,nm:new Int8Array([-1,
-1]),hm:[],Qs:[],Wt:[],Pc:null,Oc:null,Wc:null,Vc:null,$c:null,ot:null,Im:null,Hm:null,Fe:null,Lg:null,Bl:null,Kc:null,Kg:null,Cl:null,th:null,Hb:null,Nm:null,Lm:null,Mm:null,kb:null,ad:null,Ib:null,af:null,bg:null,scale:1,tf:1E4};m.identity(a.quat);k.identity(a.Ka);f.identity(a.Y);f.identity(a.ss);return a};a.kn=d;a.gr=function(a){a=d(a,"MESH");a.IA=!0;a.particle_systems=[];return a};a.ig=c;a.oa=function(a){return a.oa};a.Aj=function(a){return"MESH"==a.type&&a.oa};a.Ak=function(a,b){a.Z.push({Wb:b,
tl:!1,S:[],Bf:null,ef:null,Tt:[],Gj:0})};a.zk=function(a,c,d){b(a,c).S.push(d)};a.UG=function(a,b){for(var c=a.Z,d=0;d<c.length;d++)if(c[d].Wb==b){c.splice(d,1);break}};a.Ha=b;a.Fu=function(a,b){for(var c=0;c<a.length;c++)p.copy(b,a[c].f.fc)};a.Zo=function(a,b,c){for(var d=0;d<a.Z.length;d++){var f=a.Z[d];c&&f.Wb!=c||(f.tl=b)}};a.Pn=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.Ia.Mr)return c}return null}};b4w.module.__particles=function(a,r){function d(){throw"_rand() undefined";}function c(a,b,c,d,e,f,l){var k=a.al,t=a.ud,y=a.time;a=a.rt;for(var q=b?4:1,p=0;p<k.length;p+=q){var H=k[p];if(y>a&&y>=H&&H>a||y<a&&(H>a||y>=H))for(H=0;8>H;H++)t[8*p+H]=e[H];for(H=0;8>H;H++)g[H]=t[8*p+H];H=h;H[0]=c[3*p];H[1]=c[3*p+1];H[2]=c[3*p+2];m.transform_vec3(H,g,H);f[3*p]=H[0];f[3*p+1]=H[1];f[3*p+2]=H[2];var z=h;z[0]=d[3*p];z[1]=d[3*p+1];z[2]=d[3*p+2];m.transform_dir_vec3(z,g,z);l[3*p]=z[0];l[3*p+1]=z[1];l[3*p+2]=z[2];
if(b)for(H=1;4>H;H++)f[3*(p+H)]=f[3*p],f[3*(p+H)+1]=f[3*p+1],f[3*(p+H)+2]=f[3*p+2],l[3*(p+H)]=z[0],l[3*(p+H)+1]=z[1],l[3*(p+H)+2]=z[2]}}function b(a){a?(k.jD(a),d=function(){return k.ZB()}):d=function(){return Math.random()}}var l=r("__config"),f=r("__geometry");r("__scenes");var m=r("__tsr"),k=r("__util"),p=r("__vec3"),e=l.ke,g=new Float32Array(8),h=new Float32Array(3);a.$h=function(a){a=a.Z;for(var b=0;b<a.length;b++)for(var c=a[b].S,d=0;d<c.length;d++)if(c[d].qa)return!0;return!1};a.Go=function(a){a=
a.Z;for(var b=0;b<a.length;b++)for(var c=a[b].S,d=0;d<c.length;d++){var e=c[d].qa;if(e&&"EMITTER"==e.Io)return!0}return!1};a.wx=function(a){return 0<a.particle_systems.length};a.vx=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;return!1};a.sA=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.xA=function(a,b,c){var d=a.qa={name:b.name,
Io:b.settings.type,time:0,rt:-1,Ip:!1,G:0,N:0,vu:0,qo:0,Js:0,cyclic:!1,Td:0,Eo:0,ds:0,qg:0,Gc:0,Yu:0,size:0,mq:0,lq:0,Vt:0,Xq:0,Ut:new Float32Array(8),Wq:new Float32Array(16),ci:null,pt:null,Zs:null,$s:null,al:null,tn:null,ud:null};d.G=b.settings.frame_start;d.N=b.settings.frame_end;d.vu=(d.N-d.G)/e.Na;d.qo=b.settings.lifetime;d.Js=d.qo/e.Na;d.cyclic=b.settings.b4w_cyclic?1:0;d.Td=b.settings.mass;d.Eo=b.settings.normal_factor;d.ds=9.81*b.settings.effector_weights.gravity;d.qg=b.settings.b4w_fade_in/
e.Na;d.Gc=b.settings.b4w_fade_out/e.Na;d.Yu=b.settings.effector_weights.wind;d.Ip="WORLD"==b.settings.b4w_coordinate_system?!0:!1;var f,g;a.xg?(a=c.halo.size,f=c.halo.hardness,30>f?(f=.5,g=.9):40>f?(f=.1,g=1):50>f?(f=0,g=.8):(f=0,g=.5)):(a=b.settings.particle_size,g=f=1);d.size=a;d.mq=f;d.lq=g;a=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(a[0]&&a[0].use_map_size&&a[0].texture&&"BLEND"==a[0].texture.type&&a[0].texture.use_color_ramp){a=a[0].texture.color_ramp.elements;f=Math.min(2*a.length,
b.length);for(g=0;g<f;g+=2){var h=a[g/2];b[g]=h.position;b[g+1]=(h.color[0]+h.color[1]+h.color[2])/3}d.Vt=a.length}d.Ut.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){a=b[0].texture.color_ramp.elements;f=Math.min(4*a.length,c.length);for(g=0;g<f;g+=4)h=a[g/4],c[g]=h.position,c[g+1]=h.color[0],c[g+2]=h.color[1],c[g+3]=h.color[2];d.Xq=a.length}d.Wq.set(c)};a.Az=function(a,
g,h,l){var m=a.qa,u=h.settings.count,B=h.settings.frame_start/e.Na,A=h.settings.frame_end/e.Na,t=h.settings.lifetime/e.Na,y=h.settings.lifetime_random,q=h.settings.emit_from,w=h.settings.factor_random,H=h.settings.angular_velocity_mode,z=h.settings.angular_velocity_factor,r=h.settings.b4w_randomize_emission,P=h.settings.b4w_cyclic,M=!a.xg;b(h.seed);g=f.Ar(g,["a_position","a_normal"],null);switch(q){case "VERT":h=g.B[0].a_position;g=g.B[0].a_normal;for(var I=h.length/3,q=[],L=0;L<u;L++){var v=Math.round((I-
1)*d());q.push(v);M&&(q.push(v),q.push(v),q.push(v))}I=[];for(L=0;L<q.length;L++)I.push(h[3*q[L]]),I.push(h[3*q[L]+1]),I.push(h[3*q[L]+2]);h=new Float32Array(I);I=[];for(L=0;L<q.length;L++)I.push(g[3*q[L]]),I.push(g[3*q[L]+1]),I.push(g[3*q[L]+2]);q=new Float32Array(I);break;case "FACE":h=[];q=[];L=[];k.rl(0,L);I=f.Mn(g,u,!1,L);k.rl(0,L);g=f.Mn(g,u,!0,L);for(L=0;L<I.length;L++)h.push(I[L][0],I[L][1],I[L][2]),M&&(h.push(I[L][0],I[L][1],I[L][2]),h.push(I[L][0],I[L][1],I[L][2]),h.push(I[L][0],I[L][1],
I[L][2])),q.push(g[L][0],g[L][1],g[L][2]),M&&(q.push(g[L][0],g[L][1],g[L][2]),q.push(g[L][0],g[L][1],g[L][2]),q.push(g[L][0],g[L][1],g[L][2]));h=new Float32Array(h);q=new Float32Array(q);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}q=[h,q];g=q[0];q=q[1];m.ci=new Float32Array(g);m.Zs=new Float32Array(q);m.pt=new Float32Array(g.length);m.$s=new Float32Array(q.length);h=[];A=(A-B)/u;for(I=0;I<u;I++)L=r?A*I+10*A*(.5-d()):A*I,P||(L+=B),
h.push(L),M&&(h.push(L),h.push(L),h.push(L));B=new Float32Array(h);m.al=new Float32Array(B);m.tn=new Float32Array(B);m.ud=new Float32Array(8*B.length);for(r=0;r<8*B.length;r++)for(P=0;8>P;P++)m.ud[8*r+P]=l[P];m.Ip&&c(m,M,g,q,l,g,q);l=k.ub("EMITTER_PARTICLES");m=k.sd();m.a_position=g;m.a_normal=q;l.B[0]=m;if(M){a.ve=f.pk;a=[];for(m=0;m<u;m++)a.push(4*m,4*m+2,4*m+1,4*m,4*m+3,4*m+2);a=new Uint16Array(a);l.na=a;a=l.M;m=[];for(r=0;r<u;r++)m.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);m=new Float32Array(m);a.a_p_bb_vertex=
m}else a.ve=f.Vp,l.na=new Uint16Array(0);l.O=g.length/3;l.M.a_p_delay=B;a=l.M;m=[];y*=t;for(B=0;B<u;B++)r=y*d(),m.push(t-r),M&&(m.push(t-r),m.push(t-r),m.push(t-r));t=new Float32Array(m);a.a_p_lifetime=t;t=l.M;y=[];for(a=0;a<u;a++){m=[d()-.5,d()-.5,d()-.5];p.normalize(m,m);y.push(w*m[0]);y.push(w*m[1]);y.push(w*m[2]);switch(H){case "NONE":y.push(0);break;case "SPIN":case "VELOCITY":y.push(z);break;case "RAND":y.push(2*z*(d()-.5));break;default:throw"Undefined velocity factor";}if(M)for(m=y.slice(-4),
B=0;12>B;B++)y.push(m[B%4])}u=new Float32Array(y);t.a_p_vels=u;return l};a.RD=function(a,b){for(var d=0;d<b.length;d++){var e=b[d],g=b[d].qa;if(g){var h=e.P;if(!g.Ip)break;var l=g.pt,k=g.$s;c(g,!e.xg,g.ci,g.Zs,a.f.Ka,l,k);f.nB(h);f.om(h,"a_position",3,l);f.om(h,"a_normal",3,k)}}};a.KC=function(a,b,c){a=a.Z;for(var d=0;d<a.length;d++)for(var e=a[d].S,f=0;f<e.length;f++){var g=e[f].qa;g&&g.name==b&&(g.rt=g.time,g.time=c)}};a.TB=function(a){for(var b=a.O,c=a.B[0].a_position,d=a.M.a_texcoord,e=[],f=[],
g=0;g<b;g++)f.push(c[3*g]),f.push(c[3*g+1]),e.push(c[3*g+2]);e=new Float32Array(e);f=new Float32Array(f);a.M.a_lf_dist=e;a.M.a_lf_bb_vertex=f;a.M.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.Z;for(var d=0;d<a.length;d++)for(var e=a[d].S,f=0;f<e.length;f++){var g=e[f].qa;g&&g.name==b&&(g.size=c)}};a.set_normal_factor=function(a,b,c){a=a.Z;for(var d=0;d<a.length;d++)for(var e=a[d].S,f=0;f<e.length;f++){var g=e[f].qa;g&&g.name==b&&(g.Eo=c)}};a.set_factor=function(a,b,c){a=a.Z;for(var d=0;d<
a.length;d++)for(var e=a[d].S,g=0;g<e.length;g++){var h=e[g],l=h.qa;if(l&&l.name==b){var k=l.al;if(1==c)l=k;else if(0==c)for(var m=!h.xg,q=m?4:1,l=l.tn,p=0;p<l.length;p+=q)l[p]=1E4,m&&(l[p+1]=l[p],l[p+2]=l[p],l[p+3]=l[p]);else for(var H=1/c,l=l.tn,q=(m=!h.xg)?4:1,z=0,p=0;p<l.length;p+=q)p>=z?(l[p]=k[p],z+=H):l[p]=1E4,m&&(l[p+1]=l[p],l[p+2]=l[p],l[p+3]=l[p]);f.om(h.P,"a_p_delay",1,l)}}};a.bE=function(a,b,c){a=a.Z;for(var d=0;d<a.length;d++)for(var e=a[d].S,f=0;f<e.length;f++){var g=e[f].qa;if(g)for(var h=
0;h<8*g.al.length;h++)g.ud[8*h]=b[0],g.ud[8*h+1]=b[1],g.ud[8*h+2]=b[2],g.ud[8*h+3]=b[3],g.ud[8*h+4]=c[0],g.ud[8*h+5]=c[1],g.ud[8*h+6]=c[2],g.ud[8*h+7]=c[3]}}};b4w.module.__primitives=function(a,r){function d(a,b,c,d){for(var f=[],l=[],m=[],p=[],u=2*c/(a-1),B=2*d/(b-1),A=0;A<a;A++)for(var t=-c+A*u,y=0;y<b;y++)if(l.push(t,0,-d+y*B),m.push(0,1,0),p.push(A/(a-1),y/(b-1)),A&&y){var q=A*b+y,w=q-1,H=(A-1)*b+y,z=H-1;f.push(q,w,H);f.push(w,z,H)}a=k.sd();a.a_position=new Float32Array(l);a.a_normal=new Float32Array(m);m=k.ub("GRID_PLANE");m.B[0]=a;m.M.a_texcoord=new Float32Array(p);m.na=new Uint32Array(f);m.O=l.length/3;return m}function c(a){var b=a.length;if(b%
4)throw"Wrong array";for(var c=[],d=[],f=0;f<b;f+=4){var m=a[f+1],p=a[f+2],r=a[f+3];l(a[f],d);l(m,d);l(p,d);l(r,d);c.push(f,f+1,f+2);c.push(f,f+2,f+3)}a=k.sd();a.a_position=new Float32Array(d);b=k.ub("FROM_QUADS");b.B[0]=a;b.na=new Uint32Array(c);b.O=d.length/3;return b}function b(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function l(a,b){b.push(a[0],a[1],a[2])}var f=r("__config"),m=r("__geometry");r("__print");var k=r("__util"),p=f.q;a.dG=function(a){for(var b=k.ub("LINE"),c=[],d=0;d<2*a;d++)c.push(d);
d=k.sd();d.a_point=new Float32Array(c);b.B[0]=d;b.na=new Uint32Array(c);b.O=2*a;return b};a.eG=function(a,b){var c=d(2,2,a,b);c.name="PLANE";return c};a.cG=d;a.Fz=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==E-1)||1==b%2&&(0==a||a==r-1)?!0:!1}var f=c/=Math.pow(2,a-1),l=c,r=b+1,E=b+1;b=[];c=[];for(var u=0,B=0,A=-1,t=[],y=0;y<a;y++){for(var q=2*f/(r-1),w=2*l/(E-1),H=[],z=[],Q=0,P=0;P<r;P++){for(var M=-f+P*q,I=[],L=0;L<E;L++){var v=-l+L*w;if(M>-u&&M<u&&v>-B&&v<B)I.push(-1),Q++;else{for(var N=
null,T=0;T<t.length;T+=3)if(M==t[T]&&v==t[T+1]){N=t[T+2];break}T=null!==N?N:A+1;d(P,L)?(I.push(-2),Q++):(null==N&&(0==L||L==E-1||0==P||P==r-1?(N=y==a-1?q:2*q,H.push(M,v,T)):N=q,c.push(M,N,v),A++),I.push(T));if(P&&L)if(1==P)if(d(P-1,L)){if(1<L){var v=T-1,N=z[P-1][L+1],U=N-1;b.push(T,v,U)}else N=z[P-1][L+1],U=N-1;b.push(T,U,N)}else d(P,L)||(v=T-1,N=z[P-1][L],b.push(T,v,N));else if(P==r-1){if(!d(P,L))if(L==E-1)v=T-1,N=z[P-1][L-1],U=z[P-2][L],b.push(T,v,N),b.push(T,N,U);else{var v=T-1,N=z[P-1][L],U=N-
1,ga=N+1;b.push(T,v,U);b.push(T,U,N);b.push(T,N,ga);2==L&&(ga=z[P-2][L-2],b.push(v,ga,U))}}else 1==L?d(P,L-1)?(v=z[P-1][L],N=z[P-1][L-1],b.push(T,N,v)):(v=I[L-1],N=z[P-1][L],U=z[P-2][L-1],b.push(T,v,N),b.push(v,U,N)):L==E-1?d(P,L)||(v=I[L-1],N=z[P-1][L-1],U=z[P-2][L],b.push(T,v,N),b.push(T,N,U)):-1!=z[P-1][L]&&-1!=z[P-1][L-1]&&-1!=I[L-1]?(v=I[L-1],N=z[P-1][L],U=z[P-1][L-1],b.push(T,v,N),b.push(v,U,N),L==E-2&&d(P,L+1)&&(ga=z[P-1][L+1],b.push(T,N,ga))):L==E-2&&d(P,L+1)&&(N=z[P-1][L],ga=z[P-1][L+1],
b.push(T,N,ga))}}z.push(I)}t=H;u=f;B=l;f*=2;l*=2}2E4>u&&(a=-(2*u)/(r-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-u,a,-B),c.push(-u,a,B),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(u,a,-B),c.push(u,a,B),T=A+1,b.push(T+3,T+2,T+1,T+2,T+0,T+1,T+6,T+4,T+2,T+4,T+0,T+2,T+5,T+7,T+1,T+7,T+3,T+1,T+5,T+4,T+7,T+7,T+4,T+6));a=k.sd();a.a_position=new Float32Array(c);f=k.ub("multigrid_plane");f.B[0]=a;f.na=new Uint32Array(b);f.O=c.length/3;p.Xu&&(m.km(f,1,!0),a.a_polyindex=m.Dn(f));return f};a.bG=function(a){var b=
a.length;if(b%3)throw"Wrong array";for(var c=[],d=[],f=0;f<b;f+=3){var m=a[f+1],p=a[f+2];l(a[f],d);l(m,d);l(p,d);c.push(f,f+1,f+2)}a=k.sd();a.a_position=new Float32Array(d);b=k.ub("FROM_TRIANGLES");b.B[0]=a;b.na=new Uint32Array(c);b.O=d.length/3;return b};a.aG=c;a.Bz=function(a){a=k.yE(a);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=c(b);a.name="FRUSTUM";return a};
a.vb=function(){var a=k.ub("FULLSCREEN_TRI"),b=k.sd();b.a_position=new Float32Array([0,0,1,0,0,1]);a.B[0]=b;a.na=new Uint32Array([0,1,2]);a.O=3;return a};a.Cz=function(){var a=k.ub("FULLSCREEN_QUAD"),b=k.sd();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.B[0]=b;a.na=new Uint32Array([0,2,1,1,2,3]);a.O=4;return a};a.xz=function(){var a=k.ub("BILLBOARD"),b=k.sd();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.B[0]=b;a.na=new Uint32Array([0,2,1,0,3,2]);a.O=4;return a};a.yz=function(){var a=
k.ub("CUBEMAP_BOARD"),b=k.sd();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.B[0]=b;a.na=new Uint32Array([0,2,1,0,3,2]);a.O=4;return a};a.Ln=function(a,c){var d=k.ub("UV_SPHERE"),f,p,r=[],F=[],E=[];for(p=0;8>=p;p++)for(f=0;16>=f;f++){var u=f/16,B=p/8;F.push(-a*Math.cos(2*u*Math.PI)*Math.sin(B*Math.PI)+c[0],a*Math.cos(B*Math.PI)+c[1],a*Math.sin(2*u*Math.PI)*Math.sin(B*Math.PI)+c[2])}for(p=u=0;8>p;p++)for(f=0;16>f;f++){var B=b(F,17*p+f+1),A=b(F,17*p+f),t=b(F,17*(p+1)+f),y=b(F,17*(p+1)+f+1);
Math.abs(B[1])==a+c[1]?(l(B,r),l(t,r),l(y,r),E.push(u,u+1,u+2),u+=3):Math.abs(t[1])==a+c[1]?(l(B,r),l(A,r),l(t,r),E.push(u,u+1,u+2),u+=3):(l(B,r),l(A,r),l(t,r),l(y,r),E.push(u,u+1,u+2),E.push(u,u+2,u+3),u+=4)}f={};f.a_position=r;F=m.Hq(E,F,r);f.a_normal=m.Fq(E,r,F);f.a_tangent=[];d.M.a_influence=[];d.M.a_color=[];d.M.a_texcoord=[];d.B[0]=f;d.na=E;d.O=r.length/3;return d};a.Lr=function(a){var b=k.ub("INDEX"),c=k.sd();c.a_index=new Float32Array(a);for(var d=0;d<a;d++)c.a_index[d]=d;b.B[0]=c;b.na=new Uint16Array(0);
b.O=a;return b}};b4w.module.__prerender=function(a,r){function d(a,c){var d=a.xd,e=c.j;d.is_visible=!1;var f;if(!(f=!d||d.Nh)){var l=e.kf,k=d.Ib.F;f=d.tf;l=Math.sqrt((k[0]-l[0])*(k[0]-l[0])+(k[1]-l[1])*(k[1]-l[1])+(k[2]-l[2])*(k[2]-l[2]));k=d.Jg*d.Ib.Ja;f=!(l>=d.Hj&&l<f+k)}if(f)return!1;d.is_visible=!0;(f="OUTLINE_MASK"==c.type&&!Boolean(d.yd))||(e=e.tj,d.zh?f=!1:("STATIC"===d.type?(f=d.Ib,d=f.F,d=m.eD(d,e,f.Ja)):(f=d.bg,d=f.F,d=m.az(d,e,f.Jd,f.Kd,f.Ld)),f=d));return f?!1:"WIREFRAME"==c.type?a.D.wireframe_mode==b.cq.WM_DEBUG_SPHERES?
a.D.lg:!a.D.lg:!0}var c=r("__config"),b=r("__debug"),l=r("__geometry"),f=r("__renderer"),m=r("__util"),k=r("__vec3"),p=c.q,e="MAIN_OPAQUE MAIN_BLEND MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_GLOW SHADOW_CAST DEPTH OUTLINE_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.No=function(a){if(-1<e.indexOf(a.type)){for(var b=!1,c=a.o,m=0;m<c.length;m++){var r=c[m];if("MAIN_CUBE_REFLECT"==a.type)for(var F=0;6>F;F++)a.j.tj=a.nn[F],r.vn[F]=d(r,a),r.vn[F]&&(b=!0);else r.bb=d(r,a),r.bb&&
(b=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||b?a.bb=!0:(a.bb&&f.clear(a),a.bb=!1)}}if("MAIN_BLEND"==a.type&&p.alpha_sort&&a.o){b=a.j.kf;c=k.dist(b,a.av)>p.alpha_sort_threshold;for(m=0;m<a.o.length;m++)if(F=a.o[m],r=F.xd,r.In||c){var E=F.D;if(E&&E.Fa&&E.Ve!=l.he){E=E.P;if(!E||!F.bb)continue;(F=E.ql)&&F.type==l.dq&&l.LD(E,r.Y,b)}r.In=!1}c&&k.copy(b,a.av)}}};b4w.module.__print=function(a){function r(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var d=1;d<a.length;d++)c.push(a[d]);return c}var d=!1,c=0,b=0;a.LC=function(a){d=a};a.uo=function(){console.log.apply(console,arguments)};a.log=function(){if(d){var a=r(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=function(){c++;var a=r(arguments,"B4W ERROR");console.error.apply(console,a)};a.warn=function(){b++;var a=r(arguments,"B4W WARN");console.warn.apply(console,
a)};a.info=function(){var a=r(arguments,"B4W INFO");console.info.apply(console,a)};a.ez=function(){c++;var a=r(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.fz=function(){b++;var a=r(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){d&&console.time.apply(console,arguments)};a.timeEnd=function(){d&&console.timeEnd.apply(console,arguments)};a.group=function(){d&&console.group.apply(console,arguments)};a.groupCollapsed=function(){d&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){d&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.mA=function(){return b};a.Vz=function(){return c};a.clear_errors_warnings=function(){c=b=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,r){function d(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"alpha"in a||(a.alpha=1,b("node material",a,"alpha"));"darkness"in a||(a.darkness=1,b("node material",a,"darkness"));"diffuse_toon_size"in a||(a.diffuse_toon_size=.5,b("node material",a,"diffuse_toon_size"));"diffuse_toon_smooth"in a||(a.diffuse_toon_smooth=.1,b("node material",a,"diffuse_toon_smooth"));"diffuse_intensity"in
a||(a.diffuse_intensity=1,b("node material",a,"diffuse_intensity"));"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_ior"in a||(a.specular_ior=4,b("node material",a,"specular_ior"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=.5,b("node material",a,"specular_toon_size"));
"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in a||(a.diffuse_fresnel_factor=.5,b("node material",
a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name="B4W_"+a.node_tree_name}}}
function c(a){if(a=a.nla_tracks)for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.strips.length;e++){var f=d.strips[e];"action"in f||(f.action=null,b("strip",f,"action"));"action_frame_start"in f||(f.action_frame_start=0,b("strip",f,"action_frame_start"));"action_frame_end"in f||(f.action_frame_end=f.frame_end-f.frame_start,b("strip",f,"action_frame_end"));"repeat"in f||(f.repeat=1,b("strip",f,"repeat"));"use_reverse"in f||(f.use_reverse=!1,b("strip",f,"use_reverse"));"scale"in f||(f.scale=1,b("strip",
f,"scale"))}}function b(a,b,c){c=c+">>"+a;c in F||(F[c]={lp:[],Et:"undefined",type:a});F[c].lp.push(b.name)}function l(a,b,c){c=c+">>"+a;c in F||(F[c]={lp:[],Et:"deprecated",type:a});F[c].lp.push(b.name)}function f(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=h.fg(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var f=h.Wi(d[c]);e.submeshes.push(f)}return e}var m=r("__boundings"),k=
r("__curve"),p=r("__mat4"),e=r("__print"),g=r("__quat"),h=r("__util"),n=r("__vec3"),C=r("__vec4"),G=[5,4],F={};a.Qq=function(a){return-1!=h.Qu(a,G)};a.Ix=function(a){F={};var f=a.worlds;if(0==f.length){e.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var g={name:"DEFAULT",horizon_color:new Float32Array([0,0,0]),zenith_color:new Float32Array([0,0,0]),light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},fog_settings:{use_fog:!1,
intensity:0,depth:25,start:5,height:0,falloff:"INVERSE_QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,texture_slots:[]};f.push(g)}for(var f=a.worlds,k=0;k<f.length;k++){g=f[k];"use_sky_blend"in g||(b("world",g,"use_sky_blend"),g.use_sky_blend=!1);"use_sky_paper"in g||(b("world",g,"use_sky_paper"),g.use_sky_paper=!1);"use_sky_real"in g||(b("world",g,"use_sky_real"),g.use_sky_real=!1);"b4w_sky_settings"in g&&"rayleigh_brightness"in g.b4w_sky_settings||
(b("world",g,"rayleigh_brightness"),g.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"fog_settings"in g||(b("world",g,"fog_settings"),g.fog_settings={use_fog:!1,intensity:0,depth:25,start:0,height:0,falloff:"QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},
"b4w_fog_color"in g&&(g.fog_settings.use_custom_color=!0,g.fog_settings.color=g.b4w_fog_color),"b4w_fog_density"in g&&0<g.b4w_fog_density&&(g.fog_settings.depth=1/g.b4w_fog_density));"render_sky"in g.b4w_sky_settings||(b("world",g,"render_sky"),g.b4w_sky_settings.render_sky=!1);for(var m=g.texture_slots,g=0;g<m.length;g++){var n=m[g];"blend_type"in n||(n.blend_type="MIX",b("world_texture_slot",n,"blend_type"));"use_map_blend"in n||(n.use_map_blend=!1,b("world_texture_slot",n,"use_map_blend"));"use_map_horizon"in
n||(n.use_map_horizon=!0,b("world_texture_slot",n,"use_map_horizon"));"use_map_zenith_up"in n||(n.use_map_zenith_up=!1,b("world_texture_slot",n,"use_map_zenith_up"));"use_rgb_to_intensity"in n||(n.use_rgb_to_intensity=!1,b("world_texture_slot",n,"use_rgb_to_intensity"));"invert"in n||(n.invert=!1,b("world_texture_slot",n,"invert"));"color"in n||(n.color=[1,0,1],b("world_texture_slot",n,"color"));"blend_factor"in n||(n.blend_factor=0,b("world_texture_slot",n,"blend_factor"));"horizon_factor"in n||
(n.horizon_factor=1,b("world_texture_slot",n,"horizon_factor"));"zenith_up_factor"in n||(n.zenith_up_factor=0,b("world_texture_slot",n,"zenith_up_factor"));"zenith_down_factor"in n||(n.zenith_down_factor=0,b("world_texture_slot",n,"zenith_down_factor"));"default_value"in n||(n.default_value=1,b("world_texture_slot",n,"default_value"))}}g=a.scenes;for(k=0;k<g.length;k++)m=g[k],n=m.world,"timeline_markers"in m||(m.timeline_markers=null,b("scene",m,"timeline_markers")),"b4w_reflection_quality"in m||
(m.b4w_reflection_quality="MEDIUM",b("scene",m,"b4w_reflection_quality")),"b4w_use_nla"in m||(m.b4w_use_nla=!1,b("scene",m,"b4w_use_nla")),"fps"in m||(m.fps=24,b("scene",m,"fps")),"b4w_nla_cyclic"in m||(m.b4w_nla_cyclic=!1,b("scene",m,"b4w_nla_cyclic")),"b4w_logic_nodes"in m||(m.b4w_logic_nodes=[],b("scene",m,"b4w_logic_nodes")),"b4w_detect_collisions"in m&&(l("scene",m,"b4w_detect_collisions"),delete m.b4w_detect_collisions),"audio_doppler_speed"in m||(m.audio_doppler_speed=343.3),"audio_doppler_factor"in
m||(m.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in m||(m.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",m,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in m||(m.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in m||(m.b4w_enable_bloom=!1,b("scene",m,"b4w_enable_bloom")),"b4w_enable_motion_blur"in m||(m.b4w_enable_motion_blur=!1,b("scene",m,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in m||(m.b4w_enable_color_correction=
!1,b("scene",m,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in m||(m.b4w_enable_antialiasing=!0,b("scene",m,"b4w_enable_antialiasing")),"b4w_tags"in m||(m.b4w_tags={title:"",description:""},b("scene",m,"b4w_tags")),"b4w_enable_object_selection"in m||(m.b4w_enable_object_selection="AUTO",b("scene",m,"b4w_enable_object_selection")),"b4w_enable_outlining"in m||(m.b4w_enable_outlining="AUTO",b("scene",m,"b4w_enable_outlining")),"b4w_enable_glow_materials"in m||(m.b4w_enable_glow_materials=
"AUTO",b("scene",m,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in m||(m.b4w_enable_anchors_visibility="AUTO",b("scene",m,"b4w_enable_anchors_visibility")),"b4w_outline_color"in m||(m.b4w_outline_color=[1,1,1],b("scene",m,"b4w_outline_color")),"b4w_outline_factor"in m||(m.b4w_outline_factor="b4w_glow_factor"in m?m.b4w_glow_factor:1,b("scene",m,"b4w_outline_factor")),"b4w_shadow_settings"in m||(b("scene",m,"b4w_shadow_settings"),f=n.b4w_shadow_settings,m.b4w_shadow_settings=f?f:{csm_resolution:2048,
self_shadow_polygon_offset:1,b4w_enable_csm:!1,csm_num:1,csm_first_cascade_border:10,first_cascade_blur_radius:3,csm_last_cascade_border:100,last_cascade_blur_radius:1.5,fade_last_cascade:!0,blend_between_cascades:!0}),f=m.b4w_shadow_settings,"csm_resolution"in f||(b("scene",m,"b4w_shadow_settings.csm_resolution"),f.csm_resolution=2048),"self_shadow_polygon_offset"in f||(b("scene",m,"b4w_shadow_settings.self_shadow_polygon_offset"),f.self_shadow_polygon_offset=1),"self_shadow_normal_offset"in f||
(b("scene",m,"b4w_shadow_settings.self_shadow_normal_offset"),f.self_shadow_normal_offset=.01),"b4w_enable_csm"in f||(b("scene",m,"b4w_shadow_settings.b4w_enable_csm"),f.b4w_enable_csm=!1),"csm_num"in f||(b("scene",m,"b4w_shadow_settings.csm_num"),f.csm_num=1),"csm_first_cascade_border"in f||(b("scene",m,"b4w_shadow_settings.csm_first_cascade_border"),f.csm_first_cascade_border=10),"first_cascade_blur_radius"in f||(b("scene",m,"b4w_shadow_settings.first_cascade_blur_radius"),f.first_cascade_blur_radius=
3),"csm_last_cascade_border"in f||(b("scene",m,"b4w_shadow_settings.csm_last_cascade_border"),f.csm_last_cascade_border=100),"last_cascade_blur_radius"in f||(b("scene",m,"b4w_shadow_settings.last_cascade_blur_radius"),f.last_cascade_blur_radius=1.5),"fade_last_cascade"in f||(b("scene",m,"b4w_shadow_settings.fade_last_cascade"),f.fade_last_cascade=!0),"blend_between_cascades"in f||(b("scene",m,"b4w_shadow_settings.blend_between_cascades"),f.blend_between_cascades=!0),"b4w_ssao_settings"in m||(b("scene",
m,"b4w_ssao_settings"),f=n.b4w_ssao_settings,m.b4w_ssao_settings=f?f:{dist_factor:0,samples:16,hemisphere:!1,blur_depth:!1,blur_discard_value:1}),f=m.b4w_ssao_settings,"dist_factor"in f||(b("scene",m,"b4w_ssao_settings.dist_factor"),f.dist_factor=0),"samples"in f||(b("scene",m,"b4w_ssao_settings.samples"),f.samples=16),"hemisphere"in f||(b("scene",m,"b4w_ssao_settings.hemisphere"),f.hemisphere=!1),"blur_depth"in f||(b("scene",m,"b4w_ssao_settings.blur_depth"),f.blur_depth=!1),"blur_discard_value"in
f||(b("scene",m,"b4w_ssao_settings.blur_discard_value"),f.blur_discard_value=1),"b4w_bloom_settings"in m||(b("scene",m,"b4w_bloom_settings"),f=n.b4w_bloom_settings,m.b4w_bloom_settings=f?f:{key:.2,blur:4,edge_lum:1}),"key"in m.b4w_bloom_settings||(b("scene",m,"b4w_bloom_settings.key"),m.b4w_bloom_settings.key=.2),"blur"in m.b4w_bloom_settings||(b("scene",m,"b4w_bloom_settings.blur"),m.b4w_bloom_settings.blur=4),"edge_lum"in m.b4w_bloom_settings||(b("scene",m,"b4w_bloom_settings.edge_lum"),m.b4w_bloom_settings.edge_lum=
1),"b4w_motion_blur_settings"in m||(b("scene",m,"b4w_motion_blur_settings"),f=n.b4w_motion_blur_settings,m.b4w_motion_blur_settings=f?f:{motion_blur_factor:.01,motion_blur_decay_threshold:.01}),"motion_blur_factor"in m.b4w_motion_blur_settings||(b("scene",m,"b4w_motion_blur_settings.motion_blur_factor"),m.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in m.b4w_motion_blur_settings||(b("scene",m,"b4w_motion_blur_settings.motion_blur_decay_threshold"),m.b4w_motion_blur_settings.motion_blur_decay_threshold=
.01),"b4w_color_correction_settings"in m||(b("scene",m,"b4w_color_correction_settings"),f=n.b4w_color_correction_settings,m.b4w_color_correction_settings=f?f:{brightness:0,contrast:0,exposure:1,saturation:1}),"b4w_god_rays_settings"in m||(b("scene",m,"b4w_god_rays_settings"),f=n.b4w_god_rays_settings,m.b4w_god_rays_settings=f?f:{intensity:.7,max_ray_length:1,steps_per_pass:10}),"steps_per_pass"in m.b4w_god_rays_settings||(b("scene",m,"b4w_god_rays_settings.steps_per_pass"),m.b4w_god_rays_settings.steps_per_pass=
10),"b4w_glow_settings"in m||(b("scene",m,"b4w_glow_settings"),m.b4w_glow_settings={render_glow_over_blend:!1,small_glow_mask_coeff:2,large_glow_mask_coeff:2,small_glow_mask_width:2,large_glow_mask_width:6},f=m.b4w_glow_settings,"b4w_render_glow_over_blend"in n&&(f.render_glow_over_blend=n.b4w_render_glow_over_blend),"b4w_small_glow_mask_coeff"in n&&(f.small_glow_mask_coeff=n.b4w_small_glow_mask_coeff),"b4w_large_glow_mask_coeff"in n&&(f.large_glow_mask_coeff=n.b4w_large_glow_mask_coeff),"b4w_small_glow_mask_width"in
n&&(f.small_glow_mask_width=n.b4w_small_glow_mask_width),"b4w_large_glow_mask_width"in n&&(f.large_glow_mask_width=n.b4w_large_glow_mask_width)),n=m.b4w_render_shadows,"AUTO"!=n&&"OFF"!=n&&"ON"!=n&&(m.b4w_render_shadows=n?"ON":"OFF"),n=m.b4w_render_reflections,"OFF"!=n&&"ON"!=n&&(m.b4w_render_reflections=n?"ON":"OFF"),n=m.b4w_render_refractions,"AUTO"!=n&&"OFF"!=n&&"ON"!=n&&(m.b4w_render_refractions=n?"ON":"OFF"),m.b4w_nla_script&&l("scene",m,"b4w_nla_script");m=a.meshes;for(k=0;k<m.length;k++){n=
m[k];n.b4w_bounding_box||(b("mesh",n,"b4w_bounding_box"),n.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});n.b4w_bounding_box_source||(b("mesh",n,"b4w_bounding_box_source"),n.b4w_bounding_box_source=n.b4w_bounding_box);n.uv_textures||(b("mesh",n,"uv_textures"),n.uv_textures=[]);n.b4w_bounding_sphere_center||(n.b4w_bounding_sphere_center=[0,0,0]);n.b4w_bounding_cylinder_center||(n.b4w_bounding_cylinder_center=[0,0,0]);n.b4w_bounding_ellipsoid_center||(n.b4w_bounding_ellipsoid_center=
[0,0,0]);n.b4w_bounding_ellipsoid_axes||(g=n.b4w_bounding_box,n.b4w_bounding_ellipsoid_axes=[(g.max_x-g.min_x)/2,(g.max_y-g.min_y)/2,(g.max_z-g.min_z)/2]);"b4w_shape_keys"in n||(n.b4w_shape_keys=[],b("mesh",n,"b4w_shape_keys"));for(var g=n,f=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],q=null,p=0;p<f.length;p++)g[f[p]]&&(q?(g[f[p]]=!1,e.warn('WARNING property "'+f[p]+'" of object "'+g.name+'" has been set to "false". Foreground property "'+
q+'" already exists.')):q=f[p]);for(g=0;g<n.b4w_vertex_anim.length;g++)f=n.b4w_vertex_anim[g],"allow_nla"in f||(b('mesh["b4w_vertex_anim"]',n,"allow_nla"),f.allow_nla=!0)}g=a.cameras;for(k=0;k<g.length;k++)m=g[k],m.type||(m.type="PERSP",b("camera",m,"type")),"b4w_eye_target_dist"in m&&(delete m.b4w_eye_target_dist,l("camera",m,"b4w_eye_target_dist")),"b4w_hover_zero_level"in m||(m.b4w_hover_zero_level=0,b("camera",m,"b4w_hover_zero_level")),"b4w_trans_velocity"in m||(m.b4w_trans_velocity=1,b("camera",
m,"b4w_trans_velocity")),"b4w_rot_velocity"in m||(m.b4w_rot_velocity=1,b("camera",m,"b4w_rot_velocity")),"b4w_zoom_velocity"in m||(m.b4w_zoom_velocity=.1,b("camera",m,"b4w_zoom_velocity")),"b4w_use_distance_limits"in m||(m.b4w_use_distance_limits=!1,b("camera",m,"b4w_use_distance_limits")),"b4w_distance_min"in m||(m.b4w_distance_min=1,b("camera",m,"b4w_distance_min")),"b4w_distance_max"in m||(m.b4w_distance_max=100,b("camera",m,"b4w_distance_max")),"b4w_horizontal_translation_min"in m||(m.b4w_horizontal_translation_min=
-100,b("camera",m,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in m||(m.b4w_horizontal_translation_max=100,b("camera",m,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in m||(m.b4w_vertical_translation_min=-100,b("camera",m,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in m||(m.b4w_vertical_translation_max=100,b("camera",m,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in m||(m.b4w_use_horizontal_clamping=!1,b("camera",m,"b4w_use_horizontal_clamping")),
"b4w_rotation_left_limit"in m||(m.b4w_rotation_left_limit=-Math.PI,b("camera",m,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in m||(m.b4w_rotation_right_limit=Math.PI,b("camera",m,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in m||(m.b4w_horizontal_clamping_type="LOCAL",b("camera",m,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in m||(m.b4w_use_vertical_clamping=!1,b("camera",m,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in m||(m.b4w_rotation_down_limit=
-Math.PI/2,b("camera",m,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in m||(m.b4w_rotation_up_limit=Math.PI/2,b("camera",m,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in m||(m.b4w_vertical_clamping_type="LOCAL",b("camera",m,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in m||(m.b4w_hover_angle_min=Math.PI/6,b("camera",m,"b4w_hover_angle_min")),"b4w_hover_angle_max"in m||(m.b4w_hover_angle_max=Math.PI/6,b("camera",m,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in m||
(m.b4w_enable_hover_hor_rotation=!0,b("camera",m,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in m||(m.b4w_use_panning=!0,b("camera",m,"b4w_use_panning"));g=a.lamps;for(k=0;k<g.length;k++)m=g[k],"b4w_generate_shadows"in m||(m.b4w_generate_shadows=!1,b("lamp",m,"b4w_generate_shadows")),"b4w_dynamic_intensity"in m||(m.b4w_dynamic_intensity=!1,b("lamp",m,"b4w_dynamic_intensity")),"use_diffuse"in m||(m.use_diffuse=!0,b("lamp",m,"use_diffuse")),"use_specular"in m||(m.use_specular=!0,b("lamp",m,"use_specular"));
g=a.speakers;for(k=0;k<g.length;k++)m=g[k],"b4w_behavior"in m||(m.b4w_behavior=m.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in m||(m.b4w_disable_doppler=!1),"b4w_delay"in m||(m.b4w_delay=0),"b4w_delay_random"in m||(m.b4w_delay_random=0),"b4w_volume_random"in m||(m.b4w_volume_random=0),"b4w_pitch_random"in m||(m.b4w_pitch_random=0),"b4w_fade_in"in m||(m.b4w_fade_in=0),"b4w_fade_out"in m||(m.b4w_fade_out=0),"b4w_loop"in m||(m.b4w_loop=!1),"b4w_loop_count"in m||(m.b4w_loop_count=
0),"b4w_loop_count_random"in m||(m.b4w_loop_count_random=0),"b4w_playlist_id"in m||(m.b4w_playlist_id=""),m.animation_data&&c(m.animation_data);g=a.textures;for(k=0;k<g.length;k++)m=g[k],"b4w_anisotropic_filtering"in m||(m.b4w_anisotropic_filtering="OFF",b("texture",m,"b4w_anisotropic_filtering")),"b4w_water_foam"in m||(m.b4w_water_foam=!1,b("texture",m,"b4w_water_foam")),"b4w_foam_uv_freq"in m||(m.b4w_foam_uv_freq=[1,1],b("texture",m,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in m||(m.b4w_foam_uv_magnitude=
[1,1],b("texture",m,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in m||(m.b4w_parallax_steps=5,b("material",m,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in m||(m.b4w_parallax_lod_dist=10,b("material",m,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in m||(m.b4w_shore_dist_map=!1,b("texture",m,"b4w_shore_dist_map")),"b4w_shore_boundings"in m||(m.b4w_shore_boundings=new Float32Array(4),m.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",m,"b4w_shore_boundings")),"b4w_max_shore_dist"in m||(m.b4w_max_shore_dist=
100,b("texture",m,"b4w_max_shore_dist")),"b4w_disable_compression"in m||(m.b4w_disable_compression=!1,b("texture",m,"b4w_disable_compression")),"b4w_source_type"in m||(m.b4w_source_type="",b("texture",m,"b4w_source_type")),"b4w_source_id"in m||(m.b4w_source_id="",b("texture",m,"b4w_source_id")),"b4w_source_size"in m||(m.b4w_source_size=1024,b("texture",m,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in m||(m.b4w_enable_canvas_mipmapping=!0,b("texture",m,"b4w_enable_canvas_mipmapping"));f=a.materials;
for(k=0;k<f.length;k++){q=f[k];"b4w_node_mat_type"in q&&l("material",q,"b4w_node_mat_type");"b4w_skydome"in q&&l("material",q,"b4w_skydome");"b4w_procedural_skydome"in q&&l("material",q,"b4w_procedural_skydome");q.b4w_water&&("b4w_water_shore_smoothing"in q||(q.b4w_water_shore_smoothing=!1,b("material",q,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in q||(q.b4w_water_dynamic=!1,b("material",q,"b4w_water_dynamic")),"b4w_waves_height"in q||(q.b4w_waves_height=1,b("material",q,"b4w_waves_height")),
"b4w_waves_length"in q||(q.b4w_waves_length=1,b("material",q,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in q||(q.b4w_water_dst_noise_scale0=.05,b("material",q,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in q||(q.b4w_water_dst_noise_scale1=.03,b("material",q,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in q||(q.b4w_water_dst_noise_freq0=1.3,b("material",q,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in q||(q.b4w_water_dst_noise_freq1=1,b("material",q,"b4w_water_dst_noise_freq1")),
"b4w_water_dir_min_shore_fac"in q||(q.b4w_water_dir_min_shore_fac=.4,b("material",q,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in q||(q.b4w_water_dir_freq=.5,b("material",q,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in q||(q.b4w_water_dir_noise_scale=.05,b("material",q,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in q||(q.b4w_water_dir_noise_freq=.07,b("material",q,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in q||(q.b4w_water_dir_min_noise_fac=.5,b("material",
q,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in q||(q.b4w_water_dst_min_fac=.2,b("material",q,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in q||(q.b4w_water_waves_hor_fac=5,b("material",q,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in q||(q.b4w_water_absorb_factor=6,b("material",q,"b4w_water_absorb_factor")),"b4w_water_fog_color"in q||(q.b4w_water_fog_color=new Float32Array(3),q.b4w_water_fog_color=[.5,.7,.7],b("material",q,"b4w_water_fog_color")),"b4w_foam_factor"in q||
(q.b4w_foam_factor=5,b("material",q,"b4w_foam_factor")),"b4w_generated_mesh"in q||(q.b4w_generated_mesh=!1,b("material",q,"b4w_generated_mesh")),"b4w_water_num_cascads"in q||(q.b4w_water_num_cascads=5,b("material",q,"b4w_water_num_cascads")),"b4w_water_subdivs"in q||(q.b4w_water_subdivs=64,b("material",q,"b4w_water_subdivs")),"b4w_water_detailed_dist"in q||(q.b4w_water_detailed_dist=1E3,b("material",q,"b4w_water_detailed_dist")),"b4w_water_enable_caust"in q||(q.b4w_water_enable_caust=!1,b("material",
q,"b4w_water_enable_caust")),"b4w_water_caust_scale"in q||(q.b4w_water_caust_scale=.25,b("material",q,"b4w_water_caust_scale")),"b4w_water_caust_brightness"in q||(q.b4w_water_caust_brightness=.5,b("material",q,"b4w_water_caust_brightness")));"b4w_dynamic_grass_size"in q||(q.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in q||(q.b4w_dynamic_grass_color="");"diffuse_intensity"in q||(q.diffuse_intensity=1,b("material",q,"diffuse_intensity"));"b4w_use_ghost"in q||(q.b4w_use_ghost=!1);"b4w_collision_margin"in
q||(q.b4w_collision_margin=.04,b("material",q,"b4w_collision_margin"));"b4w_collision_group"in q||(q.b4w_collision_group=128,b("material",q,"b4w_collision_group"));"b4w_collision_mask"in q||(q.b4w_collision_mask=127,b("material",q,"b4w_collision_mask"));"b4w_do_not_render"in q||(q.b4w_do_not_render=!1,b("material",q,"b4w_do_not_render"));"HALO"!=q.type||"b4w_halo_sky_stars"in q||(q.b4w_halo_sky_stars=!1,b("material",q,"b4w_halo_sky_stars"));"HALO"!=q.type||"b4w_halo_stars_blend_height"in q||(q.b4w_halo_stars_blend_height=
10,b("material",q,"b4w_halo_stars_blend_height"));"HALO"!=q.type||"b4w_halo_stars_min_height"in q||(q.b4w_halo_stars_min_height=0,b("material",q,"b4w_halo_stars_min_height"));"specular_shader"in q||(q.specular_shader="COOKTORR",b("material",q,"specular_shader"));"diffuse_shader"in q||(q.diffuse_shader="LAMBERT",b("material",q,"diffuse_shader"));"roughness"in q||(q.roughness=.5,b("material",q,"roughness"));"diffuse_fresnel"in q||(q.diffuse_fresnel=.1,b("material",q,"diffuse_fresnel"));"diffuse_fresnel_factor"in
q||(q.diffuse_fresnel_factor=.5,b("material",q,"diffuse_fresnel_factor"));"specular_slope"in q||(q.specular_slope=.2,b("material",q,"specular_slope"));"specular_toon_size"in q||(q.specular_toon_size=.5,b("material",q,"specular_toon_size"));"specular_toon_smooth"in q||(q.specular_toon_smooth=.1,b("material",q,"specular_toon_smooth"));"specular_alpha"in q||(q.specular_alpha=1,b("material",q,"specular_alpha"));"b4w_wettable"in q||(q.b4w_wettable=!1,b("material",q,"b4w_wettable"));"b4w_refractive"in q||
(q.b4w_refractive=!1,b("material",q,"b4w_refractive"));"b4w_refr_bump"in q||(q.b4w_refr_bump=0,b("material",q,"b4w_refr_bump"));"b4w_shallow_water_col"in q||(q.b4w_shallow_water_col=[0,.8,.3],b("material",q,"b4w_shallow_water_col"));"b4w_shore_water_col"in q||(q.b4w_shore_water_col=[0,.9,.2],b("material",q,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in q||(q.b4w_shallow_water_col_fac=1,b("material",q,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in q||(q.b4w_shore_water_col_fac=.5,
b("material",q,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in q||(q.b4w_water_sss_strength=5.9,b("material",q,"b4w_water_sss_strength"));"b4w_water_sss_width"in q||(q.b4w_water_sss_width=.45,b("material",q,"b4w_water_sss_width"));"b4w_render_above_all"in q||(q.b4w_render_above_all=!1,b("material",q,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in q||(q.b4w_water_norm_uv_velocity=.05,b("material",q,"b4w_water_norm_uv_velocity"));"specular_ior"in q||(q.specular_ior=1,b("material",q,"specular_ior"));
"darkness"in q||(q.darkness=0,b("material",q,"darkness"));"diffuse_toon_size"in q||(q.diffuse_toon_size=0,b("material",q,"diffuse_toon_size"));"diffuse_toon_smooth"in q||(q.diffuse_toon_smooth=0,b("material",q,"diffuse_toon_smooth"));m=q.texture_slots;for(g=0;g<m.length;g++)n=m[g],"blend_type"in n||(n.blend_type="MIX",b("texture_slot",n,"blend_type"));if(q.node_tree){m=q.node_tree.nodes;for(g=0;g<m.length;g++)d(m[g]);q.node_tree.animation_data&&c(q.node_tree.animation_data)}}n=a.node_groups;for(k=
0;k<n.length;k++)for(m=n[k].node_tree.nodes,g=0;g<m.length;g++)d(m[g]);m=a.objects;for(k=0;k<m.length;k++){n=m[k];switch(n.type){case "MESH":"b4w_dynamic_geometry"in n||(n.b4w_dynamic_geometry=!1);"b4w_reflexible"in n||(n.b4w_reflexible=!1);"b4w_reflexible_only"in n||(n.b4w_reflexible_only=!1);"b4w_reflective"in n||(n.b4w_reflective=!1);"b4w_reflection_type"in n||(n.b4w_reflection_type="PLANE",b("object",n,"b4w_reflection_type"));"b4w_wind_bending"in n||(n.b4w_wind_bending=!1,b("object",n,"b4w_wind_bending"));
"b4w_wind_bending_angle"in n||(n.b4w_wind_bending_angle=10,n.b4w_wind_bending_freq=.25,b("object",n,"wind bending params"));"b4w_detail_bending_amp"in n||(n.b4w_detail_bending_amp=.1,n.b4w_branch_bending_amp=.3,b("object",n,"detail bending params"));"b4w_detail_bending_freq"in n||(n.b4w_detail_bending_freq=1,b("object",n,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in n||(n.b4w_main_bend_stiffness_col="",b("object",n,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in n||(n.b4w_detail_bend_colors=
{leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",n,"b4w_detail_bend_colors"));"b4w_caustics"in n||(n.b4w_caustics=!1);"vertex_groups"in n&&n.vertex_groups.length&&n.data&&0==n.data.vertex_groups.length&&(n.data.vertex_groups=n.vertex_groups,delete n.vertex_groups,b("object",n,"vertex_groups"));"b4w_vertex_anim"in n&&n.b4w_vertex_anim.length&&n.data&&0==n.data.b4w_vertex_anim.length&&(n.data.b4w_vertex_anim=n.b4w_vertex_anim,delete n.b4w_vertex_anim,b("object",n,"b4w_vertex_anim"));
"b4w_do_not_render"in n||(n.b4w_do_not_render=!1);"use_ghost"in n.game||(n.game.use_ghost=!1);"use_sleep"in n.game||(n.game.use_sleep=!1);"velocity_min"in n.game||(n.game.velocity_min=0);"velocity_max"in n.game||(n.game.velocity_max=0);"collision_group"in n.game||(n.game.collision_group=1);"collision_mask"in n.game||(n.game.collision_mask=255);"b4w_vehicle_settings"in n?n.b4w_vehicle_settings&&("steering_ratio"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.steering_ratio=10),"steering_max"in n.b4w_vehicle_settings||
(n.b4w_vehicle_settings.steering_max=1),"inverse_control"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.inverse_control=!1),"force_max"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.force_max=1500),"brake_max"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.brake_max=100),"speed_ratio"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in n.b4w_vehicle_settings||
(n.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.roll_influence=
.1),"max_suspension_travel_cm"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.floating_factor=3),"floating_factor"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.water_rot_damp=.9)):(n.b4w_vehicle_settings=null,b("object",n,"b4w_vehicle_settings"));
"b4w_floating_settings"in n?n.b4w_floating_settings&&("floating_factor"in n.b4w_floating_settings||(n.b4w_floating_settings.floating_factor=3),"water_lin_damp"in n.b4w_floating_settings||(n.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in n.b4w_floating_settings||(n.b4w_floating_settings.water_rot_damp=.8)):(n.b4w_floating_settings=null,b("object",n,"b4w_floating_settings"));"b4w_character_settings"in n?n.b4w_character_settings&&("walk_speed"in n.b4w_character_settings||(n.b4w_character_settings.walk_speed=
4),"run_speed"in n.b4w_character_settings||(n.b4w_character_settings.run_speed=8),"step_height"in n.b4w_character_settings||(n.b4w_character_settings.step_height=.25),"jump_strength"in n.b4w_character_settings||(n.b4w_character_settings.jump_strength=5),"waterline"in n.b4w_character_settings||(n.b4w_character_settings.waterline=0)):(n.b4w_character_settings=null,b("object",n,"b4w_character_settings"));"b4w_selectable"in n||(n.b4w_selectable=!1,b("object",n,"b4w_selectable"));"b4w_outlining"in n||
(n.b4w_outlining=!1,b("object",n,"b4w_outlining"));"b4w_outline_on_select"in n||(n.b4w_outline_on_select=!1,b("object",n,"b4w_outline_on_select"));"b4w_billboard"in n||(n.b4w_billboard=!1,b("object",n,"b4w_billboard"));"b4w_billboard_geometry"in n||(n.b4w_billboard_geometry="SPHERICAL",b("object",n,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in n||(n.b4w_pres_glob_orientation=!1,b("object",n,"b4w_pres_glob_orientation"));"b4w_outline_settings"in n||("b4w_glow_settings"in n?n.b4w_outline_settings=
n.b4w_glow_settings:(n.b4w_outline_settings={},n.b4w_outline_settings.outline_duration=1,n.b4w_outline_settings.outline_period=1,n.b4w_outline_settings.outline_relapses=0),b("object",n,"b4w_outline_settings"));"b4w_lod_transition"in n||(n.b4w_lod_transition=.01,b("object",n,"b4w_lod_transition"));"lod_levels"in n||(n.lod_levels=[],b("object",n,"lod_levels"));"b4w_animation_mixing"in n||(n.b4w_animation_mixing=!1,b("object",n,"b4w_animation_mixing"));break;case "EMPTY":"b4w_anchor"in n||(n.b4w_anchor=
null,b("object",n,"b4w_anchor")),!n.b4w_anchor||"max_width"in n.b4w_anchor||(n.b4w_anchor.max_width=250)}"collision_margin"in n.game||(n.game.collision_margin=.04,b("object",n,"collision_margin"));"b4w_anim_behavior"in n||(n.b4w_anim_behavior=n.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",n,"b4w_anim_behavior"));if(!("rotation_quaternion"in n)){g=[0,0,0,1];h.euler_to_quat(n.rotation_euler,g);var f=g,q=g[0],p=g[1],C=g[2];f[0]=g[3];f[1]=q;f[2]=p;f[3]=C;n.rotation_quaternion=g;b("object",n,
"rotation_quaternion")}"webgl_do_not_batch"in n&&(n.b4w_do_not_batch=n.webgl_do_not_batch)&&l("object",n,"webgl_do_not_batch");"b4w_shadow_cast_only"in n||(n.b4w_shadow_cast_only=!1,b("object",n,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in n||(n.b4w_correct_bounding_offset="AUTO",b("object",n,"b4w_correct_bounding_offset"));f=n.particle_systems;for(g=0;g<f.length;g++)q=f[g],p=q.settings,"use_rotation_dupli"in p||(p.use_rotation_dupli=!1,b("object",p,"use_rotation_dupli")),"use_whole_group"in
p||(p.use_whole_group=!1,b("object",p,"use_whole_group")),q.transforms||(q.transforms=new Float32Array,b("particle_system",q,"transforms")),"b4w_billboard_align"in p||(p.b4w_billboard_align="VIEW",b("particle_settings",p,"b4w_billboard_align")),"b4w_dynamic_grass"in p||(p.b4w_dynamic_grass=!1,b("object",p,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in p||(p.b4w_dynamic_grass_scale_threshold=.01,b("object",p,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in p||(p.b4w_initial_rand_rotation=
!1,b("particle_settings",p,"b4w_initial_rand_rotation")),"b4w_rotation_type"in p||(p.b4w_rotation_type="Z",b("particle_settings",p,"b4w_rotation_type")),"b4w_rand_rotation_strength"in p||(p.b4w_rand_rotation_strength=1,b("particle_settings",p,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in p||(p.b4w_hair_billboard=!1,b("particle_settings",p,"b4w_hair_billboard")),"b4w_hair_billboard_type"in p||(p.b4w_hair_billboard_type="BASIC",b("particle_settings",p,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in
p||(p.b4w_hair_billboard_jitter_amp=0,b("particle_settings",p,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in p||(p.b4w_hair_billboard_jitter_freq=0,b("particle_settings",p,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in p||(p.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",p,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in p||(p.b4w_wind_bend_inheritance="PARENT",b("particle_settings",p,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in
p||(p.b4w_shadow_inheritance="PARENT",b("particle_settings",p,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in p||(p.b4w_reflection_inheritance="PARENT",b("particle_settings",p,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in p||(p.b4w_vcol_from_name="",b("particle_settings",p,"b4w_vcol_from_name")),"b4w_vcol_to_name"in p||(p.b4w_vcol_to_name="",b("particle_settings",p,"b4w_vcol_to_name")),"b4w_coordinate_system"in p||(p.b4w_coordinate_system="LOCAL",b("particle_settings",p,"b4w_coordinate_system")),
"b4w_allow_nla"in p||(p.b4w_allow_nla=!0,b("particle_settings",p,"b4w_allow_nla")),"b4w_enable_soft_particles"in p||(p.b4w_enable_soft_particles=!1,b("particle_settings",p,"b4w_enable_soft_particles")),"b4w_particles_softness"in p||(p.b4w_particles_softness=1,b("particle_settings",p,"b4w_particles_softness"));"constraints"in n||(n.constraints=[],b("object",n,"constraints"));f=n.modifiers;for(g=0;g<f.length;g++){a:{q=f[g];switch(q.type){case "ARRAY":if(!("fit_type"in q)){e.error("WARNING Incomplete modifier "+
String(q.type)+' for "'+n.name+'", reexport "'+a.b4w_filepath_blend+'" scene');q=!1;break a}}q=!0}q||(f.splice(g,1),g--)}"animation_data"in n||(n.animation_data={action:null,nla_tracks:[]},b("object",n,"animation_data"));n.animation_data&&("action"in n.animation_data||(n.animation_data.action=null,e.warn("no action in animation data "+n.name)),"nla_tracks"in n.animation_data||(n.animation_data.nla_tracks=[],e.warn("no NLA in animation data "+n.name)),c(n.animation_data));"b4w_collision_id"in n||(n.b4w_collision_id=
"",b("material",n,"b4w_collision_id"));g=n.scale;0==g[0]&&0==g[1]&&0==g[2]?g=!0:(f=Math.abs((g[1]-g[2])/g[1]),g=.005>Math.abs((g[0]-g[1])/g[0])&&.005>f);g||e.warn("non-uniform scale for object "+n.name);if(0>n.scale[0]||0>n.scale[1]||0>n.scale[2])e.warn("negative scale for object "+n.name+", using positive scale instead"),n.scale[0]=Math.abs(n.scale[0]),n.scale[1]=Math.abs(n.scale[1]),n.scale[2]=Math.abs(n.scale[2])}for(var z in F)k=F[z],g=z.match(/.*?(?=>>|$)/i)[0],e.warn('Property "'+String(g)+
'" is '+k.Et+' for "'+k.type+'". To fix this, reexport '+a.b4w_filepath_blend)};a.Fx=function(a,b){"num_channels"in a||(a.num_channels=1,e.warn('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport scene'))};a.$w=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var d=b[c].type;if("ARRAY"==d||"CURVE"==d){b=!0;break a}}b=!1}if(!b)return null;b=f(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var e=a[c];switch(e.type){case "ARRAY":for(var d=
b,l=e,q=0,r=0,H=0,z=new Float32Array(16),e=[],G=1;G<l.count;G++){l.use_constant_offset&&(q+=l.constant_offset_displace[0],r+=l.constant_offset_displace[1],H+=l.constant_offset_displace[2]);if(l.use_relative_offset)var F=d.b4w_bounding_box,q=q+(F.max_x-F.min_x)*l.relative_offset_displace[0],r=r+(F.max_y-F.min_y)*l.relative_offset_displace[1],H=H+(F.max_z-F.min_z)*l.relative_offset_displace[2];h.yD(q,r,H,z);for(var M=F=f(d),I=z,L=0;L<M.submeshes.length;L++){var v=M.submeshes[L];h.Cf(v.position,I,v.position,
0);h.zE(v.normal,I,v.normal);h.vD(v.tangent,I,v.tangent)}e.push(F)}for(G=0;G<e.length;G++)for(l=d,q=e[G],r=0;r<l.submeshes.length;r++){H=l.submeshes[r];z=q.submeshes[r];F=H.base_length;M=H.indices.length;H.base_length+=z.base_length;for(var N in H)if("base_length"!=N)if("indices"==N)for(H[N]=h.CD(H[N],z[N]),I=M;I<H.indices.length;I++)H.indices[I]+=F;else"vertex_colors"!=N&&(H[N]=h.oz(H[N],z[N]))}break;case "CURVE":for(var d=b,G=k.zy(e.object),l=new Float32Array(16),r=G.rf?4:3,q=new Float32Array(r),
r=new Float32Array(r),H=new Float32Array(3),z=new Float32Array(4),F=new Float32Array(4),M=new Float32Array(3),I=new Float32Array(3),L=new Float32Array(3),v=new Float32Array(4),T=new Float32Array(4),U=0;U<d.submeshes.length;U++){var ga=d.submeshes[U],S=ga.position,Y=ga.normal,ga=ga.tangent,ca;a:switch(ca=e.deform_axis,ca){case "POS_X":case "NEG_X":ca=0;break a;case "POS_Y":case "NEG_Y":ca=1;break a;case "POS_Z":case "NEG_Z":ca=2;break a;default:throw"Wrong deform axis value "+ca;}M[0]=0;M[1]=0;M[2]=
0;M[ca]=1;for(var R=k.hD(G),V=0;V<S.length/3;V++){L[0]=S[3*V];L[1]=S[3*V+1];L[2]=S[3*V+2];var pa=L[ca],ha=k.gD(G,pa);k.iD(G,ha,q);H[0]=q[0];H[1]=q[1];H[2]=q[2];k.fD(G,ha,r);I[0]=r[0];I[1]=0;I[2]=r[2];n.normalize(I,I);g.rotationTo(M,I,z);0>pa?(q[0]=I[0],q[1]=I[1],q[2]=I[2],n.scale(q,pa,q),n.add(H,q,H)):pa>R&&(q[0]=I[0],q[1]=I[1],q[2]=I[2],n.scale(q,pa-R,q),n.add(H,q,H));p.fromRotationTranslation(z,H,l);G.rf&&(g.setAxisAngle(M,q[3],F),n.transformQuat(L,F,L));L[ca]=0;n.transformMat4(L,l,L);S[3*V]=L[0];
S[3*V+1]=L[1];S[3*V+2]=L[2];Y.length&&(v[0]=Y[3*V],v[1]=Y[3*V+1],v[2]=Y[3*V+2],v[3]=0,C.transformMat4(v,l,v),Y[3*V]=v[0],Y[3*V+1]=v[1],Y[3*V+2]=v[2]);ga.length&&(T[0]=ga[3*V],T[1]=ga[3*V+1],T[2]=ga[3*V+2],T[3]=0,C.transformMat4(T,l,T),ga[3*V]=T[0],ga[3*V+1]=T[1],ga[3*V+2]=T[2])}}}m.$B(b)}return b};a.EF=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,
fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,
b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.hx=function(a,b){for(var c=b.b4w_logic_nodes,d=0;d<c.length;d++)for(var e=c[d],f=0;f<
e.length;f++){var g=e[f];switch(g.type){case "SELECT":case "SELECT_PLAY":for(var h=0;h<a.length;h++){var l=a[h];l.name==g.object&&(l.b4w_selectable=!0)}break;case "SHOW":case "HIDE":for(h=0;h<a.length;h++)l=a[h],l.name==g.object&&(l.b4w_do_not_batch=!0)}}}};b4w.module.__scenegraph=function(a,r){function d(a){a=da.ig(a);a.ye=null;a.ob=null;a.cd=null;return a}function c(a,c){var d=[];x.ce(a,function(b,c,e){-1<d.indexOf(e)?x.iC(a,b,c,e,l(e)):d.push(e)});x.V(a,function(b,e){for(var f=0;f<e.ra.length;f++){var g=e.ra[f];c||"MAIN_PLANE_REFLECT"!=e.type&&"MAIN_CUBE_REFLECT"!=e.type&&"MAIN_XRAY"!=e.type||(g.gh=!0);-1<d.indexOf(g)?e.ra[f]=l(g):d.push(g)}"ANTIALIASING"==e.type&&x.Re(a,b,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.ra.length;c++){var d=
b.ra[c];d.fa=X.t;d.ea=X.t}});c||x.Re(a,b,function(a,b,c){"DEPTH"==c.W&&(c.gh=!0)})});x.V(a,function(c){var d={};b(a,c,d);for(var e in d){c=d[e];for(var f=c[0],g=0;g<c.length;g++)if(c[g].fa==X.t){f=c[g];break}for(var x=c[0],g=0;g<c.length;g++)if(c[g].ea==X.t){x=c[g];break}for(var h=c[0],g=0;g<c.length;g++)if(!c[g].gh){h=c[g];break}for(g=0;g<c.length;g++)c[g].fa=f.fa,c[g].ea=x.ea,c[g].gh=h.gh}})}function b(a,c,d){x.Re(a,c,function(c,e,f){f.Za&&f.W==f.xa&&(d[f.W]=d[f.W]||[],-1==d[f.W].indexOf(f)&&d[f.W].push(f),
b(a,c,d))});x.Nf(a,c,function(a,b,c){c.Za&&(d[c.W]=d[c.W]||[],-1==d[c.W].indexOf(c)&&d[c.W].push(c))});c=x.Oa(a,c);if("MOTION_BLUR"==c.type)for(var e=0;e<c.ra.length;e++){var f=c.ra[e];d[f.W].push(f)}}function l(a){if(a.Aa)throw"Failed to clone slink with attached texture";return Cb.fg(a)}function f(a){var b=x.yp(a),c=[];x.V(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":var f=[];break;default:f=c}for(var h=0;h<d.ra.length;h++){var l=
d.ra[h],m=g(f,l,k(l));l.Aa=m;d.ae[h]=m}for(h=0;h<d.ae.length;h++)m=d.ae[h],e(f,m);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":f=[]}x.Nf(b,a,function(c,d,e){if(!e.Aa){if((c=p(b,a,e.W))&&e.Za&&!e.Aa){d=f;for(var x=c,h=0;h<d.length;h++){var l=d[h];l.up===x&&l.Uj++}}else c=g(f,e,k(e));e.Aa=c}});x.Re(b,a,function(a,b,c){e(f,c.Aa)});x.Nf(b,a,function(a,b,c){c.Aa&&"NONE"==c.xa&&e(f,c.Aa)})})}function m(a){n(a,function(b,c,d){b.Ci&&(ba(a,
d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||ba(a,d,"ANTIALIASING")||"ANCHOR_VISIBILITY"==d.type)&&(b.Jf*=wa.render_resolution_factor)})}function k(a){a=Cb.fg(a);delete a.xa;delete a.Za;delete a.Aa;return JSON.stringify(a)}function p(a,b,c){var d=null;x.Re(a,b,function(a,b,e){if(e.Za&&e.W==e.xa&&e.W==c&&e.Aa)return d=e.Aa,!0});x.Nf(a,b,function(a,b,e){if(e.Za&&e.W==c&&e.Aa)return d=e.Aa,!0});return d}function e(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.up===b&&d.Uj&&
d.Uj--}}function g(a,b,c){for(var d=null,e=0;e<a.length;e++){var f=a[e];if(f.id==c&&0===f.Uj){d=f;break}}if(d&&!wa.kB)return d.Uj++,d.up;b=h(b);a.push({id:c,Uj:1,up:b});return b}function h(a){var b=a.Jf*a.size;switch(a.W){case "COLOR":var c=X.Xk("COLOR",X.ph);X.resize(c,b,b);X.Xj(c,a.fa,a.ea);return c;case "DEPTH":return a.gh?(c=X.Xk("DEPTH_RBUF",X.oh),X.resize(c,b,b)):(c=X.Xk("DEPTH_TEX",X.Li),X.resize(c,b,b),X.Xj(c,a.fa,a.ea)),c;case "CUBEMAP":return c=X.hy(b);case "SCREEN":return null;default:throw"Wrong slink param: "+
a.W;}}function n(a,b){var c=!1;x.ce(a,function(d,e,f){if(f&&(d=x.Oa(a,d),e=x.Oa(a,e),b(f,!1,d,e)))return c=!0});c||x.V(a,function(a,c){for(var d=0;d<c.ra.length;d++)if(b(c.ra[d],!0,c,null))return!0})}function C(a){x.V(a,function(b,c){if("SINK"!=c.type){var d=c.j;x.Nf(a,b,function(a,b,c){c.Za&&c.Aa&&(Z.dm(d,c.W,c.Aa),c.W==c.xa&&b.j&&Z.dm(b.j,c.W,c.Aa))});for(var e=0;e<c.ra.length;e++){var f=c.ra[e];f.Za&&f.W==f.xa&&Z.dm(d,f.W,c.ae[e])}!d.ob&&!d.cd||d.ye||(d.ye=ra.hC(d.ob,d.cd))}})}function G(a){var b=
null,c=0;x.V(a,function(a,d){if(d.type==Gb.tD){if(c==Gb.sD)return b=d,!0;c++}});return b}function F(a,b){var c=x.Pg(a,b),d=y("NONE"),e=x.u(a,d),f=x.as(a)[0];x.ce(a,function(b,c){c==f&&x.aC(a,b,f,b,e)});x.ce(a,function(e,f,g){if(e==c)return x.n(a,b,d,B(Gb.VC,"u_color",g.size,g.Jf,g.Ci)),!0});x.Rb(a,e,f,B("SCREEN","NONE",.5,.5,!0))}function E(a,b){var c=u("SHADOW_CAST");c.ln=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.Cg){case "SPOT":case "POINT":c.j=Z.tb(Z.Pb);Z.em(c.j,180*
b.Ne/Math.PI,.1,2*b.distance);break;default:c.j=Z.tb(Z.Yf)}return c}function u(a){a={type:a,Ra:"",Fa:!1,jt:!1,Jm:!1,El:!1,ej:0,time:0,j:null,dj:null,nn:[],o:[],ra:[],ae:[],Se:new Float32Array(3),av:new Float32Array(3),mc:new Float32Array(3),ac:new Float32Array(4),il:new Float32Array(4),Dc:new Float32Array(16),Zt:0,jf:0,wf:0,Fg:null,sf:null,Eg:null,Gg:null,pf:new Float32Array(3),Xf:new Float32Array(3),$t:new Float32Array(4),qu:new Float32Array([0,0,0]),op:new Float32Array(3),ru:new Float32Array(4),
Yt:new Float32Array(3),Lj:0,wn:0,Cj:!1,zf:new Float32Array(3),Tf:0,nb:null,qm:!1,Gf:new Float32Array(2),Hf:new Float32Array(2),ki:0,Vh:0,Zm:0,Fd:null,Vf:0,nh:0,Uf:0,oe:!1,Kq:0,Lq:new Float32Array(2),Jq:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,li:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,
qi:0,pi:0,oi:0,iu:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,Uh:0,Yl:0,ui:0,ln:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,Lu:null,yq:null,Ug:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,Rm:0,Cn:0,mb_decay_threshold:0,mb_factor:0,Ss:0,Ul:"",KA:new Float32Array(2),small_glow_mask_width:0,large_glow_mask_width:0,small_glow_mask_coeff:0,large_glow_mask_coeff:0,vp:new Float32Array(2),Sa:new Float32Array(2),bb:!0,enqueue:!0,ka:!0,ta:!0,
Kb:!0,va:!0,Qe:1};a.Sa[0]=1;a.Sa[1]=1;return a}function B(a,b,c,d,e){return{W:a,xa:b,size:c,Jf:d,Ci:e,Za:!0,Aa:null,gh:!1,fa:X.yc,ea:X.yc}}function A(a,b){for(var c=0,d=va(a,b),e=0;e<d.length;e++){var f=d[e];"SHADOW_CAST"==f.type&&(f=f.j,b.FB=f.cb/(f.cb-f.fb),b.Lu=f.ya,b.yq=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.Ug=b.Ug||[],b.Ug[c]=f.za,c++)}}function t(){var a=u("GRASS_MAP");a.j=Z.tb(Z.We);return a}function y(a){var b=u("POSTPROCESSING");b.ka=!1;b.ta=!1;b.Kb=!1;b.j=Z.tb(Z.Ab);
b.Ul=a;switch(a){case "NONE":b.Sa[0]=1;b.Sa[1]=1;break;case "GRAYSCALE":b.Sa[0]=1;b.Sa[1]=1;break;case "X_BLUR":b.Sa[0]=1;b.Sa[1]=0;break;case "Y_BLUR":b.Sa[0]=0;b.Sa[1]=1;break;case "X_GLOW_BLUR":b.Sa[0]=1;b.Sa[1]=0;break;case "Y_GLOW_BLUR":b.Sa[0]=0;b.Sa[1]=1;break;case "X_EXTEND":b.Sa[0]=1;b.Sa[1]=0;break;case "Y_EXTEND":b.Sa[0]=0;b.Sa[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}return b}function q(a){var b=u("BLOOM_BLUR");b.ka=!1;b.ta=!1;b.Kb=!1;b.j=Z.tb(Z.Ab);b.Ul=a;switch(a){case "X_BLUR":b.Sa[0]=
1;b.Sa[1]=0;break;case "Y_BLUR":b.Sa[0]=0;b.Sa[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}return b}function w(a,b){var c=u("GLOW_COMBINE");c.ka=!1;c.ta=!1;c.Kb=!1;c.small_glow_mask_coeff=b.of.small_glow_mask_coeff;c.large_glow_mask_coeff=b.of.large_glow_mask_coeff;c.small_glow_mask_width=b.of.small_glow_mask_width;c.large_glow_mask_width=b.of.large_glow_mask_width;c.j=a;return c}function H(a,b,c,d,e,f,g,x,h){var l=u("MAIN_"+a);if("OPAQUE"===a)l.ka=!0,l.ta=c,l.Fa=!1;
else if("BLEND"===a)l.ka=!1,l.ta=!1,l.Fa=!0;else if("XRAY"===a)l.ka=!1,l.ta=!0,l.Fa=!0;else if("PLANE_REFLECT"===a||"CUBE_REFLECT"===a)l.ka=!0,l.ta=!0,l.Fa=!1;else if("GLOW"===a)l.ka=!0,l.ta=!1,l.Fa=!1;else throw"wrong main subscene type";l.Fa&&x&&(l.self_shadow_normal_offset=x.self_shadow_normal_offset);l.j=b;if(a=g.dp)l.$t.set([a.qx,a.uA,a.JE,a.IE]),l.Yt.set(a.color),l.Zt=a.Ga;l.pf.set(g.pf);l.Xf.set(g.Xf);l.jf=g.jf;l.ac=f.ac;l.il=f.il;d&&(l.nb=d,d.ac&&(l.Fd=new Float32Array(d.ac)),l.Vf=d.waves_height,
l.nh=d.waves_length,l.Uf=d.Uf,d.oe&&h&&(l.oe=!0,l.Kq=d.Cx,l.Lq.set(d.Dx),l.Jq=d.Bx),d.gm&&(l.qm=!0,f=d.TC,l.Gf[0]=(f[0]+f[1])/2,l.Gf[1]=(f[2]+f[3])/2,l.Hf[0]=f[0]-f[1],l.Hf[1]=f[2]-f[3],l.ki=d.ki,l.Vh=d.Vh));l.wf=e;l.Fg=new Float32Array(3*e);l.sf=new Float32Array(3*e);l.Eg=new Float32Array(3*e);l.Gg=new Float32Array(0==e%2?2*e:2*e+2);return l}function z(a,b){var c=u("COLOR_PICKING");b&&(c.type+="_XRAY",c.ka=!1,c.ta=!0);c.enqueue=!1;c.j=a;return c}function Q(a){var b=u("WIREFRAME");b.bb=!1;b.ka=!1;
b.ta=!1;b.j=a;return b}function P(a){var b=u("ANCHOR_VISIBILITY");b.ka=!0;b.ta=!1;b.j=a;return b}function M(a){var b=u("DEPTH");b.j=a;return b}function I(a,b,c){var d=u("SSAO");d.ka=!1;d.ta=!1;d.Kb=!1;d.j=a;d.ac=b.ac;d.Fd=new Float32Array(b.ac);d.qi=c.radius_increase;d.ssao_hemisphere=c.tA;d.pi=c.influence;d.oi=c.dist_factor;d.iu=c.rC;return d}function L(a,b){var c=u("SSAO_BLUR");c.ka=!1;c.ta=!1;c.Kb=!1;c.j=a;c.ssao_blur_depth=b.tx;c.ssao_blur_discard_value=b.Cq;return c}function v(){var a=u("ANTIALIASING");
a.ka=!1;a.ta=!1;a.Kb=!1;a.Qe=1/wa.render_resolution_factor;a.j=Z.tb(Z.Ab);return a}function N(a){var b=u(a);b.ka="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.ta=!1;b.Kb=!1;b.Qe=1/wa.render_resolution_factor;b.j=Z.tb(Z.Ab);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.LA=new Float32Array(4));return b}function T(a,b,c,d){var e=u("COMPOSITING");e.ka=!1;e.ta=!1;e.Kb=!1;e.j=Z.tb(Z.Ab);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function U(a,b){var c=u("MOTION_BLUR");
c.ka=!1;c.ta=!1;c.Kb=!1;c.j=Z.tb(Z.Ab);c.Jm=!0;c.mb_decay_threshold=a;c.mb_factor=b;return c}function ga(a){var b=u("DOF");b.ka=!1;b.ta=!1;b.Kb=!1;b.j=a;b.Qe=b.j.dof_power;return b}function S(a){var b=u("OUTLINE_MASK");b.Kb=!1;b.j=a;return b}function Y(a){var b=u("OUTLINE");b.zf.set(a.zf);b.Lj=a.Lj;b.Cn=5;b.Rm=3;b.Kb=!1;b.j=Z.tb(Z.Ab);return b}function ca(){var a=u("REFRACT");a.ka=!1;a.ta=!1;a.Kb=!1;a.j=Z.tb(Z.Ab);return a}function R(a,b,c,d,e,f,g){var x=u("GOD_RAYS");x.ka=!1;x.ta=!1;x.Kb=!1;x.pf=
new Float32Array([1,1,1]);x.Xf=new Float32Array([1,1,1]);x.jf=1;x.jt=d;x.Tf=b;x.Yl=e;x.Uh=c;x.ui=g;x.j=a;x.wf=f;x.Fg=new Float32Array(3*f);x.sf=new Float32Array(3*f);x.Eg=new Float32Array(3*f);x.Gg=new Float32Array(0==f%2?2*f:2*f+2);return x}function V(a,b){var c=u("GOD_RAYS_COMBINE");c.ka=!1;c.ta=!1;c.Kb=!1;c.j=Z.tb(Z.Ab);c.god_rays_intensity=a;c.wf=b;c.Fg=new Float32Array(3*b);c.sf=new Float32Array(3*b);c.Eg=new Float32Array(3*b);c.Gg=new Float32Array(0==b%2?2*b:2*b+2);return c}function pa(a,b){var c=
u("SKY");c.enqueue=!1;c.ka=!1;c.ta=!1;c.Kb=!1;var d=Z.tb(Z.Ab);d.width=ja.Yk;d.height=ja.Yk;c.j=d;c.dj=Cb.zz();c.wf=a;c.Fg=new Float32Array(3*a);c.sf=new Float32Array(3*a);c.Eg=new Float32Array(3*a);c.Gg=new Float32Array(0==a%2?2*a:2*a+2);c.pf=new Float32Array([1,1,1]);c.Xf=new Float32Array([1,1,1]);c.jf=1;c.li.set(b.li);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;
c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function ha(){var a=u("COPY");a.ka=!1;a.ta=!1;a.j=Z.tb(Z.Ab);return a}function qa(){var a=u("ANAGLYPH");a.ka=!1;a.ta=!1;a.j=Z.tb(Z.Ab);return a}function ma(){var a=u("LUMINANCE");a.ka=!1;a.ta=!1;a.j=Z.tb(Z.Ab);
return a}function aa(){var a=u("AVERAGE_LUMINANCE");a.ka=!1;a.ta=!1;a.j=Z.tb(Z.Ab);return a}function fa(a,b,c,d){var e=u("LUMINANCE_TRUNCED");e.ka=!1;e.ta=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.j=d;e.wf=c;e.Fg=new Float32Array(3*c);e.sf=new Float32Array(3*c);e.Eg=new Float32Array(3*c);e.Gg=new Float32Array(0==c%2?2*c:2*c+2);return e}function D(a){var b=u("BLOOM");b.ka=!1;b.ta=!1;b.j=Z.tb(Z.Ab);b.bloom_blur=a;return b}function O(){var a=u("SINK");a.enqueue=!1;return a}function ba(a,b,c){if(b.type===
c)return!0;b=na(a,b);for(var d=0;d<b.length;d++)if(ba(a,b[d],c))return!0;return!1}function J(a,b,c){if(b.type===c)return!0;b=va(a,b);for(var d=0;d<b.length;d++)if(J(a,b[d],c))return!0;return!1}function va(a,b){var c=x.Pg(a,b);if(c==x.Yp)throw"Subscene not in graph";for(var d=[],e=x.ao(a,c),f=0;f<e;f++){var g=x.yj(a,c,f);g!=c&&d.push(x.Oa(a,g))}return d}function na(a,b){var c=x.Pg(a,b);if(c==x.Yp)throw"Subscene not in graph";for(var d=[],e=x.yf(a,c),f=0;f<e;f++){var g=x.mf(a,c,f);g!=c&&d.push(x.Oa(a,
g))}return d}function ia(a){var b=[],c=[];n(a,function(a){a.Aa&&-1==b.indexOf(a.Aa)&&(b.push(a.Aa),c.push(a.Aa,b.length-1))});return c}function ea(a,b){var c;c=""+(a.W+"\\n");c+="NONE"!=a.xa?a.xa+"\\n":"";c+="(";if(a.Ci){var d=a.Jf;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.W){c+=" ";if(a.gh)c+="RR";else{var d=a.fa,e=a.ea,f="";d==X.t?f+="L":d==X.yc&&(f+="N");e==X.t?f+="L":e==X.yc&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.Aa&&(c+=" "+
b[d+1])}return c+")\\n"}var Z=r("__camera"),la=r("__config"),K=r("__debug"),x=r("__graph"),da=r("__obj_util"),ra=r("__renderer"),X=r("__textures"),Cb=r("__util"),Gb=la.sn,wa=la.q,ja=la.gi;a.Qx=function(a){switch(a.xa){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "NONE":return!1;default:return!0}};a.BD=n;a.ty=function(a,b,e){function g(c,e){var f=d(ua[e]);b.L.push(f);f=H(c,f,!1,sb,ea,Sb,Hb,jb,a.eh);k.push(f);x.u(h,f);x.n(h,l[e],f,p[e]);"XRAY"==c?f.ra.push(B("DEPTH",
"DEPTH",1,1,!0)):x.n(h,l[e],f,da[e]);Qa&&(x.n(h,Qa,f,Ib),x.n(h,Qa,f,vb));if(fb){for(var m=0;m<la.length;m++)x.n(h,la[m],f,va[m]);if(Ic.sc&&ac||Qb||Nc){var m=kb[e],K=d(m.j);b.L.push(K);var n=u("DEPTH_PACK");n.ka=!1;n.ta=!1;n.j=K;x.u(h,n);var K=B("DEPTH","u_depth",1,1,!0),q=B("COLOR","u_scene_depth",1,1,!0);q.fa=X.yc;q.ea=X.yc;x.n(h,m,n,K);x.n(h,n,f,q)}}if(ra.length)for(n=ra.length/ua.length,m=0;m<n;m++)K=n*e+m,x.n(h,ra[K],f,r[K]);if(na.length)for(m=0;m<na.length;m++)x.n(h,na[m],f,ia[m]);ba.length&&
x.n(h,ba[e],f,J[e]);return f}var h=x.create(),l=[],k=[],n=[],p=[],da=[],ra=[],r=[],ba=[],J=[],la=[],va=[],na=[],ia=[],ea=a.OA,sb=a.nb,Qb=a.shore_smoothing,Nc=a.WC,Jc=a.Oe,Rc=a.Kh,Ic=a.rB,Jb=a.di,nb=a.sx,Ra=a.Og,bc=a.wh,Kc=a.antialiasing,Hb=a.Sp,Sb=a.$u,jb=a.Yb,Rb=a.uB,cb=a.Ex,Ka=a.nA,Ta=a.EB,Kb=a.Ah,fb=a.Ty,ac=a.sc,Ea=Boolean(e.length),ua=[];if(a.anaglyph_use&&!Ea){var Cc=b.L[0],wb=d(Cc);Z.Os(Cc,Z.Bb);Z.Os(wb,Z.Gb);ua.push(Cc,wb);b.L.push(wb)}else{var ya=b.L[0];ua.push(ya)}if(jb){Z.Cp(ua[0],jb);for(var Ua=
jb.csm_num,W=0;W<Ua;W++){var Ia=E(W,jb);x.u(h,Ia);la.push(Ia);var Ba=jb.csm_resolution,ya=Ia.j;ya.width=Ba;ya.height=Ba;Ia.ka=!1;va.push(B("DEPTH","u_shadow_map"+W,Ba,1,!1));(K.Oq()||wa.Dr)&&Ia.ra.push(B("COLOR","COLOR",Ba,1,!1))}}if(Jb&&Jb.bt&&!Ea)for(W=0;W<Jb.bt;W++){ya=Z.tb(Z.Pb);ya.width=a.kg;ya.height=a.kg;Z.em(ya,90,.1,100);Z.Ef(ya,ya.Ca);var Ca=H("CUBE_REFLECT",ya,!1,sb,ea,Sb,Hb,null,a.eh);Ca.dj=Cb.Dz();for(var Aa=0;6>Aa;Aa++)Ca.nn.push(Z.ky());x.u(h,Ca);var Na=B("CUBEMAP","u_cube_reflection",
a.kg,1,!1);Na.fa=X.t;Na.ea=X.t;var cc=B("DEPTH","DEPTH",a.kg,1,!1);ia.push(Na);Ca.ra.push(cc);na.push(Ca);Jb.ef.push(Ca)}if(Jb&&0<Jb.At.length&&!Ea)for(W=0;W<ua.length;W++)for(Aa=0;Aa<Jb.At.length;Aa++)ya=d(ua[W]),ya.fc=new Float32Array(4),b.L.push(ya),Ca=H("PLANE_REFLECT",ya,!1,sb,ea,Sb,Hb,null,a.eh),x.u(h,Ca),Na=B("COLOR","u_plane_reflection",1,a.Rj,!0),Na.fa=X.t,Na.ea=X.t,cc=B("DEPTH","DEPTH",1,a.Rj,!0),r.push(Na),Ca.ra.push(cc),ra.push(Ca),Jb.Bf.push(Ca);l=[];k=[];if(a.Db){var Qa=t();x.u(h,Qa);
Ba=ja.ll;Qa.j.width=Ba;Qa.j.height=Ba;var Ib=B("DEPTH","u_grass_map_depth",Ba,1,!1);Ib.fa=X.t;Ib.ea=X.t;var vb=B("COLOR","u_grass_map_color",Ba,1,!1);vb.fa=X.t;vb.ea=X.t}else vb=Ib=Qa=null;for(var lb=[],pc=[],kb=[],dc=[],W=0;W<ua.length;W++){var ya=ua[W],db={};da.push(B("DEPTH","DEPTH",1,1,!0));if(fb){var xc=d(ya);b.L.push(xc);db=M(xc);kb.push(db);x.u(h,db);if(jb){db.self_shadow_normal_offset=jb.self_shadow_normal_offset;for(Aa=0;Aa<la.length;Aa++)Ia=la[Aa],x.n(h,Ia,db,va[Aa]);var ob=B("COLOR","u_color",
1,1,!0),xb=B("DEPTH","u_depth",1,1,!0);if(Jc){var La=d(ya);b.L.push(La);var Wa=a.kD,Za=I(La,Sb,Wa);x.u(h,Za);var Tb=B("COLOR","u_ssao_mask",1,1,!0);x.n(h,db,Za,ob);x.n(h,db,Za,xb);var ec=d(ya);b.L.push(ec);var Xa=L(ec,Wa);x.u(h,Xa);var Dc=B("COLOR","u_shadow_mask",1,1,!0);x.n(h,Za,Xa,Tb);x.n(h,db,Xa,xb)}}else K.Oq()&&db.ra.push(B("COLOR","COLOR",1,1,!0));Qa&&(x.n(h,Qa,db,Ib),x.n(h,Qa,db,vb))}Ca=H("OPAQUE",ya,!fb,sb,ea,Sb,Hb,null,a.eh);x.u(h,Ca);k.push(Ca);pc.push(Ca);fb&&(x.n(h,db,Ca,da[W]),Tb?x.n(h,
Xa,Ca,Dc):jb&&x.n(h,db,Ca,B("COLOR","u_shadow_mask",1,1,!0)));var yc=B("COLOR","u_color",1,1,!0);p.push(B("COLOR","COLOR",1,1,!0));Qa&&(x.n(h,Qa,Ca,Ib),x.n(h,Qa,Ca,vb));if(ra.length)for(var yb=ra.length/ua.length,Aa=0;Aa<yb;Aa++){var qc=yb*W+Aa;x.n(h,ra[qc],Ca,r[qc])}if(na.length)for(Aa=0;Aa<na.length;Aa++)x.n(h,na[Aa],Ca,ia[Aa])}l=k;k=[];if(!Ea&&a.Xx){ya=d(l[0].j);b.L.push(ya);var Db=z(ya,!1);x.u(h,Db);if(a.Ue){ya=d(l[0].j);b.L.push(ya);var pb=z(ya,!0);x.u(h,pb);x.n(h,Db,pb,B("COLOR","COLOR",1,1,
!0));x.n(h,Db,pb,B("DEPTH","DEPTH",1,1,!0))}}else Db=null;if(Ic.sc&&!Ea)for(W=0;W<ua.length;W++){var qb=ca();x.u(h,qb);x.n(h,l[W],qb,yc);ba.push(qb);J.push(B("COLOR","u_refractmap",1,1,!0))}if(a.Sn){for(W=0;W<ua.length;W++)Ca=g("BLEND",W),lb.push(Ca);l=k;k=[]}if(a.nf){for(W=0;W<ua.length;W++){var Da=d(ua[W]);b.L.push(Da);var Fa=H("GLOW",Da,!1,sb,ea,Sb,Hb);x.u(h,Fa);x.n(h,pc[W],Fa,da[W]);var sa=y("X_GLOW_BLUR");sa.Ra="GLOW_MASK_SMALL";sa.Qe=a.of.small_glow_mask_width;var $a=B("COLOR","u_color",1,1,
!0);$a.fa=X.t;$a.ea=X.t;x.u(h,sa);x.n(h,Fa,sa,$a);var Ga=y("Y_GLOW_BLUR");Ga.Ra="GLOW_MASK_SMALL";Ga.Qe=a.of.small_glow_mask_width;var tb=B("COLOR","u_color",1,.5,!0);tb.fa=X.t;tb.ea=X.t;x.u(h,Ga);x.n(h,sa,Ga,tb);var Oa=y("X_GLOW_BLUR");Oa.Ra="GLOW_MASK_LARGE";Oa.Qe=a.of.large_glow_mask_width;var zb=B("COLOR","u_color",1,.5,!0);zb.fa=X.t;zb.ea=X.t;x.u(h,Oa);x.n(h,Ga,Oa,zb);var ab=y("Y_GLOW_BLUR");ab.Ra="GLOW_MASK_LARGE";ab.Qe=a.of.large_glow_mask_width;var lc=B("COLOR","u_color",1,.25,!0);lc.fa=X.t;
lc.ea=X.t;x.u(h,ab);x.n(h,Oa,ab,lc);var Ub=d(ua[W]);b.L.push(Ub);var Va=w(Ub,a);x.u(h,Va);a.Sn?x.n(h,lb[W],Va,B("COLOR","u_src_color",1,1,!0)):x.n(h,pc[W],Va,B("COLOR","u_src_color",1,1,!0));var mc=B("COLOR","u_glow_mask_small",1,.5,!0);mc.fa=X.t;mc.ea=X.t;x.n(h,Ga,Va,mc);var rc=B("COLOR","u_glow_mask_large",1,.25,!0);rc.fa=X.t;rc.ea=X.t;x.n(h,ab,Va,rc);n.push(Va)}l=n;k=[]}if(!a.Sn){for(W=0;W<ua.length;W++)Ca=g("BLEND",W),lb.push(Ca);l=k;k=[]}if(a.Ue){for(W=0;W<ua.length;W++){var fc=g("XRAY",W);dc.push(fc)}l=
k;k=[]}if(wa.wireframe_debug){for(W=0;W<ua.length;W++){ya=d(ua[W]);b.L.push(ya);var Eb=Q(ya);k.push(Eb);x.u(h,Eb);x.n(h,l[W],Eb,p[W]);x.n(h,l[W],Eb,da[W]);Qa&&(x.n(h,Qa,Eb,Ib),x.n(h,Qa,Eb,vb))}l=k;k=[]}if(!Ea&&a.Fw){ya=d(ua[0]);b.L.push(ya);var hb=P(ya);x.u(h,hb);x.n(h,l[0],hb,da[0])}if(Rc&&fb&&!Ea){for(W=0;W<ua.length;W++){var bb=Ka.Uh,Ha=Ka.fo,Fb=Ka.ui,Ma=l[W],Vb=sb?1:0,ub=B("DEPTH","u_input",1,1,!0);ub.fa=X.t;ub.ea=X.t;var Ab=B("COLOR","u_input",1,.25,!0);Ab.fa=X.t;Ab.ea=X.t;var Lb=bb/Fb,Mb=d(ua[W]);
b.L.push(Mb);var Sa=R(Mb,Vb,bb,!0,Lb,ea,Fb);x.u(h,Sa);x.n(h,Ma,Sa,ub);var Lb=bb/Fb*.5,zc=d(ua[W]);b.L.push(zc);var Wb=R(zc,Vb,bb,!1,Lb,ea,Fb);x.u(h,Wb);x.n(h,Sa,Wb,Ab);var Lb=bb/Fb*.25,gc=d(ua[W]);b.L.push(gc);var rb=R(gc,Vb,bb,!1,Lb,ea,Fb);x.u(h,rb);x.n(h,Wb,rb,Ab);var Xb=V(Ha,ea);k.push(Xb);x.u(h,Xb);x.n(h,Ma,Xb,B("COLOR","u_main",1,1,!0));x.n(h,rb,Xb,B("COLOR","u_god_rays",1,1,!0))}l=k;k=[]}if(nb&&!Ea){for(W=0;W<ua.length;W++){var Ma=l[W],sc=ma();x.u(h,sc);x.n(h,Ma,sc,B("COLOR","u_input",1,1,!0));
var Yb=aa();x.u(h,Yb);Yb.j.width=wa.mj?2:1;Yb.j.height=wa.mj?2:1;var Nb=B("COLOR","u_input",1,.25,!0);Nb.fa=X.t;Nb.ea=X.t;var tc=B("COLOR","u_luminance",1,.25,!0);tc.fa=X.t;tc.ea=X.t;x.n(h,sc,Yb,Nb);var nc=nb.key,Oc=nb.Yy,uc=d(ua[W]);b.L.push(uc);var Zb=fa(nc,Oc,ea,uc);x.u(h,Zb);x.n(h,Ma,Zb,B("COLOR","u_main",1,1,!0));x.n(h,sc,Zb,tc);x.n(h,Yb,Zb,B("COLOR","u_average_lum",1,1,!1));var Bb=B("COLOR","u_color",1,.25,!0);Bb.fa=X.t;Bb.ea=X.t;sa=q("X_BLUR");x.u(h,sa);x.n(h,Zb,sa,Bb);Ga=q("Y_BLUR");x.u(h,
Ga);x.n(h,sa,Ga,Bb);var Ec=D(nb.blur);x.u(h,Ec);var Ya=B("COLOR","u_bloom",1,.25,!0);Ya.fa=X.t;Ya.ea=X.t;x.n(h,Ga,Ec,Ya);x.n(h,Ma,Ec,B("COLOR","u_main",1,1,!0));k.push(Ec)}l=k;k=[]}if(Ra&&!Ea){for(W=0;W<l.length;W++){var Ja=l[W],Pc=U(Rb.mb_decay_threshold,Rb.mb_factor);k.push(Pc);x.u(h,Pc);x.n(h,Ja,Pc,B("COLOR","u_mb_tex_curr",1,1,!0));Pc.ra.push(B("COLOR","u_mb_tex_accum",1,1,!0))}l=k;k=[]}if(Kb&&fb&&!Ea){for(W=0;W<l.length;W++){var Ma=l[W],Ac=d(ua[W]);b.L.push(Ac);Bb=B("COLOR","u_color",1,1,!0);
Bb.fa=X.t;Bb.ea=X.t;var vc=y("X_BLUR");x.u(h,vc);x.n(h,Ma,vc,Bb);var Ob=y("Y_BLUR");x.u(h,Ob);x.n(h,vc,Ob,Bb);var db=lb[W],oc=ga(Ac);Ac.dof_distance=b.dof_distance;Ac.ue=b.ue;Ac.dof_front=b.dof_front;Ac.dof_rear=b.dof_rear;Ac.dof_power=b.dof_power;Ac.dof_on=1;k.push(oc);x.u(h,oc);x.n(h,Ma,oc,B("COLOR","u_sharp",1,1,!0));x.n(h,Ob,oc,B("COLOR","u_blurred",1,1,!0));x.n(h,db,oc,B("DEPTH","u_depth",1,1,!0))}l=k;k=[]}if(!Ea&&a.outline){for(W=0;W<ua.length;W++){var Ma=l[W],Qc=d(ua[W]);b.L.push(Qc);var Lc=
S(Qc);x.u(h,Lc);var Pb=y("X_EXTEND"),Yc=B("COLOR","u_color",1,1,!0),Sc=B("COLOR","u_outline_mask",1,1,!0);Pb.Cj=!0;x.u(h,Pb);x.n(h,Lc,Pb,Yc);var Zc=B("COLOR","u_color",1,.5,!0);Zc.fa=X.t;Zc.ea=X.t;var $c=y("Y_EXTEND");$c.Cj=!0;x.u(h,$c);x.n(h,Pb,$c,Zc);vc=y("X_BLUR");vc.Cj=!0;x.u(h,vc);x.n(h,$c,vc,Zc);var ed=B("COLOR","u_color",1,.25,!0);ed.fa=X.t;ed.ea=X.t;var fd=B("COLOR","u_outline_mask_blurred",1,.25,!0);fd.fa=X.t;fd.ea=X.t;Ob=y("Y_BLUR");Ob.Cj=!0;x.u(h,Ob);x.n(h,vc,Ob,ed);var Tc=Y(Ta);x.u(h,
Tc);x.n(h,Ma,Tc,B("COLOR","u_outline_src",1,1,!0));x.n(h,Lc,Tc,Sc);x.n(h,Ob,Tc,fd);k.push(Tc)}l=k;k=[]}if(bc&&!Ea){for(W=0;W<l.length;W++){var Ma=l[W],gd=T(cb.brightness,cb.contrast,cb.exposure,cb.saturation);x.u(h,gd);x.n(h,Ma,gd,B("COLOR","u_color",1,1,!0));k.push(gd)}l=k;k=[]}if(Kc){for(W=0;W<l.length;W++)if(Ma=l[W],wa.smaa){var Uc=B("COLOR","u_color",1,1,!0);Uc.fa=X.t;Uc.ea=X.t;var hd=N("SMAA_EDGE_DETECTION");x.u(h,hd);x.n(h,Ma,hd,Uc);var Vc=N("SMAA_BLENDING_WEIGHT_CALCULATION");x.u(h,Vc);x.n(h,
hd,Vc,Uc);var jd=B("COLOR","u_search_tex",1,1,!1),kd=B("COLOR","u_area_tex",1,1,!1);jd.fa=X.t;jd.ea=X.t;kd.fa=X.t;kd.ea=X.t;Vc.ra.push(jd);Vc.ra.push(kd);var ad=N("SMAA_NEIGHBORHOOD_BLENDING");x.u(h,ad);x.n(h,Ma,ad,Uc);var ld=B("COLOR","u_blend",1,1,!0);ld.fa=X.t;ld.ea=X.t;x.n(h,Vc,ad,ld);k.push(ad)}else{var bd=v();x.u(h,bd);var cd=B("COLOR","u_color",1,1,!0);cd.fa=X.t;cd.ea=X.t;x.n(h,Ma,bd,cd);if(1<wa.render_resolution_factor){var md=y("NONE");x.u(h,md);x.n(h,bd,md,cd);k.push(md)}else k.push(bd)}l=
k;k=[]}if(a.anaglyph_use&&!Ea){var dd=qa();x.u(h,dd);x.n(h,l[0],dd,B("COLOR","u_sampler_left",1,1,!0));x.n(h,l[1],dd,B("COLOR","u_sampler_right",1,1,!0));k.push(dd)}else k.push(l[0]);var sd=x.Pg(h,l[0]);if("MOTION_BLUR"==l[0].type)var nd=!0;else nd=!1,x.Re(h,sd,function(a,b,c){if(c.W==c.xa)return nd=!0});if(nd){var Mc=ha();x.u(h,Mc);x.n(h,l[0],Mc,B("COLOR","u_color",1,1,!0));l=k;k=[];k.push(Mc)}Db&&(pb?k.push(pb):k.push(Db));hb&&k.push(hb);if(!Ea&&a.im.procedural_skydome){var od=pa(ea,a.im);x.u(h,
od);k.push(od)}var Fc=O();x.u(h,Fc);for(W=0;W<k.length;W++){var Wc=k[W];switch(Wc.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":x.n(h,Wc,Fc,B("COLOR","NONE",1,1,!0));x.n(h,Wc,Fc,B("DEPTH","NONE",1,1,!0));break;case "SKY":x.n(h,Wc,Fc,B("CUBEMAP","u_sky",ja.Yk,1,!1));break;case "ANCHOR_VISIBILITY":x.n(h,Wc,Fc,B("COLOR","NONE",1,1,!0));break;default:if(Ea){var pd=e[0].k,Xc=B("COLOR","OFFSCREEN",1,1,!0);Xc.Aa=pd;x.n(h,k[W],Fc,Xc);for(Aa=1;Aa<e.length;Aa++){var qd=e[Aa].k,Mc=ha();x.u(h,Mc);x.n(h,
k[W],Mc,B("COLOR","u_color",1,1,!0));Xc=B("COLOR","OFFSCREEN",1,qd.dh/pd.dh,!0);Xc.Aa=qd;x.n(h,Mc,Fc,Xc)}}else x.n(h,k[W],Fc,B("SCREEN","NONE",1,1,!0))}}if(Gb.enabled){var rd=G(h);rd&&F(h,rd)}c(h,fb);1<wa.render_resolution_factor&&m(h);f(h);C(h);if(jb){for(W=0;W<kb.length;W++)A(h,kb[W]);for(W=0;W<lb.length;W++)A(h,lb[W]);for(W=0;W<dc.length;W++)A(h,dc[W])}return h};a.wG=u;a.Qc=function(a,b,c){var d=a.Qe;a.vp[0]=b*a.Sa[0]*d;a.vp[1]=c*a.Sa[1]*d};a.Xb=function(a,b){a.Qe=b};a.UF=function(a){var b=null;
x.V(a,function(a,c){return c.j&&null===c.j.ye?(b=c,!0):!1});return b};a.Ma=function(a,b,c){a=va(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.pG=ba;a.rG=J;a.Zz=va;a.iG=na;a.Va=function(a,b){var c=null;x.V(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.Ly=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=ia(a);x.V(a,function(a,d){var e=b+="    ",
f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(f+=" ("+d.Ul.replace(/_/g," ")+")");if(d.j){for(var f=f+"\\n",g=0;g<c.length;g+=2)c[g]==d.j.ob&&(f+="C"+c[g+1]+" ");for(g=0;g<c.length;g+=2)c[g]==d.j.cd&&(f+="D"+c[g+1])}d.ra.length&&(f+="\\n-----\\n");for(g=0;g<d.ra.length;g++)f+=ea(d.ra[g],c);g="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(g+",bold")+'"];\n')});x.ce(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+
ea(e,c)+'" style="'+(e.Za?"solid":"dotted")+'"];\n'});return b+="}"};a.uy=function(a){a=x.xD(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,r){function d(){return{name:"",type:0,source:"",fp:"",width:0,height:0,gn:1,xk:!0,dh:1024,vr:!1,ne:null,Xa:null,hi:null,Lt:1,Ke:0,ii:!1,sm:!1,Qh:!1,G:0,ia:0,Hh:0,iE:!1,fh:!1,Bo:0,lc:0,$b:0,jb:null,Sf:null}}function c(c,e,f,g){var h=c.type,l=new Uint8Array([204,204,204,255]),m=d();switch(h){case "DATA_TEX2D":case "IMAGE":var k=q.createTexture(),n=q.TEXTURE_2D;q.bindTexture(n,k);q.texImage2D(n,0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,l);c.image&&"MOVIE"==c.image.source&&
(m.Qh=!0,m.G=c.frame_start,m.ia=c.frame_offset,m.Hh=c.frame_duration,m.iE=c.use_auto_refresh,m.fh=c.use_cyclic,m.Bo=c.movie_length,0!=m.ia&&F.warn('Frame offset for texture "'+c.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":k=q.createTexture();n=q.TEXTURE_2D;q.bindTexture(n,k);if("NONE"==c.b4w_source_type)return null;if("SCENE"==c.b4w_source_type)if(c.b4w_source_id&&(f=E.keysearch("name",c.b4w_source_id,f)))m.dh=c.b4w_source_size,f.Gd=f.Gd||
[],f.Gd.push(c),q.texImage2D(n,0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,l);else return null;break;case "ENVIRONMENT_MAP":k=q.createTexture();n=q.TEXTURE_CUBE_MAP;q.bindTexture(n,k);f="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var p=0;6>p;p++)u.eo?q.texImage2D(q["TEXTURE_CUBE_MAP_"+f[p]],0,q.RGB,1,1,0,q.RGB,q.UNSIGNED_BYTE,l):q.texImage2D(q["TEXTURE_CUBE_MAP_"+f[p]],0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,l);break;case "BLEND":return null;default:return F.error('texture "'+
c.name+'" has unsupported type "'+h+'"'),null}"NONE"==h&&(!c.b4w_enable_canvas_mipmapping||"CANVAS"!=c.b4w_source_type)||"DATA_TEX2D"==h||"IMAGE"==h&&"MOVIE"==c.image.source?q.texParameteri(n,q.TEXTURE_MIN_FILTER,q.LINEAR):u.eo&&"ENVIRONMENT_MAP"==h?q.texParameteri(n,q.TEXTURE_MIN_FILTER,q.LINEAR):q.texParameteri(n,q.TEXTURE_MIN_FILTER,w[u.lm]);q.texParameteri(n,q.TEXTURE_MAG_FILTER,q.LINEAR);l=n;f=c.b4w_anisotropic_filtering;"DEFAULT"===f&&(f=e);"OFF"!==f&&u.yk&&(e=G.Lz())&&(f=parseFloat(f.split("x")[0]),
q.texParameterf(l,e.TEXTURE_MAX_ANISOTROPY_EXT,f));"REPEAT"!=c.extension||c.b4w_shore_dist_map?(q.texParameteri(n,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(n,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE)):(q.texParameteri(n,q.TEXTURE_WRAP_S,q.REPEAT),q.texParameteri(n,q.TEXTURE_WRAP_T,q.REPEAT));m.type=a.ph;m.width=1;m.height=1;m.jb=k;m.$b=n;"CANVAS"==c.b4w_source_type&&"NONE"==h?(h=c.b4w_source_id,k=c.b4w_source_size,m.vr=c.b4w_enable_canvas_mipmapping,m.fp=h,m.source="CANVAS",n=document.createElement("canvas"),
n.width=k,n.height=k,m.ne=n.getContext("2d"),g in t||(t[g]={}),t[g][h]=m,b(m)):"SCENE"==c.b4w_source_type&&"NONE"==h?(m.fp=c.b4w_source_id,m.source="SCENE"):(m.source=h,q.generateMipmap(n),q.bindTexture(n,null));m.name=c.name;return c.k=m}function b(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.$b;q.bindTexture(b,a.jb);var c=k(a),d=p(a),e=a.ne.canvas;q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!0);q.texImage2D(b,0,c,c,d,e);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!1);a.vr&&q.generateMipmap(b);q.bindTexture(b,
null);a.width=e.width;a.height=e.height}function l(a){var b=a.$b;q.bindTexture(b,a.jb);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!0);q.texImage2D(b,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,a.hi[a.Ke]);q.bindTexture(b,null)}function f(a){q.texParameteri(a,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(a,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);q.texParameteri(a,q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(a,q.TEXTURE_MIN_FILTER,q.LINEAR)}function m(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];
return-1==c.indexOf(a)||-1==c.indexOf(b)}function k(b){switch(b.type){case a.ph:b=q.RGBA;break;case a.zm:b=q.RGB;break;case a.sk:b=q.RGBA;break;case a.tk:b=q.RGB;break;case a.Li:b=q.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function p(b){switch(b.type){case a.ph:b=q.UNSIGNED_BYTE;break;case a.zm:b=q.UNSIGNED_BYTE;break;case a.sk:b=q.FLOAT;break;case a.tk:b=q.FLOAT;break;case a.Li:b=q.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function e(a,b){return b in
y&&a in y[b]?(u.md?y[b][a].ii=!0:y[b][a].Xa.play(),!0):null}function g(a,b){if(b in y&&a in y[b]){var c=y[b][a];u.md?(c.Ke=c.ia,l(c),c.Ke++):c.Xa.currentTime=c.ia/c.lc;return!0}return null}function h(a,b){return b in y&&a in y[b]?(u.md?y[b][a].ii=!1:y[b][a].Xa.pause(),!0):null}var n=r("__config"),C=r("__dds"),G=r("__extensions"),F=r("__print"),E=r("__util"),u=n.q,B=n.ke,A=n.w;a.yc=0;a.t=0;a.sw=0;a.qw=0;a.rw=0;a.pw=0;a.ph=10;a.zm=20;a.sk=30;a.tk=40;a.Li=50;a.oh=60;var t={},y={},q=null,w;a.Cd=function(b){w=
[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.yc=b.NEAREST;a.t=b.LINEAR;a.sw=b.NEAREST_MIPMAP_NEAREST;a.qw=b.LINEAR_MIPMAP_NEAREST;a.rw=b.NEAREST_MIPMAP_LINEAR;a.pw=b.LINEAR_MIPMAP_LINEAR;q=b};a.Pz=function(a,b){return b in t&&a in t[b]?t[b][a].ne:null};a.PD=function(a,c){return c in t&&a in t[c]?(b(t[c][a]),!0):!1};a.Xk=function(b,c){var e=d();e.name=b;e.type=c;e.source="NONE";if(c==a.oh)e.Sf=q.createRenderbuffer();else{var f=q.TEXTURE_2D,g=q.createTexture();
q.bindTexture(f,g);q.texParameteri(f,q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(f,q.TEXTURE_MIN_FILTER,q.LINEAR);q.texParameteri(f,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(f,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);q.bindTexture(f,null);e.$b=f;e.jb=g}return e};a.hy=function(b){var c=q.createTexture(),e=q.TEXTURE_CUBE_MAP;q.bindTexture(e,c);q.texParameteri(e,q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(e,q.TEXTURE_MIN_FILTER,q.LINEAR);q.texParameteri(e,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(e,
q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),g=0;6>g;g++)q.texImage2D(q[f[g]],0,q.RGBA,b,b,0,q.RGBA,q.UNSIGNED_BYTE,null);q.bindTexture(e,null);e=d();e.name="CUBEMAP";e.type=a.ph;e.source="NONE";e.width=3*b;e.height=2*b;e.gn=1;e.jb=c;e.$b=q.TEXTURE_CUBE_MAP;return e};a.Xj=function(b,c,d){if(b.type!=a.oh){var e=b.$b;q.bindTexture(e,
b.jb);c&&q.texParameteri(e,q.TEXTURE_MIN_FILTER,c);d&&q.texParameteri(e,q.TEXTURE_MAG_FILTER,d);q.bindTexture(e,null)}};a.hG=function(b){if(b.type==a.oh)return{min:a.yc,lB:a.yc};var c=b.$b;q.bindTexture(c,b.jb);b=q.getTexParameter(c,q.TEXTURE_MIN_FILTER);var d=q.getTexParameter(c,q.TEXTURE_MAG_FILTER);q.bindTexture(c,null);return{min:b,lB:d}};a.resize=function(b,c,d){c=Math.max(c,u.mj?2:1);d=Math.max(d,u.mj?2:1);if(b.width!=c||b.height!=d){if(b.type==a.oh)q.bindRenderbuffer(q.RENDERBUFFER,b.Sf),q.renderbufferStorage(q.RENDERBUFFER,
q.DEPTH_COMPONENT16,c,d),q.bindRenderbuffer(q.RENDERBUFFER,null);else{var e=b.$b;q.bindTexture(e,b.jb);var f=k(b),g=p(b);q.texImage2D(e,0,f,c,d,0,f,g,null);q.bindTexture(e,null)}c>u.Tb||d>u.Tb?F.error('Slink texture "'+b.name+'" has unsupported size: '+c+"x"+d+". Max available: "+u.Tb+"x"+u.Tb+"."):(b.width=c,b.height=d)}};a.Cy=c;a.cE=function(a){var b=a.$b;q.bindTexture(b,a.jb);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!0);4!=a.Xa.length?q.texImage2D(b,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,a.Xa):q.texImage2D(b,
0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,a.Xa);q.bindTexture(b,null)};a.$D=l;a.ek=function(a,b,c,d,e){var g=a.source,h=a.$b;q.bindTexture(h,a.jb);if(4==b.length){var l=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==g)if(l)q.texImage2D(h,0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){c=C.bs(b);if(c.width>u.Tb||c.height>u.Tb){F.error('Texture "'+d+'" has unsupported size: '+c.width+"x"+c.height+". Max available: "+u.Tb+"x"+u.Tb+".");return}C.eE(q,G.Zr(),
b,!0);m(c.width,c.height)&&(a.xq||F.warn("using NPOT texture",d),f(h));a.width=c.width;a.height=c.height;a.gn=C.Rz(b)}else{q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!0);if(b.width>u.Tb||b.height>u.Tb){F.error('Texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+u.Tb+"x"+u.Tb+".");return}a.Qh?u.md?b&&(e in y||(y[e]={}),y[e][a.name]=a,a.hi=b,a.lc=a.Bo/b.length,a.Hh=Math.round(a.Hh/a.lc),a.ia=Math.round(a.ia/a.lc),a.G=Math.round(a.G/a.lc),a.Ke=a.ia,q.texImage2D(h,0,q.RGBA,q.RGBA,
q.UNSIGNED_BYTE,a.hi[0])):(a.Xa=b,a.Xa.loop=a.fh,b&&(e in y||(y[e]={}),y[e][a.name]=a),a.lc=B.Na,b.duration&&(a.lc=a.Bo/b.duration),A.sr||(b.playbackRate=B.Na/a.lc,A.Sq&&2<b.playbackRate&&(b.playbackRate=2)),q.texImage2D(h,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,a.Xa)):q.texImage2D(h,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,b);a.Qh?u.md?(a.width=b[0].width,a.height=b[0].height):(a.width=b.videoWidth,a.height=b.videoHeight):(a.width=b.width,a.height=b.height);m(a.width,a.height)?(a.xq||(a.Qh?F.warn("using NPOT video texture",
d):F.warn("using NPOT texture",d)),f(h)):a.Qh||q.generateMipmap(h)}else if("ENVIRONMENT_MAP"==g)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],l){for(l=0;6>l;l++)e=c[l],q.texImage2D(q["TEXTURE_CUBE_MAP_"+e[0]],0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!1);g=b.width/3;if(g>u.Mg||g>u.Mg){F.warn('Cubemap texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+
3*u.Mg+"x"+2*u.Mg+". Reduced image size will be used.");var k=b.width/3*(u.Mg/g)}else k=g;for(l=0;6>l;l++){e=c[l];var n=document.createElement("canvas");n.width=k;n.height=k;var p=n.getContext("2d");"POSITIVE_Y"==e[0]||"NEGATIVE_Y"==e[0]?(p.translate(0,k),p.scale(1,-1)):(p.translate(k,0),p.scale(-1,1));p.drawImage(b,e[1]*g,e[2]*g,g,g,0,0,k,k);q.texImage2D(q["TEXTURE_CUBE_MAP_"+e[0]],0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,n)}a.width=3*k;a.height=2*k;m(b.width/3,b.height/2)?(F.warn("using NPOT cube map texture",
d),f(h)):q.generateMipmap(h)}else"DATA_TEX2D"==g&&(q.texImage2D(h,0,q.RGBA,b.width,b.height,0,q.RGBA,q.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);q.bindTexture(h,null)};a.Sy=function(a){q.deleteTexture(a)};a.Ej=function(a){return a&&a.name&&(a.jb||a.Sf)?!0:!1};a.ys=function(a){return a&&a.name&&a.Sf?!0:!1};a.BG=function(b){return b.type==a.sk||b.type==a.tk?!0:!1};a.hA=function(b){var c=0;switch(b.type){case a.ph:case a.zm:c=4;break;case a.sk:case a.tk:c=16;break;case a.Li:c=3;break;
case a.oh:c=2}return c};a.Hz=function(a){var b=null,b={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};c(b,null,a,0);b.image={filepath:null};return b};a.cleanup=function(){if(!u.md)for(var a in y)for(var b in y[a])y[a][b].Xa.pause(),y[a][b].Xa.src="",y[a][b].Xa.load();t={};y={}};a.play_video=e;a.reset_video=g;a.pause_video=h;a.pause=function(){for(var a in y)for(var b in y[a])u.md&&!y[a][b].ii||!u.md&&y[a][b].Xa.paused||(h(b,a),y[a][b].sm=!0)};a.reset=
function(){for(var a in y)for(var b in y[a])g(b,a),y[a][b].sm=!1};a.play=function(a){for(var b in y)for(var c in y[b])if(!a||y[b][c].sm)e(c,b),y[b][c].sm=!1}};b4w.module.__assets=function(a,r){function d(){return G.BA()?r(G.ec.Lk).data:null}function c(){var a={uk:null,Bw:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.uk=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=d();b&&a.uk in b&&(a.status=200,b[a.uk]&&(a.response=a.Bw(b[a.uk])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function b(b){for(var c=0,d=0;d<b.length;d++){var g=b[d];20===g.state&&c++;if(c>=y.sB)break;if(10===g.state)switch(g.state=20,c++,g.type){case a.AT_ARRAYBUFFER:l(g,"arraybuffer");break;case a.AT_JSON:l(g,"json");break;case a.AT_TEXT:l(g,"text");break;case a.AT_AUDIOBUFFER:f(g);break;case a.AT_IMAGE_ELEMENT:m(g);
break;case a.AT_AUDIO_ELEMENT:k(g);break;case a.ok:p(g);break;case a.nk:e(g);break;default:B.ja("Wrong asset type: "+g.type)}}}function l(a,b){var e=d(),f=e&&a.s in e?new c:new XMLHttpRequest;f.open("GET",a.s,!0);"text"==b?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==b?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=b;f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var c=f.response;if(c){if("json"==b&&
"string"==typeof c)try{c=JSON.parse(c)}catch(d){E.error(d+" (parsing JSON "+a.s+")");a.sb(null,a.uri,a.type,a.s,a.xb);return}a.sb(c,a.uri,a.type,a.s,a.xb)}else E.error("empty responce when trying to get "+a.s),a.sb(null,a.uri,a.type,a.s,a.xb)}else E.error(f.status+" when trying to get "+a.s),a.sb(null,a.uri,a.type,a.s,a.xb);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.tt(b.loaded/b.total)},!1);f.send(null)}function f(a){var b=d(),e=b&&a.s in b?new c:new XMLHttpRequest;
e.open("GET",a.s,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?u.Oy(b,function(b){a.sb(b,a.uri,a.type,a.s,a.xb);a.state=30},function(){a.sb(null,a.uri,a.type,a.s,a.xb);E.error("failed to decode "+a.s);a.state=30}):(a.sb(null,a.uri,a.type,a.s,a.xb),E.error("empty responce when trying to get "+a.s),a.state=30)}else a.sb(null,a.uri,a.type,a.s,a.xb),E.error(e.status+" when trying to get "+a.s),a.state=
30};e.send(null)}function m(a){var b=document.createElement("img");t.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.sb(b,a.uri,a.type,a.s,a.xb),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.sb(null,a.uri,a.type,a.s,a.xb),E.error("could not load image: "+a.s),a.state=30)},!1);var c=d();if(c&&a.s in c)if(c[a.s]){var e=h(a.s);b.src="data:"+e+";base64,"+c[a.s]}else F.jo()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=
new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.s}function k(a){var b=document.createElement("audio");if(t.allow_cors||t.br)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.sb(b,a.uri,a.type,a.s,a.xb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.sb(null,a.uri,a.type,a.s,a.xb),E.error("could not load sound: "+a.s),a.state=30)},!1);var c=d();if(c&&a.s in c)if(c[a.s]){var e=n(a.s);b.src="data:"+e+";base64,"+c[a.s];40!=a.state&&(a.sb(b,
a.uri,a.type,a.s,a.xb),a.state=30)}else F.jo()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.s,t.Bg&&b.load();t.Ao&&(b.autoplay=!0,b.pause());setTimeout(function(){b.YC=1},5E3)}function p(a){function b(){40!=a.state&&(a.sb(null,a.uri,a.type,a.s),E.error("could not load video: "+a.s,a.xb),a.state=30)}var c=document.createElement("video");c.muted=!0;if(t.allow_cors||t.Bg)c.crossOrigin="Anonymous";c.addEventListener("loadeddata",
function(){c.removeEventListener("error",b,!1);40!=a.state&&(a.sb(c,a.uri,a.type,a.s,a.xb),a.state=30)},!1);c.addEventListener("error",b,!1);var e=d();if(e&&a.s in e)if(e[a.s]){var f=C(a.s);c.src="data:"+f+";base64,"+e[a.s];40!=a.state&&c.addEventListener("loadeddata",function(){a.sb(c,a.uri,a.type,a.s,a.xb);a.state=30},!1)}else F.jo()?(e=document.createEvent("CustomEvent"),e.initCustomEvent("error",!1,!1,null)):e=new CustomEvent("error"),c.dispatchEvent(e);else c.src=a.s,t.Bg&&c.load();t.Ao&&(c.autoplay=
!0,c.pause());setTimeout(function(){c.YC=1},1E4)}function e(a){function b(c){a.sb(c,a.uri,a.type,a.s,a.xb)}var e=d(),f=e&&a.s in e?new c:new XMLHttpRequest;f.open("GET",a.s,!0);f.responseType="arraybuffer";f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var c=f.response;c?g(c,b):(a.sb(null,a.uri,a.type,a.s,a.xb),E.error("empty responce when trying to get "+a.s))}else a.sb(null,a.uri,a.type,a.s,a.xb),E.error(f.status+" when trying to get "+a.s);a.state=
30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.tt(b.loaded/b.total)},!1);f.send(null)}function g(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],f={images:[],Bq:[],lc:c[4]},g=20,h=0;h<e;h++){var l=c[g/4],m=new Blob([d.subarray(g+4,g+4+l)],{type:"image/jpg"}),k=document.createElement("img");k.src=window.URL.createObjectURL(m);f.images.push(k);f.Bq.push(m);g+=l+8-l%4}k.onload=function(){for(var a=0;a<f.images.length;a++)window.URL.revokeObjectURL(f.images[a].src);delete f.Bq;
b(f)}}function h(a){var b="image";switch(B.On(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function n(a){var b="audio";switch(B.On(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function C(a){var b="video";switch(B.On(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var G=r("__config"),F=r("__compat"),
E=r("__print"),u=r("__sfx"),B=r("__util"),A=r("__version"),t=G.q,y=G.Id;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.ok=70;a.nk=80;var q=[],w=0,H={};a.$j=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.kG=function(a){if(H[a])return H[a];var b=y.Oo?a+A.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=
c.responseText;if(b.length)return H[a]=b;B.ja("Error XHR: responce is empty, GET "+a)}else B.ja("Error XHR: "+c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<q.length;a++)q[a].state=40;q=[];w=0;H={}};a.enqueue=function(a,c,e,f){for(var g=0;g<a.length;g++){var h=a[g],h={uri:h[0],type:h[1],s:h[2],xb:h[3],state:10,sb:c||function(){},kt:e||function(){},tt:f||function(){},lt:w};if(y.Oo){var l=d();l&&h.s in l||(h.s+=A.timestamp())}q.push(h)}b(q);w++};a.update=function(){b(q);for(var a=q,c=0,d=
!0,e=0;e<a.length;e++){var f=a[e];f.lt===a[c].lt?30!==f.state&&(d=!1):(d&&(a[e-1].kt(),d=e-c,a.splice(c,d),e-=d),c=e,d=30===a[e].state?!0:!1);e===a.length-1&&d&&(a[e].kt(),a.splice(c))}}};b4w.module.__loader=function(a,r){function d(b,d,e,f){var g=u,l=G.create(),m;for(m in d){var k=c(d[m]);(f&&k.eb||!b&&k.qb)&&h(k);G.u(l,k)}for(m in d)for(k=d[m],k.name=m,b=0;b<k.C.length;b++)G.n(l,d[k.C[b]],k,null);d=c({name:"out",Qa:a.cv,lb:function(a,b,c,d,e){0===b.id&&(g.kp=!0);C(b)||(b.status=2);b.Ms(b.id,!0);e(b,c);F.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},gb:5});var n=[];if(e)for(e=G.as(l),b=0;b<e.length;b++)n.push(G.Oa(l,e[b]));else G.V(l,function(a,b){b.$a||n.push(b)});G.u(l,
d);for(b=0;b<n.length;b++)d.C.push(n[b].name),G.n(l,n[b],d,null);return l}function c(a){a.$a=a.$a||!1;a.Qa||0===a.Qa||(a.Qa=a.od);a.C=a.C||[];a.Bj=a.Bj||!1;a.cp=a.cp||!1;a.gb=a.gb||0;a.eb=a.eb||!1;a.qb=a.qb||!1;a.status=0;a.KG=0;a.so=0;a.eg=a.eg||null;return a}function b(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];G.Oa(a.Zd,f).Bj&&(G.Nf(a.Zd,f,function(d){var e=!0;G.Re(a.Zd,d,function(a,b){if(!b.Bj)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-
1;0<=e;e--)b.splice(d[e],1);return c}function l(a){function c(b,d){var e=G.Oa(a.Zd,b),f=G.Oa(a.Zd,d),g=f.Qa-e.Qa;0==g&&(g=e.$a-f.$a);return g}var d=[],e=a.Pe,f=!1;do{var g=b(a,e);d.push.apply(d,e);0<g.length&&(f=!0);e=g}while(0<g.length);f&&d.sort(c);a.Pe=d;return a.Pe.length}function f(a,b,c){if(b.cp)return b.Bj=!0,k(a,b),!1;if(!b.lb&&!b.cf&&!b.Vi)return k(a,b),!1;if(0==b.status&&(b.status++,b.lb))return b.lb(c,a,b,b.eg,k,p),!0;if(1==b.status){if(b.cf)return b.cf(c,a,b,b.eg,k,p),!0;b.status++}return 2==
b.status&&(b.status++,b.Vi)?(b.Vi(c,a,b,b.eg,k,p),!0):!1}function m(a){if(0==a.jm)return 100;var b=0;G.V(a.Zd,function(c,d){a.do_not_load_resources&&d.eb||(b+=d.so*d.gb)});return E.trunc(100*b/a.jm)}function k(a,b){b.Bj=!0;b.status=3;e(a,b,1)}function p(a,b,c){1>c?e(a,b,c):b.status++}function e(a,b,c){var d=u;if(b.lb||b.cf||b.Vi)if(b.so=c,b=m(a),a.lr!=b||1==c)a.jp(b,performance.now()-a.wu),a.lr=b,d.vo=!0}function g(a,b){var c=null;G.V(a.Zd,function(a,d){if(d.name==b)return c=d,1});return c}function h(a){a.cp=
!0;a.so=1}function n(a){a.jp=null;a.fn=null;a.Zd=null;a.Pe=null}function C(a){return a&&(3==a.status||4==a.status)}var G=r("__graph"),F=r("__print"),E=r("__util");a.od=0;a.fe=1;a.cv=2;var u=null;a.$r=function(){return u};a.vy=function(){var a={be:[],pn:0,wk:0,kp:!1,vo:!1};return u=a};a.Dy=function(a,b,c,e,f,g,h,l){var m=u,k={id:m.be.length,status:0,s:b,zq:"",Ms:c||function(){},Ls:l||!1,kH:g,wu:0,lr:0,jm:0,Vo:!1,jp:e||function(){},fn:f||function(){},Zd:null,Pe:null,Yn:!1,Xn:!1,bo:!1};a=d(0===k.id,
a,g,h);k.Zd=a;b=[];c=G.fA(a);for(e=0;e<c.length;e++)b.push(c[e]);k.Pe=b;G.V(a,function(a,b){!(b.lb||b.cf||b.Vi)||k.do_not_load_resources&&b.eb||(k.jm+=b.gb)});m.be.push(k);m.wk++;return k.id};a.ZD=function(b){var c=u;if(c&&0!=u.wk)if(c.vo)c.vo=!1;else{var d=performance.now();do{var e=c.be[c.pn],g=b[e.id];if(!C(e))if(0==e.status&&(e.status=1,e.wu=performance.now(),e.jp(0,0)),l(e)){var h=e,m=h.Pe.length;do{var k=G.Oa(h.Zd,h.Pe[0]),p=f(h,k,g);k.Qa==a.fe&&(h.Vo=!0);k=h.Pe.shift();h.Pe.push(k);m--}while(!p&&
0!=m)}else h=c,m=e,m.fn(g,m),m.status=3,h.wk--,n(m);c.kp&&(c.pn=(c.pn+1)%c.be.length);if(e.Vo){e.Vo=!1;break}}while(16>performance.now()-d)}};a.hq=function(a){var b=u;a.fn(null,a);a.status=3;b.wk--;n(a);a.status=4;0===a.id&&(b.kp=!0);a.Ms(a.id,!1)};a.cH=p;a.Xt=function(a,b){var c=g(a,b);null!==c&&h(c)};a.wD=C;a.is_primary_loaded=function(a){var b=u;if(!b)return!1;a|=0;return b.be[a]&&(3==b.be[a].status||2==b.be[a].status)};a.cleanup=function(){u=null}};b4w.module.__nla=function(a,r){function d(){return{type:"CLIP",G:0,N:0,Ie:!1,paused:!1,$f:"",Qi:"",Qb:0,Oi:0,Ni:0,yr:0,xr:0,vi:!1,Ju:!1,scale:1,repeat:1}}function c(a,b){if(a.animation_data){var d=a.animation_data.nla_tracks;if(d)for(var e=0;e<d.length;e++)b.push(d[e])}d=a.nodes;for(e=0;e<d.length;e++){var f=d[e];f.node_group&&(f=f.node_group.node_tree)&&c(f,b)}}function b(a,b){function c(a){return function(c,d,e,f){e=b.Jb[a];if(!(e>=g.length||0>e)&&(e=b.scripts[a][e],"SELECT"==e.type||"SELECT_PLAY"==
e.type&&!e.Be)){for(e=0;e<f.Kt;e++)if(F.get_sensor_value(c,d,e)&&e==f.Jt){f.Je=1;return}f.Je=0}}}for(var d=a.b4w_logic_nodes,e=b.scripts,f=0;f<d.length;f++)b.Jb.push(0);for(f=0;f<d.length;f++){e.push([]);for(var g=e[e.length-1],h=d[f],l=0;l<h.length;l++){var m=h[l],k={type:m.type,label:m.label,Dd:m.slot_idx_order,mi:-1,G:-1,N:-1,Be:!1,Je:-1,Kt:-1,Jt:-1,Yq:"",ei:"",fi:"",Ct:"",Hl:-1,Il:-1,at:-1,Yg:-1,url:"",mt:"",ft:"",mute:m.mute};switch(m.type){case "PLAY":k.G=m.frame_range[0];k.N=m.frame_range[1];
k.Be=!1;g.push(k);break;case "SELECT":case "SELECT_PLAY":k.mi=m.slot_idx_jump;var n=B.lf(B.Ki,m.object,0),p=B.eA(),q=p.indexOf(n);if(-1==q){A.error("NLA script error: non-selectable object:",m.object[m.object.length-1]);return}k.Je=-1;k.Kt=p.length;k.Jt=q;k.G=m.frame_range[0];k.N=m.frame_range[1];k.Be=!1;m=[];for(q=0;q<p.length;q++)m.push(F.create_selection_sensor(p[q],!0));F.create_sensor_manifold(n,"NLA_SELECT_"+l,F.CT_SHOT,m,F.Py,c(f),k);g.push(k);break;case "CONDJUMP":k.Yq=m.condition;k.ei=m.register1;
k.fi=m.register2;k.Hl=m.number1;k.Il=m.number2;k.mi=m.slot_idx_jump;g.push(k);break;case "REGSTORE":k.Ct=m.registerd;k.at=m.number1;g.push(k);break;case "MATH":k.ft=m.operation;k.ei=m.register1;k.fi=m.register2;k.Hl=m.number1;k.Il=m.number2;k.Yg=m.registerd;g.push(k);break;case "SHOW":case "HIDE":n=B.lf(B.Ki,m.object,0);k.obj=n;g.push(k);break;case "REDIRECT":k.url=m.url;g.push(k);break;case "PAGEPARAM":k.mt=m.param_name;k.Yg=m.registerd;g.push(k);break;case "ENTRYPOINT":case "NOOP":g.push(k)}}}}
function l(a,b,c,d,e){var g=a.scripts[b];if(g.length)if(a.Jb[b]>=g.length||0>a.Jb[b])a.ia-=H.Na*d;else{var h=m(a,c,!1,e),g=g[a.Jb[b]];if(g.mute)"ENTRYPOINT"==g.type?a.ia-=H.Na*d:(a.Jb[b]=g.Dd,l(a,b,c,d,e));else switch(g.type){case "PLAY":g.Be?h>=g.N&&(g.Be=!1,a.Jb[b]=g.Dd,l(a,b,c,d,e)):(a.ia+=g.G-h,g.Be=!0,f(a,b,g));break;case "SELECT":case "SELECT_PLAY":-1<g.Je?"SELECT"==g.type||"SELECT_PLAY"==g.type&&0==g.Je?(a.Jb[b]=g.Je?g.mi:g.Dd,g.Je=-1,l(a,b,c,d,e)):g.Be?h>=g.N&&(g.Be=!1,a.Jb[b]="SELECT"==g.type?
g.mi:g.Dd,g.Je=-1,l(a,b,c,d,e)):(a.ia+=g.G-h,g.Be=!0,f(a,b,g)):a.ia-=H.Na*d;break;case "JUMP":a.Jb[b]=g.mi;l(a,b,c,d,e);break;case "CONDJUMP":var h=-1==g.ei?g.Hl:a.Wd[g.ei],k=-1==g.fi?g.Il:a.Wd[g.fi],n=!1;switch(g.Yq){case "EQUAL":h==k&&(n=!0);break;case "NOTEQUAL":h!=k&&(n=!0);break;case "LESS":h<k&&(n=!0);break;case "GREATER":h>k&&(n=!0);break;case "LEQUAL":h<=k&&(n=!0);break;case "GEQUAL":h>=k&&(n=!0)}a.Jb[b]=n?g.mi:g.Dd;l(a,b,c,d,e);break;case "REGSTORE":a.Wd[g.Ct]=g.at;a.Jb[b]=g.Dd;l(a,b,c,d,
e);break;case "MATH":h=-1==g.ei?g.Hl:a.Wd[g.ei];k=-1==g.fi?g.Il:a.Wd[g.fi];switch(g.ft){case "ADD":a.Wd[g.Yg]=h+k;break;case "MUL":a.Wd[g.Yg]=h*k;break;case "SUB":a.Wd[g.Yg]=h-k;break;case "DIV":0==k&&w.ja("Division by zero in NLA script"),a.Wd[g.Yg]=h/k}a.Jb[b]=g.Dd;l(a,b,c,d,e);break;case "SHOW":t.show_object(g.obj);a.Jb[b]=g.Dd;l(a,b,c,d,e);break;case "HIDE":t.hide_object(g.obj);a.Jb[b]=g.Dd;l(a,b,c,d,e);break;case "REDIRECT":window.location.href=g.url;for(b=0;b<a.scripts.length;b++)a.scripts[b].length=
0;break;case "PAGEPARAM":a:{h=location.href.toString();if(-1!=h.indexOf("?"))for(h=h.split("?")[1].split("&"),k=0;k<h.length;k++)if(n=h[k].split("="),1<n.length&&n[0]==g.mt){h=Number(n[1]);break a}h=0}a.Wd[g.Yg]=h;a.Jb[b]=g.Dd;l(a,b,c,d,e);break;case "NOOP":case "ENTRYPOINT":a.Jb[b]=g.Dd,l(a,b,c,d,e)}}}function f(a,b,c){a=a.scripts[b];for(b=0;b<a.length;b++){var d=a[b];d!=c&&(d.Je=-1)}}function m(a,b,c,d){b=(b-d)*H.Na+a.ia-a.G;a.cyclic&&c&&(b%=a.N-a.G+1);return b+=a.G}function k(a,b){a=w.clamp(a,
b.G,b.N);var c=a-b.G,d=(b.N-b.G)/b.repeat,c=c/d&&0==c%d?b.Ni:b.Oi+c%d/b.scale;b.Ju&&(c=b.Ni-c+b.Oi);return c}function p(a,b,c){b?q.pause_video(a.name,c):(q.reset_video(a.name,c),q.play_video(a.name,c))}function e(a,b){for(var c=[],e=0;e<a.length;e++){var f=a[e].strips;if(f)for(var g=0;g<f.length;g++){var h=f[g],l=d();l.type=h.type;l.G=h.frame_start;l.N=h.frame_end;l.Qb=b;l.Oi=h.action_frame_start;l.Ni=h.action_frame_end;l.Ju=h.use_reverse;l.scale=h.scale;l.repeat=h.repeat;h.action&&(l.$f=h.action.name,
l.Qi=h.action.uuid);c.push(l)}}return c}function g(a){var b=a.J;return y.Ce(a)&&b.data.animation_data&&b.data.animation_data.nla_tracks.length?!0:!1}function h(a){var b=a.J;if("MESH"!=a.type||!b.data)return!1;a=b.data.materials;if(!a)return!1;for(b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c=c.use_nodes&&d)a:{if(d.animation_data&&(c=d.animation_data.nla_tracks)&&c.length){c=!0;break a}d=d.nodes;for(c=0;c<d.length;c++);c=!1}if(c)return!0}return!1}function n(a,b){var c=t.get_active();c.sa&&(c.sa.ia-=
m(c.sa,b,!0,P)-a,c.sa.Hn=!0)}var C=r("__animation"),G=r("__camera"),F=r("__controls"),E=r("__config"),u=r("__lights");r("__loader");var B=r("__objects"),A=r("__print"),t=r("__scenes"),y=r("__sfx"),q=r("__textures"),w=r("__util"),H=E.ke,z=E.q,Q=[],P=-1;a.YD=function(a,f,h){f={G:a.frame_start,N:a.frame_end,ia:0,Fj:-1,Zl:a.frame_end,So:a.frame_start,Fi:null,kc:h,cyclic:f,He:[],R:[],scripts:[],Dj:!1,Hn:!1,WG:a.name,Jb:[],Wd:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}};a.sa=f;b(a,f);for(var l=B.dA(a,h),
m=0;m<l.length;m++){var k=l[m],n=k.J,p=0,q=[];if((h=n.animation_data)&&h.nla_tracks.length){var t=h.nla_tracks;if(w.is_armature(k)||G.is_camera(k)||w.is_mesh(k)||w.ul(k)||u.xl(k)||y.Ce(k))t=e(t,p),t.length&&(q=q.concat(t),p++)}g(k)&&(t=n.data.animation_data.nla_tracks,t=e(t,p),t.length&&(q=q.concat(t),p++));if(C.pA(k)){var r=n.data.materials;for(h=0;h<r.length;h++){var F=r[h].node_tree;if(F&&(t=[],c(F,t),t=e(t,p),t.length)){for(var F=p,E=t,H=C.Nr(),P=[],qa=0,ma=0;ma<E.length;ma++){var aa=E[ma];""!=
aa.Qi?aa=w.keysearch("uuid",aa.Qi,H):(aa=aa.$f,aa=w.keysearch("name",aa,H)||w.keysearch("name",aa+"_B4W_BAKED",H));if(aa){var aa=aa.fcurves,fa=[],D;for(D in aa)fa.push(D);P.push(fa)}}for(ma=0;ma<P.length;ma++){H=!1;for(aa=0;aa<ma;aa++)if(w.ex(P[ma],P[aa])){E[ma].Qb=E[aa].Qb;H=!0;break}H||(E[ma].Qb=p+qa++)}p=F+qa;q=q.concat(t)}}}for(h=0;h<n.particle_systems.length;h++)t=n.particle_systems[h],r=t.settings,"EMITTER"==r.type&&r.b4w_allow_nla&&(r=d(),r.type="CLIP",r.G=f.G,r.N=f.N+1,r.$f=t.name,r.Qb=p,
r.Oi=r.G,r.Ni=r.N,q.push(r),p++);n=p+1;for(h=0;h<k.Ob.length;h++)t=k.Ob[h],t.Ew&&(p=n,r=d(),r.type="CLIP",r.G=f.G,r.N=f.N+1,r.$f=t.name,r.Qb=p,r.Oi=r.G,r.Ni=r.N,q.push(r));q.length&&(k.Gl=q,f.He.push(k))}a=a.k.jk;for(h=0;h<a.length;h++)if(D=a[h].k,D.Xa||D.hi)r=d(),r.type="VIDEO",l=1,z.md&&(l=D.lc),r.G=Math.min(D.G*l,f.N),r.N=D.fh?f.N:Math.min((D.Hh+D.G+D.ia)*l,f.N),r.$f=a[h].name,D.zw=r,f.R.push(D);a=f.G;h=f.N;for(D=0;D<f.He.length;D++)for(l=f.He[D],m=l.Gl,k=0;k<m.length;k++)q=m[k],n=l.name+" ["+
q.G+":"+q.N+"]",q.G=Math.max(a,q.G),q.N=Math.min(h+1,q.N),q.G>q.N?(A.warn("NLA: out of scene range: "+n),m.splice(k,1),k--):q.$f||"CLIP"!=q.type||(A.warn('NLA: no action in strip for object "'+l.name+'".'),m.splice(k,1),k--);for(a=0;a<f.He.length;a++)for(h=f.He[a].Gl,D=0;D<h.length;D++){l=h[D];m=f.G;k=f.N+1;for(q=0;q<h.length;q++)n=h[q],l.Qb==n.Qb&&(n.N<=l.G&&(m=l.G),n.G>=l.N&&(k=Math.min(k,n.G)));l.yr=m;l.xr=k}Q.push(f)};a.start=function(){P=0};a.update=function(a,b){if(!(0>P)){0==P&&(P=a);for(var c=
0;c<Q.length;c++){var d=Q[c];if(d.Dj&&(d.ia-=H.Na*b,!d.Hn))continue;d.Hn=!1;for(var e=0;e<d.scripts.length;e++)l(d,e,a,b,P);var f=m(d,a,!0,P);if(f>=d.Zl)if(d.cyclic)d.Fi&&d.Fi(),n(d.So,a),f=m(d,a,!0,P);else{d.Dj=!0;d.ia-=f-d.Zl;d.Fi&&d.Fi();continue}for(var g=0;g<d.He.length;g++){for(var h=d.He[g],q=h.Gl,e=0;e<q.length;e++){var t=q[e];"SOUND"==t.type&&f<d.Fj-1E-6&&(t.Ie=!1)}for(e=0;e<q.length;e++)switch(t=q[e],t.type){case "CLIP":if(t.yr<=f&&f<t.xr&&!t.Ie){var r=h,A=t;""!=A.Qi?C.Yw(r,A.Qi,A.Qb):C.apply(r,
A.$f,A.Qb);C.set_behavior(r,C.AB_FINISH_STOP,A.Qb);var u=k(A.G,A);C.set_frame(r,u,A.Qb);for(r=0;r<q.length;r++)q[r]!=t&&q[r].Qb==t.Qb&&(q[r].Ie=!1);t.Ie=!0}t.Ie&&(r=h,A=k(f,t),u=C.get_current_frame_float(r,t.Qb),1E-6<Math.abs(A-u)&&C.set_frame(r,A,t.Qb));break;case "SOUND":(f<d.Fj-1E-6||d.Fj<t.G)&&t.G<=f&&f<t.N&&!t.Ie&&(y.play(h,(t.G-f)/H.Na,(t.N-t.G)/H.Na),t.Ie=!0),d.Fj<t.N&&t.N<=f&&t.Ie&&(t.Ie=!1)}}for(g=0;g<d.R.length;g++)t=d.R[g].zw,t.G<=Math.round(f)&&Math.round(f)<t.N&&!t.vi&&(p(d.R[g],t.vi,
d.kc),t.vi=!0),t.N<=Math.round(f)&&t.vi&&(p(d.R[g],t.vi,d.kc),t.vi=!1);d.Fj=f}}};a.cleanup=function(){Q.length=0;P=-1};a.ns=function(a){var b=a.J.animation_data;return b&&b.nla_tracks.length||g(a)||h(a)?!0:!1};a.set_frame=n;a.get_frame=function(a){var b=t.get_active();return b.sa?m(b.sa,a,!0,P):-1};a.mD=function(){var a=t.get_active();a.sa&&(a.sa.Dj=!0)};a.QB=function(a){var b=t.get_active();b.sa&&(b.sa.Dj=!1,b.sa.Fi=a?a:null)};a.get_frame_start=function(){var a=t.get_active();return a.sa?a.sa.G:
-1};a.get_frame_end=function(){var a=t.get_active();return a.sa?a.sa.N:-1};a.is_play=function(){var a=t.get_active();return a.sa?!a.sa.Dj:!1};a.check_nla=function(){var a=t.get_active();return a.sa?a.b4w_use_nla:!1};a.check_logic_nodes=function(){var a=t.get_active();return a.sa?0<a.b4w_logic_nodes.length:!1};a.set_range=function(a,b){var c=t.get_active();if(c.sa)c.sa.So=a,c.sa.Zl=b;else return!1};a.reset_range=function(){var a=t.get_active();if(a.sa)a=a.sa,a.So=a.G,a.Zl=a.N;else return!1};a.set_cyclic=
function(a){var b=t.get_active();if(b.sa)b.sa.cyclic=a;else return!1};a.clear_callback=function(){var a=t.get_active();a.sa&&(a.sa.Fi=null)}};b4w.module.__camera=function(a,r){function d(b){b=b.f;switch(b.Ba){case a.MS_TARGET_CONTROLS:b.Oh=V.dist(b.i,b.Ub);b.Ph=b.L[0].top;break;case a.MS_HOVER_CONTROLS:b.ib&&(b.Oh=V.dist(b.i,b.dc),b.Ph=b.L[0].top)}}function c(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),fb:new Float32Array([0,0,0,0]),cb:new Float32Array([0,0,0,0])}}function b(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;
case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function l(b){var d={type:b,name:"",Jf:1,width:0,height:0,ye:null,ob:null,cd:null,Ca:0,Ic:0,fb:0,cb:0,left:0,right:0,top:0,bottom:0,kf:new Float32Array(3),Br:new Float32Array(3),quat:new Float32Array(4),ya:new Float32Array(16),tF:new Float32Array(16),za:new Float32Array(16),Hi:new Float32Array(16),XB:new Float32Array(16),Xd:new Float32Array(16),St:new Float32Array(16),Ed:new Float32Array(16),
dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,ue:null,dof_on:0,tj:c(),ck:0,$d:0,fc:null,cj:null,mn:null,ir:new Float32Array(4),Sl:new Float32Array(4)};if(b==a.Ab)return d;switch(b){case a.Pb:p(d,40,.1,1E3);break;case a.Zc:p(d,2.5,.1,1E3);break;case a.ge:break;case a.We:break;case a.Yf:break;case a.Bb:case a.Gb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return d}function f(b,c,d){if(b.type!=a.Bb&&b.type!=a.Gb)throw"set_stereo_params(): wrong camera type";
b.ck=c;b.$d=d;y(b,b.Ca);if(Y.ha()&&(c=Y.get_active(),b=c.k.Yb))for(c=Y.xj(c).f.L,d=0;d<c.length;d++)P(c[d],b)}function m(a,b){return k(a.f.quat,b)}function k(a,b){var c=R.quat_to_dir(a,R.AXIS_Y,aa),d=R.quat_to_dir(a,R.AXIS_Z,fa),e=-Math.asin(c[1]/V.length(c)),c=Math.abs(e)>Math.PI/4?V.scale(d,-R.sign(e),D):V.scale(c,-R.sign(d[1]),D),f=Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(e=R.sign(e)*Math.PI-e);d=f;0>c[2]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=e;return b}function p(b,c,d,e,f){switch(b.type){case a.Pb:case a.Bb:case a.Gb:b.Ic=
c;b.Ca=1;break;case a.Zc:b.top=c;b.Ca=1;break;case a.ge:delete b.Ic;b.Ic=c;b.Ca=f/c;break;case a.We:b.top=c;b.Ca=f/c;break;default:ga.error("set_frustum(): Unsupported camera type: "+b.type)}b.fb=d;b.cb=e}function e(b,c){var d=c.f.i,e=c.f.quat,f=ia;U.rotateX(c.f.Y,-Math.PI/2,f);U.invert(f,b.ya);if(b.fc){var f=b.fc[0],g=b.fc[1],h=b.fc[2],l=b.fc[3],m=ia;m[0]=1-2*f*f;m[1]=-2*f*g;m[2]=-2*f*h;m[3]=0;m[4]=-2*f*g;m[5]=1-2*g*g;m[6]=-2*g*h;m[7]=0;m[8]=-2*f*h;m[9]=-2*g*h;m[10]=1-2*h*h;m[11]=0;m[12]=-2*f*l;
m[13]=-2*g*l;m[14]=-2*h*l;m[15]=1;U.multiply(b.ya,m,b.ya);y(b,b.Ca,!0);f=J;g=ia;U.invert(b.ya,g);U.transpose(g,g);pa.transformMat4(b.fc,g,f);g=va;g[0]=(R.sign(f[0])+b.za[8])/b.za[0];g[1]=(R.sign(f[1])+b.za[9])/b.za[5];g[2]=-1;g[3]=(1+b.za[10])/b.za[14];pa.scale(f,2/(f[0]*g[0]+f[1]*g[1]+f[2]*g[2]+f[3]*g[3]),f);b.za[2]=f[0];b.za[6]=f[1];b.za[10]=f[2]+1;b.za[14]=f[3]}b.type==a.Bb?b.ya[12]+=b.$d/2:b.type==a.Gb&&(b.ya[12]-=b.$d/2);U.multiply(b.za,b.ya,b.Ed);w(b);q(b);V.copy(b.kf,b.Br);V.copy(d,b.kf);S.copy(e,
b.quat)}function g(b,c,d,e){U.lookAt(c,d,e,b.ya);b.type==a.Bb?b.ya[12]+=b.$d/2:b.type==a.Gb&&(b.ya[12]-=b.$d/2);U.multiply(b.za,b.ya,b.Ed);w(b);q(b);V.copy(c,b.kf)}function h(a){var b=a.f.L;if(!b)throw"Wrong object";for(var c=a.f,d=0;d<b.length;d++){var f=b[d];e(f,a);R.gl(f.Ed,f.tj);if(f.ue)if(f.dof_on){var g=c.i,h=ca.get_translation(f.ue,aa),g=V.dist(g,h);f.dof_distance=g}else f.dof_distance=0}}function n(b){b=b.f;if(b.Ba==a.MS_TARGET_CONTROLS){var c=R.quat_to_dir(b.quat,R.AXIS_Z,aa);b.tp=0<c[1]}}
function C(b,c){var d=b.f,e=d.cc;!e||d.Ba!=a.MS_EYE_CONTROLS&&d.Ba!=a.MS_TARGET_CONTROLS||(c&&(d=m(b,qa),e.left+=d[0],e.right+=d[0]),e.left=R.angle_wrap_0_2pi(e.left),e.right=R.angle_wrap_0_2pi(e.right))}function G(b,c){var d=b.f,e=d.ic;!e||d.Ba!=a.MS_EYE_CONTROLS&&d.Ba!=a.MS_TARGET_CONTROLS||(c&&(d=m(b,qa),e.hb+=d[1],e.Ua+=d[1]),e.hb=R.angle_wrap_periodic(e.hb,-Math.PI,Math.PI),e.Ua=R.angle_wrap_periodic(e.Ua,-Math.PI,Math.PI))}function F(b){var c=b.f;if(z(b)&&c.L[0].type===a.Zc){if(c.Ba===a.MS_TARGET_CONTROLS)var d=
V.dist(c.i,c.Ub),c=d/c.Oh*c.Ph;else c.ib&&c.Ba===a.MS_HOVER_CONTROLS?(d=V.distance(c.i,c.dc),c=d/c.Oh*c.Ph):c=b.f.L[0].top;for(var e in b.f.L)d=b.f.L[e],d.top=c,y(d,d.Ca);h(b)}}function E(a,b,c,d,e){var f=a.f,g=b,h=c;if(d||e)a=m(a,ma),d&&(g=b-a[0]),e&&(h=c-a[1]);if(g||h)b=S.identity(O),g&&(g=S.setAxisAngle(R.AXIS_Y,g,ba),S.multiply(b,g,b)),h&&(g=R.quat_to_dir(f.quat,R.AXIS_X,aa),h=S.setAxisAngle(g,h,ba),S.normalize(h,h),S.multiply(b,h,b)),S.multiply(b,f.quat,f.quat)}function u(a,b,c,d,e){var f=a.f,
g=b,h=c;if(d||e){var l=m(a,ma);d&&(g=b-l[0]);e&&(h=c-l[1])}A(a,a.f.Ub,g,h);a=m(a,ma);a=R.angle_wrap_periodic(a[1],-Math.PI,Math.PI);f.tp=Math.abs(a)>Math.PI/2}function B(a,b,c,d,e){var f=a.f,g=b,h=c;if(d||e){var l=m(a,ma);d&&(g=b-l[0]);e&&(h=c-l[1])}f.xn||(g=0);A(a,f.dc,g,h);h&&t(a)}function A(a,b,c,d){var e=a.f;if(c||d){var f=S.identity(O);c&&(c=S.setAxisAngle(R.AXIS_Y,c,ba),S.multiply(f,c,f));a=Q(a);d&&(!a||a&&e.ib)&&(a=R.quat_to_dir(e.quat,R.AXIS_X,aa),d=S.setAxisAngle(a,d,ba),S.normalize(d,d),
S.multiply(f,d,f));R.nC(e.i,b,f,e.i);S.multiply(f,e.quat,e.quat)}}function t(a){var b=a.f;if(b.ib){var c=m(a,qa)[1];a=a.f;a.Fb.Ua-a.Fb.hb?(c=(a.Fb.Ua-c)/(a.Fb.Ua-a.Fb.hb),c=Math.max(c,0)):c=0;c=c*(a.ng-a.te)+a.te;a=R.quat_to_dir(b.quat,R.AXIS_MY,aa);V.normalize(a,a);V.scale(a,c,a);V.subtract(b.dc,a,b.i)}}function y(b,c,d){switch(b.type){case a.Pb:if(!c)throw"No aspect ratio";b.Ca=c;case a.ge:U.perspective(R.Xl(b.Ic),b.Ca,b.fb,b.cb,b.za);break;case a.Zc:if(!c)throw"No aspect ratio";b.Ca=c;case a.We:c=
b.top*b.Ca;U.ortho(-c,c,-b.top,b.top,b.fb,b.cb,b.za);break;case a.Yf:U.ortho(b.left,b.right,b.bottom,b.top,b.fb,b.cb,b.za);break;case a.Bb:case a.Gb:if(!c)throw"No aspect ratio";b.Ca=c;var e=Math.tan(b.Ic*Math.PI/360);c=b.fb*e;var f=b.Ca*b.ck*e;b.type==a.Bb?(e=f-b.$d/2,f+=b.$d/2):(e=f+b.$d/2,f-=b.$d/2);e=-(b.fb/b.ck*e);f*=b.fb/b.ck;U.frustum(e,f,-c,c,b.fb,b.cb,b.za);b.left=e;b.right=f;break;case a.Ab:return;default:throw"Wrong camera type: "+b.type;}d||(U.multiply(b.za,b.ya,b.Ed),w(b),q(b))}function q(a){U.copy(a.ya,
a.Xd);a.Xd[12]=0;a.Xd[13]=0;a.Xd[14]=0;a.Xd[15]=1;U.multiply(a.za,a.Xd,a.Xd);U.invert(a.Xd,a.Xd)}function w(a){U.copy(a.ya,a.Hi);U.multiply(a.za,a.Hi,a.Hi);U.invert(a.Hi,a.Hi)}function H(b,c,d,e,f){e||(e=new Float32Array(24));c||(c=b.fb);d||(d=b.cb);var g,h,l,m,k,n,p,q;switch(b.type){case a.Ab:throw"Extraction from NONE camera is not possible";case a.Pb:case a.ge:g=c*Math.tan(b.Ic*Math.PI/360);m=-g;h=g*b.Ca;l=-h;k=d/c*g;q=-k;n=k*b.Ca;p=-n;break;case a.Zc:case a.We:l=b.top*b.Ca;g=k=b.top;h=n=l;m=q=
-b.top;l=p=-l;break;case a.Yf:g=k=b.top;h=n=b.right;m=q=b.bottom;l=p=b.left;break;case a.Bb:case a.Gb:k=c/b.fb;g=c*Math.tan(b.Ic*Math.PI/360);m=-g;h=b.right*k;l=b.left*k;p=d/c;k=g*p;q=-k;n=h*p;p*=l;break;default:throw"Wrong camera type: "+b.type;}e[0]=l;e[1]=m;e[2]=-c;e[3]=h;e[4]=m;e[5]=-c;e[6]=h;e[7]=g;e[8]=-c;e[9]=l;e[10]=g;e[11]=-c;e[12]=p;e[13]=q;e[14]=-d;e[15]=p;e[16]=k;e[17]=-d;e[18]=n;e[19]=k;e[20]=-d;e[21]=n;e[22]=q;e[23]=-d;f&&(c=ia,U.invert(b.ya,c),R.Cf(e,c,e,0));return e}function z(a){return"CAMERA"===
a.type}function Q(b){return z(b)&&b.f&&b.f.Ba==a.MS_HOVER_CONTROLS?!0:!1}function P(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.cj){var d=b.csm_num;a.cj=Array(d);for(var e=0;e<d;e++)a.cj[e]=new Float32Array(3);a.mn=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.fb:M(b,a,d-1),f=M(b,a,d),e=H(a,e,f,ea),e=L.Yz(e);a.cj[d].set(e.F);a.mn[d]=e.Ja;a.ir[d]=V.length(e.F);a.Sl[d]=I(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.Sl[0]=b.first_cascade_blur_radius}function M(a,b,c){var d=
a.csm_num,e=R.clamp(a.csm_first_cascade_border,b.fb,b.cb);a=R.clamp(a.csm_last_cascade_border,b.fb,b.cb);return R.clamp(I(e,a,d,c),b.fb,b.cb)}function I(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var L=r("__boundings");r("__config");var v=r("__constraints"),N=r("__container"),T=r("__mat3"),U=r("__mat4"),ga=r("__print"),S=r("__quat"),Y=r("__scenes"),ca=r("__transform"),R=r("__util"),V=r("__vec3"),pa=r("__vec4");a.Ab=10;a.Pb=20;a.Zc=30;a.ge=
40;a.We=50;a.Yf=60;a.Bb=70;a.Gb=80;a.MS_STATIC=0;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var ha=Math.PI/180/2,qa=new Float32Array(2),ma=new Float32Array(2),aa=new Float32Array(3),fa=new Float32Array(3),D=new Float32Array(3),O=new Float32Array(4),ba=new Float32Array(4),J=new Float32Array(4),va=new Float32Array(4),na=new Float32Array(16),ia=new Float32Array(16),ea=new Float32Array(24);a.Ax=function(c,e){var f=e.f,g=c.data;switch(g.type){case "PERSP":var h=l(a.Pb);if(g.angle_y)var k=
g.angle_y/Math.PI*180;p(h,k,g.clip_start,g.clip_end);break;case "ORTHO":h=l(a.Zc),p(h,g.ortho_scale/2,g.clip_start,g.clip_end)}h.name=e.name;f.zu=!1;f.Ba=b(g.b4w_move_style);f.dof_distance=c.data.dof_distance;k=c.data.dof_object;f.ue=k?k.Cb:null;f.dof_front=c.data.b4w_dof_front;f.dof_rear=c.data.b4w_dof_rear;f.dof_power=c.data.b4w_dof_power;f.xn=c.data.b4w_enable_hover_hor_rotation;f.L=[h];f.Lp=c.data.b4w_trans_velocity;f.Kp=c.data.b4w_rot_velocity;f.Mp=c.data.b4w_zoom_velocity;f.Ba==a.MS_TARGET_CONTROLS&&
(f.Ub.set(g.b4w_target),n(e));var q=e.J,g=e.f,k=g.Ba;if(k===a.MS_TARGET_CONTROLS||k===a.MS_EYE_CONTROLS||k===a.MS_HOVER_CONTROLS){var q=q.data,D=null,v=null,r=null;k===a.MS_TARGET_CONTROLS||k===a.MS_EYE_CONTROLS?(q.b4w_use_panning&&(g.Iu=q.b4w_use_panning),q.b4w_use_horizontal_clamping&&(D={left:q.b4w_rotation_left_limit,right:q.b4w_rotation_right_limit}),q.b4w_use_vertical_clamping&&(v={Ua:q.b4w_rotation_down_limit,hb:q.b4w_rotation_up_limit}),k===a.MS_TARGET_CONTROLS&&(g.ib=q.b4w_use_distance_limits&&
q.b4w_distance_min<=q.b4w_distance_max,g.ib&&(g.te=q.b4w_distance_min,g.ng=q.b4w_distance_max))):k===a.MS_HOVER_CONTROLS&&(q.b4w_use_horizontal_clamping&&q.b4w_horizontal_translation_min<=q.b4w_horizontal_translation_max&&(D={left:q.b4w_horizontal_translation_min,right:q.b4w_horizontal_translation_max}),q.b4w_use_vertical_clamping&&q.b4w_vertical_translation_min<=q.b4w_vertical_translation_max&&(v={Ua:q.b4w_vertical_translation_min,hb:q.b4w_vertical_translation_max}),g.ib=q.b4w_use_distance_limits&&
q.b4w_hover_angle_min<=q.b4w_hover_angle_max&&q.b4w_distance_min<=q.b4w_distance_max,g.ib&&(r={Ua:q.b4w_hover_angle_min,hb:q.b4w_hover_angle_max},g.te=q.b4w_distance_min,g.ng=q.b4w_distance_max));var ja=D;ja&&k==a.MS_EYE_CONTROLS&&(ja.left*=-1,ja.right*=-1);if(ja=v)switch(k){case a.MS_TARGET_CONTROLS:ja.Ua*=-1;ja.hb*=-1;break;case a.MS_HOVER_CONTROLS:var A=-ja.Ua;ja.Ua=-ja.hb;ja.hb=A}(ja=r)&&k==a.MS_HOVER_CONTROLS&&(ja.Ua*=-1,ja.hb*=-1);g.cc=D;g.ic=v;g.Fb=r;C(e,"LOCAL"==q.b4w_horizontal_clamping_type);
G(e,"LOCAL"==q.b4w_vertical_clamping_type)}if(f.Ba===a.MS_HOVER_CONTROLS)if(f=e.f,f.ib){k=e.J;g=e.f;q=R.quat_to_dir(g.quat,R.AXIS_MY,aa);D=J;D.set(R.AXIS_Y);D[3]=0;k=R.line_plane_intersect(D,-k.data.b4w_hover_zero_level,g.i,q,g.dc);q=m(e,qa)[1];if(!k||Math.abs(q)<ha)ga.warn("Active hover camera view vector and the supporting plane are parallel to each other. Set hover pivot based on the camera position."),g.dc[0]=g.i[0],g.dc[1]=0,g.dc[2]=g.i[2];g=m(e,qa);f=R.bf(g[1],f.Fb.hb,f.Fb.Ua);0<g[1]&&ga.warn("Active hover camera has wrong orientation");
f?B(e,0,f):t(e)}else f.xn=!1;h.type==a.Zc&&d(e)};a.wA=d;a.ky=c;a.tb=l;a.uF=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.ob);case "DEPTH":return Boolean(a.cd);case "SCREEN":return!Boolean(a.ob)&&!Boolean(a.cd);default:throw"Wrong attachment type: "+b;}};a.dm=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.ob=c;break;case "DEPTH":a.cd=c;break;case "SCREEN":a.ob=null;a.cd=null;break;default:throw"Wrong attachment type: "+b;}};a.fG=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.ob;
case "DEPTH":return a.cd;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.Os=function(b,c){if(b.type!=a.Pb||c!=a.Bb&&c!=a.Gb)throw"make_stereo(): wrong camera type";b.type=c;f(b,6,.065)};a.JC=f;a.get_camera_angles=m;a.Qr=k;a.get_camera_angles_char=function(a,b){m(a,b);b[0]=R.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.get_angles=function(a,b){var c=a.f,d=R.quat_to_dir(c.quat,R.AXIS_MY,aa),e=Math.asin(d[1]/V.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=
0>=e?R.quat_to_dir(c.quat,R.AXIS_MZ,fa):R.quat_to_dir(c.quat,R.AXIS_Z,fa)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b};a.em=p;a.zC=function(b,c,d,e,f,g,h){switch(b.type){case a.Yf:b.left=c;b.right=d;b.bottom=e;b.top=f;b.fb=g;b.cb=h;break;default:ga.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.f.Ba};a.MC=e;a.XG=g;a.Pt=function(a,b,c){var d=aa;d[0]=0;d[1]=-1;d[2]=0;V.transformQuat(d,
c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=fa;e[0]=0;e[1]=0;e[2]=-1;V.transformQuat(e,c,e);g(a,b,d,e)};a.kz=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];U.lookAt(a,b,c,ia);U.invert(ia,ia);U.rotateX(ia,Math.PI/2,ia);T.fromMat4(ia,na);S.fromMat3(na,e)};a.OD=h;a.ND=function(b){var c=b.f,d=b.f;if(d.Ba===a.MS_TARGET_CONTROLS||d.Ba===a.MS_EYE_CONTROLS){if(d.cc){var e=d.cc.left,f=d.cc.right,g=m(b,qa);(g=d.Ba==a.MS_TARGET_CONTROLS?R.bf(g[0],e,f):R.bf(g[0],f,e))&&(d.Ba==a.MS_TARGET_CONTROLS?u(b,g,0):
E(b,g,0))}d.ic&&(e=d.ic.Ua,f=d.ic.hb,g=m(b,qa),(g=d.Ba==a.MS_TARGET_CONTROLS?R.bf(g[1],f,e):R.bf(g[1],e,f))&&(d.Ba==a.MS_TARGET_CONTROLS?u(b,0,g):E(b,0,g)));d.Ba===a.MS_TARGET_CONTROLS&&d.ib&&(g=b.f,e=V.subtract(g.i,g.Ub,aa),f=V.length(e),f>g.ng?(V.scale(e,g.ng/f,e),V.add(g.Ub,e,g.i)):f<g.te&&(f=R.quat_to_dir(g.quat,R.AXIS_MY,fa),V.scale(f,100*g.te,f),V.add(e,f,e),V.scale(e,-g.te/V.length(e),e),V.add(g.Ub,e,g.i)))}d.Ba===a.MS_HOVER_CONTROLS&&(d=b.f,g=d.ib?d.dc:d.i,d.cc&&(e=R.clamp(g[0],d.cc.left,
d.cc.right)-g[0],g[0]+=e,d.ib&&(d.i[0]+=e)),d.ic&&(e=R.clamp(g[2],d.ic.Ua,d.ic.hb)-g[2],g[2]+=e,d.ib&&(d.i[2]+=e)),d=b.f,d.ib&&d.Fb&&(g=m(b,qa)[1],g=R.bf(g,d.Fb.hb,d.Fb.Ua),R.quat_to_dir(d.quat,R.AXIS_MY,aa),g&&B(b,0,g)));F(b);switch(c.Ba){case a.MS_TARGET_CONTROLS:v.oC(c.i,c.quat,c.Ub);v.correct_up(b,R.AXIS_Y);break;case a.MS_EYE_CONTROLS:b.pb||v.correct_up(b,R.AXIS_Y)}n(b)};a.Dp=n;a.SB=C;a.WB=G;a.XD=F;a.rotate_eye_camera=E;a.rotate_target_camera=u;a.rotate_hover_camera=B;a.vA=t;a.CG=function(b){switch(b.type){case a.Pb:case a.Zc:case a.Bb:case a.Gb:return!0;
default:return!1}};a.Jz=function(b){b=b.f.L[0];switch(b.type){case a.Pb:case a.ge:case a.Bb:case a.Gb:return Math.PI*b.Ic/180;default:return ga.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.Ef=y;a.Ym=q;a.Iq=w;a.iz=H;a.gx=function(a){a=a.f;var b=L.nd();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Hb=b;var c=L.Wk(1,[0,0,0]);a.ad=c;a.Lm=L.cr(1,b);a.Nm=L.er(1,b);a.Mm=L.dr(1,b)};a.is_camera=z;a.is_target_camera=function(b){return z(b)&&b.f&&b.f.Ba==a.MS_TARGET_CONTROLS?
!0:!1};a.is_eye_camera=function(b){return z(b)&&b.f&&b.f.Ba==a.MS_EYE_CONTROLS?!0:!1};a.is_hover_camera=Q;a.Cp=P;a.Hy=M;a.project_point=function(b,c,d){b=b.f.L[0];switch(b.type){case a.Pb:case a.ge:case a.Zc:case a.We:case a.Bb:case a.Gb:var e=J;e.set(c);e[3]=1;pa.transformMat4(e,b.Ed,e);c=-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;N.AE(d[0],d[1],d,b);2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+1)/2);return d;default:return ga.error("Non-compatible camera"),d}};a.Wz=function(a){return a.f.L[0]};
a.kl=function(b,c){switch(b.type){case a.Pb:case a.ge:case a.Bb:case a.Gb:var d=Math.tan(R.Xl(b.Ic)/2);switch(c){case "LEFT":return-d*b.Ca;case "RIGHT":return d*b.Ca;case "TOP":return d;case "BOTTOM":return-d}break;case a.Zc:case a.We:switch(c){case "LEFT":return-b.top*b.Ca;case "RIGHT":return b.top*b.Ca;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.Yf:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;default:R.ja("Unknown camera type")}};
a.JA=function(b){switch(b.type){case a.Zc:case a.We:case a.Yf:return!0;default:return!1}};a.get_fov=function(b,c){switch(b.type){case a.Pb:case a.ge:case a.Bb:case a.Gb:var d=R.Xl(b.Ic);return c?d*b.Ca:d;default:return 0}}};b4w.module.__lights=function(a,r){function d(a){b.scale(a.color,a.Bh,a.Rk)}r("__print");var c=r("__util"),b=r("__vec3"),l=new Float32Array(3);a.NA=function(a,m){var k=a.data,p=m.Ia={name:"",type:k.type,qt:new Float32Array(3),direction:new Float32Array(3),color:new Float32Array(3),Rk:new Float32Array(3),pr:0,Ne:0,ak:0,Mr:!1,Ts:!1,ur:!1,Di:!0,hh:!0,Bh:1,distance:25,TF:"INVERSE_SQUARE"};p.name=m.name;p.Di=k.use_diffuse;p.hh=k.use_specular;var e=c.quat_to_dir(m.f.quat,c.AXIS_Y,l);b.normalize(e,e);p.direction.set(e);
p.color[0]=k.color[0];p.color[1]=k.color[1];p.color[2]=k.color[2];p.Bh=p.pr=k.energy;d(p);p.distance=k.distance;if("POINT"===p.type||"SPOT"===p.type)p.distance=k.distance;"SPOT"===p.type?(p.ak=k.spot_blend,p.Ne=k.spot_size):"POINT"===p.type&&(p.Ne=Math.PI/2);p.Mr=k.b4w_generate_shadows;p.ur=k.b4w_dynamic_intensity};a.CC=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];d(a)};a.EC=function(a,b){a.ak=b};a.DC=function(a,b){a.distance=b};a.FC=function(a,b){a.Ne=b};a.Mt=function(a,b){a.Bh=
b;d(a)};a.xl=function(a){return"LAMP"===a.type};a.TD=function(a){if("LAMP"!=a.type)throw"Wrong light object";var d=a.Ia;if(d){c.quat_to_dir(a.f.quat,c.AXIS_Y,d.direction);b.normalize(d.direction,d.direction);if("SUN"==d.type){a=Math.acos(b.dot(d.qt,c.bq));var l=Math.acos(b.dot(d.direction,c.bq));d.Ts=Math.floor(a/.025)!=Math.floor(l/.025)?!0:!1}b.copy(d.direction,d.qt)}}};b4w.module.__scenes=function(a,r){function d(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c.Gd||!c.Gd.length)return c}return null}function c(){if(!nb)throw"No active scene available";return nb}function b(a,b){for(var c=0;c<b.length;c++)b[c].k&&b[c].k.Qh&&a.k.jk.push(b[c])}function l(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&l(e.objects,b,c)}}function f(a,b,c){if(!xa.hj||!m(a,b,c))return null;a=a.b4w_shadow_settings;c={};a.csm_resolution>xa.Tb?
(c.csm_resolution=xa.Tb,ib.error("Shadow map texture has unsupported size. Changed to "+xa.Tb+".")):c.csm_resolution=a.csm_resolution;c.self_shadow_polygon_offset=a.self_shadow_polygon_offset;c.self_shadow_normal_offset=a.self_shadow_normal_offset;c.enable_csm=a.b4w_enable_csm;if(b=ta.Pn(b)||b[0])c.Cg=b.Ia.type,c.Ne=b.Ia.Ne,c.distance=b.Ia.distance,"SPOT"!=c.Cg&&"POINT"!=c.Cg||!c.enable_csm||(ib.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),c.enable_csm=!1);c.enable_csm?
(c.csm_num=a.csm_num,c.csm_first_cascade_border=a.csm_first_cascade_border,c.first_cascade_blur_radius=a.first_cascade_blur_radius,c.csm_last_cascade_border=a.csm_last_cascade_border,c.last_cascade_blur_radius=a.last_cascade_blur_radius,c.fade_last_cascade=a.fade_last_cascade,c.blend_between_cascades=a.blend_between_cascades):(c.csm_num=1,c.csm_first_cascade_border=a.csm_first_cascade_border,c.first_cascade_blur_radius=a.first_cascade_blur_radius,c.csm_last_cascade_border=a.csm_last_cascade_border,
c.last_cascade_blur_radius=a.last_cascade_blur_radius,c.fade_last_cascade=!1,c.blend_between_cascades=!1);return c}function m(a,b,c){if(xa.Yj)switch(a.b4w_render_shadows){case "OFF":return!1;case "ON":return!0}else return!1;var d=!1,e=!1;a=xa.Oe&&a.b4w_enable_ssao;if(0==b.length&&!a)return!1;for(b=0;b<c.length;b++){var f=c[b].J;f.b4w_shadow_cast&&(d=!0);f.b4w_shadow_receive&&(e=!0);if((a||d)&&e)return!0}return!1}function k(a){for(var b=0;b<a.length;b++)if("SUN"==a[b].Ia.type)return!0;return!1}function p(a){if(!xa.shore_smoothing)return!1;
a=ma(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}function e(a){for(var b=0;b<a.length;b++)for(var c=a[b].J.particle_systems,d=0;d<c.length;d++){var e=c[d].settings;if(e.b4w_enable_soft_particles&&0<e.b4w_particles_softness)return!0}return!1}function g(a){for(var b=ma(a),c=[],d=0;d<b.length;d++){var e=b[d];if(e.b4w_water){for(var f={},g=0;g<a.length;g++)for(var h=a[g].J,l=h.data.materials,k=0;k<l.length;k++)l[k]==e&&(f.Uf=h.location[1]);f.ac=
e.b4w_water_fog_color.slice(0);f.ac.push(e.b4w_water_fog_density);e.b4w_water_dynamic?(f.lj=!0,f.waves_height=e.b4w_waves_height,f.waves_length=e.b4w_waves_length,f.dst_noise_scale0=e.b4w_water_dst_noise_scale0,f.dst_noise_scale1=e.b4w_water_dst_noise_scale1,f.dst_noise_freq0=e.b4w_water_dst_noise_freq0,f.dst_noise_freq1=e.b4w_water_dst_noise_freq1,f.dir_min_shore_fac=e.b4w_water_dir_min_shore_fac,f.dir_freq=e.b4w_water_dir_freq,f.dir_noise_scale=e.b4w_water_dir_noise_scale,f.dir_noise_freq=e.b4w_water_dir_noise_freq,
f.dir_min_noise_fac=e.b4w_water_dir_min_noise_fac,f.dst_min_fac=e.b4w_water_dst_min_fac,f.waves_hor_fac=e.b4w_water_waves_hor_fac):(f.lj=!1,f.waves_height=0,f.waves_length=0);f.oe=e.b4w_water_enable_caust;f.Cx=e.b4w_water_caust_scale;f.Bx=e.b4w_water_caust_brightness;f.Dx=new Float32Array([.3,.7]);f.gm=null;e=e.texture_slots;for(g=0;g<e.length;g++)h=e[g].texture,!0===h.b4w_shore_dist_map&&(f.gm=h.image,f.ki=h.image.size[0],f.TC=h.b4w_shore_boundings,f.Vh=h.b4w_max_shore_dist);c.push(f)}}if(0<c.length){f=
c[0];if(!f.lj)for(d=0;d<c.length;d++)c[d].lj&&(f=c[d]);return f}return null}function h(a){function b(a){if(a){a=a.nodes;for(var d=0;d<a.length;d++){var e=a[d];"GROUP"==e.type&&e.node_group&&b(e.node_group.node_tree);"GROUP"==e.type&&"B4W_REFRACTION"==e.node_tree_name&&(c.sc=!0)}}}var c={sc:!1};a=ma(a);for(var d=0;d<a.length;d++){var e=a[d];e.b4w_refractive&&(c.sc=!0);e.node_tree&&b(e.node_tree)}return c}function n(a,b){if(xa.$l)switch(a.b4w_render_reflections){case "OFF":return!1}else return!1;for(var c=
[],d=0,e=0;e<b.length;e++){var f=b[e];f.f.rc&&"CUBE"==f.f.Vd&&d++;if(f.Vj.length){for(var g=null,h=0;h<c.length;h++)if(c[h]==f){g=h;break}null==g&&c.push(f)}}return{At:c,bt:d,ef:[],Bf:[]}}function C(a,b){var c=a.b4w_sky_settings,d={};d.fC=c.render_sky;d.procedural_skydome=c.procedural_skydome&&b;d.use_as_environment_lighting=c.use_as_environment_lighting;d.li=c.color;d.rayleigh_brightness=c.rayleigh_brightness;d.mie_brightness=c.mie_brightness;d.spot_brightness=c.spot_brightness;d.scatter_strength=
c.scatter_strength;d.rayleigh_strength=c.rayleigh_strength;d.mie_strength=c.mie_strength;d.rayleigh_collection_power=c.rayleigh_collection_power;d.mie_collection_power=c.mie_collection_power;d.mie_distribution=c.mie_distribution;d.gc=c.reflexible;d.Vb=c.reflexible_only;!b&&c.procedural_skydome&&ib.warn("There is no sun on the scene. Procedural sky won't be rendered");return d}function G(a){var b={};a=a.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.tA=a.hemisphere;b.tx=a.blur_depth;b.Cq=
a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;b.rC=a.samples;return b}function F(a){if(!(xa.Hk&&a.b4w_enable_bloom&&a.k.eh))return null;var b={};a=a.b4w_bloom_settings;b.blur=a.blur;b.Yy=a.edge_lum;b.key=a.key;return b}function E(a){var b={};a=a.b4w_motion_blur_settings;b.mb_decay_threshold=a.motion_blur_decay_threshold;b.mb_factor=a.motion_blur_factor;return b}function u(a){var b={};a=a.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=
a.exposure;b.saturation=a.saturation;return b}function B(a){var b={};a=a.b4w_god_rays_settings;b.fo=a.intensity;b.Uh=a.max_ray_length;b.ui=a.steps_per_pass;return b}function A(a){var b={};b.zf=a.b4w_outline_color;b.Lj=a.b4w_outline_factor;return b}function t(a){var b={};a=a.b4w_glow_settings;b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b}function y(a,
b){var c=a.light_settings,d={};d.jf=c.environment_energy;d.Hp=c.use_environment_light;d.yn=c.environment_color;d.pf=a.horizon_color.slice(0);d.Xf=a.zenith_color.slice(0);d.tE=a.use_sky_paper;d.sE=a.use_sky_blend;d.uE=a.use_sky_real;d.au=null;d.dp=null;d.zn=null;if(d.Hp&&"SKY_TEXTURE"==d.yn&&(!b.procedural_skydome||!b.use_as_environment_lighting)){for(var c=null,e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_environment_lighting){c=a.texture_slots[e];break}c?d.zn=c:(ib.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),
d.Hp=!1)}for(e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_skydome){c=a.texture_slots[e];d.au=c;d.dp={qx:c.blend_factor,uA:c.horizon_factor,JE:c.zenith_up_factor,IE:c.zenith_down_factor,color:c.color,Ga:c.default_value,invert:c.invert,rE:c.use_rgb_to_intensity,rx:c.blend_type,nE:c.use_map_blend,oE:c.use_map_horizon,qE:c.use_map_zenith_up,pE:c.use_map_zenith_down};break}return d}function q(a){var b=a.fog_settings,c={};c.jE=b.use_fog;c.fo=b.intensity;c.depth=b.depth;c.start=
b.start;c.height=b.height;c.lz=b.falloff;c.color=b.use_custom_color?b.color.slice(0):a.horizon_color.slice(0);a=c.color;c.ac=new Float32Array([a[0],a[1],a[2],1/c.depth]);c.il=new Float32Array([c.fo,c.depth,c.start,c.height]);return c}function w(a){if(!xa.Db)return!1;for(var b=!1,c=!1,d=0;d<a.length;d++){for(var e=a[d].J,f=e.data.materials,g=0;g<f.length;g++)f[g].b4w_terrain&&(b=!0);e=e.particle_systems;for(g=0;g<e.length;g++)f=e[g].settings,"HAIR"==f.type&&f.b4w_dynamic_grass&&(c=!0);if(b&&c)return!0}return!1}
function H(a,b){if(Bc.outlining_overview_mode)return!0;if(xa.enable_selectable)switch(a.b4w_enable_object_selection){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c].f.bh)return!0;return!1}else return!1}function z(a,b){if(Bc.outlining_overview_mode)return!0;if(xa.enable_outlining)switch(a.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c].f.Lb)return!0;return!1}else return!1}function Q(a,b){if(xa.nf)switch(a.b4w_enable_glow_materials){case "OFF":return!1;
case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)for(var d=b[c].J.data.materials,e=0;e<d.length;e++)if(Hc.Pq(d[e]))return!0;return!1}else return!1}function P(a,b){if(xa.sc)switch(a.b4w_render_refractions){case "OFF":return!1;case "ON":return!0;case "AUTO":return b.sc}else return!1}function M(a){for(var b=0;b<a.length;b++)for(var c=a[b].J.data.materials,d=0;d<c.length;d++){var e=c[d],f=e.game_settings.alpha_blend;if(e.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f)return!0}return!1}function I(a,
b){switch(a.b4w_enable_anchors_visibility){case "OFF":return!1;case "ON":return!0}for(var c=0;c<b.length;c++){var d=b[c];if(d.anchor&&d.anchor.yh)return!0}return!1}function L(a,b,c){var d=ja.Pg(a,b);ja.Re(a,d,function(a,b,d){if(d.Za){switch(d.W){case "COLOR":case "CUBEMAP":a=b.j.ob;break;case "DEPTH":a=b.j.cd;break;case "SCREEN":a=null;break;case "MAIN_CUBE_REFLECT":return;default:throw"Wrong slink";}switch(d.xa){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "u_cube_reflection":case "u_plane_reflection":break;
default:if(!a)throw"Connection of SCREEN is forbidden";if(a.Sf)throw"Batch texture can't use renderbuffer";oa.Rq(c.hc,d.xa)&&x.sh(c,a,d.xa)}}});for(a=0;a<b.ra.length;a++){var d=b.ra[a],e=b.ae[a];switch(d.xa){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(e.Sf)throw"Batch texture can't use renderbuffer";oa.Rq(c.hc,d.xa)&&x.sh(c,e,d.xa)}}}function v(a,b){return{bb:!0,vn:[!0,!0,!0,!0,!0,!0],xd:a,D:b}}function N(a,b,c,d,e,f){for(var g=b.f,h=ta.Ha(b,
e).S,l=0;l<h.length;l++){var k=h[l];k.uc||k.Vb||"MAIN"!=k.type&&"NODES_GLOW"!=k.type&&"PARTICLES"!=k.type||!("OPAQUE"==k.Ra&&"OPAQUE"==d||"BLEND"==k.Ra&&"BLEND"==d||"XRAY"==k.Ra&&"XRAY"==d||"NODES_GLOW"==k.type&&"GLOW"==d)||(f||(T(k,a,b,c,d,e),x.rb(k),U(k)),a.o.push(v(g,k)),L(c,a,k),ga(k))}a.o.sort(function(a,b){var c;if(a.D&&b.D){c=a.D.Fa;var d=b.D.Fa;(c=c==d?0:c>d?1:-1)||(c=a.D.Rg,d=b.D.Rg,c=c==d?0:c>d?1:-1)}else c=0;return c})}function T(a,b,c,d,e,f){var g=c.f,h=ta.Ha(c,f),l="NO_SHADOWS";if((c=
ka.Va(d,"SHADOW_CAST"))&&a.vc){switch(e){case "OPAQUE":l="SHADOW_MAPPING_OPAQUE";break;case "BLEND":case "XRAY":l="SHADOW_MAPPING_BLEND";break;case "COLOR_ID":case "REFLECT":case "GLOW":l="NO_SHADOWS";break;case "DEPTH":l="SHADOW_MASK_GENERATION";break;default:throw"Wrong subscene type";}x.qq(a,f.k.Yb,c)}c=a.Wa;oa.I(c,"SHADOW_USAGE",l);a.Db&&(l=ka.Va(d,"GRASS_MAP"))&&S(a,l,g);if("DEPTH"!=a.type&&"COLOR_ID"!=e||a.Mh)if(e=b.wf,oa.I(c,"NUM_LIGHTS",e),oa.I(c,"NUM_LFACTORS",0==e%2?e/2:Math.floor(e/2)+
1),"special_skydome.glslf"==oa.Ur(c)&&oa.I(c,"REFLECTION_PASS",0),oa.I(c,"SSAO_ONLY",0),b.nb&&b.Fd?oa.I(c,"WATER_EFFECTS",1):oa.I(c,"WATER_EFFECTS",0),b.nb&&b.oe&&g.oe?(oa.I(c,"CAUSTICS",1),oa.I(c,"CAUST_SCALE",oa.r(b.Kq)),oa.I(c,"CAUST_SPEED",oa.r(b.Lq,2)),oa.I(c,"CAUST_BRIGHT",oa.r(b.Jq))):oa.I(c,"CAUSTICS",0),b.nb&&(oa.I(c,"WAVES_HEIGHT",oa.r(b.Vf)),oa.I(c,"WAVES_LENGTH",oa.r(b.nh)),oa.I(c,"WATER_LEVEL",oa.r(b.Uf))),g=h.ef,h=h.Bf,-1!==a.Nb.indexOf("u_mirrormap")?oa.I(c,"REFLECTION_TYPE","REFL_MIRRORMAP"):
a.rc&&g?(g=g.j.ob,x.sh(a,g,"u_cube_reflection"),oa.I(c,"REFLECTION_TYPE","REFL_CUBE")):a.rc&&h?(g=h.j.ob,x.sh(a,g,"u_plane_reflection"),oa.I(c,"REFLECTION_TYPE","REFL_PLANE")):oa.I(c,"REFLECTION_TYPE","REFL_NONE"),(h=ka.Va(d,"SKY"))?a.st?(g=h.j.ob,x.sh(a,g,"u_sky")):xa.Vl?(a.Dc=h.Dc,oa.I(c,"PROCEDURAL_FOG",1)):oa.I(c,"PROCEDURAL_FOG",0):oa.I(c,"PROCEDURAL_FOG",0),g=f.k.Sp,g.Hp&&(oa.I(c,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==g.yn?(g=g.zn?x.Nz(g.zn,!1):h.j.ob,oa.I(c,"SKY_TEXTURE",1),x.sh(a,g,"u_sky_texture")):
"SKY_COLOR"==g.yn&&oa.I(c,"SKY_COLOR",1)),g=f.k.$u,g.jE&&(oa.I(c,"USE_FOG",1),oa.I(c,"FOG_TYPE",g.lz)),a.Uo?(xa.hj&&oa.I(c,"USE_REFRACTION_CORRECTION",1),"MAIN"==a.type&&a.Mh||"NODES_GLOW"==a.type?(oa.I(c,"REFRACTIVE",1),f.k.sc?oa.I(c,"USE_REFRACTION",1):oa.I(c,"USE_REFRACTION",0)):f.k.sc?oa.I(c,"REFRACTIVE",1):oa.I(c,"REFRACTIVE",0)):(oa.I(c,"REFRACTIVE",0),oa.I(c,"USE_REFRACTION",0),oa.I(c,"USE_REFRACTION_CORRECTION",0)),a.Tf&&(xa.shore_smoothing&&a.tm&&ka.Va(d,"DEPTH")?oa.I(c,"SHORE_SMOOTHING",
1):oa.I(c,"SHORE_SMOOTHING",0),a.water_dynamic&&b.nb&&b.Vf?oa.I(c,"DYNAMIC",1):oa.I(c,"DYNAMIC",0)),"PARTICLES"==a.type&&(oa.I(c,"SIZE_RAMP_LENGTH",a.qa.Vt),oa.I(c,"COLOR_RAMP_LENGTH",a.qa.Xq)),!a.sg)for(a=a.R,b=0;b<a.length;b++)if(g=a[b],"SCENE"==g.source)for(d=0;d<Ra.length;d++)for(c=Ra[d],h=Ra[d].Gd,e=0;e<h.length;e++)h[e].k==g&&ja.n(bc,c,f,null)}function U(a){var b=a.hc.attributes,c=a.P.Mb,d;for(d in b)c[d]||za.ja('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES_GLOW"==a.type)if(b=
oa.jA(a.hc.Op),10<b&&("MAIN"==a.type&&ib.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.Jc.join(", ")+'"'),"MAIN"==a.type&&a.Mh||"NODES_GLOW"==a.type))d=c=0,a.ih&&(c=za.Rd(a.ih)),a.zb&&(d=za.Rd(a.zb)),ib.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.Jc.join(", ")+'"')}function ga(a){8<a.R.length&&ib.warn(a.type,"too many textures used - "+a.R.length+' (max 8), materials "'+a.Jc.join(", ")+'"')}function S(a,b,c){a.mc=b.mc;var d=b.mc[0],
e=b.mc[1],f=b.mc[2];c=c.Hb;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,c);b.mc[2]=f;b=b.j;ra.em(b,f/2,-e,-d,f/2);ra.Ef(b);d=a.Tn||0;d=0==d?c:Math.max(d,c);a.Tn=d}function Y(a){var b=D(a,"MAIN_OPAQUE"),c=!0,d=a.k.Yb;ja.V(a.k.mb,function(a,e){"SHADOW_CAST"===e.type&&(R(e,b.j,e.o,d,c),c=!1)})}function ca(a){ja.V(a.k.mb,function(a,b){"OUTLINE"===b.type&&(b.wn=1)})}function R(a,b,c,d,e){if(0!=c.length){var f=a.j;mb.copy(b.kf,f.kf);eb.copy(b.ya,f.St);if("SUN"===d.Cg||"HEMI"===d.Cg){var g=
Ta;da.nd(g);for(var h=0;h<c.length;h++){var l=c[h].xd;0==h?da.Uk(l.kb,g):da.wr(g,l.kb)}c=da.hz(g,cb);za.Cf(c,f.ya,c);if(d.enable_csm){d=mb.copy(b.cj[a.ln],Sb);g=eb.invert(b.ya,Rb);za.Cf(d,g,d);za.Cf(d,f.ya,d);a=b.mn[a.ln];if(e)for(fb=0,ac=-Infinity,e=2;e<c.length;e+=3)fb=Math.min(fb,c[e]),ac=Math.max(ac,c[e]);e=Ta;e.max_x=d[0]+a;e.max_y=d[1]+a;e.max_z=ac;e.min_x=d[0]-a;e.min_y=d[1]-a;e.min_z=fb}else{a=e=Ta;b=Ka;b.set(c);c=Kc/9;d=eb.identity(Rb);eb.rotate(d,c,za.AXIS_MZ,d);h=g=-1;for(l=0;10>l;l++){var k=
da.nx(b,Kb),x=(k.max_x-k.min_x)*(k.max_y-k.min_y);if(-1==g||x<g)g=x,h=l,da.Uk(k,a);za.Cf(b,d,b)}c*=h;0<c&&(a=eb.identity(Rb),eb.rotate(a,c,za.AXIS_MZ,a),eb.multiply(a,f.ya,f.ya));c=e.max_x-e.min_x;a=e.max_y-e.min_y;c&&a&&(b=Math.abs(c-a)/2,2<c/a?(e.max_y+=b,e.min_y-=b):2<a/c&&(e.max_x+=b,e.min_x-=b));e.max_x+=.005;e.max_y+=.005;e.max_z+=.005;e.min_x-=.005;e.min_y-=.005;e.min_z-=.005}ra.zC(f,e.min_x,e.max_x,e.min_y,e.max_y,-e.max_z,-e.min_z);ra.Ef(f);za.gl(f.Ed,f.tj)}else"SPOT"!==d.Cg&&"POINT"!==d.Cg||
ra.Ef(f,f.Ca)}}function V(a,b,c,d,e){for(var f=b.f,g=ta.Ha(b,d).S,h=0;h<g.length;h++){var l=g[h];"COLOR_ID"==l.type&&(e||(T(l,a,b,c,"COLOR_ID",d),x.rb(l),U(l)),"COLOR_PICKING"==a.type&&"COLOR_ID"==l.Ra||"COLOR_PICKING_XRAY"==a.type&&"COLOR_ID_XRAY"==l.Ra)&&(e||(x.wa(l,"USE_OUTLINE",0),x.rb(l),U(l)),a.o.push(v(f,l)))}}function pa(a,b,c,d,e){d||(e.Db&&(d=ka.Va(c,"GRASS_MAP"))&&S(e,d,b),x.rb(e),U(e));a.o.push(v(b,e));L(c,a,e);ga(e)}function ha(a,b){for(var c=fa(b,Qb),d=a.Ia,e=a.f,f=ta.Ha(a,b),g=f.Gj,
h=0;h<c.length;h++){var l=c[h];l.sf.set(e.i,3*g);l.Fg.set(d.direction,3*g);l.Eg.set(d.Rk,3*g);switch(d.type){case "SUN":l.ru.set(e.quat);l.qu=d.Rk;"SKY"===l.type?(l.El=d.Ts,mb.copy(d.direction,l.op),qa(b,l)):mb.copy(d.direction,l.op);break;case "HEMI":case "POINT":case "SPOT":break;default:ib.error("Unknown light type: "+d.type+'".')}var k=Hb;k[0]=d.Di?1:0;k[1]=d.hh?1:0;l.Gg.set(k,2*g);l.va=!0;for(k=0;k<l.o.length;k++){var m=l.o[k].D;m.Dg&&x.BC(m,a)}}c=D(b,"MAIN_OPAQUE").j;f=f.Tt;d=b.k.Yb;for(h=0;h<
f.length;h++)l=f[h],ra.Pt(l.j,e.i,e.quat),R(l,c,l.o,d,!0)}function qa(a,b){ic.kj(b);if(b.El)for(var c=fa(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_GLOW"]),d=0;d<c.length;d++)for(var e=c[d].o,f=0;f<e.length;f++){var g=e[f];g.bb&&(g=g.D,x.Gx(g)&&ic.KD(g))}}function ma(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].J.data,e=0;e<d.materials.length;e++){var f=d.materials[e];-1==b.indexOf(f)&&b.push(f)}return b}function aa(a,b,c){for(var d=a.k,e=a.Zf.f.L,f=0;f<e.length;f++){var g=e[f];ra.Ef(g,
b/c);d.Yb&&ra.Cp(g,d.Yb)}d.Yb&&(d.Fl=!0,D(a,"DEPTH").va=!0,D(a,"MAIN_BLEND").va=!0);var h=d.mb;ka.BD(h,function(d,e,f){if(d.Ci){var g=d.Jf*b,l=d.Jf*c;if(e)for(e=0;e<f.ra.length;e++)f.ra[e]==d&&kc.resize(d.Aa,g,l);else switch(kc.Ej(d.Aa)&&kc.resize(d.Aa,g,l),d=f.j,d.width=g,d.height=l,f.type){case "DOF":O(a,{dof_power:f.j.dof_power,dof_on:f.j.dof_on});break;case "GLOW_COMBINE":J(a,{small_glow_mask_width:f.small_glow_mask_width,large_glow_mask_width:f.large_glow_mask_width});break;case "BLOOM":ba(a,
{bloom_blur:f.bloom_blur});break;case "OUTLINE":f=ka.Ma(h,f,"POSTPROCESSING");g=ka.Ma(h,f,"POSTPROCESSING");l=ka.Ma(h,g,"POSTPROCESSING");d=ka.Ma(h,l,"POSTPROCESSING");ka.Qc(f,1/b,1/c);ka.Qc(g,1/b,1/c);ka.Qc(l,1/b,1/c);ka.Qc(d,1/b,1/c);break;default:ka.Qc(f,1/b,1/c)}}})}function fa(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];ja.V(a.k.mb,function(a,b){b.type==e&&c.push(b)})}return c}function D(a,b){return ka.Va(a.k.mb,b)}function O(a,b){var c=D(a,"DOF");if(!c)return ib.error("DOF is not enabled on the scene. Check camera settings"),
0;var d=a.k.mb;"boolean"==typeof b.dof_on&&(c.j.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.j.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.j.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.j.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.j.dof_power=b.dof_power;var e=ka.Ma(d,c,"POSTPROCESSING"),d=ka.Ma(d,e,"POSTPROCESSING");ka.Xb(e,c.j.dof_power);ka.Qc(e,1/c.j.width,1/c.j.height);ka.Xb(d,c.j.dof_power);ka.Qc(d,1/c.j.width,1/c.j.height)}c.va=!0}
function ba(a,b){var c=D(a,"LUMINANCE_TRUNCED"),d=D(a,"BLOOM");if(!c||!d)return ib.error("Bloom is not enabled on the scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.va=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.va=!0);if("number"==typeof b.bloom_blur){var e=a.k.mb,c=ka.Ma(e,d,"BLOOM_BLUR"),e=ka.Ma(e,c,"BLOOM_BLUR");d.bloom_blur=b.bloom_blur;ka.Xb(c,b.bloom_blur);ka.Qc(c,1/d.j.width,1/d.j.height);ka.Xb(e,b.bloom_blur);ka.Qc(e,1/d.j.width,1/d.j.height)}}
function J(a,b){var c=D(a,"GLOW_COMBINE");if(!c)return ib.error("Glow is not enabled on the scene"),null;for(var d=a.k.mb,e=ka.Zz(d,c),f=0;f<e.length;++f){var g=e[f];if("POSTPROCESSING"===g.type&&"GLOW_MASK_LARGE"===g.Ra)var h=g;if("POSTPROCESSING"===g.type&&"GLOW_MASK_SMALL"===g.Ra)var l=g}e=ka.Ma(d,h,"POSTPROCESSING");d=ka.Ma(d,l,"POSTPROCESSING");"number"==typeof b.small_glow_mask_coeff&&(c.small_glow_mask_coeff=b.small_glow_mask_coeff,c.va=!0);"number"==typeof b.large_glow_mask_coeff&&(c.large_glow_mask_coeff=
b.large_glow_mask_coeff,c.va=!0);"number"==typeof b.small_glow_mask_width&&(c.small_glow_mask_width=b.small_glow_mask_width,ka.Xb(l,b.small_glow_mask_width),ka.Qc(l,1/c.j.width,1/c.j.height),l.va=!0,ka.Xb(d,b.small_glow_mask_width),ka.Qc(d,1/c.j.width,1/c.j.height),d.va=!0);"number"==typeof b.large_glow_mask_width&&(c.large_glow_mask_width=b.large_glow_mask_width,ka.Xb(h,b.large_glow_mask_width),ka.Qc(h,1/c.j.width,1/c.j.height),h.va=!0,ka.Xb(e,b.large_glow_mask_width),ka.Qc(e,1/c.j.width,1/c.j.height),
e.va=!0)}function va(a,b){var c=D(nb,"MAIN_OPAQUE");if(!c||!c.nb)return ib.error("get_water_surface_level() - no water parameters on the scene"),0;var d=c.Vf,e=c.nh,f=c.Uf,g=c.nb;if(!d||!g.lj)return g.Uf;var h=mb.length(c.Se),l=c.time;h&&(l*=h);var k=Hb;k[0]=20/e*(a-.25*l);k[1]=20/e*(b-.25*l);h=za.Mq(k);k[0]=17/e*(b+.1*l);k[1]=17/e*(a+.1*l);var k=za.Mq(k),h=h+k-1,x=g.dst_noise_scale0,k=g.dst_noise_scale1,m=g.dst_noise_freq0,n=g.dst_noise_freq1,K=Hb;K[0]=x*(a+m*l);K[1]=x*(b+m*l);x=za.ep(K);K[0]=k*
(b-n*l);K[1]=k*(a-n*l);k=za.ep(K);k*=d*x;if(c.qm)if(n=(a-c.Gf[0])/c.Hf[0],K=(c.Gf[1]+b)/c.Hf[1],n+=.5,K+=.5,1<n||0>n||1<K||0>K)d=k;else var n=za.Or(nb.k.ap,c.ki,n,K),x=g.dir_freq,p=g.dir_noise_scale,q=g.dir_noise_freq,m=g.dir_min_noise_fac,K=g.dst_min_fac,c=e/c.Vh/Math.PI,p=[p/e*(a+q*l),p/e*(b+q*l)],e=Math.sqrt(n),d=d*Math.max(n,g.dir_min_shore_fac)*Math.sin(e/c+x*l)*Math.max(za.ep(p),m),g=Math.max(e,K),d=d*(1-g)+k*g,h=h*n;else d=k;return f+(d+.05*h)}function na(a,b){a.Cj&&"POSTPROCESSING"==a.type&&
b.bb!=a.bb&&(a.bb=b.bb);b.bb||"OUTLINE"!=a.type||(a.wn=0)}function ia(a,b,c,d){var e=ja.Oa(a,b);ra.dm(e.j,c,d);e.Jm=!0;ja.Nf(a,b,function(b,e,f){f.Za&&f.W==c&&ka.Qx(f)&&ea(a,b,f.xa,d)});ja.Re(a,b,function(b,e,f){f.Za&&f.W==c&&f.W==f.xa&&ia(a,b,c,d)})}function ea(a,b,c,d){a=ja.Oa(a,b).o;for(b=0;b<a.length;b++)x.jC(a[b].D,d,c)}function Z(a){var b=D(a,"GRASS_MAP");if(b){var c=b.j,d=a.Zf.f,e=d.i;a=Sb;a[0]=0;a[1]=-b.mc[2]/2;a[2]=0;mb.transformQuat(a,d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=jb;b[0]=0;b[1]=
0;b[2]=0;b[3]=1;ra.Pt(c,a,b)}}function la(a,b){ja.V(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.ra[0]||!d.ae[0])throw"Wrong MOTION_BLUR subscene";var e=d.ra[0],f=d.ae[0];d.ae[0]=d.j.ob;ja.Nf(a,c,function(b,c,d){d.Za&&ea(a,b,d.xa,f)});ia(a,c,e.W,f);ea(a,c,e.xa,d.ae[0]);d.Ss=Math.exp(-b/d.mb_factor)}})}function K(a){return a.k.Se}var x=r("__batch"),da=r("__boundings"),ra=r("__camera"),X=r("__config"),Cb=r("__container");r("__constraints");var Gb=r("__debug"),wa=r("__geometry"),ja=r("__graph"),Gc=
r("__hud"),eb=r("__mat4"),Hc=r("__nodemat"),ta=r("__obj_util"),hc=r("__physics"),Pa=r("__prerender"),wc=r("__primitives"),ib=r("__print"),ic=r("__renderer"),ka=r("__scenegraph"),jc=r("__sfx"),oa=r("__shaders"),kc=r("__textures"),za=r("__util"),mb=r("__vec3"),gb=X.ke,xa=X.q,Bc=X.Lb,$b=X.gi,sb="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH OUTLINE_MASK WIREFRAME".split(" ");a.aF=sb;var Qb="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),
Nc="MAIN_OPAQUE SSAO MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Jc="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS OUTLINE_MASK WIREFRAME".split(" "),Rc="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Ic=0,Jb=null,nb=null,Ra=[],bc=null,Kc=Math.PI/2,Hb=new Float32Array(2),Sb=new Float32Array(3),jb=new Float32Array(4),Rb=new Float32Array(16),
cb=new Float32Array(24),Ka=new Float32Array(24),Ta=da.nd(),Kb=da.nd(),fb=0,ac=-Infinity;a.GF=function(){return{}};a.set_active=function(a){nb=a;jc.xC(a)};a.VB=function(a,b){var c=a.k,d=ka.uy(c.mb);if(a==b){aa(a,Cb.lA(),Cb.kA());for(var e=0;e<d.length;e++)a.k.Xg.push(d[e])}else for(e=a.Gd[0],aa(a,e.k.dh,e.k.dh),e=0;e<d.length;e++)b.k.Xg.push(d[e]);d=fa(a,Jc);for(e=0;e<d.length;e++)d[e].Se.set(c.Se);for(e=0;e<c.Xg.length;e++)"SHADOW_CAST"==c.Xg[e].type&&ic.kj(c.Xg[e])};a.wg=function(){Jb||(Jb=d(Ra));
return Jb};a.hl=d;a.get_active=c;a.ha=function(){return nb?!0:!1};a.xj=function(a){return a.Zf};a.Jh=function(){return Ra};a.bA=function(){if(1==Ra.length)return Ra;for(var a=0;a<Ra.length;a++){var b=Ra[a].k.mb;ja.V(b,function(b,c){for(var d=0;d<c.o.length;d++){for(var e=c.o[d].D.R,f=null,g=0;g<e.length;g++)if("SCENE"==e[g].source&&e[g].fp==Ra[a].name&&"COPY"!=c.type){ib.error('Texture-scene loop detected. A scene is rendered to texture "'+e[g].name+'" yet this texture belongs to the same scene.');
ja.Pg(bc,Ra[a]);f=c.o[d].D;break}f&&(f.R=[],f.Nb=[],x.JD(f,null),x.rb(f))}})}for(var c=[],a=0;a<Ra.length;a++)if(b=Ra[a],!b.Gd.length){b=ja.Pg(bc,b);ja.bz(bc,b);b=ja.mp(bc,b,ja.vm);b=ja.yp(b);ja.V(b,function(a,b){c.push(b)});break}return c};a.Nw=function(a,c,d,l,x,m){a.Gd=a.Gd||[];a.sa=null;var K=a.k,da=a.Zf.f;K.jk=[];b(a,c);c=a.world;K.OA=l.length;K.eh=k(l);K.im=C(c,K.eh);K.Sp=y(c,K.im);K.$u=q(c);K.Fw=I(a,m);da.L[0].type!=ra.Pb&&xa.anaglyph_use?(ib.warn("Anaglyph stereo is disabled for the non-perspective camera"),
m=!1):m=xa.anaglyph_use;K.anaglyph_use=m;K.di=n(a,d);K.sx=F(a);K.uB=E(a);K.Ex=u(a);K.nA=B(a);K.EB=A(a);K.of=t(a);K.Ah=xa.Ah&&(0<da.dof_distance||da.ue);K.Og=xa.Og&&a.b4w_enable_motion_blur;K.wh=xa.wh&&a.b4w_enable_color_correction;K.antialiasing=xa.antialiasing&&a.b4w_enable_antialiasing;K.Oe=xa.Oe&&a.b4w_enable_ssao;K.Kh=xa.Kh&&a.b4w_enable_god_rays&&K.eh;K.Ty=xa.hj;K.Sn=a.world.b4w_render_glow_over_blend;K.kD=G(a);m=h(x);K.rB=m;K.sc=P(a,m);K.Yb=f(a,l,x);K.nb=g(x);K.Ue=M(x);K.WC=e(x);K.shore_smoothing=
p(x);K.Db=w(x);K.Xx=H(a,x);K.outline=z(a,x);K.nf=Q(a,x);switch(a.b4w_reflection_quality){case "LOW":K.kg=$b.jr;K.Rj=$b.nt;break;case "MEDIUM":K.kg=$b.Jy;K.Rj=$b.OB;break;case "HIGH":K.kg=$b.Iy;K.Rj=$b.NB;break;default:K.kg=$b.jr,K.Rj=$b.nt}l=a.Gd.sort(function(a,b){return b.k.dh-a.k.dh});K.mb=ka.ty(K,da,l);K.Xg=[];K.Fl=!1;K.Co=!1;K.Do=!1;K.Se=new Float32Array(3);Ra.push(a);bc||(bc=ja.create());ja.u(bc,a);for(K=0;K<d.length;K++)ta.Zo(d[K],!0,a)};a.Ow=b;a.Yx=function(a){var b="ALL",c=[];l(a.objects,
b,c);return c};a.Vr=function(a){return a.k.mb};a.wz=function(a){ja.V(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=x.hr(c.Ul);break;case "SSAO":d=x.Ay(c);break;case "SSAO_BLUR":d=x.By(c);break;case "DEPTH_PACK":d=x.iy();break;case "REFRACT":case "COPY":d=x.hr("NONE");break;case "GOD_RAYS":ka.Ma(a,c,"WIREFRAME")||ka.Ma(a,c,"MAIN_BLEND")||ka.Ma(a,c,"GOD_RAYS");d=x.my(c.jt,c.Tf,c.ui);break;case "GOD_RAYS_COMBINE":ka.Ma(a,c,"WIREFRAME")||ka.Ma(a,c,"MAIN_BLEND");ka.Ma(a,c,"GOD_RAYS");
d=x.ny();break;case "MOTION_BLUR":d=x.qy();break;case "DOF":var d=x.jy(),e=ka.Ma(a,c,"POSTPROCESSING"),f=ka.Ma(a,e,"POSTPROCESSING");ka.Xb(e,c.j.dof_power);ka.Xb(f,c.j.dof_power);break;case "OUTLINE":var d=x.ry(),e=ka.Ma(a,c,"POSTPROCESSING"),f=ka.Ma(a,e,"POSTPROCESSING"),g=ka.Ma(a,f,"POSTPROCESSING"),h=ka.Ma(a,g,"POSTPROCESSING");ka.Xb(f,c.Rm);ka.Xb(e,c.Rm);ka.Xb(h,c.Cn*c.Lj);ka.Xb(g,c.Cn*c.Lj);break;case "GLOW_COMBINE":d=x.ly();break;case "COMPOSITING":d=x.gy();break;case "ANTIALIASING":d=x.cy();
break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=x.yy(c.type);break;case "ANAGLYPH":d=x.ay();break;case "SKY":d=x.sy();break;case "LUMINANCE":d=x.oy();break;case "AVERAGE_LUMINANCE":d=x.dy();break;case "LUMINANCE_TRUNCED":d=x.py();break;case "BLOOM_BLUR":d=x.ey();break;case "BLOOM":d=ka.Ma(a,c,"BLOOM_BLUR");e=ka.Ma(a,d,"BLOOM_BLUR");ka.Xb(d,c.bloom_blur);ka.Xb(e,c.bloom_blur);d=x.fy();break;case "VELOCITY":d=x.Ey();break;
case "ANCHOR_VISIBILITY":d=x.by()}d&&(e=v(ta.xh("NONE"),d),U(d),c.o.push(e),L(a,c,d),ga(d))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":var d=a.k.mb,e=b.f;!ka.Va(d,"SHADOW_CAST")&&e.vc&&(e.vc=!1);e=fa(a,sb);c&&(hc.K(b)&&hc.append_object(b,a),b.Mc&&b.parent&&b.parent.J.dupli_group.objects&&(b.Ho=b.name,b.parent.J.dupli_group.objects.push(b.J)));for(var f=0;f<e.length;f++){var g=e[f],h=b,l=d,k=a,m=c;switch(g.type){case "MAIN_OPAQUE":N(g,h,l,"OPAQUE",k,m);break;case "MAIN_BLEND":N(g,
h,l,"BLEND",k,m);break;case "MAIN_XRAY":N(g,h,l,"XRAY",k,m);break;case "MAIN_GLOW":N(g,h,l,"GLOW",k,m);break;case "MAIN_PLANE_REFLECT":case "MAIN_CUBE_REFLECT":for(var n=h.f,K=ta.Ha(h,k).S,p=0;p<K.length;p++){var q=K[p];if(("MAIN"==q.type||"PARTICLES"==q.type)&&"REFLECT"==q.Ra){if("MAIN_PLANE_REFLECT"==g.type){var da;a:{da=k.k.di.Bf;for(var t=0;t<da.length;t++)if(da[t]==g){da=t;break a}da=null}if(da==n.Nc)continue}else{a:{if(k.k.di)for(da=k.k.di.ef,t=0;t<da.length;t++)if(da[t]==g){da=t;break a}da=
null}if(da==n.bd)continue}m||(T(q,g,h,l,"REFLECT",k),da=q.Wa,oa.I(da,"DISABLE_FOG",0),oa.I(da,"WATER_EFFECTS",0),"special_skydome.glslf"==oa.Ur(da)&&oa.I(da,"REFLECTION_PASS",1),oa.I(da,"TEXTURE_NORM",0),x.rb(q),U(q));g.o.push(v(n,q))}}break;case "DEPTH":n=ta.Ha(h,k).S;for(K=0;K<n.length;K++)p=n[K],"DEPTH"!=p.type||p.uc||"DEPTH"!=p.Ra&&"NODES"!=p.Ra||(m||(T(p,g,h,l,"DEPTH",k),x.rb(p),U(p)),g.o.push(v(h.f,p)),L(l,g,p),ga(p));break;case "SHADOW_CAST":n=!1;K=h.f;h=ta.Ha(h,k).S;p=ka.Va(l,"GRASS_MAP");
for(q=0;q<h.length;q++)da=h[q],"DEPTH"==da.type&&"SHADOW_CAST"==da.Ra&&(n=!0,m||(oa.I(da.Wa,"SHADOW_USAGE","SHADOW_CASTING"),da.Db&&p&&S(da,p,K),x.wa(da,"SHADOW_TEX_RES",oa.r(k.k.Yb.csm_resolution)),x.rb(da),U(da)),g.o.push(v(K,da)));n&&(h=k.k.Yb,k=ka.Va(l,"MAIN_OPAQUE"),R(g,k.j,g.o,h,!0));break;case "COLOR_PICKING":V(g,h,l,k,m);break;case "COLOR_PICKING_XRAY":V(g,h,l,k,m);break;case "OUTLINE_MASK":l=h.f;h=ta.Ha(h,k).S;for(k=0;k<h.length;k++)n=h[k],"COLOR_ID"==n.type&&"OUTLINE"==n.Ra&&(m||(x.wa(n,
"USE_OUTLINE",1),x.rb(n),U(n)),g.o.push(v(l,n)));break;case "GRASS_MAP":l=h.f;h=ta.Ha(h,k).S;for(k=0;k<h.length;k++)n=h[k],"GRASS_MAP"==n.type&&(m||(x.rb(n),U(n)),g.o.push(v(l,n)),n=g.j,da=l.kb,K=g.mc[0],p=g.mc[1],q=g.mc[2],0==K&&0==p?(K=da.min_y,p=da.max_y):(K=Math.min(K,da.min_y),p=Math.max(p,da.max_y)),da=1E-4*(p-K),g.mc[0]=K-da,g.mc[1]=p+da,ra.em(n,q/2,-p,-K,q/2),ra.Ef(n));break;case "WIREFRAME":for(n=h.f,h=ta.Ha(h,k).S,k=0;k<h.length;k++)K=h[k],"WIREFRAME"==K.type&&pa(g,n,l,m,K)}}break;case "LAMP":ha(b,
a)}ta.Zo(b,!0,a)};a.$o=function(a){a.k.Fl=!0};a.Sz=function(a,b){for(var c=a.k.Yb,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=ra.Hy(c,b,e);return d};a.gF=pa;a.hide_object=function(a){a.f.Nh=!0};a.show_object=function(a){a.f.Nh=!1};a.is_hidden=function(a){return a.f.Nh};a.dC=function(a,b,c){b=b.f;a=fa(a,sb);for(var d=0;d<a.length;d++)for(var e=a[d].o,f=e.length-1;0<=f;f--){var g=e[f];g.xd==b&&(g.D&&c&&wa.Tq(g.D.P),e.splice(f,1))}};a.Of=ha;a.cleanup=function(){for(var a=0;a<Ra.length;a++){var b=
Ra[a];ja.V(b.k.mb,function(a,b){if("SINK"!=b.type){var c=b.j;ic.gC(c.ye,c.ob,c.cd,c.width,c.height);for(var c=b.o,d=0;d<c.length;d++){var e=c[d].D;e&&x.Wx(e)}}});b.k.mb=[];b.k.Xg=[]}nb=Jb=null;Ra.length=0;bc=null};a.Ns=function(a,b,c){a=ra.iz(a,a.fb,a.cb,null,!0);var d=wc.Bz(a);a=ta.xh("DYNAMIC");a.kb=a.Hb={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.Ib=a.ad=da.px();var e=a.Ib.Ja;a.bg=a.af=da.Vk([e,0,0],[0,e,0],[0,0,e],a.Ib.F);c=x.xy(d,c);b.o.push(v(a,c))};a.jG=function(a){return[a.frame_start,
a.frame_end]};a.Qt=function(a,b,c){Cb.QC(a,b,c);nb&&aa(nb,a,b)};a.pu=fa;a.da=D;a.get_environment_colors=function(a){a=fa(a,Qb)[0];var b=a.pf,c=a.Xf,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.jf,d,e]};a.set_environment_colors=function(a,b,c,d){a=fa(a,Qb);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.jf=b);c&&f.pf.set(c);d&&f.Xf.set(d);f.va=!0}};a.get_sky_params=function(a){if(a=D(a,"SKY")){var b={};b.color=Array(3);mb.copy(a.li,b.color);b.procedural_skydome=
a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=
D(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.li.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&
(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.va=!0,c.El=!0,qa(a,c))};a.get_fog_color_density=
function(a,b){var c=b||[],d=fa(a,Nc)[0].ac;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=fa(a,Nc),d=0;d<c.length;d++){var e=c[d];e.ac.set(b);e.va=!0}};a.get_ssao_params=function(a){var b=D(a,"SSAO");a=D(a,"SSAO_BLUR");if(!b)return null;var c=b.o[0].D,d={};d.ssao_quality=x.Eb(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.Cq=a.ssao_blur_discard_value;d.radius_increase=b.qi;d.influence=b.pi;d.dist_factor=
b.oi;d.ssao_only=b.ssao_only;d.ssao_white=x.Eb(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=D(a,"SSAO"),d=D(a,"SSAO_BLUR");if(!c)return ib.error("SSAO is not enabled on the scene"),0;if("string"==typeof b.ssao_quality){var e=c.o[0].D;x.wa(e,"SSAO_QUALITY",b.ssao_quality);x.rb(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.o[0].D,x.wa(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),x.rb(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.o[0].D,x.wa(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),
x.rb(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.qi&&(c.qi=b.qi);"number"==typeof b.pi&&(c.pi=b.pi);"number"==typeof b.oi&&(c.oi=b.oi);if("number"==typeof b.ssao_only){c=D(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var f=0;f<c.o.length;f++)e=c.o[f].D,x.wa(e,"SSAO_ONLY",b.ssao_only),x.rb(e,!0)}"number"==typeof b.ssao_white&&(e=c.o[0].D,x.wa(e,"SSAO_WHITE",b.ssao_white),x.rb(e,!0));c.va=!0;d.va=!0};a.get_dof_params=function(a){a=
D(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.j.dof_distance;b.dof_front=a.j.dof_front;b.dof_rear=a.j.dof_rear;b.dof_power=a.j.dof_power;b.ue=a.j.ue;return b};a.set_dof_params=O;a.get_god_rays_params=function(a){var b=fa(a,["GOD_RAYS"]);a=D(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].Uh;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=x.Eb(b[0].o[0].D,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=fa(a,["GOD_RAYS"]),
d=D(a,"GOD_RAYS_COMBINE");if(!c||!d)return ib.error("God Rays are not enabled on the scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].Uh=e,c[f].Yl=e/c[f].ui/(f+1),c[f].va=!0;if("number"==typeof b.god_rays_steps)for(var g=oa.r(b.god_rays_steps,1),e=c[0].Uh,f=0;f<c.length;f++){c[f].ui=g;c[f].Yl=e/g/(f+1);c[f].va=!0;var h=c[f].o[0].D;x.wa(h,"STEPS_PER_PASS",
g);x.rb(h,!0)}d.va=!0};a.get_bloom_params=function(a){var b=D(a,"LUMINANCE_TRUNCED");a=D(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=ba;a.get_glow_material_params=function(a){a=D(a,"GLOW_COMBINE");if(!a)return null;var b={};b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=
a.large_glow_mask_width;return b};a.set_glow_material_params=J;a.get_wind_params=function(a){a=K(a);var b=mb.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.uC=function(a){a.k.Co=!0};a.get_water_surface_level=va;a.get_water_mat_params=function(a,b){var c=D(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.Vf,b.waves_length=c.nh,c.Fd)){b.water_fog_density=c.Fd[3];var d=b.water_fog_color=[];d[0]=c.Fd[0];d[1]=c.Fd[1];d[2]=c.Fd[2]}};a.set_water_params=
function(a,b){var c=D(a,"MAIN_OPAQUE");if(!c||!c.nb)return ib.error("set_water_params() - no water parameters on the scene"),null;c=c.nb;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);
"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.lj=b.water_dynamic);for(var d=fa(a,Rc),e=0;e<d.length;e++){var f=
d[e];"number"==typeof b.water_fog_density&&c.ac&&(f.Fd[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.ac&&f.Fd.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.Vf=b.waves_height);"number"==typeof b.waves_length&&(f.nh=b.waves_length);f.va=!0}};a.get_shore_dist=function(a,b){var c=D(nb,"MAIN_OPAQUE");if(!c.qm)return 100;var d=c.Vh,e=c.Uf,f=(a[0]-c.Gf[0])/c.Hf[0],g=(c.Gf[1]+a[2])/c.Hf[1],f=f+.5,g=g+.5;if(1<f||0>f||1<g||0>g)e=1;else return c=d*za.Or(nb.k.ap,c.ki,f,g),e=(e-a[1])*
b,e=Math.sqrt(c*c+e*e)};a.update=function(a,b){for(var d=c().Zf.f,e=0;e<Ra.length;e++){var f=Ra[e],g=f.k.mb,h=f.k;if(h.nb)var l=d.i[1]-va(d.i[0],d.i[2]);for(var k=h.jk,f=0;f<k.length;f++){var m=k[f].k,x=m.Xa,n=m.Hh+m.ia;if(x){var K=Math.round(x.currentTime*m.lc),p=m.ia/m.lc;if(K<m.ia-(xa.Bg?5:0)||k[f].k.fh&&K>n)x.currentTime=p;!m.fh&&K>n&&x.pause();2<=x.readyState&&!x.paused&&kc.cE(m)}else if(m.hi){x=Math.min(m.hi.length,m.Hh+m.ia);if(m.Ke<m.ia||m.fh&&m.Ke>=x)m.Ke=m.ia;!m.fh&&m.Ke>=x&&(m.ii=!1);x=
Math.round(a*gb.Na/m.lc)*m.Lt;x!=Ic&&m.ii&&(kc.$D(m),m.Ke++);Ic=x}}ja.V(g,function(b,c){-1<Jc.indexOf(c.type)&&(c.time=a);h.nb&&(c.Zm=l)})}for(e=0;e<Ra.length;e++)if(f=Ra[e],h=f.k,g=h.mb,d=h.Xg,d.length)for(h.Fl&&(Y(f),h.Fl=!1),h.Co&&(Z(f),h.Co=!1),h.Do&&(ca(f),h.Do=!1),h.Og&&la(g,b),g=ka.Va(g,"OUTLINE_MASK"),f=0;f<d.length;f++)k=d[f],Pa.No(k),g&&na(k,g),ic.kj(k);xa.show_hud_debug_info&&Gc.UC(Ra,b)};a.kC=function(a){a.k.Do=!0};a.Nn=function(a){var b=[];ja.V(a.k.mb,function(a,c){b.push(c)});return b};
a.get_cam_water_depth=function(){var a=D(nb,"MAIN_BLEND"),b=nb;return a||b.k.nb?a.Zm:null};a.get_object_data_id=function(a){return a.f.kc};a.Fp=function(a){ja.V(a.k.mb,function(a,b){b.va=!0})};a.OC=function(a,b){switch(b){case "WM_NONE":a.bb=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.o.length;c++)a.o[c].D.wireframe_mode=Gb.cq[b];a.bb=!0}a.Fa="WM_TRANSPARENT_WIREFRAME"==b;a.va=!0};a.NC=function(a,b){for(var c=
0;c<a.o.length;c++)a.o[c].D.wireframe_edge_color=b,a.va=!0};a.SD=function(a,b){var c=b.Dh,d=a.k.Se;if(c&&"WIND"==c.type&&d){za.quat_to_dir(b.f.quat,za.AXIS_Y,d);mb.normalize(d,d);mb.scale(d,c.mu,d);for(var c=fa(a,Jc),e=0;e<c.length;e++)c[e].Se.set(d)}};a.HB=function(a,b,c){var d=D(a,"COLOR_PICKING");if(d)return b=Cb.$m(b,c,Hb,d.j),Pa.No(d),ic.kj(d),(a=D(a,"COLOR_PICKING_XRAY"))?(Pa.No(a),ic.kj(a),d=a.j):d=d.j,b[1]=d.height-b[1],ic.zt(d.ye,b[0],b[1]);ib.error("Object Selection is not available on the scene");
return null};a.set_outline_color=function(a){var b=c();if(b=D(b,"OUTLINE"))b.zf.set(a),b.va=!0};a.nG=K;a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};a.Bu=function(a,b){var c=Sb;mb.negate(b,c);for(var d=0;6>d;d++){var e=a.dj[d],f=a.nn[d],g=a.j;eb.translate(za.dv[d],c,e);eb.multiply(g.za,e,g.Ed);za.gl(g.Ed,f)}};a.Eu=function(a,b,c){za.zD(b,c,za.AXIS_Y,a.j.fc)};a.ix=function(a,b,c){var d=a.k.Yb,e=a.k.di;
c=ta.Pn(c)||c[0];for(var f=0;f<b.length;f++){var g=b[f],h=ta.Ha(g,a);if(e)if(null!=g.f.Nc){var l=e.Bf;if(l.length){var k=g.f.Nc;h.Bf=l[k]}}else null!=g.f.bd&&(l=e.ef,l.length&&(k=g.f.bd,h.ef=l[k]));d&&g==c&&(h.Tt=fa(a,["SHADOW_CAST"]))}};a.marker_frame=function(a,b){return a.timeline_markers[b]}};b4w.module.__physics=function(a,r){function d(a,b){for(var c=a.rd,e=0;e<c.length;e++)c[e].zd.hk&&b.push(c[e]),d(c[e],b)}function c(a,b,c){for(var d=a.Ya.o,e=0;e<d.length;e++)for(var f=d[e].m,g=0;g<f.jc.length;g++){var h=f.jc[g];"ANY"!=h.ab&&c!=h.ab||A(h,a,b)}}function b(a,b,c){if(v.tl(a))switch(b){case v.mv:var d=l(a);d.Ya.Zu=!0;v.A(a,v.Uv,Date.now()-performance.now(),ha.wd,ha.Xm?qa.Gr:0);break;case v.nv:U.uo("URANIUM:",c.slice(1));break;case v.iv:U.error(c);break;case v.jv:L.fbmsg.apply(this,c.slice(1));
break;case v.sv:var e=f(c.v);if(e){a=c.i;d=c.quat;b=c.Sd;var g=c.Hd,e=e.m;e.Zk=c.time;ca.set_sep(a,1,d,e.on);V.copy(b,e.Sd);V.copy(g,e.Hd)}break;case v.pv:(a=f(c.an))&&ca.set_sep(c.i,1,c.quat,a.l.Tj[c.Po]);break;case v.kv:if(d=f(c[1]))a=c[4],d=d.fd.Ik[c[2]],Y.set_translation(d,c[3]),Y.set_rotation(d,a),Y.p(d);break;case v.tv:if(e=f(c[1]))e.l.speed=c[2];break;case v.ev:d=l(a);m(d,c.cg,c.dg,c.result,null,null,0);break;case v.gv:d=l(a);m(d,c.cg,c.dg,c.result,c.hg,c.coll_norm,c.coll_dist);break;case v.fv:if(e=
f(c[1]))a=e.m,a.gg&&a.gg(c[2]);break;case v.Xp:case v.qv:d=l(a);if(a=d.Ya.Df[c.id])if(d=f(c.uh),b==v.Xp)b=a.callback,b(a.id,c.hit_fract,d,c.hit_time);else{b=c.hit_fract;var g=c.hit_time,e=c.hit_pos,h=a.callback;e?h(a.id,b,d,g,e,c.hit_norm):h(a.id,b,d,g)}break;case v.rv:q(id);break;case v.ov:a=fa.indexOf(a);console.log("Physics #"+a+" Ping: OUT "+(c[2]-c[1]).toFixed(3)+" ms, IN "+(performance.now()-c[2]).toFixed(3)+" ms, ALL "+(performance.now()-c[1]).toFixed(3)+" ms");break;case v.lv:aa=c[1];break;
case v.hv:a=fa.indexOf(a);console.log("Worker: #"+String(a));console.log(c[1]);break;default:U.error("Wrong message: "+b)}}function l(a){for(var b=0;b<fa.length;b++)if(fa[b]==a)return D[b]}function f(a){return O[a]||null}function m(a,b,c,d,e,g,h){a=a.Ya.o;for(var l=0;l<a.length;l++)for(var m=a[l].m,n=0;n<m.jc.length;n++){for(var K=m.jc[n],p=K.Af,q=!1,t=0;t<p.length;t++){var D=p[t];if(D[0]===b&&D[1]===c){K.Mj[t]=d;q=!0;break}}q&&(p=k(K),e&&K.Sm!=b&&(q=e,t=g,D=h,q[0]+=t[0]*D,q[1]+=t[1]*D,q[2]+=t[2]*
D,t[0]*=-1,t[1]*=-1,t[2]*=-1),K.callback(p,p?K.Sm==b?f(c):f(b):null,e,g,h))}}function k(a){a=a.Mj;for(var b=!1,c=0;c<a.length;c++)b=b||a[c];return b}function p(){va.body++;return va.body}function e(a){if("ANY"==a)return 0;var b=J.indexOf(a);return-1==b?(J.push(a),J.length-1):b}function g(a){return{v:a,Td:0,vl:!1,If:!0,nc:!1,is_character:!1,DA:!1,Tk:null,ab:"",Yi:0,AF:{},jc:[],gg:null,Zk:0,on:new Float32Array([0,0,0,1,0,0,0,1]),Sd:new Float32Array(3),Hd:new Float32Array(3),Nk:new Float32Array(3),Mk:new Float32Array(4)}}
function h(a,b){switch(a){case "BOX":var c=b.Hb;break;case "CYLINDER":c=b.Nm;break;case "CONE":c=b.Mm;break;case "SPHERE":c=b.ad;break;case "CAPSULE":c=b.Lm}return c}function n(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.F&&(b.center=
a.F);"number"===typeof a.Ja&&(b.radius=a.Ja);"number"===typeof a.height&&(b.height=a.height);return b}function C(a,b,c,d,e){var f=a.f.i,g=b.f.Y,h=new Float32Array(16);N.invert(g,h);g=new Float32Array(3);V.transformMat4(f,h,g);switch(b.l.type){case 10:b=b.xc;a=a.f.Hb;v.A(e,v.xv,c,g,b.uD,b.Wo,(a.max_y-a.min_y)/2,d);break;case 20:v.A(e,v.wv,c,g,a.eH)}}function G(a){return a.m&&a.m.Tk}function F(a,b,c,d,e,f,g,h,l,k){var m;va.pb++;m=va.pb.toString(16);var n=b.m.v;v.A(E(n),v.Ev,m,a,h,n,c,d,e.m.v,f,g,l,
k);b.m.Tk=m}function E(a){for(var b=0;b<D.length;b++)for(var c=D[b].Ya.o,d=0;d<c.length;d++)if(c[d].m.v==a)return fa[b];return null}function u(a){var b=a.m;if(b&&(0===b.Td||!0===b.vl||!1===b.If||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.f.i[0]!=a.m.Nk[0]||a.f.i[1]!=a.m.Nk[1]||a.f.i[2]!=a.m.Nk[2]||a.f.quat[0]!=a.m.Mk[0]||a.f.quat[1]!=a.m.Mk[1]||a.f.quat[2]!=a.m.Mk[2])){var b=a.m,c=a.f;V.copy(c.i,b.Nk);ga.copy(c.quat,b.Mk);var d=v.Xr(v.rk);d.v=b.v;d.i=c.i;"DYNAMIC"==b.type?ga.identity(d.quat):
d.quat=c.quat;v.A(E(b.v),v.rk)}a=a.rd;for(b=0;b<a.length;b++)u(a[b])}function B(a,b,c,d,e){e=e||new Float32Array(3);a=a.f.quat;e[0]=b;e[1]=c;e[2]=d;V.transformQuat(e,a,e)}function A(a,b,c){var d=a.Af,e=a.Mj,f=a.Sm,g=[],h=a.ab;if(!g)throw"At least one destination required";for(var l=0;l<b.Ya.o.length;l++){var k=b.Ya.o[l];if("ANY"==h||k.m.ab==h)k=k.m.v,g&&-1==g.indexOf(k)&&g.push(k)}for(b=0;b<g.length;b++)h=g[b],f<h&&!t(d,f,h)?(d.push([f,h]),e.push(!1)):f>h&&!t(d,h,f)&&(d.push([h,f]),e.push(!1));v.A(c,
v.vv,f);v.A(c,v.Dv,d,a.Nd)}function t(a,b,c){for(var d=0;d<a.length;d++)if(a[d][0]==b&&a[d][1]==c)return!0;return!1}function y(a){a.m&&a.m.gg&&(a=a.m,v.A(E(a.v),v.Qv,a.v),a.gg=null)}function q(a){var b=H(a),c=w(a).Ya;c.Df[a]&&(delete c.Df[a],c.To.splice(c.To.indexOf,1),v.A(b,v.Zv,a))}function w(a){for(var b=0;b<D.length;b++){var c=D[b];if(c.Ya.Df[a])return c}return null}function H(a){for(var b=0;b<D.length;b++)if(D[b].Ya.Df[a])return fa[b];return null}function z(a,b,c){if(b.ti){a=a.m.v;var d=b.Ch*
b.qj,e=b.Ti*b.Ui,f=-b.ri*b.si*2*Math.PI/b.bk;b.zj&&(f*=-1);switch(b.type){case 10:v.A(c,v.lw,a,d,e,f);break;case 20:v.A(c,v.kw,a,d,e,f)}}}function Q(a){return a.nc&&"CHASSIS"==a.xc.pc}function P(a){return a.nc&&"HULL"==a.xc.pc}function M(a){return a.Ag&&"MAIN_BODY"==a.Eh.pc}var I=r("__config");r("__constraints");var L=r("__debug"),v=r("__ipc"),N=r("__mat4"),T=r("__obj_util"),U=r("__print"),ga=r("__quat");r("__renderer");var S=r("__scenes"),Y=r("__transform"),ca=r("__tsr"),R=r("__util"),V=r("__vec3"),
pa=r("__version"),ha=I.m,qa=I.q,ma=I.Id,aa=0,fa=[],D=[],O={},ba=[],J=[],va={body:0,pb:0,wt:0},na=new Float32Array(3),ia=new Float32Array(4),ea=new Float32Array(4),Z=new Float32Array(16),la=new Float32Array(8),K=new Float32Array(8);a.yA=function(a){a.Ya={Zu:!1,o:[],Df:{},To:[]};var c=ha.fk;ma.Oo&&(c+=pa.timestamp());U.log("%cLOAD PHYSICS","color: #0a0",ha.rm?"Using Separate Worker Thread,":"Using Same Thread,","Max FPS: "+ha.wd);U.log("%cPHYSICS PATH","color: #0a0",c);var d=v.Fy(c,!ha.rm);v.kx(d,b);
fa.push(d);D.push(a);ha.ping&&setInterval(function(){v.A(d,v.Wv,performance.now())},1E3)};a.Rx=function(a){return a.Ya?a.Ya.Zu:!0};a.cleanup=function(){for(var a=0;a<fa.length;a++)v.terminate(fa[a]);fa.length=0;D.length=0;O={};ba.length=0;J.length=0;for(var b in va)va[b]=0};a.append_object=function(a,b){if(!a.f)throw"No object render: "+a.name;var f;a:{for(var l=0;l<D.length;l++)if(D[l]==b){f=fa[l];break a}f=void 0}var k=[];a.zd.hk&&d(a,k);var m=b.Ya.o;if(Q(a)||P(a)||a.is_character||M(a)||a.Ei){var K,
q=a,t=f,r=q.J,A=q.f,u=q.zd,y=u.Tl,w=p();if("CAMERA"==q.type)var J=u.Gp?u.Pk:"BOX",B=h(J,A),E=A.sj,I=A.nj,E=.5,I=0;else"EMPTY"==q.type?(J="EMPTY",B=null,I=E=0):(J=u.Gp?u.Pk:"BOX",B=h(J,A),E=A.sj,I=A.nj);var H=A.i,L=A.quat,va=u.ik,na=u.Ku,ia=u.Td,Y=u.Pu,ca=u.Ou,aa=u.qn,$b=u.Yo,ha=r.b4w_collision_id,la=e(ha),Nc=u.Zi,Jc=u.Xi,Rc=u.$i,Ic=A.ad.Ja,Jb=n(B),nb=r.b4w_correct_bounding_offset,Ra;var bc=J;if(k.length){var Kc=[],Hb={};Hb.quat=new Float32Array([0,0,0,1]);Hb.trans=new Float32Array(3);Hb.worker_bounding=
Jb;Hb.bounding_type=bc;Kc.push(Hb);N.invert(A.Y,Z);ga.invert(A.quat,ea);for(var Sb=0;Sb<k.length;Sb++){var jb={},Rb=k[Sb],cb=Rb.zd.Pk,Ka=new Float32Array(4),Ta=new Float32Array(3);V.transformMat4(Rb.f.i,Z,Ta);ga.multiply(ea,Rb.f.quat,Ka);jb.trans=Ta;jb.quat=Ka;jb.bounding_type=cb;jb.worker_bounding=n(h(cb,Rb.f));Kc.push(jb)}Ra=Kc}else Ra=[];v.A(t,v.Av,w,H,L,y,va,na,ia,Y,ca,aa,$b,la,Nc,Jc,Rc,J,Jb,Ic,E,I,Ra,nb);O[w]=q;ba.push(q);var ma=g(w);ma.type=y;ma.Td=ia;ma.vl=va;ma.ab=ha;ma.Yi=la;K=ma;a.m=K;var fb=
{D:null,m:K};m.push(fb);c(b,f,K.ab)}else for(var qa=T.Ha(a,b).S,Ea=0;Ea<qa.length;Ea++){var ua=qa[Ea],pa;if(pa="PHYSICS"==ua.type){var wb;a:{for(var ya=b.Ya.o,Ua=0;Ua<ya.length;Ua++){var W=ya[Ua].D;if(W&&W.id==ua.id){wb=!0;break a}}wb=!1}pa=!wb}if(pa)if(ua.Tc.O)if(ua.Tf&&b.k.nb){var Ia=ua,Ba=b,Ca=f,Aa=S.da(Ba,"MAIN_OPAQUE");v.A(Ca,v.Jv,Aa.Uf);if(Aa.nb&&Ia.EE){var Na={};Na.dst_noise_scale0=Ia.dst_noise_scale0;Na.dst_noise_scale1=Ia.dst_noise_scale1;Na.dst_noise_freq0=Ia.dst_noise_freq0;Na.dst_noise_freq1=
Ia.dst_noise_freq1;Na.dir_min_shore_fac=Ia.dir_min_shore_fac;Na.dir_freq=Ia.dir_freq;Na.dir_noise_scale=Ia.dir_noise_scale;Na.dir_noise_freq=Ia.dir_noise_freq;Na.dir_min_noise_fac=Ia.dir_min_noise_fac;Na.dst_min_fac=Ia.dst_min_fac;Na.waves_hor_fac=Ia.waves_hor_fac;var cc=Aa.Vf,Qa=Aa.nh;Aa.qm?v.A(Ca,v.Zp,Na,Aa.Hf[0],Aa.Hf[1],Aa.Gf[0],Aa.Gf[1],Aa.Vh,cc,Qa,Aa.ki,Ba.k.ap):v.A(Ca,v.Zp,Na,0,0,0,0,0,cc,Qa,0,null)}}else{var Ib;if(ua.ik){var vb=a,lb=ua,pc=f,kb=p(),dc=lb.Tc,db=dc.B[0].a_position,xc=dc.na||
null,ob=lb.ab,xb=e(ob);v.A(pc,v.Gv,kb,db,xc,vb.f.i,xb,lb.Zi,lb.Xi,lb.$i);var La=g(kb);La.vl=!0;La.ab=ob;La.Yi=xb;Ib=La}else{var Wa=a,Za=ua,Tb=f,ec=p(),Xa=Za.Tc,Dc=Xa.B[0].a_position,yc=Xa.na||null,yb=Wa.f.i,qc=Za.sj,Db=Za.nj,pb=Za.ab,qb=e(pb);v.A(Tb,v.Iv,ec,Dc,yc,yb,qc,Db,qb,Za.Zi,Za.Xi,Za.$i);var Da=g(ec);Da.ab=pb;Da.Yi=qb;Ib=Da}K=Ib;fb={D:ua,m:K};m.push(fb);c(b,f,K.ab)}else U.error("Object "+a.name+" has collision material with no assigned vertices")}if(Q(a)||P(a)){var Fa=a,sa=f,$a=Fa.m.v;Q(Fa)?
(Fa.l.type=10,v.A(sa,v.Bv,$a,Fa.l.pp,Fa.l.rp,Fa.l.qp,Fa.l.Rp,Fa.l.xo)):P(Fa)&&(Fa.l.type=20,v.A(sa,v.zv,$a,Fa.l.rg,Fa.l.lh,Fa.l.mh));if(Fa.l.Wg){var Ga=Fa.l.Wg;switch(Fa.l.type){case 10:C(Ga[1],Fa,$a,!0,sa);C(Ga[0],Fa,$a,!0,sa);C(Ga[3],Fa,$a,!1,sa);C(Ga[2],Fa,$a,!1,sa);break;case 20:for(var tb=0;tb<Ga.length;tb++)C(Ga[tb],Fa,$a,!1,sa)}}z(a,a.l,f)}else if(a.is_character){var Oa=f,zb=a.f,ab=a.m,lc=zb.Hb.max_y-zb.Hb.min_y,Ub=ab.v,Va=a.Nq,mc=Va.DE,rc=Va.qC,fc=Va.lD,Eb=Va.MA,hb=Va.FE,bb=R.Vy(a);v.A(Oa,
v.Cv,Ub,bb,lc,mc,rc,fc,Eb,hb);ab.is_character=!0}else if(M(a)){var Ha=a,Fb=f,Ma=Ha.m.v;v.A(Fb,v.Fv,Ma,Ha.fd.rg,Ha.fd.lh,Ha.fd.mh);if(Ha.fd.Ik)for(var Vb=Ha.fd.Ik,ub=0;ub<Vb.length;ub++){var Ab=Vb[ub],Lb=Ab.f.i,Mb=Ha.f.Y,Sa=new Float32Array(16);N.invert(Mb,Sa);var zc=new Float32Array(3);V.transformMat4(Lb,Sa,zc);v.A(Fb,v.yv,Ma,zc,Ab.ux)}Ha.m.DA=!0}for(Ea=0;Ea<ba.length;Ea++)if(a=ba[Ea],a.m){var Wb=a;if(!G(Wb))for(var gc=0;gc<Wb.Lo.length;gc++){var rb=Wb.Lo[gc],Xb=rb.target,sc=rb.JB;if(Xb.m){var Yb=
new Float32Array([rb.KB,rb.LB,rb.MB]),Nb,tc=new Float32Array([rb.Jd,rb.Kd,rb.Ld]);Nb=R.euler_to_quat(tc,new Float32Array(4));var nc=N.fromRotationTranslation(Nb,Yb,new Float32Array(16)),Oc=N.multiply(Wb.f.Y,nc,new Float32Array(16)),uc=N.invert(Xb.f.Y,new Float32Array(16)),Zb=N.multiply(uc,Oc,uc),Bb=R.Th(Zb),Ec=R.matrix_to_quat(Zb),Ya=rb,Ja={};Ja.use_limit_x=Ya.kE;Ja.use_limit_y=Ya.lE;Ja.use_limit_z=Ya.mE;Ja.use_angular_limit_x=Ya.fE;Ja.use_angular_limit_y=Ya.gE;Ja.use_angular_limit_z=Ya.hE;Ja.limit_max_x=
Ya.WA;Ja.limit_min_x=Ya.ZA;Ja.limit_max_y=Ya.XA;Ja.limit_min_y=Ya.$A;Ja.limit_max_z=Ya.YA;Ja.limit_min_z=Ya.aB;Ja.limit_angle_max_x=Ya.QA;Ja.limit_angle_min_x=Ya.TA;Ja.limit_angle_max_y=Ya.RA;Ja.limit_angle_min_y=Ya.UA;Ja.limit_angle_max_z=Ya.SA;Ja.limit_angle_min_z=Ya.VA;F(sc,Wb,Yb,Nb,Xb,Bb,Ec,Ja,null,null)}}}};a.nz=f;a.update=function(a,b){for(var c=0;c<fa.length;c++){var d=fa[c],e=a;d&&v.ws(d)&&v.A(d,v.mw,e,b);for(var f=0;f<ba.length;f++){var g=ba[f],h=g.m;if(h.If&&h.Zk){var l=v.ws(d)?e-h.Zk:performance.now()/
1E3-h.Zk,l=Math.min(l,10/ha.wd),l=l-1/ha.wd;qa.zB&&(l=0);var k=la;ca.zA(h.on,l,h.Sd,h.Hd,la);Y.set_tsr(g,k);Y.p(g);u(g);if(g.l)for(var h=g,l=h.l.Wg,k=h.f.Ka,m=la,n=0;n<l.length;n++){var K=l[n];ca.multiply(k,h.l.Tj[n],m);Y.set_tsr(K,m);Y.p(K)}g.l&&g.l.ti&&(h=g.l,l=h.ti)&&(k=g.l.ju,K=Z,m=g.f.i,n=g.f.quat,R.Ap(g.l.ku,n,m,K),R.Th(K,l.f.i),R.matrix_to_quat(K,l.f.quat),K=ia,R.Bp(k,n,m,K),k=ea,ga.setAxisAngle(K,-h.ri*h.si*2*Math.PI,k),ga.multiply(k,l.f.quat,l.f.quat),Y.p(l));g.l&&g.l.ip&&(h=g.l,l=h.ip)&&
(m=g.l.fu,k=Z,n=g.f.i,K=g.f.quat,R.Ap(g.l.gu,K,n,k),R.Th(k,l.f.i),R.matrix_to_quat(k,l.f.quat),k=ia,R.Bp(m,K,n,k),m=ea,n=Math.abs(h.speed)*h.Zj,n>h.Wh&&(n=h.Wh),ga.setAxisAngle(k,-n,m),ga.multiply(m,l.f.quat,l.f.quat),Y.p(l));g.l&&g.l.sp&&(h=g.l,l=h.sp)&&(k=g.l.tu,K=Z,m=g.f.i,n=g.f.quat,R.Ap(g.l.uu,n,m,K),R.Th(K,l.f.i),R.matrix_to_quat(K,l.f.quat),g=ia,R.Bp(k,n,m,g),k=ea,ga.setAxisAngle(g,-Math.abs(h.Ch)*h.gj,k),ga.multiply(k,l.f.quat,l.f.quat),Y.p(l))}}v.RB(d);d=S.da(D[c],"MAIN_OPAQUE");d.nb&&0<
d.nb.waves_height&&(e=V.length(d.Se),v.A(fa[c],v.jw,d.time*e))}};a.Iz=function(){return D[0]};a.pause=function(){for(var a=0;a<fa.length;a++)v.A(fa[a],v.Vv)};a.resume=function(){for(var a=0;a<fa.length;a++)v.A(fa[a],v.$v)};a.enable_simulation=function(a){a=a.m;if(!a)throw"No object physics";if(!a.If){var b=a.v,c=E(b);a.If=!0;v.A(c,v.Tv,b)}};a.disable_simulation=function(a){a=a.m;if(!a)throw"No object physics";if(a.If){var b=a.v,c=E(b);a.If=!1;v.A(c,v.Sv,b)}};a.cm=function(a){return Boolean(a.Ya)};
a.K=function(a){return Boolean(a.m)};a.has_dynamic_physics=function(a){return(a=a.m)&&a.If&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.Td&&0==a.vl?!0:!1};a.has_simulated_physics=function(a){return(a=a.m)&&a.If?!0:!1};a.set_gravity=function(a,b){var c=a.m.v;v.A(E(c),v.iw,c,b)};a.rA=G;a.apply_constraint=F;a.clear_constraint=function(a){a=a.m;v.A(E(body_a),v.Yv,a.Tk);a.Tk=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,g){c=ca.create_sep(c,1,d,la);f=ca.create_sep(f,1,g,K);ca.invert(c,c);ca.multiply(f,
c,c);Y.get_tsr(e,f);ca.multiply(f,c,c);Y.set_tsr(b,c);Y.p(b);a.set_transform(b,b.f.i,b.f.quat)};a.set_transform=function(a,b,c){var d=a.m;ca.set_sep(a.f.i,1,a.f.quat,d.on);a=v.Xr(v.rk);a.v=d.v;a.i=b;a.quat=c;v.A(E(d.v),v.rk)};a.sync_transform=u;a.apply_velocity=function(a,b,c,d){B(a,b,c,d,na);a=a.m.v;b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(na[0]),f=Math.abs(na[1]),g=Math.abs(na[2]);na[0]=e?na[0]/e*Math.max(e,b):0;na[1]=f?na[1]/f*Math.max(f,c):0;na[2]=g?na[2]/g*Math.max(g,d):0;v.A(E(a),
v.aq,a,na[0],na[1],na[2])};a.apply_velocity_world=function(a,b,c,d){a=a.m.v;v.A(E(a),v.aq,a,b,c,d)};a.apply_force=function(a,b,c,d){B(a,b,c,d,na);a=a.m.v;v.A(E(a),v.Kv,a,na[0],na[1],na[2])};a.apply_torque=function(a,b,c,d){B(a,b,c,d,na);a=a.m.v;v.A(E(a),v.Mv,a,na[0],na[1],na[2])};a.set_character_move_dir=function(a,b,c){a=a.m.v;v.A(E(a),v.cw,a,b,c)};a.set_character_move_type=function(a,b){var c=a.m.v;v.A(E(c),v.dw,c,b)};a.set_character_walk_velocity=function(a,b){var c=a.m.v;v.A(E(c),v.hw,c,b)};a.set_character_run_velocity=
function(a,b){var c=a.m.v;v.A(E(c),v.fw,c,b)};a.set_character_fly_velocity=function(a,b){var c=a.m.v;v.A(E(c),v.aw,c,b)};a.character_jump=function(a){a=a.m.v;v.A(E(a),v.Ov,a)};a.character_rotation_inc=function(a,b,c){a=a.m.v;v.A(E(a),v.Pv,a,b,c)};a.set_character_rotation=function(a,b,c){a=a.m.v;v.A(E(a),v.ew,a,b,c)};a.set_character_rotation_h=function(a,b){var c=a.m.v;v.A(E(c),v.bw,c,b)};a.set_character_rotation_v=function(a,b){var c=a.m.v;v.A(E(c),v.gw,c,b)};a.append_collision_test=function(a,b,
c,d){var e=a.m,f=e.v;b=b||"ANY";for(var g=0;g<e.jc.length;g++)if(a=e.jc[g],a.ab==b&&a.callback==c)return;a={Sm:f,Nd:d||!1,ab:b,callback:c,Af:[],Mj:[]};e.jc.push(a);b=E(f);A(a,l(b),b)};a.remove_collision_test=function(a,b,c){a=a.m;for(var d=E(a.v),e=l(d),f=0;f<a.jc.length;f++){var g=a.jc[f];if(g.ab==b&&g.callback==c){if(k(g)){var h=V.set(0,0,0,na);g.callback(!1,null,h,h,0)}a.jc.splice(f,1);f--;for(var h=d,g=g.Af,m=e.Ya.o,n=0;n<m.length;n++)for(var K=m[n].m,p=0;p<K.jc.length;p++)for(var q=K.jc[p],t=
0;t<q.Af.length;t++)for(var D=q.Af[t],C=0;C<g.length;C++){var r=g[C];D[0]==r[0]&&D[1]==r[1]&&(g.splice(C,1),C--)}g.length&&v.A(h,v.$p,g)}}};a.apply_collision_impulse_test=function(a,b){a.m&&a.m.gg&&y(a);var c=a.m;v.A(E(c.v),v.Lv,c.v);c.gg=b};a.clear_collision_impulse_test=y;a.append_ray_test=function(a,b,c,d,f,g,h,k,m){var n;va.wt++;n=va.wt;d=d||"ANY";a={id:n,v:a?a.m.v:0,W:new Float32Array(b),xa:new Float32Array(c),ab:d,Yi:e(d),wq:g,xx:h,Nd:k,pl:m,callback:f};b=E(a.v)||fa[0];c=l(b).Ya;n=a.id;c.Df[n]=
a;c.To.push(a);v.A(b,v.Hv,a.id,a.v,a.W,a.xa,a.Yi,a.wq,a.xx,a.Nd,a.pl);return n};a.remove_ray_test=q;a.change_ray_test_from_to=function(a,b,c){var d=H(a),e=w(a).Ya.Df[a];e&&!e.wq&&(e.W.set(b),e.xa.set(c),v.A(d,v.Nv,a,b,c))};a.xs=function(a){return w(a).Ya.Df[a]?!0:!1};a.vehicle_throttle=function(a,b){var c=a.l;c.Ch=b;z(a,c,E(a.m.v))};a.vehicle_steer=function(a,b){var c=a.l;c.ri=b;z(a,c,E(a.m.v))};a.vehicle_brake=function(a,b){var c=a.l;c.Ti=b;z(a,c,E(a.m.v))};a.is_vehicle_chassis=Q;a.is_vehicle_hull=
P;a.CA=function(a){if(!a.nc)return!1;a=a.xc.pc;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.AA=function(a){return a.nc?"BOB"==a.xc.pc?!0:!1:!1};a.EA=function(a){return a.Ag?"BOB"==a.Eh.pc?!0:!1:!1};a.As=function(a){return a.nc&&"STEERING_WHEEL"==a.xc.pc?!0:!1};a.zs=function(a){return a.nc&&"SPEEDOMETER"==a.xc.pc?!0:!1};a.Bs=function(a){return a.nc&&"TACHOMETER"==a.xc.pc?!0:!1};a.get_vehicle_speed=function(a){return a.l.speed};a.HE=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;
case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=function(a){return a.is_character};a.DG=M;a.Xz=function(){return aa};a.Ny=function(){for(var a=0;a<fa.length;a++)v.A(fa[a],v.Rv)};a.cC=function(a){var b=ba.indexOf(a);-1==b&&U.error("Object "+a.name+" doesn't have bounding physics");for(var c=a.m.v,d=E(c),e=l(d),f=e.Ya.o,g=[],h=0;h<f.length;h++)for(var m=f[h].m,n=0;n<m.jc.length;n++)for(var K=m.jc[n],p=0;p<K.Af.length;p++){var q=K.Af[p],
t=K.Mj[p];if(q[0]==c||q[1]==c)K.Af.splice(p,1),K.Mj.splice(p,1),p--,t&&!k(K)&&(t=V.set(0,0,0,na),K.callback(!1,null,t,t,0)),g.push(q)}g.length&&v.A(d,v.$p,g);a.m&&a.m.gg&&y(a);delete O[c];ba.splice(b,1);a=e.Ya.o;for(b=0;b<a.length;b++)a[b].m.v==c&&(a.splice(b,1),b--);v.A(d,v.Xv,c)}};b4w.module.__data=function(a,r){function d(a,b){jc[b.id]=null;oa[b.id]=null}function c(a,b,c){var d;a instanceof ArrayBuffer&&(a=va.bs(a));d=a.width;a=a.height;X.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(kc)&&c&&X.warn("image",b,"is not from app root.")}function b(a,b,c,d,e,f){d=b.s;if(!d)throw"Nothing requested";D.enqueue([[d,D.AT_JSON,d]],function(d,f,g,h){if(d){X.log("%cLOAD METADATA","color: #616",h);f=ta.lu(d.b4w_format_version);
switch(ta.Qu(f,Pa.Ng)){case -1:f[0]<Pa.Ng[0]?ta.ja("JSON version is too old relative to B4W engine: "+ta.Qf(f)+", required: "+ta.Qf(Pa.Ng)+". Reexport scene with the latest B4W addon to fix it."):X.warn("JSON version is a bit old relative to B4W engine: "+ +ta.Qf(f)+", required: "+ta.Qf(Pa.Ng)+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");break;case 1:f[0]>Pa.Ng[0]?ta.ja("B4W engine version is too old relative to JSON. Can't load the scene. Update your engine version to fix it."):
X.warn("B4W engine version is a bit old relative to JSON. Some compatibility issues can occur. Update your engine version to fix it.")}Pa.to=f;for(var l in d)a[l]=d[l];0===b.id&&(za=a);(d=a.binaries[0].binfile)?b.zq=d:(ia.Xt(b,"load_binaries"),ia.Xt(b,"prepare_bindata"));d=a==za;if(a.b4w_export_errors)for(l=0;l<a.b4w_export_errors.length;l++)f=a.b4w_export_errors[l],(d&&"PRIMARY"==f.type||"ALL"==f.type)&&X.ez(f.text);d=a==za;if(a.b4w_export_warnings)for(l=0;l<a.b4w_export_warnings.length;l++)f=a.b4w_export_warnings[l],
(d&&"PRIMARY"==f.type||"ALL"==f.type)&&X.fz(f.text);e(b,c)}else ia.hq(b)},null,function(a){f(b,c,a)})}function l(a,b,c,d,e,f){d=V(b.s)+b.zq;if(!d)throw"Binary data is missing";D.enqueue([[d,D.AT_ARRAYBUFFER,d]],function(d,f,g,h){d?(X.log("%cLOAD BINARY","color: #616",h),a.bin_data=d,d=k(d),f=ta.lu(a.b4w_format_version),d[0]!=f[0]&&ta.ja("BIN version does not match to JSON version: "+ta.Qf(d)+", required: "+ta.Qf(Pa.Ng)+". Couldn't load the scene. Reexport scene to fix it."),d[1]!=f[1]&&X.warn("BIN version does not match to JSON version: "+
+ta.Qf(d)+", required: "+ta.Qf(Pa.Ng)+". Some compatibility issues can occur. Reexport scene to fix it."),e(b,c)):ia.hq(b)},null,function(a){f(b,c,a)})}function f(a,b,c,d,e){Gc.Px()&&e(b,c)}function m(a,b,c,d,e){d=a.bin_data;var f=a.binaries[0],g=a.objects,h=a.meshes;a=a.actions;for(var l=ta.Lx(),m=k(d),m=5<=m[0]&&4<m[1]?12:0,n=["indices"],K=["normal","tangent"],x=["color","group"],q=["position","texcoord","texcoord2"],t=0;t<h.length;t++)for(var D=h[t].submeshes,C=0;C<D.length;C++)for(var v in D[C]){var r=
D[C][v][1];if(-1!=n.indexOf(v)){var da=4*D[C][v][0]+f["int"]+m,A=D[C],ja=v,u=d;if(l)var wa=new Uint32Array(u,da,r);else for(var wa=new Uint32Array(r),u=new DataView(u),y=0;y<r;y++)wa[y]=u.getUint32(da+4*y,!0);A[ja]=wa}else if(-1!=q.indexOf(v))da=4*D[C][v][0]+f["float"]+m,D[C][v]=p(d,da,r,l);else if(-1!=K.indexOf(v)){da=2*D[C][v][0]+f["short"]+m;A=D[C];ja=v;u=d;wa=new Float32Array(r);u=new DataView(u);for(y=0;y<r;y++)wa[y]=u.getInt16(da+2*y,!0)/32767;A[ja]=wa}else if(-1!=x.indexOf(v)){da=2*D[C][v][0]+
f.ushort+m;A=D[C];ja=v;u=d;wa=new Float32Array(r);u=new DataView(u);for(y=0;y<r;y++)wa[y]=u.getUint16(da+2*y,!0)/65535;A[ja]=wa}}for(v=0;v<g.length;v++)for(h=g[v].particle_systems,n=0;n<h.length;n++)K=h[n],K.transforms=p(d,4*K.transforms[0]+f["float"]+m,K.transforms[1],l);for(g=0;g<a.length;g++){v=a[g];h=v.fcurves;n=v.frame_range;x=n[0];q=n[1];t=fa.Mz(x,q);n=null;0>t&&(t=0);var C=D=!1,O;for(O in h)D|=-1<O.indexOf("rotation_euler"),C|=-1<O.indexOf("rotation_quaternion");K=[];for(O in h)if(D&&C&&-1<
O.indexOf("rotation_euler"))delete h[O];else{var r=h[O],ba;for(ba in r)da=r[ba],A=p(d,f["float"]+4*da.bin_data_pos[0]+m,da.bin_data_pos[1],l),ja=new Float32Array(t),null===n&&(n=new Int8Array(t)),fa.cx(da,A,ja,n,x,q),da.Ac=ja;-1<O.indexOf("rotation_euler")&&(fa.mz(h[O]),K.push(O))}for(x=0;x<K.length;x++)q=K[x],t=q.replace("euler","quaternion"),h[t]=h[q],delete h[q];v.uw=n}e(b,c)}function k(a){var b=new Uint8Array(a,0,4),c=(new Uint32Array(a,4,1))[0];a=(new Uint32Array(a,8,1))[0];for(var d=0;d<b.length;d++)if("B4WB"[d]!=
String.fromCharCode(b[d])){c=5;a=4;break}return[c,a]}function p(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function e(a,b,c,d,e){var f=a.cameras,g=a.groups,h=a.materials,l=a.meshes,k=a.node_groups,m=a.objects,n=a.particles,K=a.scenes,p=a.speakers,q=a.textures,t=a.worlds;k||(X.warn('"node_groups" datablock undefined. reexport main scene.'),k=a.node_groups=[]);for(var D="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),
v={},r=0;r<D.length;r++)for(var da=a[D[r]],A=0;A<da.length;A++){var y=da[A];v[y.uuid]=y}for(var O=0;O<K.length;O++){for(var ba=K[O],w=ba.objects,J=0;J<w.length;J++)B(w,J,v);ba.camera&&B(ba,"camera",v);ba.world&&B(ba,"world",v)}for(O=0;O<g.length;O++)for(var G=g[O].objects,J=0;J<G.length;J++)B(G,J,v);for(O=0;O<m.length;O++){var z=m[O];z.dupli_group&&B(z,"dupli_group",v);z.parent&&B(z,"parent",v);z.dg_parent&&B(z,"dg_parent",v);if(z.animation_data){var E=z.animation_data;E.action&&B(E,"action",v);if(E.nla_tracks)for(J=
0;J<E.nla_tracks.length;J++)for(var F=E.nla_tracks[J],N=0;N<F.strips.length;N++)F.strips[N].action&&B(F.strips[N],"action",v)}switch(z.type){case "MESH":if(!z.data)throw"mesh not found for object "+z.name;B(z,"data",v);for(var Gc=!1,I=z.modifiers,J=0;J<I.length;J++){var H=I[J];"ARMATURE"==H.type?(Gc&&X.warn('Object "'+z.name+'" has more than one armature modifiers. Only the first one will be used.'),Gc=!0,B(H,"object",v)):"CURVE"==H.type&&B(H,"object",v)}var Pa=z.particle_systems;if(Pa)for(J=0;J<
Pa.length;J++)B(Pa[J],"settings",v);break;case "ARMATURE":B(z,"data",v);for(var T=z.pose.bones,L=z.data.bones,J=0;J<T.length;J++){var Hc=T[J];Hc.bone=L[Hc.bone];for(var U=Hc.parent_recursive,N=0;N<U.length;N++)U[N]=T[U[N]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":B(z,"data",v)}var P=z.constraints;if(P)for(J=0;J<P.length;J++){var hc=P[J];hc.target&&B(hc,"target",v)}var Gb=z.lod_levels;if(Gb)for(J=0;J<Gb.length;J++){var va=Gb[J];va.object&&B(va,"object",v)}}for(O=0;O<l.length;O++)for(var na=
l[O].materials,J=0;J<na.length;J++)B(na,J,v);for(O=0;O<h.length;O++){for(var Q=h[O],ka=Q.texture_slots,J=0;J<ka.length;J++)B(ka[J],"texture",v);var R=Q.node_tree;R&&u(R,v)}for(O=0;O<k.length;O++)(R=k[O].node_tree)&&u(R,v);for(O=0;O<q.length;O++){var oa=q[O],S=oa.type;"IMAGE"!=S&&"ENVIRONMENT_MAP"!=S||B(oa,"image",v)}for(O=0;O<f.length;O++){var ia=f[O];ia.dof_object&&B(ia,"dof_object",v)}for(O=0;O<p.length;O++){var ga=p[O];ga.sound&&B(ga,"sound",v);if(ga.animation_data&&(E=ga.animation_data,E.action&&
B(E,"action",v),E.nla_tracks))for(J=0;J<E.nla_tracks.length;J++)for(F=E.nla_tracks[J],N=0;N<F.strips.length;N++)F.strips[N].action&&B(F.strips[N],"action",v)}for(O=0;O<n.length;O++){for(var wc=n[O],ka=wc.texture_slots,J=0;J<ka.length;J++)B(ka[J],"texture",v);wc.dupli_group&&B(wc,"dupli_group",v);wc.dupli_object&&B(wc,"dupli_object",v)}for(O=0;O<t.length;O++)if(ka=t[O].texture_slots)for(J=0;J<ka.length;J++)B(ka[J],"texture",v);Cb.Ix(a);for(var kc=b.id,jc=a.textures,Z=a==za?a.scenes[0].b4w_anisotropic_filtering:
C().b4w_anisotropic_filtering,ea=0;ea<jc.length;ea++)a==za||"SCENE"!=jc[ea].b4w_source_type||(jc[ea].b4w_source_id=""),eb.Cy(jc[ea],Z,a.scenes,kc);for(var Y={},V=a.objects,ca=0;ca<V.length;ca++){var xa=V[ca];if("MESH"===xa.type&&!xa.particle_systems.length)for(var aa=xa.data,gb=aa.name,mb=aa.submeshes,la=aa.materials,sb=0;sb<mb.length;sb++)0!==mb[sb].base_length||Y[gb]||(la[sb]&&X.warn('material "'+la[sb].name+'" is not assigned to any face (object "'+xa.name+'").'),Y[gb]=!0)}for(var ma=a.meshes,
pa=0;pa<ma.length;pa++){var qa=ma[pa];qa.materials.length||qa.uv_textures.length&&X.warn('mesh "'+qa.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,
emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,
use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});for(var Bc=a.meshes,Qb=ta.keysearch("name","DEFAULT",a.materials),fc=0;fc<Bc.length;fc++){var Eb=Bc[fc];0==Eb.materials.length&&Eb.materials.push(Qb)}for(var hb=a.actions,bb=b.id,Ha=0;Ha<hb.length;Ha++){var Fb=
hb[Ha];Fb.ww=bb;fa.Hw(Fb)}for(var Ma=a.scenes,Vb=0;Vb<Ma.length;Vb++){for(var ub=Ma[Vb],Ab=[],Lb=[],Mb=Ma[Vb].objects,Sa=0;Sa<Mb.length;Sa++){var zc=Mb[Sa];M(Mb,zc,Ab,Lb);var Wb=zc.dupli_group;if(Wb)for(var gc=Wb.objects,rb=0;rb<gc.length;rb++)M(gc,gc[rb],Ab,Lb)}for(Sa=0;Sa<Lb.length;Sa++)for(var Xb=Lb[Sa],sc=[ub],Yb=0;Yb<sc.length;Yb++){for(var Nb=sc[Yb].objects,tc=0;tc<Nb.length;tc++){var nc=Nb[tc].dupli_group;if(nc){var Oc=nc.objects,uc=Oc.indexOf(Xb);-1<uc&&Oc.splice(uc,1)}}var uc=Nb.indexOf(Xb);
-1<uc&&Nb.splice(uc,1)}for(Sa=0;Sa<Ab.length;Sa++)ta.Xw(Ab[Sa][0],Ab[Sa][1])}var Zb=a==za;!Zb&&1<a.scenes.length&&(a.scenes=[wa.hl(a.scenes)],X.warn("loading data contains multiple scenes.","Only the first one will be loaded."));var Bb=C(),Ec=Zb?Bb:wa.hl(a.scenes);-1==ic.Na&&(ic.Na=Bb.fps);1<a.scenes.length&&(a.scenes.splice(a.scenes.indexOf(Bb),1),a.scenes.unshift(Bb));for(var Ya=0;Ya<a.scenes.length;Ya++){var Ja=a.scenes[Ya];Ja.k={};Ja.xw=Ja==Ec;Ja.yw=Zb;ib.enabled&&Ja.b4w_enable_physics&&(Zb||
!ra.cm(C())&&Ja==wa.hl(a))&&ra.yA(Ja);Zb?Ja.b4w_enable_audio&&ja.sq(Ja):Ja.b4w_enable_audio&&!Bb.ca&&ja.sq(Bb)}for(var Pc=b.id,Ac=C(),vc=a==za,Ob=0;Ob<a.scenes.length;Ob++){var oc=a.scenes[Ob],Qc=wa.Yx(oc);(oc.b4w_use_nla||oc.b4w_use_logic_editor)&&Cb.hx(Qc,oc);for(var Lc=0;Lc<Qc.length;Lc++){var Pb=Qc[Lc];x.Jx(Pb,oc,a)&&(Pb.Bc||(Pb.Bc=[]),Pb.Bc.push(vc?oc:Ac))}}for(var Yc=ha(a,Pc),Ob=0;Ob<Yc.length;Ob++)if(Pb=Yc[Ob],!vc&&Pb.parent&&-1<$b.indexOf(Pb.parent.type)&&(Pb.parent=""),"MESH"==Pb.type){var Sc=
Cb.$w(Pb);Sc&&(a.meshes.push(Sc),Pb.data=Sc)}e(b,c)}function g(a,b,c,d,e){d=ha(a,b.id);for(var f=[],g=0;g<d.length;g++){var l=d[g];if(l.Bc)for(var k=l.particle_systems,m=0;m<k.length;m++){var n=k[m].settings;if("HAIR"==n.type)if("OBJECT"==n.render_type)n=n.dupli_object,n.Bc||(n.Bc=l.Bc.slice(),f.push(n));else if("GROUP"==n.render_type)for(var K=n.dupli_group,p=0;p<K.objects.length;p++)n=K.objects[p],n.Bc||(n.Bc=l.Bc.slice(),f.push(n));else X.warn("render type",n.render_type,"not supported for particle systems ("+
n.name+").")}}h(d,b.id,!1);h(f,b.id,!0);for(d=0;d<a.scenes.length;d++)f=a.scenes[d],f.Zf=f.camera.Cb;if(a==za)for(d=b.id,f=0;f<a.scenes.length;f++)for(g=a.scenes[f],l=0,k=x.ma(g,"LAMP",d),m=0;m<k.length;m++)da.Ha(k[m],g).Gj=l++;a=x.get_all_objects(b.id);for(d=0;d<a.length;d++)f=a[d],f.io||(x.VD(f),Hc.p(f));e(b,c)}function h(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];if(e.Bc){for(var f=da.kn(e.name,e.type,e.origin_name),g=0;g<e.Bc.length;g++)da.Ak(f,e.Bc[g]);f.J=e;e.Cb=f}}for(d=0;d<a.length;d++)e=
a[d],e.Bc&&(f=e.Cb,x.Ep(e,f),f.f.kc=b,f.io=c)}function n(a,b,c,d,e){d=x.get_all_objects(b.id);for(var f=0;f<d.length;f++){var g=d[f];if("MESH"==g.type){var h=g.Bk;if(h){h=h.f;if(h.$e){var l=g.f.$c,k=[],m;for(m in l){var n=l[m];k.push(4*n.fj,4*n.Dq)}h.Qs.push(k)}h.hm.push(g.f)}}}f=m=-1;g=fa.Wr();for(h=0;h<d.length;h++)l=d[h],k=l.f,ta.is_mesh(l)&&k.Rh&&(l=k.Ge,l>m&&(m=l),g>=l&&l>f&&(f=l));for(h=0;h<d.length;h++)l=d[h],k=l.f,ta.is_mesh(l)&&k.Rh&&(k.rj=!0,m<g?k.Ge=m:k.Ge<=g?k.Ge=f:(X.warn('too many bones for "'+
l.name+'" / '+k.Ge+" bones (max "+g+" with blending, "+2*g+" without blending). Blending between frames will be disabled."),k.Ge=m,k.rj=!1),k.rj=k.rj&&!ic.Hr);for(m=0;m<d.length;m++)if(f=d[m],g=f.J,ta.is_mesh(f)&&(h=g.lod_levels.length))for(l=f,k=0;k<h;k++)if(n=g.lod_levels[k].object){n=n.Cb;n.f.Jg=f.f.Jg;l.f.tf=g.lod_levels[k].distance;n.f.Hj=g.lod_levels[k].distance;if(g.lod_levels[k+1])n.f.tf=g.lod_levels[k+1].distance;else{n.f.Al=!0;n.f.tf=1E4;break}l.f.Al=!1;l=n}else{l.f.Al=!0;l.f.tf=g.lod_levels[k].distance;
break}for(m=0;m<d.length;m++)if(f=d[m],f.nc)if(g=f.xc,"CHASSIS"==g.pc){f.l={};f.l.qj=g.qj;f.l.Ui=g.Ui;f.l.pp=g.pp;f.l.rp=g.rp;f.l.qp=g.qp;f.l.Rp=g.Rp;f.l.Wo=g.Wo;f.l.xo=g.xo;f.l.Ch=0;f.l.Ti=1;f.l.ri=0;f.l.speed=0;f.l.Wg=[];f.l.Tj=[];f.l.ti=null;if(f.Mc&&f.parent)for(l=[],k=f.parent.J.dupli_group.objects,h=0;h<k.length;h++)l.push(k[h].Cb);else l=d;for(h=0;h<l.length;h++)k=l[h],k.nc&&(n=k.xc,ra.CA(k)&&g.name==n.name?(n=ra.HE(k.xc.pc),f.l.Wg[n]=k,f.l.Tj[n]=new Float32Array(8)):ra.As(k)&&g.name==n.name?
(f.l.ti=k,f.l.si=n.si,f.l.bk=n.bk,f.l.zj=n.zj,n=ea.invert(f.f.Y,new Float32Array(16)),k=ea.multiply(n,k.f.Y,n),f.l.ku=k,n=new Float32Array([1,0,0,0]),hc.transformMat4(n,k,n),f.l.ju=n):ra.zs(k)&&g.name==n.name?(f.l.ip=k,f.l.Zj=n.Zj,f.l.Wh=n.Wh,n=ea.invert(f.f.Y,new Float32Array(16)),k=ea.multiply(n,k.f.Y,n),f.l.gu=k,n=new Float32Array([1,0,0,0]),hc.transformMat4(n,k,n),f.l.fu=n):ra.Bs(k)&&g.name==n.name&&(f.l.sp=k,f.l.gj=n.gj,n=ea.invert(f.f.Y,new Float32Array(16)),k=ea.multiply(n,k.f.Y,n),f.l.uu=
k,n=new Float32Array([1,0,0,0]),hc.transformMat4(n,k,n),f.l.tu=n));if(4!=f.l.Wg.length)throw"Not enough wheels for chassis "+f.name;}else if("HULL"==g.pc){f.l={};f.l.Wg=[];f.l.Tj=[];f.l.qj=g.qj;f.l.Ui=g.Ui;f.l.rg=g.rg;f.l.lh=g.lh;f.l.mh=g.mh;f.l.Ch=0;f.l.Ti=1;f.l.ri=0;f.l.speed=0;f.l.ti=null;if(f.Mc&&f.parent)for(l=[],k=f.parent.J.dupli_group.objects,h=0;h<k.length;h++)l.push(k[h].Cb);else l=d;for(h=0;h<l.length;h++)k=l[h],k.nc&&(n=k.xc,ra.AA(k)&&g.name==n.name?(f.l.Wg.push(k),f.l.Tj.push(new Float32Array(8))):
ra.As(k)&&g.name==n.name?(f.l.ti=k,f.l.si=n.si,f.l.bk=n.bk,f.l.zj=n.zj,n=ea.invert(f.f.Y,new Float32Array(16)),k=ea.multiply(n,k.f.Y,n),f.l.ku=k,n=new Float32Array([1,0,0,0]),hc.transformMat4(n,k,n),f.l.ju=n):ra.zs(k)&&g.name==n.name?(f.l.ip=k,f.l.Zj=n.Zj,f.l.Wh=n.Wh,n=ea.invert(f.f.Y,new Float32Array(16)),k=ea.multiply(n,k.f.Y,n),f.l.gu=k,n=new Float32Array([1,0,0,0]),hc.transformMat4(n,k,n),f.l.fu=n):ra.Bs(k)&&g.name==n.name&&(f.l.sp=k,f.l.gj=n.gj,n=ea.invert(f.f.Y,new Float32Array(16)),k=ea.multiply(n,
k.f.Y,n),f.l.uu=k,n=new Float32Array([1,0,0,0]),hc.transformMat4(n,k,n),f.l.tu=n))}for(m=0;m<d.length;m++)if(f=d[m],f.Ag&&(g=f.Eh,"MAIN_BODY"==g.pc)){f.fd={};f.fd.rg=g.rg;f.fd.lh=g.lh;f.fd.mh=g.mh;f.fd.Ik=[];if(f.Mc&&f.parent)for(h=[],k=f.parent.J.dupli_group.objects,l=0;l<k.length;l++)h.push(k[l].Cb);else h=d;for(l=0;l<h.length;l++)k=h[l],k.Ag&&(n=k.Eh,ra.EA(k)&&g.name==n.name&&(f.fd.Ik.push(k),k.ux=k.Eh.su))}d=C();m=a==za;for(f=0;f<a.scenes.length;f++){g=m?a.scenes[f]:d;n=x.ma(g,"ALL",b.id);h=m?
x.ma(g,"LAMP",b.id):x.ma(g,"LAMP",0);l=x.ma(g,"MESH",b.id);k=x.ma(g,"EMPTY",b.id);m?(wa.Nw(g,a.textures,n,h,l,k),g.k.jk.length&&(b.Yn=!0)):wa.Ow(g,a.textures);n=[];O.Ez(g,l,h,n);var K=wa.Vr(g);if(m){var p=g.k.im;if(p.fC||p.procedural_skydome)p=O.Gz(g,p),n.push(p);wa.wz(K)}for(p=0;p<l.length;p++)O.fr(l[p],K,g);for(p=0;p<n.length;p++)O.fr(n[p],K,g),x.Dw(n[p]);for(p=0;p<k.length;p++)x.Cu(k[p]);n=x.ma(g,"ALL",b.id);wa.ix(g,n,h)}d=a.materials;if(wc.rn&&Pa.Gu)for(m=0;m<d.length;m++){h=d[m];l=h.texture_slots;
for(f=0;f<l.length;f++)if(k=l[f],n=k.texture,"IMAGE"==n.type||"ENVIRONMENT_MAP"==n.type)g=n.image,g.zc||(-1<g.filepath.indexOf(".dds")?g.zc=!0:(g.zc=!n.b4w_disable_compression&&!k.use_map_normal&&"ENVIRONMENT_MAP"!=n.type&&!n.b4w_shore_dist_map&&"MOVIE"!=g.source,g.zc&&(g.filepath+=".dds")));if(f=h.node_tree)for(h=f.nodes,f=0;f<h.length;f++)g=h[f],"TEXTURE"==g.type&&(l=g.texture)&&(g=l.image)&&!g.zc&&(g.zc=l.k.xk&&!l.b4w_disable_compression&&"MOVIE"!=g.source,g.zc&&(g.filepath+=".dds"))}else for(d=
a.images,m=0;m<d.length;m++)f=d[m],f.zc=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds"));for(d=0;d<a.scenes.length;d++)delete a.scenes[d].camera;e(b,c)}function C(){return wa.hl(za.scenes)}function G(a,b,c,d,e){d=a.groups;for(var f=a.objects,g={},h={},l={},k={},m=0;m<d.length;m++){var n=d[m];g[n.uuid]=n;l[n.uuid]=n}for(m=0;m<f.length;m++)n=f[m],h[n.uuid]=n,k[n.uuid]=n;a=a.scenes;for(m=0;m<a.length;m++)F(a[m].objects,null,k,l);for(var K in l)K in g||d.push(l[K]);for(K in k)K in h||f.push(k[K]);
e(b,c)}function F(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=c[g.uuid];if(g=h.proxy){b&&-1==e.indexOf(g.uuid)&&e.push(g.uuid);for(var l=c[g.uuid],k=l.constraints,g=0;g<k.length;g++){var m=ta.fg(k[g]);m.name+="_CLONE";h.constraints.push(m)}"b4w_proxy_inherit_anim"in h&&!h.b4w_proxy_inherit_anim||(h.animation_data&&(l.animation_data=ta.fg(h.animation_data)),l.b4w_use_default_animation=h.b4w_use_default_animation,l.b4w_auto_skel_anim=h.b4w_auto_skel_anim,l.b4w_anim_behavior=h.b4w_anim_behavior,
l.b4w_cyclic_animation=h.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)h=ta.Qn(a,"uuid",e[f]),-1<h&&a.splice(h,1);e={};if(b)for(f=0;f<a.length;f++)g=a[f],h=c[g.uuid],k=ta.fg(h),h="origin_name"in h?h.origin_name:h.name,k.name=b.name+"*"+h,k.origin_name=h,k.dg_parent={uuid:b.uuid},E(k),c[k.uuid]=k,e[g.uuid]=k.uuid,g.uuid=k.uuid;for(f=0;f<a.length;f++)g=a[f],h=c[g.uuid],h.dupli_group&&(g=h.dupli_group,k=d[g.uuid],l=ta.fg(k),l.name=ta.Bi(k.name+"_CLONE"),l.uuid=Z.ps("Group"+l.name),d[l.uuid]=l,g.uuid=
l.uuid,F(l.objects,h,c,d));if(b)for(f=0;f<a.length;f++){g=a[f];h=c[g.uuid];h.parent&&h.parent.uuid in e?h.parent.uuid=e[h.parent.uuid]:h.parent&&(X.warn("Object's \""+h.name+'" parent is not in dupli group. Disabling parenting.'),h.parent=null);k=h.constraints;for(g=0;g<k.length;g++)b=k[g],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=h.modifiers;for(g=0;g<b.length;g++)d=b[g],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((h=h.lod_levels)&&h.length)for(g=0;g<
h.length;g++)b=h[g],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var n in e)mb[n]=e[n]}function E(a){a.uuid=Z.ps("Object"+a.name)}function u(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&B(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in mb&&(e.lamp.uuid=mb[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&B(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var f=e[d];A(f,"from_node",c);A(f,"to_node",c);
t(f,"from_socket",f.from_node.outputs);t(f,"to_socket",f.to_node.inputs)}if(c=a.animation_data)if(c.action&&B(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],f=0;f<e.strips.length;f++)e.strips[f].action&&B(e.strips[f],"action",b)}function B(a,b,c){(c=c[a[b].uuid])||X.error("Dangling link found:",b,a);a[b]=c}function A(a,b,c){c=ta.keysearch("name",a[b].name,c);a[b]=c}function t(a,b,c){c=ta.keysearch("identifier",a[b].identifier,c);a[b]=c}function y(a,b,d,e,f,g){if(!Pa.do_not_load_resources){for(var h=
V(b.s),l=a.images,k={},m=[],n=0;n<l.length;n++){var K=l[n],x=K.uuid;if("FILE"===K.source||"MOVIE"===K.source){var p=q(K,a.textures);if(!p.length)X.warn("image ",K.name," has no users.");else if(!p[0].b4w_shore_dist_map){p=ta.Ij(h+K.filepath);if("FILE"===K.source){var t=K.zc?D.AT_ARRAYBUFFER:D.AT_IMAGE_ELEMENT;wc.yo&&Pa.pm&&(p=D.$j(p),"dds"==p[1]?(p=D.$j(p[0]),p=p[0]+".min50."+p[1]+".dds"):p=p[0]+".min50."+p[1])}else"MOVIE"===K.source&&(Pa.md?(p=D.$j(p),p=p[0]+".altconv.seq",t=D.nk):(p=D.$j(p),t=ja.detect_video_container(p[1]),
p=t!=p[1]?p[0]+".altconv."+t:p[0]+"."+t,t=D.ok));m.push([x,t,p]);k[x]=K}}}m.length?(e.qs=0,D.enqueue(m,function(f,h,l,n){if(f){if(l==D.ok||l==D.nk){if(l==D.ok)var K=f.videoWidth,x=f.videoHeight;else K=f.images[0].width,x=f.images[0].height;X.log("%cLOAD VIDEO "+K+"x"+x,"color: #"+(2048<K||2048<x?"a00":1024<K||1024<x?"aa0":"0a0"),n);-1==n.indexOf(kc)&&X.warn("video",n,"is not from app root.")}else c(f,n,!0);h=k[h];n=q(h,a.textures);for(K=0;K<n.length;K++){var x=n[K],p=x.image.filepath;l==D.nk?(x.k.Lt=
f.lc,eb.ek(x.k,f.images,h.zc,p,b.id)):eb.ek(x.k,f,h.zc,p,b.id)}}f=++e.qs/m.length;g(b,d,f)},function(){X.log("%cLOADED ALL IMAGES","color: #0a0");f(b,d)})):f(b,d)}}function q(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function w(a,b,c,d,e,f){if(!Pa.do_not_load_resources){a=V(b.s);for(var g=[],h={},l=x.get_all_objects(b.id),k=0;k<l.length;k++){var m=l[k],n=m.J;if(H(m)){var K=n.data.sound,n=K.uuid;"BACKGROUND_MUSIC"==ja.Rn(m)?(n=ta.Kr(),b.Xn=!0):"NONE"!=ja.Rn(m)&&
Pa.rs&&(b.bo=!0);if(!(n in h)){h[n]=[];K=ta.Ij(a+K.filepath);switch(ja.du(m)){case ja.um:var p=D.AT_AUDIOBUFFER;break;case ja.Tp:p=D.AT_AUDIO_ELEMENT}var K=D.$j(K),q=ja.detect_audio_container(K[1]),K=q!=K[1]?K[0]+".altconv."+q:K[0]+"."+q;g.push([n,p,K])}h[n].push(m)}}g.length?D.enqueue(g,function(a,e,l,k){if(a)for(X.log("%cLOAD SOUND","color: #0aa",k),-1==k.indexOf(kc)&&X.warn("sound",k,"is not from app root."),e=h[e],l=0;l<e.length;l++)ja.aE(e[l],a);a=++d.$C/g.length;f(b,c,a)},function(){X.log("%cLOADED ALL SOUNDS",
"color: #0aa");e(b,c)}):e(b,c)}}function H(a){return ja.Ce(a)&&ja.du(a)!=ja.Up}function z(a,b,c){a=x.ma(a,"SPEAKER",b);for(b=0;b<a.length;b++){var d=a[b];ja.Ce(d)&&(ja.is_cyclic(d)||c)&&ja.play_def(d)}}function Q(a){a=a.k.jk;for(var b=0;b<a.length;b++)Pa.md&&a[b].use_auto_refresh?a[b].k.ii=!0:a[b].k.Xa&&a[b].use_auto_refresh&&a[b].k.Xa.play()}function P(a,b,c,d,e){la.start();X.log("%cSTART NLA","color: #0a0");e(b,c)}function M(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,
f=0;f<e;f++){var g=b.lod_levels[f],h=g.object;if(h){var l=ta.Wi(h);l.name=b.name+"_LOD_"+String(f+1);E(l);l.lod_levels=[];c.push([a,l]);d.push(h);g.object=l}}}function I(a,b,c,d,e){d=!0;for(var f=0;f<a.scenes.length;f++)if(!ra.Rx(a.scenes[f])){d=!1;break}d&&(e(b,c),X.log("%cPHYSICS READY","color: #0a0"))}function L(a,b,c,d,e){d=C();for(var f=0;f<a.scenes.length;f++){var g=a.scenes[f],h=a==za?ra.cm(g):ra.cm(d)||ra.cm(g);a==za||(g=d);if(ib.enabled&&h)for(h=0;h<sb.length;h++)for(var l=x.ma(g,sb[h],b.id),
k=0;k<l.length;k++){var m=l[k];m.f.kc==b.id&&(ra.append_object(m,g),b.Ls&&ra.K(m)&&ra.disable_simulation(m))}}e(b,c)}function v(a,b,d,e,f){var g={};e=[];for(var h=a.scenes,l=0;l<a.scenes.length;l++){var k=h[l];if(k.k.nb&&(k=k.k.nb.gm)&&"FILE"===k.source){var m=k.uuid,n=ta.Ij(V(b.s)+k.filepath);e.push([m,k.zc?D.AT_ARRAYBUFFER:D.AT_IMAGE_ELEMENT,n]);g[m]=k}}e.length?D.enqueue(e,function(d,e,f,l){if(d){c(d,l,!0);e=g[e];l=q(e,a.textures);for(f=0;f<l.length;f++){var k=l[f];eb.ek(k.k,d,e.zc,k.image.filepath,
b.id)}for(f=0;f<h.length;f++)if(l=h[f],l.k.nb.gm===e){var m=d,n=document.createElement("canvas"),k=e.size[0],K=e.size[1];n.width=k;n.height=K;n=n.getContext("2d");n.drawImage(m,0,0);m=n.getImageData(0,0,k,K).data;n=new Float32Array(4);n[0]=1/16581375;n[1]=1/65025;n[2]=1/255;n[3]=1;for(var k=k*K,K=new Float32Array(k),x=0;x<k;x++)K[x]=n[1]*m[4*x+2]+n[2]*m[4*x+3];l.k.ap=K}}},function(){f(b,d)}):f(b,d)}function N(a,b,d,e,f){if(Pa.antialiasing&&Pa.smaa){e=a.scenes[0];a=[];for(var g=["SMAA_EDGE_DETECTION",
"SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],h=0;h<g.length;h++){var l=wa.da(e,g[h]);l&&a.push(l)}if(a.length){e=[];h=D.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",h,ba.ec.smaa_search_texture_path]);e.push(["AREA_TEXTURE",h,ba.ec.smaa_area_texture_path]);for(h=0;h<a.length;h++)if(g=a[h],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.ra;for(h=0;h<a.length;h++)if(g=a[h],"u_search_tex"==g.xa)var k=g.Aa;else if("u_area_tex"==g.xa)var m=g.Aa;break}e.length?D.enqueue(e,
function(a,d,e,f){a&&(c(a,f,!1),d="SEARCH_TEXTURE"==d?k:m,d.source="IMAGE",d.xq=!0,eb.ek(d,a,-1!=f.indexOf(".dds")?1:0,f,b.id),eb.Xj(d,eb.t,eb.t))},function(){f(b,d)}):f(b,d)}else f(b,d)}else f(b,d)}function T(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];a==za||(e=C());for(var f=x.ma(e,"LAMP",b.id),g=0;g<f.length;g++){var h=f[g];h.f.kc==b.id&&d.Cm.push({Wb:e,obj:h})}f=x.ma(e,"ALL",b.id);for(g=0;g<f.length;g++)h=f[g],"LAMP"!=h.type&&h.f.kc==b.id&&(b.Ls&&ta.is_mesh(h)&&wa.hide_object(h),
d.Cm.push({Wb:e,obj:h}))}}function U(a,b,c,d,e,f){var g=d.Cm;e=d.dt;if(g.length){a=g[e].obj;e=g[e].Wb;var h=da.Ha(a,e);wa.append_object(e,a,!1);a.anchor&&aa.append(a);d=++d.dt/g.length;"LAMP"==a.type&&x.ZC(e);null!=a.f.bd&&wa.Bu(h.ef,a.f.i);g=a.Vj;g.length&&e.k.di&&(e=h.Bf,wa.Eu(e,a.f.i,a.f.quat),da.Fu(g,e.j.fc))}else d=1;f(b,c,d)}function ga(a,b,c,d,e){if(a==za){a=wa.bA();d=wa.wg();for(var f=0;f<a.length;f++){var g=a[f];wa.VB(g,d);(g.b4w_use_nla||g.b4w_use_logic_editor)&&la.YD(g,g.b4w_nla_cyclic,
b.id)}wa.set_active(d)}else wa.Fp(C());a=x.get_all_objects(b.id);x.WD(a);e(b,c)}function S(a,b,c,d,e){if(a==za)for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||Q(a.scenes[d]),z(a.scenes[d],b.id);else a.scenes[0].b4w_use_nla||Q(C()),z(C(),b.id);e(b,c)}function Y(a,b,c,d,e){Pa.Bg&&(b.Yn||b.Xn||b.bo)?gb||ca(a,e,b,c):e(b,c)}function ca(a,b,c,d){var e=Qb.parentElement;Bc=e.style.zIndex;e.style.zIndex="999";gb=document.createElement("div");gb.style.position="relative";gb.style.height="88px";gb.style.width=
"88px";var f=Math.round(Qb.offsetWidth/2-44);gb.style.top=Math.round(Qb.offsetHeight/2-44).toString()+"px";gb.style.left=f.toString()+"px";gb.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC')";
gb.style.backgroundSize="88px";xa=document.createElement("div");xa.style.position="relative";xa.style.height=Qb.offsetHeight.toString()+"px";xa.style.width=Qb.offsetWidth.toString()+"px";xa.style.background="rgba(0, 0, 0, 0.5)";xa.style.zIndex="999";e.appendChild(xa);xa.appendChild(gb);gb.addEventListener("click",function(){c.Yn&&(eb.play(),eb.pause(),eb.reset());if(c.Xn){if(a==za)for(var e=0;e<a.scenes.length;e++)z(a.scenes[e],c.id,!0);else z(C(),c.id,!0);ja.pause()}c.bo&&ja.PB();R();b(c,d)},!1)}
function R(){if(gb){var a=Qb.parentElement;a.style.zIndex=Bc;xa.removeChild(gb);a.removeChild(xa);gb=xa=null;Bc=0}}function V(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function pa(a,b,c){fa.is_animated(b)&&fa.remove(b);x.clear_outline_anim(b);J.check_sensor_manifold(b)&&J.remove_sensor_manifold(b);ra.K(b)&&ra.cC(b);wa.dC(a,b,c);ja.Ce(b)&&ja.bD(b);aa.is_anchor(b)&&aa.remove(b)}function ha(a,b){if(!oa[b]){for(var c=a.scenes,d=[],e=0;e<c.length;e++)qa(c[e].objects,0,a==za,d);oa[b]=
[];for(e=0;e<d.length;e++)for(var c=d[e],f=0;f<c.length;f++)for(var g=c[f],h=0;h<g.length;h++)oa[b].push(g[h])}return oa[b]}function qa(a,b,c,d){d[b]=d[b]||[];for(var e=d[b],f=0;f<a.length;f++){var g=a[f],h=ma(g);e[h]=e[h]||[];(c||-1==$b.indexOf(g.type))&&-1==e[h].indexOf(g)&&e[h].push(g);(g=g.dupli_group)&&qa(g.objects,b+1,c,d)}}function ma(a){return(a=a.parent||fa.Pr(a))?1+ma(a):0}var aa=r("__anchors"),fa=r("__animation"),D=r("__assets"),O=r("__batch");r("__camera");var ba=r("__config"),J=r("__controls"),
va=r("__dds"),na=r("__extensions");r("__lights");var ia=r("__loader"),ea=r("__mat4"),Z=r("__md5"),la=r("__nla"),K=r("__nodemat"),x=r("__objects"),da=r("__obj_util"),ra=r("__physics"),X=r("__print"),Cb=r("__reformer"),Gb=r("__renderer"),wa=r("__scenes"),ja=r("__sfx"),Gc=r("__shaders"),eb=r("__textures"),Hc=r("__transform"),ta=r("__util"),hc=r("__vec4"),Pa=ba.q,wc=ba.Id,ib=ba.m,ic=ba.ke,ka=ba.w,jc=null,oa=null,kc="",za=null,mb={},gb=null,xa=null,Bc=0,$b=["LAMP","CAMERA"],sb=["MESH","CAMERA","EMPTY"],
Qb=null;a.is_primary_loaded=function(a){return ia.is_primary_loaded(a)};a.update=function(){ia.ZD(jc)};a.PC=function(a){Qb=a};a.UD=function(a,b){if(gb){xa.style.height=b.toString()+"px";xa.style.width=a.toString()+"px";var c=Math.round(a/2-44);gb.style.top=Math.round(b/2-44).toString()+"px";gb.style.left=c.toString()+"px"}};a.load=function(a,c,h,k,K){var x={load_main:{Qa:ia.fe,$a:!1,C:[],eb:!1,gb:500,qb:!1,lb:b},duplicate_objects:{Qa:ia.od,$a:!1,C:["load_main"],eb:!1,gb:50,qb:!1,lb:G},load_binaries:{Qa:ia.fe,
$a:!1,C:["load_main"],eb:!1,gb:500,qb:!1,lb:l},wait_for_shaders:{Qa:ia.fe,$a:!0,C:[],eb:!1,gb:50,qb:!0,cf:f},prepare_bindata:{Qa:ia.od,$a:!1,C:["duplicate_objects","load_binaries"],eb:!1,gb:0,qb:!1,lb:m},prepare_bpy_data:{Qa:ia.od,$a:!1,C:["duplicate_objects","prepare_bindata"],eb:!1,gb:100,qb:!1,lb:e},create_b4w_data:{Qa:ia.od,$a:!1,C:["prepare_bpy_data"],eb:!1,gb:100,qb:!1,lb:g},prepare_b4w_data:{Qa:ia.od,$a:!1,C:["create_b4w_data","wait_for_shaders"],eb:!1,gb:300,qb:!1,lb:n},load_smaa_textures:{Qa:ia.fe,
$a:!0,C:["prepare_b4w_data"],eb:!1,gb:10,qb:!0,lb:N},load_shoremap:{Qa:ia.fe,$a:!0,C:["prepare_b4w_data"],eb:!1,gb:10,qb:!0,lb:v},load_textures:{Qa:ia.fe,$a:!0,C:["prepare_b4w_data"],eb:!0,gb:500,qb:!1,lb:y,eg:{qs:0}},wait_physics_workers:{Qa:ia.fe,$a:!0,C:["load_shoremap"],eb:!1,gb:20,qb:!1,cf:I},add_physics_objects:{Qa:ia.od,$a:!1,C:["wait_physics_workers"],eb:!1,gb:20,qb:!1,lb:L},add_objects:{Qa:ia.od,$a:!1,C:["add_physics_objects"],eb:!1,gb:800,qb:!1,lb:T,cf:U,Vi:ga,eg:{Cm:[],dt:0}},load_speakers:{Qa:ia.fe,
$a:!0,C:["add_objects"],eb:!0,gb:30,qb:!1,lb:w,eg:{$C:0}},mobile_media_start:{Qa:ia.od,$a:!Pa.Bg,C:["load_textures","load_speakers"],eb:!0,gb:5,qb:!1,lb:Y,cf:Y},synchronize_media:{Qa:ia.od,$a:!0,C:["mobile_media_start"],eb:!0,gb:70,qb:!1,lb:S},start_nla:{Qa:ia.od,$a:!0,C:["mobile_media_start"],eb:!1,gb:5,qb:!1,lb:P}},p=ia.$r();p||(p=ia.vy(),jc={},oa={},mb={});jc[p.be.length]={};return ia.Dy(x,a,c,h,d,k||ka.uq,Pa.do_not_load_resources,K)};a.unload=function(a){var b=ia.$r();if(!b||!b.be.length||a&&
!ia.wD(b.be[a]))X.error("Unable to unload data!");else{if(0==a)X.log("%cUNLOAD ALL","color: #00a"),aa.cleanup(),fa.cleanup(),ja.cleanup(),la.cleanup(),wa.cleanup(),ia.cleanup(),ra.cleanup(),x.cleanup(),ta.cleanup(),Gb.cleanup(),K.cleanup(),Gc.cleanup(),J.cleanup(),na.cleanup(),D.cleanup(),eb.cleanup(),oa=null,mb={},jc=za=null;else{X.log("%cUNLOAD DATA "+a,"color: #00a");fa.bC(a);for(var b=wa.Jh(),c=0;c<b.length;c++)for(var d=b[c],e=x.ma(d,"ALL",a),f=e.length-1;0<=f;f--){var g=e[f];pa(d,g,!0);e.splice(f,
1);var h=x.ma(d,g.type,a),g=h.indexOf(g);-1!=g&&h.splice(g,1)}}R()}};a.UB=pa;a.set_debug_resources_root=function(a){kc=a}};b4w.module.__batch=function(a,r){function d(a){a={type:a,Ra:"",id:0,eC:0,ai:"",R:[],Nb:[],Jc:[],aj:[],ih:null,zb:{},hc:null,Wa:{Gi:null,Gh:null,hf:[],vf:[]},tq:[],RG:null,P:null,$c:null,de:!1,lg:!1,mr:!1,wireframe_mode:0,num_vertices:0,num_triangles:0,Cs:0,Ds:0,cs:0,Tn:0,mc:new Float32Array(3),Dc:new Float32Array(16),Fa:!1,Vq:!1,ba:!1,Ue:!1,Ta:!1,Zb:!1,Pd:!1,Rc:!1,uc:!1,vc:!1,gc:!1,Vb:!1,rc:!1,Db:!1,st:!1,ve:Y.Ji,Ve:Y.he,sg:!1,YB:"",ZG:"",es:!1,js:0,fs:0,ks:0,ls:0,hs:new Float32Array(3),gs:new Float32Array(3),
xg:!1,je:0,we:0,gf:1,reflect_factor:0,eu:0,gp:1,parallax_scale:0,ff:0,Ye:1,Ys:0,zo:0,Rg:0,Bt:0,Fc:Array(2),wc:new Float32Array(3),Mf:new Float32Array(3),Yd:new Float32Array(3),dd:new Float32Array(4),vd:new Float32Array(4),Dg:null,no:null,lo:null,ko:null,mo:null,Mh:!1,Tf:!1,water_dynamic:!1,tm:!1,Uu:!1,Vu:0,Wu:0,Tu:0,Ii:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,Fr:new Float32Array(2),Er:new Float32Array(2),Fn:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
Qg:null,Uo:!1,qa:null};a.dd[3]=1;a.Vq=!0;a.ba=!0;return a}function c(a){switch(a.type){case "MAIN":case "PARTICLES":a.Ra=a.Fa?a.Ue?"XRAY":"BLEND":"OPAQUE";break;case "DEPTH":a.Ra=a.Mh?"NODES":"DEPTH";break;case "COLOR_ID":a.Ra=a.Ue?"COLOR_ID_XRAY":"COLOR_ID"}}function b(a){var b=a.P;a.P=null;var c=V.ig(a);a.P=b;c.P=b;return c}function l(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=e.J,g=e.f,h=N.nd();N.Uk(g.th,h);var l=f.data.b4w_bounding_cylinder_radius,n=f.data.b4w_bounding_sphere_radius,p=
f.data.b4w_bounding_sphere_center,q=f.data.b4w_bounding_ellipsoid_axes,f=f.data.b4w_bounding_ellipsoid_center;if(g.qd){var l=Math.max(Math.abs(h.max_x),Math.abs(h.min_x)),n=Math.max(Math.abs(h.max_y),Math.abs(h.min_y)),t=Math.max(Math.abs(h.max_z),Math.abs(h.min_z)),t=Math.sqrt(l*l+n*n+t*t),l=Math.sqrt(l*l+n*n);h.max_x=h.max_y=h.max_z=t;h.min_x=h.min_y=h.min_z=-t;n=t;p[0]=p[1]=p[2]=0;q[0]=q[1]=q[2]=t;f[0]=f[1]=f[2]=0}g.Hb=h;t=N.Tm(h,g.Y);g.kb=t;k(g,l,l,h);h=N.Wk(n,p);g.ad=h;h=N.Vm(h,g.Y);g.Ib=h;q=
N.Vk([q[0],0,0],[0,q[1],0],[0,0,q[2]],f);g.af=q;q=N.Um(q,g.Ka);g.bg=q;c=c.concat(m(e,g,b))}return c}function f(a,b,c){for(var d=[],e=[],f={},g=0;g<a.length;g++){var h=a[g],l=h.J,k=h.f,n=N.nd();N.Uk(k.th,n);var p=N.Tm(n,k.Y),q=N.Wk(l.data.b4w_bounding_sphere_radius,l.data.b4w_bounding_sphere_center),t=N.Vm(q,k.Y),D=l.data.b4w_bounding_ellipsoid_axes,l=N.Vk([D[0],0,0],[0,D[1],0],[0,0,D[2]],l.data.b4w_bounding_ellipsoid_center),D=N.Um(l,k.Ka);k.Hb=n;k.kb=p;k.ad=q;k.Ib=t;k.af=l;k.bg=D;n={};n.Rc=k.Rc;
n.uc=k.uc;n.vc=k.vc;n.bh=k.bh;n.Ll=k.Ll;n.Lb=k.Lb;n.Kl=k.Kl;n.Kj=k.Kj;n.gc=k.gc;n.Vb=k.Vb;n.rc=k.rc;n.bd=k.bd;n.Nc=k.Nc;n.Vd=k.Vd;n.oe=k.oe;n.Yc=k.Yc;n.Ee=k.Ee;n.Sb=k.Sb;n.qd=k.qd;n.Si=k.Si;n.Ri=k.Ri;n.Db=k.Db;n.zh=k.zh;n.bl=k.bl;n.Fe=k.Fe;n.Lg=k.Lg;n.Bl=k.Bl;n.Kc=k.Kc;n.Kg=k.Kg;n.Cl=k.Cl;n.Pd=k.Pd;p=k.Ib.F;n.oA=0==c?[0,0]:[Math.floor(p[0]/c),Math.floor(p[2]/c)];n.tf=k.tf;n.Hj=k.Hj;n.Jg=k.Jg;k=JSON.stringify(n);f[k]=f[k]||[];f[k].push(h)}for(var v in f){n=JSON.parse(v);c=f[v];var h=V.xh("STATIC"),
C;for(C in n)h[C]=n[C];h.kc=a[0].f.kc;h.ee=0;h.Te=0;h.se=0;h.re=0;h.me=0;h.Nh=!1;for(g=0;g<c.length;g++)k=c[g],0==g?(h.kb=J.la(k.f.kb),h.Ib=J.la(k.f.Ib),h.af=J.la(k.f.af),h.bg=J.la(k.f.bg)):(N.wr(h.kb,k.f.kb),N.dz(h.Ib,k.f.Ib));h.Hb=J.la(h.kb);h.ad=J.la(h.Ib);e.push({f:h,He:c})}for(a=0;a<e.length;a++)for(f=e[a].f,g=e[a].He,v=0;v<g.length;v++){C=g[v];c=C.J;h=m(C,f,b);C.f.qd&&!C.f.Qm?(k=ba.create(),ba.set_trans(C.f.i,k)):(k=C.f,k=ba.create_sep(k.i,k.scale,k.quat));n={};if(f.Yc||f.qd)n.au_center_pos=
[k[0],k[1],k[2]];f.Yc&&(n.au_wind_bending_amp=[C.f.ee],n.au_wind_bending_freq=[c.b4w_wind_bending_freq],n.au_detail_bending_amp=[c.b4w_detail_bending_amp],n.au_detail_bending_freq=[c.b4w_detail_bending_freq],n.au_branch_bending_amp=[c.b4w_branch_bending_amp]);for(p=0;p<h.length;p++)l=h[p].f,q=h[p].Tc,t=h[p].D,l.wl?l.qd?Y.pD(q,k):Y.ou(q,k):("COLOR_ID"==t.type&&(l=h[p].f=C.f,t.ai=c.uuid,A(t,l),P(t,J.vh(l,0))),q=Y.ou(q,k),Y.oD(q,n));d=d.concat(h)}return d}function m(a,b,c){var f=a.J,g=[],h=p(c,b),l=
J.vh(b,0),k=f.data,m=k.materials,n=Array(m.length),q=fa.Va(c,"MAIN_OPAQUE"),t=!1;q&&(t=q.sf.length?!0:!1);for(var v=0;v<h.length;v++){var C=h[v];if(!f.b4w_do_not_render||"PHYSICS"==C)for(var r=0;r<m.length;r++){var u=m[r];if(("LENS_FLARES"!=u.name||t)&&!Y.ms(k,r)){var O=d(C);"MAIN"==C&&(n[r]=O);if(Q(O,u)){"DEPTH"==C&&n[r]&&(O.Zb=n[r].Zb);O.ve=b.de||b.Pd?Y.pk:Y.Ji;A(O,b);for(var y=O,ba=f.particle_systems,G=0;G<ba.length;G++){var B=ba[G].settings.b4w_vcol_from_name,E=ba[G].settings.b4w_vcol_to_name;
""!==B&&""!==E&&(y.zb[B]={vg:!1,src:[{name:B,jd:7}]})}"DYNAMIC"==b.type&&(O.ai=f.uuid);P(O,l);var F=Y.zr(k,r,O.aj,O.$c,O.zb,O.ih);"LENS_FLARES"==u.name&&(F=pa.TB(F));g.push({D:O,Tc:F,oc:[u.name],f:b,Ad:[a]})}}}}var N=f.particle_systems;if(0<N.length&&g.length){for(var I=!1,H=!1,v=0;v<N.length;v++){var M=N[v],T=M.settings;T.use_render_emitter&&(I=!0);"HAIR"!=T.type||"OBJECT"!=T.render_type&&"GROUP"!=T.render_type&&M.transforms.length||(H=!0);if(I&&H)break}var L=g[0].D.zb,U;if(H){var na;if(1<m.length){for(var R=
{},S=0;S<N.length;S++){var ea=N[S].settings;if("HAIR"==ea.type&&("OBJECT"==ea.render_type||"GROUP"==ea.render_type)){var Z=ea.b4w_vcol_from_name,V=ea.b4w_vcol_to_name;""!==Z&&""!==V&&(R[Z]=J.la(L[Z]))}}"a_bending_col_main"in L&&(R.a_bending_col_main=J.la(L.a_bending_col_main));"a_bending_col_detail"in L&&(R.a_bending_col_detail=J.la(L.a_bending_col_detail));na=Y.Ar(k,[],R)}else na=g[0].Tc;U=na}else U=null;for(var ca,aa=U,ha=a.J,la=[],qa=ha.particle_systems,jb=ha.data,Rb=0;Rb<qa.length;Rb++){var cb=
qa[Rb],Ka=cb.settings;if(Ka.count)if("EMITTER"==Ka.type){if("DYNAMIC"==b.type){var Ta=d("PARTICLES"),Kb,fb=jb.materials,ac=cb.settings.material-1;ac>=fb.length&&(ga.warn('Wrong material used for rendering particle system "'+cb.name+'"'),ac=0);Kb=fb[ac];"HALO"===cb.settings.render_type&&(Ta.xg=!0);e(Ta,Kb);var Ea=Ta,ua=cb.settings;switch(ua.b4w_billboard_align){case "VIEW":w(Ea,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":w(Ea,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":w(Ea,
"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":w(Ea,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}w(Ea,"BILLBOARD",0);w(Ea,"SOFT_PARTICLES",ua.b4w_enable_soft_particles&&0<ua.b4w_particles_softness&&ia.hj?1:0);w(Ea,"SOFT_STRENGTH",D.r(ua.b4w_particles_softness));D.I(Ea.Wa,"WORLD_SPACE","WORLD"==ua.b4w_coordinate_system?1:0);Ta.Pd=!0;Ta.ai=a.name+"_"+Ka.uuid;Ta.YB=cb.name;P(Ta,l);pa.xA(Ta,cb,Kb);var Cc=pa.Az(Ta,jb,cb,a.f.Ka);la.push({D:Ta,Tc:Cc,
oc:[Kb.name],f:b,Ad:[a]})}}else if("HAIR"==Ka.type){var wb=J.rl(cb.seed);Ka.b4w_dynamic_grass&&(b.zh=!0);var ya=ma.Qq(ia.to)&&!Ka.b4w_initial_rand_rotation&&!Ka.b4w_hair_billboard,Ua=4;ya&&(Ua=8);if(cb.transforms.length)var W=cb.transforms;else for(var Ia=Y.Mn(aa,Ka.count,!1,wb),W=new Float32Array(Ia.length*Ua),Ba=0;Ba<Ia.length;Ba++){var Ca=.75+.5*J.ld(wb);W[Ba*Ua]=Ia[Ba][0];W[Ba*Ua+1]=Ia[Ba][1];W[Ba*Ua+2]=Ia[Ba][2];W[Ba*Ua+3]=Ca;ya&&(W[Ba*Ua+4]=1,W[Ba*Ua+5]=0,W[Ba*Ua+6]=0,W[Ba*Ua+7]=0)}var Aa=fa.Va(c,
"GRASS_MAP")?!0:!1;if("OBJECT"==Ka.render_type)var Na=[p(c,Ka.dupli_object.Cb.f,!0)],cc=z(a,b,L,aa,[Ka.dupli_object.Cb],Na,[W],Ka,cb,Aa,wb,!1),la=la.concat(cc);else if("GROUP"==Ka.render_type){for(var Qa=[],Ib=Ka.dupli_group.objects,Ba=0;Ba<Ib.length;Ba++)Qa.push(Ib[Ba].Cb);for(var vb=!1,Na=[],Ba=0;Ba<Qa.length;Ba++){var lb=p(c,Ka.dupli_group.objects[Ba].Cb.f,!0);Na.push(lb)}if(Ka.use_whole_group){for(var pc,kb=W,dc=Qa,db=ya,xc=Ua,ob={},xb=new Float32Array([0,0,0,1]),La=0;La<kb.length;La+=xc)for(var Wa=
0;Wa<dc.length;Wa++){var Za=va.create();va.scale(dc[Wa].f.i,dc[Wa].f.scale,Za);var Tb=va.clone([kb[La],kb[La+1],kb[La+2]]);ob[Wa]||(ob[Wa]=new Float32Array(kb.length));db&&(ob[Wa][La+4]=xb[0]=kb[La+4],ob[Wa][La+5]=xb[1]=kb[La+5],ob[Wa][La+6]=xb[2]=kb[La+6],ob[Wa][La+7]=xb[3]=kb[La+7],J.Qo(xb,xb),J.AD(Za,xb,Za));va.add(Tb,Za,Tb);ob[Wa][La]=Tb[0];ob[Wa][La+1]=Tb[1];ob[Wa][La+2]=Tb[2];ob[Wa][La+3]=kb[La+3]}pc=ob;vb=!0}else{var ec;if(Ka.use_group_count){for(var Xa=W,Dc=Qa,yc=Ka.dupli_weights,yb=wb,qc=
ya,Db=Ua,pb={},qb=[],Da=0;Da<Dc.length;Da++)for(var Fa=Dc[Da],sa=Fa.Ho||Fa.name,$a=0;$a<yc.length;$a++){var Ga=yc[$a];sa==Ga.name.split(": ")[0]&&qb.push(Ga)}yc.length!=qb.length&&ga.error("dupli weights match failed");for(Da=0;Da<Xa.length;Da+=Db){for(var tb,Oa=qb,zb=[0],ab=0;ab<Oa.length;ab++)zb[ab+1]=zb[ab]+Oa[ab].count;for(var lc=zb[zb.length-1]*J.ld(yb),Ub=0,ab=0;ab<zb.length;ab++)if(lc>=zb[ab]&&lc<zb[ab+1]){Ub=ab;break}tb=Ub;pb[tb]=pb[tb]||[];pb[tb].push(Xa[Da],Xa[Da+1],Xa[Da+2],Xa[Da+3]);qc&&
pb[tb].push(Xa[Da+4],Xa[Da+5],Xa[Da+6],Xa[Da+7])}for(tb in pb)pb[tb]=new Float32Array(pb[tb]);ec=pb}else{for(var Va=W,mc=wb,rc=ya,fc=Ua,Eb=Qa.length,hb={},bb=0;bb<Va.length;bb+=fc){var Ha=Math.floor(Eb*J.ld(mc));hb[Ha]=hb[Ha]||[];hb[Ha].push(Va[bb],Va[bb+1],Va[bb+2],Va[bb+3]);rc&&hb[Ha].push(Va[bb+4],Va[bb+5],Va[bb+6],Va[bb+7])}for(Ha in hb)hb[Ha]=new Float32Array(hb[Ha]);ec=hb}pc=ec}cc=z(a,b,L,aa,Qa,Na,pc,Ka,cb,Aa,wb,vb);la=la.concat(cc)}"INSTANCE"==Ka.b4w_wind_bend_inheritance&&a.f.Yc&&ga.warn('Emitter object "'+
a.name+"\" has a particle system with wind bending inheritance from the particle instance. Wind bending on the emitter isn't disabled. Expect unforeseen behavior.")}else throw"Unknown particle settings type";}ca=la;g=I?g.concat(ca):ca}return g}function k(a,b,c,d){a.Nm=N.er(b,d);a.Lm=N.cr(c,d);a.Mm=N.dr(b,d)}function p(a,b,c){var d=["MAIN","NODES_GLOW"];(b.bh&&fa.Va(a,"COLOR_PICKING")||b.Lb&&fa.Va(a,"OUTLINE_MASK"))&&!c&&d.push("COLOR_ID");fa.Va(a,"WIREFRAME")&&d.push("WIREFRAME");d.push("PHYSICS");
(fa.Va(a,"DEPTH")||fa.Va(a,"SHADOW_CAST"))&&d.push("DEPTH");fa.Va(a,"GRASS_MAP")&&d.push("GRASS_MAP");if(b.uc||b.Vb)for(a=null,b.uc&&(a=["MAIN","NODES_GLOW","COLOR_ID","PHYSICS","WIREFRAME"]),b.Vb&&(b=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],a=null!==a?J.dx(a,b):b),b=a,a=0;a<b.length;a++)c=d.indexOf(b[a]),-1!==c&&d.splice(c,1);return d}function e(a,b){var c;switch(a.type){case "MAIN":if(b.b4w_do_not_render)c=!1;else{if(b.use_nodes)u(a,b,"MAIN");else{h(a,b);var d=b.game_settings.alpha_blend;a.Ue=
b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;a.Rg=b.offset_z;a.Mf.set([1,1,1]);var e=b.texture_slots;na.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.dd);switch(b.name){case "LENS_FLARES":I(a,"special_lens_flares.glslv","special_lens_flares.glslf");q(a,"a_position");q(a,"a_texcoord");var f=n(e[0],null);L(a,f);break;default:I(a,"main_stack.glslv","main_stack.glslf");b.use_shadeless||(c=R.jn(b.uuid,b.name,{Zb:b.use_shadeless,ij:b.diffuse_shader,ni:b.specular_shader}),a.Wa.vf=
R.Sk(c));var l=C("use_map_color_diffuse",e),k=C("use_map_color_spec",e),m=C("use_map_normal",e),p=C("use_map_mirror",e),f=C("use_stencil",e);c=l[0];k=k[0];m=m[0];p=p[0];l=l[1];e=f[0]&&C("use_rgb_to_intensity",e)[0];if(c){switch(c.blend_type){case "MIX":w(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":w(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}f=n(c,null);L(a,f,"u_colormap0");ia.Em&&"CLIP"==d&&O.Xj(f,O.yc,O.yc);a.ff=c.diffuse_color_factor;a.Ye=c.use_map_alpha?c.alpha_factor:
0;a.Mf.set(c.scale)}d=c&&c==k;k&&(d||(f=n(k,null),L(a,f,"u_specmap0")),a.eu=k.specular_color_factor);if(m&&(q(a,"a_normal"),q(a,"a_tangent"),f=n(m,null),L(a,f,"u_normalmap0"),a.Ys=m.normal_factor,f=m.texture,f.b4w_use_map_parallax&&ia.Oj)){var t=D.r(f.b4w_parallax_steps),v=D.r(f.b4w_parallax_lod_dist);w(a,"PARALLAX",1);w(a,"PARALLAX_STEPS",t);w(a,"PARALLAX_LOD_DIST",v);a.parallax_scale=f.b4w_parallax_scale}p&&(f=n(p,null),L(a,f,"u_mirrormap"),a.zo=p.mirror_factor);if(p=c&&l&&e?1:0)f=n(l,null),L(a,
f,"u_colormap1"),f=n(e,null),L(a,f,"u_stencil0");(f=c||k||m)&&a.Mf.set(f.scale);w(a,"TEXTURE_SPEC",void 0==k?0:1);w(a,"ALPHA_AS_SPEC",d?1:0);w(a,"TEXTURE_STENCIL_ALPHA_MASK",p);q(a,"a_position");q(a,"a_normal");(c||k||m)&&q(a,"a_texcoord");if(b.b4w_water){a.Tf=!0;a.water_dynamic=b.b4w_water_dynamic;b.b4w_water_shore_smoothing&&!a.Fa?(ga.warn('Material: "'+b.name+'" is opaque.',"Disabling shore smoothing."),a.tm=!1):a.tm=b.b4w_water_shore_smoothing;I(a,"special_water.glslv","special_water.glslf");
d=R.jn(b.uuid,b.name,{Zb:!1,ij:b.diffuse_shader,ni:b.specular_shader});a.Wa.vf=R.Sk(d);q(a,"a_position");ia.Xu?(q(a,"a_polyindex"),a.ba=!0,a.wireframe_edge_color=[0,0,0],w(a,"DEBUG_WIREFRAME",1)):w(a,"DEBUG_WIREFRAME",0);p=b.texture_slots;d=C("use_map_normal",p);f=C("use_map_mirror",p)[0];d.length&&(t=n(d[0]),L(a,t,"u_normalmap0"),a.Ii=b.b4w_water_norm_uv_velocity);w(a,"NUM_NORMALMAPS",d.length);a.Qg=Array(d.length);for(t=0;t<d.length;t++)a.Qg[t]=new Float32Array(2),a.Qg[t].set([d[t].scale[0],d[t].scale[1]]);
f&&(t=n(f),L(a,t,"u_mirrormap"),a.zo=f.mirror_factor);f=null;if(ia.Fh)for(t=0;t<p.length;t++){var r=p[t];if(!0===r.texture.b4w_water_foam){f=r;break}}f?(w(a,"FOAM",1),t=n(f),L(a,t,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.Fr.set(f.texture.b4w_foam_uv_freq),a.Er.set(f.texture.b4w_foam_uv_magnitude),a.Fn[0]=f.scale[0],a.Fn[1]=f.scale[1]):w(a,"FOAM",0);for(t=0;t<p.length;t++)if(r=p[t],!0===r.texture.b4w_shore_dist_map){var A=r;break}A&&ia.Dm?(A=n(A),L(a,A,"u_shore_dist_map"),w(a,"SHORE_PARAMS",1),
A=r.texture.b4w_shore_boundings,w(a,"MAX_SHORE_DIST",D.r(r.texture.b4w_max_shore_dist)),w(a,"SHORE_MAP_SIZE_X",D.r(A[0]-A[1])),w(a,"SHORE_MAP_SIZE_Y",D.r(A[2]-A[3])),w(a,"SHORE_MAP_CENTER_X",D.r((A[0]+A[1])/2)),w(a,"SHORE_MAP_CENTER_Y",D.r((A[2]+A[3])/2))):w(a,"SHORE_PARAMS",0);if(b.b4w_generated_mesh&&ia.hj)w(a,"GENERATED_MESH",1),a.Uu=!0,a.Vu=b.b4w_water_num_cascads,a.Wu=b.b4w_water_subdivs,a.Tu=b.b4w_water_detailed_dist;else{q(a,"a_normal");if(f||d.length)q(a,"a_texcoord"),q(a,"a_tangent");w(a,
"GENERATED_MESH",0)}if(b.b4w_water_dynamic){var r=D.r(b.b4w_water_dst_noise_scale0),A=D.r(b.b4w_water_dst_noise_scale1),d=D.r(b.b4w_water_dst_noise_freq0),p=D.r(b.b4w_water_dst_noise_freq1),f=D.r(b.b4w_water_dir_min_shore_fac),t=D.r(b.b4w_water_dir_freq),v=D.r(b.b4w_water_dir_noise_scale),y=D.r(b.b4w_water_dir_noise_freq),J=D.r(b.b4w_water_dir_min_noise_fac),ba=D.r(b.b4w_water_dst_min_fac),z=D.r(b.b4w_water_waves_hor_fac);w(a,"DST_NOISE_SCALE_0",r);w(a,"DST_NOISE_SCALE_1",A);w(a,"DST_NOISE_FREQ_0",
d);w(a,"DST_NOISE_FREQ_1",p);w(a,"DIR_MIN_SHR_FAC",f);w(a,"DIR_FREQ",t);w(a,"DIR_NOISE_SCALE",v);w(a,"DIR_NOISE_FREQ",y);w(a,"DIR_MIN_NOISE_FAC",J);w(a,"DST_MIN_FAC",ba);w(a,"WAVES_HOR_FAC",z)}F(a,b);E(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;w(a,"ABSORB",D.r(b.b4w_water_absorb_factor));w(a,"SSS_STRENGTH",D.r(b.b4w_water_sss_strength));w(a,"SSS_WIDTH",
D.r(b.b4w_water_sss_width))}"HALO"===b.type&&(r=b.halo,I(a,"halo.glslv","halo.glslf"),w(a,"NUM_RINGS",r.ring_count),w(a,"NUM_LINES",r.line_count),w(a,"NUM_STARS",r.star_tip_count),w(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.aj=["a_position"],a.js=r.size,a.fs=r.hardness/20,a.hs.set(r.b4w_halo_rings_color),a.gs.set(r.b4w_halo_lines_color),a.ks=1/b.b4w_halo_stars_blend_height,a.ls=b.b4w_halo_stars_min_height,a.es=!0);w(a,"TEXCOORD",0);w(a,"NORMAL_TEXCOORD",0);c&&g(a,c,"TEXTURE_COLOR0_CO");l&&g(a,l,"TEXTURE_COLOR1_CO");
e&&g(a,e,"TEXTURE_STENCIL_ALPHA_MASK_CO");k&&g(a,k,"TEXTURE_SPEC_CO");m&&g(a,m,"TEXTURE_NORM_CO");w(a,"SHADELESS",b.use_shadeless?1:0);w(a,"SHADELESS_MAT",b.use_shadeless?1:0);a.Zb=b.use_shadeless}d=b.game_settings.alpha_blend;w(a,"ALPHA","OPAQUE"===d?0:1);w(a,"ALPHA_CLIP","CLIP"===d?1:0);w(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(w(a,"VERTEX_COLOR",1),q(a,"a_color")):w(a,"VERTEX_COLOR",0);a.je=b.ambient;a.gf=b.diffuse_intensity;a.we=b.emit;a.Yd.set(b.specular_color);
a.gp=b.specular_alpha;F(a,b);E(a,b);b.b4w_wettable?w(a,"WETTABLE",1):w(a,"WETTABLE",0);G(a,b);a.Uo=b.b4w_refractive;a.Bt=b.b4w_refr_bump}c=!0}break;case "NODES_GLOW":c=u(a,b,"GLOW");break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)c=!1;else if(h(a,b),a.Fa)c=!1;else{k=b.game_settings.alpha_blend;b.use_nodes&&"CLIP"==k?u(a,b,"DEPTH"):I(a,"depth.glslv","depth.glslf");q(a,"a_position");q(a,"a_normal");w(a,"ALPHA","OPAQUE"===k?0:1);a.Mf.set([1,1,1]);if((c=
C("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===k){a.Mf.set(c.scale);w(a,"TEXTURE_COLOR",1);q(a,"a_texcoord");if("IMAGE"==c.texture.k.source||"ENVIRONMENT_MAP"==c.texture.k.source)k=n(c),L(a,k,"u_colormap0");"NONE"==c.texture.k.source&&(k=n(c),L(a,k,"u_colormap0"))}else w(a,"TEXTURE_COLOR",0);c=!0}break;case "PHYSICS":b.b4w_collision?(a.ik=b.b4w_use_ghost,a.ab=b.b4w_collision_id,a.Zi=b.b4w_collision_margin,a.Xi=b.b4w_collision_group,a.$i=b.b4w_collision_mask,a.sj=b.physics.friction,a.nj=
b.physics.elasticity,c=!0):b.b4w_water?(a.Tf=!0,a.EE=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,
a.waves_hor_fac=b.b4w_water_waves_hor_fac,c=!0):c=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_do_not_render||"HALO"===b.type)c=!1;else{h(a,b);a.Ve=Y.he;a.ba=!0;a.Fa=!1;k=b.game_settings.alpha_blend;a.Ue=b.b4w_render_above_all&&"OPAQUE"!=k&&"CLIP"!=k;b.use_nodes&&"CLIP"==k?u(a,b,"COLOR_ID"):I(a,"color_id.glslv","color_id.glslf");q(a,"a_position");w(a,"ALPHA","OPAQUE"===k?0:1);a.Mf.set([1,1,1]);if((c=C("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===k){a.Mf.set(c.scale);w(a,"TEXTURE_COLOR",
1);q(a,"a_texcoord");if("IMAGE"==c.texture.k.source||"ENVIRONMENT_MAP"==c.texture.k.source)k=n(c),L(a,k,"u_colormap0");"NONE"==c.texture.k.source&&(k=n(c),L(a,k,"u_colormap0"))}else w(a,"TEXTURE_COLOR",0);c=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?c=!1:(h(a,b),a.Fa=!1,a.Ve=Y.he,a.ba=!0,I(a,"grass_map.glslv","grass_map.glslf"),q(a,"a_position"),c=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,k=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.zb.a_grass_size=
{vg:!0,src:[]},c?(a.zb.a_grass_size.src.push({name:c,jd:4}),w(a,"DYNAMIC_GRASS_SIZE",1)):w(a,"DYNAMIC_GRASS_SIZE",0),a.zb.a_grass_color={vg:!0,src:[]},k?(a.zb.a_grass_color.src.push({name:k,jd:7}),w(a,"DYNAMIC_GRASS_COLOR",1)):w(a,"DYNAMIC_GRASS_COLOR",0),c=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?c=!1:(I(a,"wireframe.glslv","wireframe.glslf"),q(a,"a_position"),q(a,"a_normal"),q(a,"a_polyindex"),a.ba=!0,a.wireframe_mode=0,a.wireframe_edge_color=
[0,0,0],c=!0);break;case "PARTICLES":if(b.b4w_do_not_render)c=!1;else{c=b.texture_slots;if(a.xg)I(a,"particles_color.glslv","particles_color.glslf");else if(I(a,"particles_texture.glslv","particles_texture.glslf"),k=R.jn(b.uuid,b.name,{Zb:!1,ij:b.diffuse_shader,ni:b.specular_shader}),a.Wa.vf=R.Sk(k),c=C("use_map_color_diffuse",c)[0]){w(a,"TEXTURE_COLOR",1);switch(c.blend_type){case "MIX":w(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":w(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.ff=
c.diffuse_color_factor;a.Ye=c.use_map_alpha?c.alpha_factor:0;c=n(c);L(a,c)}na.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.dd);a.je=b.ambient;a.gf=b.diffuse_intensity;a.we=b.emit;a.Yd.set(b.specular_color);a.gp=b.specular_alpha;q(a,"a_position");q(a,"a_normal");c=b.game_settings.alpha_blend;w(a,"ALPHA","OPAQUE"===c?0:1);w(a,"ALPHA_CLIP","CLIP"===c?1:0);w(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);F(a,b);E(a,b);h(a,b);c=b.game_settings.alpha_blend;a.Ue=b.b4w_render_above_all&&
"OPAQUE"!=c&&"CLIP"!=c;a.Rg=b.offset_z;c=!0}break;default:throw"Wrong batch type: "+a.type;}return c}function g(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":w(a,c,"TEXTURE_COORDS_UV_ORCO");w(a,"TEXCOORD",1);break;case "NORMAL":w(a,c,"TEXTURE_COORDS_NORMAL");w(a,"NORMAL_TEXCOORD",1);break;default:w(a,c,0)}}function h(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.Fa=!0;a.Ve=Y.dq;a.ba=!0;break;case "ALPHA":a.Fa=!0;a.Ve=Y.he;a.ba=!0;break;case "CLIP":a.Fa=!1;a.Ve=Y.he;
a.ba=!0;break;case "ADD":a.Fa=!0;a.Ve=Y.he;a.ba=!1;break;case "OPAQUE":a.Fa=!1;a.Ve=Y.he;a.ba=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.Ta=c.use_backface_culling}function n(a,b){var c=a.texture,d=c.k,c=c.image;d&&b&&c&&O.ek(d,b,c.zc,c.filepath);return d}function C(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var f=b[e];1==f[a]&&f.texture&&f.texture.k&&c.push(f)}return c}function G(a,b){var c=b.raytrace_transparency;a.vd[0]=c.fresnel;a.vd[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;
a.reflect_factor=c.reflect_factor;a.vd[2]=c.fresnel;a.vd[3]=1-c.fresnel_factor/5}function F(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":c=b.specular_hardness;break;case "WARDISO":c=b.specular_slope;break;case "TOON":c=b.specular_toon_size;d=b.specular_toon_smooth;break;case "BLINN":c=b.specular_ior;d=b.specular_hardness;break;default:ga.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.wc[0]=b.specular_intensity;a.wc[1]=
c;a.wc[2]=d}function E(a,b){switch(b.diffuse_shader){case "LAMBERT":a.Fc[0]=0;a.Fc[1]=0;break;case "OREN_NAYAR":a.Fc[0]=b.roughness;a.Fc[1]=0;break;case "FRESNEL":a.Fc[0]=b.diffuse_fresnel;a.Fc[1]=b.diffuse_fresnel_factor;break;case "MINNAERT":a.Fc[0]=b.darkness;a.Fc[1]=0;break;case "TOON":a.Fc[0]=b.diffuse_toon_size;a.Fc[1]=b.diffuse_toon_smooth;break;default:ga.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.Fc[0]=0,a.Fc[1]=0}}function u(a,b,c){if(!b.use_nodes||
b.b4w_do_not_render)return!1;var d;switch(c){case "MAIN":I(a,"main.glslv","main.glslf");d=!1;break;case "GLOW":I(a,"main.glslv","main.glslf");d=!0;break;case "DEPTH":I(a,"depth.glslv","depth.glslf");d=!1;break;case "COLOR_ID":I(a,"color_id.glslv","color_id.glslf"),d=!1}c=R.Zx(b.node_tree,b.uuid,!1,b.name,c);if(!c)return ga.error('Failed to create node graph for material "'+b.name+'", disable nodes'),B(a,b),!0;a.Mh=!0;w(a,"NODES",1);w(a,"NODES_GLOW",d?1:0);var e=b.game_settings.alpha_blend;w(a,"ALPHA",
"OPAQUE"===e?0:1);w(a,"ALPHA_CLIP","CLIP"===e?1:0);w(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);q(a,"a_position");b.use_orco_tex_coord&&q(a,"a_orco_tex_coord");h(a,b);a.Rg=b.offset_z;e=b.game_settings.alpha_blend;a.Ue=b.b4w_render_above_all&&"OPAQUE"!=e&&"CLIP"!=e;na.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.dd);a.we=b.emit;a.je=b.ambient;G(a,b);b.b4w_wettable?w(a,"WETTABLE",1):w(a,"WETTABLE",0);a.Wa.vf=R.Sk(c);var f=!1;ca.V(c,function(b,c){switch(c.type){case "UVMAP":case "TEX_COORD_UV":case "GEOMETRY_UV":case "UV_MERGED":var d=
c.data.name,g=c.data.value;a.ih||(a.ih={});a.ih[g]=d;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":d=c.data.name;a.zb[d]={vg:!0,src:[{name:c.data.value}]};g=0;if("GEOMETRY_VC"==c.type)g=7;else for(var h=0;h<c.pa.length;h++){var k="RGB".indexOf(c.pa[h].identifier);-1<k&&(g|=1<<2-k)}a.zb[d].src[0].jd=g;break;case "TEX_COORD_NO":case "GEOMETRY_NO":q(a,"a_normal");break;case "MATERIAL_BEGIN":d=c.data.value;q(a,"a_normal");w(a,"SHADELESS_MAT",d.Zb?1:0);a.Zb=d.Zb;
f=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":d=c.data.name;g=c.data.value;!1!==g.k.xk&&(g.k.xk="TEXTURE_ENVIRONMENT"!=c.type?!0:!1);L(a,g.k,d);ia.Em&&"CLIP"==e&&O.Xj(c.data.value.k,O.yc,O.yc);break;case "TEXTURE_NORMAL":case "B4W_PARALLAX":w(a,"CALC_TBN_SPACE",1);q(a,"a_normal");q(a,"a_tangent");d=c.data.name;g=c.data.value;g.k.xk=!1;L(a,g.k,d);break;case "LAMP":c.data&&(a.Dg=c.data);break;case "B4W_REFRACTION":a.Uo=!0}});f||(a.Zb=!0);return!0}function B(a,b){switch(a.type){case "DEPTH":I(a,
"depth.glslv","depth.glslf");break;case "COLOR_ID":I(a,"color_id.glslv","color_id.glslf");break;default:I(a,"main_stack.glslv","main_stack.glslf")}w(a,"SHADELESS",1);q(a,"a_position");q(a,"a_normal");na.set(1,0,1,1,a.dd);if(b){var c=b.game_settings.alpha_blend;w(a,"ALPHA","OPAQUE"===c?0:1);w(a,"ALPHA_CLIP","CLIP"===c?1:0);w(a,"VERTEX_COLOR",0);a.Rg=b.offset_z;h(a,b)}return!0}function A(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.wl?w(a,"AU_QUALIFIER","attribute"):w(a,"AU_QUALIFIER","uniform"),
w(a,"STATIC_BATCH",0)):(w(a,"AU_QUALIFIER","attribute"),w(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(S.gA()?w(a,"WIREFRAME_QUALITY",1):w(a,"WIREFRAME_QUALITY",0),a.lg?(w(a,"DEBUG_SPHERE",1),a.mr?w(a,"DEBUG_SPHERE_DYNAMIC",1):w(a,"DEBUG_SPHERE_DYNAMIC",0)):w(a,"DEBUG_SPHERE",0),w(a,"ALPHA",1));b.de&&(a.de=b.de);b.Yc?(""!==b.Ee?(a.zb.a_bending_col_main={vg:!0,src:[{name:b.Ee,jd:4}]},q(a,"a_bending_col_main"),""!==b.Sb.Hs&&""!==b.Sb.Gs&&""!==b.Sb.it?(a.zb.a_bending_col_detail={vg:!0,src:[{name:b.Sb.Hs,
jd:4},{name:b.Sb.Gs,jd:2},{name:b.Sb.it,jd:1}]},q(a,"a_bending_col_detail"),q(a,"a_normal"),w(a,"DETAIL_BEND",1)):w(a,"DETAIL_BEND",0),w(a,"MAIN_BEND_COL",1)):w(a,"MAIN_BEND_COL",0),w(a,"WIND_BEND",1)):w(a,"WIND_BEND",0);b.Fk?w(a,"BEND_CENTER_ONLY",1):w(a,"BEND_CENTER_ONLY",0);w(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.Qm|0);b.qd?w(a,"BILLBOARD",1):w(a,"BILLBOARD",0);b.qd&&b.wl?w(a,"HAIR_BILLBOARD",1):w(a,"HAIR_BILLBOARD",0);b.Ri?w(a,"BILLBOARD_SPHERICAL",1):w(a,"BILLBOARD_SPHERICAL",0);switch(b.Si){case "RANDOM":w(a,
"BILLBOARD_RANDOM",1);w(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":w(a,"BILLBOARD_RANDOM",0);w(a,"BILLBOARD_JITTERED",1);break;default:w(a,"BILLBOARD_RANDOM",0),w(a,"BILLBOARD_JITTERED",0)}b.Db&&ia.Dm?w(a,"DYNAMIC_GRASS",1):w(a,"DYNAMIC_GRASS",0);a.Db=b.Db;a.Pd=b.Pd;a.Rc=b.Rc;a.uc=b.uc;a.vc=b.vc&&!a.Zb&&!(a.Fa&&ia.rr);a.gc=b.gc;a.Vb=b.Vb;a.rc=b.rc;b.Rh?(q(a,"a_influence"),w(a,"SKINNED",1),b.rj?w(a,"FRAMES_BLENDING",1):w(a,"FRAMES_BLENDING",0),w(a,"MAX_BONES",b.Ge)):(w(a,"SKINNED",0),w(a,"FRAMES_BLENDING",
0));b.Ob?(w(a,"VERTEX_ANIM",1),ia.Ru?w(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):w(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):w(a,"VERTEX_ANIM",0);if(b.Rh&&b.Ob)throw"Skinning and vertex animation are mutually exlusive";b.bl?w(a,"DISABLE_FOG",1):w(a,"DISABLE_FOG",0);b.$c&&(a.$c=b.$c);if(a.Mh){for(var c=a.Wa.vf,d=b.Lg,e=b.Kg,f=0;f<c.length;f++){var g=c[f];switch(g.id){case "VALUE":var h=g.Pl[0];if(h)for(var k=0;k<d.length;k+=2)if(d[k]==h){g.ed.push(["VALUE_IND",d[k+1]]);break}break;case "RGB":if(h=
g.Pl[0])for(k=0;k<e.length;k+=2)if(e[k]==h){g.ed.push(["RGB_IND",e[k+1]]);break}}}w(a,"NUM_VALUES",b.Fe.length);w(a,"NUM_RGBS",b.Kc.length)}}}function t(a,b,c){if(b.length){var d=V.Pn(b)||b[0],e=a.Wa;if(a.Dg){var f=0,g;for(g in a.Dg)f++;a.no=new Float32Array(3*f);a.lo=new Float32Array(3*f);a.ko=new Float32Array(3*f);a.mo=new Float32Array(4*f);D.I(e,"NUM_LAMP_LIGHTS",f)}for(f=e=0;f<a.Wa.vf.length;f++)if(g=a.Wa.vf[f],"LIGHTING_LAMP"==g.id){var h=b[e++%b.length],k=h.Ia;"AREA"==k.type&&(h=b[e++%b.length],
k=h.Ia);var l=V.Ha(h,c);if("SPOT"==k.type||"POINT"==k.type)var m=Math.cos(k.Ne/2);if("SPOT"==k.type)var n=k.ak*(1-m);var l=l.Gj,p=h==d?0:-1;g.ed=[["LAMP_TYPE",k.type],["LAMP_IND",l],["LAMP_LIGHT_FACT_IND",Math.floor(l/2)],["LAMP_FAC_CHANNELS",0==l%2?"rg":"ba"],["LAMP_SPOT_SIZE",D.r(m||.01)],["LAMP_SPOT_BLEND",D.r(n||.01)],["LAMP_LIGHT_DIST",D.r(k.distance)],["LAMP_SHADOW_MAP_IND",p]];a.Dg&&y(a,h)}}}function y(a,b){var c=b.J.uuid;if(c in a.Dg){c=a.Dg[c];a.no.set(b.f.i,3*c);a.lo.set(b.Ia.direction,
3*c);a.ko.set(b.Ia.Rk,3*c);var d=la,e=b.Ia;d[0]=-1;d[1]=-1;d[2]=-1;d[3]=e.hh?1:0;switch(e.type){case "POINT":d[2]=e.distance;break;case "SPOT":d[2]=e.distance;var f=d[0]=Math.cos(e.Ne/2);d[1]=e.ak*(1-f)}a.mo.set(d,4*c)}}function q(a,b){var c=a.aj;-1==c.indexOf(b)&&c.push(b)}function w(a,b,c){D.I(a.Wa,b,c)}function H(a,b){if("PHYSICS"==a.type)a.Tc=b;else{var c=a.Ve,d=a.ve;a.es&&(b=Y.jz(b));a.Uu&&(b=ha.Fz(a.Vu,a.Wu,a.Tu));c=Y.rD(b,c,d,a.zb);a.P=c;a.Pd||c.ql||a.de||(c.qf=null,c.Xc=null);c=b.B.length;
a.num_vertices=b.O*c;a:switch(a.ve){case Y.Ji:case Y.qk:case Y.pk:d=!0;break a;default:d=!1}d?Y.FA(b)?a.num_triangles=b.na.length/3*c:a.num_triangles=b.O/3*c:a.num_triangles=0}}function z(a,b,c,e,f,g,h,k,l,m,n,p){var q=[],t=k.b4w_dynamic_grass;if(!m&&t)return q;for(var D="INSTANCE"==k.b4w_wind_bend_inheritance,v="INSTANCE"==k.b4w_shadow_inheritance,C="INSTANCE"==k.b4w_reflection_inheritance,r=[],O=[],u=0;u<f.length;u++){var y=f[u],w=J.Wi(b);w.qd=k.b4w_hair_billboard;w.Si=k.b4w_hair_billboard_type;
w.Ri="SPHERICAL"==k.b4w_hair_billboard_geometry;w.Db=t;w.wl=!0;w.Fe=y.f.Fe;w.Lg=y.f.Lg;w.Kc=y.f.Kc;w.Kg=y.f.Kg;D?(w.Yc=y.f.Yc,w.lk=y.f.lk,w.Te=y.f.Te,w.se=y.f.se,w.Ee=y.f.Ee,w.re=y.f.re,w.me=y.f.me,w.ee=y.f.ee,w.Sb=y.f.Sb,w.Fk=!1):(w.Yc=a.f.Yc,w.lk=a.f.lk,w.Te=a.f.Te,w.se=a.f.se,w.Ee=a.f.Ee,w.re=a.f.re,w.me=a.f.me,w.ee=a.f.ee,w.Sb=a.f.Sb,w.Fk=!0);v?(w.Rc=y.f.Rc,w.uc=y.f.uc,w.vc=y.f.vc):(w.Rc=a.f.Rc,w.uc=a.f.uc,w.vc=a.f.vc);C?(w.gc=y.f.gc,w.Vb=y.f.Vb,w.rc=y.f.rc,w.bd=y.f.bd,w.Nc=y.f.Nc,w.Vd=y.f.Vd):
(w.gc=a.f.gc,w.Vb=a.f.Vb,w.rc=a.f.rc,w.bd=a.f.bd,w.Nc=a.f.Nc,w.Vd=a.f.Vd);r.push(w);var G=h[u];G||(G=new Float32Array);p&&J.rl(l.seed,n);var z=new Float32Array(3),B=new Float32Array([0,0,0,1]),E=[],F=ma.Qq(ia.to)&&!k.b4w_initial_rand_rotation&&!k.b4w_hair_billboard,N=4;F&&(N=8);for(var I=0;I<G.length;I+=N){z[0]=G[I];z[1]=G[I+1];z[2]=G[I+2];var H=G[I+3]*y.f.scale;if(k.b4w_initial_rand_rotation){switch(k.b4w_rotation_type){case "XYZ":var M=new Float32Array([J.ld(n),J.ld(n),J.ld(n)]);va.normalize(M,
M);break;case "Z":M=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+k.b4w_rotation_type;}qa.setAxisAngle(M,k.b4w_rand_rotation_strength*(2*Math.PI*J.ld(n)-Math.PI),B)}else F&&(B.set(G.subarray(I+4,I+8)),J.Qo(B,B),k.use_whole_group||(k.use_rotation_dupli?qa.multiply(B,y.f.quat,B):qa.multiply(B,Z,B)));var T=ba.create_sep(z,H,B);E.push(T)}O.push(E)}for(var L={},u=0;u<f.length;u++){var y=f[u],U=y.J,R=g[u],w=r[u],S={};w.Yc&&(S.au_wind_bending_amp=[w.ee],S.au_wind_bending_freq=
[w.Te],S.au_detail_bending_freq=[w.se],S.au_detail_bending_amp=[w.re],S.au_branch_bending_amp=[w.me],w.ee=0,w.Te=0,w.se=0,w.re=0,w.me=0);var ea=J.vh(w,0),E=O[u];if(E.length)for(var V=U.data,ca=V.materials,aa=Array(ca.length),I=0;I<ca.length;I++)if(!Y.ms(V,I))for(var fa=0;fa<R.length;fa++){var ha=R[fa],la=d(ha),pa=ca[I];"MAIN"==ha&&(aa[I]=la);if(Q(la,pa)){"DEPTH"==ha&&aa[I]&&(la.Zb=aa[I].Zb);la.ve=Y.Ji;A(la,w);la.ai=k.uuid;"JITTERED"==k.b4w_hair_billboard_type&&(la.Cs=k.b4w_hair_billboard_jitter_amp,
la.Ds=k.b4w_hair_billboard_jitter_freq);t&&(la.cs=k.b4w_dynamic_grass_scale_threshold);D||(delete la.zb.a_bending_col_main,delete la.zb.a_bending_col_detail);P(la,ea);var Ka=Y.zr(V,I,la.aj,la.$c,la.zb,la.ih),Ta=Y.mB(Ka,S,E),Kb=Ta,fb=E;Kb.M.au_center_pos=new Float32Array(3*Kb.O);for(var ac=fb.length,Ea=Kb.O/ac,ua=0;ua<ac;ua++)for(var Cc=fb[ua],wb=3*Ea*ua,ya=0;ya<Ea;ya++)Kb.M.au_center_pos[wb+3*ya]=Cc[0],Kb.M.au_center_pos[wb+3*ya+1]=Cc[1],Kb.M.au_center_pos[wb+3*ya+2]=Cc[2];Ta=Kb;if(w.Yc&&w.Fk){var Ua=
Ta,W=a.f.Y;Ua.M.a_emitter_center=new Float32Array(3*Ua.O);var Ia=na.fromValues(0,0,0,1);na.transformMat4(Ia,W,Ia);for(var Ba=0;Ba<Ua.O;Ba++)Ua.M.a_emitter_center[3*Ba]=Ia[0],Ua.M.a_emitter_center[3*Ba+1]=Ia[1],Ua.M.a_emitter_center[3*Ba+2]=Ia[2];Ta=Ua}var Ca=k.b4w_vcol_from_name,Aa=k.b4w_vcol_to_name,Na=la,cc=c,Qa=!D,Ib=V,vb=[];if(""!==Ca&&""!==Aa){var lb,pc=Aa,kb=Na.zb,dc=[],db=void 0;for(db in kb)for(var xc=kb[db].src,ob=0,xb=0;xb<xc.length;xb++){var La=xc[xb].jd;pc==xc[xb].name&&dc.push(db,La,
ob);ob+=J.ah(La)}lb=dc;if(0<lb.length)for(var Wa=0;Wa<lb.length;Wa+=3)vb.push({oj:Ca,fl:7,Ql:lb[Wa],Rl:lb[Wa+1],cl:lb[Wa+2]});else Y.qA(Na.aj,"a_color")&&Aa==Ib.active_vcol_name&&vb.push({oj:Ca,fl:7,Ql:"a_color",Rl:7,cl:0})}Qa&&("a_bending_col_main"in cc&&vb.push({oj:"a_bending_col_main",fl:4,Ql:"a_bending_col_main",Rl:4,cl:0}),"a_bending_col_detail"in cc&&vb.push({oj:"a_bending_col_detail",fl:7,Ql:"a_bending_col_detail",Rl:7,cl:0}));for(var Za=Ta,Tb=E,ec=e,Xa=vb,Dc=la.zb,yc=!1,yb=0;yb<Xa.length;yb++){var qc=
Xa[yb].oj,Db=ec.M[qc];if(Db&&0<Db.length){yc=!0;break}}if(yc){var pb,qb=a.f.Hb,Da=ec.B[0].a_position,Fa=Tb,sa=L,$a=new Float32Array(3),Ga=new Float32Array(3),tb=new Uint32Array(Fa.length);if(!("verts_indices"in sa)){sa.pe=new Float32Array(3);sa.le=new Float32Array(3);sa.Np=new Uint32Array(Da.length/3);sa.Jj=new Uint32Array(Da.length/3);sa.pe[0]=(qb.max_x-qb.min_x)/20;sa.pe[1]=(qb.max_y-qb.min_y)/20;sa.pe[2]=(qb.max_z-qb.min_z)/20;sa.le[0]=qb.min_x;sa.le[1]=qb.min_y;sa.le[2]=qb.min_z;for(var Oa=0;Oa<
Da.length/3;Oa++){var zb=J.trunc((Da[3*Oa]-sa.le[0])/sa.pe[0]),ab=J.trunc((Da[3*Oa+1]-sa.le[1])/sa.pe[1]),lc=J.trunc((Da[3*Oa+2]-sa.le[2])/sa.pe[2]),zb=J.clamp(zb,0,19),ab=J.clamp(ab,0,19),lc=J.clamp(lc,0,19);sa.Np[Oa]=Oa;sa.Jj[Oa]=lc*Math.pow(20,2)+20*ab+zb}Y.cu(sa.Jj,sa.Np,Y.ym,!0);sa.jh=new Uint32Array(Math.pow(20,3));for(Oa=0;Oa<sa.Jj.length;Oa++)sa.jh[sa.Jj[Oa]]++;delete sa.Jj;for(Oa=1;Oa<sa.jh.length;Oa++)sa.jh[Oa]+=sa.jh[Oa-1]}for(var Ub=0;Ub<Fa.length;Ub++){$a[0]=Fa[Ub][0];$a[1]=Fa[Ub][1];
$a[2]=Fa[Ub][2];for(var Va=1E10,mc=-1,rc=J.trunc(($a[0]-sa.le[0])/sa.pe[0]),fc=J.trunc(($a[1]-sa.le[1])/sa.pe[1]),Eb=J.trunc(($a[2]-sa.le[2])/sa.pe[2]),rc=J.clamp(rc,0,19),fc=J.clamp(fc,0,19),Eb=J.clamp(Eb,0,19),hb=Eb*Math.pow(20,2)+20*fc+rc,bb=sa.jh[hb],Ha=0==hb?0:sa.jh[hb-1];Ha<bb;Ha++){var Fb=sa.Np[Ha];Ga[0]=Da[3*Fb];Ga[1]=Da[3*Fb+1];Ga[2]=Da[3*Fb+2];va.sub(Ga,$a,Ga);var Ma=va.sqrLen(Ga);Ma<=Va&&(Va=Ma,mc=Fb)}if(-1==mc)for(Ha=0;Ha<Da.length/3;Ha++)Ga[0]=Da[3*Ha],Ga[1]=Da[3*Ha+1],Ga[2]=Da[3*Ha+
2],va.sub(Ga,$a,Ga),Ma=va.sqrLen(Ga),Ma<=Va&&(Va=Ma,mc=Ha);tb[Ub]=mc}pb=tb;for(var Vb=Za.O/Tb.length,yb=0;yb<Xa.length;yb++){var ub=Xa[yb].Ql,Ab=Xa[yb].Rl,qc=Xa[yb].oj,Lb=Xa[yb].fl,Db=ec.M[qc];switch(ub){case "a_bending_col_main":var Mb=1;break;case "a_bending_col_detail":Mb=3;break;case "a_color":Mb=3;break;default:for(var Sa=Mb=0;Sa<Dc[ub].src.length;Sa++)Mb+=J.ah(Dc[ub].src[Sa].jd)}if(Db&&0<Db.length){var zc=J.ah(Lb),Wb=J.ah(Ab),gc=Lb&Ab,rb=J.Gt(gc);gc!=Ab&&ga.error("Wrong color extraction from "+
qc+" to "+ub+".");if("a_bending_col_main"==ub||"a_bending_col_detail"==ub)Za.M[ub]=new Float32Array(Za.O*Wb);for(Sa=0;Sa<Tb.length;Sa++){var Xb=pb[Sa],sc=Xb*zc,Yb=Sa*Vb*Mb;if(-1!=Xb)for(var Nb=0;Nb<Vb;Nb++)for(var tc=Nb*Mb,nc=0;nc<rb.length;nc++)rb[nc]&&(Za.M[ub][Yb+tc+(Xa[yb].cl+J.Wj(Ab,nc))]=Db[sc+J.Wj(Lb,nc)])}}else Za.M[ub]=new Float32Array(0)}}Ta=Za;q.push({D:la,Tc:Ta,oc:[pa.name],f:w,Ad:[a]})}}}return q}function Q(a,b){var c=!0;"NODES_GLOW"==a.type&&(c=R.Pq(b));return c=c&&e(a,b)}function P(a,
b){for(var c=null,d=null,e=0;e<a.R.length;e++){var f=a.R[e].ne;f&&(c||(c={}),c[e]=f,a.R[e].ne=null);if(f=a.R[e].Xa)d||(d={}),d[e]=f,a.R[e].Xa=null}a.id=0;a.eC=b;a.id=J.vh(a,b);if(c)for(var g in c)a.R[g].ne=c[g];if(d)for(g in d)a.R[g].Xa=d[g]}function M(a,b,c,e,f){var g=d("WIREFRAME");I(g,"wireframe.glslv","wireframe.glslf");g.wireframe_mode=0;g.lg=!0;g.ba=!0;g.ai=c;f&&(g.mr=!0);A(g,b);P(g,J.vh(b,0));e?(b=ha.Ln(1,a.F),Y.It(b,[a.Jd[0],a.Kd[1],a.Ld[2]],a.F)):b=ha.Ln(a.Ja,a.F);Y.km(b,1,!0);b.M.a_polyindex=
Y.Dn(b);H(g,b);return g}function I(a,b,c){a.Wa.Gi=b;a.Wa.Gh=c;D.yC(a.Wa)}function L(a,b,c){1==a.R.length&&0==a.Nb.length&&a.Nb.push("default0");c=c||"default"+String(a.R.length);-1==a.Nb.indexOf(c)&&(a.R.push(b),a.Nb.push(c));a.hc&&aa.rq(a)}function v(a){if(!a.Wa)throw"No shaders info for batch "+a.name;a.hc=D.Qz(a.Wa);aa.jx(a.hc);aa.pq(a);aa.rq(a)}var N=r("__boundings"),T=r("__camera"),U=r("__config"),ga=r("__print"),S=r("__extensions"),Y=r("__geometry"),ca=r("__graph"),R=r("__nodemat"),V=r("__obj_util"),
pa=r("__particles"),ha=r("__primitives"),qa=r("__quat"),ma=r("__reformer"),aa=r("__renderer"),fa=r("__scenegraph"),D=r("__shaders"),O=r("__textures"),ba=r("__tsr"),J=r("__util"),va=r("__vec3"),na=r("__vec4"),ia=U.q,ea=["MAIN"],Z=new Float32Array([0,-Math.sqrt(.5),0,Math.sqrt(.5)]),la=new Float32Array(4);a.vG=d;a.Ez=function(a,b,d,e){for(var g=[],h=a.k.mb,k=[],m=[],n=0;n<b.length;n++){var p=b[n];p.io||(V.oa(p)?k.push(p):m.push(p))}for(var n=[],n=n.concat(l(k,h)),m=n=n.concat(f(m,h,a.b4w_batch_grid_size)),
n=[],p=[],q={},h=0;h<m.length;h++){var D=m[h].D,v=m[h].f,C=null;if(D.id in q){for(var r=q[D.id],A=p[r].D,u=p[r].f,O=null,y=null,k=0;k<D.R.length;k++){var w=D.R[k].ne;w&&(O||(O={}),O[k]=w,D.R[k].ne=null);if(w=D.R[k].Xa)y||(y={}),y[k]=w,D.R[k].Xa=null}J.nu(D,A)&&J.nu(v,u)&&(C=p[r]);if(O)for(k in O)D.R[k].ne=O[k];if(y)for(k in y)D.R[k].Xa=y[k];if(!C){do D.id++;while(q[D.id])}}C||(C={D:D,f:m[h].f,Ad:[],np:[],oc:[]},q[D.id]=p.length,p.push(C));C.Ad=C.Ad.concat(m[h].Ad);m[h].Tc&&m[h].Tc.O&&C.np.push(m[h].Tc);
if(C.oc.length)for(k=0;k<m[h].oc.length;k++)D=m[h].oc[k],-1==C.oc.indexOf(D)&&C.oc.push(D);else C.oc=m[h].oc;Y.cu(C.oc,C.np,Y.ow,!1)}for(h=0;h<p.length;h++){m=p[h].np;if(0==m.length)k=J.ub(J.Bi("%empty"));else if(1==m.length)k=m[0];else{q=[];for(k=0;k<m.length;k++)Y.GA(m[k])||q.push(k);if(q.length<m.length)for(k=0;k<q.length;k++)Y.km(m[q[k]]);k=Y.qD(m)}n.push({D:p[h].D,f:p[h].f,Tc:k,oc:p[h].oc,Ad:p[h].Ad})}g.push.apply(g,n);for(n=0;n<g.length;n++)if(k=g[n].D,k.Jc=g[n].oc,H(k,g[n].Tc),t(k,d,a),"STATIC"==
g[n].f.type&&"COLOR_ID"!=k.type)p=J.Bi("%meta%"+k.type+"%"+k.Jc.join("%")+"%"),p=V.gr(p),p.f=g[n].f,V.Ak(p,a),V.zk(p,a,k),e.push(p);else for(m=[],h=0;h<g[n].Ad.length;h++)p=g[n].Ad[h],-1==m.indexOf(p.name)&&(V.zk(p,a,k),m.push(p.name));if(ia.wireframe_debug){for(n=0;n<g.length;n++)if(d=g[n].f,"DYNAMIC"==d.type&&(p=g[n].Ad[0],-1<ea.indexOf(g[n].D.type))){h=V.Ha(p,a);k=h.S;m=!1;for(h=0;h<k.length;h++)k[h].lg&&(m=!0);m||(d=M(d.af,d,p.name,!0,!0),V.zk(p,a,d))}for(n=0;n<e.length;n++)p=e[n],d=p.f,h=V.Ha(p,
a),k=h.S,-1<ea.indexOf(k[0].type)&&(d=M(d.ad,d,p.name,!1),V.zk(p,a,d))}for(n=0;n<b.length;n++)for(h=V.Ha(b[n],a),k=h.S,h=0;h<k.length;h++)c(k[h]);for(n=0;n<e.length;n++)for(h=V.Ha(e[n],a),k=h.S,h=0;h<k.length;h++)c(k[h])};a.Gz=function(a,b){var e=a.k.Sp,f=d("MAIN");I(f,"special_skydome.glslv","special_skydome.glslf");if(b.procedural_skydome)w(f,"PROCEDURAL_SKYDOME",1),f.st=!0;else{var g=e.dp;if(g){w(f,"WO_SKYTEX",1);var h=n(e.au,null);L(f,h,"u_sky");g.invert&&w(f,"MTEX_NEGATIVE",1);g.rE&&w(f,"MTEX_RGBTOINT",
1);w(f,"BLENDTYPE",g.rx);g.nE&&w(f,"WOMAP_BLEND",1);g.oE&&w(f,"WOMAP_HORIZ",1);g.qE&&w(f,"WOMAP_ZENUP",1);g.pE&&w(f,"WOMAP_ZENDOWN",1)}e.sE&&w(f,"WO_SKYBLEND",1);e.tE&&w(f,"WO_SKYPAPER",1);e.uE&&w(f,"WO_SKYREAL",1)}b.gc&&(f.gc=!0,b.Vb&&(f.Vb=!0));f.Rg=99999;q(f,"a_position");e=ha.Cz();H(f,e);c(f);e=J.Bi("%meta_sky%");e=V.gr(e);V.Ak(e,a);g=V.Ha(e,a);e.f=V.xh("STATIC");e.f.zh=!0;e.f.Hb=N.nd();e.f.ad=N.mk();e.f.kb=N.nd();e.f.Ib=N.mk();g.S.push(f);return e};a.fr=function(a,c,d){d=V.Ha(a,d).S;var e=[],
f=fa.Va(c,"SHADOW_CAST"),g=fa.Va(c,"MAIN_PLANE_REFLECT"),h=fa.Va(c,"MAIN_CUBE_REFLECT"),k=fa.Va(c,"OUTLINE_MASK");c=fa.Va(c,"COLOR_PICKING");for(var l=0;l<d.length;l++){var m=d[l],n=null;"DEPTH"==m.type&&f&&m.Rc&&(n=b(m),n.Ra="SHADOW_CAST");"MAIN"!=m.type&&"PARTICLES"!=m.type||!g&&!h||m.Fa||!m.gc||(n=b(m),n.Ra="REFLECT");"COLOR_ID"==m.type&&(k&&c?(n=b(m),n.Ra="OUTLINE"):k&&!c&&(m.Ra="OUTLINE"));n&&(n.sg=!0,P(n,a.f.id),e.push(n))}d.push.apply(d,e)};a.GC=k;a.GE=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);
else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.mx=function(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}};a.Nz=n;a.JD=B;a.ID=t;a.BC=y;a.qq=function(a,b,c){c&&c.j.type==T.Pb&&w(a,"PERSPECTIVE_SHADOW_CAST",1);w(a,"CSM_SECTION0",0);w(a,"CSM_SECTION1",0);w(a,"CSM_SECTION2",0);w(a,"CSM_SECTION3",0);if(b){for(c=0;c<b.csm_num;c++)w(a,"CSM_SECTION"+String(c),1);w(a,"SHADOW_TEX_RES",D.r(b.csm_resolution));
w(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);w(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)}else w(a,"SHADOW_TEX_RES",0),w(a,"CSM_FADE_LAST_CASCADE",0),w(a,"CSM_BLEND_BETWEEN_CASCADES",0)};a.wa=w;a.Eb=function(a,b){return D.Uz(a.Wa,b)};a.GD=H;a.HD=P;a.DF=M;a.sh=L;a.jC=function(a,b,c){c=a.Nb.indexOf(c);-1<c&&(a.R[c]=b)};a.xy=function(a,b){var c=d("MAIN");c.Fa=!0;na.set(b[0],b[1],b[2],.5,c.dd);c.ve=Y.qk;H(c,a);I(c,"main_stack.glslv","main_stack.glslf");w(c,"SHADELESS",1);v(c);
return c};a.rb=v;a.Gx=function(a){return a.hc.Qj.length?a.hc.Ko.u_cube_fog?!0:!1:!1};a.iy=function(){var a=d("DEPTH_PACK");a.Ta=!0;a.ba=!1;var b=ha.vb();H(a,b);I(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");v(a);return a};a.hr=function(a){var b=d("POSTPROCESSING");I(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":w(b,"POST_EFFECT","POST_EFFECT_NONE");break;case "GRAYSCALE":w(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");
break;case "X_BLUR":w(b,"POST_EFFECT","POST_EFFECT_X_BLUR");break;case "Y_BLUR":w(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");break;case "X_GLOW_BLUR":w(b,"POST_EFFECT","POST_EFFECT_X_GLOW_BLUR");break;case "Y_GLOW_BLUR":w(b,"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR");break;case "X_EXTEND":w(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");break;case "Y_EXTEND":w(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");break;default:throw"Wrong postprocessing effect: "+a;}b.Ta=!0;b.ba=!1;a=ha.vb();H(b,a);v(b);return b};a.Ay=function(a){var b=
d("SSAO");b.ba=!1;b.Ta=!0;var c=ha.vb();H(b,c);I(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");w(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.iu);w(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:O.Hz(a)};c={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=n(a,c);L(b,a,"u_ssao_special_tex");
v(b);return b};a.By=function(a){var b=d("SSAO_BLUR");b.ba=!1;b.Ta=!0;var c=ha.vb();H(b,c);I(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");w(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);v(b);return b};a.jy=function(){var a=d("DOF");a.ba=!1;a.Ta=!0;var b=ha.vb();H(a,b);I(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");w(a,"DEPTH_RGBA",1);v(a);return a};a.ry=function(){var a=d("OUTLINE");a.ba=!1;a.Ta=!0;var b=ha.vb();H(a,b);I(a,"postprocessing/postprocessing.glslv",
"postprocessing/outline.glslf");v(a);return a};a.ly=function(){var a=d("GLOW_COMBINE");a.ba=!1;a.Ta=!0;var b=ha.vb();H(a,b);I(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");v(a);return a};a.my=function(a,b,c){var e=d("GOD_RAYS");e.ba=!1;e.Ta=!0;var f=ha.xz();H(e,f);I(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");w(e,"DEPTH_RGBA",a?1:0);w(e,"WATER_EFFECTS",b?1:0);w(e,"STEPS_PER_PASS",D.r(c,1));v(e);return e};a.ny=function(){var a=d("GOD_RAYS_COM");a.ba=!1;
a.Ta=!0;var b=ha.vb();H(a,b);I(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");v(a);return a};a.sy=function(){var a=d("SKY");a.ba=!1;a.Ta=!0;var b=ha.yz();H(a,b);I(a,"procedural_skydome.glslv","procedural_skydome.glslf");w(a,"WATER_EFFECTS",1);v(a);return a};a.cy=function(){var a=d("ANTIALIASING");a.ba=!1;a.Ta=!0;var b=ha.vb();H(a,b);I(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");w(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");v(a);return a};
a.yy=function(a){var b=d("SMAA"),c=ha.vb();H(b,c);I(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");w(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");w(b,"SMAA_PASS",a);w(b,"SMAA_PREDICATION",0);w(b,"SMAA_REPROJECTION",0);v(b);b.ba=!1;b.Ta=!0;return b};a.gy=function(){var a=d("COMPOSITING");a.ba=!1;a.Ta=!0;var b=ha.vb();H(a,b);I(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");v(a);return a};a.qy=function(){var a=d("MOTION_BLUR");a.Ta=!0;a.ba=!1;var b=ha.vb();H(a,b);I(a,
"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");v(a);return a};a.ay=function(){var a=d("ANAGLYPH");a.Ta=!0;a.ba=!1;var b=ha.vb();H(a,b);I(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");v(a);return a};a.oy=function(){var a=d("LUMINANCE");a.ba=!1;a.Ta=!0;var b=ha.vb();H(a,b);I(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");v(a);return a};a.dy=function(){var a=d("LUMINANCE");a.ba=!1;a.Ta=!0;var b=ha.vb();H(a,b);I(a,"postprocessing/postprocessing.glslv",
"postprocessing/luminance_av.glslf");v(a);return a};a.py=function(){var a=d("LUMINANCE_X_BLUR");a.ba=!1;a.Ta=!0;var b=ha.vb();H(a,b);I(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");v(a);return a};a.ey=function(){var a=d("POSTPROCESSING");a.Ta=!0;a.ba=!1;var b=ha.vb();H(a,b);I(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");v(a);return a};a.fy=function(){var a=d("BLOOM");a.ba=!1;a.Ta=!0;var b=ha.vb();H(a,b);I(a,"postprocessing/postprocessing.glslv",
"postprocessing/bloom_combine.glslf");v(a);return a};a.Ey=function(){var a=d("VELOCITY");a.ba=!1;a.Ta=!0;var b=ha.vb();H(a,b);I(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");v(a);return a};a.by=function(){var a=d("ANCHOR_VISIBILITY");a.ba=!0;a.Ta=!0;a.ve=Y.Wp;I(a,"anchors.glslv","anchors.glslf");var b=ha.Lr(1);H(a,b);w(a,"ANCHOR_NUM",1);v(a);a.ci=new Float32Array([0,0,0]);return a};a.FD=function(a,b){var c=b.length/3;if(c!=a.ci.length/3){var d=ha.Lr(c);H(a,d);w(a,"ANCHOR_NUM",
c);v(a)}a.ci=b};a.ua=function(a,b,c){a=a.Z[0].S;for(var d=0;d<a.length;d++)if(a[d].type==c&&!a[d].sg&&-1!=a[d].Jc.indexOf(b))return a[d];return null};a.Hc=function(a,b,c){a=a.Z[0].S;for(var d=0;d<a.length;d++)if(a[d].type==c&&a[d].sg&&-1!=a[d].Jc.indexOf(b))return a[d];return null};a.Nt=function(a,b){a.dd.set(b.dd);a.gf=b.gf;a.Yd.set(b.Yd);a.wc.set(b.wc);a.we=b.we;a.je=b.je;a.ff=b.ff;a.Ye=b.Ye;a.reflect_factor=b.reflect_factor;a.vd.set(b.vd);a.parallax_scale=b.parallax_scale;a.shallow_water_col.set(b.shallow_water_col);
a.shallow_water_col_fac=b.shallow_water_col_fac;a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.Ii=b.Ii};a.vF=function(a,b){for(var c=a.Z[0].S,d=0;d<c.length;d++)if(c[d].type==b)return!0;return!1};a.Wx=function(a){for(var b=a.R,c=0;c<b.length;c++)O.Sy(b[c].jb);Y.Tq(a.P)}};b4w.module.__nodemat=function(a,r){function d(a,b,l,p,t){var D;a:switch(t){case "GLOW":D=b+"11";break a;case "COLOR_ID":case "DEPTH":D=b+"00";break a;default:D=b+"10"}if(D in ra)return ra[D];if("DEPTH"!=t&&"COLOR_ID"!=t){var v=J.create(),C=a.nodes,x=a.links;b=a.animation_data;for(var r=0;r<C.length;r++)if(null==H(v,C[r],0,b,p,t))return ra[D]=null;if(l&&-1==q(a,v,"GROUP_OUTPUT","group"))return null;r=ha(v);if(!qa(v,x,r))return null;if(l)return v;for(r=0;r<x.length;r++){l=x[r];for(var C=h(l.from_node,
v),A=h(l.to_node,v),O=0;O<C.length;O++)for(var u=0;u<A.length;u++){var w=C[O],ba=A[u],z=J.Oa(v,w),B=J.Oa(v,ba);if(!V(v,w,ba,z,B,l))return ra[D]=null}}g(v);a="GLOW"==t?q(a,v,"B4W_GLOW_OUTPUT","material",!0):q(a,v,"OUTPUT","material",!1,!0);-1==a&&(v=m(),a=0);n(v);a=J.mp(v,a,J.vm);c(a,b,p);k(a);G(a);y(a);e(a,b,p,t)}else p=d(a,b,l,p,"MAIN"),p=J.clone(p,function(a){var b=K.Wi(a);b.C=K.la(a.C);b.pa=K.la(a.pa);return b}),a=q(a,p,"OUTPUT","material",!1,!0),f(p,a),a=J.mp(p,a,J.vm),k(a);return ra[D]=a}function c(a,
c,d){var e=[];J.V(a,function(a,b){"MATERIAL"!=b.type&&"MATERIAL_EXT"!=b.type||e.push({CB:a,node:b})});for(var f=0;f<e.length;++f){var g=e[f].CB,h=e[f].node,k=J.wj(a);J.rh(a,k,h.data.pB);var l=J.wj(a);J.rh(a,l,h.data.qB);J.Rb(a,k,l,[4,2]);for(var m={5:["LIGHTING_APPLY",10],6:["LIGHTING_APPLY",6],7:["MATERIAL_END",3],8:["MATERIAL_END",4],9:["MATERIAL_END",5]},n=J.ao(a,g),p=[],q=[],t=[],D={},v=0;v<n;v++){var C=J.yj(a,g,v);C in D||(D[C]=0);var x=J.ze(a,C,g,D[C]++);p.push([C,g,x]);var r=m[x[1]];if(r)switch(r[0]){case "MATERIAL_END":q.push([C,
l,[x[0],r[1]]]);break;case "LIGHTING_APPLY":t.push([C,[x[0],r[1]]])}else q.push([C,k,x])}b(a,h.data.value,k,l,t,c,d);for(v=0;v<p.length;v++)J.am(a,p[v][0],p[v][1],p[v][2]);for(v=0;v<q.length;v++)J.Rb(a,q[v][0],q[v][1],q[v][2]);h=J.yf(a,g);k=[];m=[];n={};for(v=0;v<h;v++)p=J.mf(a,g,v),p in n||(n[p]=0),x=J.ze(a,g,p,n[p]++),k.push([g,p,x]),m.push([l,p,x]);for(v=0;v<k.length;v++)J.am(a,k[v][0],k[v][1],k[v][2]);for(v=0;v<m.length;v++)J.Rb(a,m[v][0],m[v][1],m[v][2]);J.$g(a,g)}}function b(a,b,c,d,e,f,g){var h=
{name:"LIGHTING_AMBIENT",type:"LIGHTING_AMBIENT"},k=H(a,h,0,f,g,null),m=k;l(a,c,k,"E");l(a,c,k,"A");l(a,c,k,"D");k=la.wg();k=ia.ma(k,"LAMP",ia.DATA_ID_ALL);if(!b.Zb)for(var n,p,q=0;q<k.length;q++){var t=k[q].Ia,h={name:"LIGHTING_LAMP",type:"LIGHTING_LAMP"};n=H(a,h,0,f,g,null);h={name:"LIGHTING_APPLY",type:"LIGHTING_APPLY"};p=H(a,h,0,f,g,null);l(a,m,p,"color");l(a,m,p,"specular");l(a,n,p,"ldir");l(a,c,p,"normal");l(a,c,p,"D");l(a,c,p,"S");l(a,n,p,"lcolorint");l(a,c,n,"shadow_factor");m="COOKTORR"==
b.ni?"SPECULAR_PHONG":"SPECULAR_"+b.ni;h={name:m,type:m};h=H(a,h,0,f,g,null);l(a,n,h,"ldir");l(a,n,h,"lfac");l(a,c,h,"normal");l(a,h,p,"sfactor");"SPECULAR_PHONG"!=m&&"SPECULAR_BLINN"!=m||l(a,n,h,"norm_fac");l(a,c,h,"sp_params");m="HEMI"==t.type?"DIFFUSE_LAMBERT":"DIFFUSE_"+b.ij;h={name:m,type:m};h=H(a,h,0,f,g,null);l(a,n,h,"ldir");l(a,n,h,"lfac");l(a,c,h,"normal");l(a,n,h,"norm_fac");l(a,h,p,"lfactor");"DIFFUSE_LAMBERT"!=m&&l(a,c,h,"dif_params");for(n=0;n<e.length;n++)J.Rb(a,e[n][0],p,e[n][1]);m=
p}l(a,m,d,"color");l(a,m,d,"specular")}function l(a,b,c,d){for(var e=J.Oa(a,b),f=J.Oa(a,c),g,h=0;h<f.C.length;h++)if(d==f.C[h].identifier){g=h;break}for(var k,h=0;h<e.pa.length;h++)if(d==e.pa[h].identifier){k=h;break}void 0!=g&&void 0!=k&&J.Rb(a,b,c,[k,g])}function f(a,b){J.ce(a,function(c,d,e){var f=J.Oa(a,d);d==b&&"Color"==f.C[e[1]].identifier&&J.am(a,c,d,e)})}function m(){var a=J.create(),b={data:null,ed:[],Pa:[],C:[{Ga:new Float32Array([0,0,0]),identifier:"Color",wb:!1,name:"Color"},{Ga:1,identifier:"Alpha",
wb:!1,name:"Alpha"}],pa:[],type:"OUTPUT",Rf:[]};J.rh(a,0,b);return a}function k(a){J.V(a,function(b,c){for(var d=c.C,e=c.pa,f=0;f<d.length;f++)p(a,d[f],b,f,1);for(f=0;f<e.length;f++)p(a,e[f],b,f,0)})}function p(a,b,c,d,e){if(b.wb){var f=!0;J.ce(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&g[1]==d)f=!1});f&&(b.wb=!1)}}function e(a,b,c,d){var e=[];J.ce(a,function(f,g,h){var k=J.Oa(a,f),l=J.Oa(a,g),k=K.is_vector(k.pa[h[0]].Ga),l=K.is_vector(l.C[h[1]].Ga);if(k!=l){var m,n={default_value:[0,0,0],identifier:"Vector",
is_linked:!0,name:"Vector"},p={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};k&&!l?m=w("vector_to_scalar","B4W_VECTOSCAL",[n],[p]):!k&&l&&(m=w("scalar_to_vector","B4W_SCALTOVEC",[p],[n]));H(a,m,0,b,c,d);e.push([f,g,a.U[a.U.length-2],h])}});for(var f=0;f<e.length;++f)J.am(a,e[f][0],e[f][1],e[f][3]),J.Rb(a,e[f][0],e[f][2],[e[f][3][0],0]),J.Rb(a,e[f][2],e[f][1],[0,e[f][3][1]])}function g(a){var b=[];J.V(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":J.ce(a,function(a,e,f){a==
c&&"Translucency"==d.pa[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)J.Rb(a,b[c],b[c+1],b[c+2])}function h(a,b){var c=[];J.V(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function n(a){var b=[];J.V(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var f=C(a,d);if(-1!=f){var g=J.yj(a,f,0);J.Zg(a,f,d,-1);-1!=g&&J.Zg(a,g,f,-1);d=J.Oa(a,
f);e.data=d.data;e.Pa[0]=d.Pa[0];J.$g(a,f)}e.C.splice(1,1)}else if("REROUTE"==e.type){for(var e=J.yj(a,d,0),h=J.yf(a,d),f=[],g=[],k=[],l=0;l<h;l++){var m=J.mf(a,d,l),n=g.indexOf(m);-1!=n?k[n]+=1:(g.push(m),k.push(1),f.push(d,m))}if(-1!=e)for(h=J.ze(a,e,d,0)[0],l=0;l<g.length;l++)for(m=0;m<k[l];m++)n=J.ze(a,d,g[l],m)[1],J.Rb(a,e,g[l],[h,n]);for(l=0;l<f.length;l+=2)J.Zg(a,f[l],f[l+1],-1)}}}function C(a,b){for(var c=a.X,d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function G(a){E(a);
B(a);F(a)}function F(a){var b=[],c="",d="",e={};J.V(a,function(a,f){if("GEOMETRY_UV"==f.type||"UVMAP"==f.type||"TEX_COORD_UV"==f.type){b.push(a,f);var g=f.data.value;c?c==g||d||(d=g,e[d]=0):(c=g,e[c]=0);e[g]++}});for(var f in e)if(2>e[f]){for(var g=0;g<b.length;g+=2)b[g+1].data.value==f&&b.splice(g,2);delete e[f];c==f&&(c=d,d="");d==f&&(d="")}if(!(3>b.length)){var g={default_value:[0,0,0],identifier:"UV_geom",is_linked:!1,name:"UV_geom"},h={default_value:[0,0,0],identifier:"UV_cycles",is_linked:!1,
name:"UV_cycles"};f=w("merged_uv","UV_MERGED",[],[g,h]);f.uv_layer=c;H(a,f,0,null,"",void 0);var k=a.U[a.U.length-2];f=a.U[a.U.length-1];if(d){h=w("merged_uv","UV_MERGED",[],[g,h]);h.uv_layer=d;H(a,h,0,null,"",void 0);var l=a.U[a.U.length-2],h=a.U[a.U.length-1]}else h=null;for(var m=-1,n=null,g=0;g<b.length;g+=2){var p=b[g],q=b[g+1];t(q,b[1])?(m=k,n=f):h&&(m=l,n=h);for(var D=[],v=J.yf(a,p),C={},x=0;x<v;x++){var r=J.mf(a,p,x);r in C||(C[r]=0);var A=J.ze(a,p,r,C[r]++);D.push(p,r,A);A=A.splice(0,A.length);
switch(q.type){case "GEOMETRY_UV":A[0]=0;n.pa[0].wb=!0;break;case "UVMAP":case "TEX_COORD_UV":A[0]=1,n.pa[1].wb=!0}J.Rb(a,m,r,A)}for(var x=0;x<D.length;x+=3)J.Zg(a,D[x],D[x+1],0);J.$g(a,p)}}}function E(a){var b=[];J.V(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type&&"GEOMETRY_LO"!=c.type&&"GEOMETRY_OR"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var k=c[h];
if(A(f,k.Cc)){g=[];h=J.yf(a,e);for(n=0;n<h;n++){var l=J.mf(a,e,n),m=J.ze(a,e,l,0);g.push(e,l,m);J.Rb(a,k.id,l,m)}for(var n=0;n<g.length;n+=3)J.Zg(a,g[n],g[n+1],0);J.$g(a,e);g=!1;break}}g&&(k={id:e,Cc:f},c.push(k))}}function u(a){for(var b={},c=0;c<a.U.length;c+=2)b[a.U[c]]=[];for(c=0;c<a.X.length;c+=3){for(var d=a.X[c],e=a.X[c+1],f=b[e],g=d,h=0;h<=f.length;h++){if(h>=f.length||f[h]>g)f.splice(h,0,g);else if(f[h]!=g)continue;break}for(var e=b[e],d=b[d],g=f=0,h=e.length+d.length,k=[],l=0;l<h;l++)f>
e.length||e[f]>d[g]?k.push(d[g++]):k.push(e[f++])}return b}function B(a){var b=[];J.V(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=u(a),d=[],e=0;e<b.length;e+=2){for(var f=b[e],g=b[e+1],h=!0,k=0;k<d.length;k++){var l=d[k];if(!(3<=l.Xh.length||!A(g,l.Cc)||-1<c[f].indexOf(l.id)||-1<c[l.id].indexOf(f))){for(var m=!1,n=0;n<l.Xh.length;n++){var p=l.Xh[n].id;if(-1<c[f].indexOf(p)||-1<c[p].indexOf(f)){m=!0;break}}if(!m){for(var k=[],p=J.ao(a,f),
q={},n=0;n<p;n++)m=J.yj(a,f,n),m in q||(q[m]=0),h=J.ze(a,m,f,q[m]++),k.push(m,f,h);for(var p=[],q=J.yf(a,f),t={},n=0;n<q;n++)m=J.mf(a,f,n),m in t||(t[m]=0),h=J.ze(a,f,m,t[m]++),p.push(f,m,h);h=k.concat(p);for(n=0;n<h.length;n+=3)J.Zg(a,h[n],h[n+1],0);J.$g(a,f);n={id:f,Cc:g,Zy:k,$y:p};l.Xh.push(n);h=!1;break}}}h&&(l={id:f,Cc:g,Xh:[]},d.push(l))}for(e=0;e<d.length;e++){l=d[e];c=l.Xh.length;for(k=0;k<c;k++){g=l.Xh[k];n=g.Cc;f=g.Zy;g=g.$y;l.Cc.C[k+1].wb=n.C[0].wb;l.Cc.C[k+1].Ga=n.C[0].Ga;l.Cc.pa[2*(k+
1)].wb=n.pa[0].wb;l.Cc.pa[2*(k+1)].Ga=n.pa[0].Ga;l.Cc.pa[2*(k+1)+1].wb=n.pa[1].wb;l.Cc.pa[2*(k+1)+1].Ga=n.pa[1].Ga;for(n=0;n<f.length;n+=3)m=f[n],h=f[n+2],h[1]+=k+1,J.Rb(a,m,l.id,h);for(n=0;n<g.length;n+=3)m=g[n+1],h=g[n+2],h[0]+=2*(k+1),J.Rb(a,l.id,m,h);l.Cc.ed.push(["USE_uv"+(k+2),1])}J.$g(a,l.id);J.rh(a,l.id,l.Cc)}}}function A(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":case "GEOMETRY_LO":case "GEOMETRY_OR":return!0;
case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function t(a,b){var c=["GEOMETRY_UV","TEX_COORD_UV","UVMAP"];return-1!=c.indexOf(a.type)&&-1!=c.indexOf(b.type)?a.data.value==b.data.value:!1}function y(a){var b=[];J.V(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],f=!1,g=[],h=[],k=[[],[],[]],l=J.yf(a,d),m=0;m<l;m++){var n=J.mf(a,d,m);if("SEPRGB"!=J.Oa(a,n).type){f=!1;break}g.push(d,n);for(var p=
{},q=J.yf(a,n),f=0;f<q;f++){var t=J.mf(a,n,f);t in p||(p[t]=0);var D=J.ze(a,n,t,p[t]++);g.push(n,t);k[D[0]].push(d,t,D)}h.push(n);f=!0}if(f){for(m=d=l=0;m<k.length;m++)k[m].length&&(l++,d|=1<<2-m);if(l){e.type+=l;e.pa=[];for(m=0;m<k.length;m++)if(k[m].length)for(e.pa.push({Ga:0,identifier:"RGB"[m],wb:!0,name:"RGB"[m]}),f=0;f<k[m].length;f+=3)k[m][f+2][0]=K.Wj(d,m);for(m=0;m<g.length;m+=2)J.Zg(a,g[m],g[m+1],0);for(m=0;m<h.length;m++)J.$g(a,h[m]);for(m=0;m<k.length;m++)for(f=0;f<k[m].length;f+=3)J.Rb(a,
k[m][f],k[m][f+1],k[m][f+2])}}}}function q(a,b,c,d,e,f){a=a.nodes;for(var g=null,k=0;k<a.length;k++){var l=a[k];e?"GROUP"==l.type&&l.node_tree_name==c&&(g=l):l.type==c&&(g=l)}return g?h(g,b)[0]:(f||ea.error('No "'+c+'" node in node '+d),-1)}function w(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function H(a,b,c,d,e,f){var g=b.name,h=b.type,k=[],l=[],m=[],n=[],p=null,q=[];switch(h){case "BSDF_ANISOTROPIC":case "BSDF_DIFFUSE":case "BSDF_GLOSSY":case "BSDF_GLASS":case "BSDF_HAIR":case "BSDF_TRANSPARENT":case "BSDF_TRANSLUCENT":case "BSDF_REFRACTION":case "BSDF_TOON":case "BSDF_VELVET":case "SUBSURFACE_SCATTERING":case "EMISSION":case "AMBIENT_OCCLUSION":case "VOLUME_ABSORPTION":case "VOLUME_SCATTER":case "BUMP":case "NORMAL_MAP":case "VECT_TRANSFORM":case "BLACKBODY":case "WAVELENGTH":case "SEPXYZ":case "COMBXYZ":case "LIGHT_FALLOFF":case "TEX_IMAGE":case "TEX_ENVIRONMENT":case "TEX_SKY":case "TEX_NOISE":case "TEX_WAVE":case "TEX_MUSGRAVE":case "TEX_GRADIENT":case "TEX_MAGIC":case "TEX_CHECKER":case "TEX_BRICK":case "WIREFRAME":case "LAYER_WEIGHT":case "TANGENT":case "LIGHT_PATH":case "ATTRIBUTE":case "HOLDOUT":case "PARTICLE_INFO":case "HAIR_INFO":case "OBJECT_INFO":case "SCRIPT":case "NEW_GEOMETRY":l=
Y(b);m=ca(b);ea.warn(h+" node is not fully supported.");break;case "BRIGHTCONTRAST":case "ADD_SHADER":case "MIX_SHADER":l=Y(b);m=ca(b);break;case "UVMAP":var p=M("param_"+h+"_a"),t=M("param_"+h+"_v");k.push(R(p));k.push(R(t));m=ca(b);n.push(R(t));p={name:p,value:b.uv_layer};break;case "UV_MERGED":p=M("param_UV_MERGED_a");t=M("param_UV_MERGED_v");k.push(R(p));k.push(R(t));m.push(U(b,"UV_geom"));m.push(U(b,"UV_cycles"));n.push(R(t));p={name:p,value:b.uv_layer};break;case "CAMERA":l=[];m=ca(b);break;
case "COMBRGB":case "COMBHSV":l=Y(b);m=ca(b);break;case "CURVE_RGB":l=Y(b);m=ca(b);ea.warn("CURVE_RGB node is not fully supported.");break;case "CURVE_VEC":l=Y(b);m=ca(b);ea.warn("CURVE_VEC node is not fully supported.");break;case "GEOMETRY":if(!I(b))return!0;h=L(b,c);if(!h)return ea.error("Geometry output is not supported"),null;switch(h){case "GEOMETRY_UV":if(!b.uv_layer)return ea.error('Missing uv layer in node "',b.name,'"'),null;p=M("param_GEOMETRY_UV_a");t=M("param_GEOMETRY_UV_v");k.push(R(p));
k.push(R(t));m.push(U(b,"UV"));n.push(R(t));p={name:p,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return ea.error("Missing vertex color layer in node ",b.name),null;p=M("param_GEOMETRY_VC_a");t=M("param_GEOMETRY_VC_v");k.push(R(p));k.push(R(t));m.push(U(b,"Vertex Color"));n.push(R(t));p={name:p,value:b.color_layer};break;case "GEOMETRY_NO":m.push(U(b,"Normal"));break;case "GEOMETRY_FB":m.push(U(b,"Front/Back"));break;case "GEOMETRY_VW":m.push(U(b,"View"));break;case "GEOMETRY_GL":m.push(U(b,
"Global"));break;case "GEOMETRY_LO":m.push(U(b,"Local"));break;case "GEOMETRY_OR":t=M("param_GEOMETRY_OR_v"),k.push(R(t)),m.push(U(b,"Orco")),n.push(R(t))}break;case "TEX_COORD":if(!I(b))return!0;h=v(b,c);if(!h)return ea.error("Texture coordinate output is not supported"),null;switch(h){case "TEX_COORD_UV":p=M("param_TEX_COORD_UV_a");t=M("param_TEX_COORD_UV_v");k.push(R(p));k.push(R(t));m.push(U(b,"UV"));n.push(R(t));p={name:p,value:b.uv_layer};break;case "TEX_COORD_NO":m.push(U(b,"Normal"));break;
case "TEX_COORD_GE":t=M("param_TEX_COORD_GE_v");k.push(R(t));m.push(U(b,"Generated"));n.push(R(t));break;case "TEX_COORD_OB":m.push(U(b,"Object"));ea.warn('Output "Object" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_CA":m.push(U(b,"Camera"));break;case "TEX_COORD_WI":m.push(U(b,"Window"));ea.warn('Output "Window" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_RE":m.push(U(b,"Reflection")),ea.warn('Output "Reflection" of node "Texture Coordinate" doesn\'t supported fully.')}break;
case "GROUP":t=b.node_tree_name;switch(t){case "B4W_LINEAR_TO_SRGB":if(!z(b,[1],[1])){p=Q(b,e,f);break}h="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!z(b,[1],[1])){p=Q(b,e,f);break}h="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!z(b,[1],[1])){p=Q(b,e,f);break}h="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!z(b,[1,1],[1])){p=Q(b,e,f);break}h="B4W_REFLECT";break;case "B4W_REFRACTION":if(!z(b,[1,0],[1])){p=Q(b,e,f);break}h="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!z(b,
[1,1,0,0,0],[1])){p=Q(b,e,f);break}var h="B4W_PARALLAX",D=M("temp_texture");n.push(R(D));break;case "B4W_CLAMP":if(!z(b,[1],[1])){p=Q(b,e,f);break}h="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!z(b,[0,0,0,0,0],[0])){p=Q(b,e,f);break}h="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!z(b,[],[0])){p=Q(b,e,f);break}h="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!z(b,[0,0,0],[0])){p=Q(b,e,f);break}h="B4W_SMOOTHSTEP";break;case "B4W_GLOW_OUTPUT":h="B4W_GLOW_OUTPUT";break;default:p=Q(b,e,f)}l=Y(b);m=ca(b);"B4W_TRANSLUCENCY"==
t&&(t=S("TranslucencyParams","TranslucencyParams",[0,0,0,0]),t.wb=m[0].wb,m.push(t));break;case "LAMP":p=b.lamp;if(!p)return ea.error("There is no lamp in node: "+b.name),null;m.push(U(b,"Color"));m.push(U(b,"Light Vector"));m.push(U(b,"Distance"));m.push(U(b,"Visibility Factor"));p.uuid in X?q.push(["LAMP_INDEX",String(X[p.uuid])]):(X[p.uuid]=Cb,q.push(["LAMP_INDEX",String(Cb++)]));p=X;break;case "LIGHTING_AMBIENT":l=[S("E","E",[0,0,0],!0),S("A","A",[0,0,0],!0),S("D","D",[0,0,0],!0)];m=[S("color",
"color",[0,0,0],!0),S("specular","specular",[0,0,0],!0)];break;case "LIGHTING_BEGIN":m=[S("E","E",[0,0,0],!0),S("A","A",[0,0,0],!0),S("D","D",[0,0,0],!0),S("S","S",[0,0,0],!0),S("normal","normal",[0,0,0],!0),S("dif_params","dif_params",[0,0],!0),S("sp_params","sp_params",[0,0],!0),S("shadow_factor","shadow_factor",0,!0),S("translucency_color","translucency_color",0,!0),S("translucency_params","translucency_params",[0,0,0,0],!0)];break;case "LIGHTING_END":l=[S("color","color",[0,0,0],!0),S("specular",
"specular",[0,0,0],!0)];break;case "LIGHTING_LAMP":l=[S("shadow_factor","shadow_factor",0,!0)];m=[S("ldir","ldir",[0,0,0],!0),S("lfac","lfac",[0,0],!0),S("lcolorint","lcolorint",[0,0,0],!0),S("norm_fac","norm_fac",0,!0)];break;case "DIFFUSE_LAMBERT":l=[S("ldir","ldir",[0,0,0],!0),S("lfac","lfac",[0,0],!0),S("normal","normal",[0,0,0],!0),S("norm_fac","norm_fac",0,!0)];m=[S("lfactor","lfactor",0,!0)];break;case "DIFFUSE_FRESNEL":case "DIFFUSE_MINNAERT":case "DIFFUSE_OREN_NAYAR":case "DIFFUSE_TOON":l=
[S("ldir","ldir",[0,0,0],!0),S("lfac","lfac",[0,0],!0),S("normal","normal",[0,0,0],!0),S("norm_fac","norm_fac",0,!0),S("dif_params","dif_params",[0,0],!0)];m=[S("lfactor","lfactor",0,!0)];break;case "SPECULAR_BLINN":case "SPECULAR_PHONG":l=[S("ldir","ldir",[0,0,0],!0),S("lfac","lfac",[0,0],!0),S("normal","normal",[0,0,0],!0),S("norm_fac","norm_fac",0,!0),S("sp_params","sp_params",[0,0],!0)];m=[S("sfactor","sfactor",0,!0)];break;case "SPECULAR_TOON":case "SPECULAR_WARDISO":l=[S("ldir","ldir",[0,0,
0],!0),S("lfac","lfac",[0,0],!0),S("normal","normal",[0,0,0],!0),S("sp_params","sp_params",[0,0],!0)];m=[S("sfactor","sfactor",0,!0)];break;case "LIGHTING_APPLY":l=[S("color","color",[0,0,0,0],!0),S("specular","specular",[0,0,0],!0),S("lfactor","lfactor",0,!0),S("sfactor","sfactor",0,!0),S("ldir","ldir",[0,0,0],!0),S("normal","normal",[0,0,0],!0),S("translucency_params","translucency_params",[0,0,0,0],!0),S("D","D",[0,0,0],!0),S("S","S",[0,0,0],!0),S("lcolorint","lcolorint",[0,0,0],!0),S("translucency_color",
"translucency_color",0,!0)];m=[S("color","color",[0,0,0,0],!0),S("specular","specular",[0,0,0],!0)];break;case "NORMAL":l=Y(b);m=ca(b);t=U(b,"Normal");n.push(R(M("param_NORMAL_Normal"),t.Ga,3));break;case "MAPPING":t=b.vector_type;h="MAPPING";l.push(T(b,"Vector"));m.push(U(b,"Vector"));var D=b.rotation,C=b.scale,r=b.translation,A=va.create(),O=K.cz(D);"TEXTURE"==t&&(C[0]=C[0]||1,C[1]=C[1]||1,C[2]=C[2]||1);var u=new Float32Array([C[0],0,0,0,C[1],0,0,0,C[2]]);va.multiply(O,u,A);A=K.oB(A,na.create());
switch(t){case "POINT":A[12]=r[0];A[13]=r[1];A[14]=r[2];break;case "TEXTURE":A[12]=r[0];A[13]=r[1];A[14]=r[2];A=na.invert(A,A);break;case "NORMAL":na.invert(A,A),na.transpose(A,A)}switch(t){case "NORMAL":q.push(["MAPPING_IS_NORMAL",1]);case "TEXTURE":q.push(["MAPPING_TRS_MATRIX",Z.r(A,16)]);break;case "POINT":0!==x.length(D)?q.push(["MAPPING_TRS_MATRIX",Z.r(A,16)]):(0!==x.length(C)&&q.push(["MAPPING_SCALE",Z.r(C,3)]),0!==x.length(r)&&q.push(["MAPPING_TRANSLATION",Z.r(r,3)]));break;case "VECTOR":0!==
x.length(D)?q.push(["MAPPING_TRS_MATRIX",Z.r(A,16)]):0!==x.length(C)&&q.push(["MAPPING_SCALE",Z.r(C,3)])}b.use_min&&q.push(["MAPPING_MIN_CLIP",Z.r(b.min,3)]);b.use_max&&q.push(["MAPPING_MAX_CLIP",Z.r(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":p=[];t=[];D=[];C=[S("E","E",[0,0,0],!0),S("A","A",[0,0,0],!0),S("D","D",[0,0,0],!0),S("S","S",[0,0,0],!0),S("normal","normal",[0,0,0],!0),S("dif_params","dif_params",[0,0],!0),S("sp_params","sp_params",[0,0],!0),S("shadow_factor","shadow_factor",0,
!0)];r=[S("color","color",[0,0,0],!0),S("specular","specular",[0,0,0],!0),S("normal","normal",[0,0,0],!0)];A=[U(b,"Color"),U(b,"Alpha"),U(b,"Normal")];O=[];u=T(b,"Color");u.Ga.splice(3);D.push(u);l.push(u);u=T(b,"Spec");u.Ga.splice(3);D.push(u);l.push(u);D.push(S("DiffuseIntensity","DiffuseIntensity",b.diffuse_intensity));l.push(u);var y=T(b,"Normal");y.Ga.splice(3);D.push(y);l.push(y);"MATERIAL_EXT"==h?((u=T(b,"Emit"))||(u=S("Emit","Emit",0)),D.push(u),l.push(u),(u=T(b,"Translucency"))?(u.Ga=0,u.name=
"Translucency",u.identifier="Translucency"):u=S("Translucency","Translucency",0),l.push(u),(u=T(b,"Translucency"))?(u.Ga=[0,0,0,0],u.name="TranslucencyParams",u.identifier="TranslucencyParams"):u=S("TranslucencyParams","TranslucencyParams",[0,0,0,0]),l.push(u),m=T(b,"Reflectivity"),u=T(b,"Ray Mirror"),m?(u=m,m="Reflectivity"):u?m="Ray Mirror":(u=m,m="Reflectivity"),u||(u=S(m,m,0)),l.push(u),r.push(u),(u=T(b,"SpecTra"))||(u=S("SpecTra","SpecTra",0)),l.push(u),r.push(u),(u=T(b,"Alpha"))||(u=S("Alpha",
"Alpha",b.alpha)),l.push(u),r.push(u),A.push(U(b,"Diffuse")),A.push(U(b,"Spec")),p.push(["MATERIAL_EXT",1]),t.push(["MATERIAL_EXT",1])):(D.push(S("emit_intensity","emit_intensity",0)),r.push(S("reflect_factor","reflect_factor",0)),r.push(S("specular_alpha","specular_alpha",0)),r.push(S("alpha_in","alpha_in",0)),A.push(S("diffuse_out","diffuse_out",0)),A.push(S("spec_out","spec_out",0)),p.push(["MATERIAL_EXT",0]),t.push(["MATERIAL_EXT",0]));O.push(R(M("param_MATERIAL_alpha"),b.alpha));O.push(R(M("param_MATERIAL_spec_alpha"),
b.specular_alpha));m=A;y.wb&&p.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&(p.push(["USE_MATERIAL_DIFFUSE",1]),t.push(["USE_MATERIAL_DIFFUSE",1]));b.use_specular&&t.push(["USE_MATERIAL_SPECULAR",1]);var u=[],w=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":y=b.specular_hardness;break;case "WARDISO":y=b.specular_slope;break;case "TOON":y=b.specular_toon_size;w=b.specular_toon_smooth;break;case "BLINN":y=b.specular_ior;w=b.specular_hardness;break;default:ea.error("unsupported specular shader: "+
b.specular_shader+' (material "'+b.material_name+'")'),y=b.specular_hardness}var ba,G;switch(b.diffuse_shader){case "LAMBERT":G=ba=0;break;case "OREN_NAYAR":ba=b.roughness;G=0;break;case "FRESNEL":ba=b.diffuse_fresnel;G=b.diffuse_fresnel_factor;break;case "MINNAERT":ba=b.darkness;G=0;break;case "TOON":ba=b.diffuse_toon_size;G=b.diffuse_toon_smooth;break;default:ea.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),G=ba=0}u.push(R(M("param_MATERIAL_diffuse"),
[ba,G],2));u.push(R(M("param_MATERIAL_spec"),[b.specular_intensity,y,w],3));y={name:b.name,value:{ni:b.specular_shader,ij:b.diffuse_shader,Zb:b.use_shadeless}};p={name:b.name,value:{ni:b.specular_shader,ij:b.diffuse_shader,Zb:b.use_shadeless},pB:{name:"material_begin",type:"MATERIAL_BEGIN",C:D,pa:C,Pa:u,data:y,ed:p,Rf:[]},qB:{name:"material_end",type:"MATERIAL_END",C:r,pa:A,Pa:O,data:y,ed:t,Rf:[]}};break;case "MATH":switch(b.operation){case "ADD":h="MATH_ADD";break;case "SUBTRACT":h="MATH_SUBTRACT";
break;case "MULTIPLY":h="MATH_MULTIPLY";break;case "DIVIDE":h="MATH_DIVIDE";break;case "SINE":h="MATH_SINE";break;case "COSINE":h="MATH_COSINE";break;case "TANGENT":h="MATH_TANGENT";break;case "ARCSINE":h="MATH_ARCSINE";break;case "ARCCOSINE":h="MATH_ARCCOSINE";break;case "ARCTANGENT":h="MATH_ARCTANGENT";break;case "POWER":h="MATH_POWER";break;case "LOGARITHM":h="MATH_LOGARITHM";break;case "MINIMUM":h="MATH_MINIMUM";break;case "MAXIMUM":h="MATH_MAXIMUM";break;case "ROUND":h="MATH_ROUND";break;case "LESS_THAN":h=
"MATH_LESS_THAN";break;case "GREATER_THAN":h="MATH_GREATER_THAN";break;case "MODULO":h="MATH_MODULO";break;case "ABSOLUTE":h="MATH_ABSOLUTE";break;default:return ea.error("Unsupported MATH operation: "+b.operation),null}q.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);l=Y(b);m=ca(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":h="MIX_RGB_MIX";break;case "ADD":h="MIX_RGB_ADD";break;case "MULTIPLY":h="MIX_RGB_MULTIPLY";break;case "SUBTRACT":h="MIX_RGB_SUBTRACT";break;case "SCREEN":h="MIX_RGB_SCREEN";
break;case "DIVIDE":h="MIX_RGB_DIVIDE";break;case "DIFFERENCE":h="MIX_RGB_DIFFERENCE";break;case "DARKEN":h="MIX_RGB_DARKEN";break;case "LIGHTEN":h="MIX_RGB_LIGHTEN";break;case "OVERLAY":h="MIX_RGB_OVERLAY";break;case "DODGE":h="MIX_RGB_DODGE";break;case "BURN":h="MIX_RGB_BURN";break;case "HUE":h="MIX_RGB_HUE";break;case "SATURATION":h="MIX_RGB_SATURATION";break;case "VALUE":h="MIX_RGB_VALUE";break;case "COLOR":h="MIX_RGB_COLOR";break;case "SOFT_LIGHT":h="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":h=
"MIX_RGB_LINEAR_LIGHT";break;default:return ea.error("Unsupported MIX_RGB blend type: "+b.blend_type),null}q.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);l=Y(b);m=ca(b);break;case "OUTPUT":l=Y(b);m=[];break;case "RGB":t=e+"%join%"+b.name;t={name:"-1",value:t};n.push(t);m.push(U(b,"Color"));break;case "SEPRGB":case "SEPHSV":l=Y(b);m=ca(b);break;case "TEXTURE":h=N(b);if("TEXTURE_EMPTY"==h)m.push(U(b,"Color")),m.push(U(b,"Normal")),m.push(U(b,"Value"));else if("TEXTURE_ENVIRONMENT"==h)l.push(T(b,
"Vector")),m.push(U(b,"Color")),m.push(U(b,"Value"));else{if("TEXTURE_NORMAL"==h&&"ENVIRONMENT_MAP"==b.texture.type)return ea.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),null;for(p=0;4>p;++p)p?(u=S("Vector"+p,"Vector"+p,[0,0,0]),"TEXTURE_COLOR"==h&&(t=S("Color"+p,"Color"+p,[0,0,0]),D=S("Value"+p,"Value"+p,0)),"TEXTURE_NORMAL"==h&&(t=S("Normal"+p,"Normal"+p,[0,0,0]),D=S("Value"+p,"Value"+p,0))):(u=T(b,"Vector"),"TEXTURE_COLOR"==h&&(t=U(b,"Color"),D=U(b,"Value")),"TEXTURE_NORMAL"==h&&
(t=U(b,"Normal"),D=U(b,"Value"))),l.push(u),m.push(t),m.push(D)}D=M("param_TEXTURE_texture");n.push(R(D));p={name:D,value:b.texture};break;case "VALTORGB":l=Y(b);m=ca(b);ea.warn("VALTORGB node is not fully supported.");break;case "VALUE":h="VALUE";t=e+"%join%"+b.name;t={name:"-1",value:t};n.push(t);m.push(U(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":h="VECT_MATH_ADD";break;case "SUBTRACT":h="VECT_MATH_SUBTRACT";break;case "AVERAGE":h="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":h=
"VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":h="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":h="VECT_MATH_NORMALIZE";break;default:return ea.error("Unsupported VECT_MATH operation: "+b.operation),null}l=Y(b);m=ca(b);break;default:l=Y(b),m=ca(b)}h={name:g,type:h,Rf:k,C:l,pa:m,Pa:n,data:p,ed:q};g=J.wj(a);J.rh(a,J.wj(a),h);if(!(h="GEOMETRY"!=b.type&&"TEX_COORD"!=b.type)){a:{h=b.outputs;for(l=k=0;l<h.length;l++)if(h[l].is_linked&&k++>c){h=!0;break a}h=!1}h=!h}return h||null!=H(a,b,++c,d,e,f)?
g:null}function z(a,b,c){for(var d=a.inputs,e=a.outputs,f=a.node_tree_name,g=0;g<b.length;g++){var h=d[g],k=b[g];if(!h||h.default_value instanceof Array!=k)return ea.warn('Wrong inputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1}for(g=0;g<c.length;g++)if(b=e[g],d=c[g],!b||b.default_value instanceof Array!=d)return ea.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1;return!0}function Q(a,b,
c){var e=a.node_group.node_tree,f={},g;for(g in e)if("links"==g||"nodes"==g){f[g]=[];for(var h=0;h<e[g].length;h++){f[g][h]={};for(var k in e[g][h])if("links"==g){f[g][h][k]={};for(var l in e[g][h][k])f[g][h][k][l]=P(e[g][h][k][l])}else f[g][h][k]=P(e[g][h][k])}}else f[g]=P(e[g]);e=a.node_tree_name;if("B4W_REPLACE"==e||"B4W_LEVELS_OF_QUALITY"==e)g=w("Group input","GROUP_INPUT",[],a.inputs),h=w("Group output","GROUP_OUTPUT",a.outputs,[]),k=null,k="B4W_REPLACE"==e||"B4W_LEVELS_OF_QUALITY"==e&&(Gb.quality==
ba.P_LOW||Gb.Gn)?{from_node:g,from_socket:g.outputs[1],to_node:h,to_socket:h.inputs[0]}:{from_node:g,from_socket:g.outputs[0],to_node:h,to_socket:h.inputs[0]},f.nodes=[g,h],f.links=[k];e=a.name;g=f.nodes;h=f.links;for(k=0;k<g.length;k++)g[k].name=pa(g[k].type,e,g[k].name);for(k=0;k<h.length;k++)h[k].from_node.name=pa(h[k].from_node.type,e,h[k].from_node.name),h[k].to_node.name=pa(h[k].to_node.type,e,h[k].to_node.name);return{AB:d(f,a.node_group.uuid,!0,b,c),BB:f.links}}function P(a){var b=typeof a;
return"string"!=b&&"number"!=b&&"boolean"!=b&&a?K.Wi(a):a}function M(a){da[a]||(da[a]=0);var b=a+da[a],b=b.replace(/ /g,"_").replace(/\//g,"_");da[a]++;return b}function I(a){a=a.outputs;for(var b=0;b<a.length;b++)if(a[b].is_linked)return!0;return!1}function L(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";
case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";case "Local":return"GEOMETRY_LO";case "Orco":return"GEOMETRY_OR";default:return null}}}function v(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "Camera":return"TEX_COORD_CA";case "Generated":return"TEX_COORD_GE";case "Normal":return"TEX_COORD_NO";case "Object":return"TEX_COORD_OB";case "Reflection":return"TEX_COORD_RE";case "UV":return"TEX_COORD_UV";case "Window":return"TEX_COORD_WI";
default:return null}}}function N(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,e=!1,f=0;f<b.length;f++){var g=b[f];if(g.is_linked)switch(g.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":e=!0;break;default:throw"Unknown texture output";}}if(c)return d&&ea.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(e)return"ENVIRONMENT_MAP"==
a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function T(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return ga(e)}return null}function U(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return ga(e)}return null}function ga(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=K.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,wb:d,Ga:a}}function S(a,b,c,d){return{name:a,identifier:b,wb:d||!1,Ga:c}}function Y(a){for(var b=
[],c=0;c<a.inputs.length;c++){var d=ga(a.inputs[c]);d.Ga.length&&d.Ga.splice(3);b.push(d)}return b}function ca(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=ga(a.outputs[c]);b.push(d)}return b}function R(a,b,c){b=null===b||void 0===b?null:Z.r(b,c);return{name:a,value:b}}function V(a,b,c,d,e,f){var g=[],h=f.from_socket.identifier;f=f.to_socket.identifier;var k=d.pa;for(d=0;d<k.length;d++)if(k[d].identifier==h){g.push(d);break}e=e.C;for(d=0;d<e.length;d++)if(e[d].identifier==f){g.push(d);break}2==
g.length&&J.Rb(a,b,c,g);return!0}function pa(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function ha(a){var b=[];J.V(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function qa(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.AB,f=c[d].data.BB;if(!e)return!1;J.V(e,function(b,c){J.rh(a,J.wj(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);O(c[d],b,a)}return!0}function ma(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+
"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function aa(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var f=c[e],g=null,h=0;h<b.length;h++)if(f.from_socket.identifier==b[h].to_socket.identifier){g=b[h];break}g?(f.from_node=g.from_node,f.from_socket=g.from_socket):d.push(f)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function fa(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function D(a,b,c,
d){for(var e=0;e<d.length;e++){for(var f=d[e],g,k=0;k<c.C.length;k++)if(f.from_socket.identifier==c.C[k].identifier){g=c.C[k].Ga;break}for(var k=f,l=b,m=g,n=h(k.to_node,l),p=0;p<n.length;p++)for(var q=J.Oa(l,n[p]),t=0;t<q.C.length;t++)if(q.C[t].identifier==k.to_socket.identifier){q.C[t].Ga=m;break}f=a.indexOf(f);-1!=f&&a.splice(f,1)}}function O(a,b,c){for(var d=a.name,e=[],f=[],g=[],h=[],k=0;k<b.length;k++){var l=b[k];ma(l.from_node,d,l,e,g,h);ma(l.to_node,d,l,f,g,h)}f=aa(b,f,g);e=aa(b,h,e);fa(b,
f);D(b,c,a,f);if(e.length){var m;J.V(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(m=b)});D(b,c,m,e)}}var ba=r("__config"),J=r("__graph"),va=r("__mat3"),na=r("__mat4"),ia=r("__objects"),ea=r("__print"),Z=r("__shaders"),la=r("__scenes"),K=r("__util"),x=r("__vec3"),da={},ra={},X={},Cb=0;new Float32Array(4);var Gb=ba.q;a.Zx=d;a.jn=function(a,c,d){if(a in ra)return ra[a];var e=J.create(),f={name:"LIGHTING_BEGIN",type:"LIGHTING_BEGIN"},g=H(e,f,0,null,c,null),f={name:"LIGHTING_END",
type:"LIGHTING_END"},f=H(e,f,0,null,c,null);b(e,d,g,f,[[g,[8,10]],[g,[9,6]]],null,c);k(e);return ra[a]=e};a.Sk=function(a){var b=[],c={};da={};var d=J.yp(a);J.V(d,function(a,d){var e;e=[];for(var f=[],g=[],h=[],k=[],l=[],m=0;m<d.C.length;m++){var n=d.C[m];if(n.wb)e.push(null),f.push(null);else{e.push(M("in_"+d.type+"_"+n.identifier));var p=Z.r(n.Ga,0);Gb.Rt&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==n.identifier||"Color2"==n.identifier||"Fac"==n.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==
n.identifier||"Value_001"==n.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==n.identifier)&&(n=p,n=n.replace(/(,)/g,"$1 "),n=n.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),n=n.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),p=n=n.replace(/\s+/g,""));f.push(p)}}for(m=0;m<d.pa.length;m++)n=d.pa[m],n.wb?g.push(null):g.push(M("out_"+d.type+"_"+n.identifier));for(m=0;m<d.Pa.length;m++)n=d.Pa[m],h.push(n.name),k.push(n.value);for(m=0;m<d.Rf.length;m++)l.push(d.Rf[m].name);
e={id:d.type,C:e,co:f,pa:g,Pa:h,Pl:k,Rf:l,ed:JSON.parse(JSON.stringify(d.ed))};b.push(e);c[a]=e});J.ce(d,function(a,b,e){var f=J.Oa(d,a);J.Oa(d,b);var g=f.pa[e[0]];a=c[a].pa;b=c[b].C;f=a[e[0]]||M("out_"+f.type+"_"+g.identifier);a[e[0]]=f;b[e[1]]=f});return b};a.Pq=function(a){if(a.node_tree)for(var b=0;b<a.node_tree.nodes.length;b++){var c=a.node_tree.nodes[b];if("GROUP"==c.type&&"B4W_GLOW_OUTPUT"==c.node_tree_name)return!0}return!1};a.cleanup=function(){for(var a in ra)delete ra[a];for(var b in X)delete X[b];
Cb=0}};b4w.module.__animation=function(a,r){function d(a,b){var c=a.H[b];c&&c.En&&c.pj&&(c.pj=!1,c.En(a,b))}function c(a,b,c){c=a.H[c];c.type=30;var d=b.G,e=b.N-d+1;c.start=d;c.length=e;c.Ec=d;c.ag=b.name;for(e=d=0;e<a.Ob.length;e++){var f=a.Ob[e];if(f==b)break;else d+=f.N-f.G+1}c.Nu=d}function b(a,b,c){for(var d=a.Z,e=0;e<d.length;e++)for(var f=d[e].S,g=0;g<f.length;g++){var h=f[g].qa;if(h&&h.name==b){var k=a.H[c];k.type=50;k.ag=h.name;k.start=h.G;k.length=h.N-k.start;h.cyclic||(k.length+=h.qo)}}}function l(a){return a.replace(/_B4W_BAKED$/,
"")}function f(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:aa.ja("Wrong animation behavior")}}function m(a){var b=[];a=a.J.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&k(d,b)}return b}function k(a,b){if(a.animation_data){var c=a.animation_data.action;c&&aa.Rd(c.fcurves)&&b.push(c)}for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];e.node_group&&(e=e.node_group.node_tree)&&k(e,b)}}function p(a){return aa.is_mesh(a)&&a.f.Ob?
!0:!1}function e(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function g(a,b,c,e){B(a,b,c,e);d(a,c);a.f.$e&&(y(a,b),t(a,b))}function h(a,b,c){var d=b.frame_range;if(d[0]>d[1])return R.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;var e=b.k,f=a.H[c];f.ag=b.name;f.Bm=d;f.jq=e.IB;f.iq=e.ox;f.Ok=e.Ok;f.start=d[0];f.length=d[1]-d[0];f.Ec=d[0];d=aa.Rd(e.Kk);if(aa.is_armature(a)&&d){f.type=10;var g=n(a,b);g||(g=q(a,b,F(a)),a.ie.push(b,g));f.i=
g.i;f.Ea=g.Ea;var f=a.f,g=f.hm,h=a.H[c],e=h.bp,k;a:{k=f.Wt;for(var l=0;l<k.length;l+=2)if(b==k[l]){k=k[l+1];break a}k=null}if(k)h.bp=k;else{for(h=0;h<g.length;h++)k=q(a,b,g[h].$c),e.push(k);f.Wt.push(b,e)}f.$e&&(b=f.nm,c>b[1]?(f=b[1],b[1]=c,b[0]=f):c>b[0]&&c<b[1]&&(b[0]=c),C(a))}else if(ha.Ce(a)&&(e.Pa.volume||e.Pa.pitch))f.volume=e.Pa.volume||null,f.pitch=e.Pa.pitch||null,f.type=40;else if("MESH"==a.type&&u(b)){f.type=60;e=n(a,b);if(!e){e=[];h=[];k=[];var l=[],m=b.k,p=a.f.Bl,t=a.f.Cl;for(g in m.Pa){var D=
b.name+"%join%"+g;E(g,D,m,h,e,p);E(g,D,m,l,k,t)}e={vE:e,values:h,lC:k,mC:l};a.ie.push(b,e)}f.Vs=e.vE;f.Xs=e.values;f.Us=e.lC;f.Ws=e.mC}else if(g=e.Pa.tsr){f.type=20;e=n(a,b);if(!e){e=b.k.ct;h=[];k=[];for(l=0;l<e;l++)h.push(g.subarray(8*l,8*l+4)),k.push(g.subarray(8*l+4,8*l+8));e={i:h,Ea:k};a.ie.push(b,e)}f.i=e.i;f.Ea=e.Ea;Y.$h(a)&&Y.bE(a,f.i[0],f.Ea[0])}else return R.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;aa.is_armature(a)&&!d&&G(a,c);return!0}function n(a,
b){for(var c=a.ie,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function C(a){var b=a.f.nm;if(-1!=b[0]&&-1!=b[1]){var c=a.H;a=c[b[1]].Ec;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.Ec;d=Math.floor(a);b.Ec=d+e}}function G(a,b){var c=a.f.nm,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.H;0<=d;d--){var f=e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function F(a){var b=a.J;a=b.data.bones;for(var b=b.pose.bones,c={},d=0;d<a.length;d++){var e=a[d].name;c[e]={Dq:d,fj:d,Mo:aa.Qn(b,
"name",e),Su:-1}}return c}function E(a,b,c,d,e,f){for(var g=0;g<f.length;g+=2)b==f[g]&&(e.push(f[g+1]),d.push(new Float32Array(c.Pa[a])))}function u(a){a=a.k;for(var b in a.Pa)if(-1!=b.indexOf("nodes"))return!0;return!1}function B(a,b,c,d){if((c=a.H[c])&&null!=c.type&&(c.play||d)){var e=a.f,f=c.Ec,g=c.start,h=c.length,f=f+c.speed*b*D.Na,k=c.type,l=c.speed;if(0<=l&&f>=g+h||0>l&&f<g)switch(d||(c.pj=!0),c.behavior){case 10:f=0<=l?(f-g)%h+g:g+h-1E-6;break;case 20:f=0<=l?g:g+h-1E-6;c.play=!1;break;case 30:f=
0<=l?g+h-1E-6:g,c.play=!1}c.Ec=f;switch(k){case 10:if(!e.$e){d=A(c,f,ba);b=d[0];f=d[1];d=d[2];e.Pc=c.Ea[b];e.Oc=c.Ea[f];e.Wc=c.i[b];e.Vc=c.i[f];e.tg=d;e=e.hm;c=c.bp;for(g=0;g<e.length;g++)h=e[g],k=c[g],h.Pc=k.Ea[b],h.Oc=k.Ea[f],h.Wc=k.i[b],h.Vc=k.i[f],h.tg=d;qa.p(a)}break;case 20:h=d=A(c,f,ba);(e=J)||(e=new Float32Array(4));var f=h[0],g=h[1],h=h[2],k=c.i,l=k[f][1],m=k[f][2],n=k[g][1],p=k[g][2];e[0]=(1-h)*k[f][0]+h*k[g][0];e[1]=(1-h)*l+h*n;e[2]=(1-h)*m+h*p;f=d;(g=na)||(g=new Float32Array(4));h=c.Ea;
V.slerp(h[f[0]].subarray(0,4),h[f[1]].subarray(0,4),f[2],g);f=g;g=d[2];h=c.i;d=(1-g)*h[d[0]][3]+g*h[d[1]][3];c.zp&&(g=va,qa.get_translation(a,g),aa.smooth_v(e,g,b,c.zp,e));c.Ro&&(g=ia,qa.get_rotation(a,g),aa.bu(f,g,b,c.Ro,f));c=c.Ok;c[0]&&qa.set_translation_rel(a,e);c[1]&&qa.set_rotation_rel(a,f);c[2]&&qa.set_scale_rel(a,d);qa.p(a);ca.sync_transform(a);break;case 30:(a=ba)||(a=Array(3));f-=c.start;0>f&&(f=0);f>=c.length&&(f=c.length);b=Math.floor(f);d=b+1;f-=b;10!=c.behavior&&d==c.length&&(d=--b,
f=1);c=c.Nu;a[0]=b+c;a[1]=d+c;a[2]=f;d=ba;e.Jp=d[0];e.Mu=d[2];break;case 40:d=A(c,f,ba);b=d[0];e=d[1];d=d[2];c.volume&&ha.set_volume(a,(1-d)*c.volume[b]+d*c.volume[e]);c.pitch&&ha.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[e]);break;case 50:Y.KC(a,c.ag,f/D.Na);break;case 60:d=A(c,f,ba);b=d[0];e=d[1];d=d[2];k=c.Xs;l=c.Vs;f=c.Ws;c=c.Us;for(g=0;g<l.length;g++)m=k[g],h=l[g],a.f.Fe[h]=(1-d)*m[b]+d*m[e];for(g=0;g<c.length;g++)k=f[g],h=c[g],k=fa.lerp(k.subarray(3*b,3*b+3),k.subarray(3*e,3*e+3),d,J),a.f.Kc[h]=
k[0],a.f.Kc[h+1]=k[1],a.f.Kc[h+2]=k[2];break;default:aa.ja("Unknown animation type:"+k)}}}function A(a,b,c){c||(c=Array(3));var d=a.Bm[0],e=a.Bm[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.jq;e=Math.floor(b);a=a.iq[e]?b-e:0;b=Math.ceil(e+a);c[0]=e;c[1]=b;c[2]=a;return c}function t(a,b){var c=a.f,d=c.Ze,e=c.nm,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var g=a.H[f];if(g.play||0==b)var h=A(g,g.Ec,ba),k=h[0],l=h[1],h=h[2],m=g.Ea[k],n=g.Ea[l],k=g.i[k],l=g.i[l];else d=1}else d=1;e=a.H[e];if(e.play||0==b)var h=A(e,e.Ec,
ba),p=h[0],q=h[1],h=h[2];else if(-1!=f&&g.play)d=0;else return;f=e.Ea[p];g=e.Ea[q];p=e.i[p];e=e.i[q];if(1==d)c.Pc.set(f),c.Oc.set(g),c.Wc.set(p),c.Vc.set(e);else if(0==d)c.Pc.set(m),c.Oc.set(n),c.Wc.set(k),c.Vc.set(l);else{for(q=0;q<m.length;q+=4){for(var t=na,D=ia,v=0;4>v;v++)t[v]=m[q+v],D[v]=f[q+v];V.slerp(t,D,d,t);for(v=0;4>v;v++)c.Pc[q+v]=t[v];for(v=0;4>v;v++)t[v]=n[q+v],D[v]=g[q+v];V.slerp(t,D,d,t);for(v=0;4>v;v++)c.Oc[q+v]=t[v]}aa.Aq(k,p,d,c.Wc);aa.Aq(l,e,d,c.Vc)}qa.p(a);d=c.hm;m=c.Qs;for(q=
0;q<d.length;q++){n=d[q];k=m[q];for(l=0;l<k.length;l+=2)for(p=k[l],f=k[l+1],g=0;4>g;g++)n.Pc[p+g]=c.Pc[f+g],n.Oc[p+g]=c.Oc[f+g],n.Wc[p+g]=c.Wc[f+g],n.Vc[p+g]=c.Vc[f+g];n.tg=h}}}function y(a,b){var c=a.f,d=c.Ze,e=c.Gm;if(0!=e){var d=c.Fm-d,f=e*b;aa.sign(d)==aa.sign(e)&&Math.abs(f)<Math.abs(d)?c.Ze+=f:(c.Ze=c.Fm,c.Gm=0)}}function q(a,b,c){for(var d=a.J.pose.bones,e=[],f=[],g=b.k.ct,h=0;h<g;h++){for(var k=0;k<d.length;k++){var l=d[k],m=ma.create(),n=b.k.Kk[l.name];n&&ma.copy(n.subarray(8*h,8*h+8),m);
l.fq=m;l.vk=!1}k=w(a,c);e.push(k.i);f.push(k.Ea)}return{i:e,Ea:f}}function w(a,b){var c=[],d=[],e=a.J.pose.bones,f=new Float32Array(4),g=new Float32Array(4),h;for(h in b){var k=b[h],l=k.fj,m=e[k.Mo],k=f,n=g,p=m.vw,q=p[p.length-1],t=q.Am;q.vk||ma.identity(t);for(q=p.length-1;0<=q;q--){var m=p[q],D=m.Am;if(m.vk)t=D;else{var v=m.gq,C=m.fq;ma.invert(v,ea);ma.multiply(C,ea,ea);ma.multiply(v,ea,ea);ma.multiply(t,ea,D);t=D;m.vk=!0}}m=m.Am;k[0]=m[0];k[1]=m[1];k[2]=m[2];k[3]=m[3];n[0]=m[4];n[1]=m[5];n[2]=
m[6];n[3]=m[7];V.normalize(n,n);for(k=0;4>k;k++)n=4*l+k,c[n]=f[k],d[n]=g[k]}c=new Float32Array(c);d=new Float32Array(d);return{i:c,Ea:d}}function H(a){var b=[0,0,0],c;for(c in a)"location"==c?b[0]=1:"rotation_quaternion"==c?b[1]=1:"scale"==c&&(b[2]=1);return b}function z(a,b,c,d,e,f,g){var h=a+(b-a)/2,k=Q(h,d,e,f,g)-c;return.02>Math.abs(k)?h:0<k?z(a,h,c,d,e,f,g):z(h,b,c,d,e,f,g)}function Q(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function P(a,b){if(!a.H.length)for(var c=0;8>
c;c++)a.H.push(null);a.H[b]={type:null,ag:null,Bm:null,jq:0,iq:null,Ok:null,Ea:null,i:null,bp:[],play:!1,behavior:20,Ec:0,start:0,length:0,zp:0,Ro:0,pj:!1,Nu:null,speed:1,volume:null,pitch:null,Xs:[],Vs:[],Ws:[],Us:[]};a.ie=a.ie||[];-1==Z.indexOf(a)&&Z.push(a)}function M(a,b){qa.p(a);ca.sync_transform(a);g(a,0,b,!0)}function I(a,d,e){e=e||0;if(aa.is_mesh(a)){var f=T(a,d);if(f)return P(a,e),c(a,f,e),M(a,e),!0;if((f=U(a,d))&&"EMITTER"==f.Io)return P(a,e),b(a,f.name,e),M(a,e),!0}if(f=aa.keysearch("name",
d,la)||aa.keysearch("name",d+"_B4W_BAKED",la)){P(a,e);if(h(a,f,e))return M(a,e),!0;a.H[e]=null}R.error('Unsupported object: "'+a.name+'" or animation name: "'+d+'"');return!1}function L(a){var b=a.J;if("MESH"!=a.type||!b.data)return!1;a=b.data.materials;if(!a)return!1;for(b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&N(d))return!0}return!1}function v(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&
d&&N(d))return!0}return!1}function N(a){var b=a.animation_data;if(b&&(b.action||b.nla_tracks&&b.nla_tracks.length))return!0;a=a.nodes;for(b=0;b<a.length;b++){var c=a[b];if(c.node_group&&(c=c.node_group.node_tree)&&N(c))return!0}return!1}function T(a,b){for(var c=0;c<a.Ob.length;c++){var d=a.Ob[c];if(d.name===b)return d}return null}function U(a,b){for(var c=a.Z,d=0;d<c.length;d++)for(var e=c[d].S,f=0;f<e.length;f++){var g=e[f].qa;if(g&&g.name===b)return g}return null}function ga(a){a=a.modifiers;for(var b=
0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}var S=r("__config"),Y=r("__particles"),ca=r("__physics"),R=r("__print"),V=r("__quat"),pa=r("__reformer"),ha=r("__sfx"),qa=r("__transform"),ma=r("__tsr"),aa=r("__util"),fa=r("__vec3"),D=S.ke,O=S.q;a.uv=1E-6;a.OBJ_ANIM_TYPE_NONE=0;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=
2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var ba=Array(3),J=new Float32Array(3),va=new Float32Array(3),na=new Float32Array(4),ia=new Float32Array(4),ea=new Float32Array(8);new Float32Array(16);var Z=[],la=[];a.Wr=function(){return aa.trunc((O.Ps-50)/4)};a.frame_to_sec=function(a){return a/D.Na};a.update=function(a){for(var b=0;b<Z.length;b++){for(var c=Z[b],e=0;8>e;e++)B(c,a,e);c.f.$e&&(y(c,a),t(c,a))}for(b=0;b<Z.length;b++)for(c=
Z[b],e=0;8>e&&c.H.length;e++)d(c,e)};a.Nr=function(){return la};a.get_anim_names=function(a){var b=[];if(p(a))for(var c=0;c<a.Ob.length;c++)b.push(a.Ob[c].name);var d,c=[];for(d=0;d<la.length;d++){var e=la[d],f=e.k;aa.Rd(e.k.Kk)?"ARMATURE"==a.type&&c.push(e):f.Pa.volume||f.Pa.pitch?ha.Ce(a)&&c.push(e):!u(e)&&aa.Rd(e.fcurves)&&c.push(e)}"MESH"==a.type&&(c=c.concat(m(a)));d=c;for(c=0;c<d.length;c++)b.push(l(d[c].name));if(Y.$h(a)&&Y.Go(a))for(a=a.Z,c=0;c<a.length;c++)for(d=a[c].S,e=0;e<d.length;e++)(f=
d[e].qa)&&b.push(f.name);return b};a.nD=l;a.get_anim_type=function(a,b){var c=a.H[b];return c?c.type:0};a.apply_def=function(a){var d=a.J,e=0,g;g=a.J;var k=[],l=g.animation_data;if(l&&l.action&&(l=l.action,aa.Rd(l.fcurves))){var n=aa.Rd(l.k.Kk);"ARMATURE"!=a.type&&n||k.push(l)}ha.Ce(a)&&g.data.animation_data&&g.data.animation_data.action&&k.push(g.data.animation_data.action);"MESH"==a.type&&(k=k.concat(m(a)));g=k;l=a.Z;for(k=0;k<l.length;k++)for(var n=l[k].S,q=0;q<n.length;q++){var t=n[q].qa;t&&"EMITTER"==
t.Io&&(P(a,e),b(a,t.name,e),M(a,e),a.H[e].behavior=f(d.b4w_anim_behavior),t.cyclic&&(a.H[e].behavior=10),e++)}for(k=0;k<g.length;k++)l=g[k],P(a,e),h(a,l,e)?(M(a,e),a.H[e].behavior=f(d.b4w_anim_behavior),e++):a.H[e]=null;p(a)&&(P(a,e),c(a,a.Ob[0],e),M(a,e),a.H[e].behavior=f(d.b4w_anim_behavior))};a.play=function(a,b,c){e(a.H,c,function(a){a.play=!0;a.En=b?b:null;a.pj=!1});a.f.$e&&C(a)};a.stop=function(a,b){e(a.H,b,function(a){a.play=!1;a.En=null;a.pj=!1})};a.is_play=function(a,b){var c=a.H[b];return c?
c.play:!1};a.set_frame=function(a,b,c){var d=a.H;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.Ec=b,g(a,0,c,!0))}else if(e=d[c])e.Ec=b,g(a,0,c,!0)};a.get_current_frame_float=function(a,b){var c=a.H[b];return c&&c.Ec?c.Ec:0};a.is_cyclic=function(a,b){var c=a.H[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){e(a.H,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.H[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){e(a.H,d,function(a){a.zp=b||0;a.Ro=c||0})};a.remove_slot_animation=
function(a,b){if(-1==b)for(var c=0;8>c;c++)a.H[c]=null;else a.H[b]=null;a.f.$e&&G(a,b)};a.update_object_animation=g;a.et=function(a){var b=a.J;if("ARMATURE"==a.type||a.Bk)return!0;var c=b.animation_data;return c&&c.action||"SPEAKER"==a.type&&b.data.animation_data&&b.data.animation_data.action||Y.$h(a)&&Y.Go(a)||"MESH"==a.type&&a.Ob.length||L(a)?!0:!1};a.Eq=function(a){if("ARMATURE"==a.type||ga(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||
Y.wx(a)&&Y.vx(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||v(a)?!0:!1};a.is_animated=function(a){return Boolean(a.H.length)};a.yx=F;a.Gq=w;a.Hw=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);V.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=4,e=0==b?3:b-1):-1<a.indexOf("scale")?(d=3,e=0):(d=0,e=b);return d+e}function d(a,b,c,e,h){if(-1<c.search(f)){a=b;c=c.split('"')[1];var k=g}else 8==h?(c="tsr",
k=g):k=1<h?new Float32Array(h):0;if(!a[c]){h=a;b=c;if("object"==typeof k&&k.length)for(var l=k.length,m=new Float32Array(e*l),n=0;n<e;n++)for(var p=0;p<l;p++)m[n*l+p]=k[p];else if("number"==typeof k)for(m=new Float32Array(e),n=0;n<e;n++)m[n]=k;else aa.ja("Wrong storage default value");h[b]=m}return a[c]}a.k={};var e=a.k;e.IB=1/D.ug;var f=new RegExp(/pose.bones\[\".+\"\]/g),g=ma.create(),h=a.fcurves,k={},l={},m=0,n;for(n in h){var p=h[n],q;for(q in p){var t=p[q],v=t.Ac;pa.Fx(t,a);t=t.num_channels;
m||(m=v.length);for(var t=d(k,l,n,m,t),C=t.length/m,r=c(n,q|0),A=0;A<m;A++)t[A*C+r]=v[A]}}for(var u in k)"tsr"==u&&b(k[u],m);for(var O in l)b(l[O],m);e.Pa=k;e.Kk=l;e.ox=a.uw;e.ct=m;e.Ok="tsr"in k?H(h):null;la.push(a)};a.Mz=function(a,b){return(b-a)*D.ug+1};a.cx=function(a,b,c,d,e,f){var g,h,k=new Float32Array(2),l=new Float32Array(2),m=new Float32Array(2),n=new Float32Array(2),p=b[1],q=b[2],t=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var v=0,C=0,r=null;e<=f;e++)if(e<p)for(var A=0;A<
D.ug;A++)c[v++]=q;else if(e>t)for(A=0;A<D.ug;A++)c[v++]=a;else{var u=b[C],O=3;0===u&&(O+=2);0===r&&(O+=2);var y=2===u?0:1;if(b[C+1]==b[C+O+1])r=u,C+=O;else{A=0;e==b[C+1]&&(y&&(d[v]=1),c[v]=b[C+2],v++,A++);if(e==t)for(;A<D.ug;A++)c[v++]=a;else for(k[0]=b[C+1],k[1]=b[C+2],0!==u?(l[0]=0,l[1]=0):0===r?(l[0]=b[C+5],l[1]=b[C+6]):(l[0]=b[C+3],l[1]=b[C+4]),0!==u?(m[0]=0,m[1]=0):(m[0]=b[C+O+3],m[1]=b[C+O+4]),n[0]=b[C+O+1],n[1]=b[C+O+2];A<D.ug;A++){var w=e+A/D.ug;switch(u){case 0:g=k;h=l;var J=m,ba=n,G=[],
B=[],E=void 0,F=void 0,N=void 0,E=void 0;G[0]=g[0]-h[0];G[1]=g[1]-h[1];B[0]=ba[0]-J[0];B[1]=ba[1]-J[1];N=ba[0]-g[0];E=Math.abs(G[0]);F=Math.abs(B[0]);0!=E+F&&E+F>N&&(E=N/(E+F),h[0]=g[0]-E*G[0],h[1]=g[1]-E*G[1],J[0]=ba[0]-E*B[0],J[1]=ba[1]-E*B[1]);y&&(d[v]=1);c[v]=Q(z(0,1,w,k[0],l[0],m[0],n[0]),k[1],l[1],m[1],n[1]);v++;break;case 1:h=k[0];J=k[1];g=ba=(n[1]-J)/(n[0]-h);h=J-ba*h;y&&(d[v]=1);c[v]=g*w+h;v++;break;case 2:y&&(d[v]=1);c[v]=b[C+2];v++;break;default:aa.ja("Unknown keyframe intepolation mode: "+
u)}}e+1==b[C+O+1]&&(r=u,C+=O)}}};a.apply=I;a.Yw=function(a,b,c){c=c||0;var d=aa.keysearch("uuid",b,la);if(d){P(a,c);if(h(a,d,c)){M(a,c);return}a.H[c]=null}R.error('Unsupported object: "'+a.name+'" or animation uuid: "'+b+'"')};a.wE=function(a,b){var c=aa.keysearch("name",b,la)||aa.keysearch("name",b+"_B4W_BAKED",la);if(c){if(!aa.Rd(c.fcurves))return!1}else if(!(U(a,b)||aa.is_mesh(a)&&T(a,b)))return!1;return!0};a.get_slot_num_by_anim=function(a,b){for(var c=a.H,d=0;d<c.length;d++){var e=c[d];if(e&&
l(e.ag)==l(b))return d}return-1};a.Kz=function(a,b){var c=a.H[b];return c&&c.ag?l(c.ag):null};a.remove=function(a){a.H.length=0;a=Z.indexOf(a);-1!=a&&Z.splice(a,1)};a.bC=function(a){for(var b=la.length-1;0<=b;b--)la[b].ww==a&&la.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.H.length)return I(a,b,0)?0:-1;for(var c=0;c<a.H.length;c++)if(!a.H[c])return I(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.f.Gm=(b-a.f.Ze)/c;a.f.Fm=b};a.set_speed=function(a,b,c){e(a.H,c,function(a){a.speed=
b})};a.get_speed=function(a,b){return a.H[b].speed};a.get_anim_start_frame=function(a,b){return a.H[b].start};a.get_anim_length=function(a,b){return a.H[b].length};a.pA=L;a.oG=v;a.cleanup=function(){Z.length=0;la.length=0};a.mz=function(a){var b=(a[0]||a[1]||a[2]).Ac.length,c=na,d=J,e=Boolean(a[0]);e||(a[0]={Ac:new Float32Array(b),num_channels:8});var f=Boolean(a[1]);f||(a[1]={Ac:new Float32Array(b),num_channels:8});var g=Boolean(a[2]);g||(a[2]={Ac:new Float32Array(b),num_channels:8});a[3]={Ac:new Float32Array(b),
num_channels:8};for(var h=0;h<b;h++)d[0]=e?a[0].Ac[h]:0,d[1]=f?a[1].Ac[h]:0,d[2]=g?a[2].Ac[h]:0,aa.euler_to_quat(d,c),a[0].Ac[h]=c[3],a[1].Ac[h]=c[0],a[2].Ac[h]=c[1],a[3].Ac[h]=c[2]};a.Pr=ga};b4w.module.__time=function(a,r){r("__print");r("__util");var d=0,c=0,b=[],l=0,f=0,m=[];a.Ot=function(a){d=a;c=performance.now();for(a=0;a<b.length;a++){var f=b[a];d>f.An&&(b.splice(a,1),a--,f.callback())}for(a=0;a<m.length;a++){var f=m[a],e=1-(f.An-d)/f.duration,e=Math.min(e,1);f.callback(f.W+e*(f.xa-f.W));1==e&&(m.splice(a,1),a--)}};a.get_timeline=function(){return d};a.set_timeout=function(a,f){var e;l++;e=l;b.push({id:e,callback:a,An:d+(performance.now()-c+f)/1E3});return e};a.clear_timeout=function(a){for(var c=
0;c<b.length;c++)if(b[c].id==a){b.splice(c,1);break}};a.clear_animation=function(a){for(var b=m.length;b--;)if(m[b].id==a){m.splice(b,1);break}};a.animate=function(a,b,c,g){c/=1E3;var h;f++;h=f;m.push({id:h,callback:g,W:a,xa:b,An:d+c,duration:c});g(a);return h};a.reset=function(){c=d=0;b.length=0;f=l=m.length=0}};b4w.module.__transform=function(a,r){function d(a,b){g.hd(a)?u.set_trans(b,g.gd(a)):y.copy(b,a.f.i)}function c(a,b){var c=a.f;if(g.hd(a)){u.set_quat(b,c.Ka);var d=g.jl(a),d=u.invert(d,z);u.multiply(d,c.Ka,g.gd(a))}else G.copy(b,c.quat)}function b(a,b){g.hd(a)?u.set_quat(b,g.gd(a)):G.copy(b,a.f.quat)}function l(a,b){g.hd(a)?u.copy(b,g.gd(a)):f(a,b)}function f(a,b){var c=a.f;c.i[0]=b[0];c.i[1]=b[1];c.i[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}function m(a,b){if(g.hd(a))u.copy(g.gd(a),
b);else{var c=a.f;u.set_sep(c.i,c.scale,c.quat,b)}return b}function k(a){var b=a.f,c=a.Z,d=a.type;"CAMERA"==d&&e.Dp(a);g.QD(a,P);"CAMERA"==d&&e.ND(a);var f=b.i,l=b.scale,m=b.quat;u.set_sep(f,l,m,b.Ka);var r=b.Y;n.fromQuat(m,r);"CAMERA"!=d&&t.sC(r,l,r);r[12]=f[0];r[13]=f[1];r[14]=f[2];n.invert(r,b.ss);b.Hb&&b.kb&&(p.Tm(b.Hb,r,b.kb),p.Vm(b.ad,r,b.Ib),p.Um(b.af,b.Ka,b.bg));switch(d){case "SPEAKER":E.dD(a,P);break;case "MESH":if(l=a.Bk)u.invert(l.f.Ka,z),u.multiply(z,b.Ka,z),q.set(z[0],z[1],z[2],z[3],
b.Im),G.set(z[4],z[5],z[6],z[7],b.Hm);break;case "CAMERA":e.OD(a);F.ha()&&(l=F.get_active(),F.xj(l)==a&&E.bB(l,f,m,P));break;case "LAMP":h.TD(a)}for(l=0;l<c.length;l++){var y=c[l];if(y.tl){var r=y.Wb,w=r.k,H=y.S;switch(d){case "LAMP":F.Of(a,r);break;case "CAMERA":F.uC(r);w.Yb&&w.Yb.enable_csm&&F.$o(r);break;case "MESH":b.Hb&&b.kb&&(b.Rc&&F.$o(r),w=y.ef,null!=b.bd&&w&&F.Bu(w,f));a.H.length&&C.Go(a)&&C.RD(a,H);break;case "EMPTY":B.Cu(a)}y=y.Bf;H=a.Vj;H.length&&y&&(w=y.j,F.Eu(y,f,m),A.Fu(H,w.fc),e.MC(w,
F.xj(r)),t.gl(w.Ed,w.tj))}}a=a.rd;for(l=0;l<a.length;l++)k(a[l]);b.In=!0}var p=r("__boundings"),e=r("__camera"),g=r("__constraints"),h=r("__lights");r("__mat3");var n=r("__mat4"),C=r("__particles"),G=r("__quat"),F=r("__scenes"),E=r("__sfx"),u=r("__tsr"),B=r("__objects"),A=r("__obj_util"),t=r("__util"),y=r("__vec3"),q=r("__vec4"),w=new Float32Array(3),H=new Float32Array(4);new Float32Array(9);var z=u.create(),Q=u.create(),P=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.SPACE_PARENT=2;a.update=function(a){P=
a};a.set_translation=function(a,b){var c=a.f;if(g.hd(a)){u.set_trans(b,c.Ka);var d=g.jl(a),d=u.invert(d,z);u.multiply(d,c.Ka,g.gd(a))}else y.copy(b,c.i)};a.set_translation_rel=d;a.get_translation=function(a,b){y.copy(a.f.i,b);return b};a.get_translation_rel=function(a,b){g.hd(a)?y.copy(u.get_trans_view(g.gd(a)),b):y.copy(a.f.i,b);return b};a.set_rotation=c;a.set_rotation_rel=b;a.get_rotation=function(a,b){G.copy(a.f.quat,b);return b};a.get_rotation_rel=function(a,b){g.hd(a)?G.copy(u.get_quat_view(g.gd(a)),
b):G.copy(a.f.quat,b);return b};a.set_rotation_euler=function(a,b){var d=t.euler_to_quat(b,H);c(a,d)};a.set_rotation_euler_rel=function(a,c){var d=t.euler_to_quat(c,H);b(a,d)};a.set_scale=function(a,b){var c=a.f;if(g.hd(a)){var c=g.gd(a),d=u.get_scale(g.jl(a));u.set_scale(b/d,c)}else c.scale=b};a.set_scale_rel=function(a,b){g.hd(a)?u.set_scale(b,g.gd(a)):a.f.scale=b};a.get_scale=function(a){return a.f.scale};a.get_scale_rel=function(a){return g.hd(a)?u.get_scale(g.gd(a)):a.f.scale};a.set_tsr=function(a,
b){var c=a.f;if(g.hd(a)){u.set_trans(trans,c.Ka);var d=g.jl(a),d=u.invert(d,z);u.multiply(d,c.Ka,g.gd(a))}else f(a,b)};a.set_tsr_rel=l;a.get_tsr=function(a,b){var c=a.f;u.set_sep(c.i,c.scale,c.quat,b);return b};a.get_tsr_rel=m;a.get_object_size=function(a){var b=a.f,c=b.th;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(a=a.f,y.copy(a.Ib.F,c)):(a=a.f,b=a.th,c[0]=
(b.max_x+b.min_x)/2,c[1]=(b.max_y+b.min_y)/2,c[2]=(b.max_z+b.min_z)/2,y.transformMat4(c,a.Y,c));return c};a.move_local=function(a,b,c,e){var f=m(a,z);w[0]=b;w[1]=c;w[2]=e;u.transform_vec3(w,f,w);d(a,w)};a.Xo=function(a,b){var c=m(a,z),d=u.set_quat(b,u.identity(Q));u.multiply(c,d,d);l(a,d)};a.p=k;a.distance=function(a,b){return y.dist(a.f.i,b.f.i)};a.DB=function(a,b){return y.dist(a.f.i,b)};a.get_object_bounding_box=function(a){return{max_x:a.f.kb.max_x,min_x:a.f.kb.min_x,max_y:a.f.kb.max_y,min_y:a.f.kb.min_y,
max_z:a.f.kb.max_z,min_z:a.f.kb.min_z}}};b4w.module.__tsr=function(a,r){function d(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3];return d}function c(a,b,c){var d=b[0],f=b[1],k=b[2],l=b[3],m=b[4],p=b[5],r=b[6];b=b[7];var A=a[0]*l,t=a[1]*l,y=a[2]*l;a=b*A+p*y-r*t;var l=b*t+r*A-m*y,q=b*y+m*t-p*A,A=-m*A-p*t-r*y;c[0]=a*b+A*-m+l*-r-q*-p;c[1]=l*b+A*-p+q*-m-a*-r;c[2]=q*b+A*-r+a*-p-l*-m;c[0]+=d;c[1]+=f;c[2]+=k;return c}var b=r("__mat4"),l=r("__quat"),f=r("__util"),m=r("__vec3"),k=new Float32Array(3),p=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.from_values=function(a,b,c,d,f,k,l,m){var p=new Float32Array(8);p[0]=a;p[1]=b;p[2]=c;p[3]=d;p[4]=f;p[5]=k;p[6]=l;p[7]=m;return p};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];return b};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.create_sep=function(a,b,c,f){f||(f=new Float32Array(8));d(a,b,c,f);return f};
a.set_sep=d;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set_scale=function(a,b){b[3]=a;return b};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set_quat=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3];return b};a.get_trans_view=function(a){return a.subarray(0,3)};a.get_scale=function(a){return a[3]};a.get_quat_view=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],f=a[1],k=a[2];p[0]=a[4];
p[1]=a[5];p[2]=a[6];p[3]=a[7];l.invert(p,p);var m=p[0],r=p[1],u=p[2],B=p[3],d=d*c,f=f*c,A=k*c,k=B*d+r*A-u*f,t=B*f+u*d-m*A,y=B*A+m*f-r*d,d=-m*d-r*f-u*A;b[0]=-(k*B+d*-m+t*-u-y*-r);b[1]=-(t*B+d*-r+y*-m-k*-u);b[2]=-(y*B+d*-u+k*-r-t*-m);b[3]=c;b[4]=m;b[5]=r;b[6]=u;b[7]=B;return b};a.to_mat4=function(a,c){var d=a[3];b.fromRotationTranslation(a.subarray(4),a.subarray(0,3),c);for(var f=0;12>f;f++)c[f]*=d;return c};a.from_mat4=function(a,b){var c=f.Th(a,k),l=f.wo(a),m=f.matrix_to_quat(a,p);d(c,l,m,b);return b};
a.multiply=function(a,b,d){c(b,a,d);d[3]=a[3]*b[3];var f=a[4],k=a[5],l=a[6];a=a[7];var m=b[4],p=b[5],r=b[6];b=b[7];d[4]=f*b+a*m+k*r-l*p;d[5]=k*b+a*p+l*m-f*r;d[6]=l*b+a*r+f*p-k*m;d[7]=a*b-f*m-k*p-l*r;return d};a.transform_vec3=c;a.transform_vec3_inv=function(a,b,c){var d=b[3],f=a[0]-b[0],k=a[1]-b[1],l=a[2]-b[2];a=b[4];var m=b[5],p=b[6];b=b[7];var r=a*a+m*m+p*p+b*b,r=r?1/r:0;a=-a*r;m=-m*r;p=-p*r;b*=r;var r=b*f+m*l-p*k,A=b*k+p*f-a*l,t=b*l+a*k-m*f,f=-a*f-m*k-p*l;c[0]=r*b+f*-a+A*-p-t*-m;c[1]=A*b+f*-m+
t*-a-r*-p;c[2]=t*b+f*-p+r*-m-A*-a;c[0]/=d;c[1]/=d;c[2]/=d;return c};a.transform_vectors=function(a,b,c,d){d||(d=0);var f=a.length,k=b[0],l=b[1],m=b[2],p=b[3],r=b[4],A=b[5],t=b[6];b=b[7];for(var y=0;y<f;y+=3){var q=a[y]*p,w=a[y+1]*p,H=a[y+2]*p,z=b*q+A*H-t*w,Q=b*w+t*q-r*H,P=b*H+r*w-A*q,q=-r*q-A*w-t*H;c[d+y]=z*b+q*-r+Q*-t-P*-A;c[d+y+1]=Q*b+q*-A+P*-r-z*-t;c[d+y+2]=P*b+q*-t+z*-A-Q*-r;c[d+y]+=k;c[d+y+1]+=l;c[d+y+2]+=m}return c};a.transform_dir_vectors=function(a,b,c,d){d||(d=0);var f=a.length,k=b[3],l=
b[4],m=b[5],p=b[6];b=b[7];for(var r=0;r<f;r+=3){var A=a[r]*k,t=a[r+1]*k,y=a[r+2]*k,q=b*A+m*y-p*t,w=b*t+p*A-l*y,H=b*y+l*t-m*A,A=-l*A-m*t-p*y;c[d+r]=q*b+A*-l+w*-p-H*-m;c[d+r+1]=w*b+A*-m+H*-l-q*-p;c[d+r+2]=H*b+A*-p+q*-m-w*-l}return c};a.transform_dir_vec3=function(a,b,c){var d=b[3],f=b[4],k=b[5],l=b[6];b=b[7];var m=a[0]*d,p=a[1]*d,r=a[2]*d;a=b*m+k*r-l*p;var d=b*p+l*m-f*r,A=b*r+f*p-k*m,m=-f*m-k*p-l*r;c[0]=a*b+m*-f+d*-l-A*-k;c[1]=d*b+m*-k+A*-f-a*-l;c[2]=A*b+m*-l+a*-k-d*-f;return c};a.transform_tangents=
function(a,b,c,d){d||(d=0);var f=a.length,k=b[3],l=b[4],m=b[5],p=b[6];b=b[7];for(var r=0;r<f;r+=4){var A=a[r]*k,t=a[r+1]*k,y=a[r+2]*k,q=b*A+m*y-p*t,w=b*t+p*A-l*y,H=b*y+l*t-m*A,A=-l*A-m*t-p*y;c[d+r]=q*b+A*-l+w*-p-H*-m;c[d+r+1]=w*b+A*-m+H*-l-q*-p;c[d+r+2]=H*b+A*-p+q*-m-w*-l;c[d+r+3]=a[r+3]}return c};a.translate=function(a,b,c){var d=a[3],f=a[4],k=a[5],l=a[6],m=a[7],p=b[0]*d,r=b[1]*d,A=b[2]*d;b=m*p+k*A-l*r;var d=m*r+l*p-f*A,t=m*A+f*r-k*p,p=-f*p-k*r-l*A;c[0]=a[0]+b*m+p*-f+d*-l-t*-k;c[1]=a[1]+d*m+p*-k+
t*-f-b*-l;c[2]=a[2]+t*m+p*-l+b*-k-d*-f;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,d){d||(d=new Float32Array(8));m.lerp(a.subarray(0,3),b.subarray(0,3),c,d.subarray(0,3));var f=a[3];d[3]=f+c*(b[3]-f);l.slerp(a.subarray(4),b.subarray(4),c,d.subarray(4));return d};a.SF=function(a,b,c,d){d||(d=new Float32Array(8));var f=a.subarray(0,3),k=b.subarray(0,3),m=d.subarray(0,3);m[0]=k[0]*(c+1)-f[0]*c;m[1]=k[1]*(c+1)-f[1]*c;m[2]=k[2]*(c+1)-f[2]*c;d[3]=b[3]*(c+1)-
a[3]*c;a=a.subarray(4);b=b.subarray(4);f=d.subarray(4);f[0]=b[0]*(c+1)-a[0]*c;f[1]=b[1]*(c+1)-a[1]*c;f[2]=b[2]*(c+1)-a[2]*c;f[3]=b[3]*(c+1)-a[3]*c;l.normalize(f,f);return d};a.zA=function(a,b,c,d,f){f[0]=a[0]+b*c[0];f[1]=a[1]+b*c[1];f[2]=a[2]+b*c[2];f[3]=a[3];c=d[0];var k=d[1];d=d[2];var l=a[4],m=a[5],p=a[6],r=a[7];f[4]=.5*(c*r+k*p-d*m);f[5]=.5*(k*r+d*l-c*p);f[6]=.5*(d*r+c*m-k*l);f[7]=.5*(-c*l-k*m-d*p);f[4]=a[4]+f[4]*b;f[5]=a[5]+f[5]*b;f[6]=a[6]+f[6]*b;f[7]=a[7]+f[7]*b;a=f[4];b=f[5];c=f[6];k=f[7];
a=a*a+b*b+c*c+k*k;0<a&&(a=1/Math.sqrt(a),f[4]*=a,f[5]*=a,f[6]*=a,f[7]*=a)}};b4w.module.__util=function(a,r){function d(a){return 0<a?1:0>a?-1:0}function c(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function b(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function l(a,b){var c=b;switch(typeof a){case "number":return f(a,c);case "string":return m(a,c);case "boolean":return f(a|0,c);case "function":case "undefined":return f(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==
a.byteLength)for(d=0;d<a.length;d++)c=f(a[d],c);else if(d)for(d=0;d<a.length;d++)c=l(a[d],c);else for(var e in a)c=l(a[e],c)}else c=f(0,c)}return c}function f(a,b){var c=b;N[0]=a;c=(c<<5)-c+T[0];c&=c;c=(c<<5)-c+T[1];return c&c}function m(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),c&=c;return c}function k(a){return(34*a+1)*a%289}function p(a){return a-Math.floor(a)}function e(a){return g((34*a+5)*a)}function g(a){return a-289*Math.floor(a/289)}function h(a){return a-7*Math.floor(a/
7)}function n(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function C(a){return n(a,0,2*Math.PI)}function G(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!F(a[c],b[c]))return!1}else if(d){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!F(a[f],
b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function F(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return G(a,b);default:return!0}}function E(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=
c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}var u=r("__mat3"),B=r("__mat4"),A=r("__print"),t=r("__quat"),y=r("__vec3"),q=r("__vec4"),w=0,H={},z=new Float32Array(3),Q=new Float32Array(3),P=new Float32Array(4),M=new Float32Array(4),I=new Float32Array(9),L=new Float32Array(16),v=new Float32Array(16),N=new Float64Array(1),T=new Uint32Array(N.buffer),U=new Float32Array([0,0,0]),ga=new Float32Array([0,0,0,1]),S=new Float32Array([0,0,0,1,0,0,0,1]),Y=new Float32Array([1,1,1]),ca=new Float32Array([1,
0,0]),R=new Float32Array([0,1,0]),V=new Float32Array([0,0,1]),pa=new Float32Array([-1,0,0]),ha=new Float32Array([0,-1,0]),qa=new Float32Array([0,0,-1]),ma=Math.floor(44488.07041494893),aa=[new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,
0,0,0,1])];a.tw=U;a.nw=ga;a.bF=S;a.bq=Y;a.AXIS_X=ca;a.AXIS_Y=R;a.AXIS_Z=V;a.AXIS_MX=pa;a.AXIS_MY=ha;a.AXIS_MZ=qa;a.dv=aa;a.keyfind=function(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d};a.oz=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.CD=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Lx=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,
!0)};a.dx=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.sign=d;a.FG=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.EG=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.Qn=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==
c)return d;return-1};a.Xw=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.yF=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.yD=function(a,b,c,d){d||(d=new Float32Array(16));B.identity(d);d[12]=a;d[13]=b;d[14]=c};var fa=1;a.ZB=function(){fa=(69069*fa+5)%Math.pow(2,32);return Math.round(fa/65536)%32768/32767};a.jD=function(a){fa=a};a.ld=function(a){var b=a[0]%ma*48271-3399*Math.floor(a[0]/ma);a[0]=0<b?b:b+2147483647;
return(a[0]-1)/2147483646};a.rl=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),g=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.cz=function(a){var b=u.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),g=Math.sin(a[1]);a=Math.sin(a[2]);var h=c*e,k=c*a,l=f*e,m=
f*a;b[0]=d*e;b[1]=d*a;b[2]=-g;b[3]=g*l-k;b[4]=g*m+h;b[5]=d*f;b[6]=g*h+m;b[7]=g*k-l;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=e*e,h=c*d+e*f;.499999<h?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=Math.PI/2):-.499999>h?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*g),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*g),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));y.transformQuat(b,a,c);return c};
a.NF=function(a,b,c){c||(c=new Float32Array(4));a=y.normalize(a,z);var d=y.dot(b,a);a=y.cross(b,a,Q);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.zD=function(a,b,c,d){d||(d=new Float32Array(4));y.transformQuat(c,b,d);d[3]=-y.dot(a,d)};a.Vy=function(a){var b=a.f.quat;switch(a.type){case "CAMERA":z[0]=0;z[1]=-1;z[2]=0;y.transformQuat(z,b,z);Q[0]=0;Q[1]=0;Q[2]=-1;break;case "MESH":z[0]=0;z[1]=0;z[2]=1;y.transformQuat(z,b,z);Q[0]=
0;Q[1]=0;Q[2]=1;break;case "EMPTY":z[0]=0,z[1]=1,z[2]=0,y.transformQuat(z,b,z),Q[0]=0,Q[1]=1,Q[2]=0}z[1]=0;y.normalize(z,z);a=y.dot(z,Q);return Math.acos(a)*(0<-z[0]*Q[2]?-1:1)};a.Aq=function(a,b,c,d){if(0!=c){d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.hH=function(){w++;return w.toString(16)};a.Bi=function(a){H[a]||(H[a]=0);var b=a+H[a];H[a]++;return b};a.sd=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.ub=function(a){var b=
{a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,O:0,na:null,B:[],M:b,aa:[]}};a.fg=function(a){return JSON.parse(JSON.stringify(a))};a.la=function(b){if(!(b instanceof Object))return b;var c;c=b.constructor;switch(c){case Float32Array:case Uint32Array:case Uint16Array:c=new c(b);break;case Array:c=new c(b.length);for(var d=0;d<b.length;d++)c[d]=a.la(b[d]);break;default:for(d in c=new c,b)c[d]=a.la(b[d])}return c};a.Wi=function(a){var b=a instanceof
Array?[]:{},c;for(c in a)if(a[c]instanceof Object){var d=a[c].constructor;switch(d){case Float32Array:case Uint32Array:case Uint16Array:b[c]=new d(a[c]);break;case Array:b[c]=a[c].slice(0);break;default:b[c]=a[c]}}else b[c]=a[c];return b};a.is_mesh=function(a){return"MESH"===a.type};a.ul=function(a){return"EMPTY"===a.type};a.is_armature=function(a){return"ARMATURE"===a.type};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));u.fromMat4(a,I);var c=I[0],d=I[3],e=I[6],f=I[1],g=I[4],h=I[7],k=I[2],
l=I[5],m=I[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+g*g+h*h)||1,k=Math.sqrt(k*k+l*l+m*m)||1;I[0]/=c;I[3]/=c;I[6]/=c;I[1]/=f;I[4]/=f;I[7]/=f;I[2]/=k;I[5]/=k;I[8]/=k;t.fromMat3(I,b);return b};a.Th=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.wo=function(a){P[0]=.577350269189626;P[1]=.577350269189626;P[2]=.577350269189626;P[3]=0;q.transformMat4(P,a,P);return q.length(P)};a.gl=function(a,b){var d=b.left,e=b.right,f=b.top,g=b.bottom,h=b.fb,k=b.cb;d[0]=a[3]+
a[0];d[1]=a[7]+a[4];d[2]=a[11]+a[8];d[3]=a[15]+a[12];e[0]=a[3]-a[0];e[1]=a[7]-a[4];e[2]=a[11]-a[8];e[3]=a[15]-a[12];f[0]=a[3]-a[1];f[1]=a[7]-a[5];f[2]=a[11]-a[9];f[3]=a[15]-a[13];g[0]=a[3]+a[1];g[1]=a[7]+a[5];g[2]=a[11]+a[9];g[3]=a[15]+a[13];h[0]=a[3]+a[2];h[1]=a[7]+a[6];h[2]=a[11]+a[10];h[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];c(d);c(e);c(f);c(g);c(h);c(k)};a.eD=function(a,c,d){return d<-b(a,c.left)||d<-b(a,c.right)||d<-b(a,c.top)||d<-b(a,c.bottom)||d<-b(a,
c.fb)||d<-b(a,c.cb)?!0:!1};a.az=function(a,c,d,e,f){g=y.dot(d,c.cb);h=y.dot(e,c.cb);k=y.dot(f,c.cb);g=Math.sqrt(g*g+h*h+k*k);if(g<-b(a,c.fb)||g<-b(a,c.cb))return!0;var g=y.dot(d,c.left),h=y.dot(e,c.left),k=y.dot(f,c.left);if(Math.sqrt(g*g+h*h+k*k)<-b(a,c.left))return!0;g=y.dot(d,c.right);h=y.dot(e,c.right);k=y.dot(f,c.right);if(Math.sqrt(g*g+h*h+k*k)<-b(a,c.right))return!0;g=y.dot(d,c.top);h=y.dot(e,c.top);k=y.dot(f,c.top);if(Math.sqrt(g*g+h*h+k*k)<-b(a,c.top))return!0;g=y.dot(d,c.bottom);h=y.dot(e,
c.bottom);k=y.dot(f,c.bottom);return Math.sqrt(g*g+h*h+k*k)<-b(a,c.bottom)?!0:!1};a.Cf=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*k+b[13];c[d+f+2]=b[2]*g+b[6]*h+b[10]*k+b[14]}};a.zE=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k}};a.vD=function(a,b,c){for(var d=0,d=
0,e=a.length,f=0;f<e;f+=4){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k;c[d+f+3]=a[f+3]}};a.xE=function(a,b,c){c||(c=new Float32Array(3));P[0]=a[0];P[1]=a[1];P[2]=a[2];P[3]=0;q.transformMat4(P,b,P);c[0]=P[0];c[1]=P[1];c[2]=P[2]};a.VF=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=
0;f<d;f++)b[e*d+f]=a[e][f];return b};a.yE=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.Gk=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.Gk(b,c,d,f-1):b[f]<c?a.Gk(b,c,f+1,e):f};a.df=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.zF=function(a,b,c){for(var d=0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;return!0};a.sC=function(a,b,c){c||(c=new Float32Array(16));for(var d=
0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.Ap=function(a,b,c,d){d||(d=new Float32Array(16));b=B.fromRotationTranslation(b,c,L);B.multiply(b,a,d)};a.transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));c=B.fromRotationTranslation(c,d,L);1!==b&&(d=B.identity(v),b=y.set(b,b,b,z),B.scale(d,b,d),B.multiply(c,d,c));y.transformMat4(a,c,e);return e};a.Bp=function(a,b,c,d){d||(d=new Float32Array(4));b=B.fromRotationTranslation(b,c,L);q.transformMat4(a,b,d)};a.xG=function(a,
b,c,d,e){e||(e=new Float32Array(3));b=B.fromRotationTranslation(c,d,L);B.invert(b,b);y.transformMat4(a,b,e);return e};a.fH=function(a,b,c){c||(c=new Float32Array(16));B.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.OG=function(b,c,d){a.Th(b,c);c[3]=a.wo(b);a.matrix_to_quat(b,d)};a.hF=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.nC=function(a,b,c,d){d||(d=new Float32Array(3));y.subtract(b,a,z);y.transformQuat(z,c,z);y.subtract(b,
z,d)};a.zz=function(){z[0]=0;z[1]=0;z[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16);B.lookAt(z,[-1,0,0],[0,-1,0],a);B.scale(a,[-1,1,1],a);B.scale(a,[-1,1,-1],b);B.lookAt(z,[0,-1,0],[0,0,-1],c);B.scale(c,[1,1,-1],c);B.scale(c,[1,-1,-1],d);B.lookAt(z,[0,0,-1],[0,-1,0],e);B.scale(e,[-1,1,1],e);B.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.Dz=function(){z[0]=0;z[1]=0;z[2]=0;var a=new Float32Array(16),
b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16);B.lookAt(z,[1,0,0],[0,-1,0],a);B.scale(a,[-1,1,-1],b);B.lookAt(z,[0,1,0],[0,0,1],c);B.scale(c,[1,-1,-1],d);B.lookAt(z,[0,0,1],[0,-1,0],e);B.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.vh=function(a,b){return l(a,b)};a.hash_code=l;a.sG=m;a.NG=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,k,l,m,n,p,q,t,v,r;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*
b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];h=a[2];k=a[3];l=a[4];m=a[5];n=a[6];p=a[7];q=a[8];t=a[9];v=a[10];r=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=k;c[4]=l;c[5]=m;c[6]=n;c[7]=p;c[8]=q;c[9]=t;c[10]=v;c[11]=r;c[12]=f*d+l*e+q*b+a[12];c[13]=g*d+m*e+t*b+a[13];c[14]=h*d+n*e+v*b+a[14];c[15]=k*d+p*e+r*b+a[15];return c};a.oB=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=
a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.Xl=function(a){return a*Math.PI/180};a.Ry=function(a){return 180*a/Math.PI};a.ep=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*
c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=b>a?1:0,g=1-f,e=b+.211324865405187-f,h=a+.211324865405187-g,l=b+-.577350269189626,m=a+-.577350269189626,c=c%289,d=d%289,n=k(k(d)+c),g=k(k(d+g)+c+f),q=k(k(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+h*h),0),f=Math.max(.5-(l*l+m*m),0),t=2*p(.024390243902439*n)-1,v=2*p(.024390243902439*g)-1,r=2*p(.024390243902439*q)-1,n=Math.abs(t)-.5,g=Math.abs(v)-.5,q=Math.abs(r)-.5,t=t-Math.floor(t+.5),v=v-Math.floor(v+.5),r=r-Math.floor(r+.5),c=c*c*c*c*
(1.79284291400159-.85373472095314*(t*t+n*n)),d=d*d*d*d*(1.79284291400159-.85373472095314*(v*v+g*g)),f=f*f*f*f*(1.79284291400159-.85373472095314*(r*r+q*q));return 130*(c*(t*b+n*a)+d*(v*e+g*h)+f*(r*l+q*m))};a.Mq=function(a){var b=1/7,c=b/2,d=g(Math.floor(a[0])),f=g(Math.floor(a[1])),k=p(a[0]);a=p(a[1]);var l=k-.5,m=k-1.5,k=a-.5;a-=1.5;var n=e(d),q=e(d+1),t=n,d=q,n=e(n+f),q=e(q+f),t=e(t+f+1),d=e(d+f+1),f=l+.7*(h(n)*b+c),v=m+.7*(h(q)*b+c),l=l+.7*(h(t)*b+c),m=m+.7*(h(d)*b+c),n=k+.7*(h(Math.floor(n*b))*
b+c),k=k+.7*(h(Math.floor(q*b))*b+c),t=a+.7*(h(Math.floor(t*b))*b+c),b=a+.7*(h(Math.floor(d*b))*b+c);return Math.min(f*f+n*n,v*v+k*k,l*l+t*t,m*m+b*b)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=y.transformQuat(b,a,z);b=c[0];var f=c[1];c=c[2];I[0]=f*f+c*c;I[1]=-f*b;I[2]=-c*b;I[3]=-b*f;I[4]=b*b+c*c;I[5]=-c*f;I[6]=-b*c;I[7]=-f*c;I[8]=b*b+f*f;y.transformMat3(a,I,a);y.normalize(a,a);t.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=
P,d=M,c=t.setAxisAngle([0,1,0],Math.PI,t.create()),d=t.setAxisAngle([1,0,0],Math.PI/2,t.create());t.multiply(c,d,c);t.multiply(a,c,b);return b};a.cleanup=function(){w=0;H={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.bu=function(a,b,c,d,e){e||(e=new Float32Array(a.length));t.slerp(a,
b,Math.exp(-c/d),e)};a.yG=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=u.fromQuat(a,I);Q[0]=0;Q[1]=1;Q[2]=0;z[0]=c[3];z[1]=c[4];z[2]=c[5];var d=y.cross(Q,z,z);y.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);Q[0]=c[0];Q[1]=c[1];Q[2]=c[2];y.normalize(Q,Q);t.rotationTo(Q,
d,M);t.multiply(M,a,a)};a.Or=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],k=a[e*b+Math.min(c+1,g)],l=a[Math.min(e+1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+k*d)*(1-f)+(l*(1-d)+a*d)*f};a.ah=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.Gt=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.Wj=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&
0<(a&2)&&c++;return c};a.Kr=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.Rd=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];y.normalize(c,c)};a.AD=function(a,b,c){var d=a[0],
e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var k=g*a-h*e,l=h*d-f*a,m=f*e-g*d,n=g*m-h*l,h=h*k-f*m,f=f*l-g*k;c[0]=d+2*k*b+2*n;c[1]=e+2*l*b+2*h;c[2]=a+2*m*b+2*f};a.assert=function(a){if(!a)throw Error("Assertion failed");};a.ja=function(a){a&&A.error.apply(A,arguments);throw"panic: see above for possible error messages";};a.angle_wrap_periodic=n;a.angle_wrap_0_2pi=C;a.On=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.nu=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=
e==f;break;case "object":d=G(e,f)}if(!d)return!1}return!0};a.Qo=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.Jr=function(a){a+=1;132651<a&&A.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d,e){P.set(a);P[3]=b;M.set(d);M[3]=0;a=q.dot(P,M);if(0==a)return null;M.set(c);M[3]=1;a=-q.dot(P,M)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};
a.aA=function(a,b,c,d){var e=b[0]-a[0],f=c[0]-a[0],g=b[1]-a[1],h=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=g*a-b*h;d[1]=f*b-e*a;d[2]=e*h-g*f;return d};a.BF=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.pC=function(a,b,c){var d=y.dot(a,b);-.9999999>d?(y.cross(ca,a,z),1E-6>y.length(z)&&y.cross(R,a,z),y.normalize(z,z),t.setAxisAngle(z,Math.PI,c)):(y.cross(a,b,z),c.set(z),c[3]=1+d,t.normalize(c,c));return c};a.bf=function(a,b,c){if(b==c)return c-a;a=C(a);b=C(b);c=C(c);var d=Math.abs(b-c);
if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-b;c=C(c+b);a=C(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a,b,c){isFinite(b)&&isFinite(c)&&(a=clamp(a,b,c));return a*a*(3-2*a)};a.lerp=function(a,b,c){return b+a*(c-b)};a.ex=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(b[d]==a[c])return!0;return!1};a.HF=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=0;return b};a.Qu=function(a,b){for(var c=Math.max(a.length,b.length),e=0;e<c;e++){var f=
d((e>=a.length?0:a[e])-(e>=b.length?0:b[e]));if(f)return f}return 0};a.Qf=function(a){return a.join(".")};a.lu=function(a){return a.split(".").map(function(a){return a|0})};a.hu=function(a,b){b[0]=Math.pow(a[0],2.2);b[1]=Math.pow(a[1],2.2);b[2]=Math.pow(a[2],2.2)};a.ro=function(a,b){b[0]=Math.pow(a[0],1/2.2);b[1]=Math.pow(a[1],1/2.2);b[2]=Math.pow(a[2],1/2.2);return b};a.Ij=function(a){var b=a.split("://",2);return 1<b.length?(b[1]=E(b[1]),b.join("://")):E(a)}};b4w.module.__sfx=function(a,r){function d(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;F.warn("deprecated WebAudio implementation");return null}F.warn("WebAudio is not supported");return null}function c(a,c,d){var e=a.w;if("NONE"!=e.behavior){d||(d=0);var g=e.loop,h=e.pitch;if(e.src&&(g||0<=d)){e.Km=Math.floor(5E4*Math.random());var l=Q.currentTime+c;e.Sc=l;e.state=20;b(a);"POSITIONAL"==e.behavior||"BACKGROUND_SOUND"==e.behavior?(c=Q.createBufferSource(),
c.buffer=e.src,c.playbackRate.value=h,g?(e.yb&&e.yb.disconnect(),c.loop=!0,c.start(l),e.duration=0):(g=c.buffer?c.buffer.duration:0,d>g?(g=l+d+e.Gc,c.loop=!0,c.start(l),c.stop(g),e.duration=d):(c.loop=!1,c.start(l),e.duration=g)),c.connect(e.qc),e.yb=c,f(e),m(e)):"BACKGROUND_MUSIC"==e.behavior&&(E.clear_timeout(e.Om),E.clear_timeout(e.Pm),d=function(){var b=a.w,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.yb=b.yb||Q.createMediaElementSource(c),b.yb.connect(b.qc),20==b.state&&(c.currentTime&&(c.currentTime=
0),c.play()))},0==c?d():e.Om=E.set_timeout(d,1E3*c),e.duration=g?0:C(a));k(e,l)}}}function b(a){var b=a.w;if(!b.qc){var c=a.f.i;a=a.f.quat;if(t.Dl){var d=Q.createBiquadFilter();d.type="peaking"}else d=null;var e=Q.createGain();switch(b.behavior){case "POSITIONAL":var f=Q.createPanner();"string"!=typeof f.panningModel?(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],c[1],c[2]);B.copy(c,b.oo);c=y;u.quat_to_dir(a,
u.AXIS_MY,c);f.setOrientation(c[0],c[1],c[2]);B.copy(c,b.direction);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.Zq;f.coneOuterAngle=b.$q;f.coneOuterGain=b.ar;var g=Q.createGain();g.gain.value=n(b);d?(f.connect(d),d.connect(g)):f.connect(g);g.connect(e);b.qc=f;if(b.kh){var h=Q.createGain();e.connect(h);h.connect(Q?P.ca.qc:null)}else h=null,e.connect(Q?P.ca.qc:null);break;case "BACKGROUND_SOUND":f=null;g=Q.createGain();g.gain.value=n(b);d?(b.qc=
d,d.connect(g)):b.qc=g;g.connect(e);b.kh?(h=Q.createGain(),e.connect(h),h.connect(Q?P.ca.qc:null)):(h=null,e.connect(Q?P.ca.qc:null));break;case "BACKGROUND_MUSIC":h=f=null,g=Q.createGain(),g.gain.value=n(b),d?(b.qc=d,d.connect(g)):b.qc=g,g.connect(e),e.connect(Q?P.ca.qc:null)}b.Nj=f;b.Qd=d;b.Ih=g;b.pg=e;b.vt=h}}function l(a){var b=a.w,d=b.duration,b=b.delay+b.qr*Math.random();c(a,b,d)}function f(a){a.kh&&a.vt.gain.cancelScheduledValues(a.Sc);a.bi&&a.yb.playbackRate.cancelScheduledValues(a.Sc);a.kk=
a.Sc}function m(a){if(a.kh||a.bi){var b=a.vt,c=a.yb,d=c.buffer?c.buffer.duration:0;if(d){var e=a.Sc;I[0]=a.Km;for(var f=0;5>f;){var g=a.pitch+a.bi*u.ld(I);if(e>=a.kk){if(a.kh){var h=1-u.clamp(a.kh,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.bi&&c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.kk=e-.001}}}function k(a,b){if(a.qg||a.Gc){var c=a.pg;c.gain.cancelScheduledValues(b);a.qg?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.qg)):c.gain.setValueAtTime(1,b);a.Gc&&!a.loop&&(c.gain.setValueAtTime(1,
b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.Gc))}}function p(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.w;if(20==b.state||40==b.state){var c=b.pg,d=Q.currentTime;b.Gc&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.Gc));"BACKGROUND_MUSIC"==b.behavior?b.src&&(E.clear_timeout(b.Om),E.clear_timeout(b.Pm),b.Pm=E.set_timeout(function(){var b=a.w.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.Gc)):(c=b.yb,b.duration<c.buffer.duration?
b.Gc&&20==b.state?c.stop(d+b.Gc):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),b.Sc=0,b.Jo=0,b.Wm=0);b.state=30}}function e(a){a=a.w;if(20==a.state){var b=Q.currentTime;a.Jo=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.Sc){I[0]=a.Km;for(var d=a.yb.buffer.duration,e=a.Sc;e<b;)c=a.pitch+a.bi*u.ld(I),e+=d/c;c*=d/c-(e-b)}else c=0;a.Wm=c;a.yb.stop(0);a.yb.disconnect();f(a)}a.state=40}}function g(a){var b=a.w;if(40==b.state){var c=Q.currentTime;b.Sc+=c-b.Jo;if("BACKGROUND_MUSIC"==
b.behavior)b.src.play();else{a=a.w;var d=Q.createBufferSource();d.loop=a.yb.loop;d.buffer=a.yb.buffer;d.playbackRate.value=a.yb.playbackRate.value;a.Nj?d.connect(a.Nj):d.connect(a.Ih);a.yb=d;b.kk=c;b.yb.start(b.Sc,b.Wm);m(b)}k(b,b.Sc);b.state=20}}function h(a){return!a.w||20!=a.w.state&&40!=a.w.state&&30!=a.w.state?!1:!0}function n(a){return a.muted?0:a.volume}function C(a){a=a.w;return(a=a.src)?a.duration:0}var G=r("__config"),F=r("__print"),E=r("__time"),u=r("__util"),B=r("__vec3"),A=G.q,t=G.w;
a.Up=10;a.um=20;a.Tp=30;var y=new Float32Array(3),q=new Float32Array(3),w=new Float32Array(3),H=[],z=[],Q=null,P=null,M=[],I=[1],L=null;a.wy=function(){return{behavior:"NONE",mg:!1,muted:!1,volume:1,pitch:1,attenuation:1,dist_ref:1,dist_max:1E4,Zq:360,$q:360,ar:1,cyclic:!1,loop:!1,delay:0,qr:0,kh:0,bi:0,qg:0,Gc:0,Sc:0,Jo:0,Wm:0,duration:0,kk:0,Km:1,src:null,state:10,oo:new Float32Array(3),direction:new Float32Array(3),hp:new Float32Array(3),Om:-1,Pm:-1,og:0}};a.init=function(){var a=document.createElement("audio"),
b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(H.push("ogg"),H.push("ogv")),""!=a.canPlayType("audio/mpeg")&&H.push("mp3"),""!=a.canPlayType("audio/mp4")&&(H.push("mp4"),H.push("m4v")),""!=a.canPlayType("audio/webm")&&H.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&z.push("ogv"),""!=b.canPlayType("video/mp4")&&z.push("m4v"),""!=b.canPlayType("video/webm")&&z.push("webm"));(Q=t.Pp?d():null)&&F.log("%cINIT WEBAUDIO: "+Q.sampleRate+"Hz","color: #00a")};
a.sq=function(a){var b={Hg:new Float32Array(3),Ks:new Float32Array(3),Sh:new Float32Array(3)};a.ca=b;if(Q){var c=Q.createGain(),d=Q.createGain();b.Ih=c;b.pg=d;c.connect(d);d.connect(Q.destination);if(a.b4w_enable_dynamic_compressor){var d=Q.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.bj=d;b.qc=d}else b.bj=null,b.qc=c;c=Q.listener;b.mg=A.un;b.mg||
(c.dopplerFactor=a.audio_doppler_factor,c.speedOfSound=a.audio_doppler_speed);b.muted=!1;b.volume=1;b.og=0}};a.xC=function(a){P=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<H.indexOf(a)?a:"ogg"==a&&-1<H.indexOf("mp4")?"mp4":"mp3"==a&&-1<H.indexOf("ogg")?"ogg":"mp4"==a&&-1<H.indexOf("ogg")?"ogg":"ogv"==a&&-1<H.indexOf("m4v")?"m4v":"webm"==a&&-1<H.indexOf("m4v")?"m4v":"m4v"==a&&-1<H.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<z.indexOf(a)?
a:"ogv"==a&&-1<z.indexOf("m4v")?"m4v":"webm"==a&&-1<z.indexOf("m4v")?"m4v":"m4v"==a&&-1<z.indexOf("webm")?"webm":""};a.Ep=function(a,b){if("SPEAKER"!=b.type)throw"Wrong speaker object";var c=a.data,d=b.w;switch(c.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":d.behavior=Q?c.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var e;Q?(window.MediaElementAudioSourceNode?e=!0:(F.warn("MediaElementAudioSourceNode not found"),e=!1),e=e?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):e="NONE";d.behavior=
e;break;default:throw"Wrong speaker behavior";}c.sound||(d.behavior="NONE");d.mg=c.b4w_disable_doppler||A.un;d.muted=c.muted;d.volume=c.volume;d.pitch=c.pitch;d.attenuation=c.attenuation;d.dist_ref=c.distance_reference;d.dist_max=c.distance_max||1E4;d.Zq=c.cone_angle_inner;d.$q=c.cone_angle_outer;d.ar=c.cone_volume_outer;d.cyclic=c.b4w_cyclic_play;d.loop=c.b4w_loop;d.delay=c.b4w_delay;d.qr=c.b4w_delay_random;d.kh=c.b4w_volume_random;d.bi=c.b4w_pitch_random;d.qg=c.b4w_fade_in;d.Gc=c.b4w_fade_out;M.push(b)};
a.du=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.w.behavior){case "POSITIONAL":return a.um;case "BACKGROUND_SOUND":return a.um;case "BACKGROUND_MUSIC":return a.Tp;case "NONE":return a.Up;default:throw"Wrong speaker behavior";}};a.aE=function(a,b){var c=a.w;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.PB=function(){var a=Q.createBufferSource();a.buffer=Q.createBuffer(1,
22050,22050);a.connect(Q.destination);a.start(0)};a.Oy=function(a,b,c){Q?Q.decodeAudioData(a,b,c):c()};a.bD=function(a){p(a);a.w=null;M.splice(M.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<M.length;a++){var b=M[a].w;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.yb&&b.yb.disconnect()}P&&P.ca&&(a=P.ca,a.Hg[0]=0,a.Hg[1]=0,a.Hg[2]=0,a.Sh[0]=0,a.Sh[1]=0,a.Sh[2]=0);P=null;M.splice(0);L=null};a.update=function(a){if(Q&&0!=M.length){for(var b=0;b<M.length;b++){var c=M[b],d=c.w,e=Q.currentTime;
Q&&!d.loop&&d.cyclic&&20==d.state&&d.duration&&d.Sc+d.duration<e&&l(c);20==d.state&&3>d.kk-e&&m(d)}L&&L.Me.length&&(-1==L.Za||a>L.kq+L.tr[L.Za])&&(b=L,-1<b.Za&&p(b.Me[b.Za]),-1==b.Za&&b.random?c=Math.round(Math.random()*(b.Me.length-1)):b.random?(c=1+Math.round(Math.random()*(b.Me.length-2)),c=(b.Za+c)%b.Me.length):c=(b.Za+1)%b.Me.length,l(b.Me[c]),b.Za=c,b.kq=a)}};a.play=c;a.play_def=l;a.stop=p;a.is_play=function(a){return 20==a.w.state};a.aD=e;a.cD=g;a.playrate=function(a,b){var c=a.w;c.pitch=b;
!h(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.yb.playbackRate.value=b,f(c),m(c))};a.get_playrate=function(a){return a.w.pitch};a.cyclic=function(a,b){a.w.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.w.cyclic};a.bB=function(a,b,c,d){if(Q&&a.ca){var e=y;e[0]=0;e[1]=-1;e[2]=0;B.transformQuat(e,c,e);q[0]=0;q[1]=0;q[2]=-1;B.transformQuat(q,c,q);c=Q.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],q[0],q[1],q[2]);B.copy(e,a.ca.Ks);!a.ca.mg&&d&&(w[0]=(b[0]-
a.ca.Hg[0])/d,w[1]=(b[1]-a.ca.Hg[1])/d,w[2]=(b[2]-a.ca.Hg[2])/d,u.smooth_v(w,a.ca.Sh,d,.3,w),c.setVelocity(w[0],w[1],w[2]),B.copy(w,a.ca.Sh));B.copy(b,a.ca.Hg)}};a.listener_reset_speed=function(a,b){if(Q&&P.ca&&!P.ca.mg){var c=y;b?B.copy(b,c):B.copy(P.ca.Ks,c);B.scale(c,a,c);Q.listener.setVelocity(c[0],c[1],c[2]);B.copy(c,P.ca.Sh)}};a.dD=function(a,b){var c=a.w;if(h(a)&&"POSITIONAL"==c.behavior){var d=a.f.i,e=c.Nj;e.setPosition(d[0],d[1],d[2]);var f=y;u.quat_to_dir(a.f.quat,u.AXIS_MY,f);e.setOrientation(f[0],
f[1],f[2]);f=c.oo;!c.mg&&b&&(q[0]=(d[0]-f[0])/b,q[1]=(d[1]-f[1])/b,q[2]=(d[2]-f[2])/b,u.smooth_v(q,c.hp,b,.3,q),e.setVelocity(q[0],q[1],q[2]),B.copy(q,c.hp));B.copy(d,f)}};a.speaker_reset_speed=function(a,b,c){var d=a.w;if(h(a)&&"POSITIONAL"==d.behavior&&!d.mg){var e=y;c?B.copy(c,e):B.copy(d.direction,e);B.scale(e,b,e);d.Nj.setVelocity(e[0],e[1],e[2]);B.copy(e,d.hp);B.copy(a.f.i,d.oo)}};a.Ce=function(a){return a.w?!0:!1};a.Rn=function(a){return a.w.behavior};a.check_active_speakers=function(){for(var a=
0;a<M.length;a++)if(h(M[a]))return!0;return!1};a.HC=function(a){var b=P.ca;b&&(b.volume=a,Q&&(b.Ih.gain.value=n(b)))};a.$z=function(){var a=P.ca;return a?a.volume:0};a.set_volume=function(a,b){var c=a.w;c.volume=b;h(a)&&(c.Ih.gain.value=n(c))};a.get_volume=function(a){return a.w.volume};a.mute=function(a,b){a.w.muted=Boolean(b);h(a)&&(a.w.Ih.gain.value=n(a.w))};a.is_muted=function(a){return a.w.muted};a.yB=function(a){var b=P.ca;b&&(b.muted=Boolean(a),Q&&(b.Ih.gain.value=n(b)))};a.HA=function(){var a=
P.ca;return a?a.muted:!1};a.get_speaker_objects=function(){return M};a.pause=function(){for(var a=0;a<M.length;a++)e(M[a])};a.resume=function(){for(var a=0;a<M.length;a++)g(M[a])};a.set_compressor_params=function(a,b){if(a.ca&&a.ca.bj){var c=a.ca.bj;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.ca||!a.ca.bj)return null;a=a.ca.bj;return{threshold:a.threshold.value,knee:a.knee.value,
ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(h(a)){a=a.w;var d=a.pg,e=Q.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.og=c}};a.unduck=function(a){if(h(a)){a=a.w;var b=a.pg,c=Q.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.og);a.og=0}};a.Xy=function(a,b){if(Q){var c=P.ca,d=c.pg,e=Q.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+
b);c.og=b}};a.DD=function(){if(Q){var a=P.ca,b=a.pg,c=Q.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.og);a.og=0}};a.apply_playlist=function(a,b,c){L={Za:-1,kq:0,random:c,Me:[],tr:[]};for(c=0;c<a.length;c++){var d=a[c],e=C(d);0==e?F.warn("Ignoring speaker with zero duration: "+d.name):(p(d),d.w.cyclic=!1,L.Me.push(d),L.tr.push(e+b))}};a.get_duration=C;a.clear_playlist=function(){if(L)for(var a=L.Me,b=0;b<a.length;b++)p(a[b]);L=null};a.get_positional_params=
function(a){return(a=a.w)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.w;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.Nj;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.w;c&&c.Qd&&(c.Qd.frequency.value=b.freq,c.Qd.Q.value=b.Q,c.Qd.gain.value=b.gain)};a.get_filter_params=
function(a){return(a=a.w)&&a.Qd?{freq:a.Qd.frequency.value,Q:a.Qd.Q.value,gain:a.Qd.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.w;if(!a||!a.Qd)return null;a.Qd.getFrequencyResponse(b,c,d)}};b4w.module.__vec3=function(a){var r="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new r(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var b=new r(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.fromValues=function(a,b,d){var f=new r(3);f[0]=a;f[1]=b;f[2]=d;return f};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set=function(a,b,d,f){f[0]=a;f[1]=b;f[2]=d;return f};a.add=function(a,b,d){d[0]=a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];
return d};a.subtract=function(a,b,d){d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];return d};a.sub=a.subtract;a.multiply=function(a,b,d){d[0]=a[0]*b[0];d[1]=a[1]*b[1];d[2]=a[2]*b[2];return d};a.mul=a.multiply;a.divide=function(a,b,d){d[0]=a[0]/b[0];d[1]=a[1]/b[1];d[2]=a[2]/b[2];return d};a.div=a.divide;a.min=function(a,b,d){d[0]=Math.min(a[0],b[0]);d[1]=Math.min(a[1],b[1]);d[2]=Math.min(a[2],b[2]);return d};a.max=function(a,b,d){d[0]=Math.max(a[0],b[0]);d[1]=Math.max(a[1],b[1]);d[2]=Math.max(a[2],
b[2]);return d};a.scale=function(a,b,d){d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;return d};a.scaleAndAdd=function(a,b,d,f){f[0]=a[0]+b[0]*d;f[1]=a[1]+b[1]*d;f[2]=a[2]+b[2]*d;return f};a.distance=function(a,b){var d=b[0]-a[0],f=b[1]-a[1],m=b[2]-a[2];return Math.sqrt(d*d+f*f+m*m)};a.dist=a.distance;a.squaredDistance=function(a,b){var d=b[0]-a[0],f=b[1]-a[1],m=b[2]-a[2];return d*d+f*f+m*m};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],d=a[1];a=a[2];return Math.sqrt(b*b+d*d+a*a)};a.len=a.length;
a.squaredLength=function(a){var b=a[0],d=a[1];a=a[2];return b*b+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];return b};a.normalize=function(a,b){var d=a[0],f=a[1],m=a[2],d=d*d+f*f+m*m;0<d&&(d=1/Math.sqrt(d),b[0]=a[0]*d,b[1]=a[1]*d,b[2]=a[2]*d);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};a.cross=function(a,b,d){var f=a[0],m=a[1];a=a[2];var k=b[0],p=b[1];b=b[2];
d[0]=m*b-a*p;d[1]=a*k-f*b;d[2]=f*p-m*k;return d};a.lerp=function(a,b,d,f){var m=a[0],k=a[1];a=a[2];f[0]=m+d*(b[0]-m);f[1]=k+d*(b[1]-k);f[2]=a+d*(b[2]-a);return f};a.random=function(a,b){a=a||1;var l=2*d()*Math.PI,f=2*d()-1,m=Math.sqrt(1-f*f)*a;b[0]=Math.cos(l)*m;b[1]=Math.sin(l)*m;b[2]=f*a;return b};a.transformMat4=function(a,b,d){var f=a[0],m=a[1];a=a[2];var k=b[3]*f+b[7]*m+b[11]*a+b[15],k=k||1;d[0]=(b[0]*f+b[4]*m+b[8]*a+b[12])/k;d[1]=(b[1]*f+b[5]*m+b[9]*a+b[13])/k;d[2]=(b[2]*f+b[6]*m+b[10]*a+b[14])/
k;return d};a.transformMat3=function(a,b,d){var f=a[0],m=a[1];a=a[2];d[0]=f*b[0]+m*b[3]+a*b[6];d[1]=f*b[1]+m*b[4]+a*b[7];d[2]=f*b[2]+m*b[5]+a*b[8];return d};a.transformQuat=function(a,b,d){var f=a[0],m=a[1],k=a[2];a=b[0];var p=b[1],e=b[2];b=b[3];var g=b*f+p*k-e*m,h=b*m+e*f-a*k,n=b*k+a*m-p*f,f=-a*f-p*m-e*k;d[0]=g*b+f*-a+h*-e-n*-p;d[1]=h*b+f*-p+n*-a-g*-e;d[2]=n*b+f*-e+g*-p-h*-a;return d};a.rotateX=function(a,b,d,f){var m=[],k=[];m[0]=a[0]-b[0];m[1]=a[1]-b[1];m[2]=a[2]-b[2];k[0]=m[0];k[1]=m[1]*Math.cos(d)-
m[2]*Math.sin(d);k[2]=m[1]*Math.sin(d)+m[2]*Math.cos(d);f[0]=k[0]+b[0];f[1]=k[1]+b[1];f[2]=k[2]+b[2];return f};a.rotateY=function(a,b,d,f){var m=[],k=[];m[0]=a[0]-b[0];m[1]=a[1]-b[1];m[2]=a[2]-b[2];k[0]=m[2]*Math.sin(d)+m[0]*Math.cos(d);k[1]=m[1];k[2]=m[2]*Math.cos(d)-m[0]*Math.sin(d);f[0]=k[0]+b[0];f[1]=k[1]+b[1];f[2]=k[2]+b[2];return f};a.rotateZ=function(a,b,d,f){var m=[],k=[];m[0]=a[0]-b[0];m[1]=a[1]-b[1];m[2]=a[2]-b[2];k[0]=m[0]*Math.cos(d)-m[1]*Math.sin(d);k[1]=m[0]*Math.sin(d)+m[1]*Math.cos(d);
k[2]=m[2];f[0]=k[0]+b[0];f[1]=k[1]+b[1];f[2]=k[2]+b[2];return f};a.forEach=function(){var c=a.create();return function(a,d,f,m,k,p){d||(d=3);f||(f=0);for(m=m?Math.min(m*d+f,a.length):a.length;f<m;f+=d)c[0]=a[f],c[1]=a[f+1],c[2]=a[f+2],k(c,p,c),a[f]=c[0],a[f+1]=c[1],a[f+2]=c[2];return a}}();a.fF=function(c,b){var d=a.fromValues(c[0],c[1],c[2]),f=a.fromValues(b[0],b[1],b[2]);a.normalize(d,d);a.normalize(f,f);d=a.dot(d,f);return 1<d?0:Math.acos(d)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+
a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};b4w.module.vec3=b4w.module.__vec3;
b4w.module.__vec4=function(a){var r="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new r(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var b=new r(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=function(a,b,d,f){var m=new r(4);m[0]=a;m[1]=b;m[2]=d;m[3]=f;return m};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set=function(a,b,d,f,m){m[0]=a;m[1]=b;m[2]=d;m[3]=f;return m};a.add=function(a,b,d){d[0]=
a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];d[3]=a[3]+b[3];return d};a.subtract=function(a,b,d){d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];d[3]=a[3]-b[3];return d};a.sub=a.subtract;a.multiply=function(a,b,d){d[0]=a[0]*b[0];d[1]=a[1]*b[1];d[2]=a[2]*b[2];d[3]=a[3]*b[3];return d};a.mul=a.multiply;a.divide=function(a,b,d){d[0]=a[0]/b[0];d[1]=a[1]/b[1];d[2]=a[2]/b[2];d[3]=a[3]/b[3];return d};a.div=a.divide;a.min=function(a,b,d){d[0]=Math.min(a[0],b[0]);d[1]=Math.min(a[1],b[1]);d[2]=Math.min(a[2],b[2]);d[3]=
Math.min(a[3],b[3]);return d};a.max=function(a,b,d){d[0]=Math.max(a[0],b[0]);d[1]=Math.max(a[1],b[1]);d[2]=Math.max(a[2],b[2]);d[3]=Math.max(a[3],b[3]);return d};a.scale=function(a,b,d){d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;d[3]=a[3]*b;return d};a.scaleAndAdd=function(a,b,d,f){f[0]=a[0]+b[0]*d;f[1]=a[1]+b[1]*d;f[2]=a[2]+b[2]*d;f[3]=a[3]+b[3]*d;return f};a.distance=function(a,b){var d=b[0]-a[0],f=b[1]-a[1],m=b[2]-a[2],k=b[3]-a[3];return Math.sqrt(d*d+f*f+m*m+k*k)};a.dist=a.distance;a.squaredDistance=
function(a,b){var d=b[0]-a[0],f=b[1]-a[1],m=b[2]-a[2],k=b[3]-a[3];return d*d+f*f+m*m+k*k};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],d=a[1],f=a[2];a=a[3];return Math.sqrt(b*b+d*d+f*f+a*a)};a.len=a.length;a.squaredLength=function(a){var b=a[0],d=a[1],f=a[2];a=a[3];return b*b+d*d+f*f+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];b[3]=1/a[3];return b};a.normalize=
function(a,b){var d=a[0],f=a[1],m=a[2],k=a[3],d=d*d+f*f+m*m+k*k;0<d&&(d=1/Math.sqrt(d),b[0]=a[0]*d,b[1]=a[1]*d,b[2]=a[2]*d,b[3]=a[3]*d);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};a.lerp=function(a,b,d,f){var m=a[0],k=a[1],p=a[2];a=a[3];f[0]=m+d*(b[0]-m);f[1]=k+d*(b[1]-k);f[2]=p+d*(b[2]-p);f[3]=a+d*(b[3]-a);return f};a.random=function(c,b){c=c||1;b[0]=d();b[1]=d();b[2]=d();b[3]=d();a.normalize(b,b);a.scale(b,c,b);return b};a.transformMat4=function(a,b,d){var f=a[0],
m=a[1],k=a[2];a=a[3];d[0]=b[0]*f+b[4]*m+b[8]*k+b[12]*a;d[1]=b[1]*f+b[5]*m+b[9]*k+b[13]*a;d[2]=b[2]*f+b[6]*m+b[10]*k+b[14]*a;d[3]=b[3]*f+b[7]*m+b[11]*k+b[15]*a;return d};a.transformQuat=function(a,b,d){var f=a[0],m=a[1],k=a[2],p=b[0],e=b[1],g=b[2];b=b[3];var h=b*f+e*k-g*m,n=b*m+g*f-p*k,r=b*k+p*m-e*f,f=-p*f-e*m-g*k;d[0]=h*b+f*-p+n*-g-r*-e;d[1]=n*b+f*-e+r*-p-h*-g;d[2]=r*b+f*-g+h*-e-n*-p;d[3]=a[3];return d};a.forEach=function(){var c=a.create();return function(a,d,f,m,k,p){d||(d=4);f||(f=0);for(m=m?Math.min(m*
d+f,a.length):a.length;f<m;f+=d)c[0]=a[f],c[1]=a[f+1],c[2]=a[f+2],c[3]=a[f+3],k(c,p,c),a[f]=c[0],a[f+1]=c[1],a[f+2]=c[2],a[f+3]=c[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};b4w.module.vec4=b4w.module.__vec4;
b4w.module.__quat=function(a,r){var d=r("__vec3"),c=r("__vec4"),b=r("__mat3"),l="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new l(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=d.create(),c=d.fromValues(1,0,0),k=d.fromValues(0,1,0);return function(l,e,g){var h=d.dot(l,e);if(-.9999999>h)return d.cross(c,l,b),1E-6>d.length(b)&&d.cross(k,l,b),d.normalize(b,b),a.setAxisAngle(b,Math.PI,g),g;if(.9999999<h)return g[0]=0,g[1]=0,g[2]=0,g[3]=1,g;d.cross(l,
e,b);g[0]=b[0];g[1]=b[1];g[2]=b[2];g[3]=1+h;return a.normalize(g,g)}}();a.setAxes=function(){var c=b.create();return function(b,d,l,e){c[0]=d[0];c[3]=d[1];c[6]=d[2];c[1]=l[0];c[4]=l[1];c[7]=l[2];c[2]=-b[0];c[5]=-b[1];c[8]=-b[2];return a.normalize(a.fromMat3(c,e),e)}}();a.clone=c.clone;a.fromValues=c.fromValues;a.copy=c.copy;a.set=c.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=c.add;a.multiply=function(a,b,c){var d=a[0],e=a[1],g=a[2];a=a[3];var h=b[0],l=b[1],r=b[2];b=b[3];c[0]=d*b+a*h+e*r-g*l;c[1]=e*b+a*l+g*h-d*r;c[2]=g*b+a*r+d*l-e*h;c[3]=a*b-d*h-e*l-g*r;return c};a.mul=a.multiply;a.scale=c.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],e=a[1],g=a[2];a=a[3];var h=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*h;c[1]=e*b+g*h;c[2]=g*b-e*h;c[3]=a*b-d*h;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],e=a[1],g=a[2];a=a[3];var h=Math.sin(b);b=Math.cos(b);c[0]=d*
b-g*h;c[1]=e*b+a*h;c[2]=g*b+d*h;c[3]=a*b-e*h;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],e=a[1],g=a[2];a=a[3];var h=Math.sin(b);b=Math.cos(b);c[0]=d*b+e*h;c[1]=e*b-d*h;c[2]=g*b+a*h;c[3]=a*b-g*h;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];b[0]=c;b[1]=d;b[2]=e;b[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};a.dot=c.dot;a.lerp=c.lerp;a.slerp=function(a,b,c,d){var e=a[0],g=a[1],h=a[2];a=a[3];var l=b[0],r=b[1],G=b[2];b=b[3];var F,E,u;E=e*l+g*r+h*G+a*b;0>E&&(E=-E,l=-l,r=-r,
G=-G,b=-b);1E-6<1-E?(F=Math.acos(E),u=Math.sin(F),E=Math.sin((1-c)*F)/u,c=Math.sin(c*F)/u):E=1-c;d[0]=E*e+c*l;d[1]=E*g+c*r;d[2]=E*h+c*G;d[3]=E*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],e=a[2],g=a[3],h=c*c+d*d+e*e+g*g,h=h?1/h:0;b[0]=-c*h;b[1]=-d*h;b[2]=-e*h;b[3]=g*h;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=c.length;a.len=a.length;a.squaredLength=c.squaredLength;a.sqrLen=a.squaredLength;a.normalize=c.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var e=(d+1)%3,g=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*e+e]-a[3*g+g]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*e+g]-a[3*g+e])*c;b[e]=(a[3*e+d]+a[3*d+e])*c;b[g]=(a[3*g+d]+a[3*d+g])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};b4w.module.quat=b4w.module.__quat;
b4w.module.__mat3=function(a){var r="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new r(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[4];c[4]=a[5];c[5]=a[6];c[6]=a[8];c[7]=a[9];c[8]=a[10];return c};a.clone=function(a){var c=new r(9);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=
a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,c){if(c===a){var b=a[1],l=a[2],f=a[5];c[1]=a[3];c[2]=a[6];c[3]=b;c[5]=a[7];c[6]=l;c[7]=f}else c[0]=a[0],c[1]=a[3],c[2]=a[6],c[3]=a[1],c[4]=a[4],c[5]=a[7],c[6]=a[2],c[7]=a[5],c[8]=a[8];return c};a.invert=function(a,c){var b=a[0],l=a[1],f=a[2],m=a[3],k=a[4],p=a[5],e=a[6],g=a[7],h=a[8],n=h*k-p*g,r=-h*m+p*e,G=
g*m-k*e,F=b*n+l*r+f*G;if(!F)return null;F=1/F;c[0]=n*F;c[1]=(-h*l+f*g)*F;c[2]=(p*l-f*k)*F;c[3]=r*F;c[4]=(h*b-f*e)*F;c[5]=(-p*b+f*m)*F;c[6]=G*F;c[7]=(-g*b+l*e)*F;c[8]=(k*b-l*m)*F;return c};a.adjoint=function(a,c){var b=a[0],l=a[1],f=a[2],m=a[3],k=a[4],p=a[5],e=a[6],g=a[7],h=a[8];c[0]=k*h-p*g;c[1]=f*g-l*h;c[2]=l*p-f*k;c[3]=p*e-m*h;c[4]=b*h-f*e;c[5]=f*m-b*p;c[6]=m*g-k*e;c[7]=l*e-b*g;c[8]=b*k-l*m;return c};a.determinant=function(a){var c=a[3],b=a[4],l=a[5],f=a[6],m=a[7],k=a[8];return a[0]*(k*b-l*m)+a[1]*
(-k*c+l*f)+a[2]*(m*c-b*f)};a.multiply=function(a,c,b){var l=a[0],f=a[1],m=a[2],k=a[3],p=a[4],e=a[5],g=a[6],h=a[7];a=a[8];var n=c[0],r=c[1],G=c[2],F=c[3],E=c[4],u=c[5],B=c[6],A=c[7];c=c[8];b[0]=n*l+r*k+G*g;b[1]=n*f+r*p+G*h;b[2]=n*m+r*e+G*a;b[3]=F*l+E*k+u*g;b[4]=F*f+E*p+u*h;b[5]=F*m+E*e+u*a;b[6]=B*l+A*k+c*g;b[7]=B*f+A*p+c*h;b[8]=B*m+A*e+c*a;return b};a.mul=a.multiply;a.translate=function(a,c,b){var l=a[0],f=a[1],m=a[2],k=a[3],p=a[4],e=a[5],g=a[6],h=a[7];a=a[8];var n=c[0];c=c[1];b[0]=l;b[1]=f;b[2]=m;
b[3]=k;b[4]=p;b[5]=e;b[6]=n*l+c*k+g;b[7]=n*f+c*p+h;b[8]=n*m+c*e+a;return b};a.rotate=function(a,c,b){var l=a[0],f=a[1],m=a[2],k=a[3],p=a[4],e=a[5],g=a[6],h=a[7];a=a[8];var n=Math.sin(c);c=Math.cos(c);b[0]=c*l+n*k;b[1]=c*f+n*p;b[2]=c*m+n*e;b[3]=c*k-n*l;b[4]=c*p-n*f;b[5]=c*e-n*m;b[6]=g;b[7]=h;b[8]=a;return b};a.scale=function(a,c,b){var l=c[0];c=c[1];b[0]=l*a[0];b[1]=l*a[1];b[2]=l*a[2];b[3]=c*a[3];b[4]=c*a[4];b[5]=c*a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.uz=function(a,c){c[0]=1;c[1]=0;c[2]=
0;c[3]=0;c[4]=1;c[5]=0;c[6]=a[0];c[7]=a[1];c[8]=1;return c};a.sz=function(a,c){var b=Math.sin(a),l=Math.cos(a);c[0]=l;c[1]=b;c[2]=0;c[3]=-b;c[4]=l;c[5]=0;c[6]=0;c[7]=0;c[8]=1;return c};a.tz=function(a,c){c[0]=a[0];c[1]=0;c[2]=0;c[3]=0;c[4]=a[1];c[5]=0;c[6]=0;c[7]=0;c[8]=1;return c};a.fromMat2d=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=0;c[3]=a[2];c[4]=a[3];c[5]=0;c[6]=a[4];c[7]=a[5];c[8]=1;return c};a.fromQuat=function(a,c){var b=a[0],l=a[1],f=a[2],m=a[3],k=b+b,p=l+l,e=f+f,b=b*k,g=l*k,l=l*p,h=f*k,n=
f*p,f=f*e,k=m*k,p=m*p,m=m*e;c[0]=1-l-f;c[3]=g-m;c[6]=h+p;c[1]=g+m;c[4]=1-b-f;c[7]=n-k;c[2]=h-p;c[5]=n+k;c[8]=1-b-l;return c};a.normalFromMat4=function(a,c){var b=a[0],l=a[1],f=a[2],m=a[3],k=a[4],p=a[5],e=a[6],g=a[7],h=a[8],n=a[9],r=a[10],G=a[11],F=a[12],E=a[13],u=a[14],B=a[15],A=b*p-l*k,t=b*e-f*k,y=b*g-m*k,q=l*e-f*p,w=l*g-m*p,H=f*g-m*e,z=h*E-n*F,Q=h*u-r*F,h=h*B-G*F,P=n*u-r*E,n=n*B-G*E,r=r*B-G*u,G=A*r-t*n+y*P+q*h-w*Q+H*z;if(!G)return null;G=1/G;c[0]=(p*r-e*n+g*P)*G;c[1]=(e*h-k*r-g*Q)*G;c[2]=(k*n-p*
h+g*z)*G;c[3]=(f*n-l*r-m*P)*G;c[4]=(b*r-f*h+m*Q)*G;c[5]=(l*h-b*n-m*z)*G;c[6]=(E*H-u*w+B*q)*G;c[7]=(u*y-F*H-B*t)*G;c[8]=(F*w-E*y+B*A)*G;return c};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.rz=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat3=b4w.module.__mat3;
b4w.module.__mat4=function(a){var r="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new r(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var c=new r(16);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.copy=function(a,c){c[0]=a[0];
c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,c){if(c===a){var b=a[1],l=a[2],f=a[3],m=a[6],k=a[7],p=a[11];c[1]=a[4];c[2]=a[8];c[3]=a[12];c[4]=b;c[6]=a[9];c[7]=a[13];c[8]=l;c[9]=m;c[11]=a[14];c[12]=f;c[13]=
k;c[14]=p}else c[0]=a[0],c[1]=a[4],c[2]=a[8],c[3]=a[12],c[4]=a[1],c[5]=a[5],c[6]=a[9],c[7]=a[13],c[8]=a[2],c[9]=a[6],c[10]=a[10],c[11]=a[14],c[12]=a[3],c[13]=a[7],c[14]=a[11],c[15]=a[15];return c};a.invert=function(a,c){var b=a[0],l=a[1],f=a[2],m=a[3],k=a[4],p=a[5],e=a[6],g=a[7],h=a[8],n=a[9],r=a[10],G=a[11],F=a[12],E=a[13],u=a[14],B=a[15],A=b*p-l*k,t=b*e-f*k,y=b*g-m*k,q=l*e-f*p,w=l*g-m*p,H=f*g-m*e,z=h*E-n*F,Q=h*u-r*F,P=h*B-G*F,M=n*u-r*E,I=n*B-G*E,L=r*B-G*u,v=A*L-t*I+y*M+q*P-w*Q+H*z;if(!v)return null;
v=1/v;c[0]=(p*L-e*I+g*M)*v;c[1]=(f*I-l*L-m*M)*v;c[2]=(E*H-u*w+B*q)*v;c[3]=(r*w-n*H-G*q)*v;c[4]=(e*P-k*L-g*Q)*v;c[5]=(b*L-f*P+m*Q)*v;c[6]=(u*y-F*H-B*t)*v;c[7]=(h*H-r*y+G*t)*v;c[8]=(k*I-p*P+g*z)*v;c[9]=(l*P-b*I-m*z)*v;c[10]=(F*w-E*y+B*A)*v;c[11]=(n*y-h*w-G*A)*v;c[12]=(p*Q-k*M-e*z)*v;c[13]=(b*M-l*Q+f*z)*v;c[14]=(E*t-F*q-u*A)*v;c[15]=(h*q-n*t+r*A)*v;return c};a.adjoint=function(a,c){var b=a[0],l=a[1],f=a[2],m=a[3],k=a[4],p=a[5],e=a[6],g=a[7],h=a[8],n=a[9],r=a[10],G=a[11],F=a[12],E=a[13],u=a[14],B=a[15];
c[0]=p*(r*B-G*u)-n*(e*B-g*u)+E*(e*G-g*r);c[1]=-(l*(r*B-G*u)-n*(f*B-m*u)+E*(f*G-m*r));c[2]=l*(e*B-g*u)-p*(f*B-m*u)+E*(f*g-m*e);c[3]=-(l*(e*G-g*r)-p*(f*G-m*r)+n*(f*g-m*e));c[4]=-(k*(r*B-G*u)-h*(e*B-g*u)+F*(e*G-g*r));c[5]=b*(r*B-G*u)-h*(f*B-m*u)+F*(f*G-m*r);c[6]=-(b*(e*B-g*u)-k*(f*B-m*u)+F*(f*g-m*e));c[7]=b*(e*G-g*r)-k*(f*G-m*r)+h*(f*g-m*e);c[8]=k*(n*B-G*E)-h*(p*B-g*E)+F*(p*G-g*n);c[9]=-(b*(n*B-G*E)-h*(l*B-m*E)+F*(l*G-m*n));c[10]=b*(p*B-g*E)-k*(l*B-m*E)+F*(l*g-m*p);c[11]=-(b*(p*G-g*n)-k*(l*G-m*n)+h*
(l*g-m*p));c[12]=-(k*(n*u-r*E)-h*(p*u-e*E)+F*(p*r-e*n));c[13]=b*(n*u-r*E)-h*(l*u-f*E)+F*(l*r-f*n);c[14]=-(b*(p*u-e*E)-k*(l*u-f*E)+F*(l*e-f*p));c[15]=b*(p*r-e*n)-k*(l*r-f*n)+h*(l*e-f*p);return c};a.determinant=function(a){var c=a[0],b=a[1],l=a[2],f=a[3],m=a[4],k=a[5],p=a[6],e=a[7],g=a[8],h=a[9],n=a[10],r=a[11],G=a[12],F=a[13],E=a[14];a=a[15];return(c*k-b*m)*(n*a-r*E)-(c*p-l*m)*(h*a-r*F)+(c*e-f*m)*(h*E-n*F)+(b*p-l*k)*(g*a-r*G)-(b*e-f*k)*(g*E-n*G)+(l*e-f*p)*(g*F-h*G)};a.multiply=function(a,c,b){var l=
a[0],f=a[1],m=a[2],k=a[3],p=a[4],e=a[5],g=a[6],h=a[7],n=a[8],r=a[9],G=a[10],F=a[11],E=a[12],u=a[13],B=a[14];a=a[15];var A=c[0],t=c[1],y=c[2],q=c[3];b[0]=A*l+t*p+y*n+q*E;b[1]=A*f+t*e+y*r+q*u;b[2]=A*m+t*g+y*G+q*B;b[3]=A*k+t*h+y*F+q*a;A=c[4];t=c[5];y=c[6];q=c[7];b[4]=A*l+t*p+y*n+q*E;b[5]=A*f+t*e+y*r+q*u;b[6]=A*m+t*g+y*G+q*B;b[7]=A*k+t*h+y*F+q*a;A=c[8];t=c[9];y=c[10];q=c[11];b[8]=A*l+t*p+y*n+q*E;b[9]=A*f+t*e+y*r+q*u;b[10]=A*m+t*g+y*G+q*B;b[11]=A*k+t*h+y*F+q*a;A=c[12];t=c[13];y=c[14];q=c[15];b[12]=A*l+
t*p+y*n+q*E;b[13]=A*f+t*e+y*r+q*u;b[14]=A*m+t*g+y*G+q*B;b[15]=A*k+t*h+y*F+q*a;return b};a.mul=a.multiply;a.translate=function(a,c,b){var l=c[0],f=c[1];c=c[2];var m,k,p,e,g,h,n,r,G,F,E,u;a===b?(b[12]=a[0]*l+a[4]*f+a[8]*c+a[12],b[13]=a[1]*l+a[5]*f+a[9]*c+a[13],b[14]=a[2]*l+a[6]*f+a[10]*c+a[14],b[15]=a[3]*l+a[7]*f+a[11]*c+a[15]):(m=a[0],k=a[1],p=a[2],e=a[3],g=a[4],h=a[5],n=a[6],r=a[7],G=a[8],F=a[9],E=a[10],u=a[11],b[0]=m,b[1]=k,b[2]=p,b[3]=e,b[4]=g,b[5]=h,b[6]=n,b[7]=r,b[8]=G,b[9]=F,b[10]=E,b[11]=u,
b[12]=m*l+g*f+G*c+a[12],b[13]=k*l+h*f+F*c+a[13],b[14]=p*l+n*f+E*c+a[14],b[15]=e*l+r*f+u*c+a[15]);return b};a.scale=function(a,c,b){var l=c[0],f=c[1];c=c[2];b[0]=a[0]*l;b[1]=a[1]*l;b[2]=a[2]*l;b[3]=a[3]*l;b[4]=a[4]*f;b[5]=a[5]*f;b[6]=a[6]*f;b[7]=a[7]*f;b[8]=a[8]*c;b[9]=a[9]*c;b[10]=a[10]*c;b[11]=a[11]*c;b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.rotate=function(a,c,b,l){var f=b[0],m=b[1];b=b[2];var k=Math.sqrt(f*f+m*m+b*b),p,e,g,h,n,r,G,F,E,u,B,A,t,y,q,w,H,z,Q,P;if(1E-7>Math.abs(k))return null;
k=1/k;f*=k;m*=k;b*=k;p=Math.sin(c);e=Math.cos(c);g=1-e;c=a[0];k=a[1];h=a[2];n=a[3];r=a[4];G=a[5];F=a[6];E=a[7];u=a[8];B=a[9];A=a[10];t=a[11];y=f*f*g+e;q=m*f*g+b*p;w=b*f*g-m*p;H=f*m*g-b*p;z=m*m*g+e;Q=b*m*g+f*p;P=f*b*g+m*p;f=m*b*g-f*p;m=b*b*g+e;l[0]=c*y+r*q+u*w;l[1]=k*y+G*q+B*w;l[2]=h*y+F*q+A*w;l[3]=n*y+E*q+t*w;l[4]=c*H+r*z+u*Q;l[5]=k*H+G*z+B*Q;l[6]=h*H+F*z+A*Q;l[7]=n*H+E*z+t*Q;l[8]=c*P+r*f+u*m;l[9]=k*P+G*f+B*m;l[10]=h*P+F*f+A*m;l[11]=n*P+E*f+t*m;a!==l&&(l[12]=a[12],l[13]=a[13],l[14]=a[14],l[15]=a[15]);
return l};a.rotateX=function(a,c,b){var l=Math.sin(c);c=Math.cos(c);var f=a[4],m=a[5],k=a[6],p=a[7],e=a[8],g=a[9],h=a[10],n=a[11];a!==b&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[4]=f*c+e*l;b[5]=m*c+g*l;b[6]=k*c+h*l;b[7]=p*c+n*l;b[8]=e*c-f*l;b[9]=g*c-m*l;b[10]=h*c-k*l;b[11]=n*c-p*l;return b};a.rotateY=function(a,c,b){var l=Math.sin(c);c=Math.cos(c);var f=a[0],m=a[1],k=a[2],p=a[3],e=a[8],g=a[9],h=a[10],n=a[11];a!==b&&(b[4]=a[4],b[5]=a[5],b[6]=a[6],
b[7]=a[7],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[0]=f*c-e*l;b[1]=m*c-g*l;b[2]=k*c-h*l;b[3]=p*c-n*l;b[8]=f*l+e*c;b[9]=m*l+g*c;b[10]=k*l+h*c;b[11]=p*l+n*c;return b};a.rotateZ=function(a,c,b){var l=Math.sin(c);c=Math.cos(c);var f=a[0],m=a[1],k=a[2],p=a[3],e=a[4],g=a[5],h=a[6],n=a[7];a!==b&&(b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[0]=f*c+e*l;b[1]=m*c+g*l;b[2]=k*c+h*l;b[3]=p*c+n*l;b[4]=e*c-f*l;b[5]=g*c-m*l;b[6]=h*c-k*l;b[7]=n*c-p*l;return b};
a.uz=function(a,c){c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=a[0];c[13]=a[1];c[14]=a[2];c[15]=1;return c};a.tz=function(a,c){c[0]=a[0];c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=a[1];c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=a[2];c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.sz=function(a,c,b){var l=c[0],f=c[1];c=c[2];var m=Math.sqrt(l*l+f*f+c*c),k;if(1E-7>Math.abs(m))return null;m=1/m;l*=m;f*=m;c*=m;m=Math.sin(a);a=Math.cos(a);k=1-a;b[0]=l*l*k+a;b[1]=f*l*k+c*
m;b[2]=c*l*k-f*m;b[3]=0;b[4]=l*f*k-c*m;b[5]=f*f*k+a;b[6]=c*f*k+l*m;b[7]=0;b[8]=l*c*k+f*m;b[9]=f*c*k-l*m;b[10]=c*c*k+a;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.YF=function(a,c){var b=Math.sin(a),l=Math.cos(a);c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=l;c[6]=b;c[7]=0;c[8]=0;c[9]=-b;c[10]=l;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.ZF=function(a,c){var b=Math.sin(a),l=Math.cos(a);c[0]=l;c[1]=0;c[2]=-b;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=b;c[9]=0;c[10]=l;c[11]=0;c[12]=0;c[13]=0;
c[14]=0;c[15]=1;return c};a.$F=function(a,c){var b=Math.sin(a),l=Math.cos(a);c[0]=l;c[1]=b;c[2]=0;c[3]=0;c[4]=-b;c[5]=l;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.fromRotationTranslation=function(a,c,b){var l=a[0],f=a[1],m=a[2],k=a[3],p=l+l,e=f+f,g=m+m;a=l*p;var h=l*e,l=l*g,n=f*e,f=f*g,m=m*g,p=k*p,e=k*e,k=k*g;b[0]=1-(n+m);b[1]=h+k;b[2]=l-e;b[3]=0;b[4]=h-k;b[5]=1-(a+m);b[6]=f+p;b[7]=0;b[8]=l+e;b[9]=f-p;b[10]=1-(a+n);b[11]=0;b[12]=c[0];b[13]=c[1];b[14]=c[2];
b[15]=1;return b};a.fromQuat=function(a,c){var b=a[0],l=a[1],f=a[2],m=a[3],k=b+b,p=l+l,e=f+f,b=b*k,g=l*k,l=l*p,h=f*k,n=f*p,f=f*e,k=m*k,p=m*p,m=m*e;c[0]=1-l-f;c[1]=g+m;c[2]=h-p;c[3]=0;c[4]=g-m;c[5]=1-b-f;c[6]=n+k;c[7]=0;c[8]=h+p;c[9]=n-k;c[10]=1-b-l;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.frustum=function(a,c,b,l,f,m,k){var p=1/(c-a),e=1/(l-b),g=1/(f-m);k[0]=2*f*p;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=2*f*e;k[6]=0;k[7]=0;k[8]=(c+a)*p;k[9]=(l+b)*e;k[10]=(m+f)*g;k[11]=-1;k[12]=0;k[13]=0;k[14]=
m*f*2*g;k[15]=0;return k};a.perspective=function(a,c,b,l,f){a=1/Math.tan(a/2);var m=1/(b-l);f[0]=a/c;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=(l+b)*m;f[11]=-1;f[12]=0;f[13]=0;f[14]=2*l*b*m;f[15]=0;return f};a.SG=function(a,c,b,l){var f=Math.tan(a.iH*Math.PI/180),m=Math.tan(a.OF*Math.PI/180),k=Math.tan(a.GG*Math.PI/180);a=Math.tan(a.VG*Math.PI/180);var p=2/(k+a),e=2/(f+m);l[0]=p;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=e;l[6]=0;l[7]=0;l[8]=-((k-a)*p*.5);l[9]=(f-m)*e*.5;l[10]=b/
(c-b);l[11]=-1;l[12]=0;l[13]=0;l[14]=b*c/(c-b);l[15]=0;return l};a.ortho=function(a,c,b,l,f,m,k){var p=1/(a-c),e=1/(b-l),g=1/(f-m);k[0]=-2*p;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=-2*e;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=2*g;k[11]=0;k[12]=(a+c)*p;k[13]=(l+b)*e;k[14]=(m+f)*g;k[15]=1;return k};a.lookAt=function(d,c,b,l){var f,m,k,p,e,g,h,n,r=d[0],G=d[1];d=d[2];k=b[0];p=b[1];m=b[2];h=c[0];b=c[1];f=c[2];if(1E-7>Math.abs(r-h)&&1E-7>Math.abs(G-b)&&1E-7>Math.abs(d-f))return a.identity(l);c=r-h;b=G-b;h=d-f;n=1/Math.sqrt(c*
c+b*b+h*h);c*=n;b*=n;h*=n;f=p*h-m*b;m=m*c-k*h;k=k*b-p*c;(n=Math.sqrt(f*f+m*m+k*k))?(n=1/n,f*=n,m*=n,k*=n):k=m=f=0;p=b*k-h*m;e=h*f-c*k;g=c*m-b*f;(n=Math.sqrt(p*p+e*e+g*g))?(n=1/n,p*=n,e*=n,g*=n):g=e=p=0;l[0]=f;l[1]=p;l[2]=c;l[3]=0;l[4]=m;l[5]=e;l[6]=b;l[7]=0;l[8]=k;l[9]=g;l[10]=h;l[11]=0;l[12]=-(f*r+m*G+k*d);l[13]=-(p*r+e*G+g*d);l[14]=-(c*r+b*G+h*d);l[15]=1;return l};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+
a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.rz=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.mat4=b4w.module.__mat4;b4w.module.__md5=function(a){function r(a,f){var p=a[0],e=a[1],g=a[2],h=a[3],p=c(p,e,g,h,f[0],7,-680876936),h=c(h,p,e,g,f[1],12,-389564586),g=c(g,h,p,e,f[2],17,606105819),e=c(e,g,h,p,f[3],22,-1044525330),p=c(p,e,g,h,f[4],7,-176418897),h=c(h,p,e,g,f[5],12,1200080426),g=c(g,h,p,e,f[6],17,-1473231341),e=c(e,g,h,p,f[7],22,-45705983),p=c(p,e,g,h,f[8],7,1770035416),h=c(h,p,e,g,f[9],12,-1958414417),g=c(g,h,p,e,f[10],17,-42063),e=c(e,g,h,p,f[11],22,-1990404162),p=c(p,e,g,h,f[12],7,1804603682),h=c(h,p,e,g,
f[13],12,-40341101),g=c(g,h,p,e,f[14],17,-1502002290),e=c(e,g,h,p,f[15],22,1236535329),p=b(p,e,g,h,f[1],5,-165796510),h=b(h,p,e,g,f[6],9,-1069501632),g=b(g,h,p,e,f[11],14,643717713),e=b(e,g,h,p,f[0],20,-373897302),p=b(p,e,g,h,f[5],5,-701558691),h=b(h,p,e,g,f[10],9,38016083),g=b(g,h,p,e,f[15],14,-660478335),e=b(e,g,h,p,f[4],20,-405537848),p=b(p,e,g,h,f[9],5,568446438),h=b(h,p,e,g,f[14],9,-1019803690),g=b(g,h,p,e,f[3],14,-187363961),e=b(e,g,h,p,f[8],20,1163531501),p=b(p,e,g,h,f[13],5,-1444681467),h=
b(h,p,e,g,f[2],9,-51403784),g=b(g,h,p,e,f[7],14,1735328473),e=b(e,g,h,p,f[12],20,-1926607734),p=d(e^g^h,p,e,f[5],4,-378558),h=d(p^e^g,h,p,f[8],11,-2022574463),g=d(h^p^e,g,h,f[11],16,1839030562),e=d(g^h^p,e,g,f[14],23,-35309556),p=d(e^g^h,p,e,f[1],4,-1530992060),h=d(p^e^g,h,p,f[4],11,1272893353),g=d(h^p^e,g,h,f[7],16,-155497632),e=d(g^h^p,e,g,f[10],23,-1094730640),p=d(e^g^h,p,e,f[13],4,681279174),h=d(p^e^g,h,p,f[0],11,-358537222),g=d(h^p^e,g,h,f[3],16,-722521979),e=d(g^h^p,e,g,f[6],23,76029189),p=
d(e^g^h,p,e,f[9],4,-640364487),h=d(p^e^g,h,p,f[12],11,-421815835),g=d(h^p^e,g,h,f[15],16,530742520),e=d(g^h^p,e,g,f[2],23,-995338651),p=l(p,e,g,h,f[0],6,-198630844),h=l(h,p,e,g,f[7],10,1126891415),g=l(g,h,p,e,f[14],15,-1416354905),e=l(e,g,h,p,f[5],21,-57434055),p=l(p,e,g,h,f[12],6,1700485571),h=l(h,p,e,g,f[3],10,-1894986606),g=l(g,h,p,e,f[10],15,-1051523),e=l(e,g,h,p,f[1],21,-2054922799),p=l(p,e,g,h,f[8],6,1873313359),h=l(h,p,e,g,f[15],10,-30611744),g=l(g,h,p,e,f[6],15,-1560198380),e=l(e,g,h,p,f[13],
21,1309151649),p=l(p,e,g,h,f[4],6,-145523070),h=l(h,p,e,g,f[11],10,-1120210379),g=l(g,h,p,e,f[2],15,718787259),e=l(e,g,h,p,f[9],21,-343485551);a[0]=p+a[0]&4294967295;a[1]=e+a[1]&4294967295;a[2]=g+a[2]&4294967295;a[3]=h+a[3]&4294967295}function d(a,b,c,d,f,h){b=(b+a&4294967295)+(d+h&4294967295)&4294967295;return(b<<f|b>>>32-f)+c&4294967295}function c(a,b,c,e,f,h,l){return d(b&c|~b&e,a,b,f,h,l)}function b(a,b,c,e,f,h,l){return d(b&e|c&~e,a,b,f,h,l)}function l(a,b,c,e,f,h,l){return d(c^(b|~e),a,b,f,
h,l)}var f="0123456789abcdef".split("");a.ps=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var g=b.substring(d-64,d),h=[],l=void 0,l=0;64>l;l+=4)h[l>>2]=g.charCodeAt(l)+(g.charCodeAt(l+1)<<8)+(g.charCodeAt(l+2)<<16)+(g.charCodeAt(l+3)<<24);r(a,h)}b=b.substring(d-64);g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)g[d>>2]|=b.charCodeAt(d)<<(d%4<<3);g[d>>2]|=128<<(d%4<<3);if(55<d)for(r(a,g),d=0;16>d;d++)g[d]=0;g[14]=8*
c;r(a,g);for(b=0;b<a.length;b++){c=a[b];d="";for(g=0;4>g;g++)d+=f[c>>8*g+4&15]+f[c>>8*g&15];a[b]=d}return a.join("")}};b4w.module.shader_texts=function(a){a["anchors.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",a:[{type:"var",name:"ANCHOR_NUM",b:["0"]},{type:"textline",b:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec4 a ; a = u_view_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_Position = u_proj_matrix * a ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",
name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",
b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"pack.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},
{type:"include",file:"math.glslv"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]}]}}]},{type:"textline",b:["uniform","vec3","u_color_id",";"]},{type:"condition",
a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",
"ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bu ; varying vec4 bv ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"uniform float u_perspective_cast_far_bound ; varying vec4 bA ; varying vec4 bB ; varying vec4 bC ; varying vec4 bD ; uniform float u_perspective_cast_far_bound ; uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ; uniform sampler2D u_shadow_map1 ; uniform sampler2D u_shadow_map2 ; uniform sampler2D u_shadow_map3 ; uniform sampler2D u_shadow_mask ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},
{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { float qP , qQ ; vec3 qR , qS , qT , qU ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"qR = u_camera_eye_frag - bu ; qR = normalize ( qR ) ; qO ( qR , qS , qT , qU , qP , qQ ) ; qQ = qQ ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:"qQ = ( texture2D ( u_sampler , bE ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"qQ = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( qQ < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",
a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute",
"vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION",
"float","u_view_max_depth",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bu ; varying vec4 bv ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 tx ; float ty , tz , tA ; mat4 tB ; vec3 tC , tD , tE , tF , tG , tH ; tC = a_position ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["tD","=","a_normal",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"tE = vec3 ( a_tangent ) ; tF = a_tangent [ 3 ] * cross ( tD , tE ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"tE = vec3 ( 0.0 ) ; tF = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tD = vec3 ( 0.0 ) ; tE = vec3 ( 0.0 ) ; tF = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"tC = mix ( tC , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"tD = mix ( tD , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"tG = vec3 ( a_tangent ) ; tH = a_tangent_next [ 3 ] * cross ( a_normal_next , tG ) ; tE = mix ( tE , tG , u_va_frame_factor ) ; tF = mix ( tF , tH , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"sD ( tC , tE , tF , tD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["tF","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tF = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"tE = ( u_model_matrix * vec4 ( tF , 1.0 ) ) . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tB = rw ( u_camera_eye , tE , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tB = rq ( u_camera_eye , tE , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"tH = ( u_model_matrix * vec4 ( tF , 1.0 ) ) . xyz ; tB = tB * ri ( u_wind , u_time , u_jitter_amp , u_jitter_freq , tH ) ;".split(" ")}]}}]},{type:"textline",b:"aM tI = rD ( tC - tF , tF , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tB ) ; tI . b = tE ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"aM tI = rD ( tC , tF , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tr ( tI . a , tI . b , tD ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["tD","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tD = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",
b:"tr ( tI . a , tI . b , tD ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"bE = rG ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bu = tI . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"bw = tI . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"ty = ( dot ( cross ( tI . e , tI . c ) , tI . d ) < 0.0 ) ? - 1.0 : 1.0 ; bx = vec4 ( tI . c , ty ) ;".split(" ")}]}}]},
{type:"textline",b:"bv = u_view_matrix * vec4 ( tI . a , 1.0 ) ; tx = u_proj_matrix * bv ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"tx . xy += u_subpixel_jitter * tx . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ty = tx . x ; tz = tx . y ; tA = tx . w ; by . x = ( ty + tA ) / 2.0 ; by . y = ( tz + tA ) / 2.0 ; by . z = tA ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bz = - bv . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["tw","(",")",";"]}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( tI . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",
b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",
b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},
{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1},"NODES","ALPHA",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"pack.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",
file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bu",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bv",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",
d:1},"NODES","ALPHA",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { float tx , ty ; vec3 tz , tA , tB , tC ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"tz = u_camera_eye_frag - bu ; tz = normalize ( tz ) ; qO ( tz , tA , tB , tC , tx , ty ) ; ty = ty ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"ty = ( texture2D ( u_colormap0 , bE ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ty = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( ty < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","NO_SHADOWS",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2},{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( du ( bv . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor . a += 0.00001 * bx . r ;".split(" ")}]}}]}]}}]},
{type:"textline",b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute",
"vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",d:3}],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",
d:4}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1},"TEXTURE_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS",
"BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD","SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",
d:2},{type:"logic_negative_expr",d:1},"TEXTURE_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION",
"float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bu",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4",
"bv",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["varying","float","bz",";"]}]}}]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec2 um ; vec4 un , uo ; float up ; mat4 uq , ur ; vec3 us , ut , uu , uv , uw , ux ; us = a_position ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["ut","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ut = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE",
{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"uu = vec3 ( a_tangent ) ; uv = a_tangent [ 3 ] * cross ( ut , uu ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uu = vec3 ( 0.0 ) ; uv = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"us = mix ( us , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"ut = mix ( ut , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"uw = vec3 ( a_tangent ) ; ux = a_tangent_next [ 3 ] * cross ( a_normal_next , uw ) ; uu = mix ( uu , uw , u_va_frame_factor ) ; uv = mix ( uv , ux , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"sD ( us , uu , uv , ut ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uv","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uv = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",
b:"aM uy = ub ( us , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ut , uv , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"uu = ( u_model_matrix * vec4 ( uv , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD",{type:"logic_negative_expr",d:1},"SHADOW_USAGE","SHADOW_CASTING",
{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uq","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uq","=","u_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ur = rw ( u_camera_eye , uu , uq , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ur = rq ( u_camera_eye , uu , uq ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ux = ( u_model_matrix * vec4 ( uv , 1.0 ) ) . xyz ; ur = ur * ri ( u_wind , u_time , u_jitter_amp , u_jitter_freq , ux ) ;".split(" ")}]}}]},{type:"textline",b:"aM uy = rD ( us - uv , uv , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ut , ur ) ; uy . b = uu ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"aM uy = rD ( us , uv , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ut , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["ut","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ut = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",
b:"tr ( uy . a , uy . b , ut ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bu = uy . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"bw = uy . e ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"up = ( dot ( cross ( uy . e , uy . c ) , uy . d ) < 0.0 ) ? - 1.0 : 1.0 ; bx = vec4 ( uy . c , up ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"un = u_view_matrix * vec4 ( uy . a , 1.0 ) ; uo = u_proj_matrix * un ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"uo . xy += u_subpixel_jitter * uo . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES",
"ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"by = bt ( uo ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bz = - bv . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",
b:["tw","(",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"bE = rG ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ul ( uy . a , uy . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",
d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["bv","=","un",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"um = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; up = SHADOW_TEX_RES / 2.0 ; um = floor ( um * up + 0.5 ) / up - um ; uo . xy += um ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","uo",";","}"]}]};a["grass_map.glslf"]=
{type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","um",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","um",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",
b:["varying","vec3","um",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","um",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( um , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , um ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute",
"float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","um",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","um",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","um",";"]}]}}]}]}}]},{type:"textline",b:"void main ( ) { vec4 un ; mat4 uo ; vec3 up ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",
a:[{type:"textline",b:"up = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; uo = rq ( u_camera_eye , up , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uo = uo * ri ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"aM uq = rD ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , uo ) ; uq . b = up ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"aM uq = rD ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"un = u_proj_matrix * u_view_matrix * vec4 ( uq . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"um = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["um","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["um","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","un",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",
b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",
d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 un ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 bE ; varying float uo ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS","NUM_LINES",{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const int up = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"const int up = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float ur ( float uq ) { return uq - floor ( uq * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void uA ( inout float us , in float ut [ up ] , in float uu ) { float uv , uw , ux , uy ; for ( int uz = 0 ; uz < NUM_RINGS ; uz ++ ) { uv = 40.0 * ut [ uz ] ; uw = 300.0 * ( ur ( uv ) - 0.005 ) ; ux = uv ; uy = abs ( ux * ( u_halo_size * uw - uu ) ) ; us += 1.0 - min ( uy , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void uJ ( inout float uB , in float uC [ up ] , in float uD ) { float uE , uF , uG , uH ; for ( int uI = 0 ; uI < NUM_LINES ; uI ++ ) { uE = uC [ uI ] ; uF = uE ; uG = 1000.0 * ( ur ( uE ) - 0.005 ) ; uH = 20.0 * abs ( uF * bE . x + uG * bE . y ) ; uB += 1.0 - min ( uH , 1.0 ) ; } uB *= uD ; }".split(" ")}]}}]},{type:"textline",b:"void uQ ( inout float uK , in vec2 uL ) { float uM , uN , uO , uP ; uN = atan ( uL . y , uL . x ) ; uN *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; uO = cos ( uN ) ; uP = sin ( uN ) ; uN = ( uO * uL . x + uP * uL . y ) * ( uO * uL . y - uP * uL . x ) ; uM = abs ( uN ) ; if ( uM < 1.0 ) { uM = ( 0.01 * u_halo_size ) / ( uM ) ; uK *= sqrt ( min ( uM , 1.0 ) ) ; } } void main ( ) { vec3 uR ; float uS , uT , uU , uV ; uS = ( bE . x * bE . x + bE . y * bE . y ) ; uT = sqrt ( uS ) ; uS = max ( 1.0 - uS , 0.0 ) ; uS = pow ( uS , u_halo_hardness ) ; uU = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","NUM_LINES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float uW [ up ] ; for ( int uX = 0 ; uX < up ; uX ++ ) { uW [ uX ] = fract ( uo / ( float ( uX ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"uV = 0.0 ; uA ( uV , uW , uT ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"uT = 0.0 ; uJ ( uT , uW , uS ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"uQ ( uS , bE ) ;".split(" ")}]}}]},{type:"textline",b:"uS *= uU ; uR = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"uV *= uS ; uR += u_halo_rings_color * uV ; uS += uV ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"uT *= uU ; uR += u_halo_lines_color * uT ; uS += uT ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"uS *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uT = u_halo_stars_blend * ( un . y - u_halo_stars_height ) ; uS *= clamp ( uT , 0.0 , 1.0 ) ; uS *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"aG ( uR ) ; aJ ( uR , uS ) ; gl_FragColor = vec4 ( uR , uS ) ; }".split(" ")}]};a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 bE ; varying float uo ;".split(" ")},{type:"condition",a:[{type:"if",
c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","un",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 up , uq ; mat4 ur , us ; vec3 ut ; ut = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; bE = a_halo_bb_vertex * 2.0 ; uo = fract ( ut . x + ut . y + ut . z ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"ur = qV ( ut , u_view_matrix ) ; us = u_view_matrix ; us [ 3 ] [ 0 ] = 0.0 ; us [ 3 ] [ 1 ] = 0.0 ; us [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ur = qV ( ut , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"up = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; up = ur * up ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",
a:[{type:"textline",b:"uq = u_proj_matrix * us * up ; uq . z = 0.99999 * uq . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["un","=","up",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uq = u_proj_matrix * u_view_matrix * up ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","uq",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",
file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 up ; up = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( up , 1.0 ) ; }".split(" ")}]};
a["main.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",
name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},
{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_VECTOR_VIEW",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3",
"u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",
b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",
a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION","REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D",
"u_scene_depth",";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","bu",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",
{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"textline",b:["varying","vec4","bv",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",
a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"nodes.glslf"},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",
b:"void main ( ) { vec2 vd ; vec3 ve , vf , vg , vh , vi ; float vj , vk , vl , vm ; vj = length ( bv ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"vk = bu . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["ve","=","u_sun_intensity",
";"]}]}}]},{type:"textline",b:"vf = normalize ( u_camera_eye_frag - bu ) ; qO ( vf , vg , vh , vi , vl , vm ) ; vg = vg ; vm = vm ; vi = vi ; vl = vl ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"vg = max ( vg - sqrt ( 0.01 * - min ( vk , 0.0 ) ) , 0.5 * vg ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"aC ( vg , vk , u_time , vl , vi , u_sun_direction , ve , u_sun_quaternion , bu , vj ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( vm <= 0.5 ) discard ; vm = 1.0 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES_GLOW",
{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["vm","=","1.0",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"vc ( vg , length ( bv ) , vf , vk ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vc ( vg , length ( bv ) , vf , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vd = texture2DProj ( u_shadow_mask , by ) . rg ; vk = vd . g ; vg = vec3 ( vk ) ;".split(" ")}]}}]},{type:"textline",b:["aG","(","vg",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2},"NODES_GLOW",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"aJ ( vg , vm ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( vg , vm ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3",
"a_position",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",
d:1},"BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},
{type:"textline",b:["varying","vec3","bu",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO",
"PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bv",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["varying",
"vec3","vd",";"]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ve",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bA",";"]},{type:"condition",
a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",
d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},
{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 vf , vg ; float vh ; mat4 vi ; vec3 vj , vk , vl , vm , vn , vo , vp ; vj = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"NODES",{type:"logic_negative_expr",
d:1},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["vk","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vk = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vl = vec3 ( a_tangent ) ; vm = a_tangent [ 3 ] * cross ( vk , vl ) ;".split(" ")}]}},
{type:"elif",c:["NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vn = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vo = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vn = vn - u_camera_eye ; vm = cross ( vn , vo ) ; vl = cross ( vo , vm ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vl = vec3 ( 0.0 ) ; vm = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"vj = mix ( vj , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"vk = mix ( vk , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vo = vec3 ( a_tangent ) ; vn = a_tangent_next [ 3 ] * cross ( a_normal_next , vo ) ; vl = mix ( vl , vo , u_va_frame_factor ) ; vm = mix ( vm , vn , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"sD ( vj , vl , vm , vk ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",
a:[{type:"textline",b:["vn","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vn = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"aM vq = ub ( vj , vl , vm , vk , vn , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:"vo = ( u_model_matrix * vec4 ( vn , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vi = rw ( u_camera_eye , vo , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vi = rq ( u_camera_eye , vo , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vp = ( u_model_matrix * vec4 ( vn , 1.0 ) ) . xyz ; vi = vi * ri ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vp ) ;".split(" ")}]}}]},{type:"textline",b:"aM vq = rD ( vj - vn , vn , vl , vm , vk , vi ) ; vq . b = vo ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"aM vq = rD ( vj , vn , vl , vm , vk , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vh = ( dot ( cross ( vq . e , vq . c ) , vq . d ) < 0.0 ) ? - 1.0 : 1.0 ; bx = vec4 ( vq . c , vh ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"tr ( vq . a , vq . b , vk ) ;".split(" ")}]}}]},{type:"textline",b:"bu = vq . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",
d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"bw = vq . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vd = u_camera_eye - vq . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",
b:"bE = rG ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"ve = vq . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["ve","=","a_color",";"]}]}}]}]}}]},{type:"textline",b:"vf = u_view_matrix * vec4 ( vq . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",
d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["bv","=","vf",";"]}]}}]},{type:"textline",b:"vg = u_proj_matrix * vf ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"vg . xy += u_subpixel_jitter * vg . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",
d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"by = bt ( vg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ul ( vq . a , vq . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"bz = - vf . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:["tw","(",")",";"]}]}}]},{type:"textline",b:["gl_Position","=","vg",";","}"]}]};a["main_stack.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",
b:["0"]},{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",
name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"gamma.glslf"},
{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",
b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4",
"u_fog_params",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","ALPHA_AS_SPEC",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",
b:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",
";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","PARALLAX",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 bu ; varying vec3 bw ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",
d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bv",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]},{type:"textline",b:["varying","vec3","vd",";"]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR",
"DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ve",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","bC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",
a:[{type:"textline",b:["varying","float","bz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",b:"void main ( ) { vec4 xn , xo , xp , xq ; mat3 xr ; vec2 xs , xt , xu , xv ; vec3 xw , xx , xy , xz , xA , xB , xC , xD , xE ; float xF , xG , xH , xI , xJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",
d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"xF = length ( bv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"xG = bu . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",
a:[{type:"textline",b:["xw","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["xs","=","bE",";"]}]}}]},{type:"textline",b:["xx","=","bw",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) xx = xx ; else xx = - xx ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"xy = cross ( xx , bx . xyz ) * bx . w ; xr = mat3 ( bx . xyz , xy , xx ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xt = normalize ( u_view_matrix_frag * vec4 ( bw , 0.0 ) ) . st ; xt = xt * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( xF < PARALLAX_LOD_DIST ) { xH = clamp ( 0.5 * ( PARALLAX_LOD_DIST - xF ) , 0.0 , 1.0 ) ; xH = u_parallax_scale * xH ; xy = normalize ( vd * xr ) ; xI = 1.0 / PARALLAX_STEPS ; xu = xy . xy * xH / ( PARALLAX_STEPS * xy . z ) ; xH = 1.0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["xv","=","xt",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["xv","=","xs",";"]}]}}]},{type:"textline",b:"xJ = texture2D ( u_normalmap0 , xv ) . a ; for ( float xK = 1.0 ; xK <= PARALLAX_STEPS ; xK ++ ) { if ( xJ < xH ) { xH -= xI ; xv -= xu ; xJ = texture2D ( u_normalmap0 , xv ) . a ; } } xu = xv + xu ; xI = texture2D ( u_normalmap0 , xu ) . a - ( xH + xI ) ; xH = xJ - xH ; xI = xH / ( xH - xI ) ; xv = xI * xu + ( 1.0 - xI ) * xv ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xs += xv - xt ;".split(" ")}]}}]},{type:"textline",b:["xt","=","xv",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xt += xv - xs ;".split(" ")}]}}]},{type:"textline",b:["xs","=","xv",";"]}]}}]},
{type:"textline",b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xn = texture2D ( u_normalmap0 , xt ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xn = texture2D ( u_normalmap0 , xs ) ;".split(" ")}]}}]},{type:"textline",b:"xy = xn . rgb - 0.5 ; xy = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , xy , u_normal_factor ) ; xy = xr * xy ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["xy","=","xx",";"]}]}}]},{type:"textline",b:"xy = normalize ( xy ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xt = normalize ( u_view_matrix_frag * vec4 ( xy , 0.0 ) ) . st ; xt = xt * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"xx = normalize ( vd ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"xz = ve ; aE ( xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xn = vec4 ( xz , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["xn","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["xI","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"xo = texture2D ( u_colormap0 , xt ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xo = texture2D ( u_colormap0 , xs ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"aE ( xo . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xp = texture2D ( u_colormap1 , xt ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xp = texture2D ( u_colormap1 , xs ) ;".split(" ")}]}}]},{type:"textline",b:"aE ( xp . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"xq = texture2D ( u_stencil0 , xt ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xq = texture2D ( u_stencil0 , xs ) ;".split(" ")}]}}]},{type:"textline",b:"xo = mix ( xo , xp , xq . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xn . rgb = mix ( xn . rgb , xo . rgb , u_diffuse_color_factor ) ; xH = u_alpha_factor * xo . a ; xH += ( 1.0 - step ( 0.0 , xH ) ) ; xn . a = mix ( xH , 1.0 , u_diffuse_color . a ) ; xI = xo . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xn . rgb *= mix ( vec3 ( 1.0 ) , xo . rgb , u_diffuse_color_factor ) ; xn . a = xo . a ; xI = xo . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"xz = u_diffuse_intensity * xn . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["xA","=","xz",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xB = u_environment_energy * dW ( xy ) ; xB = u_ambient * xB ; xH = dz ( xz ) ; xC = u_emit * xn . rgb ; xD = u_specular_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"xE = vec3 ( xI ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xE = texture2D ( u_specmap0 , xt ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xE = texture2D ( u_specmap0 , xs ) . rgb ;".split(" ")}]}}]},
{type:"textline",b:"aE ( xE . rgb ) ; xD = mix ( xD , xE , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"xI = u_specular_params [ 0 ] ; xs = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; xD = xI * xD ; xm ( xC , xB , xz , xD , bu , xy , xx , xs , u_diffuse_params , xH , 0.0 , vec4 ( 0.0 ) , xA , xE ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},
{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dT ( xA , xx , xy , u_reflect_factor ) ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dT ( xA , xx , xy , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["xA","+=","xE",";"]}]}}]},{type:"textline",b:"xI = xn . a ;".split(" ")},{type:"condition",
a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"xA = max ( xA - sqrt ( 0.01 * - min ( xG , 0.0 ) ) , 0.5 * xA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"aC ( xA , xG , u_time , xH , xy , u_sun_direction , xw , u_sun_quaternion , bu , xF ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( xI <= 0.5 ) discard ; xI = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"xH = max ( max ( xE . r , xE . g ) , xE . b ) * u_specular_alpha ; xI = xn . a * ( 1.0 - xH ) + xH ;".split(" ")}]}}]}]}}]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["xI","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"xA = mix ( ej ( by , xy . xz * u_refr_bump ) , xA , xI ) ; xI = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"vc ( xA , xF , xx , xG ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"vc ( xA , xF , xx , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["aG","(","xA",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"aJ ( xA , xI ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( xA , xI ) ; }".split(" ")}]};a["main_stack.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",
name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",
"WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4",
"a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",
a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],
group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",
a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform",
"vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:["varying","vec3","bu",";"]},{type:"condition",
a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS",
"CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bv",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","vd",";"]},{type:"condition",a:[{type:"if",
c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ve",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",
{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 xn , xo ; float xp ; mat4 xq ; vec3 xr , xs , xt , xu , xv , xw , xx ; xr = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"NODES",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:6}],
group:{type:"group",a:[{type:"textline",b:["xs","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xs = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xt = vec3 ( a_tangent ) ; xu = a_tangent [ 3 ] * cross ( xs , xt ) ;".split(" ")}]}},
{type:"elif",c:["NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xv = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; xw = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; xv = xv - u_camera_eye ; xu = cross ( xv , xw ) ; xt = cross ( xw , xu ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xt = vec3 ( 0.0 ) ; xu = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"xr = mix ( xr , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"xs = mix ( xs , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"xw = vec3 ( a_tangent ) ; xv = a_tangent_next [ 3 ] * cross ( a_normal_next , xw ) ; xt = mix ( xt , xw , u_va_frame_factor ) ; xu = mix ( xu , xv , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"sD ( xr , xt , xu , xs ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",
a:[{type:"textline",b:["xv","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xv = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"aM xy = ub ( xr , xt , xu , xs , xv , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:"xw = ( u_model_matrix * vec4 ( xv , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xq = rw ( u_camera_eye , xw , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xq = rq ( u_camera_eye , xw , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xx = ( u_model_matrix * vec4 ( xv , 1.0 ) ) . xyz ; xq = xq * ri ( u_wind , u_time , u_jitter_amp , u_jitter_freq , xx ) ;".split(" ")}]}}]},{type:"textline",b:"aM xy = rD ( xr - xv , xv , xt , xu , xs , xq ) ; xy . b = xw ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"aM xy = rD ( xr , xv , xt , xu , xs , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xp = ( dot ( cross ( xy . e , xy . c ) , xy . d ) < 0.0 ) ? - 1.0 : 1.0 ; bx = vec4 ( xy . c , xp ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"tr ( xy . a , xy . b , xs ) ;".split(" ")}]}}]},{type:"textline",b:"bu = xy . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",
d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"bw = xy . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vd = u_camera_eye - xy . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",
b:"bE = rG ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"ve = xy . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["ve","=","a_color",";"]}]}}]}]}}]},{type:"textline",b:"xn = u_view_matrix * vec4 ( xy . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",
d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["bv","=","xn",";"]}]}}]},{type:"textline",b:"xo = u_proj_matrix * xn ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"xo . xy += u_subpixel_jitter * xo . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",
d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"by = bt ( xo ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ul ( xy . a , xy . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"bz = - xn . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:["tw","(",")",";"]}]}}]},{type:"textline",b:["gl_Position","=","xo",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"include",file:"pack.glslf"}]}}]},
{type:"var",name:"SOFT_STRENGTH",b:["1.0"]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec2 u_texel_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:"varying float xn ; varying vec3 ve ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],
group:{type:"group",a:[{type:"textline",b:"varying vec4 bv ; varying vec3 by ; varying float xo ;".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec4 xp ; vec3 xq ; float xr , xs , xt ; vec2 xu , xv ; xu = gl_PointCoord - 0.5 ; xr = 2.0 * length ( xu ) ; xr = smoothstep ( u_p_alpha_start , u_p_alpha_end , xr ) ; xr = u_diffuse_color . a * xn * ( 1.0 - xr ) ; xq = ve * u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",
b:"xv = by . xy / by . z ; xu = vec2 ( xu . x , - xu . y ) * xo * u_texel_size ; xu = vec2 ( xv + xu ) ; xp = texture2D ( u_scene_depth , xu ) ; xs = k ( xp ) ; xt = - bv . z / u_view_max_depth ; xt = xs - xt ; xt = u_view_max_depth / SOFT_STRENGTH * xt ; xr = xr * min ( xt , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["aG","(","xq",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"aJ ( xq , xr ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( xq , xr ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_wind ; uniform float u_height ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float xn ; varying vec3 ve ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"varying vec4 bv ; varying vec3 by ; varying float xo ;".split(" ")}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { float yb , yc , yd , ye ; vec4 yf , yg ; xp yh ; yh = ya ( ) ; yf = u_view_matrix * vec4 ( yh . b , 1.0 ) ; yg = u_proj_matrix * yf ; gl_Position = yg ; xn = yh . c ; ve = yh . d ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["bv","=","yf",";"]}]}}]},{type:"textline",b:"yb = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; yb = yh . a * yb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"yc = yg . x ; yd = yg . y ; ye = yg . w ; by . x = ( yc + ye ) / 2.0 ; by . y = ( yd + ye ) / 2.0 ; by . z = ye ; xo = yb ;".split(" ")}]}}]},{type:"textline",
b:["gl_PointSize","=","yb",";","}"]}]};a["particles_texture.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},
{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"var",name:"SOFT_STRENGTH",b:["1.0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float xn ; varying vec3 ve ; varying vec2 bE ; varying vec3 bu ;".split(" ")},{type:"condition",
a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1},"DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","vd",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bv",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { vec2 yb ; float yc , yd , ye ; vec3 yf , yg , yh , yi , yj , yk , yl , ym ; vec4 yn , yo ; yn = u_diffuse_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"yo = texture2D ( u_sampler , bE ) ; aE ( yo . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"yn . rgb = mix ( yn . rgb , yo . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"yn . rgb *= mix ( vec3 ( 1.0 ) , yo . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"yn . a = yo . a ;".split(" ")}]}}]},{type:"textline",b:"yn . rgb *= ve ; yf = u_diffuse_intensity * yn . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1},"DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"yg = normalize ( vd ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"yh = u_emit * yn . rgb ; yi = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logic_negative_expr",d:1},"SKY_COLOR",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"yj = u_environment_energy * dW ( vec3 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"yj = u_environment_energy * dW ( yi ) ;".split(" ")}]}}]},{type:"textline",b:"yj = u_ambient * yj ; yc = u_specular_params [ 0 ] ; yb = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; yk = yc * u_specular_color ; xm ( yh , yj , yf , yk , bu , yi , yg , yb , u_diffuse_params , 1.0 , 0.0 , vec4 ( 0.0 ) , yl , ym ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["yl","=","yf",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:"vc ( yl , length ( bv ) , yg , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"yc = yn . a * xn ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"yd = - bv . z / u_view_max_depth ; yn = texture2DProj ( u_scene_depth , by ) ; ye = k ( yn ) ; yd = ye - yd ; yd = u_view_max_depth / SOFT_STRENGTH * yd ; yc = yc * min ( yd , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["aG","(","yl",")",";"]},{type:"condition",
a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"aJ ( yl , yc ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( yl , yc ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform vec3 u_wind ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float xn ; varying vec3 ve ; varying vec2 bE ; varying vec3 vd ; varying vec3 bu ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bv",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float yd ( vec2 yb , vec2 yc ) { return ( atan ( yc . y , yc . x ) - atan ( yb . y , yb . x ) ) ; } void main ( ) { vec4 ye , yf , yg ; mat4 yh ; float yi , yj , yk ; xp yl ; yl = ya ( ) ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { yi = yl . e ; yh = qV ( yl . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { yi = yl . e ; yh = bf ( ) ; yh [ 3 ] = vec4 ( yl . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { yi = yl . e ; yh = bj ( radians ( 90.0 ) ) ; yh [ 3 ] = vec4 ( yl . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { yi = yd ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + yl . e ; yh = bh ( radians ( - 90.0 ) ) ; yh [ 3 ] = vec4 ( yl . b , 1.0 ) ; } ye = vec4 ( a_p_bb_vertex * 2.0 * yl . a * u_p_size , 0.0 , 1.0 ) ; ye = yh * bl ( yi ) * ye ; yf = u_view_matrix * ye ; yg = u_proj_matrix * yf ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"yi = yg . x ; yj = yg . y ; yk = yg . w ; by . x = ( yi + yk ) / 2.0 ; by . y = ( yj + yk ) / 2.0 ; by . z = yk ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = yg ; xn = yl . c ; ve = yl . d ; bE = a_p_bb_vertex + 0.5 ; bu = ye . xyz ; vd = u_camera_eye - ye . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["bv","=","yf",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 yb ; const float yc = 0.99 ; const float yd = 1.8 ; const int ye = 8 ; float yk ( vec3 yf , vec3 yg ) { float yh , yi , yj ; yh = dot ( yg , yg ) ; yi = 2.0 * dot ( yg , yf ) ; yj = dot ( yf , yf ) - 1.0 ; yh = yi * yi - 4.0 * yh * yj ; yh = sqrt ( yh ) ; yh = ( - yi - yh ) / 2.0 ; yh = yj / yh ; return yh ; } float yr ( float yl , float ym ) { float yn , yo , yp , yq ; yn = 3.0 * ( 1.0 - ym * ym ) ; yo = 2.0 * ( 2.0 + ym * ym ) ; yp = 1.0 + yl * yl ; yq = pow ( 1.0 + ym * ym - 2.0 * ym * yl , 1.5 ) ; yq = max ( yq , 0.00001 ) ; return ( yn / yo ) * ( yp / yq ) ; } float yx ( vec3 ys , vec3 yt , float yu ) { vec3 yv ; float yw ; yw = dot ( yt , - ys ) ; if ( yw < 0.0 ) { return 1.0 ; } yv = ys + yw * yt ; if ( length ( yv ) < yu ) { return 0.0 ; } else if ( length ( yv ) >= yu ) { yv = normalize ( yv ) * yu - ys ; yw = acos ( dot ( normalize ( yv ) , yt ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( yw * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 yB ( float yy , vec3 yz , float yA ) { return yz - yz * pow ( u_sky_color , vec3 ( yA / yy ) ) ; } void main ( ) { float yC , yD , yE , yF , yG , yH , yI , yJ , yK ; vec3 yL , yM , yN , yO , yP , yQ , yR ; yL = normalize ( yb ) ; yM = u_sun_direction ; yC = dot ( yL , yM ) ; yD = yr ( yC , - 0.01 ) * u_rayleigh_brightness * yM . y ; yE = yr ( yC - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - yM . y ) ; yC = smoothstep ( 0.0 , 100.0 , yr ( yC , 0.9995 ) ) * u_spot_brightness ; yN = vec3 ( 0.0 , yc , 0.0 ) ; yF = yk ( yN , yL ) ; yG = yF / float ( ye ) ; yH = yx ( yN , yL , yc - 0.3 ) ; yO = vec3 ( 0.0 , 0.0 , 0.0 ) ; yP = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int yS = 0 ; yS < ye ; yS ++ ) { yI = yG * float ( yS ) ; yQ = yN + yL * yI ; yJ = yx ( yQ , yM , yc - 0.2 ) ; yK = yk ( yQ , yM ) ; yR = yB ( yK , vec3 ( yd ) , u_scatter_strength ) * yJ ; yO += yB ( sqrt ( yI ) , u_sky_color * yR , u_rayleigh_strength ) ; yP += yB ( yI , yR , u_mie_strength ) ; } yO = yO * yH * pow ( yF , u_rayleigh_collection_power ) / float ( ye ) ; yP = ( yP * yH * pow ( yF , u_mie_collection_power ) ) / float ( ye ) ; yO = vec3 ( yC * yP + yE * yP + yD * yO ) ; aG ( yO ) ; gl_FragColor = vec4 ( yO , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 yb ; void main ( ) { vec4 yc , yd ; yc = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; yd = u_cube_view_matrix * yc ; yb = yd . xyz ; gl_Position = yc ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 bE ; void main ( ) { vec4 yc ; yc = texture2D ( u_sampler , bE ) ; aG ( yc . rgb ) ; aJ ( yc . rgb , yc . a ) ; gl_FragColor = yc ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 bE ; void main ( ) { vec2 yc ; float yd ; vec4 ye ; vec3 yf ; bE = a_texcoord ; yf = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; ye = u_proj_matrix * u_view_matrix * vec4 ( yf , 0.0 ) ; ye . x /= ye . w ; ye . y /= ye . w ; ye += 99999.0 * step ( ye . z , 0.0 ) ; ye += 100.0 * ( step ( 1.0 , abs ( ye . x ) ) + step ( 1.0 , abs ( ye . y ) ) ) ; ye . x = - a_lf_dist * ye . x ; ye . y = - a_lf_dist * ye . y ; yd = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; yc = vec2 ( a_lf_bb_vertex . x / yd , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float yg = 1.9 ; yc *= ( 1.0 + yg * length ( ye . xy ) ) ; } gl_Position = vec4 ( ye . xy + yc , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"define",name:"INV_PI",b:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["WO_SKYTEX","PROCEDURAL_SKYDOME",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky",";"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"blending.glslf"},{type:"textline",b:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ; vec3 Ai ( vec3 Ad , vec3 Ae , float Af , float Ag ) { float Ah ; Ah = Af * Ag ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ys ( Ae , Ad , Ah ) ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","ADD",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yw ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SUBTRACT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yA ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yF ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SCREEN",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"return yK ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","OVERLAY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yP ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yT ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIVIDE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"return yX ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DARKEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return za ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LIGHTEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ze ( Ad , Ae , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","HUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zk ( Ae , Ad , Ah ) ;".split(" ")}]}},{type:"elif",
c:["BLENDTYPE","SATURATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zq ( Ae , Ad , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","VALUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zw ( Ae , Ad , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","COLOR",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zC ( Ae , Ad , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"return zH ( Ae , Ad , Ah ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zL ( Ae , Ad , Ah ) ;".split(" ")}]}}]},{type:"textline",b:"return vec3 ( 1.0 , 0.0 , 1.0 ) ; } float Aq ( float Aj , float Ak , float Al , float Am ) { float An ; vec3 Ao , Ap ; Ao = vec3 ( Aj ) , Ap = vec3 ( Ak ) ; An = Al * Am ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","MIX",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ys ( Ap , Ao , An ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","ADD",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yw ( Ao , Ap , An ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SUBTRACT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yA ( Ao , Ap , An ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"return zR ( Aj , Ak , An , Am ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SCREEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zX ( Aj , Ak , An , Am ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","OVERLAY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return Ac ( Aj , Ak , An , Am ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yT ( Ao , Ap , An ) . x ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","DIVIDE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yX ( Ao , Ap , An ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DARKEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return za ( Ao , Ap , An ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LIGHTEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ze ( Ao , Ap , An ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SOFT_LIGHT",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zH ( Ap , Ao , An ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zL ( Ap , Ao , An ) . x ;".split(" ")}]}}]},{type:"textline",b:["return","0.0",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"REFLECTION_PASS",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","yb",";"]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",
d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 Ar ; float As , At , Au ; vec3 Av , Aw , Ax , Ay , Az ; Aw = normalize ( yb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME"],group:{type:"group",a:[{type:"textline",b:"Av = textureCube ( u_sky , Aw ) . rgb ;".split(" ")}]}},{type:"elif",c:["WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",
d:2},{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"Av = u_horizon_color ; aG ( Av ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"textline",b:"Ax = vec3 ( bE , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ax = vec3 ( yb . xy , 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:["As","=","0.0",";"]},{type:"condition",a:[{type:"if",
c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"As = abs ( bE . y ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"As = ( bE . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"At = acos ( Aw . y ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",
a:[{type:"textline",b:"As = abs ( At * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"As = 1.0 - At * INV_PI ;".split(" ")}]}}]}]}}]}]}}]},{type:"textline",b:"Ay = u_horizon_color ; Az = u_zenith_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYTEX"],group:{type:"group",a:[{type:"textline",b:"At = 1.0 ; Ar = textureCube ( u_sky , Aw ) ; aE ( Ar . rgb ) ; At = Ar . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",
a:[{type:"textline",b:"At = dot ( Ar . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MTEX_NEGATIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"Ar = vec4 ( vec3 ( 1.0 ) - Ar . rgb , Ar . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"At = 1.0 - At ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ",
"WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"Ar = vec4 ( u_sky_tex_color , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"At = Ar . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ"],group:{type:"group",a:[{type:"textline",b:"Ay = Ai ( Ar . rgb , Ay , At , u_sky_tex_fac [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["Au","=","0.0",";"]},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( Ax , vec3 ( 0.0 , 1.0 , 0.0 ) ) >= 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"Au = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",b:"else Au = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"Au = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"elif",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",b:"Au = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( Au != 0.0 ) Az = Ai ( Ar . rgb , Az , At , Au ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WOMAP_BLEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"At = dot ( Ar . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},{type:"textline",b:"As = Aq ( u_sky_tex_dvar , As , At , u_sky_tex_fac [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"Av = mix ( Ay , Az , As ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["Av","=","Ay",";"]}]}}]},{type:"textline",b:["aG","(","Av",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"aG ( Ay ) ; aG ( Az ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"Av = mix ( Ay , Az , As ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["Av","=","Ay",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",
{type:"logic_negative_expr",d:1},"REFLECTION_PASS",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"aE ( Av ) ; As = u_camera_eye_frag . y - WATER_LEVEL ; As = min ( - As * 0.03 , 0.8 ) ; At = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; Ay = vec3 ( 0.0 ) ; Ar = u_underwater_fog_color_density ; Ar . rgb = mix ( Ar . rgb , Ay , min ( - Aw . y + As , 1.0 ) ) * At ; As = clamp ( sign ( Aw . y - 0.05 * As ) , 0.0 , 1.0 ) ; Av = mix ( Ar . rgb , Av , As ) ; aG ( Av ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( Av , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 yb ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 Ad , Ae ; Ad = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; Ae = u_sky_vp_inverse * Ad ; yb = Ae . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bE = a_position . xy ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","Ad",";","}"]}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",
b:["0.0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},
{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT",
"SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHORE_SMOOTHING","WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],
group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_params",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2",
"u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float Ad = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 vd ; varying vec3 bu ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH",
{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bx ; varying vec3 Ae ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Af",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Ag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",
d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Ah",";"]}]}}]},{type:"include",
file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE","SHORE_SMOOTHING","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",b:"vec3 At ( in vec2 Ai , in vec3 Aj , in vec3 Ak , in vec3 Al , out float Am ) { float An , Ao , Ap ; vec2 Aq ; vec3 Ar , As ; Am = 0.0 ; Ar = reflect ( - Ak , Aj ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Aq = Ai . xy + Aj . xz * REFL_BUMP / bz ; Am = u_reflect_factor ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"As = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"As = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"} else { As = texture2D ( u_plane_reflection , Aq ) . rgb ; aE ( As ) ; }".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Am = u_mirror_factor ; As = Al * textureCube ( u_mirrormap , Ar ) . rgb ; aE ( As ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Am = u_reflect_factor ; As = Al * vec3 ( 0.3 , 0.5 , 1.0 ) ; aE ( As ) ;".split(" ")}]}}]},
{type:"textline",b:"Ar = normalize ( Ar + Ak ) ; An = 1.0 - dot ( Ak , Ar ) ; Ao = u_fresnel_params [ 3 ] ; Ap = u_fresnel_params [ 2 ] ; Ap = Ao + ( 1.0 - Ao ) * pow ( An , Ap ) ; Am = min ( Am * Ap , 1.0 ) ; return As ; }".split(" ")},{type:"include",file:"lighting_nodes.glslf"},{type:"textline",b:"void main ( ) { vec4 Au ; vec2 Av , Aw , Ax ; float Ay , Az , AA , AB , AC , AD ; vec3 AE , AF , AG , AH , AI , AJ , AK , AL , AM ; mat3 AN ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AN = mat3 ( bx , Ae , bw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"AE = normalize ( bw ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AE = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","FOAM",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ay = bu . y - WATER_LEVEL ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"Av = vec2 ( Af . x , - Af . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Av = vec2 ( bu . x , - bu . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["Av","=","bE",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AF = vec3 ( 0.0 ) ; AG = texture2D ( u_normalmap0 , Av * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AF += AG ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"AH = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],
group:{type:"group",a:[{type:"textline",b:["AH","+=","AG",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AG = texture2D ( u_normalmap0 , Av * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AF += AG ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",
b:["AH","+=","AG",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AG = texture2D ( u_normalmap0 , Av * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AF += AG ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["AH","+=","AG",";"]}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AG = texture2D ( u_normalmap0 , Av * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AF += AG ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["AH","+=","AG",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"AH = AN * AH ; if ( ! aP ( AH , vec3 ( 0.0 ) ) ) AH = normalize ( AH ) ; AH = mix ( AE , AH , 0.2 ) ; AH = normalize ( AH ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"AE = mix ( AE , normalize ( AN * AF ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"AE = mix ( AE , normalize ( AN * AF ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"AE = normalize ( AE ) ;".split(" ")}]}}]},{type:"textline",b:"AF = normalize ( vd ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Aw = by . xy / by . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",
d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Az = bz * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"AA = u_diffuse_color . a ; Au = texture2DProj ( u_scene_depth , by ) ; AB = k ( Au ) ; AC = max ( AB - bz , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"Ax = Aw + AE . xz * u_refr_bump / bz ; AB = eb ( AB , Ax , Aw ) ; AB = max ( AB - bz , 0.0 ) ; AB = u_view_max_depth / ABSORB * AB ; if ( u_cam_water_depth < 0.0 ) AD = 0.0 ; else AD = min ( AA * AB , 1.0 ) ; AB = u_view_max_depth / ABSORB * AC ; AA = min ( 15.0 * AA * u_view_max_depth * AC , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"AB = u_view_max_depth / ABSORB * AC ; if ( u_cam_water_depth > 0.0 ) AA = min ( AA * AB , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"AA *= min ( 5.0 * Az , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AA = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"AD = 1.0 - AA ; Ax = Aw + AE . xz * u_refr_bump / bz ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"AG = texture2D ( u_refractmap , Ax ) . rgb ; aE ( AG ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"AB = pow ( min ( Ag . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; AI = mix ( u_shallow_water_col , u_diffuse_color . rgb , AB ) ; AB = pow ( min ( Ag . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; AI = mix ( u_shore_water_col , AI , AB ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"AI = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"AC = max ( 1.0 - u_view_max_depth * AC , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AC = 1.0 - AA ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",
b:"Ay = max ( Ay / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"AJ = normalize ( vec3 ( Ag . r , 0.0 , Ag . g ) ) ; AJ = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , AJ , 0.8 ) ) ; AB = 1.25 * max ( dot ( AH , AJ ) - 0.2 , 0.0 ) ; AB += max ( dot ( AH , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; AC += AB * ( 1.0 - Ag . b ) ; Ay *= ( 1.0 - 0.95 * pow ( Ag . b , 0.1 ) ) ;".split(" ")}]}}]},{type:"textline",b:"AC += Ay ; AC = min ( u_foam_factor * AC , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"Au = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + Av * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"Ay = u_specular_params [ 0 ] ; Av = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; AH = Ay * u_specular_color ; AJ = u_environment_energy * dW ( AE ) ; AJ = u_ambient * AJ ; AJ = AJ + u_sun_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"AK = At ( Aw , AE , AF , AJ , Ay ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AK = At ( vec2 ( 0.0 ) , AE , AF , AJ , Ay ) ;".split(" ")}]}}]},{type:"textline",b:"AI = u_diffuse_intensity * AI ; xm ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , AI , AH , bu , AE , AF , Av , u_diffuse_params , 1.0 , 0.0 , vec4 ( 0.0 ) , AL , AM ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"AB = max ( dot ( u_sun_direction , - bw ) + SSS_WIDTH , 0.0 ) * max ( dot ( - AF , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; AB = clamp ( SSS_STRENGTH * AB , 0.0 , 1.0 ) ; AL = mix ( AL , u_shallow_water_col , AB ) ; AL = mix ( AL , u_shore_water_col , AB ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"AL = mix ( AG , AL , AD ) ;".split(" ")}]}}]},{type:"textline",b:"AL = mix ( AL , AK , Ay ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"Ay = mix ( Au . g , Au . r , max ( 4.0 * ( AC - 0.75 ) , 0.0 ) ) ; Ay = mix ( Au . b , Ay , max ( 2.0 * AC - 1.0 , 0.0 ) ) ; Ay = mix ( 0.0 , Ay , AC ) ; AL = mix ( AL , AJ , Ay ) ;".split(" ")}]}}]},{type:"textline",
b:["AL","+=","AM",";"]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { uW ( AL , Az , u_cam_water_depth ) ; } else { vc ( AL , Az , AF , 1.0 ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vc ( AL , Az , AF , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["aG","(","AL",")",";"]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"AA = max ( AA , AM . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["AA","+=","Ay",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"aJ ( AL , AA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",
":","enable"]},{type:"textline",b:"AM = fwidth ( Ah ) ; AM = smoothstep ( vec3 ( 0.0 ) , AM * Ad , Ah ) ; Ay = min ( min ( AM . x , AM . y ) , AM . z ) ; Ay = clamp ( Ay , 0.0 , 1.0 ) ; AL = mix ( u_wireframe_edge_color , AL , Ay ) ; AA = mix ( 1.0 , AA , Ay ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( AL , AA ) ; }".split(" ")}]};a["special_water.glslv"]={type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",
b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",
b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"DYNAMIC",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_normal ; attribute vec3 a_tangent ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH",{type:"logic_negative_expr",d:1},"NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 vd ; varying vec3 bu ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"varying vec3 bx ; varying vec3 Ae ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying",
"vec3","Af",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Ag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","by",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",
{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","float","bz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Ah",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 Am ( in vec2 Ad ) { float Ai ; vec4 Aj ; vec2 Ak ; Ak = 0.5 + vec2 ( ( Ad . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( Ad . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; Aj = texture2D ( u_shore_dist_map , Ak ) ; const vec2 Al = vec2 ( 1.0 / 255.0 , 1.0 ) ; Ai = dot ( Aj . ba , Al ) ; Ak = normalize ( Aj . rg * 2.0 - 1.0 ) ; return vec3 ( Ak , Ai ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void Ay ( inout vec3 An , in float Ao , in vec3 Ap ) { vec2 Aq , Ar , As ; float At , Au , Av , Aw , Ax ; At = ag ( DST_NOISE_SCALE_0 * ( An . xz + DST_NOISE_FREQ_0 * Ao ) ) * ag ( DST_NOISE_SCALE_1 * ( An . zx - DST_NOISE_FREQ_1 * Ao ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"Au = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; Av = Ap . b ; Aw = sqrt ( Av ) ; Au = max ( Av , DIR_MIN_SHR_FAC ) * sin ( Aw / Au + DIR_FREQ * Ao ) ; Ax = max ( ag ( DIR_NOISE_SCALE * ( An . xz + DIR_NOISE_FREQ * Ao ) ) , DIR_MIN_NOISE_FAC ) ; Au *= Ax ; Aw = WAVES_HEIGHT * mix ( Au , At , max ( Aw , DST_MIN_FAC ) ) ; Aq = Ap . rg ; Au = WAVES_HOR_FAC * Au * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - Av ) , 0.0 ) ; Aq = Au * Aq ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"Aw = WAVES_HEIGHT * At ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"Ar = 2.0 * ( An . xz - 0.1 * Ao ) ; As = 1.3 * ( An . zx + 0.03 * Ao ) ; At = L ( 0.5 * Ar ) . x + L ( 0.5 * As ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"An . xz += Aq ; At *= Av ;".split(" ")}]}}]},{type:"textline",b:"Aw += SMALL_WAVES_FAC * At ;".split(" ")}]}}]},{type:"textline",
b:"An . y += Aw ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec4 Az , AA ; vec2 AB ; float AC , AD , AE ; vec3 AF , AG , AH , AI ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) Ah = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Ah = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Ah = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["AF","=","a_position",";"]},
{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"AC = abs ( AF . y ) ; AB = u_camera_eye . xz - mod ( u_camera_eye . xz , AC ) ; AF . y = WATER_LEVEL ; AF . xz += AB ;".split(" ")}]}},{type:"elif",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["bE","=","a_texcoord",";"]}]}}]},{type:"textline",b:"aM AJ = rD ( AF , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"Ag = Am ( AJ . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"AD = length ( u_wind ) ; AE = u_time ; AE *= AD ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"AC = AC ; AF = AJ . a + vec3 ( AC , 0.0 , 0.0 ) ; AG = AJ . a + vec3 ( 0.0 , 0.0 , AC ) ; if ( a_position . y < 0.0 ) { AJ . a . y = WATER_LEVEL - 1.0 ; AF . y = AJ . a . y ; AG . y = AJ . a . y ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Af = AJ . a ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AF = AJ . a + vec3 ( 0.05 , 0.0 , 0.0 ) ; AG = AJ . a + vec3 ( 0.0 , 0.0 , 0.05 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"AH = Am ( AF . xz ) ; AI = Am ( AG . xz ) ; Ay ( AF , AE , AH ) ; Ay ( AG , AE , AI ) ; Ay ( AJ . a , AE , Ag ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"Ay ( AF , AE , vec3 ( 0.0 ) ) ; Ay ( AG , AE , vec3 ( 0.0 ) ) ; Ay ( AJ . a , AE , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"AF = normalize ( AF - AJ . a ) ; AG = normalize ( AG - AJ . a ) ; bw = normalize ( cross ( AG , AF ) ) ; AE = dot ( bw , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; AE = clamp ( 0.8 - AE , 0.0 , 1.0 ) ; bw = mix ( bw , vec3 ( 0.0 , 1.0 , 0.0 ) , AE ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"AG = a_tangent ; bw = a_normal ;".split(" ")}]}}]},{type:"textline",b:"bx = AG ; Ae = cross ( bw , bx ) ;".split(" ")}]}}]},{type:"textline",b:"bu = AJ . a ; vd = u_camera_eye - AJ . a ; Az = u_view_matrix * vec4 ( AJ . a , 1.0 ) ; AA = u_proj_matrix * Az ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"AE = AA . x ; AC = AA . y ; AD = AA . w ; by . x = ( AE + AD ) / 2.0 ; by . y = ( AC + AD ) / 2.0 ; by . z = AD ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"bz = - Az . z / u_view_max_depth ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","AA",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 Ah ; const float Ad = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 Ai = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 Ai = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 Aj = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 Ak = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 Al = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float Am , An ; vec3 Ao , Ap ; Ao = vec3 ( 0.0 ) ; Am = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"Ap = sign ( Ah - vec3 ( 0.02 * Ad ) ) ; if ( Ap . x < 0.0 || Ap . y < 0.0 || Ap . z < 0.0 ) { Ao = Ai ; Am = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY",0,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ap = sign ( Ah - vec3 ( 0.02 * Ad ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( Ap . x < 0.0 || Ap . y < 0.0 || Ap . z < 0.0 ) Ao = u_wireframe_edge_color ; else Ao = Al ; Am = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( Ap . x < 0.0 || Ap . y < 0.0 || Ap . z < 0.0 ) Am = 1.0 ; else Am = 0.0 ; Ao = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( Ap . x < 0.0 || Ap . y < 0.0 || Ap . z < 0.0 ) Ao = u_wireframe_edge_color ; else if ( gl_FrontFacing ) Ao = Aj ; else Ao = Ak ; Am = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY",1,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"Ap = fwidth ( Ah ) ; Ap = smoothstep ( vec3 ( 0.0 ) , Ap * Ad , Ah ) ; An = min ( min ( Ap . x , Ap . y ) , Ap . z ) ; An = clamp ( An , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { Ao = vec3 ( mix ( u_wireframe_edge_color , Al , An ) ) ; Am = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { Ao = u_wireframe_edge_color ; Am = mix ( 1.0 , 0.0 , An ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) Ao = mix ( u_wireframe_edge_color , Aj , An ) ; else Ao = mix ( u_wireframe_edge_color , Ak , An ) ; Am = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["aG","(","Ao",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"aJ ( Ao , Am ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( Ao , Am ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},
{type:"textline",b:["varying","vec3","Ah",";"]},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 Ad ; mat4 Ai ; vec3 Aj , Ak , Al , Am , An ; if ( a_polyindex == 0.0 ) Ah = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Ah = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Ah = vec3 ( 0.0 , 0.0 , 1.0 ) ; Aj = a_position ; Ak = a_normal ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"aM Ao = rD ( Aj , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"Aj = mix ( Aj , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"Al = vec3 ( 0.0 ) ; Am = vec3 ( 0.0 ) ; sD ( Aj , Al , Am , Ak ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["Am","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Am = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"aM Ao = ub ( Aj , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Am , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"Al = ( u_model_matrix * vec4 ( Am , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ai = rw ( u_camera_eye , Al , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"Ai = rq ( u_camera_eye , Al , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"An = ( u_model_matrix * vec4 ( Am , 1.0 ) ) . xyz ; Ai = Ai * ri ( u_wind , u_time , u_jitter_amp , u_jitter_freq , An ) ;".split(" ")}]}}]},{type:"textline",b:"aM Ao = rD ( Aj - Am , Am , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ai ) ; Ao . b = Al ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"aM Ao = rD ( Aj , Am , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"tr ( Ao . a , Ao . b , Ak ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"Ad = u_view_matrix * vec4 ( Ao . a , 1.0 ) ; gl_Position = u_proj_matrix * Ad ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",
b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 bE ; void main ( ) { vec4 Ad , Ai ; Ad = texture2D ( u_sampler_left , bE ) ; Ai = texture2D ( u_sampler_right , bE ) ; gl_FragColor = vec4 ( Ad [ 0 ] , Ai [ 1 ] , Ai [ 2 ] , Ad [ 3 ] + Ai [ 3 ] ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},
{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 bE ; vec4 Ak ( float Ad , float Ai ) { vec2 Aj ; Aj = bE + vec2 ( Ad , Ai ) * u_texel_size ; return texture2D ( u_color , Aj ) ; } float Ao ( vec4 Al ) { float Am ; vec3 An ; An = vec3 ( 0.299 , 0.587 , 0.114 ) ; Am = dot ( Al . rgb , An ) ; return Am ; } vec4 AB ( ) { vec2 Ap ; float Aq , Ar , As , At , Au , Av ; vec4 Aw , Ax , Ay , Az , AA ; Aw = Ak ( - 1.0 , - 1.0 ) ; Ax = Ak ( 1.0 , - 1.0 ) ; Ay = Ak ( - 1.0 , 1.0 ) ; Az = Ak ( 1.0 , 1.0 ) ; AA = Ak ( 0.0 , 0.0 ) ; Aq = Ao ( Aw ) ; Ar = Ao ( Ax ) ; As = Ao ( Ay ) ; At = Ao ( Az ) ; Au = Ao ( AA ) ; Av = min ( Au , min ( min ( Aq , Ar ) , min ( As , At ) ) ) ; Au = max ( Au , max ( max ( Aq , Ar ) , max ( As , At ) ) ) ; Ap . x = - ( ( Aq + Ar ) - ( As + At ) ) ; Ap . y = ( ( Aq + As ) - ( Ar + At ) ) ; At = max ( ( Aq + Ar + As + At ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; At = 1.0 / ( min ( abs ( Ap . x ) , abs ( Ap . y ) ) + At ) ; Ap = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , Ap * At ) ) * u_texel_size ; AA = 0.5 * ( texture2D ( u_color , bE + Ap * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , bE + Ap * ( 2.0 / 3.0 - 0.5 ) ) ) ; Az = AA * 0.5 + 0.25 * ( texture2D ( u_color , bE + Ap * - 0.5 ) + texture2D ( u_color , bE + Ap * 0.5 ) ) ; At = Ao ( Az ) ; if ( ( At < Av ) || ( At > Au ) ) return AA ; else return Az ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 Bf ( ) { bool AC , AD , AE , AF , AG ; float AH , AI , AJ , AK , AL , AM , AN , AO , AP , AQ , AR , AS , AT , AU , AV ; vec4 AW , AX , AY , AZ , A_ ; vec2 Ba , Bb , Bc , Bd , Be ; Ba . x = bE . x ; Ba . y = bE . y ; AW = texture2D ( u_color , Ba ) ; AX = Ak ( 0.0 , 1.0 ) ; AY = Ak ( 1.0 , 0.0 ) ; AZ = Ak ( 0.0 , - 1.0 ) ; A_ = Ak ( - 1.0 , 0.0 ) ; AH = Ao ( AX ) ; AI = Ao ( AY ) ; AJ = Ao ( AZ ) ; AK = Ao ( A_ ) ; AL = Ao ( AW ) ; AM = max ( AH , AL ) ; AN = min ( AH , AL ) ; AM = max ( AI , AM ) ; AN = min ( AI , AN ) ; AO = max ( AJ , AK ) ; AP = min ( AJ , AK ) ; AM = max ( AO , AM ) ; AN = min ( AP , AN ) ; AP = AM * FXAA_QUALITY_EDGE_THRESHOLD ; AN = AM - AN ; AP = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , AP ) ; AC = AN < AP ; if ( AC ) return AW ; AW = Ak ( - 1.0 , - 1.0 ) ; A_ = Ak ( 1.0 , 1.0 ) ; AZ = Ak ( 1.0 , - 1.0 ) ; AY = Ak ( - 1.0 , 1.0 ) ; AP = Ao ( AW ) ; AM = Ao ( A_ ) ; AO = Ao ( AZ ) ; AQ = Ao ( AY ) ; AR = AJ + AH ; AS = AK + AI ; AN = 1.0 / AN ; AT = AR + AS ; AR = ( - 2.0 * AL ) + AR ; AS = ( - 2.0 * AL ) + AS ; AU = AO + AM ; AO = AP + AO ; AV = ( - 2.0 * AI ) + AU ; AO = ( - 2.0 * AJ ) + AO ; AP = AP + AQ ; AM = AQ + AM ; AV = ( abs ( AR ) * 2.0 ) + abs ( AV ) ; AO = ( abs ( AS ) * 2.0 ) + abs ( AO ) ; AS = ( - 2.0 * AK ) + AP ; AM = ( - 2.0 * AH ) + AM ; AV = abs ( AS ) + AV ; AO = abs ( AM ) + AO ; AU = AP + AU ; AP = u_texel_size . x ; AC = AV >= AO ; AU = AT * 2.0 + AU ; if ( ! AC ) AJ = AK ; if ( ! AC ) AH = AI ; if ( AC ) AP = u_texel_size . y ; AU = ( AU * ( 1.0 / 12.0 ) ) - AL ; AI = AJ - AL ; AK = AH - AL ; AJ = AJ + AL ; AH = AH + AL ; AD = abs ( AI ) >= abs ( AK ) ; AK = max ( abs ( AI ) , abs ( AK ) ) ; if ( AD ) AP = - AP ; AN = clamp ( abs ( AU ) * AN , 0.0 , 1.0 ) ; Bb . x = Ba . x ; Bb . y = Ba . y ; Bc . x = ( ! AC ) ? 0.0 : u_texel_size . x ; Bc . y = ( AC ) ? 0.0 : u_texel_size . y ; if ( ! AC ) Bb . x += AP * 0.5 ; if ( AC ) Bb . y += AP * 0.5 ; Bd . x = Bb . x - Bc . x ; Bd . y = Bb . y - Bc . y ; Be . x = Bb . x + Bc . x ; Be . y = Bb . y + Bc . y ; AU = ( ( - 2.0 ) * AN ) + 3.0 ; AI = Ao ( texture2D ( u_color , Bd ) ) ; AN = AN * AN ; AT = Ao ( texture2D ( u_color , Be ) ) ; if ( ! AD ) AJ = AH ; AK = AK * 1.0 / 4.0 ; AL = AL - AJ * 0.5 ; AN = AU * AN ; AD = AL < 0.0 ; AI -= AJ * 0.5 ; AT -= AJ * 0.5 ; AE = abs ( AI ) >= AK ; AF = abs ( AT ) >= AK ; if ( ! AE ) Bd . x -= Bc . x * 1.5 ; if ( ! AE ) Bd . y -= Bc . y * 1.5 ; AG = ( ! AE ) || ( ! AF ) ; if ( ! AF ) Be . x += Bc . x * 1.5 ; if ( ! AF ) Be . y += Bc . y * 1.5 ; if ( AG ) { if ( ! AE ) AI = Ao ( texture2D ( u_color , Bd . xy ) ) ; if ( ! AF ) AT = Ao ( texture2D ( u_color , Be . xy ) ) ; if ( ! AE ) AI = AI - AJ * 0.5 ; if ( ! AF ) AT = AT - AJ * 0.5 ; AE = abs ( AI ) >= AK ; AF = abs ( AT ) >= AK ; if ( ! AE ) Bd . x -= Bc . x * 2.0 ; if ( ! AE ) Bd . y -= Bc . y * 2.0 ; AG = ( ! AE ) || ( ! AF ) ; if ( ! AF ) Be . x += Bc . x * 2.0 ; if ( ! AF ) Be . y += Bc . y * 2.0 ; if ( AG ) { if ( ! AE ) AI = Ao ( texture2D ( u_color , Bd . xy ) ) ; if ( ! AF ) AT = Ao ( texture2D ( u_color , Be . xy ) ) ; if ( ! AE ) AI = AI - AJ * 0.5 ; if ( ! AF ) AT = AT - AJ * 0.5 ; AE = abs ( AI ) >= AK ; AF = abs ( AT ) >= AK ; if ( ! AE ) Bd . x -= Bc . x * 2.0 ; if ( ! AE ) Bd . y -= Bc . y * 2.0 ; AG = ( ! AE ) || ( ! AF ) ; if ( ! AF ) Be . x += Bc . x * 2.0 ; if ( ! AF ) Be . y += Bc . y * 2.0 ; if ( AG ) { if ( ! AE ) AI = Ao ( texture2D ( u_color , Bd . xy ) ) ; if ( ! AF ) AT = Ao ( texture2D ( u_color , Be . xy ) ) ; if ( ! AE ) AI = AI - AJ * 0.5 ; if ( ! AF ) AT = AT - AJ * 0.5 ; AE = abs ( AI ) >= AK ; AF = abs ( AT ) >= AK ; if ( ! AE ) Bd . x -= Bc . x * 4.0 ; if ( ! AE ) Bd . y -= Bc . y * 4.0 ; AG = ( ! AE ) || ( ! AF ) ; if ( ! AF ) Be . x += Bc . x * 4.0 ; if ( ! AF ) Be . y += Bc . y * 4.0 ; if ( AG ) { if ( ! AE ) AI = Ao ( texture2D ( u_color , Bd . xy ) ) ; if ( ! AF ) AT = Ao ( texture2D ( u_color , Be . xy ) ) ; if ( ! AE ) AI = AI - AJ * 0.5 ; if ( ! AF ) AT = AT - AJ * 0.5 ; AE = abs ( AI ) >= AK ; AF = abs ( AT ) >= AK ; if ( ! AE ) Bd . x -= Bc . x * 2.0 ; if ( ! AE ) Bd . y -= Bc . y * 2.0 ; if ( ! AF ) Be . x += Bc . x * 2.0 ; if ( ! AF ) Be . y += Bc . y * 2.0 ; } } } } AK = Ba . x - Bd . x ; AJ = Be . x - Ba . x ; if ( ! AC ) AK = Ba . y - Bd . y ; if ( ! AC ) AJ = Be . y - Ba . y ; AF = ( AI < 0.0 ) != AD ; AI = ( AJ + AK ) ; AD = ( AT < 0.0 ) != AD ; AI = 1.0 / AI ; AE = AK < AJ ; AJ = min ( AK , AJ ) ; AD = AE ? AF : AD ; AN = AN * AN ; AI = ( AJ * ( - AI ) ) + 0.5 ; AN = AN * FXAA_QUALITY_SUBPIX ; AI = AD ? AI : 0.0 ; AN = max ( AI , AN ) ; if ( ! AC ) Ba . x += AN * AP ; if ( AC ) Ba . y += AN * AP ; return texture2D ( u_color , Ba ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_PASS",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , bE ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{type:"equal_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"gl_FragColor = AB ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = Bf ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , bE ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 bE ; void main ( ) { vec4 Ad ; vec2 Ai , Aj ; Ai = vec2 ( 0.0 , 0.0 ) ; Aj = u_texel_size ; Ad = texture2D ( u_color , bE ) ; gl_FragColor = Ad * 0.0875447373698 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0858112354248 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0808139781061 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0731235112908 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0635705267419 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0530985673112 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0426125984122 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0328565115809 ; Ai += Aj ; gl_FragColor += texture2D ( u_color , bE + Ai ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , bE - Ai ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * Ad , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 bE ; void main ( ) { vec4 Ad , Ai ; Ad = texture2D ( u_main , bE ) ; Ai = texture2D ( u_bloom , bE ) ; Ad = Ad ; Ad += Ai ; gl_FragColor = vec4 ( Ad . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 bE ; void main ( ) { float Ad ; vec3 Ai , Aj ; vec4 Ak ; Ak = texture2D ( u_color , bE ) ; Ai = Ak . rgb ; if ( u_brightness < 0.0 ) Ai = Ai * ( 1.0 + u_brightness ) ; else Ai = Ai + ( ( 1.0 - Ai ) * u_brightness ) ; Ai = ( Ai - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; Ai *= u_exposure ; Aj = vec3 ( 0.299 , 0.587 , 0.114 ) ; Ad = dot ( Ai , Aj ) ; Ai = mix ( vec3 ( Ad ) , Ai , u_saturation ) ; gl_FragColor = vec4 ( Ai , Ak . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 bE ; void main ( ) { gl_FragColor = g ( clamp ( Ao ( u_depth , bE , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]=
{type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 bE ; void main ( ) { float Ad , Ap ; vec4 Aq , Ar ; Aq = texture2D ( u_sharp , bE ) ; if ( u_dof_dist > 0.0 ) { Ad = Ao ( u_depth , bE , u_camera_range ) ; Ad *= u_view_max_depth ; if ( Ad < u_dof_dist ) Ap = ( u_dof_dist - Ad ) / u_dof_front ; else Ap = ( Ad - u_dof_dist ) / u_dof_rear ; Ap = clamp ( Ap , 0.0 , 1.0 ) ; Ar = texture2D ( u_blurred , bE ) ; gl_FragColor = mix ( Aq , Ar , Ap ) ; } else gl_FragColor = Aq ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_src_color ; uniform sampler2D u_glow_mask_small ; uniform sampler2D u_glow_mask_large ; uniform float u_glow_mask_small_coeff ; uniform float u_glow_mask_large_coeff ; varying vec2 bE ; void main ( ) { float Ad ; vec4 Ap , Aq , Ar ; Ap = texture2D ( u_src_color , bE ) ; Aq = texture2D ( u_glow_mask_small , bE ) ; Ar = texture2D ( u_glow_mask_large , bE ) ; gl_FragColor = Ap ; if ( Ar . a != 0.0 ) { Ad = u_glow_mask_large_coeff * Ar . a ; Ad = clamp ( Ad , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , Ar . rgb / Ar . a , Ad ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , Ad ) ; } if ( Aq . a != 0.0 ) { Ad = u_glow_mask_small_coeff * Aq . a ; Ad = clamp ( Ad , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , Aq . rgb / Aq . a , Ad ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , Ad ) ; } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float Ap ; varying vec2 Aq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 bE ; varying vec4 Ar ; void main ( ) { vec4 As ; float At , Au , Av , Aw , Ax ; vec2 Ay , Az , AA ; Ay = ( Ar . xy - bE ) ; At = length ( Ay ) ; Ay = u_radial_blur_step * Ay / At ; Au = At / u_radial_blur_step ; Ay *= min ( Au , STEPS_PER_PASS ) / STEPS_PER_PASS ; Au = max ( Au , STEPS_PER_PASS ) ; Az = bE ; Av = 0.0 ; for ( float AB = 0.0 ; AB < STEPS_PER_PASS ; AB += 1.0 ) { if ( AB <= Au ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"Aw = Ao ( u_input , Az , u_camera_range ) ; Av += max ( ( 1.0 - pow ( At , 0.3 ) ) * step ( 0.9 , Aw ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"As = texture2D ( u_input , Az ) ; Av += k ( As ) ;".split(" ")}]}}]},{type:"textline",b:"} Az += Ay ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"AA = bE + Aq ; Ax = L ( vec2 ( 2.5 * ( AA . x ) , 2.5 * ( AA . y ) + 1.0 * u_time ) ) . x + 0.75 * L ( vec2 ( 5.0 * ( AA . x ) - 0.66 * u_time , 5.0 * ( AA . y ) + 0.66 * u_time ) ) . x + 0.5 * ag ( vec2 ( 7.5 * ( AA . x ) + 0.33 * u_time , 7.5 * ( AA . y ) - 0.33 * u_time ) ) ; Ax *= clamp ( 1.2 - sqrt ( 0.2 * At ) , 0.0 , 1.0 ) * Ap ; Av = max ( Ax , Av ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = g ( Av / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"include",file:"math.glslv"},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float Ap ; varying vec2 Aq ;".split(" ")}]}}]}]}}]},{type:"textline",
b:"varying vec2 bE ; varying vec4 Ar ; void main ( ) { float Ad , As ; vec3 At ; bE = a_bb_vertex + 0.5 ; At = normalize ( u_sun_direction ) ; Ar = u_proj_matrix * u_view_matrix * vec4 ( At , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { Ap = 1.0 ; At = vec3 ( 0.0 , 1.0 , 0.0 ) ; At = aS ( u_camera_quat , At ) ; At = normalize ( At ) ; Ad = dot ( At , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; As = atan ( At . x , At . z ) ; Aq = vec2 ( - As , acos ( Ad ) ) ; } else { Ap = 0.0 ; }".split(" ")}]}}]},
{type:"textline",b:"Ar . xy = 0.5 * ( Ar . xy / Ar . w + 1.0 ) ; Ar += 99999.0 * step ( Ar . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 bE ; void main ( ) { float Ad ; vec3 As ; vec4 At ; At = texture2D ( u_main , bE ) ; As = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; aE ( At . rgb ) ; Ad = k ( texture2D ( u_god_rays , bE ) ) ; As = At . rgb + u_god_rays_intensity * vec3 ( Ad ) * As ; aG ( As ) ; gl_FragColor . rgb = As ; gl_FragColor . a = At . a ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 bE ; void main ( ) { float Ad ; vec4 As ; As = texture2D ( u_input , bE ) ; Ad = dot ( As . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( Ad ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float Ad , As ; As = 0.0 ; for ( float At = 0.025 ; At < 1.0 ; At += 0.05 ) for ( float Au = 0.025 ; Au < 1.0 ; Au += 0.05 ) { Ad = max ( texture2D ( u_input , vec2 ( At , Au ) ) . r , 0.01 ) ; As += log ( Ad ) ; } As = exp ( As / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( As ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 bE ; varying float As ; void main ( ) { vec4 At ; float Au , Av ; Au = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; Av = texture2D ( u_luminance , bE ) . r ; At = texture2D ( u_main , bE ) ; Au = Av / Au ; Av = u_bloom_edge_lum ; gl_FragColor = At * max ( Au - Av , 0.0 ) * As ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 bE ; varying float As ; const vec3 Ad = vec3 ( 0.0 , 1.0 , 0.0 ) ; void AA ( in vec4 At , in vec3 Au , out vec3 Av ) { float Aw , Ax , Ay , Az ; Aw = At . w * Au . x + At . y * Au . z - At . z * Au . y ; Ax = At . w * Au . y + At . z * Au . x - At . x * Au . z ; Ay = At . w * Au . z + At . x * Au . y - At . y * Au . x ; Az = - At . x * Au . x - At . y * Au . y - At . z * Au . z ; Av . x = Aw * At . w - Az * At . x - Ax * At . z + Ay * At . y ; Av . y = Ax * At . w - Az * At . y - Ay * At . x + Aw * At . z ; Av . z = Ay * At . w - Az * At . z - Aw * At . y + Ax * At . x ; } void main ( ) { vec3 AB ; bE = 2.0 * a_position ; AA ( u_camera_quat , Ad , AB ) ; As = dot ( - AB , u_sun_direction ) * u_bloom_key ; As *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; uniform float u_motion_blur_decay_threshold ; varying vec2 bE ; float Ad = 0.0042 ; void main ( ) { vec4 At , Au , Av , Aw ; At = texture2D ( u_mb_tex_curr , bE ) ; Au = texture2D ( u_mb_tex_accum , bE ) ; if ( length ( At - Au ) > u_motion_blur_decay_threshold ) { Av = ( 1.0 - u_motion_blur_exp ) * At + u_motion_blur_exp * Au ; Av = Av - Au ; Aw = At - Au ; Av = min ( max ( abs ( Av ) , vec4 ( Ad ) ) , abs ( Aw ) ) * sign ( Av ) ; gl_FragColor = Au + Av ; } else { gl_FragColor = At ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 bE ; void main ( ) { vec3 Ad ; float At ; vec4 Au , Av , Aw ; Au = texture2D ( u_outline_src , bE ) ; gl_FragColor = Au ; if ( u_draw_outline != 0.0 ) { Av = texture2D ( u_outline_mask , bE ) ; Aw = texture2D ( u_outline_mask_blurred , bE ) ; At = Aw . a - Av . a ; if ( At != 0.0 ) { At = smoothstep ( 0.0 , 1.0 , Aw . a ) ; if ( Av . a == 0.0 ) { Ad = u_outline_color ; aG ( Ad ) ; Av = vec4 ( clamp ( Ad , 0.0 , 1.0 ) , 1.0 ) ; gl_FragColor = mix ( Au , Av , At ) ; } } } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 bE ; void main ( ) { vec2 Ad , At ; vec4 Au ;".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","POST_EFFECT_NONE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , bE ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","POST_EFFECT_GRAYSCALE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Au = texture2D ( u_color , bE ) ; gl_FragColor . rgb = vec3 ( ( Au . r + Au . g + Au . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_BLUR",
{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_BLUR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ad = vec2 ( 0.0 , 0.0 ) ; At = u_texel_size ; Au = texture2D ( u_color , bE ) ; gl_FragColor = Au * 0.2270270270 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * 0.1945945946 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * 0.1945945946 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * 0.1216216216 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * 0.1216216216 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * 0.0540540541 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * 0.0540540541 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * 0.0162162162 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_GLOW_BLUR",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ad = vec2 ( 0.0 , 0.0 ) ; At = u_texel_size ; Au = texture2D ( u_color , bE ) ; gl_FragColor = Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.152507 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.141763 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.141763 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.113861 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.113861 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.079019 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.079019 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.047383 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.047383 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.024549 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.024549 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.01099 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.01099 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.00425 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.00425 ; Ad += At ; Au = texture2D ( u_color , bE + Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.00142 ; Au = texture2D ( u_color , bE - Ad ) ; gl_FragColor += Au * ( 1.0 - step ( 0.0 , - Au . a ) ) * 0.00142 ; gl_FragColor = clamp ( gl_FragColor , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_EXTEND",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_EXTEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"At = u_texel_size ; Au = texture2D ( u_color , bE ) ; gl_FragColor = Au ; if ( Au . a == 0.0 ) { Au = texture2D ( u_color , bE + At ) ; if ( Au . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Au . a ) ; else { Au = texture2D ( u_color , bE - At ) ; if ( Au . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Au . a ) ; } }".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; varying vec2 bE ; void main ( ) { bE = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",
name:"SMAA_EDGE_DETECTION",b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",d:2},"SMAA_PREDICATION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 bE ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","At",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 Au ; varying vec4 Av ; varying vec4 Aw ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","Ax",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",
b:["1"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",
name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},
{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},
{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 AD ( vec2 Ay , sampler2D Az ) { float AA , AB , AC ; AA = texture2D ( Az , Ay ) . r ; AB = texture2D ( Az , Au . xy ) . r ; AC = texture2D ( Az , Au . zw ) . r ; return vec3 ( AA , AB , AC ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 AI ( vec2 AE , sampler2D AF ) { vec2 AG ; vec3 AH ; AH = AD ( AE , AF ) ; AG = abs ( AH . xx - AH . yz ) ; AG = step ( SMAA_PREDICATION_THRESHOLD , AG ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * AG ) ; }".split(" ")}]}}]},
{type:"textline",b:"void AM ( bvec2 AJ , inout vec2 AK , vec2 AL ) { if ( AJ . x ) AK . x = AL . x ; if ( AJ . y ) AK . y = AL . y ; } void AM ( bvec4 AN , inout vec4 AO , vec4 AP ) { AM ( AN . xy , AO . xy , AP . xy ) ; AM ( AN . zw , AO . zw , AP . zw ) ; } vec2 AR ( vec2 AQ ) { return sign ( AQ ) * floor ( abs ( AQ ) + .5 ) ; } vec4 AR ( vec4 AS ) { return sign ( AS ) * floor ( abs ( AS ) + .5 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 Be ( vec2 AT , sampler2D AU".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","AV"]}]}}]},{type:"textline",b:") { vec4 AW ; float AX , AY , AZ , A_ , Ba ; vec3 Bb ; vec2 Bc , Bd ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"Bc = AI ( AT , AV ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"Bc = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"Bb = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; AX = dot ( texture2D ( AU , AT ) . rgb , Bb ) ; AY = dot ( texture2D ( AU , Au . xy ) . rgb , Bb ) ; AZ = dot ( texture2D ( AU , Au . zw ) . rgb , Bb ) ; AW . xy = abs ( AX - vec2 ( AY , AZ ) ) ; Bc = step ( Bc , AW . xy ) ; if ( dot ( Bc , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; A_ = dot ( texture2D ( AU , Av . xy ) . rgb , Bb ) ; Ba = dot ( texture2D ( AU , Av . zw ) . rgb , Bb ) ; AW . zw = abs ( AX - vec2 ( A_ , Ba ) ) ; Bd = max ( AW . xy , AW . zw ) ; Ba = dot ( texture2D ( AU , Aw . xy ) . rgb , Bb ) ; A_ = dot ( texture2D ( AU , Aw . zw ) . rgb , Bb ) ; AW . zw = abs ( vec2 ( AY , AZ ) - vec2 ( Ba , A_ ) ) ; Bd = max ( Bd . xy , AW . zw ) ; A_ = max ( Bd . x , Bd . y ) ; Bc . xy *= step ( A_ , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * AW . xy ) ; return Bc ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vec2 Bg ( vec2 Bf ) { Bf . r = Bf . r * abs ( 5.0 * Bf . r - 5.0 * 0.75 ) ; return AR ( Bf ) ; } vec4 Bg ( vec4 Bh ) { Bh . rb = Bh . rb * abs ( 5.0 * Bh . rb - 5.0 * 0.75 ) ; return AR ( Bh ) ; } vec2 Bp ( sampler2D Bi , vec2 Bj , vec2 Bk , out vec2 Bl ) { vec3 Bm ; vec4 Bn ; Bn = vec4 ( Bj , - 1.0 , 1.0 ) ; Bm = vec3 ( u_texel_size , 1.0 ) ; for ( int Bo = 0 ; Bo < SMAA_MAX_SEARCH_STEPS_DIAG ; Bo ++ ) { if ( Bn . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Bn . w > 0.9 ) { Bn . xyz += Bm * vec3 ( Bk , 1.0 ) ; Bl = texture2D ( Bi , Bn . xy , 0.0 ) . rg ; Bn . w = dot ( Bl , vec2 ( 0.5 , 0.5 ) ) ; } } return Bn . zw ; } vec2 Bx ( sampler2D Bq , vec2 Br , vec2 Bs , out vec2 Bt ) { vec3 Bu ; vec4 Bv ; Bv = vec4 ( Br , - 1.0 , 1.0 ) ; Bv . x += 0.25 * u_texel_size . x ; Bu = vec3 ( u_texel_size , 1.0 ) ; for ( int Bw = 0 ; Bw < SMAA_MAX_SEARCH_STEPS_DIAG ; Bw ++ ) { if ( Bv . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Bv . w > 0.9 ) { Bv . xyz = Bu * vec3 ( Bs , 1.0 ) + Bv . xyz ; Bt = texture2D ( Bq , Bv . xy , 0.0 ) . rg ; Bt = Bg ( Bt ) ; Bv . w = dot ( Bt , vec2 ( 0.5 , 0.5 ) ) ; } } return Bv . zw ; } vec2 BD ( sampler2D By , vec2 Bz , vec2 BA , float BB ) { vec2 BC ; BC = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * BA + Bz ; BC = SMAA_AREATEX_PIXEL_SIZE * BC + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; BC . x += 0.5 ; BC . y += SMAA_AREATEX_SUBTEX_SIZE * BB ; return texture2D ( By , BC , 0.0 ) . rg ; } vec2 BP ( sampler2D BE , sampler2D BF , vec2 BG , vec2 BH , vec4 BI ) { vec4 BJ , BK , BL ; vec2 BM , BN , BO ; BM = vec2 ( 0.0 , 0.0 ) ; if ( BH . r > 0.0 ) { BJ . xz = Bp ( BE , BG , vec2 ( - 1.0 , 1.0 ) , BN ) ; BJ . x += float ( BN . y > 0.9 ) ; } else BJ . xz = vec2 ( 0.0 , 0.0 ) ; BJ . yw = Bp ( BE , BG , vec2 ( 1.0 , - 1.0 ) , BN ) ; if ( BJ . x + BJ . y > 2.0 ) { BK = vec4 ( - BJ . x + 0.25 , BJ . x , BJ . y , - BJ . y - 0.25 ) * u_texel_size . xyxy + BG . xyxy ; BL . xy = texture2D ( BE , BK . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; BL . zw = texture2D ( BE , BK . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; BL . yxwz = Bg ( BL . xyzw ) ; BO = vec2 ( 2.0 , 2.0 ) * BL . xz + BL . yw ; AM ( bvec2 ( step ( 0.9 , BJ . zw ) ) , BO , vec2 ( 0.0 , 0.0 ) ) ; BM += BD ( BF , BJ . xy , BO , BI . z ) ; } BJ . xz = Bx ( BE , BG , vec2 ( - 1 , - 1 ) , BN ) ; if ( texture2D ( BE , BG + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { BJ . yw = Bx ( BE , BG , vec2 ( 1 , 1 ) , BN ) ; BJ . y += float ( BN . y > 0.9 ) ; } else BJ . yw = vec2 ( 0.0 , 0.0 ) ; if ( BJ . x + BJ . y > 2.0 ) { BL = vec4 ( - BJ . x , - BJ . x , BJ . y , BJ . y ) * u_texel_size . xyxy + BG . xyxy ; BK . x = texture2D ( BE , BL . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; BK . y = texture2D ( BE , BL . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; BK . zw = texture2D ( BE , BL . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; BN = vec2 ( 2.0 , 2.0 ) * BK . xz + BK . yw ; AM ( bvec2 ( step ( 0.9 , BJ . zw ) ) , BN , vec2 ( 0 , 0 ) ) ; BM += BD ( BF , BJ . xy , BN , BI . w ) . gr ; } return BM ; }".split(" ")}]}}]},
{type:"textline",b:"float BV ( sampler2D BQ , vec2 BR , float BS ) { vec2 BT , BU ; BT = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; BU = SMAA_SEARCHTEX_SIZE * vec2 ( BS , 1.0 ) ; BT += vec2 ( - 1.0 , 1.0 ) ; BU += vec2 ( 0.5 , - 0.5 ) ; BT *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; BU *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( BQ , BT * BR + BU , 0.0 ) . r ; } float Cc ( sampler2D BW , sampler2D BX , vec2 BY , float BZ ) { float B_ ; vec2 Ca ; Ca = vec2 ( 0.0 , 1.0 ) ; for ( int Cb = 0 ; Cb < SMAA_MAX_SEARCH_STEPS ; Cb ++ ) { if ( BY . x > BZ && Ca . g > 0.8281 && Ca . r == 0.0 ) { Ca = texture2D ( BW , BY , 0.0 ) . rg ; BY = - vec2 ( 2.0 , 0.0 ) * u_texel_size + BY ; } } B_ = - ( 255.0 / 127.0 ) * BV ( BX , Ca , 0.0 ) + 3.25 ; return u_texel_size . x * B_ + BY . x ; } float Ck ( sampler2D Cd , sampler2D Ce , vec2 Cf , float Cg ) { float Ch ; vec2 Ci ; Ci = vec2 ( 0.0 , 1.0 ) ; for ( int Cj = 0 ; Cj < SMAA_MAX_SEARCH_STEPS ; Cj ++ ) { if ( Cf . x < Cg && Ci . g > 0.8281 && Ci . r == 0.0 ) { Ci = texture2D ( Cd , Cf , 0.0 ) . rg ; Cf = vec2 ( 2.0 , 0.0 ) * u_texel_size + Cf ; } } Ch = - ( 255.0 / 127.0 ) * BV ( Ce , Ci , 0.5 ) + 3.25 ; return - u_texel_size . x * Ch + Cf . x ; } float Cs ( sampler2D Cl , sampler2D Cm , vec2 Cn , float Co ) { float Cp ; vec2 Cq ; Cq = vec2 ( 1.0 , 0.0 ) ; for ( int Cr = 0 ; Cr < SMAA_MAX_SEARCH_STEPS ; Cr ++ ) { if ( Cn . y > Co && Cq . r > 0.8281 && Cq . g == 0.0 ) { Cq = texture2D ( Cl , Cn , 0.0 ) . rg ; Cn = - vec2 ( 0.0 , 2.0 ) * u_texel_size + Cn ; } } Cp = - ( 255.0 / 127.0 ) * BV ( Cm , Cq . gr , 0.0 ) + 3.25 ; return u_texel_size . y * Cp + Cn . y ; } float CA ( sampler2D Ct , sampler2D Cu , vec2 Cv , float Cw ) { float Cx ; vec2 Cy ; Cy = vec2 ( 1.0 , 0.0 ) ; for ( int Cz = 0 ; Cz < SMAA_MAX_SEARCH_STEPS ; Cz ++ ) { if ( Cv . y < Cw && Cy . r > 0.8281 && Cy . g == 0.0 ) { Cy = texture2D ( Ct , Cv , 0.0 ) . rg ; Cv = vec2 ( 0.0 , 2.0 ) * u_texel_size + Cv ; } } Cx = - ( 255.0 / 127.0 ) * BV ( Cu , Cy . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * Cx + Cv . y ; } vec2 CH ( sampler2D CB , vec2 CC , float CD , float CE , float CF ) { vec2 CG ; CG = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * AR ( 4.0 * vec2 ( CD , CE ) ) + CC ; CG = SMAA_AREATEX_PIXEL_SIZE * CG + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; CG . y = SMAA_AREATEX_SUBTEX_SIZE * CF + CG . y ; return texture2D ( CB , CG , 0.0 ) . rg ; } void CO ( sampler2D CI , inout vec2 CJ , vec4 CK , vec2 CL ) { vec2 CM , CN ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"CM = step ( CL . xy , CL . yx ) ; CN = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * CM ; CN /= CM . x + CM . y ; CM = vec2 ( 1.0 , 1.0 ) ; CM . x -= CN . x * texture2D ( CI , CK . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; CM . x -= CN . y * texture2D ( CI , CK . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; CM . y -= CN . x * texture2D ( CI , CK . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; CM . y -= CN . y * texture2D ( CI , CK . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; CJ *= clamp ( CM , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void CV ( sampler2D CP , inout vec2 CQ , vec4 CR , vec2 CS ) { vec2 CT , CU ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"CT = step ( CS . xy , CS . yx ) ; CU = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * CT ; CU /= CT . x + CT . y ; CT = vec2 ( 1.0 , 1.0 ) ; CT . x -= CU . x * texture2D ( CP , CR . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; CT . x -= CU . y * texture2D ( CP , CR . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; CT . y -= CU . x * texture2D ( CP , CR . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; CT . y -= CU . y * texture2D ( CP , CR . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; CQ *= clamp ( CT , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 Di ( vec2 CW , vec2 CX , sampler2D CY , sampler2D CZ , sampler2D C_ , vec4 Da ) { float Db , Dc ; vec3 Dd ; vec2 De , Df , Dg ; vec4 Dh ; Dh = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; De = texture2D ( CY , CW ) . rg ; if ( De . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:"Dh . rg = BP ( CY , CZ , CW , De , Da ) ; if ( Dh . r == - Dh . g ) {".split(" ")}]}}]},{type:"textline",b:"; Dd . x = Cc ( CY , C_ , Au . xy , Aw . x ) ; Dd . y = Av . y ; Df . x = Dd . x ; Db = texture2D ( CY , Dd . xy , 0.0 ) . r ; Dd . z = Ck ( CY , C_ , Au . zw , Aw . y ) ; Df . y = Dd . z ; Df = abs ( AR ( Df / u_texel_size . xx - CX . xx ) ) ; Dg = sqrt ( Df ) ; Dc = texture2D ( CY , Dd . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; Dh . rg = CH ( CZ , Dg , Db , Dc , Da . y ) ; Dd . y = CW . y ; CO ( CY , Dh . rg , Dd . xyzy , Df ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"} else De . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( De . r > 0.0 ) { ; Dd . y = Cs ( CY , C_ , Av . xy , Aw . z ) ; Dd . x = Au . x ; De . x = Dd . y ; Dc = texture2D ( CY , Dd . xy , 0.0 ) . g ; Dd . z = CA ( CY , C_ , Av . zw , Aw . w ) ; De . y = Dd . z ; De = abs ( AR ( De / u_texel_size . yy - CX . yy ) ) ; Df = sqrt ( De ) ; Db = texture2D ( CY , Dd . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; Dh . ba = CH ( CZ , Df , Dc , Db , Da . x ) ; Dd . x = CW . x ; CV ( CY , Dh . ba , Dd . xyxz , De ) ; } return Dh ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 Du ( vec2 Dj , sampler2D Dk , sampler2D Dl".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","Dm"]}]}}]},{type:"textline",b:") { bool Dn ; vec2 Do , Dp , Dq ; vec4 Dr , Ds , Dt ; Dr . x = texture2D ( Dl , At . xy ) . a ; Dr . y = texture2D ( Dl , At . zw ) . g ; Dr . wz = texture2D ( Dl , Dj ) . xz ; if ( dot ( Dr , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { Ds = texture2D ( Dk , Dj , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"Dt = texture2D ( Dm , bE ) ; Do = 2.0 * s ( Dt ) - 1.0 ; Ds . a = sqrt ( 2.0 * length ( Do ) ) ;".split(" ")}]}}]},{type:"textline",b:"return Ds ; } else { Dn = max ( Dr . x , Dr . z ) > max ( Dr . y , Dr . w ) ; Ds = vec4 ( 0.0 , Dr . y , 0.0 , Dr . w ) ; Do = Dr . yw ; AM ( bvec4 ( Dn , Dn , Dn , Dn ) , Ds , vec4 ( Dr . x , 0.0 , Dr . z , 0.0 ) ) ; AM ( bvec2 ( Dn , Dn ) , Do , Dr . xz ) ; Do /= dot ( Do , vec2 ( 1.0 , 1.0 ) ) ; Ds = Ds * vec4 ( u_texel_size , - u_texel_size ) + Dj . xyxy ; Dr = Do . x * texture2D ( Dk , Ds . xy , 0.0 ) ; Dr += Do . y * texture2D ( Dk , Ds . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"Dt = texture2D ( Dm , Ds . xy ) ; Dp = 2.0 * s ( Dt ) - 1.0 ; Dq = Do . x * Dp ; Dt = texture2D ( Dm , Ds . zw ) ; Dp = 2.0 * s ( Dt ) - 1.0 ; Dq += Do . y * Dp ; Dr . a = sqrt ( 2.0 * length ( Dq ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","Dr",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 DE ( vec2 Dv , sampler2D Dw , sampler2D Dx".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","Dy"]}]}}]},{type:"textline",b:") { float Dz ; vec2 DA ; vec4 DB , DC , DD ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"DB = texture2D ( Dy , bE ) ; DA = 2.0 * s ( DB ) - 1.0 ; DB = texture2D ( Dw , Dv ) ; DC = texture2D ( Dx , Dv - DA ) ; Dz = abs ( DB . a * DB . a - DC . a * DC . a ) / 2.0 ; Dz = 0.5 * clamp ( 1.0 - sqrt ( Dz ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; DD = mix ( DB , DC , Dz ) ; DD . a = 1.0 ; return DD ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"DB = texture2D ( Dw , Dv ) ; DC = texture2D ( Dx , Dv ) ; return mix ( DB , DC , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:"void main ( ) { vec4 DF ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"DF = vec4 ( Be ( bE , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",
a:[{type:"textline",b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"DF = Di ( bE , Ax , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"DF = Du ( bE , u_color , u_blend".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"DF = vec4 ( DE ( bE , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"DF = texture2D ( u_color , bE ) ;".split(" ")}]}}]},{type:"textline",b:["gl_FragColor","=","DF",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",
b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 bE ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","At",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 Au ; varying vec4 Av ; varying vec4 Aw ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","Ax",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD",
"AA_METHOD_SMAA_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void Ay ( vec2 Ad ) { Au = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + Ad . xyxy ; Av = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + Ad . xyxy ; Aw = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + Ad . xyxy ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void AB ( vec2 Az , out vec2 AA ) { AA = Az / u_texel_size ; Au = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + Az . xyxy ; Av = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + Az . xyxy ; Aw = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( Au . xz , Av . yw ) ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void AD ( vec2 AC ) { At = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + AC . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { bE = 2.0 * a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["Ay","(","bE",")",";"]}]}},{type:"elif",c:["SMAA_PASS",
"SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AB ( bE , Ax ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["AD","(","bE",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",
b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},{type:"define",name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 bE ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float Ay ( in vec2 Ad ) { return Ao ( u_depth , Ad , u_camera_range ) ; } void main ( ) { vec3 Az , AA , AB ; float AC , AD , AE , AF , AG , AH , AI ; AC = texture2D ( u_color , bE ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( AC , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"Az = normalize ( 2.0 * texture2D ( u_ssao_special_tex , bE * 0.25 / u_texel_size ) . rgb - 1.0 ) ; AD = Ay ( bE ) ; AE = AD * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","SSAO_QUALITY_8",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"const float AJ = 8.0 ; const int AK = 1 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_16",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float AJ = 16.0 ; const int AK = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_24",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float AJ = 24.0 ; const int AK = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_32",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"const float AJ = 32.0 ; const int AK = 4 ;".split(" ")}]}}]},{type:"textline",b:"AF = u_ssao_radius_increase * 0.001 ; const float AL = 1.0 + 2.4 / AJ ; AG = 0.0 ; for ( int AM = 0 ; AM < AK ; AM ++ ) for ( int AN = - 1 ; AN <= 1 ; AN += 2 ) for ( int AO = - 1 ; AO <= 1 ; AO += 2 ) for ( int AP = - 1 ; AP <= 1 ; AP += 2 ) { AA = reflect ( normalize ( vec3 ( AN , AO , AP ) ) , Az ) * ( AF *= AL ) ; AB = vec3 ( bE , AE ) ; AB += vec3 ( AA . xy , AA . z * AE * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"AB . z -= 1.4 * ( AB . z - AE ) * step ( AE , AB . z ) ;".split(" ")}]}}]},{type:"textline",b:"AH = Ay ( AB . xy ) * ( u_camera_range . y - u_camera_range . x ) ; AI = clamp ( ( AE - AH ) / AH , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"AG += mix ( 1.0 , AI , step ( AH , AB . z ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"AG += mix ( step ( AB . z , AH ) , 0.5 , AI ) ;".split(" ")}]}}]},{type:"textline",b:"} AG = AG / AJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"AG = clamp ( AG * AG + 0.6 * AG , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AG = clamp ( AG * AG + AG , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"AD = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * AD ) ; AG = mix ( 1.0 , AG , AD ) ; gl_FragColor = vec4 ( AC , AG , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 bE ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float Ay ( in vec2 Ad ) { return Ao ( u_depth , Ad , u_camera_range ) ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec2 Az , AA ; float AB , AC , AD , AE , AF , AG , AH ; AB = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"AC = Ay ( bE ) ; AD = 0.0 ; AE = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},
{type:"textline",b:"Az = vec2 ( - 2.0 ) ; for ( int AI = 0 ; AI < 4 ; ++ AI ) { for ( int AJ = 0 ; AJ < 4 ; ++ AJ ) { AA = ( Az + vec2 ( float ( AI ) , float ( AJ ) ) ) * u_texel_size ; AF = texture2D ( u_ssao_mask , bE + AA ) . g ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"AG = Ay ( bE + AA ) ; AH = 1.0 - clamp ( abs ( AG - AC ) * AE , 0.0 , 1.0 ) ; AB += AF * AH ; AD += AH ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["AB","+=","AF",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bE ) . r , AB / AD , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bE ) . r , AB / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",
file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 bE ; void main ( ) { vec2 Ad ; vec4 Ay , Az ; float AA ; AA = texture2D ( u_depth , bE ) . x ; Ay = vec4 ( bE * 2.0 - 1.0 , 2.0 * AA - 1.0 , 1.0 ) ; Az = u_view_proj_inverse * Ay ; Az = Az / Az . w ; Az = u_view_proj_prev * Az ; Az /= Az . w ; Ad = ( Ay . xy - Az . xy ) / 4.0 + 0.5 ; Ad = clamp ( Ad , 0.0 , 1.0 ) ; gl_FragColor = g ( Ad ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",
b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"NO_SHADOWS",b:["1"]},{type:"define",name:"SHADOW_CASTING",b:["2"]},{type:"define",name:"SHADOW_MASK_GENERATION",b:["3"]},{type:"define",name:"SHADOW_MAPPING_OPAQUE",b:["4"]},{type:"define",name:"SHADOW_MAPPING_BLEND",b:["5"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",
name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"SPECULAR_BLINN",b:["4"]},{type:"define",name:"SPECULAR_TOON",b:["5"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"DIFFUSE_MINNAERT",b:["4"]},{type:"define",name:"DIFFUSE_TOON",b:["5"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",
b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]},{type:"define",name:"MIX",b:["0"]},{type:"define",name:"ADD",b:["1"]},{type:"define",name:"SUBTRACT",b:["2"]},{type:"define",name:"MULTIPLY",b:["3"]},{type:"define",name:"SCREEN",b:["4"]},{type:"define",name:"OVERLAY",b:["5"]},{type:"define",name:"DIFFERENCE",b:["6"]},{type:"define",name:"DIVIDE",b:["7"]},{type:"define",name:"DARKEN",b:["8"]},{type:"define",name:"LIGHTEN",b:["9"]},
{type:"define",name:"HUE",b:["10"]},{type:"define",name:"SATURATION",b:["11"]},{type:"define",name:"VALUE",b:["12"]},{type:"define",name:"COLOR",b:["13"]},{type:"define",name:"SOFT_LIGHT",b:["14"]},{type:"define",name:"LINEAR_LIGHT",b:["15"]},{type:"define",name:"REFL_NONE",b:["0"]},{type:"define",name:"REFL_MIRRORMAP",b:["1"]},{type:"define",name:"REFL_PLANE",b:["2"]},{type:"define",name:"REFL_CUBE",b:["3"]},{type:"define",name:"INVERSE_QUADRATIC",b:["0"]},{type:"define",name:"LINEAR",b:["1"]},{type:"define",
name:"QUADRATIC",b:["2"]},{type:"define",name:"HEMI",b:["1"]},{type:"define",name:"SPOT",b:["2"]},{type:"define",name:"POINT",b:["3"]},{type:"define",name:"SUN",b:["4"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float a = 255.0 ; float b = 0.0 ; float c = 1.0 ; vec4 g ( const in float d ) { vec4 e , f ; e = vec4 ( a * a * a , a * a , a , c ) ; f = vec4 ( b , c / a , c / a , c / a ) ; e = fract ( d * e ) ; e -= e . xxyz * f ; return e ; } float k ( const in vec4 h ) { vec4 i ; float j ; i = vec4 ( c / ( a * a * a ) , c / ( a * a ) , c / a , c ) ; j = dot ( h , i ) ; return j ; } vec4 g ( const in vec2 l ) { vec4 m ; vec2 n , o ; n = vec2 ( a , c ) ; o = vec2 ( b , c / a ) ; m = fract ( l . xxyy * n . xyxy ) ; m -= m . xxzz * o . xyxy ; if ( l . r == c ) m . rg = vec2 ( b , c ) ; if ( l . g == c ) m . ba = vec2 ( b , c ) ; return m ; } vec2 s ( const in vec4 p ) { vec2 q , r ; r = vec2 ( c / a , c ) ; q . r = dot ( p . rg , r ) ; q . g = dot ( p . ba , r ) ; return q ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float t = 0.0 ; float u = 1.0 ; vec4 w ( vec4 v ) { return v - floor ( v * ( u / 289.0 ) ) * 289.0 ; } vec3 w ( vec3 x ) { return x - floor ( x * ( u / 289.0 ) ) * 289.0 ; } vec2 w ( vec2 y ) { return y - floor ( y * ( u / 289.0 ) ) * 289.0 ; } vec4 A ( vec4 z ) { return z - floor ( z * ( u / 7.0 ) ) * 7.0 ; } vec4 C ( vec4 B ) { return w ( ( 34.0 * B + 5.0 ) * B ) ; }".split(" ")},{type:"define",name:"K",b:["0.142857142857"]},{type:"define",
name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 L ( vec2 D ) { vec4 E , F , G , H ; vec2 I , J ; I = w ( floor ( D ) ) ; J = fract ( D ) ; E = J . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; F = J . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; G = C ( I . x + vec4 ( t , u , t , u ) ) ; G = C ( G + I . y + vec4 ( t , t , u , u ) ) ; H = A ( G ) * K + K2 ; G = A ( floor ( G * K ) ) * K + K2 ; H = E + JITTER * H ; G = F + JITTER * G ; G = H * H + G * G ;".split(" ")},
{type:"condition",a:[{type:"if",c:[1],group:{type:"group",a:[{type:"textline",b:"G . xy = min ( G . xy , G . zw ) ; G . x = min ( G . x , G . y ) ; return G . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"G . xy = ( G . x < G . y ) ? G . xy : G . yx ; G . xz = ( G . x < G . z ) ? G . xz : G . zx ; G . xw = ( G . x < G . w ) ? G . xw : G . wx ; G . y = min ( G . y , G . z ) ; G . y = min ( G . y , G . w ) ; return sqrt ( G . xy ) ;".split(" ")}]}}]},{type:"textline",
b:"} vec3 U ( vec2 M , float N ) { vec4 O , P , Q , R ; vec2 S , T ; S = w ( floor ( M ) ) ; T = fract ( M ) ; O = T . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; P = T . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; Q = C ( S . x + vec4 ( t , u , t , u ) ) ; Q = C ( Q + S . y + vec4 ( t , t , u , u ) ) ; R = A ( Q ) * K + K2 ; Q = A ( floor ( Q * K ) ) * K + K2 ; R = O + JITTER * R ; Q = P + JITTER * Q ; P = R * R + Q * Q ; R += N ; Q += N ; O = R * R + Q * Q ; R += N ; Q += N ; Q = R * R + Q * Q ; P . xy = min ( P . xy , P . zw ) ; P . x = min ( P . x , P . y ) ; O . xy = min ( O . xy , O . zw ) ; O . x = min ( O . x , O . y ) ; Q . xy = min ( Q . xy , Q . zw ) ; Q . x = min ( Q . x , Q . y ) ; return vec3 ( P . x , O . x , Q . x ) ; } vec3 W ( vec3 V ) { return w ( ( ( V * 34.0 ) + u ) * V ) ; } float ag ( vec2 X ) { vec3 Y , Z , _ , aa ; vec4 ab ; vec2 ac , ad , ae ; const vec4 af = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; ac = floor ( X + dot ( X , af . yy ) ) ; ad = X - ac + dot ( ac , af . xx ) ; ae = ( ad . x > ad . y ) ? vec2 ( u , t ) : vec2 ( t , u ) ; ab = ad . xyxy + af . xxzz ; ab . xy -= ae ; ac = w ( ac ) ; Y = W ( W ( ac . y + vec3 ( t , ae . y , u ) ) + ac . x + vec3 ( t , ae . x , u ) ) ; Z = max ( 0.5 - vec3 ( dot ( ad , ad ) , dot ( ab . xy , ab . xy ) , dot ( ab . zw , ab . zw ) ) , t ) ; Z = Z * Z ; Z = Z * Z ; Y = 2.0 * fract ( Y * af . www ) - u ; _ = abs ( Y ) - 0.5 ; aa = floor ( Y + 0.5 ) ; aa = Y - aa ; Z *= 1.79284291400159 - 0.85373472095314 * ( aa * aa + _ * _ ) ; Y . x = aa . x * ad . x + _ . x * ad . y ; Y . yz = aa . yz * ab . xz + _ . yz * ab . yw ; return 130.0 * dot ( Z , Y ) ; } vec2 ak ( vec2 ah ) { float ai , aj ; ai = dot ( ah , vec2 ( 12.9898 , 78.233 ) ) ; aj = dot ( ah , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; ai = fract ( sin ( ai ) * 43758.5453 ) * 2.0 - u ; aj = fract ( sin ( aj ) * 43758.5453 ) * 2.0 - u ; return vec2 ( ai , aj ) ; }".split(" ")}]};
a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void aC ( inout vec3 al , float am , float an , float ao , vec3 ap , vec3 aq , vec3 ar , vec4 as , vec3 at , float au ) { float av , aw , ax ; vec2 ay , az ; vec3 aA ; vec4 aB ; if ( au > CAUSTICS_VIEW_DISTANCE ) return ; aB = as ; aA = at + ap ; aA . xz = 10.0 * sin ( 0.1 * aA . xz ) ; aA = aA + 2.0 * cross ( - aB . xyz , cross ( - aB . xyz , aA ) + aB . w * aA ) ; ay = aA . xz ; aA = aq ; av = max ( dot ( ap , aA ) , 0.0 ) ; aw = 0.025 ; az = CAUST_SPEED * an ; ay . s += 0.25 * sin ( dot ( at + an , vec3 ( 1.0 ) ) ) ; ay . t += 0.35 * ( - sin ( dot ( at - an , vec3 ( - 0.7 ) ) ) ) ; ay . st += 0.15 * cos ( 4.0 * am - az . x ) + 1.5 * sin ( am - 0.3 * az . y ) ; ax = CAUST_SCALE * ( 1.0 + max ( 0.1 * am , 0.0 ) ) ; aA = U ( ( ay / ax ) , aw ) ; aA *= CAUST_BRIGHT ; aA *= aA ; aw = min ( 0.25 * am , - am ) + 1.0 ; aw = max ( aw , 0.0 ) ; av = ao * av ; ax = max ( sign ( am ) , 0.0 ) ; av = av + max ( 0.5 * sign ( - ap . y ) * ax , 0.0 ) ; av = min ( av , 1.0 ) ; al += ar * aA * aw * av ; }".split(" ")}]};
a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void aE ( inout vec3 aD ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"aD = max ( vec3 ( 0.0 ) , aD ) ; aD = pow ( aD , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void aG ( inout vec3 aF ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"aF = max ( vec3 ( 0.0 ) , aF ) ; aF = pow ( aF , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void aJ ( inout vec3 aH , in float aI ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"aH = aH * aI ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float aK = 0.0 ; float aL = 1.0 ; struct aM { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool aP ( vec3 aN , vec3 aO ) { return any ( lessThan ( abs ( aN - aO ) , vec3 ( EPSILON ) ) ) ; } vec3 aS ( in vec4 aQ , in vec3 aR ) { return aR + 2.0 * cross ( aQ . xyz , cross ( aQ . xyz , aR ) + aQ . w * aR ) ; } vec4 aU ( in vec4 aT ) { return vec4 ( - aT . xyz , aT . w ) / dot ( aT , aT ) ; } vec3 aZ ( vec4 aV , vec4 aW , vec4 aX ) { vec3 aY ; aY = aX . xyz * aV . w ; aY = aS ( aW , aY ) ; aY += aV . xyz * aX . w ; return aY ; } vec3 be ( vec4 a_ , vec4 ba , vec4 bb ) { vec4 bc ; vec3 bd ; bd = bb . xyz - a_ . xyz * bb . w ; bc = aU ( ba ) ; bd = aS ( bc , bd ) ; bd /= a_ . w ; return bd ; } mat4 bf ( ) { return mat4 ( aL , aK , aK , aK , aK , aL , aK , aK , aK , aK , aL , aK , aK , aK , aK , aL ) ; } mat4 bh ( float bg ) { return mat4 ( aL , aK , aK , aK , aK , cos ( bg ) , sin ( bg ) , aK , aK , - sin ( bg ) , cos ( bg ) , aK , aK , aK , aK , aL ) ; } mat4 bj ( float bi ) { return mat4 ( cos ( bi ) , aK , - sin ( bi ) , aK , aK , aL , aK , aK , sin ( bi ) , aK , cos ( bi ) , aK , aK , aK , aK , aL ) ; } mat4 bl ( float bk ) { return mat4 ( cos ( bk ) , sin ( bk ) , aK , aK , - sin ( bk ) , cos ( bk ) , aK , aK , aK , aK , aL , aK , aK , aK , aK , aL ) ; } aM bn ( in aM bm ) { return aM ( bm . a , bm . b , normalize ( bm . c ) , normalize ( bm . d ) , normalize ( bm . e ) , bm . f ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"vec3 bt ( vec4 bo ) { vec3 bp ; float bq , br , bs ; bq = bo . x ; br = bo . y ; bs = bo . w ; bp . x = ( bq + bs ) / 2.0 ; bp . y = ( br + bs ) / 2.0 ; bp . z = bs ; return bp ; }".split(" ")}]}}]}]};a["include/shadow.glslf"]={type:"group",
a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["vec4","bF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",
d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float bG = 0.1 ; const float bH = 0.1 ; const float bI = - 0.01 ; const float bJ = 0.05 ; vec4 bK = vec4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 ) ; vec4 bL = vec4 ( 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 ) ; vec4 bM = vec4 ( - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 ) ; vec4 bN = vec4 ( - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; vec4 bO = vec4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 ) ; vec4 bP = vec4 ( - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 ) ; vec4 bQ = vec4 ( - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 ) ; vec4 bR = vec4 ( - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ; bool bU ( vec2 bS , float bT ) { return all ( lessThanEqual ( bS , vec2 ( 1.0 + bT ) ) ) && all ( greaterThanEqual ( bS , vec2 ( 0.0 - bT ) ) ) ; } float cc ( float bV , float bW , mat2 bX , vec3 bY , float bZ , PRECISION sampler2D b_ ) { vec2 ca , cb ; cb . x = bV ; cb . y = bW ; cb = bX * cb ; ca = bY . xy + cb * bZ / SHADOW_TEX_RES ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"if ( ! bU ( ca , bI ) ) return 1.0 ; else".split(" ")}]}}]},{type:"textline",b:"return step ( bY . z , texture2D ( b_ , ca ) . r ) ; } void cq ( inout float cd , inout float ce , float cf , float cg , mat2 ch , vec3 ci , vec3 cj , float ck , float cl , PRECISION sampler2D cm , PRECISION sampler2D cn ) { vec2 co , cp ; cp . x = cf ; cp . y = cg ; cp = ch * cp ; co = ci . xy + cp * ck / SHADOW_TEX_RES ; cd += step ( ci . z , texture2D ( cm , co ) . r ) ; co = cj . xy + cp * cl / SHADOW_TEX_RES ; ce += step ( cj . z , texture2D ( cn , co ) . r ) ; } float cz ( vec3 cr , PRECISION sampler2D cs , float ct ) { mat2 cu ; float cv , cw , cx ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:"if ( cr . z > u_perspective_cast_far_bound ) return 1.0 ; else {".split(" ")}]}}]},{type:"textline",b:"cr . z = clamp ( cr . z , 0.0 , 1.0 ) ; cv = 0.0 ; cw = ak ( cr . xy ) . x * M_PI ; cx = cos ( cw ) ; cw = sin ( cw ) ; cu = mat2 ( cx , cw , - cw , cx ) ; for ( int cy = 0 ; cy < 4 ; cy ++ ) { cv += cc ( bK [ cy ] , bO [ cy ] , cu , cr , ct , cs ) ; cv += cc ( bL [ cy ] , bP [ cy ] , cu , cr , ct , cs ) ; cv += cc ( bM [ cy ] , bQ [ cy ] , cu , cr , ct , cs ) ; cv += cc ( bN [ cy ] , bR [ cy ] , cu , cr , ct , cs ) ; } cv /= 16.0 ; return clamp ( cv , 0.0 , 1.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["}"]}]}}]},{type:"textline",b:"return 1.0 ; } float cN ( vec3 cA , PRECISION sampler2D cB , vec3 cC , PRECISION sampler2D cD , float cE , float cF , float cG ) { mat2 cH ; float cI , cJ , cK , cL ; cA . z = clamp ( cA . z , 0.0 , 1.0 ) ; cC . z = clamp ( cC . z , 0.0 , 1.0 ) ; cI = 0.0 ; cJ = 0.0 ; cK = ak ( cA . xy ) . x * M_PI ; cL = cos ( cK ) ; cK = sin ( cK ) ; cH = mat2 ( cL , cK , - cK , cL ) ; for ( int cM = 0 ; cM < 4 ; cM ++ ) { cq ( cI , cJ , bK [ cM ] , bO [ cM ] , cH , cA , cC , cE , cF , cB , cD ) ; cq ( cI , cJ , bL [ cM ] , bP [ cM ] , cH , cA , cC , cE , cF , cB , cD ) ; cq ( cI , cJ , bM [ cM ] , bQ [ cM ] , cH , cA , cC , cE , cF , cB , cD ) ; cq ( cI , cJ , bN [ cM ] , bR [ cM ] , cH , cA , cC , cE , cF , cB , cD ) ; } cI = mix ( cI , cJ , cG ) ; cI /= 16.0 ; return clamp ( cI , 0.0 , 1.0 ) ; } float cR ( vec2 cO ) { float cP , cQ ; cP = min ( cO . x , cO . y ) ; cQ = min ( 1.0 - cO . x , 1.0 - cO . y ) ; return min ( cP , cQ ) ; } float cU ( float cS , float cT ) { if ( cT >= 0.0 && cT <= bH ) cS = ( cS - 1.0 ) / bH * cT + 1.0 ; return cS ; } float de ( vec3 cV , vec3 cW , PRECISION sampler2D cX , PRECISION sampler2D cY , float cZ , float c_ , float da , float db ) { float dc , dd ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"dd = cR ( cV . xy ) ; if ( - db > da && dd >= 0.0 && dd <= bG && bU ( cW . xy , 0.0 ) ) { dd = 1.0 - dd / bG ; dc = cN ( cV , cX , cW , cY , cZ , c_ , dd ) ; } else".split(" ")}]}}]},{type:"textline",b:"dc = cz ( cV , cX , cZ ) ; return dc ; } float dm ( vec3 df , PRECISION sampler2D dg , float dh , float di , float dj ) { float dk , dl ; dk = cz ( df , dg , dh ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - dj > di ) { dl = cR ( df . xy ) ; dk = cU ( dk , dl ) ; }".split(" ")}]}}]},{type:"textline",b:"return dk ; } float du ( float dn ) { vec3 dp , dq , dr , ds ; float dt ; dt = 1.0 ; dp = bA . xyz / bA . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"dq = bB . xyz / bB . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:"dr = bC . xyz / bC . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"ds = bD . xyz / bD . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( bU ( dp . xy , 0.0 ) ) { dt = de ( dp , dq , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , dn ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( bU ( dp . xy , bJ ) ) { dt = dm ( dp , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , dn ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( bU ( dq . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"dt = de ( dq , dr , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , dn ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"dt = dm ( dq , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , dn ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( bU ( dr . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"dt = de ( dr , ds , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , dn ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"dt = dm ( dr , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , dn ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( bU ( ds . xy , 0.0 ) ) dt = dm ( ds , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , dn ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","dt",";","}"]}]}}]},{type:"textline",b:"float dz ( inout vec3 dv ) { float dw ; vec3 dx ; vec2 dy ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dy = texture2DProj ( u_shadow_mask , by ) . rg ; dx = vec3 ( dy . r ) ; dw = dy . g ; bF = vec4 ( dx , dw ) ; dv *= bF . a ; return bF . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},
"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return du ( bv . z ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_MIRRORMAP",
{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float dG ( in vec3 dA , vec3 dB , float dC , float dD ) { float dE ; vec3 dF ; dF = normalize ( dB + dA ) ; dE = 1.0 - dot ( dA , dF ) ; dE = dD + ( 1.0 - dD ) * pow ( dE , dC ) ; return dE ; } void dT ( inout vec3 dH , vec3 dI , vec3 dJ , float dK ) { vec2 dL , dM ; float dN , dO , dP ; vec3 dQ , dR , dS ; dQ = reflect ( - dI , dJ ) ; dN = u_fresnel_params [ 2 ] ; dO = u_fresnel_params [ 3 ] ; dP = 1.0 ; if ( dN != 0.0 ) dP = dG ( dI , dQ , dN , dO ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dR = textureCube ( u_cube_reflection , dQ ) . xyz ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dS = u_refl_plane . xyz * dot ( dJ , u_refl_plane . xyz ) ; dS = dJ - dS ; dL = ( u_view_matrix_frag * vec4 ( dS , 0.0 ) ) . xy ; dM = by . xy / by . z ; dM += dL * REFL_BUMP ; dR = texture2D ( u_plane_reflection , dM ) . rgb ;".split(" ")}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dR = textureCube ( u_mirrormap , dQ ) . xyz ; dK = u_mirror_factor ;".split(" ")}]}}]},{type:"textline",b:"aE ( dR . rgb ) ; dH = mix ( dH , dR , dK * dP ) ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",a:[{type:"textline",b:"vec3 dW ( vec3 dU ) { float dV ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , dU ) . rgb ;".split(" ")}]}},{type:"elif",c:["SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"dV = 0.5 * dU . y + 0.5 ; return mix ( u_horizon_color , u_zenith_color , dV ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"float eb ( in float dX , inout vec2 dY , in vec2 dZ ) { float d_ ; vec4 ea ; ea = texture2D ( u_scene_depth , dY ) ; d_ = k ( ea ) ; if ( d_ < bz ) { dY = dZ ; return dX ; } else { return d_ ; } return dX ; }".split(" ")}]}}]},{type:"textline",b:"vec3 ej ( in vec3 ec , in vec2 ed ) { vec3 ee ; float ef ; vec4 eg ; vec2 eh , ei ; eh = ec . xy / ec . z ; ei = eh + ed ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"eg = texture2DProj ( u_scene_depth , ec ) ; ef = k ( eg ) ; eb ( ef , ei , eh ) ;".split(" ")}]}}]},{type:"textline",b:"ee = texture2D ( u_refractmap , ei ) . rgb ; aE ( ee ) ; return ee ; }".split(" ")}]}}]}]};a["include/nodes.glslf"]={type:"group",a:[{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",
b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",
b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ek",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float el = 0.5 ; vec3 em = vec3 ( ZERO_VALUE_NODES ) ; vec3 en = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"vec3 er ( in vec3 eo , in float ep ) { vec3 eq ; eq = em ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"eq = ej ( by , eo . xz * ep ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"eq = texture2D ( u_refractmap , by . xy / by . z ) . rgb ; aE ( eq ) ;".split(" ")}]}}]},{type:"textline",b:["return","eq",";",
"}"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"vec3 ew ( vec3 es ) { float et , eu ; vec4 ev ; ev = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; ev = mix ( vec4 ( es . bg , ev . wz ) , vec4 ( es . gb , ev . xy ) , step ( es . b , es . g ) ) ; ev = mix ( vec4 ( ev . xyw , es . r ) , vec4 ( es . r , ev . yzx ) , step ( ev . x , es . r ) ) ; et = ev . x - min ( ev . w , ev . y ) ; eu = 1.0e-10 ; return vec3 ( abs ( ev . z + ( ev . w - ev . y ) / ( 6.0 * et + eu ) ) , et / ( ev . x + eu ) , ev . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"vec3 eA ( vec3 ex ) { vec3 ey ; vec4 ez ; ez = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; ey = abs ( fract ( vec3 ( ex . r , ex . r , ex . r ) + ez . xyz ) * 6.0 - ez . www ) ; return ex . b * mix ( ez . xxx , clamp ( ey - ez . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , ex . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"vec3 eC ( vec2 eB ) { return vec3 ( eB * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"vec2 eE ( vec3 eD ) { return vec2 ( eD . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},
{type:"node",name:"CAMERA",h:[{type:"node_out",name:"fq",qualifier:["vec3"],e:!0},{type:"node_out",name:"fr",qualifier:["float"],e:!0},{type:"node_out",name:"fs",qualifier:["float"],e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_fq"],g:[{type:"textline",b:"fq = normalize ( fi . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_fr"],g:[{type:"textline",b:"fr = abs ( fi . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_fs"],
g:[{type:"textline",b:"fs = length ( fi . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",h:[{type:"node_in",name:"ft",qualifier:["float"],e:!1},{type:"node_in",name:"fu",qualifier:["float"],e:!1},{type:"node_in",name:"fv",qualifier:["float"],e:!1},{type:"node_out",name:"fw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fw = vec3 ( ft , fu , fv ) ;".split(" ")}]},{type:"node",name:"COMBHSV",h:[{type:"node_in",name:"fx",qualifier:["float"],e:!1},{type:"node_in",name:"fy",qualifier:["float"],
e:!1},{type:"node_in",name:"fz",qualifier:["float"],e:!1},{type:"node_out",name:"fA",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fA = eA ( vec3 ( fx , fy , fz ) ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",h:[{type:"node_out",name:"fB",qualifier:["vec3"],e:!1},{type:"node_param",name:"eF",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"fB = eC ( eF ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_OR",h:[{type:"node_out",name:"fC",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fC = 2.0 * clamp ( ek , 0.0 , 1.0 ) - en ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC",h:[{type:"node_out",name:"fD",qualifier:["vec3"],e:!1},{type:"node_param",name:"eG",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["fD","=","eG",";"]}]},{type:"node",name:"GEOMETRY_VC1",h:[{type:"node_out",name:"fE",qualifier:["float"],e:!1},{type:"node_param",name:"eH",qualifier:["varying","float"]}],g:[{type:"textline",b:["fE","=","eH",";"]}]},{type:"node",name:"GEOMETRY_VC2",h:[{type:"node_out",name:"fF",qualifier:["float"],e:!1},{type:"node_out",name:"fG",
qualifier:["float"],e:!1},{type:"node_param",name:"eI",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"fF = eI [ 0 ] ; fG = eI [ 1 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",h:[{type:"node_out",name:"fH",qualifier:["float"],e:!1},{type:"node_out",name:"fI",qualifier:["float"],e:!1},{type:"node_out",name:"fJ",qualifier:["float"],e:!1},{type:"node_param",name:"eJ",qualifier:["varying","vec3"]}],g:[{type:"textline",b:"fH = eJ [ 0 ] ; fI = eJ [ 1 ] ; fJ = eJ [ 2 ] ;".split(" ")}]},{type:"node",
name:"GEOMETRY_NO",h:[{type:"node_out",name:"fK",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["fK","=","fm",";"]}]},{type:"node",name:"GEOMETRY_FB",h:[{type:"node_out",name:"fL",qualifier:["float"],e:!1}],g:[{type:"textline",b:"fL = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VW",h:[{type:"node_out",name:"fM",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["fM","=","eS",";"]}]},{type:"node",name:"GEOMETRY_LO",h:[{type:"node_out",name:"fN",
qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fN [ 0 ] = fi [ 0 ] ; fN [ 1 ] = fi [ 1 ] ; fN [ 2 ] = fi [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_GL",h:[{type:"node_out",name:"fO",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fO = vec3 ( fl . r , - fl . b , fl . g ) ;".split(" ")}]},{type:"node",name:"NEW_GEOMETRY",h:[{type:"node_out",name:"fP",qualifier:["vec3"],e:!1},{type:"node_out",name:"fQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"fR",qualifier:["vec3"],e:!1},{type:"node_out",
name:"fS",qualifier:["vec3"],e:!1},{type:"node_out",name:"fT",qualifier:["vec3"],e:!1},{type:"node_out",name:"fU",qualifier:["vec3"],e:!1},{type:"node_out",name:"fV",qualifier:["float"],e:!1},{type:"node_out",name:"fW",qualifier:["float"],e:!1}],g:[{type:"textline",b:"fP = em ; fQ = em ; fR = em ; fS = em ; fT = em ; fU = em ; fV = ZERO_VALUE_NODES ; fW = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"HUE_SAT",h:[{type:"node_in",name:"fX",qualifier:["float"],e:!1},{type:"node_in",name:"fY",
qualifier:["float"],e:!1},{type:"node_in",name:"fZ",qualifier:["float"],e:!1},{type:"node_in",name:"f_",qualifier:["float"],e:!1},{type:"node_in",name:"ga",qualifier:["vec3"],e:!1},{type:"node_out",name:"gb",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fn = ew ( ga ) ; fn [ 0 ] += ( fX - 0.5 ) ; if ( fn [ 0 ] > UNITY_VALUE_NODES ) fn [ 0 ] -= UNITY_VALUE_NODES ; else if ( fn [ 0 ] < ZERO_VALUE_NODES ) fn [ 0 ] += UNITY_VALUE_NODES ; fn *= vec3 ( UNITY_VALUE_NODES , fY , fZ ) ; fn = mix ( en , mix ( em , fn , step ( em , fn ) ) , step ( fn , en ) ) ; gb = mix ( ga , eA ( fn ) , f_ ) ;".split(" ")}]},
{type:"node",name:"INVERT",h:[{type:"node_in",name:"gc",qualifier:["float"],e:!1},{type:"node_in",name:"gd",qualifier:["vec3"],e:!1},{type:"node_out",name:"ge",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ge = mix ( gd , en - gd , gc ) ;".split(" ")}]},{type:"node",name:"LAMP",h:[{type:"node_out",name:"gf",qualifier:["vec3"],e:!0},{type:"node_out",name:"gg",qualifier:["vec3"],e:!1},{type:"node_out",name:"gh",qualifier:["float"],e:!1},{type:"node_out",name:"gi",qualifier:["float"],e:!0}],g:[{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_gf"],g:[{type:"textline",b:"gf = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",b:"fj = u_lamp_light_factors [ LAMP_INDEX ] ; fn = u_lamp_light_directions [ LAMP_INDEX ] ; fo = u_lamp_light_positions [ LAMP_INDEX ] ; fb = fj . z ; if ( fb != - UNITY_VALUE_NODES ) {".split(" ")},{type:"textline",b:"gg = fo - bu ; gh = length ( gg ) ; gg = normalize ( gg ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gi"],g:[{type:"textline",
b:"gi = fb / ( fb + gh * gh ) ; fb = fj . x ; fc = fj . y ; if ( fb > - UNITY_VALUE_NODES ) { fd = dot ( gg , fn ) ; fd *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( fd - fb ) / fc ) ; gi *= fd ; }".split(" ")}]}]},{type:"textline",b:["}","else","{"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gg"],g:[{type:"textline",b:["gg","=","fn",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gh"],g:[{type:"textline",b:"gh = length ( fo - bu ) ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_gi"],g:[{type:"textline",b:["gi","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"NORMAL",h:[{type:"node_in",name:"gj",qualifier:["vec3"],e:!1},{type:"node_out",name:"gk",qualifier:["vec3"],e:!0},{type:"node_out",name:"gl",qualifier:["float"],e:!0},{type:"node_param",name:"eK",qualifier:["vec3"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gk"],g:[{type:"textline",b:["gk","=","eK",";"]}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_gl"],g:[{type:"textline",b:"gl = - dot ( gj , eK ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",h:[{type:"node_in",name:"gm",qualifier:["vec3"],e:!1},{type:"node_out",name:"gn",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"gn = - ( u_view_matrix_frag * vec4 ( gm , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"BSDF_ANISOTROPIC",h:[{type:"node_in",name:"go",qualifier:["vec3"],e:!1},{type:"node_in",name:"gp",qualifier:["float"],e:!1},{type:"node_in",name:"gq",
qualifier:["float"],e:!1},{type:"node_in",name:"gr",qualifier:["float"],e:!1},{type:"node_in",name:"gs",qualifier:["vec3"],e:!1},{type:"node_in",name:"gt",qualifier:["vec3"],e:!1},{type:"node_out",name:"gu",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gu","=","go",";"]},{type:"textline",b:"gp ; gq ; gr ; gs ; gt ;".split(" ")}]},{type:"node",name:"BSDF_DIFFUSE",h:[{type:"node_in",name:"gv",qualifier:["vec3"],e:!1},{type:"node_in",name:"gw",qualifier:["float"],e:!1},{type:"node_in",name:"gx",
qualifier:["vec3"],e:!1},{type:"node_out",name:"gy",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gy","=","gv",";"]},{type:"textline",b:["gw",";","gx",";"]}]},{type:"node",name:"BSDF_GLASS",h:[{type:"node_in",name:"gz",qualifier:["vec3"],e:!1},{type:"node_in",name:"gA",qualifier:["float"],e:!1},{type:"node_in",name:"gB",qualifier:["float"],e:!1},{type:"node_in",name:"gC",qualifier:["vec3"],e:!1},{type:"node_out",name:"gD",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gD","=","gz",";"]},{type:"textline",
b:"gA ; gB ; gC ;".split(" ")}]},{type:"node",name:"BSDF_GLOSSY",h:[{type:"node_in",name:"gE",qualifier:["vec3"],e:!1},{type:"node_in",name:"gF",qualifier:["float"],e:!1},{type:"node_in",name:"gG",qualifier:["vec3"],e:!1},{type:"node_out",name:"gH",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gH","=","gE",";"]},{type:"textline",b:["gF",";","gG",";"]}]},{type:"node",name:"BSDF_HAIR",h:[{type:"node_in",name:"gI",qualifier:["vec3"],e:!1},{type:"node_in",name:"gJ",qualifier:["float"],e:!1},{type:"node_in",
name:"gK",qualifier:["float"],e:!1},{type:"node_in",name:"gL",qualifier:["float"],e:!1},{type:"node_out",name:"gM",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gM","=","gI",";"]},{type:"textline",b:"gJ ; gK ; gL ;".split(" ")}]},{type:"node",name:"BSDF_TRANSPARENT",h:[{type:"node_in",name:"gN",qualifier:["vec3"],e:!1},{type:"node_out",name:"gO",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gO","=","gN",";"]}]},{type:"node",name:"BSDF_TRANSLUCENT",h:[{type:"node_in",name:"gP",qualifier:["vec3"],
e:!1},{type:"node_in",name:"gQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"gR",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gR","=","gP",";"]},{type:"textline",b:["gQ",";"]}]},{type:"node",name:"BSDF_REFRACTION",h:[{type:"node_in",name:"gS",qualifier:["vec3"],e:!1},{type:"node_in",name:"gT",qualifier:["float"],e:!1},{type:"node_in",name:"gU",qualifier:["float"],e:!1},{type:"node_in",name:"gV",qualifier:["vec3"],e:!1},{type:"node_out",name:"gW",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"gW [ 0 ] = gW [ 1 ] = gW [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"gS ; gT ; gU ; gV ;".split(" ")}]},{type:"node",name:"BSDF_TOON",h:[{type:"node_in",name:"gX",qualifier:["vec3"],e:!1},{type:"node_in",name:"gY",qualifier:["float"],e:!1},{type:"node_in",name:"gZ",qualifier:["float"],e:!1},{type:"node_in",name:"g_",qualifier:["vec3"],e:!1},{type:"node_out",name:"ha",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["ha","=","gX",";"]},{type:"textline",b:"gY ; gZ ; g_ ;".split(" ")}]},
{type:"node",name:"BSDF_VELVET",h:[{type:"node_in",name:"hb",qualifier:["vec3"],e:!1},{type:"node_in",name:"hc",qualifier:["float"],e:!1},{type:"node_in",name:"hd",qualifier:["vec3"],e:!1},{type:"node_out",name:"he",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["he","=","hb",";"]},{type:"textline",b:["hc",";","hd",";"]}]},{type:"node",name:"SUBSURFACE_SCATTERING",h:[{type:"node_in",name:"hf",qualifier:["vec3"],e:!1},{type:"node_in",name:"hg",qualifier:["float"],e:!1},{type:"node_in",name:"hh",
qualifier:["vec3"],e:!1},{type:"node_in",name:"hi",qualifier:["float"],e:!1},{type:"node_in",name:"hj",qualifier:["float"],e:!1},{type:"node_in",name:"hk",qualifier:["vec3"],e:!1},{type:"node_out",name:"hl",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hl [ 0 ] = hl [ 1 ] = hl [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"hf ; hh ; hi ; hj ; hk ; hg ;".split(" ")}]},{type:"node",name:"EMISSION",h:[{type:"node_in",name:"hm",qualifier:["vec3"],e:!1},{type:"node_in",name:"hn",qualifier:["float"],
e:!1},{type:"node_out",name:"ho",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["ho","=","hm",";"]},{type:"textline",b:["hn",";"]}]},{type:"node",name:"AMBIENT_OCCLUSION",h:[{type:"node_in",name:"hp",qualifier:["vec3"],e:!1},{type:"node_out",name:"hq",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hq [ 0 ] = hq [ 1 ] = hq [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hp",";"]}]},{type:"node",name:"HOLDOUT",h:[{type:"node_out",name:"hr",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"hr [ 0 ] = hr [ 1 ] = hr [ 2 ] = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"VOLUME_ABSORPTION",h:[{type:"node_in",name:"hs",qualifier:["vec3"],e:!1},{type:"node_in",name:"ht",qualifier:["float"],e:!1},{type:"node_out",name:"hu",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hu [ 0 ] = hu [ 1 ] = hu [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hs",";","ht",";"]}]},{type:"node",name:"VOLUME_SCATTER",h:[{type:"node_in",name:"hv",qualifier:["vec3"],e:!1},{type:"node_in",
name:"hw",qualifier:["float"],e:!1},{type:"node_in",name:"hx",qualifier:["float"],e:!1},{type:"node_out",name:"hy",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hy [ 0 ] = hy [ 1 ] = hy [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"hv ; hw ; hx ;".split(" ")}]},{type:"node",name:"BUMP",h:[{type:"node_in",name:"hz",qualifier:["float"],e:!1},{type:"node_in",name:"hA",qualifier:["float"],e:!1},{type:"node_in",name:"hB",qualifier:["float"],e:!1},{type:"node_in",name:"hC",qualifier:["vec3"],
e:!1},{type:"node_out",name:"hD",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hD","=","hC",";"]},{type:"textline",b:"hz ; hA ; hB ;".split(" ")}]},{type:"node",name:"NORMAL_MAP",h:[{type:"node_in",name:"hE",qualifier:["float"],e:!1},{type:"node_in",name:"hF",qualifier:["vec3"],e:!1},{type:"node_out",name:"hG",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hG","=","hF",";"]},{type:"textline",b:["hE",";"]}]},{type:"node",name:"VECT_TRANSFORM",h:[{type:"node_in",name:"hH",qualifier:["vec3"],
e:!1},{type:"node_out",name:"hI",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hI [ 0 ] = hI [ 1 ] = hI [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hH",";"]}]},{type:"node",name:"BLACKBODY",h:[{type:"node_in",name:"hJ",qualifier:["float"],e:!1},{type:"node_out",name:"hK",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hK [ 0 ] = hK [ 1 ] = hK [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hJ",";"]}]},{type:"node",name:"WAVELENGTH",h:[{type:"node_in",name:"hL",qualifier:["float"],
e:!1},{type:"node_out",name:"hM",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hM [ 0 ] = hM [ 1 ] = hM [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hL",";"]}]},{type:"node",name:"SEPXYZ",h:[{type:"node_in",name:"hN",qualifier:["vec3"],e:!1},{type:"node_out",name:"hO",qualifier:["float"],e:!1},{type:"node_out",name:"hP",qualifier:["float"],e:!1},{type:"node_out",name:"hQ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"hO = hN [ 0 ] ; hP = hN [ 1 ] ; hQ = hN [ 2 ] ;".split(" ")}]},
{type:"node",name:"COMBXYZ",h:[{type:"node_in",name:"hR",qualifier:["float"],e:!1},{type:"node_in",name:"hS",qualifier:["float"],e:!1},{type:"node_in",name:"hT",qualifier:["float"],e:!1},{type:"node_out",name:"hU",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hU [ 0 ] = hR ; hU [ 1 ] = hS ; hU [ 2 ] = hT ;".split(" ")}]},{type:"node",name:"BRIGHTCONTRAST",h:[{type:"node_in",name:"hV",qualifier:["vec3"],e:!1},{type:"node_in",name:"hW",qualifier:["float"],e:!1},{type:"node_in",name:"hX",qualifier:["float"],
e:!1},{type:"node_out",name:"hY",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = hW - hX * 0.5 ; hY = max ( ( UNITY_VALUE_NODES + hX ) * hV + fd , em ) ;".split(" ")}]},{type:"node",name:"LIGHT_FALLOFF",h:[{type:"node_in",name:"hZ",qualifier:["float"],e:!1},{type:"node_in",name:"h_",qualifier:["float"],e:!1},{type:"node_out",name:"ia",qualifier:["float"],e:!1},{type:"node_out",name:"ib",qualifier:["float"],e:!1},{type:"node_out",name:"ic",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ia = ib = ic = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",b:["hZ",";","h_",";"]}]},{type:"node",name:"TEX_IMAGE",h:[{type:"node_in",name:"id",qualifier:["vec3"],e:!1},{type:"node_out",name:"ie",qualifier:["vec3"],e:!1},{type:"node_out",name:"ig",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ie [ 0 ] = ie [ 1 ] = ie [ 2 ] = ZERO_VALUE_NODES ; ig = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["id",";"]}]},{type:"node",name:"TEX_ENVIRONMENT",h:[{type:"node_in",name:"ih",qualifier:["vec3"],e:!1},{type:"node_out",name:"ii",qualifier:["vec3"],
e:!1}],g:[{type:"textline",b:"ii [ 0 ] = ii [ 1 ] = ii [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["ih",";"]}]},{type:"node",name:"TEX_SKY",h:[{type:"node_in",name:"ij",qualifier:["vec3"],e:!1},{type:"node_out",name:"ik",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ik [ 0 ] = ik [ 1 ] = ik [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["ij",";"]}]},{type:"node",name:"TEX_NOISE",h:[{type:"node_in",name:"il",qualifier:["vec3"],e:!1},{type:"node_in",name:"im",qualifier:["float"],
e:!1},{type:"node_in",name:"io",qualifier:["float"],e:!1},{type:"node_in",name:"ip",qualifier:["float"],e:!1},{type:"node_out",name:"iq",qualifier:["vec3"],e:!1},{type:"node_out",name:"ir",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iq [ 0 ] = iq [ 1 ] = iq [ 2 ] = ZERO_VALUE_NODES ; ir = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"il ; im ; io ; ip ;".split(" ")}]},{type:"node",name:"TEX_WAVE",h:[{type:"node_in",name:"is",qualifier:["vec3"],e:!1},{type:"node_in",name:"it",qualifier:["float"],
e:!1},{type:"node_in",name:"iu",qualifier:["float"],e:!1},{type:"node_in",name:"iv",qualifier:["float"],e:!1},{type:"node_in",name:"iw",qualifier:["float"],e:!1},{type:"node_out",name:"ix",qualifier:["vec3"],e:!1},{type:"node_out",name:"iy",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ix [ 0 ] = ix [ 1 ] = ix [ 2 ] = ZERO_VALUE_NODES ; iy = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"is ; it ; iu ; iv ; iw ;".split(" ")}]},{type:"node",name:"TEX_VORONOI",h:[{type:"node_in",name:"iz",
qualifier:["vec3"],e:!1},{type:"node_in",name:"iA",qualifier:["float"],e:!1},{type:"node_out",name:"iB",qualifier:["vec3"],e:!1},{type:"node_out",name:"iC",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iB [ 0 ] = iB [ 1 ] = iB [ 2 ] = ZERO_VALUE_NODES ; iC = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["iz",";","iA",";"]}]},{type:"node",name:"TEX_MUSGRAVE",h:[{type:"node_in",name:"iD",qualifier:["vec3"],e:!1},{type:"node_in",name:"iE",qualifier:["float"],e:!1},{type:"node_in",name:"iF",
qualifier:["float"],e:!1},{type:"node_in",name:"iG",qualifier:["float"],e:!1},{type:"node_in",name:"iH",qualifier:["float"],e:!1},{type:"node_in",name:"iI",qualifier:["float"],e:!1},{type:"node_in",name:"iJ",qualifier:["float"],e:!1},{type:"node_out",name:"iK",qualifier:["vec3"],e:!1},{type:"node_out",name:"iL",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iK [ 0 ] = iK [ 1 ] = iK [ 2 ] = ZERO_VALUE_NODES ; iL = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"iD ; iE ; iF ; iG ; iH ; iI ; iJ ;".split(" ")}]},
{type:"node",name:"TEX_GRADIENT",h:[{type:"node_in",name:"iM",qualifier:["vec3"],e:!1},{type:"node_out",name:"iN",qualifier:["vec3"],e:!1},{type:"node_out",name:"iO",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iN [ 0 ] = iN [ 1 ] = iN [ 2 ] = ZERO_VALUE_NODES ; iO = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["iM",";"]}]},{type:"node",name:"TEX_MAGIC",h:[{type:"node_in",name:"iP",qualifier:["vec3"],e:!1},{type:"node_in",name:"iQ",qualifier:["float"],e:!1},{type:"node_in",name:"iR",
qualifier:["float"],e:!1},{type:"node_out",name:"iS",qualifier:["vec3"],e:!1},{type:"node_out",name:"iT",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iS [ 0 ] = iS [ 1 ] = iS [ 2 ] = ZERO_VALUE_NODES ; iT = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"iP ; iQ ; iR ;".split(" ")}]},{type:"node",name:"TEX_CHECKER",h:[{type:"node_in",name:"iU",qualifier:["vec3"],e:!1},{type:"node_in",name:"iV",qualifier:["vec3"],e:!1},{type:"node_in",name:"iW",qualifier:["vec3"],e:!1},{type:"node_in",name:"iX",
qualifier:["float"],e:!1},{type:"node_out",name:"iY",qualifier:["vec3"],e:!1},{type:"node_out",name:"iZ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iY [ 0 ] = iY [ 1 ] = iY [ 2 ] = ZERO_VALUE_NODES ; iZ = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"iU ; iV ; iW ; iX ;".split(" ")}]},{type:"node",name:"TEX_BRICK",h:[{type:"node_in",name:"i_",qualifier:["vec3"],e:!1},{type:"node_in",name:"ja",qualifier:["vec3"],e:!1},{type:"node_in",name:"jb",qualifier:["vec3"],e:!1},{type:"node_in",
name:"jc",qualifier:["vec3"],e:!1},{type:"node_in",name:"jd",qualifier:["float"],e:!1},{type:"node_in",name:"je",qualifier:["float"],e:!1},{type:"node_in",name:"jf",qualifier:["float"],e:!1},{type:"node_in",name:"jg",qualifier:["float"],e:!1},{type:"node_in",name:"jh",qualifier:["float"],e:!1},{type:"node_out",name:"ji",qualifier:["vec3"],e:!1},{type:"node_out",name:"jj",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ji [ 0 ] = ji [ 1 ] = ji [ 2 ] = ZERO_VALUE_NODES ; jj = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",b:"i_ ; ja ; jb ; jc ; jd ; je ; jf ; jg ; jh ;".split(" ")}]},{type:"node",name:"ADD_SHADER",h:[{type:"node_in",name:"jk",qualifier:["vec3"],e:!1},{type:"node_in",name:"jl",qualifier:["vec3"],e:!1},{type:"node_out",name:"jm",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jm = clamp ( jk + jl , em , en ) ;".split(" ")}]},{type:"node",name:"MIX_SHADER",h:[{type:"node_in",name:"jn",qualifier:["float"],e:!1},{type:"node_in",name:"jo",qualifier:["vec3"],e:!1},{type:"node_in",name:"jp",
qualifier:["vec3"],e:!1},{type:"node_out",name:"jq",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( jn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; jq = fd * jo + ( UNITY_VALUE_NODES - fd ) * jp ;".split(" ")}]},{type:"node",name:"UV_MERGED",h:[{type:"node_out",name:"jr",qualifier:["vec3"],e:!1},{type:"node_out",name:"js",qualifier:["vec3"],e:!1},{type:"node_param",name:"eL",qualifier:["varying","vec2"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jr"],g:[{type:"textline",
b:"jr = eC ( eL ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_js"],g:[{type:"textline",b:"js = vec3 ( eL , ZERO_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"TEX_COORD_UV",h:[{type:"node_out",name:"jt",qualifier:["vec3"],e:!1},{type:"node_param",name:"eM",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"jt = vec3 ( eM , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_NO",h:[{type:"node_out",name:"ju",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:["ju","=","fm",";"]}]},{type:"node",name:"TEX_COORD_GE",h:[{type:"node_out",name:"jv",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jv = abs ( ek ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_OB",h:[{type:"node_out",name:"jw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jw [ 0 ] = jw [ 1 ] = jw [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_CA",h:[{type:"node_out",name:"jx",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jx [ 0 ] = fi [ 0 ] ; jx [ 1 ] = fi [ 1 ] ; jx [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"TEX_COORD_WI",h:[{type:"node_out",name:"jy",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jy [ 0 ] = jy [ 1 ] = jy [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_RE",h:[{type:"node_out",name:"jz",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jz [ 0 ] = jz [ 1 ] = jz [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"UVMAP",h:[{type:"node_out",name:"jA",qualifier:["vec3"],e:!1},{type:"node_param",name:"eN",qualifier:["varying","vec2"]}],
g:[{type:"textline",b:"jA = vec3 ( eN , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"PARTICLE_INFO",h:[{type:"node_out",name:"jB",qualifier:["float"],e:!1},{type:"node_out",name:"jC",qualifier:["float"],e:!1},{type:"node_out",name:"jD",qualifier:["float"],e:!1},{type:"node_out",name:"jE",qualifier:["vec3"],e:!1},{type:"node_out",name:"jF",qualifier:["float"],e:!1},{type:"node_out",name:"jG",qualifier:["vec3"],e:!1},{type:"node_out",name:"jH",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"jB = ZERO_VALUE_NODES ; jC = ZERO_VALUE_NODES ; jD = ZERO_VALUE_NODES ; jE = vec3 ( ZERO_VALUE_NODES ) ; jF = ZERO_VALUE_NODES ; jG = jE ; jH = jE ;".split(" ")}]},{type:"node",name:"HAIR_INFO",h:[{type:"node_out",name:"jI",qualifier:["float"],e:!1},{type:"node_out",name:"jJ",qualifier:["float"],e:!1},{type:"node_out",name:"jK",qualifier:["float"],e:!1},{type:"node_out",name:"jL",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jI = ZERO_VALUE_NODES ; jJ = ZERO_VALUE_NODES ; jK = ZERO_VALUE_NODES ; jL = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"OBJECT_INFO",h:[{type:"node_out",name:"jM",qualifier:["vec3"],e:!1},{type:"node_out",name:"jN",qualifier:["float"],e:!1},{type:"node_out",name:"jO",qualifier:["float"],e:!1},{type:"node_out",name:"jP",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jN = ZERO_VALUE_NODES ; jO = ZERO_VALUE_NODES ; jP = ZERO_VALUE_NODES ; jM = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"WIREFRAME",h:[{type:"node_in",name:"jQ",qualifier:["float"],e:!1},{type:"node_out",name:"jR",
qualifier:["float"],e:!1}],g:[{type:"textline",b:["jR","=","jQ",";"]}]},{type:"node",name:"TANGENT",h:[{type:"node_out",name:"jS",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jS = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LAYER_WEIGHT",h:[{type:"node_in",name:"jT",qualifier:["float"],e:!1},{type:"node_in",name:"jU",qualifier:["vec3"],e:!1},{type:"node_out",name:"jV",qualifier:["float"],e:!1},{type:"node_out",name:"jW",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jV = jW = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",b:["jU",";","jT",";"]}]},{type:"node",name:"LIGHT_PATH",h:[{type:"node_out",name:"jX",qualifier:["float"],e:!1},{type:"node_out",name:"jY",qualifier:["float"],e:!1},{type:"node_out",name:"jZ",qualifier:["float"],e:!1},{type:"node_out",name:"j_",qualifier:["float"],e:!1},{type:"node_out",name:"ka",qualifier:["float"],e:!1},{type:"node_out",name:"kb",qualifier:["float"],e:!1},{type:"node_out",name:"kc",qualifier:["float"],e:!1},{type:"node_out",name:"kd",qualifier:["float"],e:!1},{type:"node_out",
name:"ke",qualifier:["float"],e:!1},{type:"node_out",name:"kf",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jX = jY = jZ = ZERO_VALUE_NODES ; j_ = ka = kb = ZERO_VALUE_NODES ; kc = kc = ke = kf = ZERO_VALUE_NODES ; kd = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"ATTRIBUTE",h:[{type:"node_out",name:"kg",qualifier:["vec3"],e:!1},{type:"node_out",name:"kh",qualifier:["vec3"],e:!1},{type:"node_out",name:"ki",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kg = kh = vec3 ( ZERO_VALUE_NODES ) ; ki = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"SCRIPT",h:[],g:[]},{type:"node",name:"CURVE_VEC",h:[{type:"node_in",name:"kj",qualifier:["float"],e:!1},{type:"node_in",name:"kk",qualifier:["vec3"],e:!1},{type:"node_out",name:"kl",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["kl","=","kk",";"]},{type:"textline",b:["kj",";"]}]},{type:"node",name:"CURVE_RGB",h:[{type:"node_in",name:"km",qualifier:["float"],e:!1},{type:"node_in",name:"kn",qualifier:["vec3"],e:!1},{type:"node_out",name:"ko",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:["ko","=","kn",";"]},{type:"textline",b:["km",";"]}]},{type:"node",name:"VALTORGB",h:[{type:"node_in",name:"kp",qualifier:["float"],e:!1},{type:"node_out",name:"kq",qualifier:["vec3"],e:!1},{type:"node_out",name:"kr",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kq [ 0 ] = kq [ 1 ] = kq [ 2 ] = clamp ( kp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; kr = kq [ 0 ] ;".split(" ")}]},{type:"node",name:"MAPPING",h:[{type:"node_in",name:"ks",qualifier:["vec3"],e:!1},{type:"node_out",name:"kt",qualifier:["vec3"],
e:!1}],g:[{type:"textline",b:["kt","=","ks",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",g:[{type:"textline",b:"kt = ( MAPPING_TRS_MATRIX * vec4 ( kt , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_SCALE",g:[{type:"textline",b:"kt = kt * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",g:[{type:"textline",b:"kt = kt + MAPPING_TRANSLATION ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",g:[{type:"textline",b:"kt = max ( kt , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",g:[{type:"textline",b:"kt = min ( kt , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],g:[{type:"textline",b:"kt = normalize ( kt ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",h:[{type:"node_in",name:"ku",qualifier:["float"],
e:!1},{type:"node_in",name:"kv",qualifier:["float"],e:!1},{type:"node_out",name:"kw",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kw = ku + kv ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kw = clamp ( kw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",h:[{type:"node_in",name:"kx",qualifier:["float"],e:!1},{type:"node_in",name:"ky",qualifier:["float"],e:!1},{type:"node_out",name:"kz",qualifier:["float"],
e:!1}],g:[{type:"textline",b:"kz = kx - ky ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kz = clamp ( kz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MULTIPLY",h:[{type:"node_in",name:"kA",qualifier:["float"],e:!1},{type:"node_in",name:"kB",qualifier:["float"],e:!1},{type:"node_out",name:"kC",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kC = kA * kB ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kC = clamp ( kC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",h:[{type:"node_in",name:"kD",qualifier:["float"],e:!1},{type:"node_in",name:"kE",qualifier:["float"],e:!1},{type:"node_out",name:"kF",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kF = ( kE != ZERO_VALUE_NODES ) ? kD / kE : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kF = clamp ( kF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_SINE",h:[{type:"node_in",name:"kG",qualifier:["float"],e:!1},{type:"node_in",name:"kH",qualifier:["float"],e:!1},{type:"node_out",name:"kI",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kI = sin ( kG ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kI = clamp ( kI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kH",";"]}]},{type:"node",name:"MATH_COSINE",h:[{type:"node_in",name:"kJ",
qualifier:["float"],e:!1},{type:"node_in",name:"kK",qualifier:["float"],e:!1},{type:"node_out",name:"kL",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kL = cos ( kJ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kL = clamp ( kL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kK",";"]}]},{type:"node",name:"MATH_TANGENT",h:[{type:"node_in",name:"kM",qualifier:["float"],e:!1},{type:"node_in",name:"kN",qualifier:["float"],
e:!1},{type:"node_out",name:"kO",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kO = tan ( kM ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kO = clamp ( kO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kN",";"]}]},{type:"node",name:"MATH_ARCSINE",h:[{type:"node_in",name:"kP",qualifier:["float"],e:!1},{type:"node_in",name:"kQ",qualifier:["float"],e:!1},{type:"node_out",name:"kR",qualifier:["float"],e:!1}],
g:[{type:"textline",b:"kR = ( kP <= UNITY_VALUE_NODES && kP >= - UNITY_VALUE_NODES ) ? asin ( kP ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kR = clamp ( kR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kQ",";"]}]},{type:"node",name:"MATH_ARCCOSINE",h:[{type:"node_in",name:"kS",qualifier:["float"],e:!1},{type:"node_in",name:"kT",qualifier:["float"],e:!1},{type:"node_out",name:"kU",qualifier:["float"],
e:!1}],g:[{type:"textline",b:"kU = ( kS <= UNITY_VALUE_NODES && kS >= - UNITY_VALUE_NODES ) ? acos ( kS ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kU = clamp ( kU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kT",";"]}]},{type:"node",name:"MATH_ARCTANGENT",h:[{type:"node_in",name:"kV",qualifier:["float"],e:!1},{type:"node_in",name:"kW",qualifier:["float"],e:!1},{type:"node_out",name:"kX",
qualifier:["float"],e:!1}],g:[{type:"textline",b:"kX = atan ( kV ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kX = clamp ( kX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kW",";"]}]},{type:"node",name:"MATH_POWER",h:[{type:"node_in",name:"kY",qualifier:["float"],e:!1},{type:"node_in",name:"kZ",qualifier:["float"],e:!1},{type:"node_out",name:"k_",qualifier:["float"],e:!1}],g:[{type:"textline",b:"if ( kY < ZERO_VALUE_NODES || kY == ZERO_VALUE_NODES && kZ == ZERO_VALUE_NODES ) k_ = ZERO_VALUE_NODES ; else k_ = pow ( kY , kZ ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"k_ = clamp ( k_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",h:[{type:"node_in",name:"la",qualifier:["float"],e:!1},{type:"node_in",name:"lb",qualifier:["float"],e:!1},{type:"node_out",name:"lc",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lc = ( la > ZERO_VALUE_NODES && lb > ZERO_VALUE_NODES ) ? log2 ( la ) / log2 ( lb ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lc = clamp ( lc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MINIMUM",h:[{type:"node_in",name:"ld",qualifier:["float"],e:!1},{type:"node_in",name:"le",qualifier:["float"],e:!1},{type:"node_out",name:"lf",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lf = min ( ld , le ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lf = clamp ( lf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MAXIMUM",h:[{type:"node_in",name:"lg",qualifier:["float"],e:!1},{type:"node_in",name:"lh",qualifier:["float"],e:!1},{type:"node_out",name:"li",qualifier:["float"],e:!1}],g:[{type:"textline",b:"li = max ( lg , lh ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"li = clamp ( li , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",h:[{type:"node_in",name:"lj",qualifier:["float"],e:!1},
{type:"node_in",name:"lk",qualifier:["float"],e:!1},{type:"node_out",name:"ll",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ll = floor ( lj + 0.5 ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ll = clamp ( ll , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["lk",";"]}]},{type:"node",name:"MATH_LESS_THAN",h:[{type:"node_in",name:"lm",qualifier:["float"],e:!1},{type:"node_in",name:"ln",qualifier:["float"],e:!1},
{type:"node_out",name:"lo",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lo = ( lm < ln ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lo = clamp ( lo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",h:[{type:"node_in",name:"lp",qualifier:["float"],e:!1},{type:"node_in",name:"lq",qualifier:["float"],e:!1},{type:"node_out",name:"lr",qualifier:["float"],
e:!1}],g:[{type:"textline",b:"lr = ( lp > lq ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lr = clamp ( lr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",h:[{type:"node_in",name:"ls",qualifier:["float"],e:!1},{type:"node_in",name:"lt",qualifier:["float"],e:!1},{type:"node_out",name:"lu",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lu = abs ( lt ) > 0.000001 ? mod ( ls , lt ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lu = clamp ( lu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ABSOLUTE",h:[{type:"node_in",name:"lv",qualifier:["float"],e:!1},{type:"node_in",name:"lw",qualifier:["float"],e:!1},{type:"node_out",name:"lx",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lx = abs ( lv ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lx = clamp ( lx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["lw",";"]}]},{type:"node",name:"MIX_RGB_MIX",h:[{type:"node_in",name:"ly",qualifier:["float"],e:!1},{type:"node_in",name:"lz",qualifier:["vec3"],e:!1},{type:"node_in",name:"lA",qualifier:["vec3"],e:!1},{type:"node_out",name:"lB",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( ly , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lB = mix ( lz , lA , fd ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lB = clamp ( lB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_ADD",h:[{type:"node_in",name:"lC",qualifier:["float"],e:!1},{type:"node_in",name:"lD",qualifier:["vec3"],e:!1},{type:"node_in",name:"lE",qualifier:["vec3"],e:!1},{type:"node_out",name:"lF",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( lC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lF = mix ( lD , lD + lE , fd ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lF = clamp ( lF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_MULTIPLY",h:[{type:"node_in",name:"lG",qualifier:["float"],e:!1},{type:"node_in",name:"lH",qualifier:["vec3"],e:!1},{type:"node_in",name:"lI",qualifier:["vec3"],e:!1},{type:"node_out",name:"lJ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( lG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lJ = mix ( lH , lH * lI , fd ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lJ = clamp ( lJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SUBTRACT",h:[{type:"node_in",name:"lK",qualifier:["float"],e:!1},{type:"node_in",name:"lL",qualifier:["vec3"],e:!1},{type:"node_in",name:"lM",qualifier:["vec3"],e:!1},{type:"node_out",name:"lN",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( lK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lN = mix ( lL , lL - lM , fd ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lN = clamp ( lN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SCREEN",h:[{type:"node_in",name:"lO",qualifier:["float"],e:!1},{type:"node_in",name:"lP",qualifier:["vec3"],e:!1},{type:"node_in",name:"lQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"lR",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( lO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fc = UNITY_VALUE_NODES - fd ; lR = en - ( vec3 ( fc ) + fd * ( en - lQ ) ) * ( en - lP ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",
b:"lR = clamp ( lR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",h:[{type:"node_in",name:"lS",qualifier:["float"],e:!1},{type:"node_in",name:"lT",qualifier:["vec3"],e:!1},{type:"node_in",name:"lU",qualifier:["vec3"],e:!1},{type:"node_out",name:"lV",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( lS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fc = UNITY_VALUE_NODES - fd ; lU += step ( lU , em ) ; lV = fc * lT + fd * lT / lU ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lV = clamp ( lV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",h:[{type:"node_in",name:"lW",qualifier:["float"],e:!1},{type:"node_in",name:"lX",qualifier:["vec3"],e:!1},{type:"node_in",name:"lY",qualifier:["vec3"],e:!1},{type:"node_out",name:"lZ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( lW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lZ = mix ( lX , abs ( lX - lY ) , fd ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lZ = clamp ( lZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",h:[{type:"node_in",name:"l_",qualifier:["float"],e:!1},{type:"node_in",name:"ma",qualifier:["vec3"],e:!1},{type:"node_in",name:"mb",qualifier:["vec3"],e:!1},{type:"node_out",name:"mc",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( l_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mc = min ( ma . rgb , mb . rgb * fd ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mc = clamp ( mc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",h:[{type:"node_in",name:"md",qualifier:["float"],e:!1},{type:"node_in",name:"me",qualifier:["vec3"],e:!1},{type:"node_in",name:"mf",qualifier:["vec3"],e:!1},{type:"node_out",name:"mg",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( md , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mg = max ( me . rgb , mf . rgb * fd ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mg = clamp ( mg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_OVERLAY",h:[{type:"node_in",name:"mh",qualifier:["float"],e:!1},{type:"node_in",name:"mi",qualifier:["vec3"],e:!1},{type:"node_in",name:"mj",qualifier:["vec3"],e:!1},{type:"node_out",name:"mk",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fo = vec3 ( UNITY_VALUE_NODES - fd ) ; mk = mix ( mi * ( fo + 2.0 * fd * mj ) , en - ( fo + 2.0 * fd * ( en - mj ) ) * ( en - mi ) , step ( 0.5 , mi ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mk = clamp ( mk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",h:[{type:"node_in",name:"ml",qualifier:["float"],e:!1},{type:"node_in",name:"mm",qualifier:["vec3"],e:!1},{type:"node_in",name:"mn",qualifier:["vec3"],e:!1},{type:"node_out",name:"mo",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( ml , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fo = en - fd * mn ; fn = clamp ( mm / fo , 0.0 , 1.0 ) ; mo = mix ( mix ( fn , en , step ( fo , em ) ) , mm , step ( mm , em ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mo = clamp ( mo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_BURN",h:[{type:"node_in",name:"mp",qualifier:["float"],e:!1},{type:"node_in",name:"mq",qualifier:["vec3"],e:!1},{type:"node_in",name:"mr",qualifier:["vec3"],e:!1},{type:"node_out",name:"ms",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mp , 0.0 , 1.0 ) ; fo = vec3 ( 1.0 - fd ) ; fo = fo + fd * mr ; fn = clamp ( en - ( en - mq ) / fo , 0.0 , 1.0 ) ; ms = mix ( fn , em , step ( fo , em ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"ms = clamp ( ms , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",h:[{type:"node_in",name:"mt",qualifier:["float"],e:!1},{type:"node_in",name:"mu",qualifier:["vec3"],e:!1},{type:"node_in",name:"mv",qualifier:["vec3"],e:!1},{type:"node_out",name:"mw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mt , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mw = mu ; fn = ew ( mv ) ; if ( fn . y != ZERO_VALUE_NODES ) { fo = ew ( mw ) ; fo . x = fn . x ; fp = eA ( fo ) ; mw = mix ( mw , fp , fd ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mw = clamp ( mw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",h:[{type:"node_in",name:"mx",qualifier:["float"],e:!1},{type:"node_in",name:"my",qualifier:["vec3"],e:!1},{type:"node_in",name:"mz",qualifier:["vec3"],e:!1},{type:"node_out",name:"mA",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fc = UNITY_VALUE_NODES - fd ; mA = my ; fp = ew ( mA ) ; if ( fp . y != ZERO_VALUE_NODES ) { fo = ew ( mz ) ; fp . y = fc * fp . y + fd * fo . y ; mA = eA ( fp ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mA = clamp ( mA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",h:[{type:"node_in",name:"mB",qualifier:["float"],e:!1},{type:"node_in",name:"mC",qualifier:["vec3"],e:!1},{type:"node_in",name:"mD",qualifier:["vec3"],e:!1},{type:"node_out",name:"mE",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fc = UNITY_VALUE_NODES - fd ; fp = ew ( mC ) ; fo = ew ( mD ) ; fp . z = fc * fp . z + fd * fo . z ; mE = eA ( fp ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mE = clamp ( mE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",h:[{type:"node_in",name:"mF",qualifier:["float"],e:!1},{type:"node_in",name:"mG",qualifier:["vec3"],e:!1},{type:"node_in",name:"mH",qualifier:["vec3"],e:!1},{type:"node_out",name:"mI",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mI = mG ; fo = ew ( mH ) ; if ( fo . y != ZERO_VALUE_NODES ) { fp = ew ( mI ) ; fp . x = fo . x ; fp . y = fo . y ; fn = eA ( fp ) ; mI = mix ( mI , fn , fd ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mI = clamp ( mI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",h:[{type:"node_in",name:"mJ",qualifier:["float"],e:!1},{type:"node_in",name:"mK",qualifier:["vec3"],e:!1},{type:"node_in",name:"mL",qualifier:["vec3"],e:!1},{type:"node_out",name:"mM",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fc = UNITY_VALUE_NODES - fd ; fn = mL + mK - mL * mK ; mM = mK * ( vec3 ( fc ) + vec3 ( fd ) * ( ( en - mK ) * mL + fn ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mM = clamp ( mM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",h:[{type:"node_in",name:"mN",qualifier:["float"],e:!1},{type:"node_in",name:"mO",qualifier:["vec3"],e:!1},{type:"node_in",name:"mP",qualifier:["vec3"],e:!1},{type:"node_out",name:"mQ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fd = clamp ( mN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mQ = mO + fd * ( 2.0 * mP - en ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mQ = clamp ( mQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",h:[{type:"node_in",name:"mR",qualifier:["vec3"],e:!1},{type:"node_in",name:"mS",qualifier:["float"],e:!1}],g:[{type:"textline",b:"eT = mR ; eX = mS ;".split(" ")}]},{type:"node",name:"MATERIAL_BEGIN",h:[{type:"node_in",name:"mT",qualifier:["vec3"],e:!1},{type:"node_in",name:"mU",qualifier:["vec3"],e:!1},{type:"node_in",
name:"mV",qualifier:["float"],e:!1},{type:"node_in",name:"mW",qualifier:["vec3"],e:!0},{type:"node_in",name:"mX",qualifier:["float"],e:!0},{type:"node_out",name:"mY",qualifier:["vec3"],e:!1},{type:"node_out",name:"mZ",qualifier:["vec3"],e:!1},{type:"node_out",name:"m_",qualifier:["vec3"],e:!1},{type:"node_out",name:"na",qualifier:["vec3"],e:!1},{type:"node_out",name:"nb",qualifier:["vec3"],e:!1},{type:"node_out",name:"nc",qualifier:["vec2"],e:!1},{type:"node_out",name:"nd",qualifier:["vec2"],e:!1},
{type:"node_out",name:"ne",qualifier:["float"],e:!1},{type:"node_param",name:"eO",qualifier:["const","vec2"]},{type:"node_param",name:"eP",qualifier:["const","vec3"]}],g:[{type:"textline",b:"m_ = clamp ( mT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",b:"na = eP [ 0 ] * clamp ( mU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATERIAL_EXT"],g:[{type:"textline",b:"mY = mX * m_ ;".split(" ")}]},{type:"node_else",g:[{type:"textline",
b:"mY = e_ * m_ ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:["m_","*=","mV",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],g:[{type:"textline",b:"nb = normalize ( mW ) ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["nb","=","fm",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["SHADELESS_MAT",{type:"logic_negative_expr",d:1},"NODES_GLOW",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",
d:2}],g:[{type:"textline",b:"mZ = fa * u_environment_energy * dW ( nb ) ; ne = dz ( m_ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],g:[{type:"textline",b:"nc = vec2 ( eO [ 0 ] , eO [ 1 ] ) ;".split(" ")},{type:"textline",b:"nd = vec2 ( eP [ 1 ] , eP [ 2 ] ) ;".split(" ")}]}]},{type:"textline",b:["eW","=","ne",";"]}]}]}]},{type:"node",name:"MATERIAL_END",h:[{type:"node_in",name:"nf",qualifier:["vec4"],e:!1},{type:"node_in",name:"ng",qualifier:["vec3"],
e:!1},{type:"node_in",name:"nh",qualifier:["vec3"],e:!1},{type:"node_in",name:"ni",qualifier:["float"],e:!0},{type:"node_in",name:"nj",qualifier:["float"],e:!0},{type:"node_in",name:"nk",qualifier:["float"],e:!0},{type:"node_out",name:"nl",qualifier:["vec3"],e:!0},{type:"node_out",name:"nm",qualifier:["float"],e:!0},{type:"node_out",name:"nn",qualifier:["vec3"],e:!0},{type:"node_out",name:"no",qualifier:["vec3"],e:!0},{type:"node_out",name:"np",qualifier:["vec3"],e:!0},{type:"node_param",name:"eQ",
qualifier:["float"]},{type:"node_param",name:"eR",qualifier:["float"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nl"],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:"nl = nf . rgb ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["nl","=","em",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["MATERIAL_EXT","REFLECTION_TYPE","REFL_NONE",{type:"non_equal_expr",d:2},{type:"logical_and_expr",d:2}],g:[{type:"textline",b:"dT ( nl , eS , nh , ni ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:["nl","+=","ng",";"]}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nn"],g:[{type:"textline",b:["nn","=","nh",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["MATERIAL_EXT"],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_no"],g:[{type:"textline",b:"no = nf . rgb ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_np"],g:[{type:"textline",b:["np","=","ng",
";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nm"],g:[{type:"textline",b:"nm = clamp ( nk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"fd = max ( max ( ng . r , ng . g ) , ng . b ) * nj ; nm = clamp ( nk * ( UNITY_VALUE_NODES - fd ) + fd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]}]},{type:"node_else",g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nm"],
g:[{type:"textline",b:"nm = clamp ( eQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"fd = max ( max ( ng . r , ng . g ) , ng . b ) * eR ; nm = eQ * ( UNITY_VALUE_NODES - fd ) + fd ;".split(" ")}]}]}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:["eU","=","ng",";"]}]},{type:"node_else",g:[{type:"textline",b:["eU","=","em",";"]}]}]},{type:"textline",
b:["eV","=","nh",";"]}]},{type:"node",name:"LIGHTING_AMBIENT",h:[{type:"node_in",name:"nq",qualifier:["vec3"],e:!1},{type:"node_in",name:"nr",qualifier:["vec3"],e:!1},{type:"node_in",name:"ns",qualifier:["vec3"],e:!1},{type:"node_out",name:"nt",qualifier:["vec4"],e:!1},{type:"node_out",name:"nu",qualifier:["vec3"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["SHADELESS_MAT",{type:"logic_negative_expr",d:1},"NODES_GLOW",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],g:[{type:"textline",
b:"nt = vec4 ( nq + ns * nr , ZERO_VALUE_NODES ) ; nu = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"nt = vec4 ( ns , ZERO_VALUE_NODES ) ; nu = em ;".split(" ")}]}]}]},{type:"node",name:"LIGHTING_LAMP",h:[{type:"node_in",name:"nv",qualifier:["float"],e:!1},{type:"node_out",name:"nw",qualifier:["vec3"],e:!1},{type:"node_out",name:"nx",qualifier:["vec2"],e:!1},{type:"node_out",name:"ny",qualifier:["vec3"],e:!1},{type:"node_out",name:"nz",qualifier:["float"],e:!1}],
g:[{type:"node_condition",a:[{type:"node_if",c:["NODES_GLOW",{type:"logic_negative_expr",d:1},"NUM_LIGHTS",0,{type:"g_expr",d:2},{type:"logical_and_expr",d:2}],g:[{type:"textline",b:"nx = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","HEMI",{type:"equal_expr",d:2}],g:[{type:"textline",b:["nz","=","el",";"]}]},{type:"node_else",g:[{type:"textline",b:["nz","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",b:"ny = u_light_color_intensities [ LAMP_IND ] ; if ( LAMP_SHADOW_MAP_IND != - 1 ) ny *= nv ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2},"LAMP_TYPE","POINT",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],g:[{type:"textline",b:"fn = u_light_positions [ LAMP_IND ] ; nw = fn - fl ;".split(" ")},{type:"textline",b:"fd = length ( nw ) ; ny *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + fd * fd ) ; nw = normalize ( nw ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2}],g:[{type:"textline",b:"fn = u_light_directions [ LAMP_IND ] ; fd = dot ( nw , fn ) ; fd *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( fd - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; ny *= fd ;".split(" ")}]}]}]},
{type:"node_else",g:[{type:"textline",b:"nw = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",h:[{type:"node_in",name:"nA",qualifier:["vec3"],e:!1},{type:"node_in",name:"nB",qualifier:["vec2"],e:!1},{type:"node_in",name:"nC",qualifier:["vec3"],e:!1},{type:"node_in",name:"nD",qualifier:["float"],e:!1},{type:"node_in",name:"nE",qualifier:["vec2"],e:!1},{type:"node_out",name:"nF",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nF = ZERO_VALUE_NODES ; if ( nB . r != ZERO_VALUE_NODES ) { fd = ( UNITY_VALUE_NODES - nD ) * dot ( nC , nA ) + nD ; if ( nE [ 0 ] == ZERO_VALUE_NODES ) { nF = UNITY_VALUE_NODES ; } else { fd = UNITY_VALUE_NODES + abs ( fd ) ; fd = nE [ 1 ] + ( UNITY_VALUE_NODES - nE [ 1 ] ) * pow ( fd , nE [ 0 ] ) ; nF = clamp ( fd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } nF = max ( nF , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_LAMBERT",h:[{type:"node_in",name:"nG",qualifier:["vec3"],e:!1},{type:"node_in",name:"nH",qualifier:["vec2"],e:!1},{type:"node_in",name:"nI",qualifier:["vec3"],e:!1},{type:"node_in",name:"nJ",qualifier:["float"],e:!1},{type:"node_out",name:"nK",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nK = ZERO_VALUE_NODES ; if ( nH . r != ZERO_VALUE_NODES ) { fd = ( UNITY_VALUE_NODES - nJ ) * dot ( nI , nG ) + nJ ; nK = max ( fd , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",
name:"DIFFUSE_OREN_NAYAR",h:[{type:"node_in",name:"nL",qualifier:["vec3"],e:!1},{type:"node_in",name:"nM",qualifier:["vec2"],e:!1},{type:"node_in",name:"nN",qualifier:["vec3"],e:!1},{type:"node_in",name:"nO",qualifier:["float"],e:!1},{type:"node_in",name:"nP",qualifier:["vec2"],e:!1},{type:"node_out",name:"nQ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nQ = ZERO_VALUE_NODES ; if ( nM . r != ZERO_VALUE_NODES ) { fd = ( UNITY_VALUE_NODES - nO ) * dot ( nN , nL ) + nO ; if ( nP [ 0 ] > ZERO_VALUE_NODES ) { fc = max ( dot ( nN , eS ) , ZERO_VALUE_NODES ) ; fb = nP [ 0 ] * nP [ 0 ] ; fe = UNITY_VALUE_NODES - el * ( fb / ( fb + 0.33 ) ) ; fn = nL - fd * nN ; fp = eS - fc * nN ;".split(" ")},
{type:"textline",b:"if ( length ( fn ) == ZERO_VALUE_NODES || length ( fp ) == ZERO_VALUE_NODES || abs ( fd ) > UNITY_VALUE_NODES || abs ( fc ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",b:"nQ = fd * fe ; else { ff = acos ( fd ) ; fc = acos ( fc ) ; fn = normalize ( fn ) ; fp = normalize ( fp ) ; fg = max ( ff , fc ) ; fh = min ( ff , fc ) ; fh *= 0.95 ; fc = max ( dot ( fn , fp ) , ZERO_VALUE_NODES ) ; fb = 0.45 * ( fb / ( fb + 0.09 ) ) ; nQ = fd * ( fe + ( fb * fc * sin ( fg ) * tan ( fh ) ) ) ; } } else nQ = fd ; nQ = max ( nQ , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",h:[{type:"node_in",name:"nR",qualifier:["vec3"],e:!1},{type:"node_in",name:"nS",qualifier:["vec2"],e:!1},{type:"node_in",name:"nT",qualifier:["vec3"],e:!1},{type:"node_in",name:"nU",qualifier:["float"],e:!1},{type:"node_in",name:"nV",qualifier:["vec2"],e:!1},{type:"node_out",name:"nW",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nW = ZERO_VALUE_NODES ; if ( nS . r != ZERO_VALUE_NODES ) { fd = ( UNITY_VALUE_NODES - nU ) * dot ( nT , nR ) + nU ; fh = max ( dot ( nT , eS ) , ZERO_VALUE_NODES ) ; if ( nV [ 0 ] <= UNITY_VALUE_NODES ) nW = fd * pow ( max ( fh * fd , 0.1 ) , nV [ 0 ] - UNITY_VALUE_NODES ) ; else nW = fd * pow ( 1.0001 - fh , nV [ 0 ] - UNITY_VALUE_NODES ) ; nW = max ( nW , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",h:[{type:"node_in",name:"nX",qualifier:["vec3"],e:!1},{type:"node_in",name:"nY",qualifier:["vec2"],e:!1},{type:"node_in",name:"nZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"n_",qualifier:["float"],e:!1},{type:"node_in",name:"oa",qualifier:["vec2"],e:!1},{type:"node_out",name:"ob",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ob = ZERO_VALUE_NODES ; if ( nY . r != ZERO_VALUE_NODES ) { fh = ( UNITY_VALUE_NODES - n_ ) * dot ( nZ , nX ) + n_ ; fh = acos ( fh ) ; if ( fh < oa [ 0 ] ) ob = UNITY_VALUE_NODES ; else if ( fh > ( oa [ 0 ] + oa [ 1 ] ) || oa [ 1 ] == ZERO_VALUE_NODES ) ob = ZERO_VALUE_NODES ; else ob = UNITY_VALUE_NODES - ( ( fh - oa [ 0 ] ) / oa [ 1 ] ) ; ob = max ( ob , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",h:[{type:"node_in",name:"oc",qualifier:["vec3"],e:!1},{type:"node_in",name:"od",qualifier:["vec2"],e:!1},{type:"node_in",name:"oe",qualifier:["vec3"],e:!1},{type:"node_in",name:"of",qualifier:["float"],e:!1},{type:"node_in",name:"og",qualifier:["vec2"],e:!1},{type:"node_out",name:"oh",qualifier:["float"],e:!1}],g:[{type:"textline",b:"oh = ZERO_VALUE_NODES ; if ( od . g == UNITY_VALUE_NODES ) { fp = normalize ( oc + eS ) ; oh = ( UNITY_VALUE_NODES - of ) * max ( dot ( oe , fp ) , ZERO_VALUE_NODES ) + of ; oh = pow ( oh , og [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",h:[{type:"node_in",name:"oi",qualifier:["vec3"],e:!1},{type:"node_in",name:"oj",qualifier:["vec2"],e:!1},{type:"node_in",name:"ok",qualifier:["vec3"],e:!1},{type:"node_in",name:"ol",qualifier:["vec2"],e:!1},{type:"node_out",name:"om",qualifier:["float"],e:!1}],g:[{type:"textline",b:"om = ZERO_VALUE_NODES ; if ( oj . g == UNITY_VALUE_NODES ) { fp = normalize ( oi + eS ) ; fh = max ( dot ( ok , fp ) , 0.001 ) ;".split(" ")},{type:"textline",b:"fd = max ( dot ( ok , eS ) , 0.01 ) ; fg = max ( dot ( ok , oi ) , 0.01 ) ; fh = tan ( acos ( fh ) ) ; fc = max ( ol [ 0 ] , 0.001 ) ; om = fg * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * fc * fc ) ) * ( exp ( - ( fh * fh ) / ( fc * fc ) ) / ( sqrt ( fd * fg ) ) ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_TOON",h:[{type:"node_in",name:"on",qualifier:["vec3"],e:!1},{type:"node_in",name:"oo",qualifier:["vec2"],e:!1},{type:"node_in",name:"op",qualifier:["vec3"],e:!1},{type:"node_in",name:"oq",qualifier:["vec2"],e:!1},{type:"node_out",name:"or",qualifier:["float"],e:!1}],g:[{type:"textline",b:"or = ZERO_VALUE_NODES ; if ( oo . g == UNITY_VALUE_NODES ) { fp = normalize ( on + eS ) ; fg = acos ( dot ( fp , op ) ) ; if ( fg < oq [ 0 ] ) or = UNITY_VALUE_NODES ; else if ( fg >= oq [ 0 ] + oq [ 1 ] || oq [ 1 ] == ZERO_VALUE_NODES ) or = ZERO_VALUE_NODES ; else or = UNITY_VALUE_NODES - ( fg - oq [ 0 ] ) / oq [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",h:[{type:"node_in",name:"os",qualifier:["vec3"],e:!1},{type:"node_in",name:"ot",qualifier:["vec2"],e:!1},{type:"node_in",name:"ou",qualifier:["vec3"],e:!1},{type:"node_in",name:"ov",qualifier:["float"],e:!1},{type:"node_in",name:"ow",qualifier:["vec2"],e:!1},{type:"node_out",name:"ox",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ox = ZERO_VALUE_NODES ; if ( ot . g == UNITY_VALUE_NODES ) { if ( ow [ 0 ] < 1.0 || ow [ 1 ] == ZERO_VALUE_NODES ) ox = ZERO_VALUE_NODES ; else { if ( ow [ 1 ] < 100.0 ) ow [ 1 ] = sqrt ( 1.0 / ow [ 1 ] ) ; else ow [ 1 ] = 10.0 / ow [ 1 ] ; fp = normalize ( eS + os ) ; fg = ( UNITY_VALUE_NODES - ov ) * max ( dot ( ou , fp ) , ZERO_VALUE_NODES ) + ov ; if ( fg < ZERO_VALUE_NODES ) ox = ZERO_VALUE_NODES ; else { fd = max ( dot ( ou , eS ) , 0.01 ) ; fc = dot ( ou , os ) ; if ( fc <= 0.01 ) ox = ZERO_VALUE_NODES ; else { fh = max ( dot ( eS , fp ) , 0.01 ) ; fb = UNITY_VALUE_NODES ; fd = ( 2.0 * fg * fd ) / fh ; fc = ( 2.0 * fg * fc ) / fh ; fc = min ( min ( fb , fd ) , fc ) ; fd = sqrt ( pow ( ow [ 0 ] , 2.0 ) + pow ( fh , 2.0 ) - UNITY_VALUE_NODES ) ; fh = pow ( fd - fh , 2.0 ) / pow ( fd + fh , 2.0 ) * ( UNITY_VALUE_NODES + pow ( fh * ( fd + fh ) - UNITY_VALUE_NODES , 2.0 ) / pow ( fh * ( fd - fh ) + UNITY_VALUE_NODES , 2.0 ) ) ; fg = acos ( fg ) ; ox = max ( fh * fc * exp ( - pow ( fg , 2.0 ) / ( 2.0 * pow ( ow [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",h:[{type:"node_in",name:"oy",qualifier:["vec4"],e:!1},{type:"node_in",name:"oz",qualifier:["vec3"],e:!1},{type:"node_in",name:"oA",qualifier:["float"],e:!1},{type:"node_in",name:"oB",qualifier:["float"],e:!1},{type:"node_in",name:"oC",qualifier:["vec3"],e:!1},{type:"node_in",name:"oD",qualifier:["vec3"],e:!1},{type:"node_in",name:"oE",qualifier:["vec4"],e:!1},{type:"node_in",name:"oF",qualifier:["vec3"],e:!1},{type:"node_in",name:"oG",qualifier:["vec3"],e:!1},{type:"node_in",
name:"oH",qualifier:["vec3"],e:!1},{type:"node_in",name:"oI",qualifier:["float"],e:!1},{type:"node_out",name:"oJ",qualifier:["vec4"],e:!1},{type:"node_out",name:"oK",qualifier:["vec3"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_NODE_B4W_TRANSLUCENCY"],g:[{type:"textline",b:"if ( dot ( oC , oD ) * dot ( eS , oD ) < ZERO_VALUE_NODES ) { fg = oE . x ; fc = oE . y ; fh = oE . z ; fd = oE . w ;".split(" ")},{type:"textline",b:"fb = clamp ( abs ( dot ( oC , oD ) ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fe = clamp ( dot ( eS , - oC ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fc = pow ( fe , fc ) ;".split(" ")},
{type:"textline",b:"oJ = oy + oI * vec4 ( oH * fb * pow ( oF , vec3 ( fg ) ) , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",b:"oJ += fh * mix ( vec4 ( oF , UNITY_VALUE_NODES ) , vec4 ( UNITY_VALUE_NODES ) , fd ) * oI * vec4 ( oH * fb * vec3 ( fc ) , UNITY_VALUE_NODES ) ; oK = oz ; } else {".split(" ")},{type:"textline",b:"oK = oz + oH * oG * oB ; oJ = oy + vec4 ( oH * oF * oA , oB ) ; }".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"oK = oz + oH * oG * oB ; oJ = oy + vec4 ( oH * oF * oA , oB ) ;".split(" ")}]}]}]},
{type:"node",name:"RGB",h:[{type:"node_out",name:"oL",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"oL = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",h:[{type:"node_in",name:"oM",qualifier:["vec3"],e:!1},{type:"node_out",name:"oN",qualifier:["float"],e:!1}],g:[{type:"textline",b:"oN = dot ( oM , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{type:"node",name:"SEPRGB",h:[{type:"node_in",name:"oO",qualifier:["vec3"],e:!1},{type:"node_out",name:"oP",qualifier:["float"],e:!0},
{type:"node_out",name:"oQ",qualifier:["float"],e:!0},{type:"node_out",name:"oR",qualifier:["float"],e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oP"],g:[{type:"textline",b:"oP = oO . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oQ"],g:[{type:"textline",b:"oQ = oO . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oR"],g:[{type:"textline",b:"oR = oO . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",h:[{type:"node_in",name:"oS",
qualifier:["vec3"],e:!1},{type:"node_out",name:"oT",qualifier:["float"],e:!0},{type:"node_out",name:"oU",qualifier:["float"],e:!0},{type:"node_out",name:"oV",qualifier:["float"],e:!0}],g:[{type:"textline",b:"fp = ew ( oS ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oT"],g:[{type:"textline",b:"oT = fp . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oU"],g:[{type:"textline",b:"oU = fp . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_oV"],g:[{type:"textline",b:"oV = fp . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",h:[{type:"node_in",name:"oW",qualifier:["float"],e:!1},{type:"node_in",name:"oX",qualifier:["float"],e:!1},{type:"node_in",name:"oY",qualifier:["float"],e:!1},{type:"node_out",name:"oZ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"oZ = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( oW - oY ) * oX ) ) ) ;".split(" ")}]},{type:"node",name:"GAMMA",h:[{type:"node_in",name:"o_",
qualifier:["vec3"],e:!1},{type:"node_in",name:"pa",qualifier:["float"],e:!1},{type:"node_out",name:"pb",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"pb = max ( em , o_ ) ; pb = pow ( pb , vec3 ( pa ) ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",h:[{type:"node_in",name:"pc",qualifier:["vec3"],e:!1},{type:"node_out",name:"pd",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"pd = max ( em , pc ) ; pd = pow ( pd , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",
h:[{type:"node_in",name:"pe",qualifier:["vec3"],e:!1},{type:"node_out",name:"pf",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"pf = max ( em , pe ) ; pf = pow ( pf , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_EMPTY",h:[{type:"node_out",name:"pg",qualifier:["vec3"],e:!1},{type:"node_out",name:"ph",qualifier:["vec3"],e:!1},{type:"node_out",name:"pi",qualifier:["float"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pi"],g:[{type:"textline",b:"pg [ 2 ] = pg [ 1 ] = pg [ 0 ] = 0.0 ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pi"],g:[{type:"textline",b:"ph [ 2 ] = ph [ 1 ] = ph [ 0 ] = 0.0 ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pi"],g:[{type:"textline",b:["pi","=","0.0",";"]}]}]}]},{type:"node",name:"TEXTURE_ENVIRONMENT",h:[{type:"node_in",name:"pj",qualifier:["vec3"],e:!1},{type:"node_out",name:"pk",qualifier:["vec3"],e:!0},{type:"node_out",name:"pl",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",
qualifier:["uniform","samplerCube"]}],g:[{type:"textline",b:"fj = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , pj ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pk"],g:[{type:"textline",b:"pk = fj . xyz ; aE ( pk ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pl"],g:[{type:"textline",b:"pl = fj . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",h:[{type:"node_in",name:"pm",qualifier:["vec3"],e:!0},{type:"node_in",name:"pn",qualifier:["vec3"],
e:!0},{type:"node_in",name:"po",qualifier:["vec3"],e:!0},{type:"node_in",name:"pp",qualifier:["vec3"],e:!0},{type:"node_out",name:"pq",qualifier:["vec3"],e:!0},{type:"node_out",name:"pr",qualifier:["float"],e:!0},{type:"node_out",name:"ps",qualifier:["vec3"],e:!0},{type:"node_out",name:"pt",qualifier:["float"],e:!0},{type:"node_out",name:"pu",qualifier:["vec3"],e:!0},{type:"node_out",name:"pv",qualifier:["float"],e:!0},{type:"node_out",name:"pw",qualifier:["vec3"],e:!0},{type:"node_out",name:"px",
qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_COLOR_var_texture , eE ( pm ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pq"],g:[{type:"textline",b:"pq = fj . xyz ; aE ( pq ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pr"],g:[{type:"textline",b:"pr = fj . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_uv2"],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_COLOR_var_texture , eE ( pn ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ps"],g:[{type:"textline",b:"ps = fj . xyz ; aE ( ps ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pt"],g:[{type:"textline",b:"pt = fj . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_COLOR_var_texture , eE ( po ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pu"],g:[{type:"textline",b:"pu = fj . xyz ; aE ( pu ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pv"],g:[{type:"textline",b:"pv = fj . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_COLOR_var_texture , eE ( pp ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pw"],g:[{type:"textline",b:"pw = fj . xyz ; aE ( pw ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_px"],g:[{type:"textline",b:"px = fj . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",h:[{type:"node_in",name:"py",qualifier:["vec3"],e:!0},{type:"node_in",name:"pz",qualifier:["vec3"],e:!0},{type:"node_in",name:"pA",qualifier:["vec3"],e:!0},{type:"node_in",name:"pB",qualifier:["vec3"],e:!0},{type:"node_out",name:"pC",qualifier:["vec3"],e:!0},{type:"node_out",name:"pD",qualifier:["float"],e:!0},{type:"node_out",name:"pE",qualifier:["vec3"],
e:!0},{type:"node_out",name:"pF",qualifier:["float"],e:!0},{type:"node_out",name:"pG",qualifier:["vec3"],e:!0},{type:"node_out",name:"pH",qualifier:["float"],e:!0},{type:"node_out",name:"pI",qualifier:["vec3"],e:!0},{type:"node_out",name:"pJ",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_NORMAL_var_texture , eE ( py ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_pC"],g:[{type:"textline",b:"pC = normalize ( fk * ( fj . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pD"],g:[{type:"textline",b:"pD = fj . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv2"],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_NORMAL_var_texture , eE ( pz ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pE"],g:[{type:"textline",b:"pE = normalize ( fk * ( fj . xyz - 0.5 ) ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pF"],g:[{type:"textline",b:"pF = fj . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_NORMAL_var_texture , eE ( pA ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pG"],g:[{type:"textline",b:"pG = normalize ( fk * ( fj . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pH"],g:[{type:"textline",b:"pH = fj . w ;".split(" ")}]}]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],g:[{type:"textline",b:"fj = texture2D ( node_TEXTURE_NORMAL_var_texture , eE ( pB ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pI"],g:[{type:"textline",b:"pI = normalize ( fk * ( fj . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pJ"],g:[{type:"textline",b:"pJ = fj . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",h:[{type:"node_out",name:"pK",qualifier:["float"],e:!1}],
g:[{type:"textline",b:"pK = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",h:[{type:"node_in",name:"pL",qualifier:["vec3"],e:!1},{type:"node_in",name:"pM",qualifier:["vec3"],e:!1},{type:"node_out",name:"pN",qualifier:["vec3"],e:!1},{type:"node_out",name:"pO",qualifier:["float"],e:!0}],g:[{type:"textline",b:"pN = pL + pM ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pO"],g:[{type:"textline",b:"pO = ( abs ( pN [ 0 ] ) + abs ( pN [ 1 ] ) + abs ( pN [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_SUBTRACT",h:[{type:"node_in",name:"pP",qualifier:["vec3"],e:!1},{type:"node_in",name:"pQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"pR",qualifier:["vec3"],e:!1},{type:"node_out",name:"pS",qualifier:["float"],e:!0}],g:[{type:"textline",b:"pR = pP - pQ ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pS"],g:[{type:"textline",b:"pS = ( abs ( pR [ 0 ] ) + abs ( pR [ 1 ] ) + abs ( pR [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",
h:[{type:"node_in",name:"pT",qualifier:["vec3"],e:!1},{type:"node_in",name:"pU",qualifier:["vec3"],e:!1},{type:"node_out",name:"pV",qualifier:["vec3"],e:!1},{type:"node_out",name:"pW",qualifier:["float"],e:!0}],g:[{type:"textline",b:"pV = pT + pU ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pW"],g:[{type:"textline",b:"pW = length ( pV ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pV"],g:[{type:"textline",b:"pV = normalize ( pV ) ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_DOT_PRODUCT",h:[{type:"node_in",name:"pX",qualifier:["vec3"],e:!1},{type:"node_in",name:"pY",qualifier:["vec3"],e:!1},{type:"node_out",name:"pZ",qualifier:["vec3"],e:!1},{type:"node_out",name:"p_",qualifier:["float"],e:!0}],g:[{type:"textline",b:["pZ","=","em",";"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_p_"],g:[{type:"textline",b:"p_ = dot ( pX , pY ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",h:[{type:"node_in",name:"qa",qualifier:["vec3"],
e:!1},{type:"node_in",name:"qb",qualifier:["vec3"],e:!1},{type:"node_out",name:"qc",qualifier:["vec3"],e:!1},{type:"node_out",name:"qd",qualifier:["float"],e:!0}],g:[{type:"textline",b:"qc = cross ( qa , qb ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qd"],g:[{type:"textline",b:"qd = length ( qc ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",h:[{type:"node_in",name:"qe",qualifier:["vec3"],e:!1},{type:"node_in",name:"qf",qualifier:["vec3"],e:!1},{type:"node_out",
name:"qg",qualifier:["vec3"],e:!1},{type:"node_out",name:"qh",qualifier:["float"],e:!0}],g:[{type:"textline",b:"qg = normalize ( qe ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qh"],g:[{type:"textline",b:"qh = length ( qe ) ;".split(" ")}]}]},{type:"textline",b:["qf",";"]}]},{type:"node",name:"B4W_REFLECT",h:[{type:"node_in",name:"qi",qualifier:["vec3"],e:!1},{type:"node_in",name:"qj",qualifier:["vec3"],e:!1},{type:"node_out",name:"qk",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"qk = reflect ( - qi , qj ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",h:[{type:"node_in",name:"ql",qualifier:["vec3"],e:!1},{type:"node_in",name:"qm",qualifier:["float"],e:!1},{type:"node_in",name:"qn",qualifier:["const","float"],e:!1},{type:"node_in",name:"qo",qualifier:["const","float"],e:!1},{type:"node_out",name:"qp",qualifier:["vec3"],e:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"fc = length ( fi ) ; if ( fc < qo ) { eY = eE ( ql ) ; fc = clamp ( 0.5 * ( qo - fc ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fc = qm * fc ;".split(" ")},
{type:"textline",b:"fp = normalize ( eS * fk ) ;".split(" ")},{type:"textline",b:"fb = UNITY_VALUE_NODES / qn ;".split(" ")},{type:"textline",b:"eZ = fp . xy * fc / ( qn * fp . z ) ; fc = UNITY_VALUE_NODES ; fd = texture2D ( node_B4W_PARALLAX_var_texture , eY ) . a ;".split(" ")},{type:"textline",b:"for ( float qq = 1.0 ; qq <= qn ; qq ++ ) { if ( fd < fc ) { fc -= fb ; eY -= eZ ; fd = texture2D ( node_B4W_PARALLAX_var_texture , eY ) . a ; } }".split(" ")},{type:"textline",b:"eZ = eY + eZ ; fb = texture2D ( node_B4W_PARALLAX_var_texture , eZ ) . a - ( fc + fb ) ; fc = fd - fc ; fb = fc / ( fc - fb ) ;".split(" ")},
{type:"textline",b:"eY = fb * eZ + ( UNITY_VALUE_NODES - fb ) * eY ; qp = eC ( eY ) ; } else qp = ql ;".split(" ")}]},{type:"node",name:"B4W_CLAMP",h:[{type:"node_in",name:"qr",qualifier:["vec3"],e:!1},{type:"node_out",name:"qs",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"qs = clamp ( qr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",h:[{type:"node_in",name:"qt",qualifier:["vec3"],e:!1},{type:"node_in",name:"qu",qualifier:["float"],e:!1},{type:"node_out",
name:"qv",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"qv = er ( qt , qu ) ;".split(" ")}]},{type:"node",name:"B4W_TRANSLUCENCY",h:[{type:"node_in",name:"qw",qualifier:["float"],e:!1},{type:"node_in",name:"qx",qualifier:["float"],e:!1},{type:"node_in",name:"qy",qualifier:["float"],e:!1},{type:"node_in",name:"qz",qualifier:["float"],e:!1},{type:"node_in",name:"qA",qualifier:["float"],e:!1},{type:"node_out",name:"qB",qualifier:["float"],e:!0},{type:"node_out",name:"qC",qualifier:["vec4"],e:!0}],
g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qB"],g:[{type:"textline",b:["qB","=","qw",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qC"],g:[{type:"textline",b:"qC = vec4 ( qx , qy , qz , qA ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",h:[{type:"node_out",name:"qD",qualifier:["float"],e:!1}],g:[{type:"textline",b:["qD","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",h:[{type:"node_in",name:"qE",qualifier:["float"],e:!1},{type:"node_in",name:"qF",qualifier:["float"],
e:!1},{type:"node_in",name:"qG",qualifier:["float"],e:!1},{type:"node_out",name:"qH",qualifier:["float"],e:!1}],g:[{type:"textline",b:"qH = smoothstep ( qF , qG , qE ) ;".split(" ")}]},{type:"node",name:"B4W_GLOW_OUTPUT",h:[{type:"node_in",name:"qI",qualifier:["vec3"],e:!1},{type:"node_in",name:"qJ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"eT = qI ; eX = qJ ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",h:[{type:"node_in",name:"qK",qualifier:["vec3"],e:!1},{type:"node_out",name:"qL",
qualifier:["float"],e:!1}],g:[{type:"textline",b:"qL = ( qK . r + qK . g + qK . b ) / 3.0 ;".split(" ")}]},{type:"node",name:"B4W_SCALTOVEC",h:[{type:"node_in",name:"qM",qualifier:["float"],e:!1},{type:"node_out",name:"qN",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"qN [ 0 ] = qM ; qN [ 1 ] = qM ; qN [ 2 ] = qM ;".split(" ")}]},{type:"nodes_global"},{type:"textline",b:"void qO ( in vec3 eS , out vec3 eT , out vec3 eU , out vec3 eV , out float eW , out float eX ) { vec2 eY , eZ ; float e_ , fa , fb , fc , fd , fe , ff , fg , fh ; vec4 fi , fj ; mat3 fk ; vec3 fl , fm , fn , fo , fp ; eT = em ; eU = em ; eV = em ; eW = ZERO_VALUE_NODES ; eX = ZERO_VALUE_NODES ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["fl","=","bw",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) fl = fl ; else fl = - fl ;".split(" ")}]}}]},{type:"textline",b:"fm = normalize ( fl ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],
group:{type:"group",a:[{type:"textline",b:"fn = cross ( fl , bx . xyz ) * bx . w ; fk = mat3 ( bx . xyz , fn , fl ) ; fk = fk ;".split(" ")}]}}]},{type:"textline",b:"fl = bu ; fi = bv ; e_ = u_emit ; fa = u_ambient ;".split(" ")},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 qP = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",d:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 qV ( vec3 qQ , mat4 qR ) { vec3 qS , qT , qU ; qS = vec3 ( qR [ 0 ] [ 0 ] , qR [ 1 ] [ 0 ] , qR [ 2 ] [ 0 ] ) ; qT = vec3 ( qR [ 0 ] [ 1 ] , qR [ 1 ] [ 1 ] , qR [ 2 ] [ 1 ] ) ; qU = vec3 ( qR [ 0 ] [ 2 ] , qR [ 1 ] [ 2 ] , qR [ 2 ] [ 2 ] ) ; qT = cross ( qU , qS ) ; qS = normalize ( qS ) ; qT = normalize ( qT ) ; qU = normalize ( qU ) ; return mat4 ( vec4 ( qS , 0.0 ) , vec4 ( qT , 0.0 ) , vec4 ( qU , 0.0 ) , vec4 ( qQ , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 ra ( vec3 qW , vec3 qX ) { vec3 qY , qZ , q_ ; qY = qW - qX ; qY . y = 0.0 ; qZ = cross ( qP , qY ) ; q_ = cross ( qY , qZ ) ; qZ = normalize ( qZ ) ; q_ = normalize ( q_ ) ; qY = normalize ( qY ) ; return mat4 ( vec4 ( qZ , 0.0 ) , vec4 ( q_ , 0.0 ) , vec4 ( qY , 0.0 ) , vec4 ( qX , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 ri ( in vec3 rb , float rc , float rd , float re , vec3 rf ) { float rg , rh ; rg = fract ( length ( rf ) / 0.17 ) ; rh = re + rg / 10.0 ; rg = rg ; if ( re != 0.0 ) rg /= re ; rb *= 1.0 + 0.5 * sin ( rc ) ; rg = length ( rb ) * rd * sin ( 2.0 * 3.14 * rc * rh + rg ) ; return bl ( rg ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 rq ( in vec3 rj , in vec3 rk , in mat4 rl ) { vec3 rm ; float rn , ro ; mat4 rp ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",d:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"rp = qV ( rk , rl ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",
b:"rn = fract ( ( rk . x * 1.43 + rk . y * 0.123 + rk . z * 6.1 ) ) ; rn = 2.0 * M_PI * rn ; rm = normalize ( vec3 ( rl [ 0 ] [ 2 ] , 0.0 , rl [ 2 ] [ 2 ] ) ) ; ro = acos ( rm [ 2 ] ) ; if ( rm [ 0 ] < 0.0 ) ro = 2.0 * M_PI - ro ; ro = ro - rn ; if ( ro < 0.0 ) ro = 2.0 * M_PI + ro ; rn = rn ; if ( ro <= MAX_BILLBOARD_ANGLE ) rn += ro ; else if ( ro <= M_PI - MAX_BILLBOARD_ANGLE ) rn += MAX_BILLBOARD_ANGLE * ( 2.0 * ro - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( ro <= M_PI + MAX_BILLBOARD_ANGLE ) rn += ro - M_PI ; else if ( ro <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) rn += MAX_BILLBOARD_ANGLE * ( 2.0 * ro - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else rn += ro - 2.0 * M_PI ; rp = bj ( rn ) ; rp [ 3 ] = vec4 ( rk , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"rp = ra ( rj , rk ) ;".split(" ")}]}}]},{type:"textline",b:["return","rp",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 rw ( in vec3 rr , in vec3 rs , in mat4 rt , mat4 ru ) { mat4 rv ; rv = rq ( rr , rs , rt ) ; ru [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; rv = rv * ru ; return rv ; }".split(" ")}]}}]},
{type:"textline",b:"aM rD ( in vec3 rx , in vec3 ry , in vec3 rz , in vec3 rA , in vec3 rB , in mat4 rC ) { rx = ( rC * vec4 ( rx , 1.0 ) ) . xyz ; ry = ( rC * vec4 ( ry , 1.0 ) ) . xyz ; rz = ( rC * vec4 ( rz , 0.0 ) ) . xyz ; rA = ( rC * vec4 ( rA , 0.0 ) ) . xyz ; rB = ( rC * vec4 ( rB , 0.0 ) ) . xyz ; return bn ( aM ( rx , ry , rz , rA , rB , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 rG ( vec2 rE , vec3 rF ) { return ( rE + 0.5 ) * rF . xy - 0.5 ; }".split(" ")}]};
a["include/skin.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 rN ( in vec4 rH , in vec4 rI , in float rJ ) { float rK , rL , rM ; rK = rH [ 0 ] * rI [ 0 ] + rH [ 1 ] * rI [ 1 ] + rH [ 2 ] * rI [ 2 ] + rH [ 3 ] * rI [ 3 ] ; if ( rK < 0.0 ) { rI *= - 1.0 ; rK = - rK ; } if ( abs ( rK ) >= 1.0 ) return rH ; rL = acos ( rK ) ; rK = sqrt ( 1.0 - rK * rK ) ; if ( abs ( rK ) < 0.001 ) return vec4 ( rH * 0.5 + rI * 0.5 ) ; rM = sin ( ( 1.0 - rJ ) * rL ) / rK ; rK = sin ( rJ * rL ) / rK ; return rH * rM + rI * rK ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 rZ ( in vec3 rO , in vec4 rP , in vec4 rQ , in vec4 rR , in vec4 rS , in float rT ) { vec4 rU , rV ; vec3 rW , rX , rY ; rW = aZ ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rO , 1.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"rU = rN ( rP , rQ , rT ) ; rV = mix ( rR , rS , rT ) ; rX = aS ( rU , rW ) ; rX = rX * rV . w + rV . xyz ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"rY = aS ( rP , rW ) ; rW = aS ( rQ , rW ) ; rY = rY * rR . w + rR . xyz ; rW = rW * rS . w + rS . xyz ; rX = mix ( rY , rW , rT ) ;".split(" ")}]}}]},{type:"textline",b:"return be ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rX , 1.0 ) ) ; } vec3 sh ( in vec3 r_ , in vec4 sa , in vec4 sb , in float sc ) { vec4 sd ; vec3 se , sf , sg ; se = aZ ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( r_ , 0.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"sd = rN ( sa , sb , sc ) ; sf = aS ( sd , se ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"sg = aS ( sa , se ) ; se = aS ( sb , se ) ; sf = mix ( sg , se , sc ) ;".split(" ")}]}}]},{type:"textline",b:"return be ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sf , 0.0 ) ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 rZ ( in vec3 si , in vec4 sj , in vec4 sk ) { vec3 sl ; sl = aZ ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( si , 1.0 ) ) ; sl = aS ( sj , sl ) ; sl = sl * sk . w + sk . xyz ; return be ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sl , 1.0 ) ) ; } vec3 sh ( in vec3 sm , in vec4 sn ) { vec3 so ; so = aZ ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sm , 0.0 ) ) ; so = aS ( sn , so ) ; return be ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( so , 0.0 ) ) ; }".split(" ")}]}}]},
{type:"textline",b:"void sD ( inout vec3 sp , inout vec3 sq , inout vec3 sr , inout vec3 ss ) { int st , su ; vec4 sv ; vec3 sw , sx , sy , sz ; float sA , sB ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["sA","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { sw = vec3 ( 0.0 , 0.0 , 0.0 ) ; sx = vec3 ( 0.0 , 0.0 , 0.0 ) ; sy = vec3 ( 0.0 , 0.0 , 0.0 ) ; sz = vec3 ( 0.0 , 0.0 , 0.0 ) ; sv = a_influence ; for ( int sC = 0 ; sC < 4 ; sC ++ ) { st = int ( sv [ sC ] ) ; sB = fract ( sv [ sC ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"sw += sB * rZ ( sp , u_quatsb [ st ] , u_quatsa [ st ] , u_transb [ st ] , u_transa [ st ] , sA ) ; sx += sB * sh ( sq , u_quatsb [ st ] , u_quatsa [ st ] , sA ) ; sy += sB * sh ( sr , u_quatsb [ st ] , u_quatsa [ st ] , sA ) ; sz += sB * sh ( ss , u_quatsb [ st ] , u_quatsa [ st ] , sA ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"sw += sB * rZ ( sp , u_quatsb [ st ] , u_transb [ st ] ) ; sx += sB * sh ( sq , u_quatsb [ st ] ) ; sy += sB * sh ( sr , u_quatsb [ st ] ) ; sz += sB * sh ( ss , u_quatsb [ st ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} sp = sw ; sq = sx ; sr = sy ; ss = sz ; } if ( ! ( a_influence . y > 0.0 ) ) { su = int ( a_influence [ 0 ] - 1.0 ) ; if ( su > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"sp = rZ ( sp , u_quatsb [ su ] , u_quatsa [ su ] , u_transb [ su ] , u_transa [ su ] , sA ) ; sq = sh ( sq , u_quatsb [ su ] , u_quatsa [ su ] , sA ) ; sr = sh ( sr , u_quatsb [ su ] , u_quatsa [ su ] , sA ) ; ss = sh ( ss , u_quatsb [ su ] , u_quatsa [ su ] , sA ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"sp = rZ ( sp , u_quatsb [ su ] , u_transb [ su ] ) ; sq = sh ( sq , u_quatsb [ su ] ) ; sr = sh ( sr , u_quatsb [ su ] ) ; ss = sh ( ss , u_quatsb [ su ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void sO ( inout vec3 sE , in vec3 sF , in float sG , in float sH , in float sI , in vec3 sJ , in float sK ) { vec3 sL ; float sM , sN ; sM = length ( sF ) ; sN = sH * ( 1.0 + 0.1 * fract ( sM ) ) ; sM = sG * sK * ( 1.0 + sin ( 2.0 * 3.14 * sI * sN + sM ) ) ; sN = ( sE . y - sF . y ) * abs ( sM ) ; sN += 1.0 ; sN *= sN ; sN = sN * sN - sN ; sL = sE ; sL . xz += sJ . xz * sN * sign ( sM ) ; sL = sL - sF ; if ( all ( equal ( sL , vec3 ( 0.0 ) ) ) ) sE = sF ; else { sM = length ( sE - sF ) ; sE = sF + normalize ( sL ) * sM ; } }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 sQ ( vec4 sP ) { return sP * sP * ( 3.0 - 2.0 * sP ) ; } vec4 sS ( vec4 sR ) { return abs ( fract ( sR + 0.5 ) * 2.0 - 1.0 ) ; } vec4 sU ( vec4 sT ) { return sQ ( sS ( sT ) ) ; } void tk ( inout vec3 sV , in float sW , in vec3 sX , in vec3 sY , in vec3 sZ , in float s_ , in float ta , in float tb , in vec3 tc ) { vec3 td ; vec4 te ; vec2 tf , tg ; float th , ti , tj ; th = dot ( sZ , vec3 ( 1.0 ) ) ; ti = th + tc . g ; tj = dot ( sV , vec3 ( tc . g ) ) ; tf = ( sW + vec2 ( tj , ti ) ) ; te = ( ( fract ( ( tf . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( sY ) * s_ ; te = sU ( te ) ; tg = te . xz + te . yw ; tg . y = 0.5 - tg . y ; td = tg . xyx * tc . rbr * vec3 ( ta * sX . x , tb , ta * sX . z ) ; sV += td ; }".split(" ")}]}}]},
{type:"textline",b:"void tr ( inout vec3 tl , inout vec3 tm , in vec3 tn ) { vec3 to , tp , tq ; to = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"tp = tm ; tq = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tp = tl ; tq = tm ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"tk ( tp , u_time , tn , to , tq , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"sO ( tp , tq , au_wind_bending_amp , au_wind_bending_freq , u_time , to , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"sO ( tp , tq , au_wind_bending_amp , au_wind_bending_freq , u_time , to , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"tl += tp - tm ; tm = tp ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tl = tp ; tm = tq ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/nodes.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_orco_tex_coord ; varying vec3 ek ;".split(" ")}]}}]},
{type:"node",name:"TEX_COORD_UV",h:[{type:"node_param",name:"node_TEX_COORD_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eM",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["eM","=","node_TEX_COORD_UV_var_a_uv",";"]}]},{type:"node",name:"UV_MERGED",h:[{type:"node_param",name:"node_UV_MERGED_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eL",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["eL","=","node_UV_MERGED_var_a_uv",";"]}]},{type:"node",
name:"UVMAP",h:[{type:"node_param",name:"node_UVMAP_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eN",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["eN","=","node_UVMAP_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_UV",h:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eF",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["eF","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",h:[{type:"node_param",
name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"ts",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["ts","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",h:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"tt",qualifier:["varying","float"]}],g:[{type:"textline",b:["tt","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",
h:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"tu",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["tu","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",h:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"tv",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["tv","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},
{type:"nodes_global"},{type:"textline",b:["void","tw","(",")","{"]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["ek","=","a_orco_tex_coord",";"]}]}}]},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 tB ( vec3 tx , float ty , vec2 tz ) { vec2 tA ; tA = vec2 ( ( tx . x - tz . x ) / ty , - ( tx . z - tz . y ) / ty ) ; return fract ( tA ) ; } vec2 tF ( vec2 tC , float tD , vec2 tE ) { return vec2 ( tC . x * tD , - tC . y * tD ) + tE ; } aM tG ( ) { return aM ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } aM ub ( vec3 tH , vec3 tI , vec3 tJ , vec3 tK , vec3 tL , PRECISION sampler2D tM , sampler2D tN , vec3 tO , float tP , vec3 tQ , vec4 tR , mat4 tS ) { mat4 tT ; vec4 tU ; vec2 tV , tW , tX ; float tY , tZ ; vec3 t_ ; t_ = aS ( tR , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; tY = - t_ . x ; tZ = - t_ . z ; tV = vec2 ( tQ . x + tP * ( - 1.0 - tY ) / 2.0 , tQ . z + tP * ( 1.0 - tZ ) / 2.0 ) ; tW = tB ( tL , tP , tV ) ; tZ = tP / 2.0 ; tX = abs ( tF ( tW - vec2 ( 0.5 ) , tP , vec2 ( 0.0 ) ) ) ; tZ = tZ * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( tX ) > tZ ) return tG ( ) ; tZ = tP / tO . z ; tX = ( tW - vec2 ( 0.5 ) ) * tZ + vec2 ( 0.5 ) ; t_ = t_ * ( tP / tO . z - 1.0 ) / 2.0 ; tX . x += t_ . x ; tX . y -= t_ . z ; tU = texture2D ( tN , tX ) ; tZ = tU . r ; if ( tZ < u_scale_threshold ) return tG ( ) ; tY = tO . y - tO . x ; tY = tO . y - texture2D ( tM , tX ) . r * tY ; tX = tH . xz - tL . xz ; tL . xz = tF ( tW , tP , tV ) ; tL . y = tY ; tH . xz = tL . xz + tX ; tH . y *= tZ ; tH . y += tY ; t_ = tU . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"tH -= tL ; tT = rq ( tQ , tL , tS ) ; aM ua = rD ( tH , tL , tI , tJ , tK , tT ) ; ua . b = tL ; ua . f = t_ ; return bn ( ua ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return bn ( aM ( tH , tL , tI , tJ , tK , t_ ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",
a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 uh ( mat4 uc , vec4 ud ) { vec4 ue ; float uf ; vec2 ug ; ug = ( uc * u_v_light_matrix [ 3 ] ) . xy ; uf = SHADOW_TEX_RES / 2.0 ; ug = floor ( ug * uf + 0.5 ) / uf - ug ; ue = uc * ud ; ue . xy += ug ; ue = u_b_light_matrix * ue ; return ue ; } void ul ( vec3 ui , vec3 uj ) { vec4 uk ; uk = u_v_light_matrix * vec4 ( ui + u_normal_offset * uj , 1.0 ) ; bA = uh ( u_p_light_matrix0 , uk ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"bB = uh ( u_p_light_matrix1 , uk ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"bC = uh ( u_p_light_matrix2 , uk ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"bD = uh ( u_p_light_matrix3 , uk ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/fog.glslf"]=
{type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void uv ( inout vec3 up , in float uq , in float ur , in vec4 us ) { float ut , uu ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:"ut = clamp ( ( uq - u_fog_params . z ) / u_fog_params . y , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOG_TYPE","QUADRATIC",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["ut","*=","ut",";"]}]}},
{type:"elif",c:["FOG_TYPE","LINEAR",{type:"equal_expr",d:2}],group:{type:"group",a:[]}},{type:"elif",c:["FOG_TYPE","INVERSE_QUADRATIC",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ut = sqrt ( ut ) ;".split(" ")}]}}]},{type:"textline",b:"if ( u_fog_params . w > 0.0 ) { if ( ur > u_fog_params . w ) ut = 0.0 ; else if ( ur > 0.0 ) { uu = ( u_fog_params . w - ur ) / u_fog_params . w ; ut *= uu * uu ; } } ut = 1.0 - ( 1.0 - ut ) * ( 1.0 - u_fog_params . x ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["ut","=","0.0",";"]}]}}]},{type:"textline",b:"up = mix ( up , us . rgb , ut ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 uB ( in mat4 uw , in vec3 ux ) { vec3 uy , uz , uA ; uy = mix ( uw [ 0 ] . rgb , uw [ 1 ] . rgb , max ( sign ( ux . x ) , 0.0 ) ) ; uz = mix ( uw [ 2 ] . rgb , uw [ 3 ] . rgb , max ( sign ( ux . z ) , 0.0 ) ) ; uA = vec3 ( uw [ 0 ] . a , uw [ 1 ] . a , uw [ 2 ] . a ) ; uz = mix ( uy , uz , abs ( ux . z ) ) ; uz = mix ( uz , uA , abs ( ux . y ) ) ; aE ( uz ) ; return uz ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void uD ( inout float uC ) { uC -= 0.5 ; uC = 4.0 * ( uC * uC * uC ) + 0.5 ; } void uQ ( inout vec3 uE , in float uF , in vec3 uG , in float uH , in vec4 uI , in vec4 uJ , in float uK ) { vec3 uL , uM ; float uN , uO , uP ; uN = uJ . w * uF ; uN = exp ( - uN * uN ) ; uN = clamp ( uN , 0.0 , 1.0 ) ; uO = max ( uG . y , 0.0 ) ; uF = max ( uF - max ( uH / uO , 0.0 ) , 0.0 ) ; uP = uI . w * uF ; uP = 1.0 - uP ; uP = max ( uP , 0.0 ) ; uD ( uP ) ; uP += max ( uK - 0.5 , 0.0 ) ; if ( uP < uN ) { uL = vec3 ( 0.0 , 0.02 , 0.05 ) ; uM = uI . rgb ; uH = clamp ( - uH * 0.03 , 0.0 , 0.8 ) ; uL = mix ( uM , uL , min ( uO , 1.0 ) ) ; uL = mix ( uL , vec3 ( 0.0 ) , uH ) ; uE = mix ( uL , uE , uP ) ; } if ( uP >= uN ) { uE = mix ( uJ . rgb , uE , uN ) ; } } void uW ( inout vec3 uR , in float uS , in float uT ) { vec3 uU ; float uV ; uV = u_underwater_fog_color_density . w * uS ; uV = 1.0 - uV ; uV = clamp ( uV , 0.0 , 1.0 ) ; uD ( uV ) ; uT = clamp ( - uT * 0.03 , 0.0 , 0.8 ) ; uU = mix ( u_underwater_fog_color_density . rgb , vec3 ( 0.0 ) , uT ) ; uR = mix ( uU , uR , uV ) ; }".split(" ")}]}}]},
{type:"textline",b:"void vc ( inout vec3 uX , float uY , vec3 uZ , float u_ ) { vec4 va ; vec3 vb ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vb = uB ( u_cube_fog , uZ ) ; va = vec4 ( vb , u_fog_color_density . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["va","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uQ ( uX , uY , uZ , u_cam_water_depth , u_underwater_fog_color_density , va , u_ ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"uv ( uX , uY , bu . y , va ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/lighting_nodes.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",
b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"float vf = 0.0 ; float vg = 1.0 ; float vh = 0.5 ; vec3 vi = vec3 ( vf ) ;".split(" ")},{type:"node",name:"LIGHTING_BEGIN",h:[{type:"node_out",name:"vG",qualifier:["vec3"],e:!1},{type:"node_out",name:"vH",qualifier:["vec3"],e:!1},{type:"node_out",name:"vI",qualifier:["vec3"],e:!1},{type:"node_out",name:"vJ",qualifier:["vec3"],e:!0},{type:"node_out",name:"vK",qualifier:["vec3"],e:!0},
{type:"node_out",name:"vL",qualifier:["vec2"],e:!0},{type:"node_out",name:"vM",qualifier:["vec2"],e:!0},{type:"node_out",name:"vN",qualifier:["float"],e:!0},{type:"node_out",name:"vO",qualifier:["float"],e:!0},{type:"node_out",name:"vP",qualifier:["vec4"],e:!0}],g:[{type:"textline",b:"vG = vj ; vH = vk ; vI = vl ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vJ"],g:[{type:"textline",b:["vJ","=","vm",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vK"],g:[{type:"textline",
b:["vK","=","vo",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vM"],g:[{type:"textline",b:["vM","=","vq",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vL"],g:[{type:"textline",b:["vL","=","vr",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vN"],g:[{type:"textline",b:["vN","=","vs",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vO"],g:[{type:"textline",b:["vO","=","vt",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vP"],
g:[{type:"textline",b:["vP","=","vu",";"]}]}]}]},{type:"node",name:"LIGHTING_AMBIENT",h:[{type:"node_in",name:"vQ",qualifier:["vec3"],e:!1},{type:"node_in",name:"vR",qualifier:["vec3"],e:!1},{type:"node_in",name:"vS",qualifier:["vec3"],e:!1},{type:"node_out",name:"vT",qualifier:["vec4"],e:!1},{type:"node_out",name:"vU",qualifier:["vec3"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["SHADELESS_MAT",{type:"logic_negative_expr",d:1},"NODES_GLOW",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",
d:2}],g:[{type:"textline",b:"vT = vec4 ( vQ + vS * vR , vf ) ; vU = vec3 ( vf ) ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"vT = vec4 ( vS , vf ) ; vU = vi ;".split(" ")}]}]}]},{type:"node",name:"LIGHTING_LAMP",h:[{type:"node_in",name:"vV",qualifier:["float"],e:!1},{type:"node_out",name:"vW",qualifier:["vec3"],e:!1},{type:"node_out",name:"vX",qualifier:["vec2"],e:!1},{type:"node_out",name:"vY",qualifier:["vec3"],e:!1},{type:"node_out",name:"vZ",qualifier:["float"],e:!1}],g:[{type:"node_condition",
a:[{type:"node_if",c:["NODES_GLOW",{type:"logic_negative_expr",d:1},"NUM_LIGHTS",0,{type:"g_expr",d:2},{type:"logical_and_expr",d:2}],g:[{type:"textline",b:"vX = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","HEMI",{type:"equal_expr",d:2}],g:[{type:"textline",b:["vZ","=","vh",";"]}]},{type:"node_else",g:[{type:"textline",b:["vZ","=","vf",";"]}]}]},{type:"textline",b:"vY = u_light_color_intensities [ LAMP_IND ] ; if ( LAMP_SHADOW_MAP_IND != - 1 ) vY *= vV ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2},"LAMP_TYPE","POINT",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],g:[{type:"textline",b:"vE = u_light_positions [ LAMP_IND ] ; vW = vE - vn ;".split(" ")},{type:"textline",b:"vx = length ( vW ) ; vY *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + vx * vx ) ; vW = normalize ( vW ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2}],g:[{type:"textline",b:"vE = u_light_directions [ LAMP_IND ] ; vx = dot ( vW , vE ) ; vx *= smoothstep ( vf , vg , ( vx - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; vY *= vx ;".split(" ")}]}]}]},
{type:"node_else",g:[{type:"textline",b:"vW = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",h:[{type:"node_in",name:"v_",qualifier:["vec3"],e:!1},{type:"node_in",name:"wa",qualifier:["vec2"],e:!1},{type:"node_in",name:"wb",qualifier:["vec3"],e:!1},{type:"node_in",name:"wc",qualifier:["float"],e:!1},{type:"node_in",name:"wd",qualifier:["vec2"],e:!1},{type:"node_out",name:"we",qualifier:["float"],e:!1}],g:[{type:"textline",b:"we = vf ; if ( wa . r != vf ) { vx = ( vg - wc ) * dot ( wb , v_ ) + wc ; if ( wd [ 0 ] == vf ) { we = vg ; } else { vx = vg + abs ( vx ) ; vx = wd [ 1 ] + ( vg - wd [ 1 ] ) * pow ( vx , wd [ 0 ] ) ; we = clamp ( vx , vf , vg ) ; } we = max ( we , vf ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_LAMBERT",h:[{type:"node_in",name:"wf",qualifier:["vec3"],e:!1},{type:"node_in",name:"wg",qualifier:["vec2"],e:!1},{type:"node_in",name:"wh",qualifier:["vec3"],e:!1},{type:"node_in",name:"wi",qualifier:["float"],e:!1},{type:"node_out",name:"wj",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wj = vf ; if ( wg . r != vf ) { vx = ( vg - wi ) * dot ( wh , wf ) + wi ; wj = max ( vx , vf ) ; }".split(" ")}]},{type:"node",name:"DIFFUSE_OREN_NAYAR",h:[{type:"node_in",name:"wk",
qualifier:["vec3"],e:!1},{type:"node_in",name:"wl",qualifier:["vec2"],e:!1},{type:"node_in",name:"wm",qualifier:["vec3"],e:!1},{type:"node_in",name:"wn",qualifier:["float"],e:!1},{type:"node_in",name:"wo",qualifier:["vec2"],e:!1},{type:"node_out",name:"wp",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wp = vf ; if ( wl . r != vf ) { vx = ( vg - wn ) * dot ( wm , wk ) + wn ; if ( wo [ 0 ] > vf ) { vy = max ( dot ( wm , vp ) , vf ) ; vz = wo [ 0 ] * wo [ 0 ] ; vA = vg - vh * ( vz / ( vz + 0.33 ) ) ; vE = wk - vx * wm ; vF = vp - vy * wm ;".split(" ")},
{type:"textline",b:"if ( length ( vE ) == vf || length ( vF ) == vf || abs ( vx ) > vg || abs ( vy ) > vg )".split(" ")},{type:"textline",b:"wp = vx * vA ; else { vB = acos ( vx ) ; vy = acos ( vy ) ; vE = normalize ( vE ) ; vF = normalize ( vF ) ; vC = max ( vB , vy ) ; vD = min ( vB , vy ) ; vD *= 0.95 ; vy = max ( dot ( vE , vF ) , vf ) ; vz = 0.45 * ( vz / ( vz + 0.09 ) ) ; wp = vx * ( vA + ( vz * vy * sin ( vC ) * tan ( vD ) ) ) ; } } else wp = vx ; wp = max ( wp , vf ) ; }".split(" ")}]},{type:"node",
name:"DIFFUSE_MINNAERT",h:[{type:"node_in",name:"wq",qualifier:["vec3"],e:!1},{type:"node_in",name:"wr",qualifier:["vec2"],e:!1},{type:"node_in",name:"ws",qualifier:["vec3"],e:!1},{type:"node_in",name:"wt",qualifier:["float"],e:!1},{type:"node_in",name:"wu",qualifier:["vec2"],e:!1},{type:"node_out",name:"wv",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wv = vf ; if ( wr . r != vf ) { vx = ( vg - wt ) * dot ( ws , wq ) + wt ; vD = max ( dot ( ws , vp ) , vf ) ; if ( wu [ 0 ] <= vg ) wv = vx * pow ( max ( vD * vx , 0.1 ) , wu [ 0 ] - vg ) ; else wv = vx * pow ( 1.0001 - vD , wu [ 0 ] - vg ) ; wv = max ( wv , vf ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",h:[{type:"node_in",name:"ww",qualifier:["vec3"],e:!1},{type:"node_in",name:"wx",qualifier:["vec2"],e:!1},{type:"node_in",name:"wy",qualifier:["vec3"],e:!1},{type:"node_in",name:"wz",qualifier:["float"],e:!1},{type:"node_in",name:"wA",qualifier:["vec2"],e:!1},{type:"node_out",name:"wB",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wB = vf ; if ( wx . r != vf ) { vD = ( vg - wz ) * dot ( wy , ww ) + wz ; vD = acos ( vD ) ; if ( vD < wA [ 0 ] ) wB = vg ; else if ( vD > ( wA [ 0 ] + wA [ 1 ] ) || wA [ 1 ] == vf ) wB = vf ; else wB = vg - ( ( vD - wA [ 0 ] ) / wA [ 1 ] ) ; wB = max ( wB , vf ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",h:[{type:"node_in",name:"wC",qualifier:["vec3"],e:!1},{type:"node_in",name:"wD",qualifier:["vec2"],e:!1},{type:"node_in",name:"wE",qualifier:["vec3"],e:!1},{type:"node_in",name:"wF",qualifier:["float"],e:!1},{type:"node_in",name:"wG",qualifier:["vec2"],e:!1},{type:"node_out",name:"wH",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wH = vf ; if ( wD . g != vf ) { vF = normalize ( wC + vp ) ; wH = ( vg - wF ) * max ( dot ( wE , vF ) , vf ) + wF ; wH = pow ( wH , wG [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",h:[{type:"node_in",name:"wI",qualifier:["vec3"],e:!1},{type:"node_in",name:"wJ",qualifier:["vec2"],e:!1},{type:"node_in",name:"wK",qualifier:["vec3"],e:!1},{type:"node_in",name:"wL",qualifier:["vec2"],e:!1},{type:"node_out",name:"wM",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wM = vf ; if ( wJ . g != vf ) { vF = normalize ( wI + vp ) ; vD = max ( dot ( wK , vF ) , 0.001 ) ;".split(" ")},{type:"textline",b:"vx = max ( dot ( wK , vp ) , 0.01 ) ; vC = max ( dot ( wK , wI ) , 0.01 ) ; vD = tan ( acos ( vD ) ) ; vy = max ( wL [ 0 ] , 0.001 ) ; wM = vC * ( vg / ( 4.0 * M_PI * vy * vy ) ) * ( exp ( - ( vD * vD ) / ( vy * vy ) ) / ( sqrt ( vx * vC ) ) ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_TOON",h:[{type:"node_in",name:"wN",qualifier:["vec3"],e:!1},{type:"node_in",name:"wO",qualifier:["vec2"],e:!1},{type:"node_in",name:"wP",qualifier:["vec3"],e:!1},{type:"node_in",name:"wQ",qualifier:["vec2"],e:!1},{type:"node_out",name:"wR",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wR = vf ; if ( wO . g != vf ) { vF = normalize ( wN + vp ) ; vC = acos ( dot ( vF , wP ) ) ; if ( vC < wQ [ 0 ] ) wR = vg ; else if ( vC >= wQ [ 0 ] + wQ [ 1 ] || wQ [ 1 ] == vf ) wR = vf ; else wR = vg - ( vC - wQ [ 0 ] ) / wQ [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",h:[{type:"node_in",name:"wS",qualifier:["vec3"],e:!1},{type:"node_in",name:"wT",qualifier:["vec2"],e:!1},{type:"node_in",name:"wU",qualifier:["vec3"],e:!1},{type:"node_in",name:"wV",qualifier:["float"],e:!1},{type:"node_in",name:"wW",qualifier:["vec2"],e:!1},{type:"node_out",name:"wX",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wX = vf ; if ( wT . g != vf ) { if ( wW [ 0 ] < 1.0 || wW [ 1 ] == vf ) wX = vf ; else { if ( wW [ 1 ] < 100.0 ) wW [ 1 ] = sqrt ( 1.0 / wW [ 1 ] ) ; else wW [ 1 ] = 10.0 / wW [ 1 ] ; vF = normalize ( vp + wS ) ; vC = ( vg - wV ) * max ( dot ( wU , vF ) , vf ) + wV ; if ( vC < vf ) wX = vf ; else { vx = max ( dot ( wU , vp ) , 0.01 ) ; vy = dot ( wU , wS ) ; if ( vy <= 0.01 ) wX = vf ; else { vD = max ( dot ( vp , vF ) , 0.01 ) ; vz = vg ; vx = ( 2.0 * vC * vx ) / vD ; vy = ( 2.0 * vC * vy ) / vD ; vy = min ( min ( vz , vx ) , vy ) ; vx = sqrt ( pow ( wW [ 0 ] , 2.0 ) + pow ( vD , 2.0 ) - vg ) ; vD = pow ( vx - vD , 2.0 ) / pow ( vx + vD , 2.0 ) * ( vg + pow ( vD * ( vx + vD ) - vg , 2.0 ) / pow ( vD * ( vx - vD ) + vg , 2.0 ) ) ; vC = acos ( vC ) ; wX = max ( vD * vy * exp ( - pow ( vC , 2.0 ) / ( 2.0 * pow ( wW [ 1 ] , 2.0 ) ) ) , vf ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",h:[{type:"node_in",name:"wY",qualifier:["vec4"],e:!1},{type:"node_in",name:"wZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"w_",qualifier:["float"],e:!1},{type:"node_in",name:"xa",qualifier:["float"],e:!1},{type:"node_in",name:"xb",qualifier:["vec3"],e:!1},{type:"node_in",name:"xc",qualifier:["vec3"],e:!1},{type:"node_in",name:"xd",qualifier:["vec4"],e:!1},{type:"node_in",name:"xe",qualifier:["vec3"],e:!1},{type:"node_in",name:"xf",qualifier:["vec3"],e:!1},{type:"node_in",
name:"xg",qualifier:["vec3"],e:!1},{type:"node_in",name:"xh",qualifier:["float"],e:!1},{type:"node_out",name:"xi",qualifier:["vec4"],e:!1},{type:"node_out",name:"xj",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"xj = wZ + xg * xf * xa ; xi = wY + vec4 ( xg * xe * w_ , xa ) ;".split(" ")}]},{type:"node",name:"LIGHTING_END",h:[{type:"node_in",name:"xk",qualifier:["vec4"],e:!1},{type:"node_in",name:"xl",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"vv = xk . rgb ; vw = xl ;".split(" ")}]},{type:"nodes_global"},
{type:"textline",b:"void xm ( vec3 vj , vec3 vk , vec3 vl , vec3 vm , vec3 vn , vec3 vo , vec3 vp , vec2 vq , vec2 vr , float vs , float vt , vec4 vu , out vec3 vv , out vec3 vw ) { float vx , vy , vz , vA , vB , vC , vD ; vec3 vE , vF ;".split(" ")},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct xp { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",
a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void xv ( inout float xq , float xr , vec2 xs , vec2 xt ) { float xu ; xu = xt . x - xs . x ; xu = ( xr - xs . x ) / xu ; xq = mix ( xq , xt . y , clamp ( xu , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void xB ( inout vec3 xw , float xx , vec4 xy , vec4 xz ) { float xA ; xA = xz . x - xy . x ; xA = ( xx - xy . x ) / xA ; xw = mix ( xw , xz . yzw , clamp ( xA , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float xH ( float xC , float xD , vec2 xE [ SIZE_RAMP_LENGTH ] ) { float xF , xG ; xF = xC / xD ; xG = xE [ 0 ] . y ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xv ( xG , xF , xE [ 0 ] , xE [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",2,{type:"g_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"xv ( xG , xF , xE [ 1 ] , xE [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xv ( xG , xF , xE [ 2 ] , xE [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","xG",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 xN ( float xI , float xJ , vec4 xK [ COLOR_RAMP_LENGTH ] ) { vec3 xL ; float xM ; xM = xI / xJ ; xL = xK [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xB ( xL , xM , xK [ 0 ] , xK [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xB ( xL , xM , xK [ 1 ] , xK [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xB ( xL , xM , xK [ 2 ] , xK [ 3 ] ) ;".split(" ")}]}}]},
{type:"textline",b:["return","xL",";","}"]}]}}]},{type:"textline",b:"float xV ( float xO , float xP , float xQ , float xR ) { float xS , xT , xU ; xS = max ( 0.01 , min ( xP , xQ ) ) ; xT = max ( 0.01 , min ( xP , xR ) ) ; xU = xP - xT ; xT = clamp ( xO / xS , 0.0 , 1.0 ) - step ( xU , xO ) * ( xO - xU ) / xT ; return xT ; } xp ya ( ) { vec3 xW , xX ; float xY , xZ ; xp x_ ; if ( u_p_cyclic == 1 ) { xY = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( xY < 0.0 ) xY += u_p_length ; } if ( u_p_cyclic != 1 ) { xY = u_p_time - a_p_delay ; } if ( xY < 0.0 || xY >= a_p_lifetime ) { x_ . a = 0.0001 ; x_ . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( xY < 0.0 || xY >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"xW = a_position ; xX = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xW = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; xX = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"xW += u_p_nfactor * xY * xX ; xW += a_p_vels . xyz * xY ; xW . y -= u_p_gravity * xY * xY / 2.0 ; xZ = max ( u_p_mass , EPSILON ) ; xW += ( u_p_wind_fac * u_wind / xZ ) * xY * xY / 2.0 ; x_ . b = xW ; x_ . e = a_p_vels . w * xY ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"x_ . a = xH ( xY , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"x_ . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"x_ . d = xN ( xY , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"x_ . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"x_ . c = xV ( xY , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return x_ ; }".split(" ")}]};a["include/blending.glslf"]={type:"group",a:[{type:"textline",b:"float yc = 0.0 ; float yd = 1.0 ; vec3 ye = vec3 ( yc ) ; vec3 yf = vec3 ( yd ) ; vec3 yk ( vec3 yg ) { float yh , yi ; vec4 yj ; yj = vec4 ( yc , - yd / 3.0 , 2.0 / 3.0 , - yd ) ; yj = mix ( vec4 ( yg . bg , yj . wz ) , vec4 ( yg . gb , yj . xy ) , step ( yg . b , yg . g ) ) ; yj = mix ( vec4 ( yj . xyw , yg . r ) , vec4 ( yg . r , yj . yzx ) , step ( yj . x , yg . r ) ) ; yh = yj . x - min ( yj . w , yj . y ) ; yi = 1.0e-10 ; return vec3 ( abs ( yj . z + ( yj . w - yj . y ) / ( 6.0 * yh + yi ) ) , yh / ( yj . x + yi ) , yj . x ) ; } vec3 yo ( vec3 yl ) { vec3 ym ; vec4 yn ; yn = vec4 ( yd , 2.0 / 3.0 , yd / 3.0 , 3.0 ) ; ym = abs ( fract ( vec3 ( yl . r , yl . r , yl . r ) + yn . xyz ) * 6.0 - yn . www ) ; return yl . b * mix ( yn . xxx , clamp ( ym - yn . xxx , yc , yd ) , yl . g ) ; } vec3 ys ( vec3 yp , vec3 yq , float yr ) { return mix ( yp , yq , yr ) ; } vec3 yw ( vec3 yt , vec3 yu , float yv ) { return yv * yt + yu ; } vec3 yA ( vec3 yx , vec3 yy , float yz ) { return yy - yz * yx ; } vec3 yF ( vec3 yB , vec3 yC , float yD ) { float yE ; yE = yd - yD ; return ( vec3 ( yE ) + yD * yB ) * yC ; } vec3 yK ( vec3 yG , vec3 yH , float yI ) { vec3 yJ ; yJ = vec3 ( yd - yI ) ; return yf - ( yJ + yI * ( yf - yG ) ) * ( yf - yH ) ; } vec3 yP ( vec3 yL , vec3 yM , float yN ) { vec3 yO ; yO = vec3 ( yd - yN ) ; return mix ( yM * ( yO + 2.0 * yN * yL ) , yf - ( yO + 2.0 * yN * ( yf - yL ) ) * ( yf - yM ) , step ( 0.5 , yM ) ) ; } vec3 yT ( vec3 yQ , vec3 yR , float yS ) { return mix ( yR , abs ( yQ - yR ) , yS ) ; } vec3 yX ( vec3 yU , vec3 yV , float yW ) { return mix ( yV , yV / ( yU + step ( yU , ye ) ) , yW ) ; } vec3 za ( vec3 yY , vec3 yZ , float y_ ) { return mix ( yZ , min ( yY , yZ ) , y_ ) ; } vec3 ze ( vec3 zb , vec3 zc , float zd ) { return max ( zd * zb , zc ) ; } vec3 zk ( vec3 zf , vec3 zg , float zh ) { vec3 zi , zj ; zi = yk ( zg ) ; if ( zi . y != yc ) { zj = yk ( zf ) ; zj = yo ( vec3 ( zi . x , zj . yz ) ) ; return mix ( zf , zj , zh ) ; } return zf ; } vec3 zq ( vec3 zl , vec3 zm , float zn ) { vec3 zo , zp ; zo = yk ( zl ) ; if ( zo . y != yc ) { zp = yk ( zm ) ; return yo ( vec3 ( zo . x , mix ( zo . y , zp . y , zn ) , zo . z ) ) ; } return zl ; } vec3 zw ( vec3 zr , vec3 zs , float zt ) { vec3 zu , zv ; zu = yk ( zr ) ; zv = yk ( zs ) ; return yo ( vec3 ( zu . xy , mix ( zu . z , zv . z , zt ) ) ) ; } vec3 zC ( vec3 zx , vec3 zy , float zz ) { vec3 zA , zB ; zA = yk ( zy ) ; if ( zA . y != yc ) { zB = yk ( zx ) ; zB = yo ( vec3 ( zA . xy , zB . z ) ) ; return mix ( zx , zB , zz ) ; } return zx ; } vec3 zH ( vec3 zD , vec3 zE , float zF ) { vec3 zG ; zG = yf - ( yf - zE ) * ( yf - zD ) ; return mix ( zD , ( ( yf - zD ) * zE * zD ) + zD * zG , zF ) ; } vec3 zL ( vec3 zI , vec3 zJ , float zK ) { return zI + zK * ( 2.0 * zJ - yd ) ; } float zR ( float zM , float zN , float zO , float zP ) { float zQ ; zQ = yd - zP ; return ( zQ + zO * zM ) * zN ; } float zX ( float zS , float zT , float zU , float zV ) { float zW ; zW = yd - zV ; return yd - ( zW + zU * ( yd - zS ) ) * ( yd - zT ) ; } float Ac ( float zY , float zZ , float z_ , float Aa ) { float Ab ; Ab = yd - Aa ; return mix ( zZ * ( Ab + 2.0 * z_ * zY ) , yd - ( Ab + 2.0 * z_ * ( yd - zY ) ) * ( yd - zZ ) , step ( 0.5 , zZ ) ) ; }".split(" ")}]};
a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float Ao ( in sampler2D Ai , in vec2 Aj , in vec2 Ak ) { float Al , Am , An ; Al = texture2D ( Ai , Aj ) . r ; Am = Ak . x ; An = Ak . y ; Am = 2.0 * Am / ( Am + An - ( 2.0 * Al - 1.0 ) * ( An - Am ) ) ; return Am ; }".split(" ")}]}};b4w.module.animation=function(a,r){var d=r("__animation"),c=r("__constraints");r("__physics");var b=r("__print"),l=r("__util");a.SLOT_0=d.SLOT_0;a.SLOT_1=d.SLOT_1;a.SLOT_2=d.SLOT_2;a.SLOT_3=d.SLOT_3;a.SLOT_4=d.SLOT_4;a.SLOT_5=d.SLOT_5;a.SLOT_6=d.SLOT_6;a.SLOT_7=d.SLOT_7;a.SLOT_ALL=d.SLOT_ALL;a.OBJ_ANIM_TYPE_NONE=d.OBJ_ANIM_TYPE_NONE;a.OBJ_ANIM_TYPE_ARMATURE=d.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=d.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=d.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=d.OBJ_ANIM_TYPE_SOUND;
a.OBJ_ANIM_TYPE_PARTICLES=d.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=d.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=d.AB_CYCLIC;a.AB_FINISH_RESET=d.AB_FINISH_RESET;a.AB_FINISH_STOP=d.AB_FINISH_STOP;var f=new Float32Array(4);a.is_animated=function(a){return d.is_animated(a)};a.get_actions=function(){b.error("get_actions() deprecated, use get_anim_names() instead");for(var a=[],c=d.Nr(),f=0;f<c.length;f++)a.push(d.nD(c[f].name));return a};a.get_current_action=function(c,d){b.error("get_current_action() deprecated, use get_current_anim_name() instead");
return a.get_current_anim_name(c,d)};a.get_anim_names=function(a){return d.et(a)?d.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!d.is_animated(a))return null;b=b||d.SLOT_0;return d.Kz(a,b)};a.apply=function(a,c,f){if(f>d.SLOT_7)b.error("Can't apply animation to slot "+f+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{f=f||d.SLOT_0;if(d.is_animated(a)){var e=d.get_slot_num_by_anim(a,c);if(-1!=e&&e!=f){b.error('Animation "'+c+'" is already applied to object "'+
a.name+'" (slot "'+e+'").');return}}d.wE(a,c)?d.apply(a,c,f):b.error('No fcurves in action "'+c+'"')}};a.remove=function(a){d.remove(a)};a.remove_slot_animation=function(a,b){d.is_animated(a)&&(b=b||d.SLOT_0,d.remove_slot_animation(a,b))};a.apply_def=function(a){d.apply_def(a)};a.play=function(a,c,f){d.is_animated(a)?(f=f||d.SLOT_0,d.play(a,c,f),d.update_object_animation(a,0,f,!0)):b.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){d.is_animated(a)&&(b=b||d.SLOT_0,d.stop(a,
b))};a.is_play=function(a,b){if(!d.is_animated(a))return!1;b=b||d.SLOT_0;return d.is_play(a,b)};a.set_current_frame_float=function(c,d,f){b.error("set_current_frame_float() deprecated, use set_frame() instead");a.set_frame(c,d,f)};a.get_current_frame_float=function(c,d){b.error("get_current_frame_float() deprecated, use get_frame() instead");return a.get_frame(c,d)};a.set_frame=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_frame(a,b,c))};a.set_first_frame=function(a,b){if(d.is_animated(a)){b=
b||d.SLOT_0;var c=d.get_anim_start_frame(a,b);d.set_frame(a,c,b)}};a.set_last_frame=function(a,b){if(d.is_animated(a)){b=b||d.SLOT_0;var c=d.get_anim_start_frame(a,b),e=d.get_anim_length(a,b);d.set_frame(a,c+e-d.uv,b)}};a.get_frame=function(a,b){if(!d.is_animated(a))return 0;b=b||d.SLOT_0;return d.get_current_frame_float(a,b)};a.set_speed=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_speed(a,b||1,c))};a.get_speed=function(a,b){if(!d.is_animated(a))return 0;b=b||d.SLOT_0;return a.H[b]?d.get_speed(a,
b):0};a.get_frame_range=function(a,c){b.error("get_frame_range() deprecated, use get_anim_start_frame() and get_anim_length() instead");if(d.is_animated(a)){c=c||d.SLOT_0;var f=a.H[c];if(f)return[f.start,f.start+f.length]}return null};a.get_anim_start_frame=function(a,b){return d.is_animated(a)&&(b=b||d.SLOT_0,a.H[b])?d.get_anim_start_frame(a,b):-1};a.get_anim_length=function(a,b){return d.is_animated(a)&&(b=b||d.SLOT_0,a.H[b])?d.get_anim_length(a,b):-1};a.cyclic=function(c,f,l){b.error("cyclic() deprecated, use set_behavior() instead");
a.set_behavior(c,f?d.AB_CYCLIC:d.AB_FINISH_RESET,l)};a.is_cyclic=function(a,c){b.error("is_cyclic() deprecated, use get_behavior() instead");if(!d.is_animated(a))return!1;c=c||d.SLOT_0;return d.is_cyclic(a,c)};a.set_behavior=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_behavior(a,b,c))};a.get_behavior=function(a,b){if(!d.is_animated(a))return null;b=b||d.SLOT_0;return d.get_behavior(a,b)};a.apply_smoothing=function(a,b,c,e){e=e||d.SLOT_0;d.is_animated(a)&&d.apply_smoothing(a,b,c,e)};a.update_object_animation=
function(a,b,c,e){d.is_animated(a)&&(c=c||d.SLOT_0,d.update_object_animation(a,b||0,c,e||!1))};a.frame_to_sec=function(a){return d.frame_to_sec(a)};a.get_bone_translation=function(a,b,d){if(!l.is_armature(a))return null;d||(d=new Float32Array(3));c.Oz(a,b,!1,f,null);d[0]=f[0];d[1]=f[1];d[2]=f[2];return d};a.get_first_armature_object=function(){b.error("get_first_armature_object() deprecated");return null};a.get_slot_num_by_anim=function(a,b){return d.is_animated(a)&&b?d.get_slot_num_by_anim(a,b):
null};a.get_anim_type=function(a,b){return d.is_animated(a)?d.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return d.apply_to_first_empty_slot(a,b)};a.get_skel_mix_factor=function(a){return a.f.Ze};a.set_skel_mix_factor=function(a,c,f){l.is_armature(a)?(c=Math.min(Math.max(c,0),1),a.f.Ze!=c&&d.set_skel_mix_factor(a,c,f||0)):b.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,r){var d=r("__anchors");r("__print");a.attach_move_cb=d.attach_move_cb;a.detach_move_cb=d.detach_move_cb;a.is_anchor=d.is_anchor;a.get_element_id=d.get_element_id};b4w.module.assets=function(a,r){var d=r("__assets");a.AT_ARRAYBUFFER=d.AT_ARRAYBUFFER;a.AT_JSON=d.AT_JSON;a.AT_TEXT=d.AT_TEXT;a.AT_AUDIOBUFFER=d.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=d.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=d.AT_AUDIO_ELEMENT;a.enqueue=function(a,b,l){d.enqueue(a,b,l)}};b4w.module.camera=function(a,r){function d(a,c){if(b.is_camera(a))return c||(c=new Float32Array(3)),n.copy(a.f.i,c),c;e.error("get_eye(): Wrong object")}function c(a,c){b.is_target_camera(a)?(n.copy(c,a.f.Ub),g.p(a),p.sync_transform(a)):e.error("set_pivot(): Wrong object or camera move style")}var b=r("__camera");r("__config");var l=r("__constraints"),f=r("__container"),m=r("__mat3"),k=r("__mat4"),p=r("__physics"),e=r("__print"),g=r("__transform"),h=r("__util"),n=r("__vec3"),C=r("__vec4"),G=new Float32Array(2),
F=new Float32Array(3),E=new Float32Array(3),u=new Float32Array(4),B=new Float32Array(9);a.MS_STATIC=b.MS_STATIC;a.MS_ANIMATION=b.MS_STATIC;a.MS_TARGET_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=b.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=b.MS_HOVER_CONTROLS;a.is_camera=b.is_camera;a.is_target_camera=b.is_target_camera;a.is_eye_camera=b.is_eye_camera;a.is_hover_camera=b.is_hover_camera;a.set_move_style=function(a,c){if(!b.is_camera(a))return e.error("set_move_style(): Wrong object"),!1;if(c!=b.MS_STATIC&&
c!=b.MS_EYE_CONTROLS&&c!=b.MS_HOVER_CONTROLS&&c!=b.MS_TARGET_CONTROLS)return e.error("set_move_style(): Wrong camera move style"),!1;a.f.Ba=c;a.f.cc=null;a.f.ic=null;a.f.Fb=null;a.f.ib=!1;b.wA(a);switch(c){case b.MS_TARGET_CONTROLS:var f=d(a,F),k=h.quat_to_dir(a.f.quat,h.AXIS_MY,E),f=n.scaleAndAdd(f,k,10,k);n.copy(f,a.f.Ub)}g.p(a);p.sync_transform(a);return!0};a.get_move_style=function(a){return b.is_camera(a)?b.get_move_style(a):(e.error("get_move_style(): Wrong object"),null)};a.set_velocity_params=
function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return e.error("set_velocity_params(): Wrong object or camera move style"),null;var d=a.f;d.Lp=h.clamp(c[0],0,Infinity);d.Kp=h.clamp(c[1],0,Infinity);d.Mp=h.clamp(c[2],0,1)};a.get_velocity_params=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return e.error("get_velocity_params(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));var d=a.f;c[0]=d.Lp;c[1]=d.Kp;
c[2]=d.Mp;return c};a.set_look_at=function(a,c,d,e){var f=a.f;b.kz(c,d,e,f.i,f.quat);g.p(a);p.sync_transform(a)};a.get_eye=d;a.set_pivot=c;a.set_trans_pivot=function(a,c,d){b.is_target_camera(a)?(n.copy(c,a.f.i),n.copy(d,a.f.Ub),g.p(a),p.sync_transform(a)):e.error("set_trans_pivot(): Wrong object or camera move style")};a.get_pivot=function(a,c){if(b.is_target_camera(a))return c||(c=new Float32Array(3)),n.copy(a.f.Ub,c),c;e.error("get_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(b,
c,d){e.error("rotate_pivot() deprecated, use rotate_camera() or rotate_target_camera() instead");a.rotate_target_camera(b,c,d)};a.move_pivot=function(a,c,d){if(b.is_target_camera(a)){var f=a.f;if(f.Iu){var h=m.fromMat4(f.Y,B),k=n.subtract(f.i,f.Ub,E);F[0]=c;F[1]=0;F[2]=d;n.scale(F,n.len(k),F);n.transformMat3(F,h,F);n.add(f.Ub,F,f.Ub);n.add(f.i,F,f.i);g.p(a);p.sync_transform(a)}}else e.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(b,c){e.error("rotate_hover_cam() deprecated, use rotate_camera() or rotate_hover_camera() instead");
a.rotate_hover_camera(b,c,0)};a.get_hover_cam_angle=function(a){e.error("get_hover_cam_angle() deprecated, use get_camera_angles() instead");return b.is_hover_camera(a)?-b.get_camera_angles(a,G)[1]:(e.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.set_hover_cam_angle=function(a,c){e.error("set_hover_cam_angle() deprecated, use rotate_camera() or rotate_hover_camera() instead");if(b.is_hover_camera(a))if(a.f.ib){var d=b.get_camera_angles(a,G);(d=-c-d[1])&&b.rotate_hover_camera(a,
0,d);g.p(a);p.sync_transform(a)}else e.error("set_hover_cam_angle(): distance/hover_angle limits are not defined or disabled");else e.error("set_hover_cam_angle(): wrong object or camera move style")};a.get_hover_angle_limits=function(a,c){if(b.is_hover_camera(a))return a.f.Fb?(c||(c=new Float32Array(2)),c[0]=a.f.Fb.Ua,c[1]=a.f.Fb.hb):e.error("get_hover_angle_limits(): camera hasn't angle limits"),c;e.error("get_hover_angle_limits(): wrong object")};a.get_cam_dist_limits=function(a,c){if(b.is_hover_camera(a)||
b.is_target_camera(a))return a.f.ib?(c||(c=new Float32Array(2)),c[0]=a.f.ng,c[1]=a.f.te):e.error("get_cam_dist_limits(): camera hasn't distance limits"),c;e.error("get_cam_dist_limits(): wrong object")};a.translate_hover_cam_v=function(b,c){e.error("translate_hover_cam_v() deprecated, use hover_cam_set_translation() instead");a.hover_cam_set_translation(b,c)};a.hover_cam_set_translation=function(a,c){if(b.is_hover_camera(a)){var d=a.f;if(d.ib){var f=n.subtract(c,d.i,F);n.add(f,d.dc,d.dc)}g.set_translation(a,
c);g.p(a);p.sync_transform(a)}else e.error("hover_cam_set_translation(): wrong object")};a.set_hover_pivot=function(a,c){if(b.is_hover_camera(a)){var d=a.f;if(d.ib&&d.Fb){var f=n.subtract(c,d.dc,F),f=n.add(f,d.i,f);g.set_translation(a,f)}n.copy(c,d.dc);g.p(a);p.sync_transform(a)}else e.error("set_hover_pivot(): Wrong object or camera move style")};a.get_hover_cam_pivot=function(a,c){if(!b.is_hover_camera(a))return e.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));n.copy(a.f.dc,
c);return c};a.has_distance_limits=function(a){return b.is_target_camera(a)||b.is_hover_camera(a)?a.f.ib:(e.error("has_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,c,d,f){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:f|=g.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>d){e.error("apply_vertical_limits(): wrong vertical limits");return}break;default:e.error("apply_vertical_limits(): wrong object");return}a.f.ic={Ua:c,hb:d};b.WB(a,f==g.SPACE_LOCAL);
g.p(a);p.sync_transform(a)};a.clear_vertical_limits=function(a){a.f.ic=null};a.get_vertical_limits=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return e.error("get_vertical_limits(): wrong object"),null;var d=a.f;c=c||new Float32Array(2);return d.ic?(c[0]=d.ic.Ua,c[1]=d.ic.hb,c):null};a.has_vertical_limits=function(a){if(b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a))return Boolean(a.f.ic);e.error("has_vertical_limits(): wrong object")};a.apply_horizontal_limits=
function(a,c,d,f){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:f|=g.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>d){e.error("apply_horizontal_limits(): wrong horizontal limits");return}break;default:e.error("apply_horizontal_limits(): wrong object");return}a.f.cc={left:c,right:d};b.SB(a,f==g.SPACE_LOCAL);g.p(a);p.sync_transform(a)};a.clear_horizontal_limits=function(a){a.f.cc=null};a.get_horizontal_limits=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&
!b.is_hover_camera(a))return e.error("get_horizontal_limits(): wrong object"),null;var d=a.f;c=c||new Float32Array(2);return d.cc?(c[0]=d.cc.left,c[1]=d.cc.right,c):null};a.has_horizontal_limits=function(a){if(b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a))return Boolean(a.f.cc);e.error("has_horizontal_limits(): wrong object")};a.apply_hover_angle_limits=function(a,c,d){b.is_hover_camera(a)?c<d?e.error("apply_hover_angle_limits(): wrong hover angle limits"):(c=h.angle_wrap_periodic(c,
-Math.PI,Math.PI),d=h.angle_wrap_periodic(d,-Math.PI,Math.PI),c=h.clamp(c,-Math.PI/2,0),d=h.clamp(d,-Math.PI/2,0),a.f.Fb={Ua:c,hb:d},b.vA(a),g.p(a),p.sync_transform(a)):e.error("apply_hover_angle_limits(): wrong object")};a.clear_hover_angle_limits=function(a){b.is_hover_camera(a)?a.f.Fb=null:e.error("clear_hover_angle_limits(): wrong object")};a.apply_distance_limits=function(a,c,d){if(b.is_target_camera(a)||b.is_hover_camera(a))if(c>d)e.error("apply_distance_limits(): wrong distance limits");else{var f=
a.f;f.ib=!0;f.te=c;f.ng=d;g.p(a);p.sync_transform(a)}else e.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){b.is_target_camera(a)||b.is_hover_camera(a)?a.f.ib=!1:e.error("clear_distance_limits(): wrong object")};a.set_eye_params=function(b,c,d){e.error("set_eye_params() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,Math.PI/2-d)};a.is_look_up=function(a){h.quat_to_dir(a.f.quat,h.AXIS_MY,F);return 0<=F[1]?!0:!1};a.rotate_camera=
function(c,d,f,h,k){switch(a.get_move_style(c)){case b.MS_STATIC:break;case b.MS_TARGET_CONTROLS:b.rotate_target_camera(c,d,f,h,k);break;case b.MS_EYE_CONTROLS:b.rotate_eye_camera(c,d,f,h,k);break;case b.MS_HOVER_CONTROLS:b.rotate_hover_camera(c,d,f,h,k);break;default:e.error("rotate_camera(): Wrong object")}g.p(c);p.sync_transform(c)};a.rotate_target_camera=function(a,c,d,f,h){b.is_target_camera(a)?(b.rotate_target_camera(a,c,d,f,h),g.p(a),p.sync_transform(a)):e.error("rotate_target_camera(): wrong object")};
a.rotate_eye_camera=function(a,c,d,f,h){b.is_eye_camera(a)?(b.rotate_eye_camera(a,c,d,f,h),g.p(a),p.sync_transform(a)):e.error("rotate_eye_camera(): wrong object")};a.rotate_hover_camera=function(a,c,d,f,h){b.is_hover_camera(a)?(b.rotate_hover_camera(a,c,d,f,h),g.p(a),p.sync_transform(a)):e.error("rotate_hover_camera(): wrong object")};a.rotate=function(b,c,d){e.error("rotate() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,-d)};a.get_camera_angles=function(a,
c){c||(c=new Float32Array(2));b.get_camera_angles(a,c);return c};a.get_camera_angles_char=function(a,c){c||(c=new Float32Array(2));b.get_camera_angles_char(a,c);return c};a.get_angles=function(a,c){e.error("get_angles() deprecated, use get_camera_angles() instead");c||(c=new Float32Array(2));b.get_angles(a,c);return c};a.set_stereo_distance=function(a,c){for(var d=a.f.L,e=0;e<d.length;e++){var f=d[e];f.type!=b.Bb&&f.type!=b.Gb||b.JC(f,c,f.$d)}};a.get_stereo_distance=function(a){a=a.f.L;for(var c=
0;c<a.length;c++){var d=a[c];if(d.type==b.Bb||d.type==b.Gb)return d.ck}return 0};a.is_underwater=function(a){e.error("is_underwater() deprecated, always returns false");return a.f.zu};a.translate_view=function(a,c,d,e){a=a.f.L;for(var f=0;f<a.length;f++){var g=a[f];g.fc||b.Ef(g,g.Ca);var h=F;h[0]=-c;h[1]=-d;h[2]=0;k.translate(g.za,h,g.za);k.rotateZ(g.za,e,g.za);k.multiply(g.za,g.ya,g.Ed);b.Iq(g);b.Ym(g)}};a.get_fov=function(a){return h.Xl(a.f.L[0].Ic)};a.set_fov=function(a,c){for(var d=a.f.L,e=0;e<
d.length;e++){var f=d[e];f.Ic=h.Ry(c);f.fc||b.Ef(f,f.Ca);k.multiply(f.za,f.ya,f.Ed);b.Iq(f);b.Ym(f)}};a.correct_up=function(a,b){b||(b=h.AXIS_Y);l.correct_up(a,b)};a.zoom_object=function(a,d){if(b.is_target_camera(a)){g.get_object_center(d,!1,F);c(a,F);g.p(a);var f=g.get_object_size(d),h=b.Jz(a)/2,f=f/Math.sin(h),h=g.DB(a,F);g.move_local(a,0,f-h,0);g.p(a);p.sync_transform(a)}else e.error("zoom_object(): wrong object")};a.set_ortho_scale=function(c,d){if(b.is_camera(c)&&a.is_ortho_camera(c)){var f=
c.f;if(b.is_target_camera(c)){var g=n.dist(f.i,f.Ub);f.Ph=d/2*f.Oh/g}else b.is_hover_camera(c)&&a.has_distance_limits(c)?(g=n.distance(f.i,f.dc),f.Ph=d/2*f.Oh/g):c.f.L[0].top=d/2;b.XD(c)}else e.error("set_ortho_scale(): wrong object")};a.get_ortho_scale=function(c){if(b.is_camera(c)&&a.is_ortho_camera(c))return 2*c.f.L[0].top;e.error("get_ortho_scale(): wrong object")};a.is_ortho_camera=function(a){if(b.is_camera(a))return a.f.L[0].type==b.Zc;e.error("is_ortho_camera(): wrong object")};a.calc_ray=
function(a,c,d,g){g||(g=new Float32Array(3));var h=a.f.L[0];switch(h.type){case b.Pb:case b.ge:case b.Bb:case b.Gb:var k=Math.tan(h.Ic*Math.PI/360),l=k*h.Ca;c=f.$m(c,d,G,h);u[0]=(2*c[0]/h.width-1)*l;u[1]=-1;u[2]=(2*c[1]/h.height-1)*k;u[3]=0;C.transformMat4(u,a.f.Y,u);g[0]=u[0];g[1]=u[1];g[2]=u[2];n.normalize(g,g);return g;default:return e.error("Non-compatible camera"),g}};a.project_point=function(a,c,d){d||(d=new Float32Array(2));return b.project_point(a,c,d)}};b4w.module.config=function(a,r){var d=r("__config");a.P_LOW=d.P_LOW;a.P_HIGH=d.P_HIGH;a.P_ULTRA=d.P_ULTRA;a.P_CUSTOM=d.P_CUSTOM;a.set=d.set;a.get=d.get;a.reset=d.reset;a.get_std_assets_path=d.get_std_assets_path};b4w.module.controls=function(a,r){var d=r("__controls"),c=r("__print");a.CT_CONTINUOUS=d.CT_CONTINUOUS;a.CT_TRIGGER=d.CT_TRIGGER;a.CT_SHOT=d.CT_SHOT;a.CT_LEVEL=d.CT_LEVEL;a.CT_CHANGE=d.CT_CHANGE;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_A=
65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;
a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=d.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=d.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=d.PL_MULTITOUCH_MOVE_PAN;a.create_custom_sensor=d.create_custom_sensor;a.create_keyboard_sensor=d.create_keyboard_sensor;a.create_collision_sensor=function(a,c,f){return d.create_collision_sensor(a,c||"ANY",
f||!1)};a.create_collision_impulse_sensor=d.create_collision_impulse_sensor;a.create_ray_sensor=function(a,c,f,m,k,p,e){return d.create_ray_sensor(a,c,f,m||"ANY",k||!1,p||!1,e||!1)};a.create_mouse_click_sensor=d.create_mouse_click_sensor;a.create_mouse_wheel_sensor=d.create_mouse_wheel_sensor;a.create_mouse_move_sensor=d.create_mouse_move_sensor;a.create_touch_move_sensor=d.create_touch_move_sensor;a.create_touch_zoom_sensor=d.create_touch_zoom_sensor;a.create_motion_sensor=d.create_motion_sensor;
a.create_vertical_velocity_sensor=d.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=d.create_gyro_angles_sensor;a.create_gyro_delta_sensor=d.create_gyro_delta_sensor;a.create_timer_sensor=function(a,c){return d.create_timer_sensor(a,c||!1)};a.reset_timer_sensor=d.reset_timer_sensor;a.create_elapsed_sensor=d.create_elapsed_sensor;a.create_timeline_sensor=d.create_timeline_sensor;a.create_selection_sensor=function(a,c){return d.create_selection_sensor(a,c||!1)};a.set_custom_sensor=function(a,
c){d.vC(a,c)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=d.get_sensor_value;a.get_sensor_payload=d.get_sensor_payload;a.create_sensor_manifold=function(a,c,f,m,k,p,e){k=k||d.or;d.create_sensor_manifold(a,c,f,m,k,p,void 0===e?null:e)};a.create_kb_sensor_manifold=function(a,c,f,m,k,p){m=d.create_keyboard_sensor(m);d.create_sensor_manifold(a,c,f,[m],d.or,k,void 0===p?null:p)};a.check_sensor_manifolds=function(a){return d.check_sensor_manifold(a,null)};a.check_sensor_manifold=
d.check_sensor_manifold;a.remove_sensor_manifolds=function(a){c.error("remove_sensor_manifolds() deprecated, use remove_sensor_manifold() instead");d.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=d.remove_sensor_manifold;a.reset=d.reset;a.register_keyboard_events=d.register_keyboard_events;a.register_mouse_events=function(a,c,f){d.register_mouse_events(a,c,!!f)};a.register_wheel_events=d.register_wheel_events;a.register_touch_events=d.register_touch_events;a.register_device_orientation=
d.register_device_orientation;a.unregister_keyboard_events=d.unregister_keyboard_events;a.unregister_mouse_events=d.unregister_mouse_events;a.unregister_wheel_events=d.unregister_wheel_events;a.unregister_touch_events=d.unregister_touch_events;a.unregister_device_orientation=d.unregister_device_orientation};b4w.module.constraints=function(a,r){var d=r("__camera"),c=r("__constraints"),b=r("__objects"),l=r("__physics"),f=r("__print"),m=r("__transform");a.append_stiff=function(a,b,d,f,h){h=h||1;b instanceof Array&&2==b.length?c.Sw(a,b[0],b[1],d,f,h):c.oq(a,b,d,f,h);m.p(a);l.sync_transform(a)};a.append_semi_stiff=function(a,b,d,f){c.Rw(a,b,d,f);m.p(a);l.sync_transform(a)};a.append_semi_stiff_cam=function(a,b,e,g,h,n,r,G){if(!d.is_eye_camera(a))return f.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented."),
null;c.Qw(a,b,e,g,h,n,r,G);m.p(a);l.sync_transform(a)};a.append_semi_soft_cam=function(a,b,e,g){if(!d.is_eye_camera(a))return f.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented."),null;if(!g||0>g)g=.25;c.Pw(a,b,e,g);m.p(a);l.sync_transform(a)};a.append_stiff_trans=function(a,b,d){c.Tw(a,b,d);m.p(a);l.sync_transform(a)};a.append_copy_trans=function(a,b,d){c.Kw(a,b,d);m.p(a);l.sync_transform(a)};a.append_stiff_trans_rot=function(a,b,d,f){c.Uw(a,b,d,f);m.p(a);
l.sync_transform(a)};a.append_track=function(a,b){3==b.length?c.Ww(a,b):c.Vw(a,b);m.p(a);l.sync_transform(a)};a.append_follow=function(a,b,d,f){3==b.length?c.Mw(a,b,d,f):c.Lw(a,b,d,f);m.p(a);l.sync_transform(a)};a.append_stiff_viewport=function(a,b,d){c.append_stiff_viewport(a,b,d);m.p(a);l.sync_transform(a)};a.remove=function(a){a.pb&&c.remove(a)};a.get_parent=function(a){f.error("constraints.get_parent() deprecated, use objects.get_parent() instead");return b.get_parent(a)}};b4w.module.container=function(a,r){var d=r("__container"),c=r("__print");a.get_canvas=d.get_canvas;a.get_container=d.get_container;a.insert_to_container=function(a,l){2!=arguments.length?c.error("insert_to_container(): two arguments required"):a&&l&&d.insert_to_container(a,l)};a.set_canvas_offsets=d.set_canvas_offsets;a.update_canvas_offsets=d.update_canvas_offsets;a.client_to_canvas_coords=d.client_to_canvas_coords;a.force_offsets_updating=d.force_offsets_updating};b4w.module.data=function(a,r){var d=r("__data");r("__print");r("__util");a.load=d.load;a.unload=function(a){d.unload(a|0)};a.set_debug_resources_root=d.set_debug_resources_root;a.is_primary_loaded=d.is_primary_loaded;a.load_and_add_new=d.load;a.cleanup=a.unload};b4w.module.debug=function(a,r){function d(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function c(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);c.send(b);
if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function b(a){a.sort(function(a,b){return b.Jn.ALU_OPS-a.Jn.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.Jn,e=c.CE,f=l(c.Gy),f=f?"\t\t("+f.join(", ")+")":"\t\t(NA)";h.groupCollapsed("FRAG --\x3e","ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",e.ALU_OPS,"TEX",e.TEX_OPS,f);h.groupCollapsed("directives");for(var f=c.Wa.hf,g=0;g<f.length;g++){var k=f[g];h.log(k[0],k[1])}h.groupEnd();h.groupCollapsed("vert src");
h.log(c.BE);h.groupEnd();h.groupCollapsed("vert stats");for(var m in e)"ALU_OPS"!=m&&"TEX_OPS"!=m&&h.log(m,e[m]);h.groupEnd();h.groupCollapsed("frag src");h.log(c.vz);h.groupEnd();h.groupCollapsed("frag stats");for(m in d)"ALU_OPS"!=m&&"TEX_OPS"!=m&&h.log(m,d[m]);h.groupEnd();h.groupEnd()}}function l(a){for(var b=n.Jh(),c=0;c<b.length;c++)for(var d=b[c],f=p.ma(d,"MESH",p.DATA_ID_ALL),g=0;g<f.length;g++){var h=e.Ha(f[g],d);if(h&&h.S.length)for(var h=h.S,k=0;k<h.length;k++){var l=h[k];if(l.hc==a&&l.Jc.length)return l.Jc}}return null}
r("__batch");r("__config");var f=r("__controls"),m=r("__debug"),k=r("__extensions"),p=r("__objects"),e=r("__obj_util"),g=r("__physics"),h=r("__print"),n=r("__scenes"),C=r("__scenegraph"),G=r("__sfx"),F=r("__shaders"),E=r("__textures"),u=r("__util"),B=r("vec3");a.physics_stats=function(){g.Ny()};a.physics_id=function(a){h.log("O",g.nz(a));for(var b=g.Iz().Ya.o,c=0;c<b.length;c++){var d=b[c];d.m.v==a&&h.log("B",d)}};a.visible_objects=function(){for(var a=n.get_active(),b=p.ma(a,"MESH",p.DATA_ID_ALL),
a=[n.da(a,"MAIN_OPAQUE"),n.da(a,"MAIN_BLEND")],c=0;c<a.length;c++){var d=a[c],e=d.o;if(e.length){h.group(d.type,"DYNAMIC");for(var f=0;f<b.length;f++){var g=b[f],k=g.f;if("DYNAMIC"==k.type)for(var l=0;l<e.length;l++){var m=e[l];if(m.bb&&m.xd==k){h.uo(g.name,g);break}}}h.groupEnd();h.groupCollapsed(d.type,"STATIC");for(f=0;f<b.length;f++)if(g=b[f],k=g.f,"DYNAMIC"!=k.type)for(l=0;l<e.length;l++)if(m=e[l],m.bb&&m.xd==k){h.uo(g.name,g);break}h.groupEnd()}}};a.object_info=function(a){for(var b=n.get_active(),
c=p.ma(b,"MESH",p.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];if(e.name==a){h.log("Object",e);for(var f=n.Nn(b),g=0;g<f.length;g++){for(var k=f[g],l=k.o,m=[],r=0;r<l.length;r++)l[r].xd==e.f&&m.push(l[r]);h.log("Subscene "+k.type,m)}}}};a.objects_stat=function(){var a=n.get_active();console.log("Armatures: "+p.ma(a,"ARMATURE",p.DATA_ID_ALL).length);console.log("Cameras: "+p.ma(a,"CAMERA",p.DATA_ID_ALL).length);console.log("Curves: "+p.ma(a,"CURVE",p.DATA_ID_ALL).length);console.log("Empties: "+p.ma(a,
"EMPTY",p.DATA_ID_ALL).length);console.log("Lamps: "+p.ma(a,"LAMP",p.DATA_ID_ALL).length);console.log("Meshes: "+p.ma(a,"MESH",p.DATA_ID_ALL).length);console.log("Speakers: "+p.ma(a,"SPEAKER",p.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=n.get_active(),b=[n.da(b,"MAIN_OPAQUE"),n.da(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.o,e=0;e<d.length;e++){var f=d[e].D;f&&(a+=f.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=n.get_active(),b=[n.da(b,
"MAIN_OPAQUE"),n.da(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.o,e=0;e<d.length;e++){var f=d[e].D;f&&(a+=f.num_triangles)}}return a};a.num_draw_calls=function(){for(var a=n.get_active(),b=[n.da(a,"MAIN_OPAQUE"),n.da(a,"MAIN_BLEND")],b=b[0].o.length+b[1].o.length,a=n.pu(a,["MAIN_PLANE_REFLECT","MAIN_CUBE_REFLECT"]),c=0;c<a.length;c++)var d=a[c],b="MAIN_PLANE_REFLECT"==d.type?b+d.o.length:b+6*d.o.length;return b};a.num_shaders=function(){return u.Rd(F.Rr())};a.geometry_stats=function(){for(var a=
n.get_active(),b=n.Nn(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.o,f=0;f<e.length;f++){var g=e[f].D,h=e[f].xd;g&&("COLOR_PICKING"!=d.type&&"OUTLINE_MASK"!=d.type||h.Ll||h.Kl)&&(a[g.id]=g)}}var e=d=c=b=0,k;for(k in a)g=a[k],g=g.P,g.$k&&(d++,e+=g.$k/1048576),b++,c+=g.nr/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=n.get_active(),c=[n.da(c,"MAIN_OPAQUE"),n.da(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=
c[d];if(e)for(var e=e.o,f=0;f<e.length;f++){var g=e[f].D;if(g)for(var g=g.R,h=0;h<g.length;h++){var k=g[h];if("IMAGE"===k.source||"ENVIRONMENT_MAP"===k.source){var l=k.jb;-1===a.indexOf(l)&&(a.push(l),k=k.width*k.height*4/1048576/k.gn,k*=1.3333,b+=k)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=n.get_active(),c=n.Nn(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var f=e.j,g=[f.ob,f.cd];g.push.apply(g,e.ae);for(e=0;e<g.length;e++){var h=g[e];E.Ej(h)&&
-1==a.indexOf(h)&&(a.push(h),b+=f.width*f.height*E.hA(h))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=n.get_active();(a=n.da(a,"MAIN_OPAQUE"))&&n.Ns(a.j,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=n.get_active(),b=n.da(a,"MAIN_OPAQUE"),a=n.pu(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}n.Ns(d.j,b,e)}};a.scenegraph_to_dot=function(){for(var a=
n.Jh(),b=0;b<a.length;b++)h.log("\n"+C.Ly(n.Vr(a[b])))};a.scenes_to_dot=function(){};a.controls_info=f.debug;a.object_distance=function(a,b){return B.dist(a.f.i,b.f.i)};a.msg=m.msg;a.fbmsg=m.fbmsg;a.print_telemetry=m.print_telemetry;a.plot_telemetry=m.plot_telemetry;a.fbres=function(a,b){function c(){m.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,
0,1]),f=new Float32Array([-1,0,0]),g=new Float32Array([0,-1,0]),h=new Float32Array([0,0,-1]);if(!u.df(a,u.tw))throw"Wrong VEC3_IDENT";if(!u.df(b,u.nw))throw"Wrong QUAT4_IDENT";if(!u.df(c,u.AXIS_X))throw"Wrong AXIS_X";if(!u.df(d,u.AXIS_Y))throw"Wrong AXIS_Y";if(!u.df(e,u.AXIS_Z))throw"Wrong AXIS_Z";if(!u.df(f,u.AXIS_MX))throw"Wrong AXIS_MX";if(!u.df(g,u.AXIS_MY))throw"Wrong AXIS_MY";if(!u.df(h,u.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=G.get_speaker_objects(),b=0;b<a.length;b++){var c=
a[b];"BACKGROUND_MUSIC"==G.Rn(c)&&G.mute(c,!0)}};a.check_finite=function(a){m.check_finite(a)};a.set_debug_params=function(a){var b=n.get_active();if(b=n.da(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&n.OC(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&n.NC(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return h.Vz()};a.get_warning_quantity=function(){return h.mA()};a.clear_errors_warnings=function(){return h.clear_errors_warnings()};
a.analyze_shaders=function(a){var e=F.Rr(),f=0,g;for(g in e)a&&-1===g.indexOf(a)||f++;var f="of "+f+" analyzing...",l={};for(g in e)if(!a||-1!==g.indexOf(a)){var m=e[g],n;var p=m.Op;n=m.Ir;var r=k.Sr();if(r){p=r.getTranslatedShaderSource(p);n=r.getTranslatedShaderSource(n);var r=c("/nvidia_vert",p),C=d(r),u=c("/nvidia_frag",n),G=d(u);n={BE:p,jH:r,CE:C,vz:n,XF:u,Jn:G}}else h.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),n=void 0;r=m.Wa;p=r.Gi+" + "+r.Gh;
n.Gy=m;n.Wa=r;m=l[p]=l[p]||[];m.push(n);h.log(f)}for(p in l)h.group("%c"+p,"color: #800"),m=l[p],b(m),h.groupEnd()}};b4w.module.geometry=function(a,r){var d=r("__batch"),c=r("__geometry"),b=r("__print"),l=r("__renderer");a.extract_vertex_array=function(a,l,k){if(!c.Lh(a))return b.error("Wrong object:",a.name),null;if(a=d.ua(a,l,"MAIN")){if((l=a.P)&&l.Mb&&l.Mb[k])return c.gz(l,k);b.error("Attribute not found:"+k);return null}b.error("Wrong material:",l);return null};a.extract_index_array=function(a,l){if(!c.Lh(a))return b.error("Wrong object:",a.name),null;var k=d.ua(a,l,"MAIN");if(k){if((k=k.P)&&k.Mb)return k.qf;
b.error("Buffer data not found");return null}b.error("Wrong material:",l);return null};a.update_vertex_array=function(a,l,k,p){var e=["MAIN","DEPTH","COLOR_ID"];if(c.Lh(a))for(var g=0;g<e.length;g++){var h=d.ua(a,l,e[g]);h&&(h=h.P)&&h.Mb&&h.Mb[k]&&c.om(h,k,0,p)}else b.error("Wrong object:",a.name)};a.override_geometry=function(a,m,k,p,e){var g=["MAIN","DEPTH","COLOR_ID"];if(c.Lh(a))if(k instanceof Uint16Array||k instanceof Uint32Array)if(p instanceof Float32Array)for(var h=0;h<g.length;h++){var n=
d.ua(a,m,g[h]);if(n){var r=n.P;if(r){c.MD(r,n.ve,k);var G=0,F;for(F in r.Mb)var E=r.Mb[F],G=G+p.length/3*E.Ud;r.Xc=new Float32Array(G);var G=r.Xc,u=0;for(F in r.Mb)switch(E=r.Mb[F],F){case "a_position":G.set(p,u);E.offset=u;E.length=p.length;u+=E.length;break;case "a_normal":var B;e&&(B=c.Hq(k,p,p));var A=c.Fq(k,p,B);G.set(A,u);E.offset=u;E.length=p.length;u+=E.length;break;case "a_tangent":E.offset=u;E.length=p.length/3*E.Ud;for(var A=new Float32Array(E.length),t=0;t<A.length;t+=4)A[t]=1,A[t+3]=
1;G.set(A,u);u+=E.length;break;default:E.offset=u,E.length=p.length/3*E.Ud,A=new Float32Array(E.length),G.set(A,u),u+=E.length}c.Du(r);l.pq(n);(n=d.Hc(a,n))&&n.P&&(n.P=r)}}}else b.error("Wrong positions_array type");else b.error("Wrong ibo_array type");else b.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,d,k){if(!c.check_shape_keys(a))return b.error("Wrong object:",a.name),null;if(!c.os(a,d))return b.error("Wrong key name:",d),null;c.bx(a,d,parseFloat(k))};a.check_shape_keys=function(a){return c.check_shape_keys(a)};
a.get_shape_keys_names=function(a){return c.check_shape_keys(a)?c.get_shape_keys_names(a):(b.error("Wrong object:",a.name),null)};a.get_shape_key_value=function(a,d){return c.check_shape_keys(a)?c.os(a,d)?c.get_shape_key_value(a,d):(b.error("Wrong key name:",d),null):(b.error("Wrong object:",a.name),null)}};b4w.module.hud=function(a,r){var d=r("__hud");r("__print");a.draw_mixer_strip=d.draw_mixer_strip;a.plot_array=d.plot_array};b4w.module.lights=function(a,r){function d(a){for(var c=m.get_active(),d=l.ma(c,"LAMP",l.DATA_ID_ALL),h=0;h<d.length;h++){var n=d[h];if("SUN"==n.Ia.type){var r=n;break}}if(!r)return f.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(d=(90-a.vert_position)/180*Math.PI,h=r.f,k.set_rotation_euler(r,[d,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),p.quat_to_dir(h.quat,p.AXIS_Y,a),h=e.length(h.i),e.copy(a,g),e.scale(g,h,g),k.set_translation(r,
g),k.p(r),a=r.Ia,a.ur&&(h=c.world.light_settings.environment_energy,n=Math.cos(Math.abs(d)),d=Math.max(Math.min(3*n,1),0)*a.pr,h*=Math.max(n,.1),b.Mt(a,d),m.set_environment_colors(c,h,null,null)),m.Of(r,c))}function c(a){if(b.xl(a))return a.Ia.type;f.error("get_light_type(): Wrong object");return!1}var b=r("__lights"),l=r("__objects"),f=r("__print"),m=r("__scenes"),k=r("__transform"),p=r("__util"),e=r("__vec3"),g=new Float32Array(3),h,n=60;a.get_lamps=function(a){var b=m.get_active(),b=l.ma(b,"LAMP",
l.DATA_ID_ALL);if(!a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.Ia.type===a&&c.push(e)}return c};a.get_sun_params=function(){for(var a=m.get_active(),a=l.ma(a,"LAMP",l.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.Ia.type){b=d;break}}return b?(b=b.Ia.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=d;a.set_day_time=function(a){for(var b=
m.get_active(),b=l.ma(b,"LAMP",l.DATA_ID_ALL),c=0;c<b.length;c++){var e=b[c];if("SUN"==e.Ia.type){var g=e;break}}if(!g)return f.error("There is no sun on the scene"),null;g=-Math.cos(a/12*Math.PI)*n;b={};b.hor_position=12>a?15*a:15*(a-24);b.vert_position=g;d(b)};a.set_date=function(a){(h=a.getDate())?1582==h&&10==a.LG&&4<a.Ky&&15>a.Ky&&f.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):f.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){n=
Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(b.xl(a))var d=a.Ia;else return f.error("get_light_params(): Wrong object"),!1;if(a=c(a))switch(a){case "SPOT":var e={light_type:a,light_color:d.color,light_energy:d.Bh,light_spot_blend:d.ak,light_spot_size:d.Ne,light_distance:d.distance};break;case "POINT":e={light_type:a,light_color:d.color,light_energy:d.Bh,light_distance:d.distance};break;default:e={light_type:a,light_color:d.color,light_energy:d.Bh}}return e?e:!1};a.get_light_type=
c;a.set_light_params=function(a,c){if(b.xl(a))var d=a.Ia;else return f.error("set_light_params(): Wrong object"),!1;var e=m.get_active();"number"==typeof c.light_energy&&(b.Mt(d,c.light_energy),m.Of(a,e));"object"==typeof c.light_color&&(b.CC(d,c.light_color),m.Of(a,e));"number"==typeof c.light_spot_blend&&(b.EC(d,c.light_spot_blend),m.Of(a,e));"number"==typeof c.light_spot_size&&(b.FC(d,c.light_spot_size),m.Of(a,e));"number"==typeof c.light_distance&&(b.DC(d,c.light_distance),m.Of(a,e));l.ED(e)}};b4w.module.material=function(a,r){function d(a,b){for(var c=a.Z[0].S,d=0;d<c.length;d++){var e=c[d];if(-1<e.Jc.indexOf(b))return"MAIN"==e.type}return!1}function c(a,b){var c=l.ua(a,b,"MAIN");return Boolean(c&&c.wc[0])}function b(a,b){var c=l.ua(a,b,"MAIN");return Boolean(c&&c.wc[1])}var l=r("__batch"),f=r("__config"),m=r("__obj_util"),k=r("__print"),p=r("__shaders"),e=f.q,g="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.inherit_material=function(a,b,c,d){if(m.Aj(c)&&
m.Aj(a)){for(var e=["MAIN","DEPTH","COLOR_ID"],f=!1,p=0;p<e.length;p++){var r=e[p],A=l.ua(a,b,r),t=l.ua(c,d,r);if(A&&t){var f=!0,y=l.Hc(c,d,r);"MAIN"==r&&(l.Nt(t,A),y&&l.Nt(y,A));for(r=0;r<t.Nb.length;r++){var q=t.Nb[r];if(-1!==g.indexOf(q)){var w=A.Nb.indexOf(q);-1!==w&&(t.R[r]=A.R[w],y&&(q=y.Nb.indexOf(q),-1!==q&&(y.R[q]=A.R[w])))}}}}f||k.error("Wrong objects for inheriting material!")}else k.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.Z;for(var c=0;c<a.length;c++)for(var d=
a[c].S,e=0;e<d.length;e++)for(var f=0;f<d[e].Jc.length;f++)-1==b.indexOf(d[e].Jc[f])&&b.push(d[e].Jc[f]);return b};a.set_diffuse_color=function(a,b,c){var d=l.ua(a,b,"MAIN");d?(d.dd.set(c),(a=l.Hc(a,b,"MAIN"))&&a.dd.set(c)):k.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=l.ua(a,b,"MAIN");if(c){var d=new Float32Array(4);d.set(c.dd);return d}k.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,c){var d=l.ua(a,b,"MAIN");
if(d){if(d.gf=c,a=l.Hc(a,b,"MAIN"))a.gf=c}else k.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=l.ua(a,b,"MAIN");if(c)return c.gf;k.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var d=l.ua(a,b,"MAIN");d?(d.Yd.set(c),(a=l.Hc(a,b,"MAIN"))&&a.Yd.set(c)):k.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=l.ua(a,b,"MAIN");if(c){var d=Array(3);d[0]=c.Yd[0];d[1]=c.Yd[1];
d[2]=c.Yd[2];return d}k.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,b,d){c(a,b)||k.error('Property "specular_intensity" is missing!');l.ua(a,b,"MAIN").wc[0]=d;(a=l.Hc(a,b,"MAIN"))&&(a.wc[0]=d)};a.get_specular_intensity=function(a,b){c(a,b)||k.error('Property "specular_intensity" is missing!');return l.ua(a,b,"MAIN").wc[0]};a.check_specular_intensity=c;a.set_specular_hardness=function(a,c,d){b(a,c)||k.error('Property "specular_hardness" is missing!');l.ua(a,
c,"MAIN").wc[1]=d;(a=l.Hc(a,c,"MAIN"))&&(a.wc[1]=d)};a.get_specular_hardness=function(a,c){b(a,c)||k.error('Property "specular_hardness" is missing!');return l.ua(a,c,"MAIN").wc[1]};a.check_specular_hardness=b;a.set_emit_factor=function(a,b,c){var d=l.ua(a,b,"MAIN");if(d){if(d.we=c,a=l.Hc(a,b,"MAIN"))a.we=c}else k.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=l.ua(a,b,"MAIN");if(c)return c.we;k.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=
function(a,b,c){var d=l.ua(a,b,"MAIN");if(d){if(d.je=c,a=l.Hc(a,b,"MAIN"))a.je=c}else k.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=l.ua(a,b,"MAIN");if(c)return c.je;k.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){var d=l.ua(a,b,"MAIN");if(d){if(d.ff=c,a=l.Hc(a,b,"MAIN"))a.ff=c}else k.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=l.ua(a,b,"MAIN");
if(c)return c.ff;k.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var d=l.ua(a,b,"MAIN");if(d){if(d.Ye=c,a=l.Hc(a,b,"MAIN"))a.Ye=c}else k.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=l.ua(a,b,"MAIN");if(c)return c.Ye;k.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return k.error("missing arguments in get_material_params"),null;if(!d(a,b))return null;var c=
l.ua(a,b,"MAIN");if(!c)return null;var e={};"MAIN"==c.type&&(e.reflect_factor=c.reflect_factor,e.fresnel=c.vd[2],e.fresnel_factor=5*(1-c.vd[3]),e.parallax_scale=c.parallax_scale,e.parallax_steps=l.Eb(c,"PARALLAX_STEPS")[1]);return e};a.get_water_material_params=function(a,b){if(!a||!b)return k.error("missing arguments in get_water_material_params"),null;if(!d(a,b))return null;var c=l.ua(a,b,"MAIN");if(!c||!c.Tf)return null;if(!c)return k.error("material not found"),null;var f={};if("MAIN"==c.type){if(e.ji){var g=
f.shallow_water_col=Array(3);g[0]=c.shallow_water_col[0];g[1]=c.shallow_water_col[1];g[2]=c.shallow_water_col[2];g=f.shore_water_col=Array(3);g[0]=c.shore_water_col[0];g[1]=c.shore_water_col[1];g[2]=c.shore_water_col[2];f.shallow_water_col_fac=c.shallow_water_col_fac;f.shore_water_col_fac=c.shore_water_col_fac}f.foam_factor=c.foam_factor;f.norm_uv_velocity=c.Ii;f.absorb_factor=l.Eb(c,"ABSORB")[1];f.sss_strength=l.Eb(c,"SSS_STRENGTH")[1];f.sss_width=l.Eb(c,"SSS_WIDTH")[1];f.dst_noise_scale0=l.Eb(c,
"DST_NOISE_SCALE_0")[1];f.dst_noise_scale1=l.Eb(c,"DST_NOISE_SCALE_1")[1];f.dst_noise_freq0=l.Eb(c,"DST_NOISE_FREQ_0")[1];f.dst_noise_freq1=l.Eb(c,"DST_NOISE_FREQ_1")[1];f.dir_min_shore_fac=l.Eb(c,"DIR_MIN_SHR_FAC")[1];f.dir_freq=l.Eb(c,"DIR_FREQ")[1];f.dir_noise_scale=l.Eb(c,"DIR_NOISE_SCALE")[1];f.dir_noise_freq=l.Eb(c,"DIR_NOISE_FREQ")[1];f.dir_min_noise_fac=l.Eb(c,"DIR_MIN_NOISE_FAC")[1];f.dst_min_fac=l.Eb(c,"DST_MIN_FAC")[1];f.waves_hor_fac=l.Eb(c,"WAVES_HOR_FAC")[1]}return f};a.set_material_extended_params=
function(a,b,c){if(a&&b&&c){if(!d(a,b))return k.error("setting material params is not possible"),null;var e=l.ua(a,b,"MAIN");if(e){var f=[e];(e=l.Hc(a,b,"MAIN"))&&f.push(e);for(a=0;a<f.length;a++)e=f[a],"number"==typeof c.material_reflectivity&&(e.reflect_factor=c.material_reflectivity),"number"==typeof c.material_fresnel&&(e.vd[2]=c.material_fresnel),"number"==typeof c.material_fresnel_factor&&(e.vd[3]=1-c.material_fresnel_factor/5),"number"==typeof c.material_parallax_scale&&(e.parallax_scale=c.material_parallax_scale),
"number"==typeof c.material_parallax_steps&&(b=p.r(parseFloat(c.material_parallax_steps)),l.wa(e,"PARALLAX_STEPS",b),l.rb(e,!0))}else k.error("material not found")}else k.error("missing arguments in set_material_params")};a.set_water_material_params=function(a,b,c){if(!a||!b||!c)return k.error("missing arguments in set_water_material_params"),null;if(!d(a,b))return k.error("setting water material params is not possible"),null;var f=l.ua(a,b,"MAIN");if(!f)return k.error("material not found"),null;
var g=[f];(f=l.Hc(a,b,"MAIN"))&&g.push(f);for(a=0;a<g.length;a++)f=g[a],e.ji&&("object"==typeof c.shallow_water_col&&f.shallow_water_col.set(c.shallow_water_col),"number"==typeof c.shallow_water_col_fac&&(f.shallow_water_col_fac=c.shallow_water_col_fac),"object"==typeof c.shore_water_col&&f.shore_water_col.set(c.shore_water_col),"number"==typeof c.shore_water_col_fac&&(f.shore_water_col_fac=c.shore_water_col_fac)),e.shore_smoothing&&f.tm&&("boolean"==typeof c.shore_smoothing&&(c.shore_smoothing?l.wa(f,
"SHORE_SMOOTHING",1):l.wa(f,"SHORE_SMOOTHING",0)),"number"==typeof c.absorb_factor&&(b=p.r(parseFloat(c.absorb_factor)),l.wa(f,"ABSORB",b))),"number"==typeof c.foam_factor&&e.Fh&&(f.foam_factor=c.foam_factor),"number"==typeof c.norm_uv_velocity&&(f.Ii=c.norm_uv_velocity),e.water_dynamic&&f.water_dynamic&&("boolean"==typeof c.water_dynamic&&(c.water_dynamic?l.wa(f,"DYNAMIC",1):l.wa(f,"DYNAMIC",0)),"number"==typeof c.waves_height&&(b=p.r(parseFloat(c.waves_height)),l.wa(f,"WAVES_HEIGHT",b)),"number"==
typeof c.waves_length&&(b=p.r(parseFloat(c.waves_length)),l.wa(f,"WAVES_LENGTH",b)),"number"==typeof c.sss_strength&&(b=p.r(parseFloat(c.sss_strength)),l.wa(f,"SSS_STRENGTH",b)),"number"==typeof c.sss_width&&(b=p.r(parseFloat(c.sss_width)),l.wa(f,"SSS_WIDTH",b)),"number"==typeof c.dst_noise_scale0&&(b=p.r(parseFloat(c.dst_noise_scale0)),l.wa(f,"DST_NOISE_SCALE_0",b)),"number"==typeof c.dst_noise_scale1&&(b=p.r(parseFloat(c.dst_noise_scale1)),l.wa(f,"DST_NOISE_SCALE_1",b)),"number"==typeof c.dst_noise_freq0&&
(b=p.r(parseFloat(c.dst_noise_freq0)),l.wa(f,"DST_NOISE_FREQ_0",b)),"number"==typeof c.dst_noise_freq1&&(b=p.r(parseFloat(c.dst_noise_freq1)),l.wa(f,"DST_NOISE_FREQ_1",b)),"number"==typeof c.dir_min_shore_fac&&(b=p.r(parseFloat(c.dir_min_shore_fac)),l.wa(f,"DIR_MIN_SHR_FAC",b)),"number"==typeof c.dir_freq&&(b=p.r(parseFloat(c.dir_freq)),l.wa(f,"DIR_FREQ",b)),"number"==typeof c.dir_noise_scale&&(b=p.r(parseFloat(c.dir_noise_scale)),l.wa(f,"DIR_NOISE_SCALE",b)),"number"==typeof c.dir_noise_freq&&(b=
p.r(parseFloat(c.dir_noise_freq)),l.wa(f,"DIR_NOISE_FREQ",b)),"number"==typeof c.dir_min_noise_fac&&(b=p.r(parseFloat(c.dir_min_noise_fac)),l.wa(f,"DIR_MIN_NOISE_FAC",b)),"number"==typeof c.dst_min_fac&&(b=p.r(parseFloat(c.dst_min_fac)),l.wa(f,"DST_MIN_FAC",b)),"number"==typeof c.waves_hor_fac&&(b=p.r(parseFloat(c.waves_hor_fac)),l.wa(f,"WAVES_HOR_FAC",b))),l.rb(f,!0);return!0}};b4w.module.particles=function(a,r){var d=r("__particles"),c=r("__print");a.set_size=function(a,l,f){d.$h(a)?d.set_size(a,l,f):c.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,l,f){d.$h(a)?d.set_normal_factor(a,l,f):c.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,l,f){d.$h(a)?(f=Math.min(f,1),f=Math.max(f,0),d.set_factor(a,l,f)):c.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,r){r("__config");var d=r("__ipc"),c=r("__physics"),b=r("__print"),l=r("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){c.K(a)?c.enable_simulation(a):b.error("No physics for object "+a.name)};a.disable_simulation=function(a){c.K(a)?c.disable_simulation(a):b.error("No physics for object "+a.name)};a.has_physics=function(a){return c.K(a)};a.has_simulated_physics=function(a){return c.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return c.has_dynamic_physics(a)};a.set_gravity=function(a,d){c.K(a)?c.set_gravity(a,d):b.error("No physics for object "+a.name)};a.set_damping=function(a,d,k){c.K(a)?c.A("set_damping",a.m.v,d,k):b.error("No physics for object "+a.name)};a.reset_damping=function(a){if(c.K(a)){var d=a.zd;c.A("set_damping",a.m.v,d.qn,d.Yo)}else b.error("No physics for object "+a.name)};a.set_transform=function(a,d,k){c.K(a)?c.set_transform.apply(this,arguments):b.error("No physics for object "+a.name)};a.sync_transform=
function(a){c.K(a)?c.sync_transform(a):b.error("No physics for object "+a.name)};a.apply_velocity=function(a){c.K(a)?c.apply_velocity.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){c.K(a)?c.apply_velocity_world.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_force=function(a,d,k,l){c.K(a)?c.apply_force.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_torque=function(a,d,k,l){c.K(a)?c.apply_torque.apply(this,
arguments):b.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,d){c.K(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_throttle(a,l.clamp(d,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,d,k){if(c.K(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");d=l.clamp(d,0,1);var p=a.l.Ch;-1==k||1==k?p=Math.max(-1,Math.min(p+k*d,1)):0==k&&0<=p?(p-=d,p=Math.max(0,p)):0==k&&0>p?(p+=d,p=Math.min(0,
p)):b.error("Wrong steering direction");c.vehicle_throttle(a,l.clamp(p,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_steer=function(a,d){c.K(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_steer(a,l.clamp(d,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,d,k){if(c.K(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");d=l.clamp(d,0,1);var p=a.l.ri;-1==k||1==k?p=Math.max(-1,Math.min(p+k*d,
1)):0==k&&0<=p?(p-=d,p=Math.max(0,p)):0==k&&0>p?(p+=d,p=Math.min(0,p)):b.error("Wrong steering direction");c.vehicle_steer(a,l.clamp(p,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_brake=function(a,d){c.K(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_brake(a,l.clamp(d,0,1))):b.error("No physics for object "+a.name)};a.vehicle_brake_inc=function(a,d){if(c.K(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");d=l.clamp(d,
-1,1);var k=a.l.Ti;c.vehicle_brake(a,l.clamp(k+k*d,0,1))}else b.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return c.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return c.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!c.K(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.xc.name;b.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!c.K(a))return b.error("No physics for object "+
a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.l.Ch;b.error("Wrong object")};a.get_vehicle_steering=function(a){if(!c.K(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.l.ri;b.error("Wrong object")};a.get_vehicle_brake=function(a){if(!c.K(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.l.Ti;b.error("Wrong object")};a.get_vehicle_speed=function(a){if(!c.K(a))return b.error("No physics for object "+
a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return c.get_vehicle_speed(a);b.error("Wrong object")};a.is_character=function(a){return c.is_character(a)};a.set_character_move_dir=function(a,d,k){c.K(a)?c.set_character_move_dir(a,d,k):b.error("No physics for object "+a.name)};a.set_character_move_type=function(a,d){c.K(a)?c.set_character_move_type(a,d):b.error("No physics for object "+a.name)};a.set_character_walk_velocity=function(a,d){c.K(a)?c.set_character_walk_velocity(a,d):b.error("No physics for object "+
a.name)};a.set_character_run_velocity=function(a,d){c.K(a)?c.set_character_run_velocity(a,d):b.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,d){c.K(a)?c.set_character_fly_velocity(a,d):b.error("No physics for object "+a.name)};a.character_jump=function(a){c.K(a)?c.character_jump(a):b.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,d,k){c.K(a)?c.character_rotation_inc(a,d,k):b.error("No physics for object "+a.name)};a.set_character_rotation_quat=
function(a,d){c.K(a)?c.set_character_rotation_quat(a,d):b.error("No physics for object "+a.name)};a.set_character_rotation=function(a,d,k){c.K(a)?c.set_character_rotation(a,d,k):b.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,d){c.K(a)?c.set_character_rotation_v(a,d):b.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,d){c.K(a)?c.set_character_rotation_h(a,d):b.error("No physics for object "+a.name)};a.append_collision_test=function(a,d,
k,l){c.K(a)?c.append_collision_test(a,d,k,l||!1):b.error("No physics for object "+a.name)};a.remove_collision_test=function(a,d,k){c.K(a)?c.remove_collision_test(a,d||"ANY",k):b.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,d){c.K(a)?c.apply_collision_impulse_test(a,d):b.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){c.K(a)?c.clear_collision_impulse_test(a):b.error("No physics for object "+a.name)};a.append_ray_test=function(a,
b,d,l,e,g){return c.append_ray_test(a,b,d,l,e,g||!1,!1,!1,!1)};a.append_ray_test_ext=function(a,b,d,l,e,g,h,n,r){return c.append_ray_test(a,b,d,l,e,g||!1,h||!1,n||!1,r||!1)};a.remove_ray_test=function(a){c.xs(a)?c.remove_ray_test(a):b.error("Wrong ray test ID")};a.change_ray_test_from_to=function(a,d,k){c.xs(a)?c.change_ray_test_from_to(a,d,k):b.error("Wrong ray test ID")};a.apply_constraint=function(a,d,k,l,e,g,h,n,r,G){c.K(d)&&c.K(e)?c.apply_constraint(a,d,k,l,e,g,h,n,r,G):b.error("Wrong objects")};
a.clear_constraint=function(a){c.K(a)&&c.rA(a)?c.clear_constraint(a):b.error("Wrong object")};a.pull_to_constraint_pivot=function(a,d,k,l,e,g){c.K(a)&&c.K(l)?c.pull_to_constraint_pivot(a,d,k,l,e,g):b.error("Wrong objects")};a.get_worker_listeners=d.get_worker_listeners};b4w.module.rgb=function(a,r){r("__print");var d=r("__util"),c=new Float32Array(3);a.create=function(){return new Float32Array(3)};a.from_values=function(a,c,d){var m=new Float32Array(3);m[0]=a;m[1]=c;m[2]=d;return m};a.set=function(a,c,d,m){m[0]=a;m[1]=c;m[2]=d;return m};a.css_to_rgb=function(a,c,f,m){m=m||new Float32Array(3);m[0]=a/255;m[1]=c/255;m[2]=f/255;d.hu(m,m);return m};a.rgb_to_css=function(a){a=d.ro(a,c);return[Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])]};a.rgb_to_css_hex=
function(a){function l(a){a=Math.round(255*a).toString(16);return 1==a.length?"0"+a:a}a=d.ro(a,c);return"#"+l(a[0])+l(a[1])+l(a[2])}};
b4w.module.rgba=function(a,r){r("__print");var d=r("__util"),c=new Float32Array(3);a.create=function(){var a=new Float32Array(4);a[3]=1;return a};a.from_values=function(a,c,d,m){var k=new Float32Array(4);k[0]=a;k[1]=c;k[2]=d;k[3]=m;return k};a.set=function(a,c,d,m,k){k[0]=a;k[1]=c;k[2]=d;k[3]=m;return k};a.css_to_rgba=function(a,c,f,m,k){k=k||new Float32Array(4);k[0]=a/255;k[1]=c/255;k[2]=f/255;k[3]=m;d.hu(k,k);return k};a.rgba_to_css=function(a){var l=d.ro(a,c);return[Math.round(255*l[0]),Math.round(255*
l[1]),Math.round(255*l[2]),a[3]]}};b4w.module.scenes=function(a,r){var d=r("__batch"),c=r("__camera"),b=r("__data"),l=r("__graph"),f=r("__objects"),m=r("__obj_util"),k=r("__physics"),p=r("__print"),e=r("__scenes"),g=r("__util");a.DATA_ID_ALL=f.DATA_ID_ALL;a.set_active=function(a){var b=e.Jh();e.set_active(g.keysearch("name",a,b))};a.get_active=function(){return e.ha()?e.get_active().name:""};a.get_scenes=function(){for(var a=e.Jh(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(e.ha())return e.xj(e.get_active());
p.error("No active scene");return!1};a.get_object_by_name=function(a,b){var c=f.lf(f.xm,a,b|0);if(c)return c;p.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,c){if(a=f.lf(f.wm,a,b,c|0))return a;p.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var c=f.lf(f.Ki,a,b|0);if(c)return c;p.error("get object "+a+": not found")};a.get_object_data_id=function(a){return e.get_object_data_id(a)};a.pick_object=f.pick_object;a.outlining_is_enabled=
function(a){return a&&a.f&&a.f.Lb};a.set_outline_intensity=function(a,b){a&&a.f&&a.f.Lb?a.f.yd=b:p.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=function(a){if(a&&a.f&&a.f.Lb)return a.f.yd;p.error("get_outline_intensity(): wrong object")};a.apply_outline_anim=function(a,b,c,d){a&&a.f&&a.f.Lb?f.apply_outline_anim(a,b,c,d):p.error("apply_outline_anim(): wrong object")};a.apply_outline_anim_def=function(a){if(a&&a.f&&a.f.Lb){var b=a.f.Kj;f.apply_outline_anim(a,b.Ml,b.Nl,b.Ol)}else p.error("apply_outline_anim_def(): wrong object")};
a.clear_outline_anim=function(a){a&&a.f&&a.f.Lb?f.clear_outline_anim(a):p.error("clear_outline_anim(): wrong object")};a.set_outline_color=e.set_outline_color;a.get_outline_color=function(a){var b=e.get_active();if(b=e.da(b,"OUTLINE"))return a=a||new Float32Array(3),a.set(b.zf),a};a.set_glow_intensity=function(b,c){p.error("set_glow_intensity() deprecated, use set_outline_intensity() instead");a.set_outline_intensity(b,c)};a.get_glow_intensity=function(b){p.error("get_glow_intensity() deprecated, use get_outline_intensity() instead");
a.get_outline_intensity(b)};a.apply_glow_anim=function(b,c,d,e){p.error("apply_glow_anim() deprecated, use apply_outline_anim() instead");a.apply_outline_anim(b,c,d,e)};a.apply_glow_anim_def=function(b){p.error("apply_glow_anim_def() deprecated, use apply_outline_anim_def() instead");a.apply_outline_anim_def(b)};a.clear_glow_anim=function(b){p.error("clear_glow_anim() deprecated, use clear_outline_anim() instead");a.clear_outline_anim(b)};a.set_glow_color=function(b){p.error("set_glow_color() deprecated, use set_outline_color() instead");
a.set_outline_color(b)};a.get_glow_color=function(b){p.error("get_glow_color() deprecated, use get_outline_color() instead");a.get_outline_color(b)};a.get_shadow_params=function(){if(!e.ha())return p.error("No active scene"),!1;var a=e.get_active(),b=e.da(a,"SHADOW_CAST");if(!b)return null;var c=a.k.Yb,d=e.da(a,"MAIN_OPAQUE"),f=e.da(a,"DEPTH"),g={};g.csm_resolution=c.csm_resolution;g.self_shadow_polygon_offset=b.self_shadow_polygon_offset;f&&(g.self_shadow_normal_offset=f.self_shadow_normal_offset);
g.enable_csm=c.enable_csm;g.csm_num=c.csm_num;g.csm_first_cascade_border=c.csm_first_cascade_border;g.first_cascade_blur_radius=c.first_cascade_blur_radius;g.csm_last_cascade_border=c.csm_last_cascade_border;g.last_cascade_blur_radius=c.last_cascade_blur_radius;g.fade_last_cascade=c.fade_last_cascade;g.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(g.csm_borders=e.Sz(a,d.j),g.blur_radii=new Float32Array(c.csm_num),g.blur_radii.set(d.j.Sl.subarray(0,c.csm_num))):(g.csm_borders=null,
g.blur_radii=null);return g};a.set_shadow_params=function(a){if(!e.ha())return p.error("No active scene"),!1;var b=e.get_active();"number"==typeof a.self_shadow_polygon_offset&&l.V(b.k.mb,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var f=e.da(b,"DEPTH");f&&("number"==typeof a.self_shadow_normal_offset&&(f.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(f.pcf_blur_radius=a.pcf_blur_radius));var g=e.da(b,
"MAIN_BLEND");g&&("number"==typeof a.self_shadow_normal_offset&&(g.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(g.pcf_blur_radius=a.pcf_blur_radius),g.va=!0);g=b.k.Yb;"number"==typeof a.csm_first_cascade_border&&(g.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(g.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(g.csm_last_cascade_border=a.csm_last_cascade_border);
"number"==typeof a.last_cascade_blur_radius&&(g.last_cascade_blur_radius=a.last_cascade_blur_radius);if(f){for(var k=f.o,m=0;m<k.length;m++){var r=k[m];r.xd.vc&&(r=r.D,d.qq(r,g),d.rb(r))}f.va=!0}f=b.Zf.f.L;for(m=0;m<f.length;m++)c.Cp(f[m],g);e.$o(b)};a.get_environment_colors=function(){if(!e.ha())return p.error("No active scene"),!1;var a=e.get_active();return e.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(!e.ha())return p.error("No active scene"),!1;var d=e.get_active();
e.set_environment_colors(d,parseFloat(a),b,c)};a.get_fog_color_density=function(a){if(!e.ha())return p.error("No active scene"),!1;var b=e.get_active();return e.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(!e.ha())return p.error("No active scene"),!1;var b=e.get_active();e.set_fog_color_density(b,a)};a.get_ssao_params=function(){if(!e.ha())return p.error("No active scene"),!1;var a=e.get_active();return e.get_ssao_params(a)};a.set_ssao_params=function(a){if(!e.ha())return p.error("No active scene"),
!1;var b=e.get_active();e.set_ssao_params(b,a)};a.get_color_correction_params=function(){if(!e.ha())return p.error("No active scene"),null;var a=e.get_active(),a=e.da(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(!e.ha())return p.error("No active scene"),null;var b=e.get_active(),b=e.da(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&
(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.va=!0};a.get_sky_params=function(){if(!e.ha())return p.error("No active scene"),!1;var a=e.get_active();return e.get_sky_params(a)};a.set_sky_params=function(a){if(!e.ha())return p.error("No active scene"),!1;var b=e.get_active();e.set_sky_params(b,a)};a.get_dof_params=function(){if(!e.ha())return p.error("No active scene"),
!1;var a=e.get_active();return e.da(a,"DOF")?e.get_dof_params(a):null};a.set_dof_params=function(a){if(!e.ha())return p.error("No active scene"),!1;var b=e.get_active();e.set_dof_params(b,a)};a.get_god_rays_params=function(){if(!e.ha())return p.error("No active scene"),!1;var a=e.get_active();return e.da(a,"GOD_RAYS")?e.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!e.ha())return p.error("No active scene"),!1;var b=e.get_active();e.set_god_rays_params(b,a)};a.get_bloom_params=
function(){if(!e.ha())return p.error("No active scene"),!1;var a=e.get_active();return e.da(a,"BLOOM")?e.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!e.ha())return p.error("No active scene"),!1;var b=e.get_active();e.set_bloom_params(b,a)};a.get_glow_material_params=function(){if(!e.ha())return p.error("No active scene"),!1;var a=e.get_active();return e.da(a,"GLOW_COMBINE")?e.get_glow_material_params(a):null};a.set_glow_material_params=function(a){if(!e.ha())return p.error("No active scene"),
!1;var b=e.get_active();e.set_glow_material_params(b,a)};a.get_wind_params=function(){if(!e.ha())return p.error("No active scene"),!1;var a=e.get_active();return e.get_wind_params(a)};a.set_wind_params=function(a){if(!e.ha())return p.error("No active scene"),!1;var b=e.get_active();f.set_wind_params(b,a)};a.get_water_surface_level=e.get_water_surface_level;a.set_water_params=function(a){if(!e.ha())return p.error("No active scene"),!1;var b=e.get_active();e.set_water_params(b,a)};a.get_water_mat_params=
function(a){if(!e.ha())return p.error("No active scene"),!1;var b=e.get_active();e.get_water_mat_params(b,a)};a.update_scene_materials_params=function(){if(!e.ha())return p.error("No active scene"),!1;var a=e.get_active();e.Fp(a)};a.hide_object=function(a){m.Aj(a)||g.ul(a)?e.hide_object(a):p.error("show/hide is only supported for dynamic meshes/empties")};a.show_object=function(a){m.Aj(a)||g.ul(a)?e.show_object(a):p.error("show/hide is only supported for dynamic meshes/empties")};a.is_hidden=function(a){if(m.Aj(a)||
g.ul(a))return e.is_hidden(a);p.error("show/hide is only supported for dynamic meshes/empties");return!1};a.is_visible=function(a){return a.f.is_visible};a.check_object=function(a){return e.ha()?f.check_object(a,e.get_active()):(p.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return f.lf(f.xm,a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,c){return f.lf(f.wm,a,b,c|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return f.lf(f.Ki,a,b|0)?!0:!1};a.get_all_objects=
function(a,b){var c=e.get_active();a||(a="ALL");b||0===b||(b=f.DATA_ID_ALL);return f.ma(c,a,b)};a.get_object_name=function(a){return a?a.name:(p.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(p.error("Wrong object"),"UNDEFINED")};a.get_object_dg_parent=function(a){p.error("scenes.get_object_dg_parent() deprecated, use objects.get_dg_parent() instead");return f.get_dg_parent(a)};a.get_object_children=function(a){return a.rd.slice(0)};a.get_first_character=function(){for(var a=
f.ma(e.get_active(),"MESH",f.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(k.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return e.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return e.get_cam_water_depth()};a.get_type_mesh_object=function(a){return g.is_mesh(a)?a.f.type:null};a.get_meta_tags=function(){if(!e.ha())return p.error("No active scene"),!1;var a=e.get_active();return e.get_meta_tags(a)};a.append_object=function(a,b){if(!a.f.ho)return p.error('object "'+
a.name+'" has been created not by coping.'),!1;if(b)var c=e.Jh(),c=g.keysearch("name",b,c);else c=e.get_active();e.append_object(c,a,!0)};a.remove_object=function(a){if(!a.f.ho)return p.error("Can't remove object \""+a.name+'". It was not copied.'),!1;var c=e.get_active();b.UB(c,a,!1);f.remove_object(a)};a.marker_frame=function(a){var b=e.get_active();if(b.timeline_markers&&a in b.timeline_markers)return e.marker_frame(b,a);p.error('"'+a+'" marker not found.');return 0};a.get_mb_params=function(){var a=
e.get_active();return(a=e.da(a,"MOTION_BLUR"))?{mb_factor:a.mb_factor,mb_decay_threshold:a.mb_decay_threshold}:null};a.set_mb_params=function(a){var b=e.get_active();(b=e.da(b,"MOTION_BLUR"))?("number"==typeof a.mb_decay_threshold&&(b.mb_decay_threshold=a.mb_decay_threshold),"number"==typeof a.mb_factor&&(b.mb_factor=a.mb_factor)):p.error("The motion blur subscene doesn't exist.")}};b4w.module.sfx=function(a,r){var d=r("__scenes"),c=r("__sfx"),b=r("__print");a.play=function(a,b,d){c.play(a,b,d)};a.play_def=function(a){c.play_def(a)};a.is_play=function(a){return c.is_play(a)};a.speaker_play=function(a,d,m,k){b.error("speaker_play() deprecated, use play() or play_def() instead");c.cyclic(a,d);k&&c.playrate(a,k);c.play(a,0,m)};a.speaker_stop=function(a){b.error("speaker_stop() deprecated, use stop() instead");c.stop(a)};a.stop=function(a){c.stop(a)};a.pause=function(a){c.aD(a)};
a.resume=function(a){c.cD(a)};a.speaker_playback_rate=function(a,d){b.error("speaker_playback_rate() deprecated, use playrate() instead");c.playrate(a,d)};a.playrate=function(a,b){c.playrate(a,b)};a.get_playrate=function(a){return c.get_playrate(a)};a.cyclic=function(a,b){c.cyclic(a,b)};a.is_cyclic=function(a){return c.is_cyclic(a)};a.listener_reset_speed=function(a,b){c.listener_reset_speed(a,b)};a.speaker_reset_speed=function(a,b,d){c.speaker_reset_speed(a,b,d)};a.get_volume=function(a){return a&&
"object"===typeof a?c.get_volume(a):c.$z()};a.set_volume=function(a,b){a&&"object"===typeof a?c.set_volume(a,b):c.HC(b)};a.mute=function(a,b){a&&"object"===typeof a?c.mute(a,b):c.yB(b)};a.is_muted=function(a){return a&&"object"===typeof a?c.is_muted(a):c.HA()};a.get_speaker_objects=function(){return c.get_speaker_objects().slice(0)};a.get_speakers=function(){b.error("get_speakers() deprecated, use get_speaker_objects() instead");return a.get_speaker_objects()};a.check_active_speakers=c.check_active_speakers;
a.set_compressor_params=function(a){c.set_compressor_params(d.get_active(),a)};a.get_compressor_params=function(){return c.get_compressor_params(d.get_active())};a.duck=function(a,b,d){a&&"object"===typeof a?c.duck(a,b,d):c.Xy(b,d)};a.unduck=function(a){a&&"object"===typeof a?c.unduck(a):c.DD()};a.apply_playlist=c.apply_playlist;a.clear_playlist=c.clear_playlist;a.detect_audio_container=c.detect_audio_container;a.detect_video_container=c.detect_video_container;a.set_positional_params=c.set_positional_params;
a.get_positional_params=c.get_positional_params;a.set_filter_params=c.set_filter_params;a.get_filter_params=c.get_filter_params;a.get_filter_freq_response=c.get_filter_freq_response;a.get_duration=function(a){if(a&&c.Ce(a))return c.get_duration(a);b.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.textures=function(a,r){var d=r("__print"),c=r("__textures");a.get_canvas_texture_context=function(a,l){l||(l=0);var f=c.Pz(a,l);if(f)return f;d.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a,l){l||(l=0);c.PD(a,l)||d.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a,l){l||(l=0);c.play_video(a,l)||d.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a,l){l||(l=0);c.pause_video(a,l)||d.error('Texture with name "'+
a+'" not found!')};a.reset_video=function(a,l){l||(l=0);c.reset_video(a,l)||d.error('Texture with name "'+a+'" not found!')}};b4w.module.time=function(a,r){var d=r("__time");a.set_timeout=d.set_timeout;a.clear_timeout=d.clear_timeout;a.get_timeline=d.get_timeline;a.animate=d.animate;a.clear_animation=d.clear_animation};b4w.module.transform=function(a,r){var d=r("__obj_util"),c=r("__physics"),b=r("__print"),l=r("__quat"),f=r("__transform"),m=r("__util"),k=new Float32Array(3),p=new Float32Array(4);a.SPACE_LOCAL=f.SPACE_LOCAL;a.SPACE_WORLD=f.SPACE_WORLD;a.set_translation=function(a,g,h,l){d.oa(a)?(k[0]=g,k[1]=h,k[2]=l,f.set_translation(a,k),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel=function(a,g,h,l){d.oa(a)?(k[0]=g,k[1]=h,k[2]=l,f.set_translation_rel(a,
k),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,g){d.oa(a)?(f.set_translation(a,g),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel_v=function(a,g){d.oa(a)?(f.set_translation_rel(a,g),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_obj_rel=function(a,g,h,l,p){d.oa(a)?(k[0]=g,k[1]=h,k[2]=l,m.transform_vec3(k,1,p.f.quat,p.f.i,
k),f.set_translation(a,k),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,b){b||(b=new Float32Array(3));f.get_translation(a,b);return b};a.get_translation_rel=function(a,b){b||(b=new Float32Array(3));f.get_translation_rel(a,b);return b};a.set_rotation=function(a,g,h,k,l){d.oa(a)?(p[0]=g,p[1]=h,p[2]=k,p[3]=l,f.set_rotation(a,p),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel=function(a,
g,h,k,l){d.oa(a)?(p[0]=g,p[1]=h,p[2]=k,p[3]=l,f.set_rotation_rel(a,p),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat=function(){b.error("set_rotation_quat() deprecated, use set_rotation() instead");return a.set_rotation};a.set_rotation_v=function(a,g){d.oa(a)?(f.set_rotation(a,g),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel_v=function(a,g){d.oa(a)?(f.set_rotation_rel(a,g),f.p(a),c.sync_transform(a)):
b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat_v=function(){b.error("set_rotation_quat_v() deprecated, use set_rotation_v() instead");return a.set_rotation_v};a.get_rotation=function(a,b){b||(b=new Float32Array(4));f.get_rotation(a,b);return b};a.get_rotation_rel=function(a,b){b||(b=new Float32Array(4));f.get_rotation_rel(a,b);return b};a.get_rotation_quat=function(){b.error("get_rotation_quat() deprecated, use get_rotation() instead");return a.get_rotation};a.set_rotation_euler=
function(a,g,h,l){d.oa(a)?(k[0]=g,k[1]=h,k[2]=l,f.set_rotation_euler(a,k),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel=function(a,g,h,l){d.oa(a)?(k[0]=g,k[1]=h,k[2]=l,f.set_rotation_euler_rel(a,k),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,g){d.oa(a)?(f.set_rotation_euler(a,g),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel_v=
function(a,g){d.oa(a)?(f.set_rotation_euler_rel(a,g),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,c){d.oa(a)?(f.set_scale(a,c),f.p(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale_rel=function(a,c){d.oa(a)?(f.set_scale_rel(a,c),f.p(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_scale=function(a){return f.get_scale(a)};a.get_scale_rel=function(a){return f.get_scale_rel(a)};a.empty_reset_transform=function(a){if("EMPTY"!=
a.type)return b.error("Wrong object: "+a.name),!1;for(var g=0;g<a.rd.length;g++)if(!d.oa(a.rd[g])){b.error('Wrong object: "'+a.rd[g].name+'" is not dynamic.');return}f.set_translation(a,[0,0,0]);f.set_rotation(a,[0,0,0,1]);f.set_scale(a,1);f.p(a);c.sync_transform(a)};a.get_object_size=function(a){return m.is_mesh(a)?f.get_object_size(a):(b.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,c,d){return m.is_mesh(a)?f.get_object_center(a,c,d):(b.error("Wrong object: "+a.name),null)};
a.move_local=function(a,g,h,k){d.oa(a)?(f.move_local(a,g,h,k),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_x_local=function(a,g){if(d.oa(a)){var h=l.setAxisAngle(m.AXIS_X,g,p);f.Xo(a,h);f.p(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_y_local=function(a,g){if(d.oa(a)){var h=l.setAxisAngle(m.AXIS_Y,g,p);f.Xo(a,h);f.p(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_z_local=
function(a,g){if(d.oa(a)){var h=l.setAxisAngle(m.AXIS_Z,g,p);f.Xo(a,h);f.p(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return f.get_object_bounding_box(a)};a.set_tsr=function(a,g){d.oa(a)?(f.set_tsr(a,g),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr_rel=function(a,g){d.oa(a)?(f.set_tsr_rel(a,g),f.p(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.get_tsr=function(a,b){b||(b=new Float32Array(8));f.get_tsr(a,b);return b};a.get_tsr_rel=function(a,b){b||(b=new Float32Array(8));f.get_tsr_rel(a,b);return b};a.distance=function(a,b){return f.distance(a,b)}};b4w.module.tsr=function(a,r){r("__print");var d=r("__tsr");a.create=d.create;a.from_values=d.from_values;a.copy=d.copy;a.identity=d.identity;a.create_sep=d.create_sep;a.set_sep=d.set_sep;a.set_trans=d.set_trans;a.set_scale=d.set_scale;a.set_transcale=d.set_transcale;a.set_quat=d.set_quat;a.get_trans_view=d.get_trans_view;a.get_scale=d.get_scale;a.get_quat_view=d.get_quat_view;a.invert=d.invert;a.to_mat4=function(a,b){b||(b=new Float32Array(16));d.to_mat4(a,b);return b};a.from_mat4=d.from_mat4;a.multiply=
d.multiply;a.transform_vec3=d.transform_vec3;a.transform_vec3_inv=d.transform_vec3_inv;a.transform_vectors=d.transform_vectors;a.transform_dir_vectors=d.transform_dir_vectors;a.transform_dir_vec3=d.transform_dir_vec3;a.transform_tangents=d.transform_tangents;a.translate=d.translate;a.interpolate=d.interpolate};b4w.module.util=function(a,r){var d=r("__print"),c=r("__util"),b=r("__vec3");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.f32=function(a){return new Float32Array(a||0)};a.assert=c.assert;a.keyfind=c.keyfind;a.keysearch=c.keysearch;a.matrix_to_quat=function(a){return c.matrix_to_quat(a)};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));
return c.euler_to_quat(a,b)};a.quat_to_euler=function(a,b){b||(b=new Float32Array(3));return c.quat_to_euler(a,b)};a.sign=c.sign;a.clamp=c.clamp;a.quat_to_dir=c.quat_to_dir;a.ground_project_quat=function(a,b){return c.quat_project(a,c.AXIS_MY,c.AXIS_Y,c.AXIS_MZ,b)};a.cam_quat_to_mesh_quat=function(a,b){return c.cam_quat_to_mesh_quat(a,b)};a.quat_project=function(a,f,m,k,p){return 0!=b.dot(m,k)?(d.error("Wrong in-plane direction"),null):c.quat_project(a,f,m,k,p)};a.hash_code=c.hash_code;a.smooth=c.smooth;
a.smooth_v=c.smooth_v;a.is_vector=c.is_vector;a.correct_cam_quat_up=c.correct_cam_quat_up;a.quat_to_angle_axis=c.quat_to_angle_axis;a.random_from_array=c.random_from_array;a.xz_direction=c.xz_direction;a.line_plane_intersect=c.line_plane_intersect;a.is_mesh=c.is_mesh;a.is_armature=c.is_armature;a.angle_wrap_0_2pi=c.angle_wrap_0_2pi;a.angle_wrap_periodic=c.angle_wrap_periodic;a.smooth_step=c.smooth_step;a.lerp=c.lerp};"object"==typeof module&&module.Bn&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,r){r("__print");var d=r("__version");a.version=d.version;a.version_str=d.version_str;a.type=d.type;a.date=d.date;a.date_str=d.date_str};"object"==typeof module&&module.Bn&&b4w.module.version(exports);b4w.module.objects=function(a,r){var d=r("__geometry"),c=r("__objects"),b=r("__obj_util"),l=r("__print"),f=r("__scenes"),m=r("__util");a.get_meta_tags=function(a){if(a)return c.get_meta_tags(a)};a.copy=function(a,p,e){return m.is_mesh(a)?b.oa(a)?d.Lh(a)||d.check_shape_keys(a)||!e?-1==c.ma(f.get_active(),"MESH",c.DATA_ID_ALL).indexOf(a)?(l.error('object "'+a.name+'" does not belong to the active scene.'),!1):c.copy(a,p||"",e):(l.error('object "'+a.name+'" has not dynamic geometry for deep copying.'),
!1):(l.error('object "'+a.name+'" is not dynamic.'),!1):(l.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,b,d){if(!m.is_mesh(a))return l.error('The type of the object "'+a.name+'" is not "MESH".'),null;b=b.join("%join%");var f=c.iA(a,b);null!=f?a.f.Fe[f]=d:l.error('The Value node "'+b+'" was not found in the object "'+a.name+'".')};a.set_nodemat_rgb=function(a,b,d,f,h){if(!m.is_mesh(a))return l.error('The type of the object "'+a.name+'" is not "MESH".'),null;
b=b.join("%join%");var n=c.cA(a,b);null!=n?(a.f.Kc[3*n]=d,a.f.Kc[3*n+1]=f,a.f.Kc[3*n+2]=h):l.error('The RGB node "'+b+'" was not found in the object "'+a.name+'".')};a.update_boundings=function(a){if(!m.is_mesh(a))return l.error('The type of the object "'+a.name+'" is not "MESH".'),!1;if(!d.Lh(a)&&!d.check_shape_keys(a))return l.error('object "'+a.name+'" has not dynamic geometry.'),!1;c.update_boundings(a)};a.get_parent=c.get_parent;a.get_dg_parent=c.get_dg_parent};b4w.module.main=function(a,r){function d(){}function c(){}function b(){}function l(){window.performance||(P.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(P.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});T.Ot(0)}function f(a,b){a.addEventListener("webglcontextlost",function(a){a.preventDefault();P.error("WebGL context lost");k()},!1);y.Cd(b);var d=y.Yr();d&&P.log("%cRENDERER INFO:","color: #00a",
b.getParameter(d.UNMASKED_VENDOR_WEBGL)+", "+b.getParameter(d.UNMASKED_RENDERER_WEBGL));M.Cd(b);q.Cd(b);N.Cd(b);v.Cd(b);t.Cd(b);A.PC(a);u.init(a);I.Qt(a.width,a.height,1);L.init();c=h();e()}function m(){d=function(){}}function k(){p()||(ha=performance.now()/1E3,L.pause(),Q.pause(),N.pause(),n.pause())}function p(){return qa<ha}function e(){O(e);var a=performance.now()/1E3;pa||(pa=a);var b=a-pa;if(!(b<1/ca.wd)){for(var d=T.get_timeline(),f=0;f<ma.length;f++)ma[f](d,b);p()||(qa>pa&&(b-=qa-Math.max(ha,
pa)),d+=b,T.Ot(d),t.update(),G.update(),A.update(),g(d,b),c(b));pa=a}}function g(a,b){A.is_primary_loaded()&&(w.reset(),U.update(b),H.update(a,b),L.update(a,b),b&&C.update(b),A.is_primary_loaded()&&(Q.update(a,b),A.is_primary_loaded()&&(d(b,a),A.is_primary_loaded()&&(B.update(a,b),A.is_primary_loaded()&&(n.update(),z.update(a,b),I.update(a,b),n.dE(),aa&&(aa(R.toDataURL()),aa=null))))))}function h(){var a=60,c=0,d=ca.Gr,e=ca.pz;return function(f){f<1/ca.wd||(a=ga.smooth(1/f,a,f,d),f=Q.Xz(),c=(c+1)%
e,0==c&&b(Math.round(a),f))}}var n=r("__anchors"),C=r("__animation"),G=r("__assets"),F=r("__config"),E=r("__compat"),u=r("__container"),B=r("__controls"),A=r("__data"),t=r("__debug"),y=r("__extensions"),q=r("__geometry"),w=r("__hud"),H=r("__nla"),z=r("__objects"),Q=r("__physics"),P=r("__print"),M=r("__renderer"),I=r("__scenes"),L=r("__sfx"),v=r("__shaders"),N=r("__textures"),T=r("__time"),U=r("__transform"),ga=r("__util"),S=r("__version"),Y=F.context,ca=F.q,R=null,V=null,pa=0,ha=0,qa=0,ma=[],aa=null,
fa=["webgl","experimental-webgl"],D=null,O=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/ca.wd)}}();a.init=function(a,b){F.IC();P.LC(ca.console_verbose);var c=S.version_str()+" "+S.type()+" ("+S.date_str()+")";P.log("%cINIT ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;l();R=a;E.Zw();for(var c=null,
d=0;d<fa.length;d++){var e=fa[d];try{c=a.getContext(e,Y)}catch(g){}if(c)break}c&&E.Uy(c);if(!c)return null;D=c;f(R,c);F.ax();E.AC(c);v.cB();ca.$n&&(a.style["touch-action"]="none");P.log("%cSET PRECISION:","color: #00a",ca.precision);b?(w.init(b),V=b):(F.q.show_hud_debug_info=!1,F.w.Dl=!1);return c};a.set_check_gl_errors=function(a){t.set_check_gl_errors(a)};a.resize=function(a,b,c){!1!==c&&(R.style.width=a+"px",R.style.height=b+"px",V&&(V.style.width=a+"px",V.style.height=b+"px"));V&&(V.width=a,V.height=
b,w.Ci());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))ca.canvas_resolution_factor=1;c=Math.floor(a*ca.canvas_resolution_factor);b=Math.floor(b*ca.canvas_resolution_factor);ca.allow_hidpi&&1<window.devicePixelRatio&&(c*=window.devicePixelRatio,b*=window.devicePixelRatio);R.width=c;R.height=b;if(c>D.drawingBufferWidth||b>D.drawingBufferHeight){P.warn("Canvas size exceeds platform limits, downscaling");var d=Math.min(D.drawingBufferWidth/
c,D.drawingBufferHeight/b);c*=d;b*=d;R.width=c;R.height=b}I.Qt(c,b,c/a);I.ha()&&U.p(I.get_active().Zf);g(T.get_timeline(),0);A.UD(R.width,R.height)};a.set_fps_callback=function(a){b=a};a.clear_fps_callback=function(){b=function(){}};a.set_render_callback=function(a){d=a};a.clear_render_callback=function(){m()};a.global_timeline=function(){return T.get_timeline()};a.redraw=function(){P.error("redraw() deprecated");g(T.get_timeline(),0)};a.pause=k;a.resume=function(){p()&&(qa=performance.now()/1E3,
L.resume(),Q.resume(),N.play(!0),n.resume())};a.is_paused=p;a.reset=function(){A.unload(0);V=R=null;qa=ha=pa=0;b=function(){};c=function(){};d=function(){};ma.length=0;D=null;T.reset()};a.canvas_data_url=function(a){aa=a};a.get_canvas_elem=function(){return R};a.detect_mobile=function(){return E.detect_mobile()};a.append_loop_cb=function(a){for(var b=0;b<ma.length;b++)if(ma[b]==a)return;ma.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<ma.length;b++)if(ma[b]==a){ma.splice(b,1);break}}};b4w.module.nla=function(a,r){var d=r("__nla"),c=r("__time"),b=r("__print"),l=r("__util");a.set_frame=function(a){a=l.clamp(a,d.get_frame_start(),d.get_frame_end());d.check_logic_nodes()?b.error("The active scene is using NLA script."):d.set_frame(a,c.get_timeline())};a.get_frame=function(){return d.get_frame(c.get_timeline())};a.stop=function(){d.check_logic_nodes()?b.error("The active scene is using NLA script."):d.mD()};a.play=function(a){d.check_logic_nodes()?b.error("The active scene is using NLA script."):
d.QB(a)};a.is_play=function(){return d.is_play()};a.get_frame_start=function(){return d.get_frame_start()};a.get_frame_end=function(){return d.get_frame_end()};a.check_nla=function(){return d.check_nla()};a.check_nla_scripts=function(){return d.check_logic_nodes()};a.check_logic_nodes=function(){return d.check_logic_nodes()};a.set_range=function(a,c){d.check_logic_nodes()?b.error("The active scene is using NLA script."):(c=parseFloat(c)||d.get_frame_end(),a=parseFloat(a)||d.get_frame_end(),c=l.clamp(c,
d.get_frame_start(),d.get_frame_end()),a=l.clamp(a,d.get_frame_start(),c),d.set_range(a,c))};a.reset_range=function(){d.check_logic_nodes()?b.error("The active scene is using NLA script."):d.reset_range()};a.set_cyclic=function(a){d.check_logic_nodes()?b.error("The active scene is using NLA script."):d.set_cyclic(a)};a.clear_callback=function(){d.check_logic_nodes()?b.error("The active scene is using NLA script."):d.clear_callback()}};
